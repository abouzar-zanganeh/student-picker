(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const a of document.querySelectorAll('link[rel="modulepreload"]'))o(a);new MutationObserver(a=>{for(const s of a)if(s.type==="childList")for(const i of s.addedNodes)i.tagName==="LINK"&&i.rel==="modulepreload"&&o(i)}).observe(document,{childList:!0,subtree:!0});function n(a){const s={};return a.integrity&&(s.integrity=a.integrity),a.referrerPolicy&&(s.referrerPolicy=a.referrerPolicy),a.crossOrigin==="use-credentials"?s.credentials="include":a.crossOrigin==="anonymous"?s.credentials="omit":s.credentials="same-origin",s}function o(a){if(a.ep)return;a.ep=!0;const s=n(a);fetch(a.href,s)}})();class wt{constructor(t){this.identity={name:t.name,studentId:t.studentId||`id_${new Date().getTime()}_${Math.random()}`,branchName:t.branchName||null,ageGroup:t.ageGroup||"adult",level:t.level||null,contact:{social:t.socialContact||null,parent:t.parentContact||null}},this.isDeleted=!1,this.statusCounters={totalSelections:0,missedChances:0,earlyLeaves:0,outOfClassCount:0},this.categoryCounts={},this.categoryIssues={},this.logs={parentContacts:[],scores:{},discipline:{},sessionHistory:{}},this.profile={notes:[],tags:[]},this.finalClassActivityScore=null,this.onboardingSession=null}addScore(t,n,o){if(n>100||n<0){console.log("Ù†Ù…Ø±Ù‡ Ù†Ø¨Ø§ÛŒØ¯ Ø§Ø² Û±Û°Û° Ø¨ÛŒØ´ØªØ± Ùˆ Ø§Ø² ØµÙØ± Ú©Ù…ØªØ± Ø¨Ø§Ø´Ø¯");return}const a=t.toLowerCase();this.logs.scores[a]||(this.logs.scores[a]=[]);const s=new yo(t,n,o);this.logs.scores[a].push(s)}addNote(t,n=null){const o=new Co(t,n);this.profile.notes.push(o)}getOverallAverageScore(){let t=0,n=0;for(const a in this.logs.scores)this.logs.scores[a].forEach(s=>{s.isDeleted||(t+=s.value,n++)});if(n===0)return null;const o=t/n;return Math.round(o*100)/100}}class yo{constructor(t,n,o=""){this.id=`score_${new Date().getTime()}`,this.skill=t,this.value=n,this.timestamp=new Date,this.comment=o,this.isDeleted=!1}}class Co{constructor(t,n=null){this.id=`note_${new Date().getTime()}`,this.timestamp=new Date,this.content=t,this.isDeleted=!1,this.source=n}}class on{constructor(t="complete",n=""){this.status=t,this.comment=n,this.timestamp=new Date}}class ns{constructor(t){this.sessionNumber=t,this.startTime=new Date,this.note="",this.isDeleted=!1,this.endTime=null,this.isFinished=!1,this.isMakeup=!1,this.isCancelled=!1,this.studentRecords={},this.lastWinnerByCategory={},this.lastUsedCategoryId=null,this.lastSelectedWinnerId=null,this.winnerHistory=[]}end(){this.isFinished=!0,this.endTime=new Date}markAsMakeup(){this.isMakeup=!this.isMakeup}initializeStudentRecord(t){this.studentRecords[t]||(this.studentRecords[t]={attendance:"present",homework:new on,selections:{},hadIssue:!1,wasOutOfClass:!1})}setAttendance(t,n){this.initializeStudentRecord(t),this.studentRecords[t].attendance=n}setHomeworkStatus(t,n){this.initializeStudentRecord(t),this.studentRecords[t].homework.status=n}selectNextWinner(t,n,o){if(!n||n.length===0)return console.log("Ù‡ÛŒÚ† Ø¯Ø§Ù†Ø´â€ŒØ¢Ù…ÙˆØ²ÛŒ Ø¯Ø± Ú©Ù„Ø§Ø³ Ø¨Ø±Ø§ÛŒ Ø§Ù†ØªØ®Ø§Ø¨ ÙˆØ¬ÙˆØ¯ Ù†Ø¯Ø§Ø±Ø¯."),null;const a=this.lastWinnerByCategory[t];let s=n.filter(m=>m.identity.studentId!==a&&!m.isDeleted);if(s.length===0&&(s=n),s.length===0)return null;const i=(m,C)=>m.categoryCounts[C]||0,l=Math.min(...s.map(m=>i(m,t))),c=s.filter(m=>i(m,t)===l);let u;if(c.length===1)u=c[0];else if(c.length>1){const m=o.filter(N=>!N.isDeleted&&N.name!==t).map(N=>N.name),C=c.map(N=>{const V=m.reduce((G,ee)=>G+i(N,ee),0);return{student:N,otherCategoriesTotal:V}}),v=Math.min(...C.map(N=>N.otherCategoriesTotal)),k=C.filter(N=>N.otherCategoriesTotal===v).map(N=>N.student);k.length===1?u=k[0]:u=k[Math.floor(Math.random()*k.length)]}else u=s[Math.floor(Math.random()*s.length)];const f=u.identity.studentId;this.initializeStudentRecord(f);const E=(this.studentRecords[f].selections[t]||0)+1;return this.studentRecords[f].selections[t]=E,u.statusCounters.totalSelections++,u.categoryCounts[t]=(u.categoryCounts[t]||0)+1,this.lastWinnerByCategory[t]=f,u}}class an{constructor(t){this.info={name:t.name||"NotNamed",scheduleCode:t.scheduleCode||`code_${new Date().getTime()}`,teacherName:t.teacherName||null,type:t.type||"in-person",term:t.term||null,scheduleText:t.scheduleText||null,level:t.level||null,creationDate:t.creationDate?new Date(t.creationDate):new Date},this.students=[],this.sessions=[],this.note="",this.isDeleted=!1,this.categories=[new we("Vocabulary","Questions about words and meanings."),new we("Grammar","Questions about sentence structure and rules."),new we("Listening",void 0,!0),new we("Speaking",void 0,!0),new we("Reading",void 0,!0),new we("Writing",void 0,!0)],this.futurePlans={}}addStudent(t){this.students.push(t)}removeStudent(t){this.students=this.students.filter(n=>n.identity.studentId!==t)}startNewSession(){const t=this.sessions.length+1,n=new ns(t);return this.sessions.push(n),n}endSpecificSession(t){const n=this.getSession(t);return n&&!n.isFinished?(n.end(),!0):!1}getSession(t){return this.sessions.find(n=>n.sessionNumber===t)}markAsMakeup(t){const n=this.getSession(t);n&&n.markAsMakeup()}planForSession(t,n){this.futurePlans[t]=n}hasSessionToday(){const t=new Date().toDateString();return this.sessions.some(n=>!n.isDeleted&&n.startTime.toDateString()===t)}selectNextWinner(t,n){return n?n.selectNextWinner(t,this.students,this.categories):null}get liveSession(){for(let t=this.sessions.length-1;t>=0;t--)if(!this.sessions[t].isFinished)return this.sessions[t];return null}endLiveSession(){const t=this.liveSession;return t?(t.end(),!0):!1}calculateFinalStudentScore(t){const n=t.logs.scores,o=["reading","writing"];for(const m of o)if(!n[m]||n[m].length===0)return null;const a=n.listening&&n.listening.length>0,s=n.speaking&&n.speaking.length>0;if(!a&&!s)return null;const i=m=>n[m].reduce((v,k)=>v+k.value,0)/n[m].length;let l;a&&s?l=(i("listening")+i("speaking"))/2:a?l=i("listening"):l=i("speaking");const c=i("reading"),u=i("writing"),E=(l*3+c*2+u*1)/6;return Math.trunc(E*10)/10}assignAllFinalScores(){let t=0,n=[];console.log("Ø´Ø±ÙˆØ¹ Ø¹Ù…Ù„ÛŒØ§Øª Ù…Ø­Ø§Ø³Ø¨Ù‡ Ù†Ù…Ø±Ù‡ Ù†Ù‡Ø§ÛŒÛŒ Ø¨Ø±Ø§ÛŒ ØªÙ…Ø§Ù… Ø¯Ø§Ù†Ø´â€ŒØ¢Ù…ÙˆØ²Ø§Ù†..."),this.students.forEach(a=>{const s=this.calculateFinalStudentScore(a);s!==null?(a.finalClassActivityScore=s,t++):(a.finalClassActivityScore=null,n.push(a.identity.name))});const o=n.length;console.log(`Ø¹Ù…Ù„ÛŒØ§Øª Ù¾Ø§ÛŒØ§Ù† ÛŒØ§ÙØª. ØªØ¹Ø¯Ø§Ø¯ Ù†Ù…Ø±Ø§Øª Ù…ÙˆÙÙ‚: ${t} | ØªØ¹Ø¯Ø§Ø¯ Ù†Ø§Ù…ÙˆÙÙ‚ (Ù†Ù…Ø±Ø§Øª Ù†Ø§Ù‚Øµ): ${o}`),o>0&&(console.log("Ø§Ø³Ø§Ù…ÛŒ Ø¯Ø§Ù†Ø´â€ŒØ¢Ù…ÙˆØ²Ø§Ù†ÛŒ Ú©Ù‡ Ù†Ù…Ø±Ø§ØªØ´Ø§Ù† Ù†Ø§Ù‚Øµ Ø§Ø³Øª:"),n.forEach(a=>console.log(`- ${a}`)))}}class we{constructor(t,n="",o=!1){this.id=`cat_${new Date().getTime()}_${Math.random()}`,this.name=t,this.description=n,this.isDeleted=!1,this.isGradedCategory=o,this.isDeleted=!1}}let L={},d=null,Sn=null,h=null,_=null,mt=null,Xt=null,Ln=[],Ht=null,wn=null,de=null,At=0,kn=0,Wt=0,Nn=0,Bn=null,Dn=null,_t=null,De=null,ge=-1,Tn=null,Pt=null,Ft=null,ss=null,os=null,Ee=!1,M=[],ve=[],He=[],ye={isScreenSaverEnabled:!0,lastRestoreTimestamp:null};function w(){if(Ee)return;const e={classrooms:L,trashBin:M,userSettings:ye};localStorage.setItem("teacherAssistantData_v2",JSON.stringify(e))}function as(e=[]){const t={};if(e.length>0)e.forEach(i=>{L[i]&&(t[i]=L[i])});else for(const i in L)L[i].isDeleted||(t[i]=L[i]);const n={metadata:{version:"2.0",createdAt:new Date().toISOString()},data:{classrooms:t,trashBin:M}},o=JSON.stringify(n,null,2),s=`SP-Backup-${new Date().toLocaleDateString("fa-IR-u-nu-latn").replace(/\//g,"-")}.txt`;return new File([o],s,{type:"text/plain"})}function Ut(){const e=localStorage.getItem("teacherAssistantData_v2");if(!e)return;const t=JSON.parse(e);t.classrooms?(Ae(t.classrooms),M=t.trashBin||[],ye={...ye,...t.userSettings}):(Ae(t),bo())}function bo(){const e=[];Object.values(L).forEach(t=>{t.isDeleted?e.push({id:`trash_${Date.now()}_${Math.random()}`,timestamp:t.info.creationDate,type:"classroom",description:`Ú©Ù„Ø§Ø³ Â«${t.info.name}Â»`,restoreData:{name:t.info.name}}):t.students.forEach(n=>{n.isDeleted&&e.push({id:`trash_${Date.now()}_${Math.random()}`,timestamp:n.identity.studentId.split("_")[1],type:"student",description:`Ø¯Ø§Ù†Ø´â€ŒØ¢Ù…ÙˆØ² Â«${n.identity.name}Â»`,restoreData:{studentId:n.identity.studentId,classroomName:t.info.name}})})}),M.length===0&&e.length>0&&(M=e,console.log(`Migrated ${e.length} previously deleted item(s) to the new trash bin.`),w())}function is(e){const t=new wt(e.identity);return t.isDeleted=e.isDeleted,t.statusCounters=e.statusCounters,t.logs=e.logs,t.logs.scores||(t.logs.scores={}),t.profile=e.profile,t.finalClassActivityScore=e.finalClassActivityScore,t.categoryCounts=e.categoryCounts||{},t.categoryIssues=e.categoryIssues||{},t.onboardingSession=e.onboardingSession||null,t}function Ae(e){L={};for(const t in e){const n=e[t];let o;n.info?o=n.info:o={...n,name:t};const a=new an(o);a.isDeleted=n.isDeleted,a.note=n.note||"",a.students=(n.students||[]).map(is),a.sessions=(n.sessions||[]).map(s=>{const i=new ns(s.sessionNumber);i.isDeleted=s.isDeleted,i.note=s.note||"",i.startTime=new Date(s.startTime),i.endTime=s.endTime?new Date(s.endTime):null,i.isFinished=s.isFinished,i.isMakeup=s.isMakeup,i.isCancelled=s.isCancelled||!1,i.studentRecords=s.studentRecords;for(const c in i.studentRecords){const u=i.studentRecords[c];u.homework&&!(u.homework instanceof on)&&(i.studentRecords[c].homework=new on(u.homework.status,u.homework.comment))}i.lastWinnerByCategory=s.lastWinnerByCategory,i.lastUsedCategoryId=s.lastUsedCategoryId,i.lastSelectedWinnerId=s.lastSelectedWinnerId;const l=s.winnerHistory||[];return i.winnerHistory=l.filter(c=>c&&c.winner).map(c=>({winner:a.students.find(f=>f.identity.studentId===c.winner.identity.studentId),categoryName:c.categoryName})).filter(c=>c.winner),i}),a.categories=(n.categories||[]).map(s=>{const i=new we(s.name,s.description,s.isGradedCategory);return i.id=s.id,i.isDeleted=s.isDeleted,i}),a.futurePlans=n.futurePlans,L[t]=a}}function cs(e,t){if(t){const n=e.data.classrooms;for(let o in n){let a=o;const s=n[o];for(;L[a];)a=`${a} (Restored)`;a!==o&&(s.info.name=a),L[a]=s}if(e.data.trashBin){const o=[...M,...e.data.trashBin],a=[...new Map(o.map(s=>[s.id,s])).values()];zt(a)}Ae(L)}else Ae(e.data.classrooms),zt(e.data.trashBin||[]);it({lastRestoreTimestamp:new Date().toISOString()}),w()}function ls(e,t){if(L[t])return{success:!1,message:"Ú©Ù„Ø§Ø³ÛŒ Ø¨Ø§ Ø§ÛŒÙ† Ù†Ø§Ù… Ø§Ø² Ù‚Ø¨Ù„ ÙˆØ¬ÙˆØ¯ Ø¯Ø§Ø±Ø¯."};const n=L[e];return n?(n.info.name=t,L[t]=n,delete L[e],d===n&&ne(n),{success:!0}):{success:!1,message:"Ú©Ù„Ø§Ø³ Ù…ÙˆØ±Ø¯ Ù†Ø¸Ø± ÛŒØ§ÙØª Ù†Ø´Ø¯."}}function rs(e,t,n){const o=n.trim();if(!o)return{success:!1,message:"Ù†Ø§Ù… Ø¯Ø³ØªÙ‡â€ŒØ¨Ù†Ø¯ÛŒ Ù†Ù…ÛŒâ€ŒØªÙˆØ§Ù†Ø¯ Ø®Ø§Ù„ÛŒ Ø¨Ø§Ø´Ø¯."};if(e.categories.some(c=>c.id!==t.id&&!c.isDeleted&&c.name.toLowerCase()===o.toLowerCase()))return{success:!1,message:"Ø¯Ø³ØªÙ‡â€ŒØ¨Ù†Ø¯ÛŒ Ø¯ÛŒÚ¯Ø±ÛŒ Ø¨Ø§ Ø§ÛŒÙ† Ù†Ø§Ù… ÙˆØ¬ÙˆØ¯ Ø¯Ø§Ø±Ø¯."};const s=t.name,i=s.toLowerCase(),l=o.toLowerCase();return t.name=o,e.students.forEach(c=>{c.categoryCounts&&c.categoryCounts[s]!==void 0&&(c.categoryCounts[o]=c.categoryCounts[s],delete c.categoryCounts[s]),c.categoryIssues&&c.categoryIssues[s]!==void 0&&(c.categoryIssues[o]=c.categoryIssues[s],delete c.categoryIssues[s]),c.logs.scores&&c.logs.scores[i]&&(c.logs.scores[i].forEach(u=>u.skill=o),i!==l&&(c.logs.scores[l]=c.logs.scores[i],delete c.logs.scores[i]))}),e.sessions.forEach(c=>{c.lastWinnerByCategory&&c.lastWinnerByCategory[s]&&(c.lastWinnerByCategory[o]=c.lastWinnerByCategory[s],delete c.lastWinnerByCategory[s]),c.winnerHistory&&c.winnerHistory.forEach(u=>{u.categoryName===s&&(u.categoryName=o)})}),{success:!0}}function ds(e,t,n){if(U(n.students).some(u=>u.identity.name.toLowerCase()===e.identity.name.toLowerCase()))return{success:!1,message:`Ø¯Ø§Ù†Ø´â€ŒØ¢Ù…ÙˆØ²ÛŒ Ø¨Ø§ Ù†Ø§Ù… Â«${e.identity.name}Â» Ø§Ø² Ù‚Ø¨Ù„ Ø¯Ø± Ú©Ù„Ø§Ø³ Â«${n.info.name}Â» ÙˆØ¬ÙˆØ¯ Ø¯Ø§Ø±Ø¯.`};const a=JSON.parse(JSON.stringify(e)),s=is(a),i=new Map;t.sessions.forEach(u=>{const f=u.studentRecords[e.identity.studentId];f&&i.set(u.sessionNumber,JSON.parse(JSON.stringify(f)))}),n.addStudent(s);try{const u=U(n.sessions).filter(N=>!N.isCancelled).sort((N,V)=>V.sessionNumber-N.sessionNumber),f=u.length>0?u[0]:null;let E="ØŸ",m={type:"system",description:"Student Move"};f&&(E=pe(n).get(f.sessionNumber)||f.sessionNumber,m={type:"fromSession",sessionNumber:f.sessionNumber});const C=new Date().toLocaleDateString("fa-IR"),v=t.info.name,k=`Ø§ÛŒÙ† Ø¯Ø§Ù†Ø´ Ø¢Ù…ÙˆØ² Ø¯Ø± Ø¬Ù„Ø³Ù‡ ${E} Ùˆ Ø¯Ø± ØªØ§Ø±ÛŒØ® ${C} Ø§Ø² Ú©Ù„Ø§Ø³ Â«${v}Â» Ø¨Ù‡ Ø§ÛŒÙ† Ú©Ù„Ø§Ø³ Ø§Ù†ØªÙ‚Ø§Ù„ Ù¾ÛŒØ¯Ø§ Ú©Ø±Ø¯`;s.addNote(k,m)}catch(u){console.error("Failed to add automated move note:",u)}i.size>0&&n.sessions.forEach(u=>{const f=i.get(u.sessionNumber);f&&!u.isDeleted&&!u.isCancelled&&(u.studentRecords[s.identity.studentId]=f)});const l={id:`trash_${Date.now()}_${Math.random()}`,timestamp:new Date().toISOString(),type:"student",description:`(Ø§Ù†ØªÙ‚Ø§Ù„) Ø¯Ø§Ù†Ø´â€ŒØ¢Ù…ÙˆØ² Â«${e.identity.name}Â» Ø§Ø² Ú©Ù„Ø§Ø³ Â«${t.info.name}Â»`,restoreData:{studentId:e.identity.studentId,classId:t.info.scheduleCode}};M.unshift(l),M.length>50&&M.pop();const c=t.students.find(u=>u.identity.studentId===e.identity.studentId);return c&&(c.isDeleted=!0),{success:!0}}function us(){for(const e in L){const t=L[e];t.students.forEach(n=>{n.statusCounters={totalSelections:0,missedChances:0,earlyLeaves:0},n.categoryCounts={},n.categoryIssues={},t.sessions.forEach(o=>{const a=n.identity.studentId;o.studentRecords[a]&&(o.studentRecords[a].attendance="present")})})}w()}function U(e){return Array.isArray(e)?e.filter(t=>!t.isDeleted):[]}function pe(e){const t=new Map;return e&&U(e.sessions).filter(o=>!o.isCancelled).sort((o,a)=>o.sessionNumber-a.sessionNumber).forEach((o,a)=>{t.set(o.sessionNumber,a+1)}),t}function Te(e){ge=e}function be(e){Tn=e}function qt(e,t){if(!e||!t)return;const n=e.identity.studentId,o=t.students.findIndex(a=>a.identity.studentId===n);o>-1&&t.students.splice(o,1),t.sessions.forEach(a=>{a.studentRecords[n]&&delete a.studentRecords[n];for(const s in a.lastWinnerByCategory)a.lastWinnerByCategory[s]===n&&delete a.lastWinnerByCategory[s];a.lastSelectedWinnerId===n&&(a.lastSelectedWinnerId=null),a.winnerHistory=a.winnerHistory.filter(s=>s.winner&&s.winner.identity.studentId!==n)})}function ms(e,t){const n=L[e];if(!n)return;const o=n.sessions.findIndex(a=>a.sessionNumber===t);o>-1&&(n.students.forEach(a=>{a.profile.notes&&a.profile.notes.length>0&&(a.profile.notes=a.profile.notes.filter(s=>!s.source||s.source.type!=="fromAttendance"||s.source.sessionNumber!==t)),a.onboardingSession===t&&(a.onboardingSession=null)}),n.sessions.splice(o,1))}function fs(e,t){const n=L[e];if(!n)return;const o=n.categories.findIndex(l=>l.id===t);if(o===-1)return;const s=n.categories[o].name,i=s.toLowerCase();n.students.forEach(l=>{l.categoryCounts&&delete l.categoryCounts[s],l.categoryIssues&&delete l.categoryIssues[s],l.logs.scores&&delete l.logs.scores[i]}),n.sessions.forEach(l=>{l.lastWinnerByCategory[s]&&delete l.lastWinnerByCategory[s],l.winnerHistory=l.winnerHistory.filter(c=>c.categoryName!==s)}),n.categories.splice(o,1)}function ps(e,t,n,o){const a=L[e];if(!a)return;const s=a.students.find(c=>c.identity.studentId===t);if(!s||!s.logs.scores[n.toLowerCase()])return;const i=s.logs.scores[n.toLowerCase()],l=i.findIndex(c=>c.id===o);l>-1&&i.splice(l,1)}function gs(e,t,n){const o=L[e];if(!o)return;const a=o.students.find(i=>i.identity.studentId===t);if(!a||!a.profile.notes)return;const s=a.profile.notes.findIndex(i=>i.id===n);s>-1&&a.profile.notes.splice(s,1)}function hs(){JSON.parse(JSON.stringify({classrooms:L,trashBin:M})),Ee=!0}function ys(){Ee=!1,Ut()}function ne(e){d=e}function Qt(e){Sn=e}function ue(e){h=e}function me(e){_=e}function Vt(e){mt=e}function Cs(e){Xt=e}function st(e){Ln=e}function kt(e){Ht=e}function bs(e){wn=e}function Gt(e){de=e}function Nt(e){At=e}function vs(e){kn=e}function Bt(e){Wt=e}function Es(e){Nn=e}function xn(e){Bn=e}function Mn(e){Dn=e}function ft(e){_t=e}function $n(e){De=e}function jt(e){Ft=e}function Is(e){ss=e}function Ss(e){os=e}function zt(e){M=e}function Yt(e){Pt=e}function Jt(e){He=e}function it(e){ye={...ye,...e},w()}function cn(e){ve=e}const vo=Object.freeze(Object.defineProperty({__proto__:null,get activeModal(){return De},get cancelCallback(){return Dn},get classrooms(){return L},get confirmCallback(){return Bn},get currentClassroom(){return d},get easterEggClickCount(){return At},get easterEggLastClickTime(){return kn},enterDemoMode:hs,exitDemoMode:ys,getActiveItems:U,getSessionDisplayMap:pe,get importedFileContent(){return Ht},get isDemoMode(){return Ee},get liveSession(){return Sn},loadData:Ut,get manualSelection(){return Ft},moveStudent:ds,get namesToImport(){return Ln},get notificationTimeout(){return wn},permanentlyDeleteCategory:fs,permanentlyDeleteNote:gs,permanentlyDeleteScore:ps,permanentlyDeleteSession:ms,permanentlyDeleteStudent:qt,prepareBackupData:as,get previousState(){return mt},processRestore:cs,rehydrateData:Ae,renameCategory:rs,renameClassroom:ls,resetAllStudentCounters:us,get resetEasterEggClickCount(){return Wt},get resetEasterEggLastClickTime(){return Nn},get saveCategoryCallback(){return Pt},saveData:w,get saveNoteCallback(){return Tn},get secureConfirmCallback(){return _t},get selectedCategory(){return de},get selectedClassIds(){return ve},get selectedSession(){return h},get selectedStudentForProfile(){return _},get selectedStudentsForMassComment(){return He},setActiveModal:$n,setCancelCallback:Mn,setConfirmCallback:xn,setCurrentClassroom:ne,setEasterEggClickCount:Nt,setEasterEggLastClickTime:vs,setImportedFileContent:kt,setLiveSession:Qt,setManualSelection:jt,setNamesToImport:st,setNotificationTimeout:bs,setPreviousState:Vt,setResetEasterEggClickCount:Bt,setResetEasterEggLastClickTime:Es,setSaveCategoryCallback:Yt,setSaveNoteCallback:be,setSecureConfirmCallback:ft,setSelectedCategory:Gt,setSelectedClassIds:cn,setSelectedSession:ue,setSelectedStudentForProfile:me,setSelectedStudentsForMassComment:Jt,setSourceClassForMove:Ss,setStudentToMove:Is,setTrashBin:zt,setUndoTimeout:Cs,setUserSettings:it,setWinnerHistoryIndex:Te,get sourceClassForMove(){return os},get studentToMove(){return ss},get trashBin(){return M},get undoTimeout(){return Xt},get userSettings(){return ye},get winnerHistoryIndex(){return ge}},Symbol.toStringTag,{value:"Module"}));function Se(e){return typeof e!="string"?"":e.replace(/ÙŠ/g,"ÛŒ").replace(/Ùƒ/g,"Ú©").replace(/[\s\u200c]/g,"")}function On(e){return typeof e!="string"||e.length===0?"ltr":/[\u0590-\u07FF]/.test(e)?"rtl":"ltr"}function Ls(e){return!e||!e.trim()?"":e.split(`
`).map(o=>`<div dir="${On(o)}">${o||"&nbsp;"}</div>`).join("")}function sn(e){if(typeof e!="string")return"";const t={q:"Ø¶",w:"Øµ",e:"Ø«",r:"Ù‚",t:"Ù",y:"Øº",u:"Ø¹",i:"Ù‡",o:"Ø®",p:"Ø­","[":"Ø¬","]":"Ú†",a:"Ø´",s:"Ø³",d:"ÛŒ",f:"Ø¨",g:"Ù„",h:"Ø§",j:"Øª",k:"Ù†",l:"Ù…",";":"Ú©","'":"Ú¯",z:"Ø¸",x:"Ø·",c:"Ø²",v:"Ø±",b:"Ø°",n:"Ø¯",m:"Ù¾",",":"Ùˆ"};let n="";for(let o=0;o<e.length;o++){const a=e[o].toLowerCase();n+=t[a]||e[o]}return n}const ws="teacherAssistantLogs_v2",Eo=100;function Rn(){try{const e=localStorage.getItem(ws);return e?JSON.parse(e):{}}catch(e){return console.error("Error reading logs from localStorage:",e),{}}}function ks(e){try{localStorage.setItem(ws,JSON.stringify(e))}catch(t){console.error("Error saving logs to localStorage:",t)}}function W(e,t,n=null){if(!e)return;const o=Rn();o[e]||(o[e]=[]);const a={timestamp:new Date().toISOString(),message:t,action:n,classroomName:e};o[e].unshift(a),o[e].length>Eo&&o[e].pop(),ks(o)}function Io(e){return Rn()[e]||[]}function So(e,t){const n=Rn();n[e]&&!n[t]&&(n[t]=n[e],delete n[e],ks(n))}const Ns=document.getElementById("class-management-page"),Lo=document.getElementById("new-class-name"),wo=document.getElementById("add-class-btn"),ze=document.getElementById("class-list"),Kt=document.getElementById("undo-toast"),Bs=document.getElementById("undo-message"),ko=document.getElementById("undo-btn"),No=document.getElementById("settings-page"),Hn=document.getElementById("settings-class-name-header"),ln=document.getElementById("settings-student-list"),rn=document.getElementById("category-list"),Bo=document.getElementById("back-to-sessions-btn"),Do=document.getElementById("new-student-name"),To=document.getElementById("add-student-btn"),Ds=document.getElementById("paste-area"),xo=document.getElementById("process-paste-btn"),Mo=document.getElementById("csv-preview-page"),dn=document.getElementById("csv-preview-list"),$o=document.getElementById("csv-confirm-btn"),Oo=document.getElementById("csv-cancel-btn"),Ro=document.getElementById("import-csv-btn"),Ho=document.getElementById("csv-file-input"),Ao=document.getElementById("column-mapping-page"),un=document.getElementById("column-select-dropdown"),Wo=document.getElementById("confirm-column-btn"),_o=document.getElementById("cancel-import-btn"),Po=document.getElementById("new-category-name"),Fo=document.getElementById("add-category-btn"),mn=document.querySelector(".app-header"),Ce=document.getElementById("select-student-btn"),Ke=document.getElementById("select-student-btn-wrapper"),Uo=document.getElementById("attendance-page"),ct=document.getElementById("attendance-list"),qo=document.getElementById("finish-attendance-btn"),Vo=document.querySelector("#class-management-page h2"),fn=document.getElementById("student-stats-header"),Go=document.getElementById("hamburger-menu-btn"),jo=document.getElementById("side-nav-menu"),zo=document.getElementById("close-nav-btn"),Jo=document.getElementById("overlay"),Ko=document.getElementById("backup-data-btn"),Xo=document.getElementById("restore-data-btn"),Ts=document.getElementById("restore-file-input"),Qo=document.getElementById("custom-confirm-modal"),xs=document.getElementById("confirm-modal-message"),pn=document.getElementById("confirm-modal-cancel-btn"),ot=document.getElementById("confirm-modal-confirm-btn"),Yo=document.getElementById("secure-confirm-modal"),Ms=document.getElementById("secure-confirm-message"),$s=document.getElementById("secure-confirm-code"),Ve=document.getElementById("secure-confirm-input"),Zo=document.getElementById("secure-confirm-cancel-btn"),Dt=document.getElementById("secure-confirm-confirm-btn"),ea=document.getElementById("add-note-modal"),O=document.getElementById("new-note-content"),ta=document.getElementById("class-save-note-btn"),na=document.getElementById("cancel-note-btn"),gn=document.getElementById("student-search-input"),Be=document.getElementById("student-search-results"),sa=document.getElementById("back-to-student-page-btn"),oa=document.getElementById("graded-category-pills-container"),aa=document.getElementById("new-score-value"),Os=document.getElementById("new-score-comment"),ia=document.getElementById("add-score-btn"),ca=document.getElementById("profile-stats-summary"),la=document.getElementById("profile-scores-list"),Tt=document.getElementById("global-student-search-input"),Le=document.getElementById("global-student-search-results"),ra=document.getElementById("is-graded-checkbox"),da=document.getElementById("trashed-classes-list"),ua=document.getElementById("trashed-students-list"),ma=document.getElementById("trashed-sessions-list"),fa=document.getElementById("trashed-categories-list"),pa=document.getElementById("trashed-notes-list"),ga=document.getElementById("trashed-scores-list"),je=document.getElementById("quick-grade-form-wrapper"),Ie=document.getElementById("quick-score-input"),he=document.getElementById("quick-note-textarea"),Oe=document.getElementById("quick-grade-submit-btn"),lt=document.getElementById("category-selection-container"),hn=document.getElementById("selected-student-result"),Re=document.getElementById("custom-context-menu"),Ge=document.getElementById("breadcrumb-container");let nt=null,Je=null;const ha=document.getElementById("category-modal"),Rs=document.getElementById("category-modal-title"),rt=document.getElementById("new-category-modal-name"),An=document.getElementById("new-category-modal-is-graded"),ya=document.getElementById("category-modal-cancel-btn"),Hs=document.getElementById("category-modal-save-btn"),Ca=document.getElementById("mass-comment-modal"),ba=document.getElementById("mass-comment-modal-title"),As=document.getElementById("mass-comment-student-count-message"),dt=document.getElementById("mass-comment-content"),Wn=document.getElementById("mass-comment-append-checkbox"),va=document.getElementById("mass-comment-cancel-btn"),Ea=document.getElementById("mass-comment-save-btn"),yn=document.getElementById("mass-comment-btn"),xt=document.getElementById("attendance-mass-actions-container"),Me=document.createElement("input"),Ia=document.getElementById("session-dashboard-page"),Xe=document.getElementById("attendance-pane");function pt(e="selector"){if(!d||!h){x("class-management-page");return}Na(),$t(),X(),We(),x("session-dashboard-page",{tab:e}),Ws(),gt(e),Ba()}function gt(e){const t=document.getElementById("selector-tab-btn"),n=document.getElementById("attendance-tab-btn"),o=document.getElementById("selector-pane"),a=e==="selector";t.classList.toggle("active",a),n.classList.toggle("active",!a),o.classList.toggle("active",a),Xe.classList.toggle("active",!a)}function Ws(){const e=document.getElementById("selector-tab-btn"),t=document.getElementById("attendance-tab-btn"),n=document.getElementById("selector-pane");e.addEventListener("click",()=>{X(),ce(),e.classList.add("active"),t.classList.remove("active"),n.classList.add("active"),Xe.classList.remove("active"),x("session-dashboard-page",{tab:"selector"})}),t.addEventListener("click",()=>{We(),t.classList.add("active"),e.classList.remove("active"),Xe.classList.add("active"),n.classList.remove("active"),x("session-dashboard-page",{tab:"attendance"})})}function Sa(e){clearTimeout(Xt),mt||Vt(JSON.stringify(L)),Bs.textContent=e,Kt.classList.add("show"),Cs(setTimeout(()=>{Kt.classList.remove("show"),Vt(null)},5e3))}function _s(){if(mt){const e=d?d.info.name:null,t=JSON.parse(mt);Ae(t),e&&L[e]?ne(L[e]):ne(null),d?(ke(),Qe(),ae()):oe(),Kt.classList.remove("show"),clearTimeout(Xt),Vt(null)}}function b(e,t=3e3){const n=document.getElementById("notification-toast");n&&(n.textContent=e,n.classList.add("show"),clearTimeout(wn),bs(setTimeout(()=>{n.classList.remove("show")},t)))}function Ps(e){const t=document.getElementById("restore-confirm-modal"),n=document.getElementById("restore-modal-message"),o=document.getElementById("restore-append-checkbox"),a=document.getElementById("restore-confirm-cancel-btn"),s=document.getElementById("restore-confirm-confirm-btn"),i=document.getElementById("restore-modal-warning");i.style.display="none";const l=e.metadata.createdAt;if(ye.lastRestoreTimestamp&&l<ye.lastRestoreTimestamp){const m=new Date(l).toLocaleDateString("fa-IR"),C=new Date(ye.lastRestoreTimestamp).toLocaleDateString("fa-IR");i.textContent=`âš ï¸ Ù‡Ø´Ø¯Ø§Ø±: Ø§ÛŒÙ† ÙØ§ÛŒÙ„ Ù¾Ø´ØªÛŒØ¨Ø§Ù† (${m}) Ù‚Ø¯ÛŒÙ…ÛŒâ€ŒØªØ± Ø§Ø² Ø¢Ø®Ø±ÛŒÙ† Ø¨Ø§Ø²ÛŒØ§Ø¨ÛŒ Ø´Ù…Ø§ (${C}) Ø§Ø³Øª.`,i.style.display="block"}const c=Object.keys(e.data.classrooms).length,u="Ú©Ù„Ø§Ø³";n.textContent=`ÙØ§ÛŒÙ„ Ù¾Ø´ØªÛŒØ¨Ø§Ù† Ø´Ù…Ø§ Ø­Ø§ÙˆÛŒ ${c} ${u} Ø§Ø³Øª. Ù„Ø·ÙØ§Ù‹ Ù†Ø­ÙˆÙ‡ Ø¨Ø§Ø²ÛŒØ§Ø¨ÛŒ Ø±Ø§ Ù…Ø´Ø®Øµ Ú©Ù†ÛŒØ¯.`,o.checked=!0;const f=()=>{const m=o.checked;cs(e,m),t.removeEventListener("click",f),P(),oe(),x("class-management-page"),b("âœ… Ø§Ø·Ù„Ø§Ø¹Ø§Øª Ø¨Ø§ Ù…ÙˆÙÙ‚ÛŒØª Ø¨Ø§Ø²ÛŒØ§Ø¨ÛŒ Ø´Ø¯.")},E=()=>{P()};s.onclick=f,a.onclick=E,Y("restore-confirm-modal")}function z(e,t,n={}){const{confirmText:o="ØªØ§ÛŒÛŒØ¯",cancelText:a="Ù„ØºÙˆ",confirmClass:s="btn-success",onCancel:i=()=>{},isDelete:l=!1}=n,c=l?()=>Fs(e,t):t;xs.textContent=e,ot.textContent=o,pn.textContent=a,ot.className="modal-action-btn",ot.classList.add(s),xn(c),Mn(i);const u=ot.parentElement;pn.style.display=i===null?"none":"inline-block",u.style.justifyContent=i===null?"center":"space-between",Y("custom-confirm-modal")}function Fs(e,t){const n=Math.floor(1e4+Math.random()*9e4).toString();Ms.textContent=e,$s.textContent=n,Ve.value="",Dt.disabled=!0,ft(t),Y("secure-confirm-modal"),Ve.focus();const o=()=>{Ve.value===n?Dt.disabled=!1:Dt.disabled=!0};return Ve.addEventListener("input",o),()=>{Ve.removeEventListener("input",o)}}function Cn(e,t={}){const{title:n="Ø§ÛŒØ¬Ø§Ø¯ Ø¯Ø³ØªÙ‡â€ŒØ¨Ù†Ø¯ÛŒ Ø¬Ø¯ÛŒØ¯",initialName:o="",initialIsGraded:a=!1,saveButtonText:s="Ø°Ø®ÛŒØ±Ù‡"}=t;Rs.textContent=n,rt.value=o,An.checked=a,Hs.textContent=s,Yt((i,l)=>{if(!i){b("âš ï¸ Ù„Ø·ÙØ§Ù‹ Ù†Ø§Ù… Ø¯Ø³ØªÙ‡â€ŒØ¨Ù†Ø¯ÛŒ Ø±Ø§ ÙˆØ§Ø±Ø¯ Ú©Ù†ÛŒØ¯.");return}e(i,l),P()}),Y("category-modal"),rt.focus(),o&&rt.select()}function Us(e,t){const n=Object.values(L).filter(i=>!i.isDeleted&&i.info.name!==t.info.name),o=document.getElementById("move-student-modal-title"),a=document.getElementById("move-student-class-select"),s=document.getElementById("move-student-confirm-btn");o.textContent=`Ø§Ù†ØªÙ‚Ø§Ù„ Ø¯Ø§Ù†Ø´â€ŒØ¢Ù…ÙˆØ²: ${e.identity.name}`,a.innerHTML="",n.length===0?(a.innerHTML='<option value="">Ú©Ù„Ø§Ø³ Ø¯ÛŒÚ¯Ø±ÛŒ Ø¨Ø±Ø§ÛŒ Ø§Ù†ØªÙ‚Ø§Ù„ ÙˆØ¬ÙˆØ¯ Ù†Ø¯Ø§Ø±Ø¯</option>',s.disabled=!0):(n.forEach(i=>{const l=document.createElement("option");l.value=i.info.name,l.textContent=i.info.name,a.appendChild(l)}),s.disabled=!1),Is(e),Ss(t),Y("move-student-modal")}function _n(e,t){if(!e||!t)return;const n=e.identity.name,o=document.getElementById("add-note-modal-title");o.textContent="ØªØºÛŒÛŒØ± Ù†Ø§Ù… Ø¯Ø§Ù†Ø´â€ŒØ¢Ù…ÙˆØ²",O.value=n,O.rows=1,O.dispatchEvent(new Event("input",{bubbles:!0})),be(a=>{const s=a.trim();s&&s!==n&&(U(t.students).some(l=>l.identity.studentId!==e.identity.studentId&&l.identity.name.toLowerCase()===s.toLowerCase())?b("Ø¯Ø§Ù†Ø´â€ŒØ¢Ù…ÙˆØ²ÛŒ Ø¨Ø§ Ø§ÛŒÙ† Ù†Ø§Ù… Ø§Ø² Ù‚Ø¨Ù„ Ø¯Ø± Ø§ÛŒÙ† Ú©Ù„Ø§Ø³ ÙˆØ¬ÙˆØ¯ Ø¯Ø§Ø±Ø¯."):(e.identity.name=s,W(t.info.name,`Ù†Ø§Ù… Ø¯Ø§Ù†Ø´â€ŒØ¢Ù…ÙˆØ² Â«${n}Â» Ø¨Ù‡ Â«${s}Â» ØªØºÛŒÛŒØ± ÛŒØ§ÙØª.`,{type:"VIEW_STUDENT_PROFILE",studentId:e.identity.studentId}),w(),ke(),X(),We(),ce(),_&&_.identity.studentId===e.identity.studentId&&Q(e),b(`âœ…Ù†Ø§Ù… Ø¯Ø§Ù†Ø´â€ŒØ¢Ù…ÙˆØ² Ø¨Ù‡ Â«${s}Â» ØªØºÛŒÛŒØ± ÛŒØ§ÙØª.`))),o.textContent="Ø«Ø¨Øª ÛŒØ§Ø¯Ø¯Ø§Ø´Øª Ø¬Ø¯ÛŒØ¯",O.rows=4}),Y("add-note-modal"),O.focus(),O.select()}function Y(e){const t=document.getElementById(e);if(t){if(De)return;document.body.classList.add("modal-active"),t.classList.add("modal-visible"),$n(e),history.pushState(null,"",location.href)}}function P(e,t=!1){if(!De)return;const n=document.getElementById(De),o=De;$n(null),o==="student-profile-modal"&&me(null),t||history.back(),n&&(n.classList.add("modal-closing"),setTimeout(()=>{n.classList.remove("modal-visible"),n.classList.remove("modal-closing"),document.body.classList.remove("modal-active"),o==="custom-confirm-modal"&&(xn(null),Mn(null)),o==="secure-confirm-modal"&&ft(null),o==="category-modal"&&Yt(null),o==="mass-comment-modal"&&(dt.value=""),o==="add-note-modal"&&be(null),typeof e=="function"&&e()},300))}function Pn(){if(!Xe||!Xe.classList.contains("active")){xt.style.display="none";return}const e=He.length;e<1?xt.style.display="none":xt.style.display="block",yn.disabled=e<1,yn.textContent=`ğŸ“ Ø«Ø¨Øª ÛŒØ§Ø¯Ø¯Ø§Ø´Øª Ú¯Ø±ÙˆÙ‡ÛŒ (${e} Ù†ÙØ±)`}function qs(){const e=He,t=e.length;let n=!1;t>0&&(n=e.some(a=>{var s;return(s=h.studentRecords[a])==null?void 0:s.homework.comment})),As.textContent=`ÛŒØ§Ø¯Ø¯Ø§Ø´Øª Ø¨Ø±Ø§ÛŒ ${t} Ø¯Ø§Ù†Ø´â€ŒØ¢Ù…ÙˆØ² Ø«Ø¨Øª Ø®ÙˆØ§Ù‡Ø¯ Ø´Ø¯.`,dt.value="",dt.dispatchEvent(new Event("input",{bubbles:!0})),Wn.checked=!0;const o=document.querySelector("#mass-comment-modal .modal-options");o.style.display=n?"flex":"none",Y("mass-comment-modal"),dt.focus()}function bn(e,t){if(!d||!h)return;let n=0;const o=He,a=h;o.forEach(s=>{const i=a.studentRecords[s];if(i&&i.homework){const l=i.homework.comment||"";let c=e;t&&l.length>0?c=l+`
---
`+e:c=e,i.homework.comment=c.trim();const u=d.students.find(f=>f.identity.studentId===s);u&&La(u,a,c.trim()),n++}}),Jt([]),w(),We(),W(d.info.name,`${n} Ø¯Ø§Ù†Ø´â€ŒØ¢Ù…ÙˆØ² Ø¨Ù‡ ØµÙˆØ±Øª Ú¯Ø±ÙˆÙ‡ÛŒ ÛŒØ§Ø¯Ø¯Ø§Ø´Øª ØªÚ©Ù„ÛŒÙ Ú¯Ø±ÙØªÙ†Ø¯.`,{type:"VIEW_SESSIONS"}),b(`âœ… ÛŒØ§Ø¯Ø¯Ø§Ø´Øª Ø¨Ø±Ø§ÛŒ ${n} Ø¯Ø§Ù†Ø´â€ŒØ¢Ù…ÙˆØ² Ø«Ø¨Øª Ø´Ø¯.`)}function La(e,t,n){const a=pe(d).get(t.sessionNumber),s={type:"fromAttendance",sessionNumber:t.sessionNumber},i=`ÛŒØ§Ø¯Ø¯Ø§Ø´Øª Ù…Ø±Ø¨ÙˆØ· Ø¨Ù‡ Ø¬Ù„Ø³Ù‡ ${a}: `,l=e.profile.notes.find(c=>!c.isDeleted&&c.source&&c.source.type==="fromAttendance"&&c.source.sessionNumber===s.sessionNumber);l?n?(l.content=i+n,l.isDeleted=!1):l.isDeleted=!0:n&&e.addNote(i+n,s)}function Fn(e){O.value=e.note||"",be(t=>{e.note=t,w(),W(e.info.name,"ÛŒØ§Ø¯Ø¯Ø§Ø´Øª Ú©Ù„Ø§Ø³ Ø°Ø®ÛŒØ±Ù‡ Ø´Ø¯.",{type:"VIEW_CLASS_NOTE"}),oe(),b("âœ… ÛŒØ§Ø¯Ø¯Ø§Ø´Øª Ú©Ù„Ø§Ø³ Ø°Ø®ÛŒØ±Ù‡ Ø´Ø¯.")}),Y("add-note-modal"),O.focus()}function Un(e){ne(e),Hn.textContent=`ØªÙ†Ø¸ÛŒÙ…Ø§Øª Ú©Ù„Ø§Ø³: ${e.info.name}`,ke(),Qe(),x("settings-page")}function Vs(e){const t=document.getElementById("log-modal-title"),n=document.getElementById("log-list");t.textContent=`Ú¯Ø²Ø§Ø±Ø´ ÙØ¹Ø§Ù„ÛŒØªâ€ŒÙ‡Ø§ÛŒ Ú©Ù„Ø§Ø³: ${e}`,n.innerHTML="";const o=Io(e);o.length===0?n.innerHTML='<li class="no-content-message">Ù‡Ù†ÙˆØ² ÙØ¹Ø§Ù„ÛŒØªÛŒ Ø¨Ø±Ø§ÛŒ Ø§ÛŒÙ† Ú©Ù„Ø§Ø³ Ø«Ø¨Øª Ù†Ø´Ø¯Ù‡ Ø§Ø³Øª.</li>':o.forEach(a=>{const s=document.createElement("li");s.className="log-entry";const i=new Date(a.timestamp),l=`${i.toLocaleDateString("fa-IR")} - ${i.toLocaleTimeString("fa-IR",{hour:"2-digit",minute:"2-digit"})}`,c=document.createElement("span");c.className="log-timestamp",c.textContent=l;const u=document.createElement("span");u.className="log-message",u.textContent=a.message,a.action&&(u.classList.add("log-action-link"),u.dataset.action=JSON.stringify({...a.action,classroomName:a.classroomName})),s.appendChild(c),s.appendChild(u),n.appendChild(s)}),Y("log-modal")}document.getElementById("log-modal-close-btn").addEventListener("click",()=>{P()});function vn(e){const t=URL.createObjectURL(e),n=document.createElement("a");n.href=t,n.download=e.name,document.body.appendChild(n),n.click(),document.body.removeChild(n),URL.revokeObjectURL(t)}async function ht(e=[]){const t=as(e);if(("ontouchstart"in window||navigator.maxTouchPoints>0)&&navigator.share&&navigator.canShare&&navigator.canShare({files:[t]}))try{await navigator.share({title:t.name,text:"ÙØ§ÛŒÙ„ Ù¾Ø´ØªÛŒØ¨Ø§Ù† Ø¯Ø§Ø¯Ù‡â€ŒÙ‡Ø§ÛŒ Ø¨Ø±Ù†Ø§Ù…Ù‡",files:[t]}),console.log("the code reached the change")}catch(o){o.name!=="AbortError"&&(console.error("Error sharing file:",o),vn(t),b("âš ï¸Ø§Ø´ØªØ±Ø§Ú©â€ŒÚ¯Ø°Ø§Ø±ÛŒ Ø¨Ø§ Ø®Ø·Ø§ Ù…ÙˆØ§Ø¬Ù‡ Ø´Ø¯. ÙØ§ÛŒÙ„ Ø¯Ø± Ø­Ø§Ù„ Ø¯Ø§Ù†Ù„ÙˆØ¯ Ø§Ø³Øª."))}else vn(t),b("âœ…Ù¾Ø´ØªÛŒØ¨Ø§Ù†â€ŒÚ¯ÛŒØ±ÛŒ Ø¨Ø§ Ù…ÙˆÙÙ‚ÛŒØª Ø§Ù†Ø¬Ø§Ù… Ø´Ø¯.")}function Ct(e,t){e.preventDefault(),$e(),Je=e.target.closest("li"),Je&&Je.classList.add("context-menu-target"),setTimeout(()=>{const n=Re,o=n.querySelector("ul");o.innerHTML="",t.forEach(u=>{const f=document.createElement("li");u.isSeparator?f.className="separator":(f.innerHTML=`
                    <span class="icon">${u.icon||""}</span>
                    <span class="label">${u.label}</span>
                `,u.className&&f.classList.add(u.className),f.addEventListener("click",()=>{u.action(),$e()})),o.appendChild(f)}),n.classList.add("visible");const{offsetWidth:a,offsetHeight:s}=n,{innerHeight:i}=window,l=document.body.getBoundingClientRect();n.style.top=`${(i-s)/2}px`;const c=l.left+l.width/2;n.style.left=`${c-a/2}px`},50)}function $e(){Re.classList.contains("visible")&&Re.classList.remove("visible"),Je&&(Je.classList.remove("context-menu-target"),Je=null)}function Gs(){var t,n;Ge.innerHTML="";const e=[];if(e.push({label:"Ú©Ù„Ø§Ø³â€ŒÙ‡Ø§",handler:()=>{ne(null),ue(null),me(null),x("class-management-page")}}),d){if(e.push({label:d.info.name,handler:()=>{ue(null),me(null),ae(),x("session-page")}}),((t=document.querySelector(".page.active"))==null?void 0:t.id)==="settings-page")e.push({label:"ØªÙ†Ø¸ÛŒÙ…Ø§Øª"});else if(h){const s=pe(d).get(h.sessionNumber)||` (#${h.sessionNumber})`;e.push({label:`Ø¬Ù„Ø³Ù‡ ${s}`,handler:()=>{me(null),x("student-page")}});const i=(n=document.querySelector(".page.active"))==null?void 0:n.id;_?e.push({label:`Ù¾Ø±ÙˆÙØ§ÛŒÙ„: ${_.identity.name}`}):i==="attendance-page"&&e.push({label:"Ø­Ø¶ÙˆØ± Ùˆ ØºÛŒØ§Ø¨"})}}if(e.length<=1){Ge.style.display="none";return}Ge.style.display="flex",e.forEach((o,a)=>{const s=document.createElement("a");if(s.textContent=o.label,s.className="breadcrumb-item",a===e.length-1||!o.handler?s.classList.add("active"):s.addEventListener("click",o.handler),Ge.appendChild(s),a<e.length-1){const i=document.createElement("span");i.className="breadcrumb-separator",i.textContent="/",Ge.appendChild(i)}})}function ts(e,t,n){n.innerHTML="";const o=d.sessions.filter(a=>{var s;return!a.isDeleted&&!a.isCancelled&&((s=a.studentRecords[e.identity.studentId])==null?void 0:s.attendance)==="absent"}).map(a=>({number:t.get(a.sessionNumber),isMakeup:a.isMakeup})).filter(a=>a.number!==void 0);o.length>0?(n.appendChild(document.createTextNode("Ø¬Ù„Ø³Ø§Øª ØºØ§ÛŒØ¨: ")),o.forEach((a,s)=>{const i=document.createElement("span");i.textContent=a.number,a.isMakeup&&i.classList.add("makeup-absence"),n.appendChild(i),s<o.length-1&&n.appendChild(document.createTextNode("ØŒ "))})):n.textContent="Ø¬Ù„Ø³Ø§Øª ØºØ§ÛŒØ¨: Ø¨Ø¯ÙˆÙ† ØºÛŒØ¨Øª"}function Mt(e,t,n,o={}){const{includePrefix:a=!0}=o;n.innerHTML="";const s=d.sessions.filter(i=>{if(i.isDeleted||i.isCancelled)return!1;const l=i.studentRecords[e.identity.studentId];return l&&l.homework&&(l.homework.status==="incomplete"||l.homework.status==="none")}).map(i=>({number:t.get(i.sessionNumber),status:i.studentRecords[e.identity.studentId].homework.status})).filter(i=>i.number!==void 0);s.length>0?(a&&n.appendChild(document.createTextNode("ØªÚ©Ø§Ù„ÛŒÙ Ù†Ø§Ù‚Øµ: ")),s.forEach((i,l)=>{const c=document.createElement("span");c.textContent=i.number,i.status==="incomplete"&&c.classList.add("incomplete-homework"),n.appendChild(c),l<s.length-1&&n.appendChild(document.createTextNode("ØŒ"))})):a?n.textContent="ØªÚ©Ø§Ù„ÛŒÙ Ù†Ø§Ù‚Øµ: Ù†Ø¯Ø§Ø±Ø¯":n.textContent="Ù†Ø¯Ø§Ø±Ø¯"}function wa(e,t){var V,G,ee;const n=document.createElement("li");n.className="attendance-list-item";const o=document.createElement("input");o.type="checkbox",o.className="mass-comment-checkbox",o.checked=He.includes(e.identity.studentId),o.addEventListener("change",()=>{const $=e.identity.studentId,B=He;if(o.checked)B.includes($)||B.push($);else{const R=B.indexOf($);R>-1&&B.splice(R,1)}Pn()}),n.appendChild(o);const a={none:"Ø¨Ø¯ÙˆÙ† ØªÚ©Ù„ÛŒÙ",complete:"ØªÚ©Ù„ÛŒÙ Ú©Ø§Ù…Ù„",incomplete:"ØªÚ©Ù„ÛŒÙ Ù†Ø§Ù‚Øµ"},s=document.createElement("div");s.className="student-info";const i=document.createElement("span");i.className="student-name",i.textContent=e.identity.name,i.addEventListener("click",()=>{Q(e)});const l=document.createElement("span");l.className="absence-info";const c=document.createElement("span");c.className="homework-info",ts(e,t,l),Mt(e,t,c),s.appendChild(i),s.appendChild(l),s.appendChild(c);const u=document.createElement("div");u.className="homework-controls";const f=document.createElement("button"),E=((V=h.studentRecords[e.identity.studentId])==null?void 0:V.homework.status)||"none";f.className=`homework-status-btn ${E}`,f.title=a[E],f.addEventListener("click",()=>{const $=h.studentRecords[e.identity.studentId].homework,R={none:"incomplete",incomplete:"complete",complete:"none"}[$.status];f.title=a[R],h.setHomeworkStatus(e.identity.studentId,R),w(),f.className=`homework-status-btn ${R}`,Mt(e,t,c)});const m=document.createElement("button");m.className="btn-icon",m.innerHTML="ğŸ“",m.title="Ø§ÙØ²ÙˆØ¯Ù† ÛŒØ§Ø¯Ø¯Ø§Ø´Øª Ø¨Ø±Ø§ÛŒ ØªÚ©Ù„ÛŒÙ",((G=h.studentRecords[e.identity.studentId])==null?void 0:G.homework.comment)||(m.style.opacity="0.3"),m.addEventListener("click",()=>{const $=h.studentRecords[e.identity.studentId].homework;O.value=$.comment||"",O.dispatchEvent(new Event("input",{bubbles:!0})),be(B=>{$.comment=B;const R=pe(d),ie=R.get(h.sessionNumber),le={type:"fromAttendance",sessionNumber:h.sessionNumber},K=`ÛŒØ§Ø¯Ø¯Ø§Ø´Øª Ù…Ø±Ø¨ÙˆØ· Ø¨Ù‡ Ø¬Ù„Ø³Ù‡ ${ie}: `,se=e.profile.notes.find(re=>!re.isDeleted&&re.source&&re.source.type==="fromAttendance"&&re.source.sessionNumber===le.sessionNumber);se?B?se.content=K+B:se.isDeleted=!0:B&&e.addNote(K+B,le),w(),W(d.info.name,`ÛŒØ§Ø¯Ø¯Ø§Ø´Øª ØªÚ©Ù„ÛŒÙ Ø¬Ù„Ø³Ù‡ ${ie} Ø¨Ø±Ø§ÛŒ Ø¯Ø§Ù†Ø´â€ŒØ¢Ù…ÙˆØ² Â«${e.identity.name}Â» Ø°Ø®ÛŒØ±Ù‡ Ø´Ø¯.`,{type:"VIEW_STUDENT_PROFILE",studentId:e.identity.studentId}),b("âœ…ÛŒØ§Ø¯Ø¯Ø§Ø´Øª ØªÚ©Ù„ÛŒÙ Ø°Ø®ÛŒØ±Ù‡ Ø´Ø¯."),m.style.opacity=B?"1":"0.3",Mt(e,R,c)}),Y("add-note-modal"),O.focus()}),u.appendChild(f),u.appendChild(m);const v=document.createElement("button"),k=((ee=h.studentRecords[e.identity.studentId])==null?void 0:ee.attendance)||"present",N=$=>{$==="present"?(v.textContent="Ø­Ø§Ø¶Ø±",v.className="attendance-status-btn present active"):(v.textContent="ØºØ§ÛŒØ¨",v.className="attendance-status-btn absent active")};return N(k),v.addEventListener("click",()=>{var R;const B=(((R=h.studentRecords[e.identity.studentId])==null?void 0:R.attendance)||"present")==="present"?"absent":"present";h.setAttendance(e.identity.studentId,B),B==="absent"&&(h.studentRecords[e.identity.studentId].hadIssue=!1),w(),N(B),ts(e,t,l),X(),Ys()}),n.appendChild(s),n.appendChild(u),n.appendChild(v),n}function ka(){return pe(d).get(h.sessionNumber)}function We(){if(!d||!h)return;U(d.students).forEach(a=>{h.initializeStudentRecord(a.identity.studentId)}),Jt([]);const e=pe(d);Aa(),ct.innerHTML="";const t=document.createElement("li");t.className="attendance-list-header",Me.id="attendance-search-input",Me.type="text",Me.className="inline-search-input",Me.placeholder="Ø¬Ø³ØªØ¬Ùˆ...",Me.value="";const n=document.createElement("div");n.className="student-search-container",n.appendChild(Me);const o=document.createElement("div");o.className="header-labels-container",o.innerHTML=`
    <span class="header-label">ØªÚ©Ù„ÛŒÙ</span>
    <span class="header-label">Ø­Ø¶ÙˆØ±</span>
`,t.appendChild(n),t.appendChild(o),ct.appendChild(t),U(d.students).forEach(a=>{const s=wa(a,e);ct.appendChild(s)}),Jt([]),Pn(),Wa(),Ys()}function X(){const e=document.getElementById("student-stats-table-container");if(!e||(e.innerHTML="",!d))return;U(d.students).length,fn.textContent="Ø¢Ù…Ø§Ø± Ø¹Ù…Ù„Ú©Ø±Ø¯";const t=["Ù†Ø§Ù…"],n=["Ú©Ù„ Ø§Ù†ØªØ®Ø§Ø¨ Ù‡Ø§","ØºÛŒØ¨Øª","Ø®Ø±ÙˆØ¬","ÙØ±ØµØª Ø§Ø²Ø¯Ø³Øªâ€ŒØ±ÙØªÙ‡","Ù…Ø´Ú©Ù„","Ù…ÛŒØ§Ù†Ú¯ÛŒÙ†","Ù†Ù…Ø±Ù‡ Ú©Ù„Ø§Ø³ÛŒ (Ú©Ø§Ù†ÙˆÙ†)"],o=d.categories.filter(C=>C.isGradedCategory&&!C.isDeleted).map(C=>C.name),a=[...t,...o,...n],s=document.createElement("table");s.className="student-stats-table";const l=s.createTHead().insertRow();a.forEach((C,v)=>{const k=document.createElement("th");v===0?(k.innerHTML=`${C} <span style="opacity: 0.6;">ğŸ”—</span>`,k.title="Ø±Ø¯ÛŒÙâ€ŒÙ‡Ø§ÛŒ Ø§ÛŒÙ† Ø³ØªÙˆÙ† Ù‚Ø§Ø¨Ù„ Ú©Ù„ÛŒÚ© Ù‡Ø³ØªÙ†Ø¯"):k.textContent=C,l.appendChild(k)});const c=s.createTBody(),u=U(d.students),f=C=>{let v=0;return d.sessions.forEach(k=>{if(k.isDeleted||k.isCancelled)return;const N=k.studentRecords[C.identity.studentId];N&&N.attendance==="absent"&&v++}),v};u.forEach(C=>{const v=c.insertRow();if(v.dataset.studentId=C.identity.studentId,h){const $=h.studentRecords[C.identity.studentId];$&&$.attendance==="absent"&&v.classList.add("absent-row-highlight")}const k=v.insertCell(),N=document.createElement("span");N.textContent=C.identity.name,N.className="student-name-link",N.addEventListener("click",()=>{Q(C)}),k.appendChild(N),o.forEach($=>{var le;const B=v.insertCell(),R=$.toLowerCase(),ie=((le=C.logs.scores[R])==null?void 0:le.filter(K=>!K.isDeleted))||[];ie.length>0?ie.forEach((K,se)=>{const re=document.createElement("span");re.textContent=K.value,re.style.position="relative",K.comment&&(re.dataset.tooltip=K.comment),B.appendChild(re),se<ie.length-1&&B.appendChild(document.createTextNode(","))}):B.textContent="",B.style.cursor="pointer",B.addEventListener("click",()=>{ce(C,$);const K=document.getElementById("category-selection-container");K&&K.scrollIntoView({behavior:"smooth",block:"center"})})}),v.insertCell().textContent=C.statusCounters.totalSelections||0,v.insertCell().textContent=f(C),v.insertCell().textContent=C.statusCounters.outOfClassCount||0,v.insertCell().textContent=C.statusCounters.missedChances||0;const V=Object.values(C.categoryIssues||{}).reduce(($,B)=>$+B,0);v.insertCell().textContent=V;const G=C.getOverallAverageScore();v.insertCell().textContent=G!==null?G:"-";const ee=d.calculateFinalStudentScore(C);v.insertCell().textContent=ee!==null?ee:"-"}),U(d.students),fn.setAttribute("data-student-count",u.length),e.appendChild(s);const E=e.querySelector(".student-stats-table"),m=E==null?void 0:E.querySelector("thead th:first-child");m&&m.addEventListener("click",()=>{E.classList.toggle("name-column-expanded")})}function ce(e=null,t=null){const n=document.getElementById("selected-student-result");n.innerHTML="",n.classList.remove("absent");let o,a;if(e&&t)o=e,a=t,jt({student:e,categoryName:t}),Te(-1);else{if(jt(null),!h||ge<0||!h.winnerHistory[ge])return;const H=h.winnerHistory[ge];o=H.winner,a=H.categoryName}const s=document.querySelector(".current-winner-highlight");if(s&&s.classList.remove("current-winner-highlight"),o){const H=document.querySelector(`.student-stats-table tr[data-student-id="${o.identity.studentId}"]`);H&&H.classList.add("current-winner-highlight")}const i=d.categories.find(H=>H.name===a);if(i){Gt(i),qn(i);const H=document.querySelectorAll("#category-selection-container .pill");H.forEach(J=>J.classList.remove("active"));const j=Array.from(H).find(J=>J.textContent===a);j&&j.classList.add("active"),En(i)}const l=h.studentRecords[o.identity.studentId],c=(l==null?void 0:l.attendance)==="absent",u=document.createElement("div");u.className="winner-name-container";const f=document.createElement("button");f.className="btn-icon",f.innerHTML="Ë…",f.title="Ø¨Ø±Ù†Ø¯Ù‡ Ù‚Ø¨Ù„ÛŒ";const E=!e;f.classList.toggle("is-disabled",!E||ge<=0),f.addEventListener("click",()=>{f.classList.contains("is-disabled")?(f.classList.add("shake-animation"),setTimeout(()=>f.classList.remove("shake-animation"),200)):(Te(ge-1),ce())});const m=document.createElement("div");m.className="winner-name",m.innerHTML=`âœ¨ <strong>${o.identity.name}</strong>âœ¨`,m.classList.add("heartbeat-animation"),c&&(m.style.textDecoration="line-through",m.style.opacity="0.6",m.style.color="var(--color-secondary)"),(l==null?void 0:l.hadIssue)&&!c&&(m.style.color="var(--color-warning)",m.title="Ø§ÛŒÙ† Ø¯Ø§Ù†Ø´â€ŒØ¢Ù…ÙˆØ² Ø¯Ø± Ø§Ù†ØªØ®Ø§Ø¨ Ù‚Ø¨Ù„ÛŒ Ø¨Ø§ Ù…Ø´Ú©Ù„ Ù…ÙˆØ§Ø¬Ù‡ Ø´Ø¯Ù‡ Ø¨ÙˆØ¯"),(l==null?void 0:l.wasOutOfClass)&&!c&&(m.style.color="var(--color-strong-warning)",m.title="Ø§ÛŒÙ† Ø¯Ø§Ù†Ø´â€ŒØ¢Ù…ÙˆØ² Ø¯Ø± Ø²Ù…Ø§Ù† Ø§Ù†ØªØ®Ø§Ø¨ Ø®Ø§Ø±Ø¬ Ø§Ø² Ú©Ù„Ø§Ø³ Ø¨ÙˆØ¯");const k=1e3,N=H=>{nt=setTimeout(()=>{Fa(o,a),nt=null},k)},V=()=>{nt&&(clearTimeout(nt),nt=null)};m.addEventListener("mousedown",N),m.addEventListener("mouseup",V),m.addEventListener("mouseout",V),m.addEventListener("touchstart",N),m.addEventListener("touchmove",V),m.addEventListener("touchend",V),m.addEventListener("touchcancel",V);const G=document.createElement("button");if(G.className="btn-icon",G.innerHTML="Ë„",G.title="Ø¨Ø±Ù†Ø¯Ù‡ Ø¨Ø¹Ø¯ÛŒ",G.classList.toggle("is-disabled",!E||ge>=h.winnerHistory.length-1),G.addEventListener("click",()=>{G.classList.contains("is-disabled")?(G.classList.add("shake-animation"),setTimeout(()=>G.classList.remove("shake-animation"),200)):(Te(ge+1),ce())}),u.appendChild(G),u.appendChild(m),o.onboardingSession===h.sessionNumber){const H=document.createElement("div");H.className="new-student-badge",H.textContent="Ø¯Ø§Ù†Ø´ Ø¢Ù…ÙˆØ² Ø¬Ø¯ÛŒØ¯",u.appendChild(H)}u.appendChild(f),n.appendChild(u),Ce.disabled=E&&!G.classList.contains("is-disabled");const ee=document.createElement("div");ee.className="status-button-container";const $=document.createElement("button");$.textContent="ØºØ§ÛŒØ¨",$.classList.add("status-button","absent-btn"),c&&$.classList.add("active");const B=document.createElement("button");B.textContent="Ù…Ø´Ú©Ù„",B.classList.add("status-button","issue-btn"),l!=null&&l.hadIssue&&B.classList.add("active");const R=document.createElement("button");R.textContent="Ø®Ø±ÙˆØ¬",R.classList.add("status-button","exit-btn"),l!=null&&l.wasOutOfClass&&R.classList.add("active");const ie=document.createElement("button");ie.textContent="Ù¾Ø±ÙˆÙØ§ÛŒÙ„",ie.className="status-button profile-btn",h.isFinished?$.disabled=!0:$.addEventListener("click",()=>{const H=$.classList.contains("active");R.classList.contains("active")&&(R.classList.remove("active"),l.wasOutOfClass=!1,o.statusCounters.outOfClassCount=Math.max(0,(o.statusCounters.outOfClassCount||0)-1),o.statusCounters.missedChances=Math.max(0,o.statusCounters.missedChances-1)),H?($.classList.remove("active"),h.setAttendance(o.identity.studentId,"present"),o.statusCounters.missedChances=Math.max(0,o.statusCounters.missedChances-1),m.style.textDecoration="",m.style.opacity="",m.style.color=""):(B.classList.contains("active")&&(B.classList.remove("active"),l.hadIssue=!1,o.statusCounters.otherIssues=Math.max(0,o.statusCounters.otherIssues-1),o.statusCounters.missedChances=Math.max(0,o.statusCounters.missedChances-1)),$.classList.add("active"),h.setAttendance(o.identity.studentId,"absent"),o.statusCounters.missedChances++,m.style.textDecoration="line-through",m.style.opacity="0.6",m.style.color="var(--color-secondary)",m.title=""),X(),w()}),h.isFinished?B.disabled=!0:B.addEventListener("click",()=>{const H=B.classList.contains("active");if(R.classList.contains("active")&&(R.classList.remove("active"),l.wasOutOfClass=!1,o.statusCounters.outOfClassCount=Math.max(0,(o.statusCounters.outOfClassCount||0)-1),o.statusCounters.missedChances=Math.max(0,o.statusCounters.missedChances-1)),H){B.classList.remove("active"),l.hadIssue=!1;const j=de.name;o.categoryIssues[j]&&(o.categoryIssues[j]=Math.max(0,o.categoryIssues[j]-1)),o.statusCounters.missedChances=Math.max(0,o.statusCounters.missedChances-1),m.style.color="",m.title=""}else{$.classList.contains("active")&&($.classList.remove("active"),h.setAttendance(o.identity.studentId,"present"),o.statusCounters.missedChances=Math.max(0,o.statusCounters.missedChances-1)),B.classList.add("active"),l.hadIssue=!0;const j=de.name;o.categoryIssues[j]=(o.categoryIssues[j]||0)+1,o.statusCounters.missedChances++,m.style.textDecoration="",m.style.opacity="",m.style.color="var(--color-warning)",m.title="Ø§ÛŒÙ† Ø¯Ø§Ù†Ø´â€ŒØ¢Ù…ÙˆØ² Ø¯Ø± Ø§Ù†ØªØ®Ø§Ø¨ Ù‚Ø¨Ù„ÛŒ Ø¨Ø§ Ù…Ø´Ú©Ù„ Ù…ÙˆØ§Ø¬Ù‡ Ø´Ø¯Ù‡ Ø¨ÙˆØ¯"}X(),w()}),h.isFinished?R.disabled=!0:R.addEventListener("click",()=>{if(R.classList.contains("active"))R.classList.remove("active"),l.wasOutOfClass=!1,m.style.color="",m.title="";else{if($.classList.contains("active")&&($.classList.remove("active"),h.setAttendance(o.identity.studentId,"present"),o.statusCounters.missedChances=Math.max(0,o.statusCounters.missedChances-1)),B.classList.contains("active")){B.classList.remove("active"),l.hadIssue=!1;const j=de.name;o.categoryIssues[j]&&(o.categoryIssues[j]=Math.max(0,o.categoryIssues[j]-1)),o.statusCounters.missedChances=Math.max(0,o.statusCounters.missedChances-1)}R.classList.add("active"),l.wasOutOfClass=!0,m.style.textDecoration="",m.style.opacity="",m.style.color="var(--color-strong-warning)",m.title="Ø§ÛŒÙ† Ø¯Ø§Ù†Ø´â€ŒØ¢Ù…ÙˆØ² Ø¯Ø± Ø²Ù…Ø§Ù† Ø§Ù†ØªØ®Ø§Ø¨ Ø®Ø§Ø±Ø¬ Ø§Ø² Ú©Ù„Ø§Ø³ Ø¨ÙˆØ¯"}X(),w()}),h.isFinished?ie.disabled=!0:ie.addEventListener("click",()=>{Q(o)}),ee.appendChild($),ee.appendChild(R),ee.appendChild(B),ee.appendChild(ie),n.appendChild(ee);const le=document.createElement("div");le.className="student-details-container";const K=document.createElement("div");K.className="student-details-scores",K.innerHTML="<h4>Ø¢Ø®Ø±ÛŒÙ† Ù†Ù…Ø±Ø§Øª</h4>";const se=document.createElement("ul");se.className="scores-list";const re=["Reading","Writing","Speaking","Listening"];let bt=!1;const Ye=o.logs.scores||{};re.forEach(H=>{var It;const j=document.createElement("li"),J=document.createElement("span");J.className="skill-name",J.textContent=`${H}:`;const Ue=document.createElement("span");Ue.className="skill-scores";const Et=H.toLowerCase(),Ze=(It=Ye[Et])==null?void 0:It.filter(et=>!et.isDeleted);Ze&&Ze.length>0?(bt=!0,Ue.textContent=Ze.slice(-3).map(et=>et.value).join(",")):Ue.textContent="none",j.appendChild(J),j.appendChild(Ue),se.appendChild(j)}),!bt&&Object.keys(Ye).length===0&&(se.innerHTML='<div class="no-content-message">Ù‡Ù†ÙˆØ² Ù†Ù…Ø±Ù‡â€ŒØ§ÛŒ Ø«Ø¨Øª Ù†Ø´Ø¯Ù‡ Ø§Ø³Øª.</div>'),K.appendChild(se),le.appendChild(K);const _e=document.createElement("div");_e.className="student-details-notes";const Pe=document.createElement("div");Pe.className="history-section-header";const vt=document.createElement("h4");vt.textContent="ÛŒØ§Ø¯Ø¯Ø§Ø´Øªâ€ŒÙ‡Ø§";const Ne=document.createElement("button");Ne.className="btn-icon",Ne.innerHTML="ğŸ“",Ne.title="Ø§ÙØ²ÙˆØ¯Ù† ÛŒØ§Ø¯Ø¯Ø§Ø´Øª Ø¬Ø¯ÛŒØ¯",h.isFinished?Ne.disabled=!0:Ne.addEventListener("click",()=>{O.value="",O.dispatchEvent(new Event("input",{bubbles:!0})),be(H=>{H&&(o.addNote(H),w(),ce(),b("âœ… ÛŒØ§Ø¯Ø¯Ø§Ø´Øª Ø¨Ø§ Ù…ÙˆÙÙ‚ÛŒØª Ø«Ø¨Øª Ø´Ø¯."))}),Y("add-note-modal"),O.focus()}),Pe.appendChild(vt),Pe.appendChild(Ne),_e.appendChild(Pe);const Fe=document.createElement("ul");Fe.className="notes-list",o.profile.notes&&o.profile.notes.length>0?[...o.profile.notes].sort((j,J)=>new Date(J.timestamp)-new Date(j.timestamp)).forEach(j=>{const J=document.createElement("li");J.dir=On(j.content),J.textContent=j.content,Fe.appendChild(J)}):Fe.innerHTML='<div class="no-content-message">ÛŒØ§Ø¯Ø¯Ø§Ø´ØªÛŒ ÙˆØ¬ÙˆØ¯ Ù†Ø¯Ø§Ø±Ø¯.</div>',_e.appendChild(Fe),le.appendChild(_e),n.appendChild(le)}function js(e){e.addEventListener("input",()=>{const t=e.value,n=On(t);e.setAttribute("dir",n)})}function Na(){qn(null),lt.innerHTML="",hn.innerHTML="",je.classList.add("tooltip-container"),Ie.disabled=!0,he.disabled=!0,Oe.disabled=!0,Ie.value="",he.value="",Ke.classList.add("disabled-wrapper"),Ce.disabled=!0}function $t(){lt.innerHTML="",d.categories.filter(n=>!n.isDeleted).forEach(n=>{const o=document.createElement("span");o.className="pill",o.textContent=n.name,o.dataset.categoryId=n.id,n.description&&(o.dataset.tooltip=n.description),h.isFinished?o.classList.add("disabled"):o.addEventListener("click",()=>{document.querySelectorAll("#category-selection-container .pill").forEach(s=>s.classList.remove("active")),o.classList.add("active"),Gt(n),qn(n),En(n),Ke.classList.remove("disabled-wrapper"),Ce.disabled=h.isFinished;const a=h.lastWinnerByCategory[n.name];if(a){const s=d.students.find(i=>i.identity.studentId===a);s&&ce(s,n.name)}else{hn.innerHTML="",jt(null),Te(-1),Ce.disabled=!1;const s=document.querySelector(".current-winner-highlight");s&&s.classList.remove("current-winner-highlight")}}),h.isFinished||o.addEventListener("contextmenu",a=>{Ct(a,[{label:"ØªØºÛŒÛŒØ± Ù†Ø§Ù…",icon:"âœï¸",action:()=>{Cn((i,l)=>{const c=rs(d,n,i);c.success?(n.isGradedCategory=l,w(),W(d.info.name,`Ù†Ø§Ù… Ø¯Ø³ØªÙ‡â€ŒØ¨Ù†Ø¯ÛŒ Â«${n.name}Â» Ø¨Ù‡ Â«${i}Â» ØªØºÛŒÛŒØ± ÛŒØ§ÙØª.`),$t(),X(),b(`âœ… Ù†Ø§Ù… Ø¯Ø³ØªÙ‡â€ŒØ¨Ù†Ø¯ÛŒ Ø¨Ù‡ Â«${i}Â» ØªØºÛŒÛŒØ± ÛŒØ§ÙØª.`)):b(`âš ï¸ ${c.message}`)},{title:"ÙˆÛŒØ±Ø§ÛŒØ´ Ø¯Ø³ØªÙ‡â€ŒØ¨Ù†Ø¯ÛŒ",initialName:n.name,initialIsGraded:n.isGradedCategory,saveButtonText:"Ø°Ø®ÛŒØ±Ù‡ ØªØºÛŒÛŒØ±Ø§Øª"})}},{label:"Ø­Ø°Ù Ø¯Ø³ØªÙ‡â€ŒØ¨Ù†Ø¯ÛŒ",icon:"ğŸ—‘ï¸",className:"danger",action:()=>{z(`Ø¢ÛŒØ§ Ø§Ø² Ø§Ù†ØªÙ‚Ø§Ù„ Ø¯Ø³ØªÙ‡â€ŒØ¨Ù†Ø¯ÛŒ Â«${n.name}Â» Ø¨Ù‡ Ø³Ø·Ù„ Ø²Ø¨Ø§Ù„Ù‡ Ù…Ø·Ù…Ø¦Ù† Ù‡Ø³ØªÛŒØ¯ØŸ`,()=>{const i={id:`trash_${Date.now()}_${Math.random()}`,timestamp:new Date().toISOString(),type:"category",description:`Ø¯Ø³ØªÙ‡â€ŒØ¨Ù†Ø¯ÛŒ Â«${n.name}Â» Ø§Ø² Ú©Ù„Ø§Ø³ Â«${d.info.name}Â»`,restoreData:{categoryId:n.id,classId:d.info.scheduleCode}};M.unshift(i),M.length>50&&M.pop();const l=n.name.toLowerCase();if(d.students.forEach(c=>{c.logs.scores&&c.logs.scores[l]&&c.logs.scores[l].forEach(u=>{u.isDeleted=!0})}),de&&de.id===n.id){Gt(null),hn.innerHTML="",En(null),Ke.classList.add("disabled-wrapper"),Ce.disabled=!0;const c=document.querySelector(".current-winner-highlight");c&&c.classList.remove("current-winner-highlight")}n.isDeleted=!0,W(d.info.name,`Ø¯Ø³ØªÙ‡â€ŒØ¨Ù†Ø¯ÛŒ Â«${n.name}Â» Ø¨Ù‡ Ø³Ø·Ù„ Ø²Ø¨Ø§Ù„Ù‡ Ù…Ù†ØªÙ‚Ù„ Ø´Ø¯.`,{type:"VIEW_TRASH"}),w(),$t(),X(),b(`âœ… Ø¯Ø³ØªÙ‡â€ŒØ¨Ù†Ø¯ÛŒ Â«${n.name}Â» Ø¨Ù‡ Ø³Ø·Ù„ Ø²Ø¨Ø§Ù„Ù‡ Ù…Ù†ØªÙ‚Ù„ Ø´Ø¯.`)},{confirmText:"Ø¨Ù„Ù‡",confirmClass:"btn-warning"})}}])}),lt.appendChild(o)});const t=document.createElement("span");t.className="pill add-category-pill",t.textContent="+",t.title="Ø§ÙØ²ÙˆØ¯Ù† Ø¯Ø³ØªÙ‡â€ŒØ¨Ù†Ø¯ÛŒ Ø¬Ø¯ÛŒØ¯",h.isFinished?t.classList.add("disabled"):t.addEventListener("click",()=>{Cn((n,o)=>{if(d.categories.find(i=>i.name.toLowerCase()===n.toLowerCase()&&!i.isDeleted)){b("âš ï¸ Ø§ÛŒÙ† Ø¯Ø³ØªÙ‡â€ŒØ¨Ù†Ø¯ÛŒ Ø§Ø² Ù‚Ø¨Ù„ ÙˆØ¬ÙˆØ¯ Ø¯Ø§Ø±Ø¯.");return}const s=new we(n,"",o);d.categories.push(s),w(),W(d.info.name,`Ø¯Ø³ØªÙ‡â€ŒØ¨Ù†Ø¯ÛŒ Ø¬Ø¯ÛŒØ¯ Â«${n}Â» Ø§Ø¶Ø§ÙÙ‡ Ø´Ø¯.`,{type:"VIEW_CLASS_SETTINGS"}),$t(),b(`âœ… Ø¯Ø³ØªÙ‡â€ŒØ¨Ù†Ø¯ÛŒ Â«${n}Â» Ø§Ø¶Ø§ÙÙ‡ Ø´Ø¯.`)})}),lt.appendChild(t)}function Ba(){if(h.lastUsedCategoryId){if(h.isFinished)return;const e=lt.querySelector(`.pill[data-category-id="${h.lastUsedCategoryId}"]`);e&&e.click()}h.winnerHistory&&h.winnerHistory.length>0&&(Te(h.winnerHistory.length-1),ce())}function qn(e){e?Ce.textContent=`Ù†ÙØ± Ø¨Ø¹Ø¯ÛŒ Ø¯Ø± ${e.name}`:Ce.textContent="Ù†ÙØ± Ø¨Ø¹Ø¯ÛŒ"}function En(e){if(h.isFinished){Ie.disabled=!0,he.disabled=!0,Oe.disabled=!0,je.setAttribute("title","Ø¬Ù„Ø³Ù‡ Ø®Ø§ØªÙ…Ù‡ ÛŒØ§ÙØªÙ‡ Ø§Ø³Øª");return}e&&e.isGradedCategory?(Ie.disabled=!1,he.disabled=!1,Oe.disabled=!1,je.removeAttribute("title")):(Ie.disabled=!0,he.disabled=!0,Oe.disabled=!0,e?je.setAttribute("title","Ø¨Ø±Ø§ÛŒ Ø§ÛŒÙ† Ø¯Ø³ØªÙ‡â€ŒØ¨Ù†Ø¯ÛŒ Ù‚Ø§Ø¨Ù„ÛŒØª Ù†Ù…Ø±Ù‡ Ø¯Ù‡ÛŒ ØªØ¹Ø±ÛŒÙ Ù†Ø´Ø¯Ù‡ Ø§Ø³Øª"):je.setAttribute("title","Ø§Ø¨ØªØ¯Ø§ ÛŒÚ© Ø¯Ø³ØªÙ‡â€ŒØ¨Ù†Ø¯ÛŒ Ø±Ø§ Ø§Ù†ØªØ®Ø§Ø¨ Ú©Ù†ÛŒØ¯"))}function Q(e){me(e);const t=document.getElementById("student-profile-modal"),n=document.getElementById("modal-profile-student-name"),o=document.getElementById("modal-profile-content-container"),a=document.getElementById("modal-profile-close-btn");!t||!n||!o||!a||(n.textContent=`Ù¾Ø±ÙˆÙØ§ÛŒÙ„: ${e.identity.name}`,n.style.cursor="pointer",n.onclick=()=>{const s=_,i=d;P(()=>{_n(s,i)})},o.innerHTML="",Da(o),zs(o),a.onclick=()=>P(),Y("student-profile-modal"))}function Da(e){if(!_||!d)return;const t=document.createElement("div");t.className="scoring-section",t.innerHTML=`
        <h3>Ø«Ø¨Øª Ù†Ù…Ø±Ù‡ Ø¬Ø¯ÛŒØ¯</h3>
        <div id="modal-graded-pills" class="category-pills"></div>
        <div class="input-group centered-input-group" style="margin-top: 15px;">
            <input type="number" id="modal-new-score-value" placeholder="Ù†Ù…Ø±Ù‡ (Ù…Ø«Ù„Ø§: 85)">
        </div>
        <textarea id="modal-new-score-comment" placeholder="ØªÙˆØ¶ÛŒØ­Ø§Øª Ø§ÛŒÙ† Ù†Ù…Ø±Ù‡ (Ø§Ø®ØªÛŒØ§Ø±ÛŒ)..." style="margin-top: 10px;"></textarea>
        <button id="modal-add-score-btn" class="btn-success" style="width: 100%; margin-top: 10px;">Ø«Ø¨Øª Ù†Ù…Ø±Ù‡</button>
    `;const n=t.querySelector("#modal-graded-pills");U(d.categories).filter(s=>s.isGradedCategory).forEach(s=>{const i=document.createElement("span");i.className="pill",i.textContent=s.name,i.dataset.skillName=s.name,i.addEventListener("click",()=>{n.querySelectorAll(".pill").forEach(l=>l.classList.remove("active")),i.classList.add("active")}),n.appendChild(i)}),t.querySelector("#modal-add-score-btn").addEventListener("click",()=>{const s=n.querySelector(".pill.active");if(!s){b("âš ï¸Ù„Ø·ÙØ§Ù‹ ÛŒÚ© Ù…Ù‡Ø§Ø±Øª Ø±Ø§ Ø¨Ø±Ø§ÛŒ Ù†Ù…Ø±Ù‡â€ŒØ¯Ù‡ÛŒ Ø§Ù†ØªØ®Ø§Ø¨ Ú©Ù†ÛŒØ¯.");return}const i=s.dataset.skillName,l=t.querySelector("#modal-new-score-value"),c=t.querySelector("#modal-new-score-comment"),u=l.value,f=c.value.trim();if(!u){b("Ù„Ø·ÙØ§Ù‹ Ù…Ù‚Ø¯Ø§Ø± Ù†Ù…Ø±Ù‡ Ø±Ø§ ÙˆØ§Ø±Ø¯ Ú©Ù†ÛŒØ¯.");return}_.addScore(i,parseFloat(u),f),w(),W(d.info.name,`Ù†Ù…Ø±Ù‡ ${u} Ø¯Ø± ${i} Ø¨Ø±Ø§ÛŒ Â«${_.identity.name}Â» Ø«Ø¨Øª Ø´Ø¯.`,{type:"VIEW_STUDENT_PROFILE",studentId:_.identity.studentId}),X(),ce(),l.value="",c.value="";const E=document.getElementById("modal-profile-content-container"),m=E.querySelector(".history-section");m&&m.remove(),zs(E),b(`âœ… Ù†Ù…Ø±Ù‡ Ø¨Ø±Ø§ÛŒ Ù…Ù‡Ø§Ø±Øª ${i} Ø¨Ø§ Ù…ÙˆÙÙ‚ÛŒØª Ø«Ø¨Øª Ø´Ø¯.`)}),e.appendChild(t)}function zs(e){if(!_)return;const t=document.createElement("div");t.className="history-section";const n=document.createElement("div");n.className="history-section-header";const o=document.createElement("h3");o.textContent="Ø³ÙˆØ§Ø¨Ù‚ Ø¯Ø§Ù†Ø´â€ŒØ¢Ù…ÙˆØ²";const a=document.createElement("button");a.className="btn-icon",a.title="Ø§ÙØ²ÙˆØ¯Ù† ÛŒØ§Ø¯Ø¯Ø§Ø´Øª Ø¬Ø¯ÛŒØ¯",a.innerHTML="ğŸ“",a.addEventListener("click",()=>{const s=_;O.value="",O.dispatchEvent(new Event("input",{bubbles:!0})),be(i=>{i&&(s.addNote(i),w(),W(d.info.name,`ÛŒØ§Ø¯Ø¯Ø§Ø´Øª Ø¬Ø¯ÛŒØ¯ÛŒ Ø¨Ø±Ø§ÛŒ Ø¯Ø§Ù†Ø´â€ŒØ¢Ù…ÙˆØ² Â«${s.identity.name}Â» Ø«Ø¨Øª Ø´Ø¯.`,{type:"VIEW_STUDENT_PROFILE",studentId:s.identity.studentId}),ce(),b("âœ… ÛŒØ§Ø¯Ø¯Ø§Ø´Øª Ø¨Ø§ Ù…ÙˆÙÙ‚ÛŒØª Ø«Ø¨Øª Ø´Ø¯.")),Q(s)}),P(()=>{Y("add-note-modal"),O.focus()})}),n.appendChild(o),n.appendChild(a),t.appendChild(n),Ta(t),Js(t),Ks(t),e.appendChild(t)}function Ta(e){if(!_)return;const t=_,n=d.sessions.reduce((C,v)=>{const k=v.studentRecords[t.identity.studentId];return C+(k&&k.attendance==="absent"?1:0)},0),o=Object.values(t.categoryIssues||{}).reduce((C,v)=>C+v,0),a=document.createElement("div");a.className="stats-summary-box",a.innerHTML=`
        <p><strong>Ú©Ù„ Ø§Ù†ØªØ®Ø§Ø¨:</strong> ${t.statusCounters.totalSelections}</p>
        <p><strong>ØºÛŒØ¨Øª:</strong> ${n}</p>
        <p><strong>ÙØ±ØµØª Ø§Ø² Ø¯Ø³Øª Ø±ÙØªÙ‡:</strong> ${t.statusCounters.missedChances||0}</p>
        <p><strong>Ù…Ø´Ú©Ù„:</strong> ${o}</p>
    `,e.appendChild(a),a.querySelector("p:nth-child(1)");const s=a.querySelector("p:nth-child(4)"),i=U(d.categories),l=document.createElement("div");if(l.className="stats-breakdown",i.length>0){i.forEach(v=>{var G;const k=v.name,N=((G=t.categoryCounts)==null?void 0:G[k])||0,V=document.createElement("p");V.className="stats-breakdown-item",V.innerHTML=`<strong>${k}:</strong> ${N}`,l.appendChild(V)});const C=a.querySelector("p:first-child");C&&(C.classList.add("collapsible-toggle"),C.onclick=()=>{l.classList.toggle("open"),C.classList.toggle("open")},C.after(l))}const c=document.createElement("div");c.className="stats-breakdown",i.length>0&&(i.forEach(C=>{var V;const v=C.name,k=((V=t.categoryIssues)==null?void 0:V[v])||0,N=document.createElement("p");N.className="stats-breakdown-item",N.innerHTML=`<strong>${v}:</strong> ${k}`,c.appendChild(N)}),s&&(s.classList.add("collapsible-toggle"),s.onclick=()=>{c.classList.toggle("open"),s.classList.toggle("open")},a.appendChild(c)));const u=document.createElement("p"),f=document.createElement("strong");f.textContent="ØªÚ©Ø§Ù„ÛŒÙ Ù†Ø§Ù‚Øµ:";const E=document.createElement("span");E.style.marginRight="5px";const m=pe(d);Mt(t,m,E,{includePrefix:!1}),u.appendChild(f),u.appendChild(E),a.appendChild(u)}function Js(e){if(!_)return;const t=_,n=document.createElement("h4");n.textContent="ØªØ§Ø±ÛŒØ®Ú†Ù‡ Ù†Ù…Ø±Ø§Øª:",n.style.marginTop="20px";const o=document.createElement("ul");o.className="list-container";const a=Object.values(t.logs.scores||{}).flat().filter(s=>!s.isDeleted).sort((s,i)=>new Date(i.timestamp)-new Date(s.timestamp));a.length===0?o.innerHTML='<div class="no-content-message">Ù‡Ù†ÙˆØ² Ù†Ù…Ø±Ù‡â€ŒØ§ÛŒ Ø«Ø¨Øª Ù†Ø´Ø¯Ù‡ Ø§Ø³Øª.</div>':a.forEach(s=>{const i=document.createElement("li");i.className="score-history-item";const l=document.createElement("div");l.className="item-content";const c=document.createElement("div");c.className="score-info";const u=document.createElement("span");u.className="score-skill-badge",u.textContent=s.skill;const f=document.createElement("span");f.className="score-value",f.textContent=`Ù†Ù…Ø±Ù‡: ${s.value}`;const E=document.createElement("span");if(E.className="score-date",E.textContent=new Date(s.timestamp).toLocaleDateString("fa-IR"),c.appendChild(u),c.appendChild(f),c.appendChild(E),l.appendChild(c),s.comment){const C=document.createElement("p");C.className="score-comment",C.innerHTML=Ls(s.comment),C.addEventListener("click",()=>{O.value=s.comment,O.dispatchEvent(new Event("input",{bubbles:!0})),be(v=>{s.comment=v,w(),W(d.info.name,`ØªÙˆØ¶ÛŒØ­Ø§Øª Ù†Ù…Ø±Ù‡ ${s.value} (${s.skill}) Ø¨Ø±Ø§ÛŒ Ø¯Ø§Ù†Ø´â€ŒØ¢Ù…ÙˆØ² Â«${t.identity.name}Â» Ø¨Ù‡â€ŒØ±ÙˆØ²Ø±Ø³Ø§Ù†ÛŒ Ø´Ø¯.`,{type:"VIEW_STUDENT_PROFILE",studentId:t.identity.studentId}),Q(t),b("âœ… ØªÙˆØ¶ÛŒØ­Ø§Øª Ù†Ù…Ø±Ù‡ Ø¨Ø§ Ù…ÙˆÙÙ‚ÛŒØª ÙˆÛŒØ±Ø§ÛŒØ´ Ø´Ø¯.")}),P(()=>{Y("add-note-modal"),O.focus()})}),l.appendChild(C)}const m=document.createElement("button");m.className="btn-icon delete-item-btn",m.innerHTML="ğŸ—‘ï¸",m.title="Ø­Ø°Ù Ø§ÛŒÙ† Ù†Ù…Ø±Ù‡",m.addEventListener("click",()=>{P(()=>{z(`Ø¢ÛŒØ§ Ø§Ø² Ø§Ù†ØªÙ‚Ø§Ù„ Ù†Ù…Ø±Ù‡ ${s.value} Ø¯Ø± Ù…Ù‡Ø§Ø±Øª Â«${s.skill}Â» Ø¨Ù‡ Ø³Ø·Ù„ Ø²Ø¨Ø§Ù„Ù‡ Ù…Ø·Ù…Ø¦Ù† Ù‡Ø³ØªÛŒØ¯ØŸ`,()=>{const C={id:`trash_${Date.now()}_${Math.random()}`,timestamp:new Date().toISOString(),type:"score",description:`Ù†Ù…Ø±Ù‡ ${s.value} (${s.skill}) Ø¨Ø±Ø§ÛŒ Â«${t.identity.name}Â»`,restoreData:{scoreId:s.id,skill:s.skill,studentId:t.identity.studentId,classId:d.info.scheduleCode}};M.unshift(C),M.length>50&&M.pop(),s.isDeleted=!0,w(),W(d.info.name,`Ù†Ù…Ø±Ù‡ ${s.value} (${s.skill}) Ø¯Ø§Ù†Ø´â€ŒØ¢Ù…ÙˆØ² Â«${t.identity.name}Â» Ø¨Ù‡ Ø³Ø·Ù„ Ø²Ø¨Ø§Ù„Ù‡ Ù…Ù†ØªÙ‚Ù„ Ø´Ø¯.`,{type:"VIEW_TRASH"}),Q(t),b("âœ… Ù†Ù…Ø±Ù‡ Ø¨Ù‡ Ø³Ø·Ù„ Ø²Ø¨Ø§Ù„Ù‡ Ù…Ù†ØªÙ‚Ù„ Ø´Ø¯.")},{confirmText:"ØªØ§ÛŒÛŒØ¯ Ø§Ù†ØªÙ‚Ø§Ù„",confirmClass:"btn-warning",onCancel:()=>{Q(t)}})})}),i.appendChild(l),i.appendChild(m),o.appendChild(i)}),e.appendChild(n),e.appendChild(o)}function Ks(e){if(!_)return;const t=document.createElement("h4");t.textContent="ØªØ§Ø±ÛŒØ®Ú†Ù‡ ÛŒØ§Ø¯Ø¯Ø§Ø´Øªâ€ŒÙ‡Ø§:",t.style.marginTop="20px";const n=document.createElement("ul");n.className="list-container",!_.profile.notes||_.profile.notes.length===0?n.innerHTML='<div class="no-content-message">Ù‡Ù†ÙˆØ² ÛŒØ§Ø¯Ø¯Ø§Ø´ØªÛŒ Ø«Ø¨Øª Ù†Ø´Ø¯Ù‡ Ø§Ø³Øª.</div>':[..._.profile.notes].filter(a=>!a.isDeleted).sort((a,s)=>new Date(s.timestamp)-new Date(a.timestamp)).forEach(a=>{const s=document.createElement("li");s.className="note-history-item";const i=document.createElement("div");i.className="item-content";const l=document.createElement("div");l.className="note-info";const c=document.createElement("span");c.className="note-date",c.textContent=new Date(a.timestamp).toLocaleDateString("fa-IR");const u=document.createElement("button");u.className="btn-icon delete-item-btn",u.innerHTML="ğŸ—‘ï¸",u.title="Ø­Ø°Ù Ø§ÛŒÙ† ÛŒØ§Ø¯Ø¯Ø§Ø´Øª",u.addEventListener("click",()=>{const E=_;P(()=>{z("Ø¢ÛŒØ§ Ø§Ø² Ø§Ù†ØªÙ‚Ø§Ù„ Ø§ÛŒÙ† ÛŒØ§Ø¯Ø¯Ø§Ø´Øª Ø¨Ù‡ Ø³Ø·Ù„ Ø²Ø¨Ø§Ù„Ù‡ Ù…Ø·Ù…Ø¦Ù† Ù‡Ø³ØªÛŒØ¯ØŸ",()=>{const m={id:`trash_${Date.now()}_${Math.random()}`,timestamp:new Date().toISOString(),type:"note",description:`ÛŒØ§Ø¯Ø¯Ø§Ø´Øª Ø¨Ø±Ø§ÛŒ Ø¯Ø§Ù†Ø´â€ŒØ¢Ù…ÙˆØ² Â«${E.identity.name}Â»`,restoreData:{noteId:a.id,studentId:E.identity.studentId,classId:d.info.scheduleCode}};M.unshift(m),M.length>50&&M.pop(),a.isDeleted=!0,W(d.info.name,`ÛŒØ§Ø¯Ø¯Ø§Ø´Øª Ø¯Ø§Ù†Ø´â€ŒØ¢Ù…ÙˆØ² Â«${E.identity.name}Â» Ø¨Ù‡ Ø³Ø·Ù„ Ø²Ø¨Ø§Ù„Ù‡ Ù…Ù†ØªÙ‚Ù„ Ø´Ø¯.`,{type:"VIEW_TRASH"}),w(),Q(E),b("âœ… ÛŒØ§Ø¯Ø¯Ø§Ø´Øª Ø¨Ù‡ Ø³Ø·Ù„ Ø²Ø¨Ø§Ù„Ù‡ Ù…Ù†ØªÙ‚Ù„ Ø´Ø¯.")},{confirmText:"ØªØ§ÛŒÛŒØ¯ Ø§Ù†ØªÙ‚Ø§Ù„",confirmClass:"btn-warning",onCancel:()=>{Q(E)}})})}),l.appendChild(c),l.appendChild(u);const f=document.createElement("p");f.className="note-content",f.innerHTML=Ls(a.content),f.addEventListener("click",()=>{const E=_;O.value=a.content,O.dispatchEvent(new Event("input",{bubbles:!0})),be(m=>{a.content=m,w(),W(d.info.name,`ÛŒØ§Ø¯Ø¯Ø§Ø´Øª Ø¯Ø§Ù†Ø´â€ŒØ¢Ù…ÙˆØ² Â«${E.identity.name}Â» Ø¨Ù‡â€ŒØ±ÙˆØ²Ø±Ø³Ø§Ù†ÛŒ Ø´Ø¯.`,{type:"VIEW_STUDENT_PROFILE",studentId:E.identity.studentId}),Q(E),b("âœ…ÛŒØ§Ø¯Ø¯Ø§Ø´Øª Ø¨Ø§ Ù…ÙˆÙÙ‚ÛŒØª ÙˆÛŒØ±Ø§ÛŒØ´ Ø´Ø¯.")}),P(()=>{Y("add-note-modal"),O.focus()})}),i.appendChild(l),i.appendChild(f),s.appendChild(i),n.appendChild(s)}),e.appendChild(t),e.appendChild(n)}function Xs(e){un.innerHTML="",e.forEach((t,n)=>{const o=document.createElement("option");o.value=n,o.textContent=t.trim(),un.appendChild(o)})}function In(){dn.innerHTML="",Ln.forEach(e=>{const t=document.createElement("li");t.className="preview-item";const n=document.createElement("input");n.type="checkbox",n.checked=!0,n.dataset.name=e;const o=document.createElement("label");o.textContent=e,t.appendChild(n),t.appendChild(o),dn.appendChild(t)})}function xa(e){const t=document.createElement("div");t.className="list-item-buttons";const n=document.createElement("button");return n.className="btn-icon",n.innerHTML="ğŸ“",n.title="Ø§ÙØ²ÙˆØ¯Ù†/ÙˆÛŒØ±Ø§ÛŒØ´ ÛŒØ§Ø¯Ø¯Ø§Ø´Øª Ú©Ù„Ø§Ø³",n.style.borderBottom="solid",e.note||(n.style.opacity="0.5",n.style.borderBottom="none"),n.addEventListener("click",o=>{o.stopPropagation(),Fn(e)}),t.appendChild(n),t}function Ma(e){const t=document.createElement("div");t.style.flexGrow="1",t.style.display="flex",t.style.flexDirection="column",t.style.alignItems="flex-start";const n=document.createElement("span");n.textContent=e.info.name,n.classList.add("class-name-display"),t.appendChild(n);const o=U(e.students).length,a=U(e.sessions).filter(c=>c.isFinished).length,s=document.createElement("div");s.classList.add("class-stats-row");const i=document.createElement("span");i.textContent=`${o} Ù†ÙØ±`,i.classList.add("student-count-badge"),s.appendChild(i);const l=document.createElement("span");return l.textContent=`${a} Ø¬Ù„Ø³Ù‡`,l.classList.add("session-count-badge"),s.appendChild(l),t.appendChild(s),t.addEventListener("click",()=>{ne(e),ue(null),Qt(d.liveSession),ae(),x("session-page")}),t}function $a(e){const t=document.createElement("li"),n=document.createElement("input");n.type="checkbox",n.className="mass-selection-checkbox",n.checked=ve.includes(e.info.name),n.addEventListener("click",l=>{l.stopPropagation()}),n.addEventListener("change",()=>{const l=e.info.name;if(n.checked)ve.includes(l)||ve.push(l);else{const c=ve.indexOf(l);c>-1&&ve.splice(c,1)}}),t.appendChild(n);const o=Ma(e);t.appendChild(o);const a=document.createElement("div");if(a.className="list-item-badges",e.liveSession&&!e.liveSession.isCancelled&&!e.liveSession.isDeleted){const l=document.createElement("span");l.className="warning-badge",l.textContent="Ø¬Ù„Ø³Ù‡ Ø¨Ø§Ø²",a.appendChild(l),t.classList.add("has-unfinished-session")}const s=document.createElement("span");s.className=`type-badge ${e.info.type}`,s.textContent=e.info.type==="online"?"Ø¢Ù†Ù„Ø§ÛŒÙ†":"Ø­Ø¶ÙˆØ±ÛŒ",s.title="Ù†ÙˆØ¹ Ú©Ù„Ø§Ø³",a.appendChild(s),t.appendChild(a);const i=xa(e);return t.appendChild(i),t.addEventListener("contextmenu",l=>{const c={label:"Ù¾Ø´ØªÛŒØ¨Ø§Ù†â€ŒÚ¯ÛŒØ±ÛŒ Ø§Ø² Ø§ÛŒÙ† Ú©Ù„Ø§Ø³",icon:"ğŸ“¤",action:()=>{ht([e.info.name])}},u=ve.length;u>1&&ve.includes(e.info.name)&&(c.label=`Ù¾Ø´ØªÛŒØ¨Ø§Ù†â€ŒÚ¯ÛŒØ±ÛŒ Ø§Ø² ${u} Ú©Ù„Ø§Ø³`,c.action=()=>{ht(ve),cn([]),oe()});const f=[{label:ze.classList.contains("selection-mode-active")?"Ù„ØºÙˆ Ø§Ù†ØªØ®Ø§Ø¨":"Ø§Ù†ØªØ®Ø§Ø¨ Ú†Ù†Ø¯ Ú©Ù„Ø§Ø³",icon:"âœ”ï¸",action:()=>{const E=ze.classList.contains("selection-mode-active");ze.classList.toggle("selection-mode-active"),E&&(cn([]),oe())}},c,{label:"ØªÙ†Ø¸ÛŒÙ…Ø§Øª Ú©Ù„Ø§Ø³",icon:"âš™ï¸",action:()=>{Un(e)}},{label:"Ú¯Ø²Ø§Ø±Ø´ ÙØ¹Ø§Ù„ÛŒØªâ€ŒÙ‡Ø§",icon:"ğŸ“‹",action:()=>{Vs(e.info.name)}},{label:"ØªØºÛŒÛŒØ± Ù†Ø§Ù…",icon:"âœï¸",action:()=>{const E=e.info.name,m=document.getElementById("add-note-modal-title");m.textContent="ØªØºÛŒÛŒØ± Ù†Ø§Ù… Ú©Ù„Ø§Ø³",O.value=E,O.rows=1,be(C=>{const v=C.trim();if(v&&v!==E){const k=ls(E,v);k.success?(So(E,v),W(v,`Ù†Ø§Ù… Ú©Ù„Ø§Ø³ Ø§Ø² Â«${E}Â» Ø¨Ù‡ Â«${v}Â» ØªØºÛŒÛŒØ± ÛŒØ§ÙØª.`,{type:"VIEW_SESSIONS"}),w(),oe(),b(`âœ…Ù†Ø§Ù… Ú©Ù„Ø§Ø³ Ø¨Ù‡ Â«${v}Â» ØªØºÛŒÛŒØ± ÛŒØ§ÙØª.`)):b(k.message)}m.textContent="Ø«Ø¨Øª ÛŒØ§Ø¯Ø¯Ø§Ø´Øª Ø¬Ø¯ÛŒØ¯",O.rows=4}),Y("add-note-modal"),O.focus(),O.select()}},{label:"Ø­Ø°Ù Ú©Ù„Ø§Ø³",icon:"ğŸ—‘ï¸",className:"danger",action:()=>{z(`Ø¢ÛŒØ§ Ø§Ø² Ø§Ù†ØªÙ‚Ø§Ù„ Ú©Ù„Ø§Ø³ Â«${e.info.name}Â» Ø¨Ù‡ Ø³Ø·Ù„ Ø²Ø¨Ø§Ù„Ù‡ Ù…Ø·Ù…Ø¦Ù† Ù‡Ø³ØªÛŒØ¯ØŸ`,()=>{const E={id:`trash_${Date.now()}_${Math.random()}`,timestamp:new Date().toISOString(),type:"classroom",description:`Ú©Ù„Ø§Ø³ Â«${e.info.name}Â»`,restoreData:{name:e.info.name}};M.unshift(E),M.length>50&&M.pop(),e.isDeleted=!0,w(),oe(),b(`âœ… Ú©Ù„Ø§Ø³ Â«${e.info.name}Â» Ø¨Ù‡ Ø³Ø·Ù„ Ø²Ø¨Ø§Ù„Ù‡ Ù…Ù†ØªÙ‚Ù„ Ø´Ø¯.`)},{confirmText:"Ø¨Ù„Ù‡",confirmClass:"btn-warning",isDelete:!0})}}];Ct(l,f)}),t}function Qs(){const e=document.getElementById("class-management-stats");if(!e)return;const t=Object.values(L).filter(a=>!a.isDeleted),n=t.length,o=t.reduce((a,s)=>a+U(s.students).length,0);e.innerHTML=`
        <span>Ú©Ù„ Ú©Ù„Ø§Ø³â€ŒÙ‡Ø§: <strong>${n}</strong></span>
        <span>|</span>
        <span>Ú©Ù„ Ø¯Ø§Ù†Ø´â€ŒØ¢Ù…ÙˆØ²Ø§Ù†: <strong>${o}</strong></span>
    `}function oe(){Qs(),ze.innerHTML="",Object.values(L).sort((t,n)=>new Date(t.info.creationDate)-new Date(n.info.creationDate)).forEach(t=>{if(t.isDeleted)return;const n=$a(t);ze.appendChild(n)})}function ke(){ln.innerHTML="",d&&U(d.students).forEach(e=>{const t=document.createElement("li"),n=document.createElement("span");n.textContent=e.identity.name,n.style.flexGrow="1",n.className="student-name-link",n.addEventListener("click",()=>{Q(e)}),t.appendChild(n),t.addEventListener("contextmenu",o=>{Ct(o,[{label:"ØªØºÛŒÛŒØ± Ù†Ø§Ù…",icon:"âœï¸",action:()=>{_n(e,d)}},{label:"Ø§Ù†ØªÙ‚Ø§Ù„ Ø¯Ø§Ù†Ø´â€ŒØ¢Ù…ÙˆØ²",icon:"â¡ï¸",action:()=>{Us(e,d)}},{label:"Ø­Ø°Ù Ø¯Ø§Ù†Ø´â€ŒØ¢Ù…ÙˆØ²",icon:"ğŸ—‘ï¸",className:"danger",action:()=>{z(`Ø¢ÛŒØ§ Ø§Ø² Ø§Ù†ØªÙ‚Ø§Ù„ Ø¯Ø§Ù†Ø´â€ŒØ¢Ù…ÙˆØ² Â«${e.identity.name}Â» Ø¨Ù‡ Ø³Ø·Ù„ Ø²Ø¨Ø§Ù„Ù‡ Ù…Ø·Ù…Ø¦Ù† Ù‡Ø³ØªÛŒØ¯ØŸ`,()=>{const s={id:`trash_${Date.now()}_${Math.random()}`,timestamp:new Date().toISOString(),type:"student",description:`Ø¯Ø§Ù†Ø´â€ŒØ¢Ù…ÙˆØ² Â«${e.identity.name}Â» Ø§Ø² Ú©Ù„Ø§Ø³ Â«${d.info.name}Â»`,restoreData:{studentId:e.identity.studentId,classId:d.info.scheduleCode}};M.unshift(s),M.length>50&&M.pop(),e.isDeleted=!0,W(d.info.name,`Ø¯Ø§Ù†Ø´â€ŒØ¢Ù…ÙˆØ² Â«${e.identity.name}Â» Ø¨Ù‡ Ø³Ø·Ù„ Ø²Ø¨Ø§Ù„Ù‡ Ù…Ù†ØªÙ‚Ù„ Ø´Ø¯.`,{type:"VIEW_TRASH"}),w(),ke(),b(`âœ… Ø¯Ø§Ù†Ø´â€ŒØ¢Ù…ÙˆØ² Â«${e.identity.name}Â» Ø¨Ù‡ Ø³Ø·Ù„ Ø²Ø¨Ø§Ù„Ù‡ Ù…Ù†ØªÙ‚Ù„ Ø´Ø¯.`)},{confirmText:"Ø¨Ù„Ù‡",confirmClass:"btn-warning",isDelete:!0})}}])}),ln.appendChild(t)})}function Qe(){if(rn.innerHTML="",!d)return;d.categories.filter(t=>!t.isDeleted).forEach(t=>{const n=document.createElement("li"),o=document.createElement("div");o.className="name-and-badge-container";const a=document.createElement("span");if(a.textContent=t.name,o.appendChild(a),t.isGradedCategory){const i=document.createElement("span");i.className="category-badge",i.textContent="Ù‚Ø§Ø¨Ù„ Ù†Ù…Ø±Ù‡â€ŒØ¯Ù‡ÛŒ",o.appendChild(i)}const s=document.createElement("button");s.className="btn-icon",s.innerHTML="ğŸ—‘ï¸",s.style.color="var(--color-warning)",s.addEventListener("click",()=>{z(`Ø¢ÛŒØ§ Ø§Ø² Ø§Ù†ØªÙ‚Ø§Ù„ Ø¯Ø³ØªÙ‡â€ŒØ¨Ù†Ø¯ÛŒ Â«${t.name}Â» Ø¨Ù‡ Ø³Ø·Ù„ Ø²Ø¨Ø§Ù„Ù‡ Ù…Ø·Ù…Ø¦Ù† Ù‡Ø³ØªÛŒØ¯ØŸ`,()=>{const i={id:`trash_${Date.now()}_${Math.random()}`,timestamp:new Date().toISOString(),type:"category",description:`Ø¯Ø³ØªÙ‡â€ŒØ¨Ù†Ø¯ÛŒ Â«${t.name}Â» Ø§Ø² Ú©Ù„Ø§Ø³ Â«${d.info.name}Â»`,restoreData:{categoryId:t.id,classId:d.info.scheduleCode}};M.unshift(i),M.length>50&&M.pop(),t.isDeleted=!0,W(d.info.name,`Ø¯Ø³ØªÙ‡â€ŒØ¨Ù†Ø¯ÛŒ Â«${t.name}Â» Ø¨Ù‡ Ø³Ø·Ù„ Ø²Ø¨Ø§Ù„Ù‡ Ù…Ù†ØªÙ‚Ù„ Ø´Ø¯.`,{type:"VIEW_TRASH"}),w(),Qe(),b(`âœ… Ø¯Ø³ØªÙ‡â€ŒØ¨Ù†Ø¯ÛŒ Â«${t.name}Â» Ø¨Ù‡ Ø³Ø·Ù„ Ø²Ø¨Ø§Ù„Ù‡ Ù…Ù†ØªÙ‚Ù„ Ø´Ø¯.`)},{confirmText:"Ø¨Ù„Ù‡",confirmClass:"btn-warning"})}),n.appendChild(o),n.appendChild(s),rn.appendChild(n)})}function ut(e){document.querySelectorAll(".page").forEach(n=>{n.classList.remove("active")});const t=document.getElementById(e);t&&t.classList.add("active"),e==="class-management-page"?(ne(null),ue(null),me(null),oe(),mn.style.display="flex"):mn.style.display="none",Gs()}function x(e,t={}){const{tab:n}=t,o={pageId:e,currentClassName:d?d.info.name:null,selectedSessionNumber:h?h.sessionNumber:null,selectedStudentId:_?_.identity.studentId:null};let a=`#${e}`;const s=new URLSearchParams(window.location.hash.split("?")[1]||"");d?s.set("class",d.info.name):s.delete("class"),h?s.set("session",h.sessionNumber):s.delete("session"),_?s.set("student",_.identity.studentId):s.delete("student"),e==="session-dashboard-page"&&n?s.set("tab",n):e!=="session-dashboard-page"&&s.delete("tab");const i=s.toString();i&&(a+=`?${i}`),window.location.hash!==a&&history.pushState(o,"",a),ut(e)}function Oa(e,t){const n=document.createElement("div");n.className="list-item-buttons";const o=document.createElement("button");if(o.className="btn-icon",o.innerHTML="ğŸ“",o.title="Ø§ÙØ²ÙˆØ¯Ù†/ÙˆÛŒØ±Ø§ÛŒØ´ ÛŒØ§Ø¯Ø¯Ø§Ø´Øª Ø¬Ù„Ø³Ù‡",o.style.borderBottom="solid",e.note||(o.style.opacity="0.5",o.style.borderBottom="none"),o.addEventListener("click",a=>{a.stopPropagation(),O.value=e.note||"",be(s=>{e.note=s,w(),W(d.info.name,`ÛŒØ§Ø¯Ø¯Ø§Ø´Øª Ø¬Ù„Ø³Ù‡ ${t} Ø°Ø®ÛŒØ±Ù‡ Ø´Ø¯.`,{type:"VIEW_SESSIONS"}),ae(),b("âœ…ÛŒØ§Ø¯Ø¯Ø§Ø´Øª Ø¬Ù„Ø³Ù‡ Ø°Ø®ÛŒØ±Ù‡ Ø´Ø¯.")}),Y("add-note-modal"),O.focus()}),n.appendChild(o),!e.isFinished&&!e.isCancelled){const a=document.createElement("button");a.className="btn-icon",a.innerHTML="âœ…",a.title="Ø®Ø§ØªÙ…Ù‡ Ø¬Ù„Ø³Ù‡",a.addEventListener("click",s=>{s.stopPropagation(),z(`Ø¬Ù„Ø³Ù‡ Ø´Ù…Ø§Ø±Ù‡ ${t} Ø®Ø§ØªÙ…Ù‡ Ù¾ÛŒØ¯Ø§ Ø®ÙˆØ§Ù‡Ø¯ Ú©Ø±Ø¯!`,()=>{d.endSpecificSession(e.sessionNumber),w(),W(d.info.name,`Ø¬Ù„Ø³Ù‡ ${t} Ø®Ø§ØªÙ…Ù‡ ÛŒØ§ÙØª.`,{type:"VIEW_SESSIONS"}),ae(),z("Ø¬Ù„Ø³Ù‡ Ø¨Ø§ Ù…ÙˆÙÙ‚ÛŒØª Ø®Ø§ØªÙ…Ù‡ ÛŒØ§ÙØª. Ø¢ÛŒØ§ Ù…Ø§ÛŒÙ„ Ø¨Ù‡ Ø§ÛŒØ¬Ø§Ø¯ ÙØ§ÛŒÙ„ Ù¾Ø´ØªÛŒØ¨Ø§Ù† Ù‡Ø³ØªÛŒØ¯ØŸ",()=>{if(Ee){b("âš ï¸ Ù¾Ø´ØªÛŒØ¨Ø§Ù†â€ŒÚ¯ÛŒØ±ÛŒ Ø¯Ø± Ø­Ø§Ù„Øª Ù†Ù…Ø§ÛŒØ´ (Demo) ØºÛŒØ±ÙØ¹Ø§Ù„ Ø§Ø³Øª.");return}ht(),b("âœ…ÙØ§ÛŒÙ„ Ù¾Ø´ØªÛŒØ¨Ø§Ù† Ø¨Ø§ Ù…ÙˆÙÙ‚ÛŒØª Ø§ÛŒØ¬Ø§Ø¯ Ø´Ø¯.")},{confirmText:"Ø¨Ù„Ù‡",cancelText:"Ø®ÛŒØ±",confirmClass:"btn-success"})})}),n.appendChild(a)}return n}function Ra(e,t){const n=document.createElement("div");n.style.display="flex",n.style.flexDirection="column",n.style.alignItems="flex-start",n.style.flexGrow="1";const o=new Date(e.startTime).toLocaleDateString("fa-IR"),a=document.createElement("span"),s=document.createElement("div");s.style.display="flex",s.style.gap="5px",s.style.marginTop="5px";const i=new Date(e.startTime).toLocaleDateString("fa-IR",{weekday:"long"}),l=document.createElement("span");if(l.className="type-badge day-badge",l.textContent=i,s.appendChild(l),e.isCancelled){a.textContent=`âœ…Ø¬Ù„Ø³Ù‡ Ù„ØºÙˆ Ø´Ø¯Ù‡ - ØªØ§Ø±ÛŒØ®: ${o}`,n.style.cursor="default";const c=document.createElement("span");c.className="type-badge cancelled-badge",c.textContent="Ù„ØºÙˆ Ø´Ø¯Ù‡",s.appendChild(c)}else a.textContent=`Ø¬Ù„Ø³Ù‡ ${t} - ØªØ§Ø±ÛŒØ®: ${o}`,n.style.cursor="pointer",n.addEventListener("click",()=>{ue(e),pt()});if(n.appendChild(a),e.isFinished){const c=document.createElement("span");c.className="type-badge",c.textContent="Ø®Ø§ØªÙ…Ù‡ ÛŒØ§ÙØªÙ‡",c.style.backgroundColor="var(--color-secondary)",s.appendChild(c)}if(e.isMakeup){const c=document.createElement("span");c.className="type-badge",c.textContent="Ø¬Ø¨Ø±Ø§Ù†ÛŒ",c.style.backgroundColor="var(--color-warning)",c.style.color="var(--color-text-dark)",s.appendChild(c)}return n.appendChild(s),n}function Ha(e,t){const n=document.createElement("li"),o=t.get(e.sessionNumber),a=Ra(e,o);n.appendChild(a);const s=Oa(e,o);return n.appendChild(s),n.addEventListener("contextmenu",i=>{const l=[{label:e.isCancelled?"Ø¨Ø§Ø²Ú¯Ø±Ø¯Ø§Ù†ÛŒ Ø¬Ù„Ø³Ù‡":"Ù„ØºÙˆ Ø¬Ù„Ø³Ù‡",icon:"âŒ",action:()=>{const c=e.isCancelled?"Ø¨Ø§Ø²Ú¯Ø±Ø¯Ø§Ù†ÛŒ Ø¬Ù„Ø³Ù‡":"Ù„ØºÙˆ Ø¬Ù„Ø³Ù‡",u=e.isCancelled?"Ø¢ÛŒØ§ Ø§Ø² Ø¨Ø§Ø²Ú¯Ø±Ø¯Ø§Ù†ÛŒ Ø§ÛŒÙ† Ø¬Ù„Ø³Ù‡ Ù…Ø·Ù…Ø¦Ù† Ù‡Ø³ØªÛŒØ¯ØŸ":"Ø¢ÛŒØ§ Ø§Ø² Ù„ØºÙˆ Ø§ÛŒÙ† Ø¬Ù„Ø³Ù‡ Ù…Ø·Ù…Ø¦Ù† Ù‡Ø³ØªÛŒØ¯ØŸ Ø¬Ù„Ø³Ù‡ Ù„ØºÙˆ Ø´Ø¯Ù‡ Ø¯Ø± Ø¢Ù…Ø§Ø± ØªØ§Ø«ÛŒØ±ÛŒ Ù†Ø¯Ø§Ø±Ø¯ Ø§Ù…Ø§ Ù‚Ø§Ø¨Ù„ Ø¨Ø§Ø²Ú¯Ø±Ø¯Ø§Ù†ÛŒ Ø§Ø³Øª.";z(u,()=>{e.isCancelled=!e.isCancelled;const f=e.isCancelled?`Ø¬Ù„Ø³Ù‡ ${o} Ù„ØºÙˆ Ø´Ø¯.`:`Ø¬Ù„Ø³Ù‡ Ù„ØºÙˆ Ø´Ø¯Ù‡ (ØªØ§Ø±ÛŒØ®: ${new Date(e.startTime).toLocaleDateString("fa-IR")}) Ø¨Ø§Ø²Ú¯Ø±Ø¯Ø§Ù†ÛŒ Ø´Ø¯.`;W(d.info.name,f,{type:"VIEW_SESSIONS"}),w(),ae(),b(e.isCancelled?"âœ…Ø¬Ù„Ø³Ù‡ Ù„ØºÙˆ Ø´Ø¯.":"âœ…Ø¬Ù„Ø³Ù‡ Ø¨Ø§Ø²Ú¯Ø±Ø¯Ø§Ù†ÛŒ Ø´Ø¯.")},{confirmText:c,confirmClass:"btn-warning"})}},{label:"ØªØºÛŒÛŒØ± ÙˆØ¶Ø¹ÛŒØª Ø¬Ø¨Ø±Ø§Ù†ÛŒ",icon:"ğŸ”„",action:()=>{d.markAsMakeup(e.sessionNumber),w();const c=e.isMakeup?`Ø¬Ù„Ø³Ù‡ ${o} Ø¨Ù‡ Ø¹Ù†ÙˆØ§Ù† Ø¬Ø¨Ø±Ø§Ù†ÛŒ Ø¹Ù„Ø§Ù…Øªâ€ŒÚ¯Ø°Ø§Ø±ÛŒ Ø´Ø¯.`:`Ø¬Ù„Ø³Ù‡ ${o} Ø§Ø² Ø­Ø§Ù„Øª Ø¬Ø¨Ø±Ø§Ù†ÛŒ Ø®Ø§Ø±Ø¬ Ø´Ø¯.`;W(d.info.name,c,{type:"VIEW_SESSIONS"}),ae()}},{label:"Ø­Ø°Ù Ø¬Ù„Ø³Ù‡",icon:"ğŸ—‘ï¸",className:"danger",action:()=>{const c=e.isCancelled?"Ù„ØºÙˆ Ø´Ø¯Ù‡":o;z(`Ø¢ÛŒØ§ Ø§Ø² Ø§Ù†ØªÙ‚Ø§Ù„ Ø¬Ù„Ø³Ù‡ ${c} Ø¨Ù‡ Ø³Ø·Ù„ Ø²Ø¨Ø§Ù„Ù‡ Ù…Ø·Ù…Ø¦Ù† Ù‡Ø³ØªÛŒØ¯ØŸ`,()=>{const u={id:`trash_${Date.now()}_${Math.random()}`,timestamp:new Date().toISOString(),type:"session",description:`Ø¬Ù„Ø³Ù‡ ${c} Ø§Ø² Ú©Ù„Ø§Ø³ Â«${d.info.name}Â»`,restoreData:{sessionNumber:e.sessionNumber,classId:d.info.scheduleCode}};M.unshift(u),M.length>50&&M.pop(),e.isDeleted=!0,W(d.info.name,`Ø¬Ù„Ø³Ù‡ ${c} Ø¨Ù‡ Ø³Ø·Ù„ Ø²Ø¨Ø§Ù„Ù‡ Ù…Ù†ØªÙ‚Ù„ Ø´Ø¯.`,{type:"VIEW_TRASH"}),w(),ae(),b(`âœ… Ø¬Ù„Ø³Ù‡ ${c} Ø¨Ù‡ Ø³Ø·Ù„ Ø²Ø¨Ø§Ù„Ù‡ Ù…Ù†ØªÙ‚Ù„ Ø´Ø¯.`)},{confirmText:"Ø¨Ù„Ù‡",confirmClass:"btn-warning",isDelete:!0})}}];Ct(i,l)}),n}function ae(){const e=document.getElementById("session-list");if(!d)return;if(e.innerHTML="",d.sessions.length===0){e.innerHTML="<li>Ù‡Ù†ÙˆØ² Ø¬Ù„Ø³Ù‡â€ŒØ§ÛŒ Ø´Ø±ÙˆØ¹ Ù†Ø´Ø¯Ù‡ Ø§Ø³Øª.</li>";return}const t=pe(d);[...U(d.sessions)].reverse().forEach(o=>{const a=Ha(o,t);e.appendChild(a)})}function at(e){if(Be.innerHTML="",e.length>0)e.forEach(t=>{const n=document.createElement("div");n.textContent=t.identity.name,n.addEventListener("click",()=>{Q(t),Be.style.display="none",gn.value=""}),Be.appendChild(n)}),Be.style.display="block";else if(gn.value.trim()!==""){const t=document.createElement("div");t.className="no-results",t.textContent="Ù¾ÛŒØ¯Ø§ Ù†Ø´Ø¯",Be.appendChild(t),Be.style.display="block"}else Be.style.display="none"}function Ot(e){if(Le.innerHTML="",e.length>0)e.forEach(t=>{const n=document.createElement("div");n.className="global-search-result";const o=document.createElement("span");o.className="student-name",o.textContent=t.student.identity.name;const a=document.createElement("span");a.className="class-name",a.textContent=`Ú©Ù„Ø§Ø³: ${t.classroom.info.name}`,n.addEventListener("click",()=>{ne(t.classroom),Q(t.student),Le.style.display="none",Tt.value=""}),a.addEventListener("click",s=>{s.stopPropagation(),ne(t.classroom),ue(null),Qt(t.classroom.liveSession),ae(),x("session-page"),Le.style.display="none",Tt.value=""}),n.appendChild(o),n.appendChild(a),Le.appendChild(n)}),Le.style.display="block";else if(Tt.value.trim()!==""){const t=document.createElement("div");t.className="no-results",t.textContent="Ù¾ÛŒØ¯Ø§ Ù†Ø´Ø¯",Le.appendChild(t),Le.style.display="block"}else Le.style.display="none"}function yt(){const e=document.getElementById("trashed-items-list");if(e.innerHTML="",M.length===0){e.innerHTML='<li style="text-align: center; padding: 20px;">Ø³Ø·Ù„ Ø²Ø¨Ø§Ù„Ù‡ Ø®Ø§Ù„ÛŒ Ø§Ø³Øª.</li>';return}M.forEach((t,n)=>{const o=document.createElement("li"),a=document.createElement("span");a.textContent=t.description,a.style.flexGrow="1";const s=document.createElement("div");s.className="list-item-buttons";const i=document.createElement("button");i.className="btn-icon",i.innerHTML="ğŸ”„",i.title="Ø¨Ø§Ø²ÛŒØ§Ø¨ÛŒ",i.addEventListener("click",()=>{var E;let c=!1,u=null;const f=t.restoreData;switch(t.type){case"classroom":{const m=L[f.name];m&&!m.isDeleted?u=`Ú©Ù„Ø§Ø³ÛŒ Ø¨Ø§ Ù†Ø§Ù… Â«${f.name}Â» Ø§Ø² Ù‚Ø¨Ù„ ÙØ¹Ø§Ù„ Ø§Ø³Øª.`:m&&m.isDeleted&&(m.isDeleted=!1,c=!0);break}case"student":{const m=Object.values(L).find(v=>v.info.scheduleCode===f.classId),C=m==null?void 0:m.students.find(v=>v.identity.studentId===f.studentId);C&&(C.isDeleted=!1,c=!0);break}case"session":{const m=Object.values(L).find(v=>v.info.scheduleCode===f.classId),C=m==null?void 0:m.sessions.find(v=>v.sessionNumber===f.sessionNumber);C&&(C.isDeleted=!1,c=!0);break}case"category":{const m=Object.values(L).find(v=>v.info.scheduleCode===f.classId),C=m==null?void 0:m.categories.find(v=>v.id===f.categoryId);C&&(C.isDeleted=!1,c=!0);break}case"score":{const m=Object.values(L).find(k=>k.info.scheduleCode===f.classId),C=m==null?void 0:m.students.find(k=>k.identity.studentId===f.studentId),v=(E=C==null?void 0:C.logs.scores[f.skill.toLowerCase()])==null?void 0:E.find(k=>k.id===f.scoreId);v&&(v.isDeleted=!1,c=!0);break}case"note":{const m=Object.values(L).find(k=>k.info.scheduleCode===f.classId),C=m==null?void 0:m.students.find(k=>k.identity.studentId===f.studentId),v=C==null?void 0:C.profile.notes.find(k=>k.id===f.noteId);v&&(v.isDeleted=!1,c=!0);break}}c?(M.splice(n,1),w(),yt(),t.type==="classroom"&&oe(),b("âœ… Ø¢ÛŒØªÙ… Ø¨Ø§ Ù…ÙˆÙÙ‚ÛŒØª Ø¨Ø§Ø²ÛŒØ§Ø¨ÛŒ Ø´Ø¯.")):b(u?`âš ï¸ ${u}`:"âš ï¸ Ø¢ÛŒØªÙ… Ø§ØµÙ„ÛŒ Ø¨Ø±Ø§ÛŒ Ø¨Ø§Ø²ÛŒØ§Ø¨ÛŒ ÛŒØ§ÙØª Ù†Ø´Ø¯.")});const l=document.createElement("button");l.className="btn-icon",l.innerHTML="ğŸ”¥",l.title="Ø­Ø°Ù Ø¯Ø§Ø¦Ù…ÛŒ",l.addEventListener("click",()=>{z("Ø¢ÛŒØ§ Ø§Ø² Ø­Ø°Ù Ø¯Ø§Ø¦Ù…ÛŒ Ø§ÛŒÙ† Ø¢ÛŒØªÙ… Ù…Ø·Ù…Ø¦Ù† Ù‡Ø³ØªÛŒØ¯ØŸ Ø§ÛŒÙ† Ø¹Ù…Ù„ ØºÛŒØ±Ù‚Ø§Ø¨Ù„ Ø¨Ø§Ø²gØ´Øª Ø§Ø³Øª.",()=>{const c=t.restoreData,u=E=>Object.values(L).find(m=>m.info.scheduleCode===E);let f;switch(t.type){case"classroom":delete L[c.name];break;case"student":f=u(c.classId),qt({identity:{studentId:c.studentId}},f);break;case"session":f=u(c.classId),f&&ms(f.info.name,c.sessionNumber);break;case"category":f=u(c.classId),f&&fs(f.info.name,c.categoryId);break;case"score":f=u(c.classId),f&&ps(f.info.name,c.studentId,c.skill,c.scoreId);break;case"note":f=u(c.classId),f&&gs(f.info.name,c.studentId,c.noteId);break}M.splice(n,1),w(),yt(),b("âœ… Ø¢ÛŒØªÙ… Ø¨Ø±Ø§ÛŒ Ù‡Ù…ÛŒØ´Ù‡ Ø­Ø°Ù Ø´Ø¯.")},{confirmText:"Ø­Ø°Ù Ø¯Ø§Ø¦Ù…ÛŒ",confirmClass:"btn-warning"})}),s.appendChild(i),s.appendChild(l),o.appendChild(a),o.appendChild(s),e.appendChild(o)})}function Aa(){const e=document.getElementById("absentees-summary-container");e&&(e.innerHTML=`
        <div id="absentees-summary-box" class="absentees-summary">
            <div class="absentees-summary-header">
                <h4>Ù„ÛŒØ³Øª ØºØ§ÛŒØ¨ÛŒÙ† Ø¬Ù„Ø³Ù‡ Ø´Ù…Ø§Ø±Ù‡ <span id="absentee-summary-session-number"></span></h4>
                <button id="copy-absentees-btn" class="btn-icon" title="Ú©Ù¾ÛŒ Ù„ÛŒØ³Øª ØºØ§ÛŒØ¨ÛŒÙ†">ğŸ“‹</button>
            </div>
            <div id="absentees-summary-list" class="summary-list"></div>
        </div>
    `)}function Ys(){const e=document.getElementById("absentees-summary-box"),t=document.getElementById("absentees-summary-list"),n=document.getElementById("absentee-summary-session-number");if(!e||!t||!n){console.error("Could not find all absentee summary elements.");return}if(!d||!h){e.classList.remove("visible");return}const o=U(d.students).filter(s=>{const i=h.studentRecords[s.identity.studentId];return i&&i.attendance==="absent"}),a=pe(d);n.textContent=a.get(h.sessionNumber),o.length>0?e.classList.add("visible"):e.classList.remove("visible"),t.innerHTML="",o.forEach(s=>{const l=(u=>d.sessions.reduce((f,E)=>{if(E.isDeleted||E.isCancelled)return f;const m=E.studentRecords[u.identity.studentId];return f+(m&&m.attendance==="absent"?1:0)},0))(s),c=document.createElement("span");c.className="summary-name",c.textContent=`${s.identity.name} (ØºÛŒØ¨Øª: ${l})`,c.addEventListener("click",()=>{c.classList.add("fading-out"),setTimeout(()=>{h.setAttendance(s.identity.studentId,"present"),w(),We()},200)}),t.appendChild(c)})}function Wa(){const e=document.getElementById("copy-absentees-btn");if(!e){console.error("Could not find the copy absentees button to attach listener.");return}e.addEventListener("click",()=>{if(!d||!h)return;const t=U(d.students).filter(a=>{const s=h.studentRecords[a.identity.studentId];return s&&s.attendance==="absent"});if(t.length===0){b("âš ï¸Ù„ÛŒØ³Øª ØºØ§ÛŒØ¨ÛŒÙ† Ø®Ø§Ù„ÛŒ Ø§Ø³Øª.");return}const n=a=>d.sessions.reduce((s,i)=>{if(i.isDeleted||i.isCancelled)return s;const l=i.studentRecords[a.identity.studentId];return s+(l&&l.attendance==="absent"?1:0)},0);let o=`Ù„ÛŒØ³Øª ØºØ§ÛŒØ¨ÛŒÙ† Ø¬Ù„Ø³Ù‡ Ø´Ù…Ø§Ø±Ù‡ ${ka()}:

`;t.forEach(a=>{const s=n(a);o+=`- ${a.identity.name} (ØªØ¹Ø¯Ø§Ø¯ ØºÛŒØ¨Øªâ€ŒÙ‡Ø§: ${s})
`}),navigator.clipboard.writeText(o).then(()=>{b("âœ…Ù„ÛŒØ³Øª ØºØ§ÛŒØ¨ÛŒÙ† Ø¨Ø§ Ù…ÙˆÙÙ‚ÛŒØª Ú©Ù¾ÛŒ Ø´Ø¯.")}).catch(a=>{console.error("Failed to copy text: ",a),b("âŒØ®Ø·Ø§ Ø¯Ø± Ú©Ù¾ÛŒ Ú©Ø±Ø¯Ù† Ù„ÛŒØ³Øª.")})})}function Rt(){const e=document.getElementById("demo-mode-banner");e&&(Ee?(e.classList.add("visible"),document.body.classList.add("demo-mode-active")):(e.classList.remove("visible"),document.body.classList.remove("demo-mode-active")))}const _a=Object.freeze(Object.defineProperty({__proto__:null,_internalShowPage:ut,addCategoryBtn:Fo,addClassBtn:wo,addNoteModal:ea,addScoreBtn:ia,addStudentBtn:To,appHeader:mn,attendanceListUl:ct,attendanceMassActionsContainer:xt,attendancePage:Uo,attendancePane:Xe,attendanceSearchInput:Me,backToSessionsBtn:Bo,backToStudentPageBtn:sa,backupDataBtn:Ko,breadcrumbContainer:Ge,cancelImportBtn:_o,cancelNoteBtn:na,categoryListUl:rn,categoryModal:ha,categoryModalCancelBtn:ya,categoryModalSaveBtn:Hs,categoryModalTitle:Rs,classListHeader:Vo,classListUl:ze,classManagementPage:Ns,classSaveNoteBtn:ta,closeActiveModal:P,closeContextMenu:$e,closeNavBtn:zo,columnMappingPage:Ao,columnSelectDropdown:un,confirmColumnBtn:Wo,confirmModalCancelBtn:pn,confirmModalConfirmBtn:ot,confirmModalMessage:xs,contextMenu:Re,csvCancelBtn:Oo,csvConfirmBtn:$o,csvFileInput:Ho,csvPreviewList:dn,csvPreviewPage:Mo,customConfirmModal:Qo,displayWinner:ce,finishAttendanceBtn:qo,globalStudentSearchInput:Tt,globalStudentSearchResultsDiv:Le,gradedCategoryPillsContainer:oa,hamburgerMenuBtn:Go,handleUndo:_s,importCsvBtn:Ro,initiateBackupProcess:ht,isGradedCheckbox:ra,massCommentAppendCheckbox:Wn,massCommentBtn:yn,massCommentCancelBtn:va,massCommentContent:dt,massCommentModal:Ca,massCommentModalTitle:ba,massCommentSaveBtn:Ea,massCommentStudentCountMessage:As,newCategoryModalIsGradedCheckbox:An,newCategoryModalNameInput:rt,newCategoryNameInput:Po,newClassNameInput:Lo,newNoteContent:O,newScoreCommentTextarea:Os,newScoreValueInput:aa,newStudentNameInput:Do,openContextMenu:Ct,openModal:Y,overlay:Jo,pasteArea:Ds,processMassHomeworkComment:bn,processPasteBtn:xo,profileScoresListUl:la,profileStatsSummaryDiv:ca,quickGradeFormWrapper:je,quickGradeSubmitBtn:Oe,quickNoteTextarea:he,quickScoreInput:Ie,renderAttendancePage:We,renderBreadcrumbs:Gs,renderClassList:oe,renderClassManagementStats:Qs,renderColumnSelector:Xs,renderGlobalSearchResults:Ot,renderImportPreview:In,renderLogModal:Vs,renderMassCommentControls:Pn,renderScoresHistory:Js,renderSearchResults:at,renderSessionDashboard:pt,renderSessions:ae,renderSettingsCategories:Qe,renderSettingsStudentList:ke,renderStudentNotes:Ks,renderStudentStatsList:X,renderTrashPage:yt,restoreDataBtn:Xo,restoreFileInput:Ts,secureConfirmCancelBtn:Zo,secureConfirmCode:$s,secureConfirmConfirmBtn:Dt,secureConfirmInput:Ve,secureConfirmMessage:Ms,secureConfirmModal:Yo,selectStudentBtn:Ce,selectStudentBtnWrapper:Ke,sessionDashboardPage:Ia,setAutoDirectionOnInput:js,settingsClassNameHeader:Hn,settingsPage:No,settingsStudentListUl:ln,setupDashboardTabs:Ws,showCategoryModal:Cn,showClassNoteModal:Fn,showCustomConfirm:z,showMassCommentModal:qs,showMoveStudentModal:Us,showNotification:b,showPage:x,showRenameStudentModal:_n,showRestoreConfirmModal:Ps,showSecureConfirm:Fs,showSettingsPage:Un,showStudentProfile:Q,showUndoToast:Sa,sideNavMenu:jo,studentSearchInput:gn,studentSearchResultsDiv:Be,studentStatsHeader:fn,switchDashboardTab:gt,trashedCategoriesList:fa,trashedClassesList:da,trashedNotesList:pa,trashedScoresList:ga,trashedSessionsList:ma,trashedStudentsList:ua,triggerFileDownload:vn,undoBtn:ko,undoMessage:Bs,undoToast:Kt,updateDemoModeBanner:Rt},Symbol.toStringTag,{value:"Module"}));function Pa(){const e=window.location.hash;if(!e||e==="#")return!1;const[t,n]=e.split("?"),o=t.substring(1),a=new URLSearchParams(n),s=a.get("class"),i=parseInt(a.get("session"),10),l=a.get("student"),c=a.get("tab")||"selector";if(s&&L[s])ne(L[s]),i&&d.getSession(i)&&ue(d.getSession(i)),l&&d.students.find(u=>u.identity.studentId===l)&&me(d.students.find(u=>u.identity.studentId===l));else return!1;switch(o){case"session-page":ae(),x("session-page");break;case"session-dashboard-page":pt(o==="attendance-page"?"attendance":c);break;case"settings-page":Hn.textContent=`ØªÙ†Ø¸ÛŒÙ…Ø§Øª Ú©Ù„Ø§Ø³: ${d.info.name}`,ke(),Qe(),x("settings-page");break;case"student-profile-page":pt(c),Q(_);break;default:return!1}return!0}document.addEventListener("DOMContentLoaded",()=>{const{globalStudentSearchInput:e,newClassNameInput:t,addClassBtn:n,undoBtn:o,newStudentNameInput:a,addStudentBtn:s,pasteArea:i,processPasteBtn:l,csvPreviewList:c,csvConfirmBtn:u,csvCancelBtn:f,importCsvBtn:E,csvFileInput:m,columnSelectDropdown:C,confirmColumnBtn:v,cancelImportBtn:k,newCategoryNameInput:N,addCategoryBtn:V,selectStudentBtn:G,attendancePage:ee,finishAttendanceBtn:$,classListHeader:B,studentStatsHeader:R,hamburgerMenuBtn:ie,sideNavMenu:le,closeNavBtn:K,overlay:se,backupDataBtn:re,restoreDataBtn:bt,restoreFileInput:Ye,confirmModalCancelBtn:_e,confirmModalConfirmBtn:Pe,secureConfirmCancelBtn:vt,secureConfirmConfirmBtn:Ne,newNoteContent:Fe,classSaveNoteBtn:H,cancelNoteBtn:j,studentSearchInput:J,studentSearchResultsDiv:Ue,isGradedCheckbox:Et,categoryModalSaveBtn:Ze,categoryModalCancelBtn:It,massCommentBtn:et,massCommentCancelBtn:Zs,massCommentSaveBtn:eo,massCommentContent:to,massCommentAppendCheckbox:no,attendanceSearchInput:Vn}=_a,so=document.getElementById("trash-nav-btn");document.querySelector(".global-search-container .search-icon"),Ut(),Rt(),Pa()||(oe(),x("class-management-page"));function Gn(r,g){const p=document.querySelector(r);if(!p)return;const y=p.querySelector(".search-icon"),I=p.querySelector(".animated-search-input");!y||!I||(y.addEventListener("mousedown",D=>{D.preventDefault()}),y.addEventListener("click",()=>{p.classList.contains("search-active")||(p.classList.add("search-active"),I.focus())}),I.addEventListener("blur",()=>{setTimeout(()=>{p.classList.remove("search-active"),I.value="",g&&g([])},150)}))}Vn.addEventListener("input",()=>{const r=Vn.value.toLowerCase().trim(),g=sn(r);ct.querySelectorAll(".attendance-list-item").forEach(y=>{const I=y.querySelector(".student-name");if(I){const D=I.textContent,S=Se(D.toLowerCase()),T=S.includes(Se(r)),A=S.includes(Se(g));T||A?y.style.display="flex":y.style.display="none"}})}),It.addEventListener("click",()=>{P(),Yt(null)}),Ze.addEventListener("click",()=>{const r=rt.value.trim(),g=An.checked;typeof Pt=="function"&&Pt(r,g)}),window.addEventListener("scroll",$e),document.addEventListener("click",r=>{Re.classList.contains("visible")&&!Re.contains(r.target)&&$e(),J.contains(r.target)||(Ue.style.display="none");const g=r.target.closest(".log-action-link");if(g&&g.dataset.action)try{const p=JSON.parse(g.dataset.action);mo(p)}catch(p){console.error("Could not parse log action:",p)}}),Ke.addEventListener("click",()=>{(Ke.classList.contains("disabled-wrapper")||Ce.disabled)&&(Ce.classList.add("shake-animation"),setTimeout(()=>{Ce.classList.remove("shake-animation")},200))}),R.addEventListener("click",()=>{const r=new Date().getTime();r-Nn>500?Bt(1):Bt(Wt+1),Es(r),Wt===5&&(Bt(0),z("Ø¢ÛŒØ§ Ø§Ø² ØµÙØ± Ú©Ø±Ø¯Ù† ØªÙ…Ø§Ù… Ø´Ù…Ø§Ø±Ù†Ø¯Ù‡â€ŒÙ‡Ø§ÛŒ Ø¯Ø§Ù†Ø´â€ŒØ¢Ù…ÙˆØ²Ø§Ù† Ù…Ø·Ù…Ø¦Ù† Ù‡Ø³ØªÛŒØ¯ØŸ Ø§ÛŒÙ† Ø¹Ù…Ù„ ØºÛŒØ±Ù‚Ø§Ø¨Ù„ Ø¨Ø§Ø²Ú¯Ø´Øª Ø§Ø³Øª.",()=>{us(),X(),b("ØªÙ…Ø§Ù… Ø¢Ù…Ø§Ø±Ù‡Ø§ ØµÙØ± Ø´Ø¯Ù†Ø¯ âœ….")},{confirmText:"Ø¨Ù„Ù‡",confirmClass:"btn-warning"}))}),B.addEventListener("click",()=>{const r=new Date().getTime();r-kn>500?Nt(1):Nt(At+1),vs(r),At===5&&(Nt(0),z("Ø¢ÛŒØ§ Ø§Ø² Ø³Ø§Ø®Øª ÛŒÚ© Ú©Ù„Ø§Ø³ ØªØ³ØªÛŒ ØªØµØ§Ø¯ÙÛŒ Ù…Ø·Ù…Ø¦Ù† Ù‡Ø³ØªÛŒØ¯ØŸ",()=>{function g(){const p=`Ú©Ù„Ø§Ø³ ØªØ³ØªÛŒ ${Object.keys(L).length+1}`,y=new an({name:p,type:"online"});["Ø¹Ù„ÛŒ Ø±Ø¶Ø§ÛŒÛŒ","Ù…Ø±ÛŒÙ… Ø­Ø³ÛŒÙ†ÛŒ","Ø²Ù‡Ø±Ø§ Ø§Ø­Ù…Ø¯ÛŒ","Ø±Ø¶Ø§ Ù…Ø­Ù…Ø¯ÛŒ","ÙØ§Ø·Ù…Ù‡ Ú©Ø±ÛŒÙ…ÛŒ"].forEach(D=>y.addStudent(new wt({name:D}))),L[p]=y,w(),oe()}g(),b("Ú©Ù„Ø§Ø³ ØªØ³ØªÛŒ Ø¨Ø§ Ù…ÙˆÙÙ‚ÛŒØª Ø³Ø§Ø®ØªÙ‡ Ø´Ø¯ âœ…!")},{confirmText:"Ø¨Ø³Ø§Ø²",confirmClass:"btn-success"}))}),vt.addEventListener("click",()=>{P(),ft(null)}),Ne.addEventListener("click",()=>{typeof _t=="function"&&_t(),P(),ft(null)}),_e.addEventListener("click",()=>{P(Dn)}),Pe.addEventListener("click",()=>{P(Bn)}),G.addEventListener("click",()=>{if(Ie.value.trim()!==""||he.value.trim()!==""){b("âš ï¸Ù„Ø·ÙØ§Ù‹ Ø§Ø¨ØªØ¯Ø§ Ø¨Ø§ Ø¯Ú©Ù…Ù‡ Â«Ø«Ø¨ØªÂ»ØŒ ØªØºÛŒÛŒØ±Ø§Øª Ø±Ø§ Ø°Ø®ÛŒØ±Ù‡ Ú©Ù†ÛŒØ¯ Ùˆ ÛŒØ§ Ù†Ù…Ø±Ù‡ Ùˆ ÛŒØ§Ø¯Ø¯Ø§Ø´Øª Ø±Ø§ Ù¾Ø§Ú© Ú©Ù†ÛŒØ¯.");return}if(!d||!h||!de)return;const r=d.selectNextWinner(de.name,h);if(r){const g=h.studentRecords[r.identity.studentId];if(g&&g.attendance==="absent"&&r.statusCounters.missedChances++,g&&g.hadIssue){r.statusCounters.missedChances++;const y=de.name;r.categoryIssues[y]=(r.categoryIssues[y]||0)+1}g&&g.wasOutOfClass&&(r.statusCounters.outOfClassCount=(r.statusCounters.outOfClassCount||0)+1,r.statusCounters.missedChances++);const p={winner:r,categoryName:de.name};h.winnerHistory.push(p),h.winnerHistory.length>10&&h.winnerHistory.shift(),Te(h.winnerHistory.length-1),h.lastUsedCategoryId=de.id,h.lastSelectedWinnerId=r.identity.studentId,X(),setTimeout(()=>ce(),0),w()}else b("âŒØ¯Ø§Ù†Ø´â€ŒØ¢Ù…ÙˆØ² ÙˆØ§Ø¬Ø¯ Ø´Ø±Ø§ÛŒØ·ÛŒ Ø¨Ø±Ø§ÛŒ Ø§Ù†ØªØ®Ø§Ø¨ ÛŒØ§ÙØª Ù†Ø´Ø¯.")}),V.addEventListener("click",()=>{if(!d)return;const r=N.value.trim(),g=Et.checked;if(!r){alert("âš ï¸Ù„Ø·ÙØ§Ù‹ Ù†Ø§Ù… Ø¯Ø³ØªÙ‡â€ŒØ¨Ù†Ø¯ÛŒ Ø±Ø§ ÙˆØ§Ø±Ø¯ Ú©Ù†ÛŒØ¯.");return}const p=d.categories.find(I=>I.name.toLowerCase()===r.toLowerCase());if(p)if(p.isDeleted){const I=d.categories.findIndex(D=>D===p);I>-1&&d.categories.splice(I,1)}else{alert("âš ï¸Ø§ÛŒÙ† Ø¯Ø³ØªÙ‡â€ŒØ¨Ù†Ø¯ÛŒ Ø§Ø² Ù‚Ø¨Ù„ ÙˆØ¬ÙˆØ¯ Ø¯Ø§Ø±Ø¯.");return}const y=new we(r,"",g);d.categories.push(y),w(),W(d.info.name,`Ø¯Ø³ØªÙ‡â€ŒØ¨Ù†Ø¯ÛŒ Ø¬Ø¯ÛŒØ¯ Â«${r}Â» Ø§Ø¶Ø§ÙÙ‡ Ø´Ø¯.`,{type:"VIEW_CLASS_SETTINGS"}),Qe(),N.value="",Et.checked=!1}),N.addEventListener("keyup",r=>{r.key==="Enter"&&V.click()}),v.addEventListener("click",()=>{if(!Ht){alert("âŒØ®Ø·Ø§ÛŒÛŒ Ø±Ø® Ø¯Ø§Ø¯Ù‡ Ø§Ø³Øª. Ù„Ø·ÙØ§Ù‹ ÙØ§ÛŒÙ„ Ø±Ø§ Ø¯ÙˆØ¨Ø§Ø±Ù‡ Ø§Ù†ØªØ®Ø§Ø¨ Ú©Ù†ÛŒØ¯."),x("settings-page");return}const r=parseInt(C.value,10),y=Ht.split(`
`).slice(1).map(I=>{var S;return(S=I.split(",")[r])==null?void 0:S.trim()}).filter(I=>I&&I.length>0);y.length>0?(st(y),In(),x("csv-preview-page")):alert("Ù‡ÛŒÚ† Ù†Ø§Ù…ÛŒ Ø¯Ø± Ø³ØªÙˆÙ† Ø§Ù†ØªØ®Ø§Ø¨ Ø´Ø¯Ù‡ Ù¾ÛŒØ¯Ø§ Ù†Ø´Ø¯. Ù„Ø·ÙØ§Ù‹ Ø³ØªÙˆÙ† Ø¯ÛŒÚ¯Ø±ÛŒ Ø±Ø§ Ø§Ù…ØªØ­Ø§Ù† Ú©Ù†ÛŒØ¯ ÛŒØ§ ÙØ§ÛŒÙ„ Ø®ÙˆØ¯ Ø±Ø§ Ø¨Ø±Ø±Ø³ÛŒ Ú©Ù†ÛŒØ¯."),kt(null)}),E.addEventListener("click",()=>{m.click()}),m.addEventListener("change",r=>{const g=r.target.files[0];if(!g)return;const p=new FileReader;p.onload=y=>{const I=y.target.result;kt(I);const S=I.split(`
`)[0].split(",");Xs(S),x("column-mapping-page")},p.readAsText(g),r.target.value=null}),k.addEventListener("click",()=>{kt(null),x("settings-page")}),u.addEventListener("click",()=>{const r=c.querySelectorAll('input[type="checkbox"]:checked');let g=!1;r.forEach(p=>{const y=p.dataset.name,I=d.students.find(S=>S.identity.name.toLowerCase()===y.toLowerCase());if(I)if(I.isDeleted)qt(I,d);else{console.log(`Ø¯Ø§Ù†Ø´â€ŒØ¢Ù…ÙˆØ² Â«${y}Â» Ø¨Ù‡ Ø¯Ù„ÛŒÙ„ ØªÚ©Ø±Ø§Ø±ÛŒ Ø¨ÙˆØ¯Ù† Ø§Ø¶Ø§ÙÙ‡ Ù†Ø´Ø¯.`);return}const D=new wt({name:y});d.addStudent(D),d.sessions.length>0&&(U(d.sessions).filter(S=>S.isFinished&&!S.isCancelled).forEach(S=>{S.setAttendance(D.identity.studentId,"absent")}),Kn(D,d),g=!0)}),w(),W(d.info.name,`${r.length} Ø¯Ø§Ù†Ø´â€ŒØ¢Ù…ÙˆØ² Ø¬Ø¯ÛŒØ¯ Ø§Ø² Ù„ÛŒØ³Øª ÙˆØ±ÙˆØ¯ÛŒ Ø¨Ù‡ Ú©Ù„Ø§Ø³ Ø§Ø¶Ø§ÙÙ‡ Ø´Ø¯Ù†Ø¯.`,{type:"VIEW_SESSIONS"}),ke(),g&&Xn(r.length),x("settings-page"),i.value="",st([])}),f.addEventListener("click",()=>{st([]),x("settings-page")}),l.addEventListener("click",()=>{const r=i.value.trim();if(!r){alert("Ú©Ø§Ø¯Ø± Ù…ØªÙ†ÛŒ Ø®Ø§Ù„ÛŒ Ø§Ø³Øª. Ù„Ø·ÙØ§Ù‹ Ø§Ø³Ø§Ù…ÛŒ Ø±Ø§ ÙˆØ§Ø±Ø¯ Ú©Ù†ÛŒØ¯.");return}const g=r.split(`
`).map(p=>p.trim()).filter(p=>p.length>0);g.length>0?(st(g),In(),x("csv-preview-page")):alert("Ù‡ÛŒÚ† Ù†Ø§Ù… Ù…Ø¹ØªØ¨Ø±ÛŒ Ø¨Ø±Ø§ÛŒ ÙˆØ±ÙˆØ¯ Ù¾ÛŒØ¯Ø§ Ù†Ø´Ø¯.")}),a.addEventListener("keyup",r=>{r.key==="Enter"&&s.click()}),s.addEventListener("click",()=>{if(!d)return;const r=a.value.trim();if(!r){alert("Ù„Ø·ÙØ§Ù‹ Ù†Ø§Ù… Ø¯Ø§Ù†Ø´â€ŒØ¢Ù…ÙˆØ² Ø±Ø§ ÙˆØ§Ø±Ø¯ Ú©Ù†ÛŒØ¯.");return}const g=d.students.find(y=>y.identity.name.toLowerCase()===r.toLowerCase());if(g)if(g.isDeleted)qt(g,d);else{alert("âŒØ¯Ø§Ù†Ø´â€ŒØ¢Ù…ÙˆØ²ÛŒ Ø¨Ø§ Ø§ÛŒÙ† Ù†Ø§Ù… Ø§Ø² Ù‚Ø¨Ù„ Ø¯Ø± Ø§ÛŒÙ† Ú©Ù„Ø§Ø³ ÙˆØ¬ÙˆØ¯ Ø¯Ø§Ø±Ø¯.");return}const p=new wt({name:r});d.addStudent(p),d.sessions.length>0&&(U(d.sessions).filter(y=>y.isFinished&&!y.isCancelled).forEach(y=>{y.setAttendance(p.identity.studentId,"absent")}),Kn(p,d),Xn(1)),w(),W(d.info.name,`Ø¯Ø§Ù†Ø´â€ŒØ¢Ù…ÙˆØ² Â«${r}Â» Ø¨Ù‡ Ú©Ù„Ø§Ø³ Ø§Ø¶Ø§ÙÙ‡ Ø´Ø¯.`,{type:"VIEW_STUDENT_PROFILE",studentId:p.identity.studentId}),ke(),X(),a.value="",a.focus()}),document.getElementById("new-session-btn").addEventListener("click",()=>{if(d){const r=d.sessions.find(p=>!p.isFinished&&!p.isCancelled&&!p.isDeleted);if(r){b(`âš ï¸ Ø¬Ù„Ø³Ù‡ ${r.sessionNumber} Ù‡Ù†ÙˆØ² ØªÙ…Ø§Ù… Ù†Ø´Ø¯Ù‡ Ø§Ø³Øª. Ù„Ø·ÙØ§Ù‹ Ø§Ø¨ØªØ¯Ø§ Ø¨Ø§ Ø¯Ú©Ù…Ù‡ âœ… Ø¢Ù† Ø±Ø§ Ø®Ø§ØªÙ…Ù‡ Ø¯Ù‡ÛŒØ¯.`);return}const g=()=>{const p=y=>{const I=d.startNewSession();Qt(I),ue(I),d.students.forEach(T=>{Sn.setAttendance(T.identity.studentId,"present")}),w();const S=pe(d).get(I.sessionNumber);W(d.info.name,`Ø¬Ù„Ø³Ù‡ ${S} Ø´Ø±ÙˆØ¹ Ø´Ø¯.`,{type:"VIEW_SESSIONS"}),pt(y?"attendance":"selector")};z("Ø¢ÛŒØ§ ØªÙ…Ø§ÛŒÙ„ Ø¨Ù‡ Ø§Ù†Ø¬Ø§Ù… ÙØ±Ø¢ÛŒÙ†Ø¯ Ø­Ø¶ÙˆØ± Ùˆ ØºÛŒØ§Ø¨ Ø¯Ø§Ø±ÛŒØ¯ØŸ",()=>p(!0),{confirmText:"Ø¨Ù„Ù‡",cancelText:"Ø®ÛŒØ±",confirmClass:"btn-success",onCancel:()=>p(!1)})};d.hasSessionToday()?z("Ø´Ù…Ø§ Ø§Ù…Ø±ÙˆØ² ÛŒÚ© Ø¬Ù„Ø³Ù‡ Ø¨Ø±Ø§ÛŒ Ø§ÛŒÙ† Ú©Ù„Ø§Ø³ Ø«Ø¨Øª Ú©Ø±Ø¯Ù‡â€ŒØ§ÛŒØ¯. Ø¢ÛŒØ§ Ø§Ø² Ø´Ø±ÙˆØ¹ ÛŒÚ© Ø¬Ù„Ø³Ù‡ Ø¬Ø¯ÛŒØ¯ Ø¯ÛŒÚ¯Ø± Ù…Ø·Ù…Ø¦Ù† Ù‡Ø³ØªÛŒØ¯ØŸ",g,{confirmText:"Ø¨Ù„Ù‡",confirmClass:"btn-warning"}):g()}}),n.addEventListener("click",()=>{const r=t.value.trim(),g=document.querySelector('input[name="class-type"]:checked');if(!r&&!g){b("âš ï¸Ù„Ø·ÙØ§Ù‹ Ù†Ø§Ù… Ùˆ Ù†ÙˆØ¹ Ú©Ù„Ø§Ø³ Ø±Ø§ Ù…Ø´Ø®Øµ Ú©Ù†ÛŒØ¯.");return}if(!r){b("âš ï¸Ù„Ø·ÙØ§Ù‹ Ù†Ø§Ù… Ú©Ù„Ø§Ø³ Ø±Ø§ ÙˆØ§Ø±Ø¯ Ú©Ù†ÛŒØ¯.");return}if(!g){b("âš ï¸Ù„Ø·ÙØ§Ù‹ Ù†ÙˆØ¹ Ú©Ù„Ø§Ø³ Ø±Ø§ Ø§Ù†ØªØ®Ø§Ø¨ Ú©Ù†ÛŒØ¯.");return}if(L[r]){L[r].isDeleted?b("âš ï¸ Ú©Ù„Ø§Ø³ÛŒ Ø¨Ø§ Ø§ÛŒÙ† Ù†Ø§Ù… Ø¯Ø± Ø³Ø·Ù„ Ø²Ø¨Ø§Ù„Ù‡ Ø§Ø³Øª. Ø§Ø¨ØªØ¯Ø§ Ø¢Ù† Ø±Ø§ Ø¨Ø§Ø²ÛŒØ§Ø¨ÛŒ Ú©Ù†ÛŒØ¯ Ùˆ ÛŒØ§ Ø¢Ù† Ø±Ø§ Ù¾Ø§Ú© Ú©Ù†ÛŒØ¯."):b("âš ï¸Ú©Ù„Ø§Ø³ÛŒ Ø¨Ø§ Ø§ÛŒÙ† Ù†Ø§Ù… Ø§Ø² Ù‚Ø¨Ù„ ÙˆØ¬ÙˆØ¯ Ø¯Ø§Ø±Ø¯.");return}const p=g.value,y=new an({name:r,type:p});L[r]=y,w(),W(r,`Ú©Ù„Ø§Ø³ Â«${r}Â» Ø§ÛŒØ¬Ø§Ø¯ Ø´Ø¯.`,{type:"VIEW_SESSIONS"}),oe(),b(`âœ… Ú©Ù„Ø§Ø³ Â«${r}Â» Ø¨Ø§ Ù…ÙˆÙÙ‚ÛŒØª Ø§ÛŒØ¬Ø§Ø¯ Ø´Ø¯.`),t.value="",g.checked=!1}),e.addEventListener("input",r=>{const g=r.target.value;if(g.length<2){Ot([]);return}const p=g.toLowerCase(),y=sn(p),I=[];for(const D in L){const S=L[D];if(S.isDeleted)continue;U(S.students).filter(A=>{const q=Se(A.identity.name.toLowerCase()),te=q.includes(Se(p)),tt=q.includes(Se(y));return te||tt}).forEach(A=>{I.push({student:A,classroom:S})})}Ot(I)}),t.addEventListener("keyup",r=>{r.key==="Enter"&&n.click()}),o.addEventListener("click",_s),$.addEventListener("click",()=>{gt("selector")}),J.addEventListener("input",r=>{const g=r.target.value;if(!g){at([]);return}const p=g.toLowerCase(),y=sn(p),D=U(d.students).filter(S=>{const T=Se(S.identity.name.toLowerCase()),A=T.includes(Se(p)),q=T.includes(Se(y));return A||q});at(D)}),J.addEventListener("focus",()=>{J.value&&at(J.value)}),Oe.addEventListener("click",()=>{const r=Ie.value,g=he.value.trim();let p;if(Ft)p=Ft.student;else{const I=h==null?void 0:h.winnerHistory[ge];p=I==null?void 0:I.winner}if(!p){b("âŒØ®Ø·Ø§: Ø¯Ø§Ù†Ø´â€ŒØ¢Ù…ÙˆØ² Ù…Ø¹ØªØ¨Ø±ÛŒ Ø¨Ø±Ø§ÛŒ Ø«Ø¨Øª Ù†Ù…Ø±Ù‡ ÛŒØ§ÙØª Ù†Ø´Ø¯.");return}const y=de;if(!p||!y){b("âš ï¸Ù„Ø·ÙØ§Ù‹ Ø§Ø¨ØªØ¯Ø§ ÛŒÚ© Ø¯Ø§Ù†Ø´â€ŒØ¢Ù…ÙˆØ² Ùˆ ÛŒÚ© Ø¯Ø³ØªÙ‡â€ŒØ¨Ù†Ø¯ÛŒ Ø±Ø§ Ø§Ù†ØªØ®Ø§Ø¨ Ú©Ù†ÛŒØ¯.");return}if(!r){b("âš ï¸Ù„Ø·ÙØ§Ù‹ Ù…Ù‚Ø¯Ø§Ø± Ù†Ù…Ø±Ù‡ Ø±Ø§ ÙˆØ§Ø±Ø¯ Ú©Ù†ÛŒØ¯.");return}if(r>100||r<0){b("âŒÙ†Ù…Ø±Ù‡ Ù†Ø¨Ø§ÛŒØ¯ Ø§Ø² Û±Û°Û° Ø¨ÛŒØ´ØªØ± Ùˆ Ø§Ø² ØµÙØ± Ú©Ù…ØªØ± Ø¨Ø§Ø´Ø¯");return}p&&(p.addScore(y.name,parseFloat(r),g),W(d.info.name,`Ù†Ù…Ø±Ù‡ ${r} Ø¯Ø± ${y.name} Ø¨Ø±Ø§ÛŒ Â«${p.identity.name}Â» Ø«Ø¨Øª Ø´Ø¯.`,{type:"VIEW_STUDENT_PROFILE",studentId:p.identity.studentId}),w(),X(),b(`âœ…Ù†Ù…Ø±Ù‡ Ø¨Ø±Ø§ÛŒ ${p.identity.name} Ø¯Ø± Ù…Ù‡Ø§Ø±Øª ${y.name} Ø«Ø¨Øª Ø´Ø¯.`),Ie.value="",he.value="",ce())});const jn=r=>{r.key==="Enter"&&r.ctrlKey&&(r.preventDefault(),Oe.click())};Ie.addEventListener("keydown",jn),he.addEventListener("keydown",jn),j.addEventListener("click",()=>{P()}),H.addEventListener("click",()=>{const r=Fe.value.trim(),g=Tn;P(()=>{typeof g=="function"&&g(r)})});const oo=document.getElementById("move-student-confirm-btn"),ao=document.getElementById("move-student-cancel-btn"),io=document.getElementById("move-student-class-select");ao.addEventListener("click",()=>{P()}),oo.addEventListener("click",()=>{const r=io.value,g=L[r],{studentToMove:p,sourceClassForMove:y}=vo;if(!p||!y||!g){b("Ø®Ø·Ø§ÛŒÛŒ Ø±Ø® Ø¯Ø§Ø¯. Ù„Ø·ÙØ§Ù‹ Ø¯ÙˆØ¨Ø§Ø±Ù‡ Ø§Ù…ØªØ­Ø§Ù† Ú©Ù†ÛŒØ¯âš ï¸.","error"),P();return}const I=ds(p,y,g);I.success?(W(y.info.name,`Ø¯Ø§Ù†Ø´â€ŒØ¢Ù…ÙˆØ² Â«${p.identity.name}Â» Ø¨Ù‡ Ú©Ù„Ø§Ø³ Â«${r}Â» Ù…Ù†ØªÙ‚Ù„ Ø´Ø¯.`,{type:"VIEW_SESSIONS"}),W(r,`Ø¯Ø§Ù†Ø´â€ŒØ¢Ù…ÙˆØ² Â«${p.identity.name}Â» Ø§Ø² Ú©Ù„Ø§Ø³ Â«${y.info.name}Â» Ø¨Ù‡ Ø§ÛŒÙ† Ú©Ù„Ø§Ø³ Ù…Ù†ØªÙ‚Ù„ Ø´Ø¯.`,{type:"VIEW_SESSIONS"}),w(),ke(),b(`Ø¯Ø§Ù†Ø´â€ŒØ¢Ù…ÙˆØ² Â«${p.identity.name}Â» Ø¨Ø§ Ù…ÙˆÙÙ‚ÛŒØª Ø¨Ù‡ Ú©Ù„Ø§Ø³ Â«${r}Â» Ù…Ù†ØªÙ‚Ù„ Ø´Ø¯âœ….`)):b(I.message,"error"),P()}),ie.addEventListener("click",()=>{le.style.width="300px",se.classList.add("modal-visible")}),K.addEventListener("click",fe),se.addEventListener("click",fe),so.addEventListener("click",()=>{yt(),x("trash-page"),fe()}),document.getElementById("demo-mode-btn").addEventListener("click",()=>{Ee?Jn():(fe(),z("Ø´Ù…Ø§ Ø¯Ø± Ø­Ø§Ù„ ÙˆØ±ÙˆØ¯ Ø¨Ù‡ Ø­Ø§Ù„Øª Ù†Ù…Ø§ÛŒØ´ (Demo) Ù‡Ø³ØªÛŒØ¯. Ø¯Ø± Ø§ÛŒÙ† Ø­Ø§Ù„ØªØŒ Ù‡ÛŒÚ†â€ŒÚ©Ø¯Ø§Ù… Ø§Ø² ØªØºÛŒÛŒØ±Ø§Øª Ø´Ù…Ø§ Ø°Ø®ÛŒØ±Ù‡ Ù†Ø®ÙˆØ§Ù‡Ø¯ Ø´Ø¯. Ø¢ÛŒØ§ Ø§Ø¯Ø§Ù…Ù‡ Ù…ÛŒâ€ŒØ¯Ù‡ÛŒØ¯ØŸ",()=>{hs(),Rt(),fe()},{confirmText:"ØªØ§ÛŒÛŒØ¯",confirmClass:"btn-warning",onCancel:fe}))});const zn=document.getElementById("exit-demo-btn");zn&&zn.addEventListener("click",()=>{Ee&&Jn()}),re.addEventListener("click",()=>{if(Ee){b("âš ï¸ Ù¾Ø´ØªÛŒØ¨Ø§Ù†â€ŒÚ¯ÛŒØ±ÛŒ Ø¯Ø± Ø­Ø§Ù„Øª Ù†Ù…Ø§ÛŒØ´ (Demo) ØºÛŒØ±ÙØ¹Ø§Ù„ Ø§Ø³Øª."),fe();return}fe(),ht()}),bt.addEventListener("click",()=>{if(Ee){b("âš ï¸ Ø¨Ø§Ø²ÛŒØ§Ø¨ÛŒ Ø§Ø·Ù„Ø§Ø¹Ø§Øª Ø¯Ø± Ø­Ø§Ù„Øª Ù†Ù…Ø§ÛŒØ´ (Demo) ØºÛŒØ±ÙØ¹Ø§Ù„ Ø§Ø³Øª."),fe();return}Ye.click(),fe()}),Ye.addEventListener("change",r=>{const g=r.target.files[0];if(!g)return;const p=new FileReader;p.onload=y=>{try{const I=JSON.parse(y.target.result);if(I.metadata&&I.data)Ps(I);else{const D=I.classrooms||I,S=I.trashBin||[];z("Ø¢ÛŒØ§ Ø§Ø² Ø¨Ø§Ø²ÛŒØ§Ø¨ÛŒ Ø§Ø·Ù„Ø§Ø¹Ø§Øª Ù…Ø·Ù…Ø¦Ù† Ù‡Ø³ØªÛŒØ¯ØŸ ØªÙ…Ø§Ù… Ø¯Ø§Ø¯Ù‡â€ŒÙ‡Ø§ÛŒ ÙØ¹Ù„ÛŒ Ø´Ù…Ø§ Ø¨Ø§Ø²Ù†ÙˆÛŒØ³ÛŒ Ø®ÙˆØ§Ù‡Ø¯ Ø´Ø¯.",()=>{Ae(D),zt(S),it({lastRestoreTimestamp:new Date().toISOString()}),w(),oe(),x("class-management-page"),b("âœ…Ø§Ø·Ù„Ø§Ø¹Ø§Øª Ø¨Ø§ Ù…ÙˆÙÙ‚ÛŒØª Ø¨Ø§Ø²ÛŒØ§Ø¨ÛŒ Ø´Ø¯.")},{confirmText:"Ø¨Ø§Ø²ÛŒØ§Ø¨ÛŒ Ú©Ù†",confirmClass:"btn-warning"})}}catch(I){b("âŒØ®Ø·Ø§ Ø¯Ø± Ø®ÙˆØ§Ù†Ø¯Ù† ÙØ§ÛŒÙ„. Ù„Ø·ÙØ§Ù‹ ÙØ§ÛŒÙ„ Ù¾Ø´ØªÛŒØ¨Ø§Ù† Ù…Ø¹ØªØ¨Ø± Ø§Ù†ØªØ®Ø§Ø¨ Ú©Ù†ÛŒØ¯."),console.error("Restore error:",I)}},p.readAsText(g),r.target.value=null}),window.addEventListener("popstate",r=>{if(De){P(null,!0);return}if($e(),r.state){const{pageId:g,currentClassName:p,selectedSessionNumber:y,selectedStudentId:I}=r.state;p&&(ne(L[p]),y&&ue(d.getSession(y)),I&&me(d.students.find(D=>D.identity.studentId===I))),g==="session-page"?(ae(),ut(g)):g==="student-profile-page"?(ae(),x("session-page"),Q(_)):ut(g)}else ne(null),ue(null),me(null),ut("class-management-page")}),document.addEventListener("keydown",r=>{var y;const g=document.activeElement;if(!["INPUT","TEXTAREA","SELECT"].includes(g.tagName)){if(r.key.toLowerCase()==="o"&&r.shiftKey&&Ns.classList.contains("active")&&(r.preventDefault(),Ts.click()),r.key==="Escape"){if(Re.classList.contains("visible")){$e();return}if(De){P();return}switch((y=document.querySelector(".page.active"))==null?void 0:y.id){case"csv-preview-page":case"column-mapping-page":x("settings-page");break;case"student-profile-page":me(null),x(h?"student-page":"session-page");break;case"attendance-page":x("student-page");break;case"student-page":ue(null),ae(),x("session-page");break;case"settings-page":case"session-page":ne(null),x("class-management-page");break}return}if(h){const I=r.key.toLowerCase();switch(" ascfg".includes(I)&&r.preventDefault(),I){case" ":G.click();break;case"a":ee.classList.contains("active")?history.back():(We(),x("attendance-page"));break;case"s":document.getElementById("session-page").classList.contains("active")&&history.back();break;case"c":document.querySelector(".back-to-classes-btn").click();break;case"f":const D=document.querySelector(".action-column .search-icon");D&&D.click();break;case"g":if(studentProfilePage.classList.contains("active"))history.back();else{const S=h.lastSelectedWinnerId;if(S){const T=d.students.find(A=>A.identity.studentId===S);T&&(me(T),(void 0)(),x("student-profile-page"))}else b("âš ï¸Ø§Ø¨ØªØ¯Ø§ ÛŒÚ© Ù†ÙØ± Ø±Ø§ Ø§Ù†ØªØ®Ø§Ø¨ Ú©Ù†ÛŒØ¯ ØªØ§ Ù¾Ø±ÙˆÙØ§ÛŒÙ„ Ø§Ùˆ Ù†Ù…Ø§ÛŒØ´ Ø¯Ø§Ø¯Ù‡ Ø´ÙˆØ¯.")}break;case"arrowleft":{const S=document.querySelector('button[title="Ø¨Ø±Ù†Ø¯Ù‡ Ù‚Ø¨Ù„ÛŒ"]');S&&!S.disabled&&(r.preventDefault(),S.click());break}case"arrowright":{const S=document.querySelector('button[title="Ø¨Ø±Ù†Ø¯Ù‡ Ø¨Ø¹Ø¯ÛŒ"]');S&&!S.disabled&&(r.preventDefault(),S.click());break}}}}});function fe(){le.style.width="0",se.classList.add("modal-closing"),setTimeout(()=>{se.classList.remove("modal-visible","modal-closing")},300)}function Jn(){z("Ø¢ÛŒØ§ Ø§Ø² Ø®Ø±ÙˆØ¬ Ø§Ø² Ø­Ø§Ù„Øª Ù†Ù…Ø§ÛŒØ´ (Demo) Ù…Ø·Ù…Ø¦Ù† Ù‡Ø³ØªÛŒØ¯ØŸ Ø¨Ø§ Ø®Ø±ÙˆØ¬ØŒ ØªÙ…Ø§Ù… ØªØºÛŒÛŒØ±Ø§Øª Ø¢Ø²Ù…Ø§ÛŒØ´ÛŒ Ø´Ù…Ø§ Ø­Ø°Ù Ø´Ø¯Ù‡ Ùˆ Ø¯Ø§Ø¯Ù‡â€ŒÙ‡Ø§ÛŒ Ø§ØµÙ„ÛŒ Ø´Ù…Ø§ Ø¨Ø§Ø²ÛŒØ§Ø¨ÛŒ Ø®ÙˆØ§Ù‡Ù†Ø¯ Ø´Ø¯.",()=>{ys(),ne(null),ue(null),me(null),oe(),x("class-management-page"),Rt(),fe()},{confirmText:"Ø®Ø±ÙˆØ¬",confirmClass:"btn-success"})}Gn(".global-search-container .animated-search-container",Ot),Gn(".action-column-header .animated-search-container",at),Ua(),[O,Os,he,Ds].forEach(r=>{r&&js(r)});function Kn(r,g){const p=U(g.students).filter(F=>F.identity.studentId!==r.identity.studentId);if(p.length===0)return;const y=p.reduce((F,Z)=>Z.statusCounters.totalSelections>F.statusCounters.totalSelections?Z:F,p[0]);if(!y||y.statusCounters.totalSelections===0)return;r.categoryCounts=JSON.parse(JSON.stringify(y.categoryCounts)),r.statusCounters.totalSelections=y.statusCounters.totalSelections;const I=p.reduce((F,Z)=>F+Z.statusCounters.totalSelections,0),D=p.reduce((F,Z)=>F+(Z.statusCounters.missedChances||0),0),S=I>0?D/I:0;r.statusCounters.missedChances=Math.round(r.statusCounters.totalSelections*S);const T=U(g.categories),A={};T.forEach(F=>{const Z=p.reduce((tn,nn)=>tn+(nn.categoryCounts[F.name]||0),0),en=p.reduce((tn,nn)=>tn+(nn.categoryIssues[F.name]||0),0);A[F.name]=Z>0?en/Z:0}),T.forEach(F=>{const Z=r.categoryCounts[F.name]||0,en=A[F.name]||0;r.categoryIssues[F.name]=Math.round(Z*en)});const q=g.liveSession;q?r.onboardingSession=q.sessionNumber:r.onboardingSession=g.sessions.length+1;const te=U(g.sessions).filter(F=>F.isFinished&&!F.isCancelled),tt="ğŸ“ ÛŒØ§Ø¯Ø¯Ø§Ø´Øª Ø®ÙˆØ¯Ú©Ø§Ø± Ø³ÛŒØ³ØªÙ…",ho=`Ø§ÛŒÙ† Ø¯Ø§Ù†Ø´â€ŒØ¢Ù…ÙˆØ²  Ø§Ø² Ø¬Ù„Ø³Ù‡ Ø´Ù…Ø§Ø±Ù‡ ${te.length} Ø¨Ù‡ Ú©Ù„Ø§Ø³ Ø§Ø¶Ø§ÙÙ‡ Ø´Ø¯. Ø¢Ù…Ø§Ø± Ù…Ø´Ø§Ø±Ú©Øª Ø§Ùˆ Ø¨Ø± Ø§Ø³Ø§Ø³ ÙØ¹Ø§Ù„â€ŒØªØ±ÛŒÙ† Ø¯Ø§Ù†Ø´â€ŒØ¢Ù…ÙˆØ² Ùˆ Ø¢Ù…Ø§Ø± Â«ÙØ±ØµØª Ø§Ø² Ø¯Ø³Øª Ø±ÙØªÙ‡Â» Ø§Ùˆ Ø¨Ø± Ø§Ø³Ø§Ø³ Ù…ÛŒØ§Ù†Ú¯ÛŒÙ† Ú©Ù„Ø§Ø³ Ø«Ø¨Øª Ú¯Ø±Ø¯ÛŒØ¯:`,qe=[];r.statusCounters.totalSelections>0&&qe.push(`Ú©Ù„ Ø§Ù†ØªØ®Ø§Ø¨â€ŒÙ‡Ø§: ${r.statusCounters.totalSelections}`),r.statusCounters.missedChances>0&&qe.push(`ÙØ±ØµØªâ€ŒÙ‡Ø§ÛŒ Ø§Ø² Ø¯Ø³Øª Ø±ÙØªÙ‡: ${r.statusCounters.missedChances}`);for(const F in r.categoryCounts){const Z=r.categoryCounts[F];Z>0&&qe.push(`Ø§Ù†ØªØ®Ø§Ø¨ Ø¯Ø± Â«${F}Â»: ${Z}`)}for(const F in r.categoryIssues){const Z=r.categoryIssues[F];Z>0&&qe.push(`Ù…Ø´Ú©Ù„ Ø¯Ø± Â«${F}Â»: ${Z}`)}if(qe.length>0){const F=`${tt}
${ho}

- ${qe.join(`
- `)}`;r.addNote(F)}}function Xn(r){const p=`Ú†ÙˆÙ† Ø§ÛŒÙ† Ú©Ù„Ø§Ø³ Ø¬Ù„Ø³Ø§Øª Ø¨Ø±Ú¯Ø²Ø§Ø± Ø´Ø¯Ù‡ Ø¯Ø§Ø±Ø¯ØŒ Ø¨Ø±Ø§ÛŒ ${r>1?"Ø¯Ø§Ù†Ø´â€ŒØ¢Ù…ÙˆØ²Ø§Ù† Ø¬Ø¯ÛŒØ¯":"Ø¯Ø§Ù†Ø´â€ŒØ¢Ù…ÙˆØ² Ø¬Ø¯ÛŒØ¯"} Ø¢Ù…Ø§Ø± Ù¾Ø§ÛŒÙ‡â€ŒØ§ÛŒ (Ù…ØªÙ†Ø§Ø³Ø¨ Ø¨Ø§ Ø³Ø§ÛŒØ± Ø¯Ø§Ù†Ø´â€ŒØ¢Ù…ÙˆØ²Ø§Ù†) Ø«Ø¨Øª Ø´Ø¯ ØªØ§ Ø¯Ø± ÙØ±Ø§ÛŒÙ†Ø¯ Ø§Ù†ØªØ®Ø§Ø¨ Ø§Ø®ØªÙ„Ø§Ù„ÛŒ Ø§ÛŒØ¬Ø§Ø¯ Ù†Ø´ÙˆØ¯.`;z(p,()=>{},{confirmText:"Ù…ØªÙˆØ¬Ù‡ Ø´Ø¯Ù…",confirmClass:"btn-success",onCancel:null})}const co="9.11.0";document.getElementById("app-version").textContent=`Ù†Ø³Ø®Ù‡ ${co}`;function lo(){console.log("Starting universal backfill for writing scores...");let r=0;for(const g in L){const p=L[g];if(p.isDeleted)continue;let y=0;U(p.students).forEach(D=>{const S=D.logs.scores;if(!(S&&S.writing&&S.writing.length>0)){let A=-1;for(const q in S)q!=="writing"&&S[q].forEach(te=>{te.value>A&&(A=te.value)});if(A>-1){const q=`Automatically assigned based on the highest score (${A}) from other skills.`;D.addScore("Writing",A,q),y++}}}),y>0&&(console.log(`Updated ${y} student(s) in class: ${p.info.name}.`),r+=y)}r>0?(w(),console.log(`Update complete. A total of ${r} student(s) were updated across all classes. Data saved.`),document.getElementById("student-page").classList.contains("active")&&X()):console.log("No students needed updating in any class.")}window.backfillWritingScoresForAll=lo;function ro(){console.log("Starting backfill for 'outOfClassCount' and 'wasOutOfClass' properties...");let r=0,g=0;const p=localStorage.getItem("teacherAssistantData_v2");if(!p){console.log("No data found in localStorage. Nothing to do.");return}const y=JSON.parse(p);for(const I in y){const D=y[I];D.students&&D.students.forEach(S=>{S.statusCounters&&typeof S.statusCounters.outOfClassCount>"u"&&(S.statusCounters.outOfClassCount=0,r++)}),D.sessions&&D.sessions.forEach(S=>{if(S.studentRecords)for(const T in S.studentRecords){const A=S.studentRecords[T];typeof A.wasOutOfClass>"u"&&(A.wasOutOfClass=!1,g++)}})}localStorage.setItem("teacherAssistantData_v2",JSON.stringify(y)),console.log(`Backfill complete. Updated ${r} students and ${g} session records. Data saved.`),Ut(),d&&X()}window.backfillExitCounters=ro;function uo(){console.log("ğŸ§¹ Starting orphaned data cleanup...");let r=0;for(const g in L){const p=L[g];if(p.isDeleted)continue;let y=!1;const I=new Set(p.students.filter(T=>!T.isDeleted).map(T=>T.identity.studentId)),D=new Map(p.students.map(T=>[T.identity.studentId,T.identity.name])),S=[];p.sessions.forEach(T=>{if(T.isDeleted)return;const A=[];for(const q in T.studentRecords)if(!I.has(q)){const te=D.get(q)||"Unknown/Deleted";A.push(`  - Removed student record for: ${te} (ID: ${q})`),delete T.studentRecords[q],r++,y=!0}for(const q in T.lastWinnerByCategory){const te=T.lastWinnerByCategory[q];if(!I.has(te)){const tt=D.get(te)||"Unknown/Deleted";A.push(`  - Removed '${q}' last winner: ${tt} (ID: ${te})`),delete T.lastWinnerByCategory[q],r++,y=!0}}if(T.lastSelectedWinnerId&&!I.has(T.lastSelectedWinnerId)){const q=T.lastSelectedWinnerId,te=D.get(q)||"Unknown/Deleted";A.push(`  - Cleared 'lastSelectedWinnerId': ${te} (ID: ${q})`),T.lastSelectedWinnerId=null,r++,y=!0}if(A.length>0){const te=pe(p).get(T.sessionNumber)||`(#${T.sessionNumber})`;S.push({sessionDisplayNumber:te,logs:A})}}),y&&(console.group(`â¡ï¸ Class: ${g}`),S.forEach(T=>{console.groupCollapsed(`  Session ${T.sessionDisplayNumber}`),T.logs.forEach(A=>console.warn(A)),console.groupEnd()}),console.groupEnd())}r>0?(w(),console.log(`âœ… Cleanup complete! Found and removed ${r} orphaned references. Data saved.`)):console.log("âœ… No orphaned data found. Your data is clean!")}window.cleanupOrphanedData=uo;function mo(r){if(!r||!r.classroomName)return;const g=L[r.classroomName];if(!g){b("âš ï¸ Ú©Ù„Ø§Ø³ Ù…Ø±Ø¨ÙˆØ· Ø¨Ù‡ Ø§ÛŒÙ† Ú¯Ø²Ø§Ø±Ø´ ÛŒØ§ÙØª Ù†Ø´Ø¯.");return}ne(g),P(),setTimeout(()=>{switch(r.type){case"VIEW_STUDENT_PROFILE":{const p=g.students.find(y=>y.identity.studentId===r.studentId);p?Q(p):b("âš ï¸ Ø¯Ø§Ù†Ø´â€ŒØ¢Ù…ÙˆØ² Ù…ÙˆØ±Ø¯ Ù†Ø¸Ø± ÛŒØ§ÙØª Ù†Ø´Ø¯.");break}case"VIEW_TRASH":yt(),x("trash-page");break;case"VIEW_SESSIONS":ae(),x("session-page");break;case"VIEW_CLASS_NOTE":Fn(g);break;case"VIEW_CLASS_SETTINGS":Un(g);break}},300)}et.addEventListener("click",()=>{qs()}),Zs.addEventListener("click",()=>{P()}),eo.addEventListener("click",()=>{const r=to.value.trim(),g=no.checked;if(!r){Wn.style.display==="flex"?z("Ú©Ø§Ø¯Ø± ÛŒØ§Ø¯Ø¯Ø§Ø´Øª Ø®Ø§Ù„ÛŒ Ø§Ø³Øª. Ø¢ÛŒØ§ Ù…Ø·Ù…Ø¦Ù†ÛŒØ¯ Ú©Ù‡ Ù…ÛŒâ€ŒØ®ÙˆØ§Ù‡ÛŒØ¯ ÛŒØ§Ø¯Ø¯Ø§Ø´Øªâ€ŒÙ‡Ø§ÛŒ Ù‚Ø¨Ù„ÛŒ Ø¯Ø§Ù†Ø´â€ŒØ¢Ù…ÙˆØ²Ø§Ù† Ø§Ù†ØªØ®Ø§Ø¨â€ŒØ´Ø¯Ù‡ Ø±Ø§ Ù¾Ø§Ú© Ú©Ù†ÛŒØ¯ØŸ",()=>{P(),bn("",!1)},{confirmText:"Ù¾Ø§Ú© Ú©Ø±Ø¯Ù†",confirmClass:"btn-warning"}):b("âš ï¸ Ù„Ø·ÙØ§Ù‹ Ù…ØªÙ† ÛŒØ§Ø¯Ø¯Ø§Ø´Øª Ø±Ø§ ÙˆØ§Ø±Ø¯ Ú©Ù†ÛŒØ¯.");return}P(()=>{bn(r,g)})});const xe=document.getElementById("screen-saver-overlay"),Qn=document.getElementById("screen-saver-toggle");let Zt;const fo=2*60*1e3,Yn=["mousemove","keypress","scroll","click","touchstart"];function po(){xe.classList.add("visible")}function Zn(){xe.classList.contains("visible")&&xe.classList.remove("visible")}function St(){Zn(),clearTimeout(Zt),Zt=setTimeout(po,fo)}function Lt(r){r.preventDefault(),r.stopPropagation(),setTimeout(St,0)}function es(){St(),Yn.forEach(g=>window.addEventListener(g,St)),xe.addEventListener("click",Lt),xe.addEventListener("touchstart",Lt);const r="9.11.0";{const g=document.getElementById("screen-saver-version");g&&(g.textContent=`v${r}`)}}function go(){clearTimeout(Zt),Zn(),Yn.forEach(r=>window.removeEventListener(r,St)),xe.removeEventListener("click",Lt),xe.removeEventListener("touchstart",Lt)}Qn.checked=ye.isScreenSaverEnabled,ye.isScreenSaverEnabled&&es(),Qn.addEventListener("change",r=>{r.target.checked?(it({isScreenSaverEnabled:!0}),es()):(fe(),r.preventDefault(),z(`Ù†Ú©ØªÙ‡:
Ù…Ø­Ø§ÙØ¸ ØµÙØ­Ù‡ Ø¯Ø± ØªÙ„ÙÙ† Ù‡Ø§ÛŒ Ù‡Ù…Ø±Ø§Ù‡ Ø¬Ø¯ÛŒØ¯ Ú©Ù…Ú© Ù…ÛŒ Ú©Ù†Ø¯ Ú©Ù‡ Ø¯Ø³ØªÚ¯Ø§Ù‡ Ø¨Ø§Ø·Ø±ÛŒ Ú©Ù…ØªØ±ÛŒ Ù…ØµØ±Ù Ú©Ù†Ø¯ Ùˆ Ø¨Ù‡ Ø¯Ù„ÛŒÙ„ Ø«Ø§Ø¨Øª Ù…Ø§Ù†Ø¯Ù† ØµÙØ­Ù‡ Ù†Ù…Ø§ÛŒØ´ Ø¯Ø± Ú¯ÙˆØ´ÛŒ Ù‡Ø§ÛŒ Ù‚Ø¯ÛŒÙ…ÛŒ ØªØ±ØŒ ØµÙØ­Ù‡ Ù†Ù…Ø§ÛŒØ´ Ø¯Ú†Ø§Ø± Ù…Ø§Ù†Ø¯Ú¯ÛŒ Ø±Ø¯ Ù¾ÛŒÚ©Ø³Ù„ Ù†Ú¯Ø±Ø¯Ø¯. Ø¢ÛŒØ§ Ù…Ø·Ù…Ø¦Ù† Ù‡Ø³ØªÛŒØ¯ Ú©Ù‡ Ù…ÛŒ Ø®ÙˆØ§Ù‡ÛŒØ¯ Ø§ÛŒÙ† ÙˆÛŒÚ˜Ú¯ÛŒ Ø±Ø§ ØºÛŒØ± ÙØ¹Ø§Ù„ Ú©Ù†ÛŒØ¯ØŸ`,()=>{r.target.checked=!1,it({isScreenSaverEnabled:!1}),go(),b("ØªÙˆØµÛŒÙ‡ Ù…ÛŒ Ø´ÙˆØ¯ Ø²Ù…Ø§Ù† Ø®Ø§Ù…ÙˆØ´ Ø´Ø¯Ù† ØµÙØ­Ù‡ Ù†Ù…Ø§ÛŒØ´ Ú¯ÙˆØ´ÛŒ Ø®ÙˆØ¯ Ø±Ø§ Ø¨Ù‡ Ø­Ø¯Ø§Ù‚Ù„ Ø¯Ùˆ Ø¯Ù‚ÛŒÙ‚Ù‡ ØªØºÛŒÛŒØ± Ø¯Ù‡ÛŒØ¯ ØªØ§ Ø¯Ø± Ø§Ø³ØªÙØ§Ø¯Ù‡ Ù‡Ø§ÛŒ Ø·ÙˆÙ„Ø§Ù†ÛŒ Ù…Ø¯Øª ØµÙØ­Ù‡ Ù†Ù…Ø§ÛŒØ´ Ú¯ÙˆØ´ÛŒ Ø§ØµØ·Ø­Ù„Ø§Ú© Ú©Ù…ØªØ±ÛŒ Ø±Ø§ ØªØ¬Ø±Ø¨Ù‡ Ú©Ù†Ø¯",7e3)},{confirmText:"Ø¨Ù„Ù‡ØŒ ØºÛŒØ±ÙØ¹Ø§Ù„ Ú©Ù†",cancelText:"Ù„ØºÙˆ",onCancel:()=>{r.target.checked=!0}}))})});function Fa(e,t){if(!h||h.isFinished){b("âš ï¸ Ø§Ù…Ú©Ø§Ù† Ù„ØºÙˆ Ø§Ù†ØªØ®Ø§Ø¨ Ø¯Ø± Ø¬Ù„Ø³Ù‡ Ø®Ø§ØªÙ…Ù‡ ÛŒØ§ÙØªÙ‡ ÙˆØ¬ÙˆØ¯ Ù†Ø¯Ø§Ø±Ø¯.");return}const n=h.winnerHistory;if(!(ge===n.length-1)||n.length===0){b("âš ï¸ ÙÙ‚Ø· Ø¢Ø®Ø±ÛŒÙ† Ø§Ù†ØªØ®Ø§Ø¨ Ù‚Ø§Ø¨Ù„ Ù„ØºÙˆ Ø§Ø³Øª.");return}if(n[n.length-1].winner.identity.studentId!==e.identity.studentId){console.error("Undo mismatch!");return}z(`Ø¢ÛŒØ§ Ø§Ø² Ø­Ø°Ù Ø§Ù†ØªØ®Ø§Ø¨ Â«${e.identity.name}Â» Ø¨Ø±Ø§ÛŒ Â«${t}Â» Ù…Ø·Ù…Ø¦Ù† Ù‡Ø³ØªÛŒØ¯ØŸ Ø¢Ù…Ø§Ø± Ø§ÛŒÙ† Ø§Ù†ØªØ®Ø§Ø¨ Ø¨Ø§Ø²Ú¯Ø±Ø¯Ø§Ù†ÛŒ Ø®ÙˆØ§Ù‡Ø¯ Ø´Ø¯.`,()=>{const a=h.winnerHistory,s=a.pop();if(!s)return;const i=s.winner,l=s.categoryName,c=i.identity.studentId;i.statusCounters.totalSelections=Math.max(0,i.statusCounters.totalSelections-1),i.categoryCounts[l]&&(i.categoryCounts[l]=Math.max(0,i.categoryCounts[l]-1));const u=h.studentRecords[c];u&&u.selections[l]&&(u.selections[l]=Math.max(0,u.selections[l]-1));let f=null;for(let E=a.length-1;E>=0;E--)if(a[E].categoryName===l){f=a[E].winner.identity.studentId;break}f?h.lastWinnerByCategory[l]=f:delete h.lastWinnerByCategory[l],Te(a.length-1),X(),ce(),w(),b(`âœ… Ø§Ù†ØªØ®Ø§Ø¨ Â«${i.identity.name}Â» Ù„ØºÙˆ Ø´Ø¯.`)},{confirmText:"Ø¨Ù„Ù‡",confirmClass:"btn-warning"})}function Ua(){const e=document.getElementById("session-dashboard-page"),t=document.getElementById("student-stats-table-container");if(!e)return;let n=0,o=0;e.addEventListener("touchstart",s=>{if(t&&t.contains(s.target)){const i=s.target.closest("td, th");i&&i.parentElement.firstElementChild===i?n=s.changedTouches[0].screenX:n=0}else n=s.changedTouches[0].screenX},{passive:!0}),e.addEventListener("touchend",s=>{n!==0&&(o=s.changedTouches[0].screenX,a())});function a(){const i=n-o;Math.abs(i)>100&&(document.getElementById("selector-tab-btn").classList.contains("active")?(x("session-dashboard-page",{tab:"attendance"}),gt("attendance")):(x("session-dashboard-page",{tab:"selector"}),gt("selector"))),n=0,o=0}}
