(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const a of document.querySelectorAll('link[rel="modulepreload"]'))s(a);new MutationObserver(a=>{for(const i of a)if(i.type==="childList")for(const o of i.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&s(o)}).observe(document,{childList:!0,subtree:!0});function n(a){const i={};return a.integrity&&(i.integrity=a.integrity),a.referrerPolicy&&(i.referrerPolicy=a.referrerPolicy),a.crossOrigin==="use-credentials"?i.credentials="include":a.crossOrigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function s(a){if(a.ep)return;a.ep=!0;const i=n(a);fetch(a.href,i)}})();class tt{constructor(t){this.identity={name:t.name,studentId:t.studentId||`id_${new Date().getTime()}_${Math.random()}`,branchName:t.branchName||null,ageGroup:t.ageGroup||"adult",level:t.level||null,contact:{social:t.socialContact||null,parent:t.parentContact||null}},this.isDeleted=!1,this.statusCounters={totalSelections:0,missedChances:0,earlyLeaves:0,outOfClassCount:0},this.categoryCounts={},this.categoryIssues={},this.logs={parentContacts:[],scores:{},discipline:{},sessionHistory:{}},this.profile={notes:[],tags:[]},this.finalClassActivityScore=null}addScore(t,n,s){if(n>100||n<0){console.log("Ù†Ù…Ø±Ù‡ Ù†Ø¨Ø§ÛŒØ¯ Ø§Ø² Û±Û°Û° Ø¨ÛŒØ´ØªØ± Ùˆ Ø§Ø² ØµÙØ± Ú©Ù…ØªØ± Ø¨Ø§Ø´Ø¯");return}const a=t.toLowerCase();this.logs.scores[a]||(this.logs.scores[a]=[]);const i=new Ls(t,n,s);this.logs.scores[a].push(i)}addNote(t,n=null){const s=new Is(t,n);this.profile.notes.push(s)}getOverallAverageScore(){let t=0,n=0;for(const a in this.logs.scores)this.logs.scores[a].forEach(i=>{i.isDeleted||(t+=i.value,n++)});if(n===0)return null;const s=t/n;return Math.round(s*100)/100}}class Ls{constructor(t,n,s=""){this.id=`score_${new Date().getTime()}`,this.skill=t,this.value=n,this.timestamp=new Date,this.comment=s,this.isDeleted=!1}}class Is{constructor(t,n=null){this.id=`note_${new Date().getTime()}`,this.timestamp=new Date,this.content=t,this.isDeleted=!1,this.source=n}}class Ot{constructor(t="complete",n=""){this.status=t,this.comment=n,this.timestamp=new Date}}class Ln{constructor(t){this.sessionNumber=t,this.startTime=new Date,this.note="",this.isDeleted=!1,this.endTime=null,this.isFinished=!1,this.isMakeup=!1,this.isCancelled=!1,this.studentRecords={},this.lastWinnerByCategory={},this.lastUsedCategoryId=null,this.lastSelectedWinnerId=null,this.winnerHistory=[]}end(){this.isFinished=!0,this.endTime=new Date}markAsMakeup(){this.isMakeup=!this.isMakeup}initializeStudentRecord(t){this.studentRecords[t]||(this.studentRecords[t]={attendance:"present",homework:new Ot,selections:{},hadIssue:!1,wasOutOfClass:!1})}setAttendance(t,n){this.initializeStudentRecord(t),this.studentRecords[t].attendance=n}setHomeworkStatus(t,n){this.initializeStudentRecord(t),this.studentRecords[t].homework.status=n}selectNextWinner(t,n,s){if(!n||n.length===0)return console.log("Ù‡ÛŒÚ† Ø¯Ø§Ù†Ø´â€ŒØ¢Ù…ÙˆØ²ÛŒ Ø¯Ø± Ú©Ù„Ø§Ø³ Ø¨Ø±Ø§ÛŒ Ø§Ù†ØªØ®Ø§Ø¨ ÙˆØ¬ÙˆØ¯ Ù†Ø¯Ø§Ø±Ø¯."),null;const a=this.lastWinnerByCategory[t];let i=n.filter(d=>d.identity.studentId!==a);if(i.length===0&&(i=n),i.length===0)return null;const o=(d,g)=>d.categoryCounts[g]||0,l=Math.min(...i.map(d=>o(d,t))),r=i.filter(d=>o(d,t)===l);let p;if(r.length===1)p=r[0];else if(r.length>1){const d=s.filter(I=>!I.isDeleted&&I.name!==t).map(I=>I.name),g=r.map(I=>{const M=d.reduce((O,B)=>O+o(I,B),0);return{student:I,otherCategoriesTotal:M}}),L=Math.min(...g.map(I=>I.otherCategoriesTotal)),v=g.filter(I=>I.otherCategoriesTotal===L).map(I=>I.student);v.length===1?p=v[0]:p=v[Math.floor(Math.random()*v.length)]}else p=i[Math.floor(Math.random()*i.length)];const C=p.identity.studentId;this.initializeStudentRecord(C);const h=(this.studentRecords[C].selections[t]||0)+1;return this.studentRecords[C].selections[t]=h,p.statusCounters.totalSelections++,p.categoryCounts[t]=(p.categoryCounts[t]||0)+1,this.lastWinnerByCategory[t]=C,p}}class At{constructor(t){this.info={name:t.name||"NotNamed",scheduleCode:t.scheduleCode||`code_${new Date().getTime()}`,teacherName:t.teacherName||null,type:t.type||"in-person",term:t.term||null,scheduleText:t.scheduleText||null,level:t.level||null,creationDate:t.creationDate?new Date(t.creationDate):new Date},this.students=[],this.sessions=[],this.note="",this.isDeleted=!1,this.categories=[new ye("Vocabulary","Questions about words and meanings."),new ye("Grammar","Questions about sentence structure and rules."),new ye("Listening",void 0,!0),new ye("Speaking",void 0,!0),new ye("Reading",void 0,!0),new ye("Writing",void 0,!0)],this.futurePlans={}}addStudent(t){this.students.push(t)}removeStudent(t){this.students=this.students.filter(n=>n.identity.studentId!==t)}startNewSession(){const t=this.sessions.length+1,n=new Ln(t);return this.sessions.push(n),n}endSpecificSession(t){const n=this.getSession(t);return n&&!n.isFinished?(n.end(),!0):!1}getSession(t){return this.sessions.find(n=>n.sessionNumber===t)}markAsMakeup(t){const n=this.getSession(t);n&&n.markAsMakeup()}planForSession(t,n){this.futurePlans[t]=n}hasSessionToday(){const t=new Date().toDateString();return this.sessions.some(n=>!n.isDeleted&&n.startTime.toDateString()===t)}selectNextWinner(t,n){return n?n.selectNextWinner(t,this.students,this.categories):null}get liveSession(){for(let t=this.sessions.length-1;t>=0;t--)if(!this.sessions[t].isFinished)return this.sessions[t];return null}endLiveSession(){const t=this.liveSession;return t?(t.end(),!0):!1}calculateFinalStudentScore(t){const n=t.logs.scores,s=["reading","writing"];for(const d of s)if(!n[d]||n[d].length===0)return null;const a=n.listening&&n.listening.length>0,i=n.speaking&&n.speaking.length>0;if(!a&&!i)return null;const o=d=>n[d].reduce((L,v)=>L+v.value,0)/n[d].length;let l;a&&i?l=(o("listening")+o("speaking"))/2:a?l=o("listening"):l=o("speaking");const r=o("reading"),p=o("writing"),h=(l*3+r*2+p*1)/6;return Math.trunc(h*10)/10}assignAllFinalScores(){let t=0,n=[];console.log("Ø´Ø±ÙˆØ¹ Ø¹Ù…Ù„ÛŒØ§Øª Ù…Ø­Ø§Ø³Ø¨Ù‡ Ù†Ù…Ø±Ù‡ Ù†Ù‡Ø§ÛŒÛŒ Ø¨Ø±Ø§ÛŒ ØªÙ…Ø§Ù… Ø¯Ø§Ù†Ø´â€ŒØ¢Ù…ÙˆØ²Ø§Ù†..."),this.students.forEach(a=>{const i=this.calculateFinalStudentScore(a);i!==null?(a.finalClassActivityScore=i,t++):(a.finalClassActivityScore=null,n.push(a.identity.name))});const s=n.length;console.log(`Ø¹Ù…Ù„ÛŒØ§Øª Ù¾Ø§ÛŒØ§Ù† ÛŒØ§ÙØª. ØªØ¹Ø¯Ø§Ø¯ Ù†Ù…Ø±Ø§Øª Ù…ÙˆÙÙ‚: ${t} | ØªØ¹Ø¯Ø§Ø¯ Ù†Ø§Ù…ÙˆÙÙ‚ (Ù†Ù…Ø±Ø§Øª Ù†Ø§Ù‚Øµ): ${s}`),s>0&&(console.log("Ø§Ø³Ø§Ù…ÛŒ Ø¯Ø§Ù†Ø´â€ŒØ¢Ù…ÙˆØ²Ø§Ù†ÛŒ Ú©Ù‡ Ù†Ù…Ø±Ø§ØªØ´Ø§Ù† Ù†Ø§Ù‚Øµ Ø§Ø³Øª:"),n.forEach(a=>console.log(`- ${a}`)))}}class ye{constructor(t,n="",s=!1){this.id=`cat_${new Date().getTime()}_${Math.random()}`,this.name=t,this.description=n,this.isDeleted=!1,this.isGradedCategory=s,this.isDeleted=!1}}let T={},u=null,Qt=null,E=null,A=null,ze=null,Tt=null,Xt=[],Ct=null,Yt=null,ce=null,yt=0,Zt=0,Et=0,en=0,tn=null,nn=null,vt=null,Ee=null,de=-1,bt=null,St=null,In=null,kn=null;function k(){localStorage.setItem("teacherAssistantData_v2",JSON.stringify(T))}function wn(){const e=JSON.stringify(T,null,2),n=`SP-${new Date().toLocaleDateString("fa-IR-u-nu-latn").replace(/\//g,"-")}.txt`;return new File([e],n,{type:"text/plain"})}function Rt(){const e=localStorage.getItem("teacherAssistantData_v2");if(e){const t=JSON.parse(e);Bt(t)}}function Bt(e){T={};for(const t in e){const n=e[t],s=new At(n.info);s.isDeleted=n.isDeleted,s.note=n.note||"",s.students=n.students.map(a=>{const i=new tt(a.identity);return i.isDeleted=a.isDeleted,i.statusCounters=a.statusCounters,i.logs=a.logs,i.logs.scores||(i.logs.scores={}),i.profile=a.profile,i.finalClassActivityScore=a.finalClassActivityScore,i.categoryCounts=a.categoryCounts||{},i.categoryIssues=a.categoryIssues||{},i}),s.sessions=n.sessions.map(a=>{const i=new Ln(a.sessionNumber);i.isDeleted=a.isDeleted,i.note=a.note||"",i.startTime=new Date(a.startTime),i.endTime=a.endTime?new Date(a.endTime):null,i.isFinished=a.isFinished,i.isMakeup=a.isMakeup,i.isCancelled=a.isCancelled||!1,i.studentRecords=a.studentRecords;for(const l in i.studentRecords){const r=i.studentRecords[l];r.homework&&!(r.homework instanceof Ot)&&(i.studentRecords[l].homework=new Ot(r.homework.status,r.homework.comment))}i.lastWinnerByCategory=a.lastWinnerByCategory,i.lastUsedCategoryId=a.lastUsedCategoryId,i.lastSelectedWinnerId=a.lastSelectedWinnerId;const o=a.winnerHistory||[];return i.winnerHistory=o.map(l=>({winner:s.students.find(p=>p.identity.studentId===l.winner.identity.studentId),categoryName:l.categoryName})),i}),s.categories=n.categories.map(a=>{const i=new ye(a.name,a.description,a.isGradedCategory);return i.id=a.id,i.isDeleted=a.isDeleted,i}),s.futurePlans=n.futurePlans,T[t]=s}}function Nn(e,t){if(T[t])return{success:!1,message:"Ú©Ù„Ø§Ø³ÛŒ Ø¨Ø§ Ø§ÛŒÙ† Ù†Ø§Ù… Ø§Ø² Ù‚Ø¨Ù„ ÙˆØ¬ÙˆØ¯ Ø¯Ø§Ø±Ø¯."};const n=T[e];return n?(n.info.name=t,T[t]=n,delete T[e],u===n&&K(n),{success:!0}):{success:!1,message:"Ú©Ù„Ø§Ø³ Ù…ÙˆØ±Ø¯ Ù†Ø¸Ø± ÛŒØ§ÙØª Ù†Ø´Ø¯."}}function Tn(e,t,n){if(F(n.students).some(o=>o.identity.name.toLowerCase()===e.identity.name.toLowerCase()))return{success:!1,message:`Ø¯Ø§Ù†Ø´â€ŒØ¢Ù…ÙˆØ²ÛŒ Ø¨Ø§ Ù†Ø§Ù… Â«${e.identity.name}Â» Ø§Ø² Ù‚Ø¨Ù„ Ø¯Ø± Ú©Ù„Ø§Ø³ Â«${n.info.name}Â» ÙˆØ¬ÙˆØ¯ Ø¯Ø§Ø±Ø¯.`};const a=JSON.parse(JSON.stringify(e));n.addStudent(a);const i=t.students.find(o=>o.identity.studentId===e.identity.studentId);return i&&(i.isDeleted=!0),{success:!0}}function K(e){u=e}function Je(e){Qt=e}function Z(e){E=e}function j(e){A=e}function Lt(e){ze=e}function Bn(e){Tt=e}function Ue(e){Xt=e}function nt(e){Ct=e}function xn(e){Yt=e}function sn(e){ce=e}function st(e){yt=e}function Dn(e){Zt=e}function at(e){Et=e}function Mn(e){en=e}function an(e){tn=e}function on(e){nn=e}function Ke(e){vt=e}function cn(e){Ee=e}function It(e){St=e}function $n(e){In=e}function Hn(e){kn=e}function On(){for(const e in T){const t=T[e];t.students.forEach(n=>{n.statusCounters={totalSelections:0,missedChances:0,earlyLeaves:0},n.categoryCounts={},n.categoryIssues={},t.sessions.forEach(s=>{const a=n.identity.studentId;s.studentRecords[a]&&(s.studentRecords[a].attendance="present")})})}k()}function F(e){return Array.isArray(e)?e.filter(t=>!t.isDeleted):[]}function he(e){const t=new Map;return e&&F(e.sessions).filter(s=>!s.isCancelled).sort((s,a)=>s.sessionNumber-a.sessionNumber).forEach((s,a)=>{t.set(s.sessionNumber,a+1)}),t}function we(e){de=e}function me(e){bt=e}function kt(e,t){if(!e||!t)return;const n=e.identity.studentId,s=t.students.findIndex(a=>a.identity.studentId===n);s>-1&&t.students.splice(s,1),t.sessions.forEach(a=>{a.studentRecords[n]&&delete a.studentRecords[n]})}const ks=Object.freeze(Object.defineProperty({__proto__:null,get activeModal(){return Ee},get cancelCallback(){return nn},get classrooms(){return T},get confirmCallback(){return tn},get currentClassroom(){return u},get easterEggClickCount(){return yt},get easterEggLastClickTime(){return Zt},getActiveItems:F,getSessionDisplayMap:he,get importedFileContent(){return Ct},get liveSession(){return Qt},loadData:Rt,get manualSelection(){return St},moveStudent:Tn,get namesToImport(){return Xt},get notificationTimeout(){return Yt},permanentlyDeleteStudent:kt,prepareBackupData:wn,get previousState(){return ze},rehydrateData:Bt,renameClassroom:Nn,resetAllStudentCounters:On,get resetEasterEggClickCount(){return Et},get resetEasterEggLastClickTime(){return en},saveData:k,get saveNoteCallback(){return bt},get secureConfirmCallback(){return vt},get selectedCategory(){return ce},get selectedSession(){return E},get selectedStudentForProfile(){return A},setActiveModal:cn,setCancelCallback:on,setConfirmCallback:an,setCurrentClassroom:K,setEasterEggClickCount:st,setEasterEggLastClickTime:Dn,setImportedFileContent:nt,setLiveSession:Je,setManualSelection:It,setNamesToImport:Ue,setNotificationTimeout:xn,setPreviousState:Lt,setResetEasterEggClickCount:at,setResetEasterEggLastClickTime:Mn,setSaveNoteCallback:me,setSecureConfirmCallback:Ke,setSelectedCategory:sn,setSelectedSession:Z,setSelectedStudentForProfile:j,setSourceClassForMove:Hn,setStudentToMove:$n,setUndoTimeout:Bn,setWinnerHistoryIndex:we,get sourceClassForMove(){return kn},get studentToMove(){return In},get undoTimeout(){return Tt},get winnerHistoryIndex(){return de}},Symbol.toStringTag,{value:"Module"}));function De(e){return typeof e!="string"?"":e.replace(/ÙŠ/g,"ÛŒ").replace(/Ùƒ/g,"Ú©")}function Qe(e){return typeof e!="string"||e.length===0?"ltr":/[\u0590-\u07FF]/.test(e)?"rtl":"ltr"}function An(e){return!e||!e.trim()?"":e.split(`
`).map(s=>`<div dir="${Qe(s)}">${s||"&nbsp;"}</div>`).join("")}function bn(e){if(typeof e!="string")return"";const t={q:"Ø¶",w:"Øµ",e:"Ø«",r:"Ù‚",t:"Ù",y:"Øº",u:"Ø¹",i:"Ù‡",o:"Ø®",p:"Ø­","[":"Ø¬","]":"Ú†",a:"Ø´",s:"Ø³",d:"ÛŒ",f:"Ø¨",g:"Ù„",h:"Ø§",j:"Øª",k:"Ù†",l:"Ù…",";":"Ú©","'":"Ú¯",z:"Ø¸",x:"Ø·",c:"Ø²",v:"Ø±",b:"Ø°",n:"Ø¯",m:"Ù¾",",":"Ùˆ"};let n="";for(let s=0;s<e.length;s++){const a=e[s].toLowerCase();n+=t[a]||e[s]}return n}const Rn="teacherAssistantLogs_v2",ws=100;function ln(){try{const e=localStorage.getItem(Rn);return e?JSON.parse(e):{}}catch(e){return console.error("Error reading logs from localStorage:",e),{}}}function Pn(e){try{localStorage.setItem(Rn,JSON.stringify(e))}catch(t){console.error("Error saving logs to localStorage:",t)}}function $(e,t,n=null){if(!e)return;const s=ln();s[e]||(s[e]=[]);const a={timestamp:new Date().toISOString(),message:t,action:n,classroomName:e};s[e].unshift(a),s[e].length>ws&&s[e].pop(),Pn(s)}function Ns(e){return ln()[e]||[]}function Ts(e,t){const n=ln();n[e]&&!n[t]&&(n[t]=n[e],delete n[e],Pn(n))}const _n=document.getElementById("class-management-page"),Bs=document.getElementById("new-class-name"),xs=document.getElementById("add-class-btn"),Pt=document.getElementById("class-list"),wt=document.getElementById("undo-toast"),Wn=document.getElementById("undo-message"),Ds=document.getElementById("undo-btn"),Ms=document.getElementById("settings-page"),rn=document.getElementById("settings-class-name-header"),_t=document.getElementById("settings-student-list"),Wt=document.getElementById("category-list"),$s=document.getElementById("back-to-sessions-btn"),Hs=document.getElementById("new-student-name"),Os=document.getElementById("add-student-btn"),Fn=document.getElementById("paste-area"),As=document.getElementById("process-paste-btn"),Rs=document.getElementById("csv-preview-page"),Ft=document.getElementById("csv-preview-list"),Ps=document.getElementById("csv-confirm-btn"),_s=document.getElementById("csv-cancel-btn"),Ws=document.getElementById("import-csv-btn"),Fs=document.getElementById("csv-file-input"),Us=document.getElementById("column-mapping-page"),Ut=document.getElementById("column-select-dropdown"),Vs=document.getElementById("confirm-column-btn"),qs=document.getElementById("cancel-import-btn"),Gs=document.getElementById("new-category-name"),js=document.getElementById("add-category-btn"),Vt=document.querySelector(".app-header"),ve=document.getElementById("select-student-btn"),Xe=document.getElementById("select-student-btn-wrapper"),zs=document.getElementById("attendance-page"),ot=document.getElementById("attendance-list"),Js=document.getElementById("finish-attendance-btn"),Ks=document.getElementById("back-to-sessions-from-attendance-btn"),Qs=document.getElementById("back-to-attendance-btn"),Xs=document.querySelector("#class-management-page h2"),qt=document.getElementById("student-stats-header"),Ys=document.getElementById("hamburger-menu-btn"),Zs=document.getElementById("side-nav-menu"),ea=document.getElementById("close-nav-btn"),ta=document.getElementById("overlay"),na=document.getElementById("backup-data-btn"),sa=document.getElementById("restore-data-btn"),Un=document.getElementById("restore-file-input"),aa=document.getElementById("custom-confirm-modal"),Vn=document.getElementById("confirm-modal-message"),Gt=document.getElementById("confirm-modal-cancel-btn"),Ve=document.getElementById("confirm-modal-confirm-btn"),oa=document.getElementById("secure-confirm-modal"),qn=document.getElementById("secure-confirm-message"),Gn=document.getElementById("secure-confirm-code"),Me=document.getElementById("secure-confirm-input"),ia=document.getElementById("secure-confirm-cancel-btn"),it=document.getElementById("secure-confirm-confirm-btn"),ca=document.getElementById("add-note-modal"),W=document.getElementById("new-note-content"),la=document.getElementById("class-save-note-btn"),ra=document.getElementById("cancel-note-btn"),jt=document.getElementById("student-search-input"),Ce=document.getElementById("student-search-results"),da=document.getElementById("student-profile-page"),jn=document.getElementById("profile-student-name-header"),ua=document.getElementById("back-to-student-page-btn"),$e=document.getElementById("graded-category-pills-container"),zt=document.getElementById("new-score-value"),dn=document.getElementById("new-score-comment"),ma=document.getElementById("add-score-btn"),qe=document.getElementById("profile-stats-summary"),ct=document.getElementById("profile-scores-list"),lt=document.getElementById("global-student-search-input"),pe=document.getElementById("global-student-search-results"),fa=document.getElementById("is-graded-checkbox"),rt=document.getElementById("trashed-classes-list"),dt=document.getElementById("trashed-students-list"),ut=document.getElementById("trashed-sessions-list"),mt=document.getElementById("trashed-categories-list"),ft=document.getElementById("trashed-notes-list"),pt=document.getElementById("trashed-scores-list"),Nt=document.getElementById("quick-grade-form-wrapper"),ge=document.getElementById("quick-score-input"),ue=document.getElementById("quick-note-textarea"),Ae=document.getElementById("quick-grade-submit-btn"),un=document.getElementById("category-selection-container"),zn=document.getElementById("selected-student-result"),Ne=document.getElementById("custom-context-menu"),He=document.getElementById("breadcrumb-container");function Ze(e){clearTimeout(Tt),ze||Lt(JSON.stringify(T)),Wn.textContent=e,wt.classList.add("show"),Bn(setTimeout(()=>{wt.classList.remove("show"),Lt(null)},5e3))}function Jn(){if(ze){const e=u?u.info.name:null,t=JSON.parse(ze);Bt(t),e&&T[e]?K(T[e]):K(null),u?(be(),Re(),G()):re(),wt.classList.remove("show"),clearTimeout(Tt),Lt(null)}}function S(e,t=3e3){const n=document.getElementById("notification-toast");n&&(n.textContent=e,n.classList.add("show"),clearTimeout(Yt),xn(setTimeout(()=>{n.classList.remove("show")},t)))}function U(e,t,n={}){const{confirmText:s="ØªØ§ÛŒÛŒØ¯",cancelText:a="Ù„ØºÙˆ",confirmClass:i="btn-success",onCancel:o=()=>{},isDelete:l=!1}=n,r=l?()=>Kn(e,t):t;Vn.textContent=e,Ve.textContent=s,Gt.textContent=a,Ve.className="modal-action-btn",Ve.classList.add(i),an(r),on(o);const p=Ve.parentElement;Gt.style.display=o===null?"none":"inline-block",p.style.justifyContent=o===null?"center":"space-between",te("custom-confirm-modal")}function Kn(e,t){const n=Math.floor(1e4+Math.random()*9e4).toString();qn.textContent=e,Gn.textContent=n,Me.value="",it.disabled=!0,Ke(t),te("secure-confirm-modal"),Me.focus();const s=()=>{Me.value===n?it.disabled=!1:it.disabled=!0};return Me.addEventListener("input",s),()=>{Me.removeEventListener("input",s)}}function Qn(e,t){const n=Object.values(T).filter(o=>!o.isDeleted&&o.info.name!==t.info.name),s=document.getElementById("move-student-modal-title"),a=document.getElementById("move-student-class-select"),i=document.getElementById("move-student-confirm-btn");s.textContent=`Ø§Ù†ØªÙ‚Ø§Ù„ Ø¯Ø§Ù†Ø´â€ŒØ¢Ù…ÙˆØ²: ${e.identity.name}`,a.innerHTML="",n.length===0?(a.innerHTML='<option value="">Ú©Ù„Ø§Ø³ Ø¯ÛŒÚ¯Ø±ÛŒ Ø¨Ø±Ø§ÛŒ Ø§Ù†ØªÙ‚Ø§Ù„ ÙˆØ¬ÙˆØ¯ Ù†Ø¯Ø§Ø±Ø¯</option>',i.disabled=!0):(n.forEach(o=>{const l=document.createElement("option");l.value=o.info.name,l.textContent=o.info.name,a.appendChild(l)}),i.disabled=!1),$n(e),Hn(t),te("move-student-modal")}function te(e){const t=document.getElementById(e);if(t){if(Ee)return;t.classList.add("modal-visible"),cn(e),history.pushState(null,"",location.href)}}function Y(e){if(!Ee)return;const t=document.getElementById(Ee),n=Ee;cn(null),history.back(),t&&(t.classList.add("modal-closing"),setTimeout(()=>{t.classList.remove("modal-visible"),t.classList.remove("modal-closing"),n==="custom-confirm-modal"&&(an(null),on(null)),n==="secure-confirm-modal"&&Ke(null),n==="add-note-modal"&&me(null),typeof e=="function"&&e()},300))}function mn(e){W.value=e.note||"",me(t=>{e.note=t,k(),$(e.info.name,"ÛŒØ§Ø¯Ø¯Ø§Ø´Øª Ú©Ù„Ø§Ø³ Ø°Ø®ÛŒØ±Ù‡ Ø´Ø¯.",{type:"VIEW_CLASS_NOTE"}),re()}),te("add-note-modal"),W.focus()}function fn(e){K(e),rn.textContent=`ØªÙ†Ø¸ÛŒÙ…Ø§Øª Ú©Ù„Ø§Ø³: ${e.info.name}`,be(),Re(),w("settings-page")}function Xn(e){const t=document.getElementById("log-modal-title"),n=document.getElementById("log-list");t.textContent=`Ú¯Ø²Ø§Ø±Ø´ ÙØ¹Ø§Ù„ÛŒØªâ€ŒÙ‡Ø§ÛŒ Ú©Ù„Ø§Ø³: ${e}`,n.innerHTML="";const s=Ns(e);s.length===0?n.innerHTML='<li class="no-content-message">Ù‡Ù†ÙˆØ² ÙØ¹Ø§Ù„ÛŒØªÛŒ Ø¨Ø±Ø§ÛŒ Ø§ÛŒÙ† Ú©Ù„Ø§Ø³ Ø«Ø¨Øª Ù†Ø´Ø¯Ù‡ Ø§Ø³Øª.</li>':s.forEach(a=>{const i=document.createElement("li");i.className="log-entry";const o=new Date(a.timestamp),l=`${o.toLocaleDateString("fa-IR")} - ${o.toLocaleTimeString("fa-IR",{hour:"2-digit",minute:"2-digit"})}`,r=document.createElement("span");r.className="log-timestamp",r.textContent=l;const p=document.createElement("span");p.className="log-message",p.textContent=a.message,a.action&&(p.classList.add("log-action-link"),p.dataset.action=JSON.stringify({...a.action,classroomName:a.classroomName})),i.appendChild(r),i.appendChild(p),n.appendChild(i)}),te("log-modal")}document.getElementById("log-modal-close-btn").addEventListener("click",()=>{Y()});function Jt(e){const t=URL.createObjectURL(e),n=document.createElement("a");n.href=t,n.download=e.name,document.body.appendChild(n),n.click(),document.body.removeChild(n),URL.revokeObjectURL(t)}async function pn(){const e=wn();if(("ontouchstart"in window||navigator.maxTouchPoints>0)&&navigator.share&&navigator.canShare&&navigator.canShare({files:[e]}))try{await navigator.share({title:"Ù¾Ø´ØªÛŒØ¨Ø§Ù† Ø¯Ø³ØªÛŒØ§Ø± Ù…Ø¹Ù„Ù…",text:"ÙØ§ÛŒÙ„ Ù¾Ø´ØªÛŒØ¨Ø§Ù† Ø¯Ø§Ø¯Ù‡â€ŒÙ‡Ø§ÛŒ Ø¨Ø±Ù†Ø§Ù…Ù‡",files:[e]})}catch(n){n.name!=="AbortError"&&(console.error("Error sharing file:",n),Jt(e),S("âš ï¸Ø§Ø´ØªØ±Ø§Ú©â€ŒÚ¯Ø°Ø§Ø±ÛŒ Ø¨Ø§ Ø®Ø·Ø§ Ù…ÙˆØ§Ø¬Ù‡ Ø´Ø¯. ÙØ§ÛŒÙ„ Ø¯Ø± Ø­Ø§Ù„ Ø¯Ø§Ù†Ù„ÙˆØ¯ Ø§Ø³Øª."))}else Jt(e),S("âœ…Ù¾Ø´ØªÛŒØ¨Ø§Ù†â€ŒÚ¯ÛŒØ±ÛŒ Ø¨Ø§ Ù…ÙˆÙÙ‚ÛŒØª Ø§Ù†Ø¬Ø§Ù… Ø´Ø¯.")}function xt(e,t){e.preventDefault(),Ie(),setTimeout(()=>{const n=Ne,s=n.querySelector("ul");s.innerHTML="",t.forEach(C=>{const h=document.createElement("li");C.isSeparator?h.className="separator":(h.innerHTML=`
                    <span class="icon">${C.icon||""}</span>
                    <span class="label">${C.label}</span>
                `,C.className&&h.classList.add(C.className),h.addEventListener("click",()=>{C.action(),Ie()})),s.appendChild(h)});const{clientX:a,clientY:i}=e,{innerWidth:o,innerHeight:l}=window;n.style.top=`${i}px`,n.style.left=`${a}px`,n.classList.add("visible");const{offsetWidth:r,offsetHeight:p}=n;a+r>o&&(n.style.left=`${o-r-5}px`),i+p>l&&(n.style.top=`${l-p-5}px`)},50)}function Ie(){Ne.classList.contains("visible")&&Ne.classList.remove("visible")}function Yn(){var t,n;He.innerHTML="";const e=[];if(e.push({label:"Ú©Ù„Ø§Ø³â€ŒÙ‡Ø§",handler:()=>{K(null),Z(null),j(null),w("class-management-page")}}),u){if(e.push({label:u.info.name,handler:()=>{Z(null),j(null),G(),w("session-page")}}),((t=document.querySelector(".page.active"))==null?void 0:t.id)==="settings-page")e.push({label:"ØªÙ†Ø¸ÛŒÙ…Ø§Øª"});else if(E){const i=he(u).get(E.sessionNumber)||` (#${E.sessionNumber})`;e.push({label:`Ø¬Ù„Ø³Ù‡ ${i}`,handler:()=>{j(null),w("student-page")}});const o=(n=document.querySelector(".page.active"))==null?void 0:n.id;A?e.push({label:`Ù¾Ø±ÙˆÙØ§ÛŒÙ„: ${A.identity.name}`}):o==="attendance-page"&&e.push({label:"Ø­Ø¶ÙˆØ± Ùˆ ØºÛŒØ§Ø¨"})}}if(e.length<=1){He.style.display="none";return}He.style.display="flex",e.forEach((s,a)=>{const i=document.createElement("a");if(i.textContent=s.label,i.className="breadcrumb-item",a===e.length-1||!s.handler?i.classList.add("active"):i.addEventListener("click",s.handler),He.appendChild(i),a<e.length-1){const o=document.createElement("span");o.className="breadcrumb-separator",o.textContent="/",He.appendChild(o)}})}function Sn(e,t,n){n.innerHTML="";const s=u.sessions.filter(a=>{var i;return!a.isDeleted&&!a.isCancelled&&((i=a.studentRecords[e.identity.studentId])==null?void 0:i.attendance)==="absent"}).map(a=>({number:t.get(a.sessionNumber),isMakeup:a.isMakeup})).filter(a=>a.number!==void 0);s.length>0?(n.appendChild(document.createTextNode("Ø¬Ù„Ø³Ø§Øª ØºØ§ÛŒØ¨: ")),s.forEach((a,i)=>{const o=document.createElement("span");o.textContent=a.number,a.isMakeup&&o.classList.add("makeup-absence"),n.appendChild(o),i<s.length-1&&n.appendChild(document.createTextNode("ØŒ "))})):n.textContent="Ø¬Ù„Ø³Ø§Øª ØºØ§ÛŒØ¨: Ø¨Ø¯ÙˆÙ† ØºÛŒØ¨Øª"}function gt(e,t,n,s={}){const{includePrefix:a=!0}=s;n.innerHTML="";const i=u.sessions.filter(o=>{if(o.isDeleted||o.isCancelled)return!1;const l=o.studentRecords[e.identity.studentId];return l&&l.homework&&(l.homework.status==="incomplete"||l.homework.status==="none")}).map(o=>({number:t.get(o.sessionNumber),status:o.studentRecords[e.identity.studentId].homework.status})).filter(o=>o.number!==void 0);i.length>0?(a&&n.appendChild(document.createTextNode("ØªÚ©Ø§Ù„ÛŒÙ Ù†Ø§Ù‚Øµ: ")),i.forEach((o,l)=>{const r=document.createElement("span");r.textContent=o.number,o.status==="incomplete"&&r.classList.add("incomplete-homework"),n.appendChild(r),l<i.length-1&&n.appendChild(document.createTextNode("ØŒ"))})):a?n.textContent="ØªÚ©Ø§Ù„ÛŒÙ Ù†Ø§Ù‚Øµ: Ù†Ø¯Ø§Ø±Ø¯":n.textContent="Ù†Ø¯Ø§Ø±Ø¯"}function pa(e,t){var I,M,O;const n=document.createElement("li");n.className="attendance-list-item";const s={none:"Ø¨Ø¯ÙˆÙ† ØªÚ©Ù„ÛŒÙ",complete:"ØªÚ©Ù„ÛŒÙ Ú©Ø§Ù…Ù„",incomplete:"ØªÚ©Ù„ÛŒÙ Ù†Ø§Ù‚Øµ"},a=document.createElement("div");a.className="student-info";const i=document.createElement("span");i.className="student-name",i.textContent=e.identity.name,i.addEventListener("click",()=>{j(e),ee(),w("student-profile-page")});const o=document.createElement("span");o.className="absence-info";const l=document.createElement("span");l.className="homework-info",Sn(e,t,o),gt(e,t,l),a.appendChild(i),a.appendChild(o),a.appendChild(l);const r=document.createElement("div");r.className="homework-controls";const p=document.createElement("button"),C=((I=E.studentRecords[e.identity.studentId])==null?void 0:I.homework.status)||"none";p.className=`homework-status-btn ${C}`,p.title=s[C],p.addEventListener("click",()=>{const B=E.studentRecords[e.identity.studentId].homework,R={none:"incomplete",incomplete:"complete",complete:"none"}[B.status];p.title=s[R],E.setHomeworkStatus(e.identity.studentId,R),k(),p.className=`homework-status-btn ${R}`,gt(e,t,l)});const h=document.createElement("button");h.className="btn-icon",h.innerHTML="ğŸ“",h.title="Ø§ÙØ²ÙˆØ¯Ù† ÛŒØ§Ø¯Ø¯Ø§Ø´Øª Ø¨Ø±Ø§ÛŒ ØªÚ©Ù„ÛŒÙ",((M=E.studentRecords[e.identity.studentId])==null?void 0:M.homework.comment)||(h.style.opacity="0.3"),h.addEventListener("click",()=>{const B=E.studentRecords[e.identity.studentId].homework;W.value=B.comment||"",W.dispatchEvent(new Event("input",{bubbles:!0})),me(H=>{B.comment=H;const R=he(u),ae=R.get(E.sessionNumber),Q={type:"fromAttendance",sessionNumber:E.sessionNumber},fe=`ÛŒØ§Ø¯Ø¯Ø§Ø´Øª Ø­Ø¶ÙˆØ±-ØºÛŒØ§Ø¨ ${ae}: `,q=e.profile.notes.find(oe=>!oe.isDeleted&&oe.source&&oe.source.type==="fromAttendance"&&oe.source.sessionNumber===Q.sessionNumber);q?H?q.content=fe+H:q.isDeleted=!0:H&&e.addNote(fe+H,Q),k(),$(u.info.name,`ÛŒØ§Ø¯Ø¯Ø§Ø´Øª ØªÚ©Ù„ÛŒÙ Ø¬Ù„Ø³Ù‡ ${ae} Ø¨Ø±Ø§ÛŒ Ø¯Ø§Ù†Ø´â€ŒØ¢Ù…ÙˆØ² Â«${e.identity.name}Â» Ø°Ø®ÛŒØ±Ù‡ Ø´Ø¯.`,{type:"VIEW_STUDENT_PROFILE",studentId:e.identity.studentId}),S("âœ…ÛŒØ§Ø¯Ø¯Ø§Ø´Øª ØªÚ©Ù„ÛŒÙ Ø°Ø®ÛŒØ±Ù‡ Ø´Ø¯."),h.style.opacity=H?"1":"0.3",gt(e,R,l)}),te("add-note-modal"),W.focus()}),r.appendChild(p),r.appendChild(h);const g=document.createElement("button"),L=((O=E.studentRecords[e.identity.studentId])==null?void 0:O.attendance)||"present",v=B=>{B==="present"?(g.textContent="Ø­Ø§Ø¶Ø±",g.className="attendance-status-btn present active"):(g.textContent="ØºØ§ÛŒØ¨",g.className="attendance-status-btn absent active")};return v(L),g.addEventListener("click",()=>{var R;const H=(((R=E.studentRecords[e.identity.studentId])==null?void 0:R.attendance)||"present")==="present"?"absent":"present";E.setAttendance(e.identity.studentId,H),H==="absent"&&(E.studentRecords[e.identity.studentId].hadIssue=!1),k(),v(H),Sn(e,t,o),ns()}),n.appendChild(a),n.appendChild(r),n.appendChild(g),n}function ga(){return he(u).get(E.sessionNumber)}function Oe(){if(!u||!E)return;const e=he(u);ka(),ot.innerHTML="";const t=document.createElement("li");t.className="attendance-list-header",t.innerHTML=`
    <span class="header-label-spacer"></span>
    <span class="header-label">ØªÚ©Ù„ÛŒÙ</span>
    <span class="header-label">Ø­Ø¶ÙˆØ±</span>
`,ot.appendChild(t),F(u.students).forEach(n=>{const s=pa(n,e);ot.appendChild(s)}),wa(),ns()}function le(){const e=document.getElementById("student-stats-table-container");if(!e||(e.innerHTML="",!u))return;F(u.students).length,qt.textContent="Ø¢Ù…Ø§Ø± Ø¹Ù…Ù„Ú©Ø±Ø¯";const t=["Ù†Ø§Ù…"],n=["Ú©Ù„ Ø§Ù†ØªØ®Ø§Ø¨ Ù‡Ø§","ØºÛŒØ¨Øª","Ø®Ø±ÙˆØ¬","ÙØ±ØµØª Ø§Ø²Ø¯Ø³Øªâ€ŒØ±ÙØªÙ‡","Ù…Ø´Ú©Ù„","Ù…ÛŒØ§Ù†Ú¯ÛŒÙ†","Ù†Ù…Ø±Ù‡ Ú©Ù„Ø§Ø³ÛŒ (Ú©Ø§Ù†ÙˆÙ†)"],s=u.categories.filter(g=>g.isGradedCategory&&!g.isDeleted).map(g=>g.name),a=[...t,...s,...n],i=document.createElement("table");i.className="student-stats-table";const l=i.createTHead().insertRow();a.forEach((g,L)=>{const v=document.createElement("th");L===0?(v.innerHTML=`${g} <span style="opacity: 0.6;">ğŸ”—</span>`,v.title="Ø±Ø¯ÛŒÙâ€ŒÙ‡Ø§ÛŒ Ø§ÛŒÙ† Ø³ØªÙˆÙ† Ù‚Ø§Ø¨Ù„ Ú©Ù„ÛŒÚ© Ù‡Ø³ØªÙ†Ø¯"):v.textContent=g,l.appendChild(v)});const r=i.createTBody(),p=F(u.students),C=g=>{let L=0;return u.sessions.forEach(v=>{if(v.isDeleted||v.isCancelled)return;const I=v.studentRecords[g.identity.studentId];I&&I.attendance==="absent"&&L++}),L};p.forEach(g=>{const L=r.insertRow();if(L.dataset.studentId=g.identity.studentId,E){const H=E.studentRecords[g.identity.studentId];H&&H.attendance==="absent"&&L.classList.add("absent-row-highlight")}const v=L.insertCell(),I=document.createElement("span");I.textContent=g.identity.name,I.className="student-name-link",I.addEventListener("click",()=>{j(g),ee(),w("student-profile-page")}),v.appendChild(I),s.forEach(H=>{var fe;const R=L.insertCell(),ae=H.toLowerCase(),Q=((fe=g.logs.scores[ae])==null?void 0:fe.filter(q=>!q.isDeleted))||[];Q.length>0?Q.forEach((q,oe)=>{const ne=document.createElement("span");ne.textContent=q.value,ne.style.position="relative",q.comment&&(ne.dataset.tooltip=q.comment),R.appendChild(ne),oe<Q.length-1&&R.appendChild(document.createTextNode(","))}):R.textContent="",R.style.cursor="pointer",R.addEventListener("click",()=>{Se(g,H);const q=document.getElementById("category-selection-container");q&&q.scrollIntoView({behavior:"smooth",block:"center"})})}),L.insertCell().textContent=g.statusCounters.totalSelections||0,L.insertCell().textContent=C(g),L.insertCell().textContent=g.statusCounters.outOfClassCount||0,L.insertCell().textContent=g.statusCounters.missedChances||0;const M=Object.values(g.categoryIssues||{}).reduce((H,R)=>H+R,0);L.insertCell().textContent=M;const O=g.getOverallAverageScore();L.insertCell().textContent=O!==null?O:"-";const B=u.calculateFinalStudentScore(g);L.insertCell().textContent=B!==null?B:"-"}),F(u.students),qt.setAttribute("data-student-count",p.length),e.appendChild(i);const h=e.querySelector(".student-stats-table"),d=h==null?void 0:h.querySelector("thead th:first-child");d&&d.addEventListener("click",()=>{h.classList.toggle("name-column-expanded")})}function Se(e=null,t=null){const n=document.getElementById("selected-student-result");n.innerHTML="",n.classList.remove("absent");let s,a;if(e&&t)s=e,a=t,It({student:e,categoryName:t}),we(-1);else{if(It(null),!E||de<0||!E.winnerHistory[de])return;const P=E.winnerHistory[de];s=P.winner,a=P.categoryName}const i=document.querySelector(".current-winner-highlight");if(i&&i.classList.remove("current-winner-highlight"),s){const P=document.querySelector(`.student-stats-table tr[data-student-id="${s.identity.studentId}"]`);P&&P.classList.add("current-winner-highlight")}const o=u.categories.find(P=>P.name===a);if(o){sn(o);const P=document.querySelectorAll("#category-selection-container .pill");P.forEach(z=>z.classList.remove("active"));const _=Array.from(P).find(z=>z.textContent===a);_&&_.classList.add("active"),es(o)}const l=E.studentRecords[s.identity.studentId],r=(l==null?void 0:l.attendance)==="absent",p=document.createElement("div");p.className="winner-name-container";const C=document.createElement("button");C.className="btn-icon",C.innerHTML="Ë…",C.title="Ø¨Ø±Ù†Ø¯Ù‡ Ù‚Ø¨Ù„ÛŒ";const h=!e;C.classList.toggle("is-disabled",!h||de<=0),C.addEventListener("click",()=>{C.classList.contains("is-disabled")?(C.classList.add("shake-animation"),setTimeout(()=>C.classList.remove("shake-animation"),200)):(we(de-1),Se())});const d=document.createElement("div");d.className="winner-name",d.innerHTML=`âœ¨ <strong>${s.identity.name}</strong>âœ¨`,d.classList.add("heartbeat-animation"),r&&(d.style.textDecoration="line-through",d.style.opacity="0.6",d.style.color="var(--color-secondary)"),(l==null?void 0:l.hadIssue)&&!r&&(d.style.color="var(--color-warning)",d.title="Ø§ÛŒÙ† Ø¯Ø§Ù†Ø´â€ŒØ¢Ù…ÙˆØ² Ø¯Ø± Ø§Ù†ØªØ®Ø§Ø¨ Ù‚Ø¨Ù„ÛŒ Ø¨Ø§ Ù…Ø´Ú©Ù„ Ù…ÙˆØ§Ø¬Ù‡ Ø´Ø¯Ù‡ Ø¨ÙˆØ¯"),(l==null?void 0:l.wasOutOfClass)&&!r&&(d.style.color="var(--color-strong-warning)",d.title="Ø§ÛŒÙ† Ø¯Ø§Ù†Ø´â€ŒØ¢Ù…ÙˆØ² Ø¯Ø± Ø²Ù…Ø§Ù† Ø§Ù†ØªØ®Ø§Ø¨ Ø®Ø§Ø±Ø¬ Ø§Ø² Ú©Ù„Ø§Ø³ Ø¨ÙˆØ¯");const v=document.createElement("button");v.className="btn-icon",v.innerHTML="Ë„",v.title="Ø¨Ø±Ù†Ø¯Ù‡ Ø¨Ø¹Ø¯ÛŒ",v.classList.toggle("is-disabled",!h||de>=E.winnerHistory.length-1),v.addEventListener("click",()=>{v.classList.contains("is-disabled")?(v.classList.add("shake-animation"),setTimeout(()=>v.classList.remove("shake-animation"),200)):(we(de+1),Se())}),p.appendChild(v),p.appendChild(d),p.appendChild(C),n.appendChild(p),ve.disabled=h&&!v.classList.contains("is-disabled");const I=document.createElement("div");I.className="status-button-container";const M=document.createElement("button");M.textContent="ØºØ§ÛŒØ¨",M.classList.add("status-button","absent-btn"),r&&M.classList.add("active");const O=document.createElement("button");O.textContent="Ù…Ø´Ú©Ù„",O.classList.add("status-button","issue-btn"),l!=null&&l.hadIssue&&O.classList.add("active");const B=document.createElement("button");B.textContent="Ø®Ø±ÙˆØ¬",B.classList.add("status-button","exit-btn"),l!=null&&l.wasOutOfClass&&B.classList.add("active");const H=document.createElement("button");H.textContent="Ù¾Ø±ÙˆÙØ§ÛŒÙ„",H.className="status-button profile-btn",M.addEventListener("click",()=>{const P=M.classList.contains("active");B.classList.contains("active")&&(B.classList.remove("active"),l.wasOutOfClass=!1,s.statusCounters.outOfClassCount=Math.max(0,(s.statusCounters.outOfClassCount||0)-1),s.statusCounters.missedChances=Math.max(0,s.statusCounters.missedChances-1)),P?(M.classList.remove("active"),E.setAttendance(s.identity.studentId,"present"),s.statusCounters.missedChances=Math.max(0,s.statusCounters.missedChances-1),d.style.textDecoration="",d.style.opacity="",d.style.color=""):(O.classList.contains("active")&&(O.classList.remove("active"),l.hadIssue=!1,s.statusCounters.otherIssues=Math.max(0,s.statusCounters.otherIssues-1),s.statusCounters.missedChances=Math.max(0,s.statusCounters.missedChances-1)),M.classList.add("active"),E.setAttendance(s.identity.studentId,"absent"),s.statusCounters.missedChances++,d.style.textDecoration="line-through",d.style.opacity="0.6",d.style.color="var(--color-secondary)",d.title=""),le(),k()}),O.addEventListener("click",()=>{const P=O.classList.contains("active");if(B.classList.contains("active")&&(B.classList.remove("active"),l.wasOutOfClass=!1,s.statusCounters.outOfClassCount=Math.max(0,(s.statusCounters.outOfClassCount||0)-1),s.statusCounters.missedChances=Math.max(0,s.statusCounters.missedChances-1)),P){O.classList.remove("active"),l.hadIssue=!1;const _=ce.name;s.categoryIssues[_]&&(s.categoryIssues[_]=Math.max(0,s.categoryIssues[_]-1)),s.statusCounters.missedChances=Math.max(0,s.statusCounters.missedChances-1),d.style.color="",d.title=""}else{M.classList.contains("active")&&(M.classList.remove("active"),E.setAttendance(s.identity.studentId,"present"),s.statusCounters.missedChances=Math.max(0,s.statusCounters.missedChances-1)),O.classList.add("active"),l.hadIssue=!0;const _=ce.name;s.categoryIssues[_]=(s.categoryIssues[_]||0)+1,s.statusCounters.missedChances++,d.style.textDecoration="",d.style.opacity="",d.style.color="var(--color-warning)",d.title="Ø§ÛŒÙ† Ø¯Ø§Ù†Ø´â€ŒØ¢Ù…ÙˆØ² Ø¯Ø± Ø§Ù†ØªØ®Ø§Ø¨ Ù‚Ø¨Ù„ÛŒ Ø¨Ø§ Ù…Ø´Ú©Ù„ Ù…ÙˆØ§Ø¬Ù‡ Ø´Ø¯Ù‡ Ø¨ÙˆØ¯"}le(),k()}),B.addEventListener("click",()=>{if(B.classList.contains("active"))B.classList.remove("active"),l.wasOutOfClass=!1,s.statusCounters.outOfClassCount=Math.max(0,(s.statusCounters.outOfClassCount||0)-1),s.statusCounters.missedChances=Math.max(0,s.statusCounters.missedChances-1),d.style.color="",d.title="";else{if(M.classList.contains("active")&&(M.classList.remove("active"),E.setAttendance(s.identity.studentId,"present"),s.statusCounters.missedChances=Math.max(0,s.statusCounters.missedChances-1)),O.classList.contains("active")){O.classList.remove("active"),l.hadIssue=!1;const _=ce.name;s.categoryIssues[_]&&(s.categoryIssues[_]=Math.max(0,s.categoryIssues[_]-1)),s.statusCounters.missedChances=Math.max(0,s.statusCounters.missedChances-1)}B.classList.add("active"),l.wasOutOfClass=!0,s.statusCounters.outOfClassCount=(s.statusCounters.outOfClassCount||0)+1,s.statusCounters.missedChances++,d.style.textDecoration="",d.style.opacity="",d.style.color="var(--color-strong-warning)",d.title="Ø§ÛŒÙ† Ø¯Ø§Ù†Ø´â€ŒØ¢Ù…ÙˆØ² Ø¯Ø± Ø²Ù…Ø§Ù† Ø§Ù†ØªØ®Ø§Ø¨ Ø®Ø§Ø±Ø¬ Ø§Ø² Ú©Ù„Ø§Ø³ Ø¨ÙˆØ¯"}le(),k()}),H.addEventListener("click",()=>{j(s),ee(),w("student-profile-page")}),I.appendChild(M),I.appendChild(B),I.appendChild(O),I.appendChild(H),n.appendChild(I);const R=document.createElement("div");R.className="student-details-container";const ae=document.createElement("div");ae.className="student-details-scores",ae.innerHTML="<h4>Ø¢Ø®Ø±ÛŒÙ† Ù†Ù…Ø±Ø§Øª</h4>";const Q=document.createElement("ul");Q.className="scores-list";const fe=["Reading","Writing","Speaking","Listening"];let q=!1;const oe=s.logs.scores||{};fe.forEach(P=>{const _=document.createElement("li"),z=document.createElement("span");z.className="skill-name",z.textContent=`${P}:`;const Le=document.createElement("span");Le.className="skill-scores";const Dt=P.toLowerCase(),Pe=oe[Dt];Pe&&Pe.length>0?(q=!0,Le.textContent=Pe.slice(-3).map(Mt=>Mt.value).join(",")):Le.textContent="none",_.appendChild(z),_.appendChild(Le),Q.appendChild(_)}),!q&&Object.keys(oe).length===0&&(Q.innerHTML='<div class="no-content-message">Ù‡Ù†ÙˆØ² Ù†Ù…Ø±Ù‡â€ŒØ§ÛŒ Ø«Ø¨Øª Ù†Ø´Ø¯Ù‡ Ø§Ø³Øª.</div>'),ae.appendChild(Q),R.appendChild(ae);const ne=document.createElement("div");ne.className="student-details-notes",ne.innerHTML="<h4>ÛŒØ§Ø¯Ø¯Ø§Ø´Øªâ€ŒÙ‡Ø§</h4>";const Te=document.createElement("ul");Te.className="notes-list",s.profile.notes&&s.profile.notes.length>0?[...s.profile.notes].sort((_,z)=>new Date(z.timestamp)-new Date(_.timestamp)).forEach(_=>{const z=document.createElement("li");z.dir=Qe(_.content),z.textContent=_.content,Te.appendChild(z)}):Te.innerHTML='<div class="no-content-message">ÛŒØ§Ø¯Ø¯Ø§Ø´ØªÛŒ ÙˆØ¬ÙˆØ¯ Ù†Ø¯Ø§Ø±Ø¯.</div>',ne.appendChild(Te),R.appendChild(ne),n.appendChild(R)}function Zn(e){e.addEventListener("input",()=>{const t=e.value,n=Qe(t);e.setAttribute("dir",n)})}function ha(){un.innerHTML="",zn.innerHTML="",Nt.classList.add("tooltip-container"),ge.disabled=!0,ue.disabled=!0,Ae.disabled=!0,ge.value="",ue.value="",Xe.classList.add("disabled-wrapper"),ve.disabled=!0}function Ca(){u.categories.filter(t=>!t.isDeleted).forEach(t=>{const n=document.createElement("span");n.className="pill",n.textContent=t.name,n.dataset.categoryId=t.id,t.description&&(n.dataset.tooltip=t.description),n.addEventListener("click",()=>{document.querySelectorAll(".pill").forEach(a=>a.classList.remove("active")),n.classList.add("active"),sn(t),es(t),Xe.classList.remove("disabled-wrapper"),ve.disabled=!1;const s=E.lastWinnerByCategory[t.name];if(s){const a=u.students.find(i=>i.identity.studentId===s);a&&Se(a,t.name)}else{zn.innerHTML="",It(null),we(-1),ve.disabled=!1;const a=document.querySelector(".current-winner-highlight");a&&a.classList.remove("current-winner-highlight")}}),un.appendChild(n)})}function ya(){if(E.lastUsedCategoryId){const e=un.querySelector(`.pill[data-category-id="${E.lastUsedCategoryId}"]`);e&&e.click()}E.winnerHistory&&E.winnerHistory.length>0&&(we(E.winnerHistory.length-1),Se())}function es(e){e&&(e.isGradedCategory?(ge.disabled=!1,ue.disabled=!1,Ae.disabled=!1,Nt.removeAttribute("data-tooltip")):(ge.disabled=!0,ue.disabled=!0,Ae.disabled=!0,Nt.setAttribute("data-tooltip","Ø¨Ø±Ø§ÛŒ Ø§ÛŒÙ† Ø¯Ø³ØªÙ‡â€ŒØ¨Ù†Ø¯ÛŒ Ù‚Ø§Ø¨Ù„ÛŒØª Ù†Ù…Ø±Ù‡ Ø¯Ù‡ÛŒ ØªØ¹Ø±ÛŒÙ Ù†Ø´Ø¯Ù‡ Ø§Ø³Øª")))}function ke(){if(!u||!E){w("class-management-page");return}ha(),Ca(),ya(),w("student-page"),le()}function ee(){if(!A)return;const e=A;jn.textContent=`Ù¾Ø±ÙˆÙØ§ÛŒÙ„: ${e.identity.name}`;const t=u.sessions.reduce((d,g)=>{const L=g.studentRecords[e.identity.studentId];return d+(L&&L.attendance==="absent"?1:0)},0),n=Object.values(e.categoryIssues||{}).reduce((d,g)=>d+g,0);qe.innerHTML=`
    <p><strong>Ú©Ù„ Ø§Ù†ØªØ®Ø§Ø¨:</strong> ${e.statusCounters.totalSelections}</p>
    <p><strong>ØºÛŒØ¨Øª:</strong> ${t}</p>
    <p><strong>ÙØ±ØµØª Ø§Ø² Ø¯Ø³Øª Ø±ÙØªÙ‡:</strong> ${e.statusCounters.missedChances||0}</p>
    <p><strong>Ù…Ø´Ú©Ù„:</strong> ${n}</p>`;const s=F(u.categories),a=document.createElement("div");if(a.className="stats-breakdown",s.length>0){s.forEach(g=>{var M;const L=g.name,v=((M=e.categoryCounts)==null?void 0:M[L])||0,I=document.createElement("p");I.className="stats-breakdown-item",I.innerHTML=`<strong>${L}:</strong> ${v}`,a.appendChild(I)});const d=qe.querySelector("p:first-child");d&&d.after(a)}const i=document.createElement("div");i.className="stats-breakdown",s.length>0&&(s.forEach(d=>{var I;const g=d.name,L=((I=e.categoryIssues)==null?void 0:I[g])||0,v=document.createElement("p");v.className="stats-breakdown-item",v.innerHTML=`<strong>${g}:</strong> ${L}`,i.appendChild(v)}),qe.appendChild(i));const o=document.createElement("p"),l=document.createElement("strong");l.textContent="ØªÚ©Ø§Ù„ÛŒÙ Ù†Ø§Ù‚Øµ:";const r=document.createElement("span");r.style.marginRight="5px";const p=he(u);gt(e,p,r,{includePrefix:!1}),o.appendChild(l),o.appendChild(r),qe.appendChild(o);const C=u.categories.filter(d=>d.isGradedCategory&&!d.isDeleted);$e.innerHTML="",C.forEach(d=>{const g=document.createElement("span");g.className="pill",g.textContent=d.name,g.dataset.skillName=d.name,d.description&&(g.dataset.tooltip=d.description),$e.appendChild(g),g.addEventListener("click",()=>{$e.querySelectorAll(".pill").forEach(L=>L.classList.remove("active")),g.classList.add("active"),zt.focus()})}),ct.innerHTML="";const h=[];for(const d in e.logs.scores)e.logs.scores[d].forEach(g=>{g.isDeleted||h.push(g)});h.sort((d,g)=>new Date(g.timestamp)-new Date(d.timestamp)),h.length===0?ct.innerHTML='<div class="no-content-message">Ù‡Ù†ÙˆØ² Ù†Ù…Ø±Ù‡â€ŒØ§ÛŒ Ø«Ø¨Øª Ù†Ø´Ø¯Ù‡ Ø§Ø³Øª.</div>':h.forEach(d=>{const g=document.createElement("li");g.className="score-history-item";const L=document.createElement("div");L.className="item-content";const v=document.createElement("div");if(v.className="score-info",v.innerHTML=`
        <span class="score-date">${new Date(d.timestamp).toLocaleDateString("fa-IR")}</span>
        <span class="score-value">Ù†Ù…Ø±Ù‡: <strong>${d.value}</strong></span>
        <span class="score-skill-badge">${d.skill}</span>
    `,L.appendChild(v),d.comment){const M=`ØªÙˆØ¶ÛŒØ­Ø§Øª: ${d.comment}`,O=Qe(M);Qe(d.comment);const B=document.createElement("p");B.className="score-comment",B.dir=O,B.innerHTML=`<strong>ØªÙˆØ¶ÛŒØ­Ø§Øª:</strong> <div>${An(d.comment)}</div>`,B.addEventListener("click",()=>{W.value=d.comment,W.dispatchEvent(new Event("input",{bubbles:!0})),me(H=>{d.comment=H,k(),ee()}),te("add-note-modal"),W.focus()}),L.appendChild(B)}const I=document.createElement("button");I.className="btn-icon delete-item-btn",I.innerHTML="ğŸ—‘ï¸",I.title="Ø­Ø°Ù Ø§ÛŒÙ† Ù†Ù…Ø±Ù‡",I.addEventListener("click",()=>{U(`Ø¢ÛŒØ§ Ø§Ø² Ø­Ø°Ù Ù†Ù…Ø±Ù‡ ${d.value} Ø¨Ø±Ø§ÛŒ Ù…Ù‡Ø§Ø±Øª ${d.skill} Ù…Ø·Ù…Ø¦Ù† Ù‡Ø³ØªÛŒØ¯ØŸ`,()=>{d.isDeleted=!0,$(u.info.name,`Ù†Ù…Ø±Ù‡ ${d.value} Ø¯Ø± ${d.skill} Ø¨Ø±Ø§ÛŒ Â«${e.identity.name}Â» Ø¨Ù‡ Ø³Ø·Ù„ Ø²Ø¨Ø§Ù„Ù‡ Ù…Ù†ØªÙ‚Ù„ Ø´Ø¯.`,{type:"VIEW_TRASH"}),k(),ee(),S("âœ…Ù†Ù…Ø±Ù‡ Ø¨Ù‡ Ø³Ø·Ù„ Ø²Ø¨Ø§Ù„Ù‡ Ù…Ù†ØªÙ‚Ù„ Ø´Ø¯.")},{confirmText:"ØªØ§ÛŒÛŒØ¯ Ø­Ø°Ù",confirmClass:"btn-warning"})}),g.appendChild(L),g.appendChild(I),ct.appendChild(g)}),zt.value="",dn.value="",$e.querySelector(".pill.active")&&$e.querySelector(".pill.active").classList.remove("active"),Ye()}function Ye(){const e=document.getElementById("profile-notes-list");if(e.innerHTML="",!A||!A.profile.notes||A.profile.notes.length===0){e.innerHTML='<div class="no-content-message">Ù‡Ù†ÙˆØ² ÛŒØ§Ø¯Ø¯Ø§Ø´ØªÛŒ Ø«Ø¨Øª Ù†Ø´Ø¯Ù‡ Ø§Ø³Øª.</div>';return}[...A.profile.notes].filter(n=>!n.isDeleted).sort((n,s)=>new Date(s.timestamp)-new Date(n.timestamp)).forEach(n=>{const s=document.createElement("li");s.className="note-history-item";const a=document.createElement("div");a.className="item-content";const i=document.createElement("div");i.className="note-info";const o=document.createElement("span");o.className="note-date",o.textContent=new Date(n.timestamp).toLocaleDateString("fa-IR");const l=document.createElement("button");l.className="btn-icon delete-item-btn",l.innerHTML="ğŸ—‘ï¸",l.title="Ø­Ø°Ù Ø§ÛŒÙ† ÛŒØ§Ø¯Ø¯Ø§Ø´Øª",l.addEventListener("click",()=>{U("Ø¢ÛŒØ§ Ø§Ø² Ø­Ø°Ù Ø§ÛŒÙ† ÛŒØ§Ø¯Ø¯Ø§Ø´Øª Ù…Ø·Ù…Ø¦Ù† Ù‡Ø³ØªÛŒØ¯ØŸ",()=>{n.isDeleted=!0,$(u.info.name,`ÛŒØ§Ø¯Ø¯Ø§Ø´Øª Ø¯Ø§Ù†Ø´â€ŒØ¢Ù…ÙˆØ² Â«${A.identity.name}Â» Ø¨Ù‡ Ø³Ø·Ù„ Ø²Ø¨Ø§Ù„Ù‡ Ù…Ù†ØªÙ‚Ù„ Ø´Ø¯.`,{type:"VIEW_TRASH"}),k(),Ye(),S("âœ…ÛŒØ§Ø¯Ø¯Ø§Ø´Øª Ø¨Ù‡ Ø³Ø·Ù„ Ø²Ø¨Ø§Ù„Ù‡ Ù…Ù†ØªÙ‚Ù„ Ø´Ø¯.")},{confirmText:"ØªØ§ÛŒÛŒØ¯ Ø­Ø°Ù",confirmClass:"btn-warning"})}),i.appendChild(o),i.appendChild(l);const r=document.createElement("p");r.className="note-content",r.innerHTML=An(n.content),r.addEventListener("click",()=>{W.value=n.content,W.dispatchEvent(new Event("input",{bubbles:!0})),me(p=>{n.content=p,k(),$(u.info.name,`ÛŒØ§Ø¯Ø¯Ø§Ø´Øª Ø¯Ø§Ù†Ø´â€ŒØ¢Ù…ÙˆØ² Â«${A.identity.name}Â» Ø¨Ù‡â€ŒØ±ÙˆØ²Ø±Ø³Ø§Ù†ÛŒ Ø´Ø¯.`,{type:"VIEW_STUDENT_PROFILE",studentId:A.identity.studentId}),Ye(),S("âœ…ÛŒØ§Ø¯Ø¯Ø§Ø´Øª Ø¨Ø§ Ù…ÙˆÙÙ‚ÛŒØª ÙˆÛŒØ±Ø§ÛŒØ´ Ø´Ø¯.")}),te("add-note-modal"),W.focus()}),a.appendChild(i),a.appendChild(r),s.appendChild(a),e.appendChild(s)})}function ts(e){Ut.innerHTML="",e.forEach((t,n)=>{const s=document.createElement("option");s.value=n,s.textContent=t.trim(),Ut.appendChild(s)})}function Kt(){Ft.innerHTML="",Xt.forEach(e=>{const t=document.createElement("li");t.className="preview-item";const n=document.createElement("input");n.type="checkbox",n.checked=!0,n.dataset.name=e;const s=document.createElement("label");s.textContent=e,t.appendChild(n),t.appendChild(s),Ft.appendChild(t)})}function Ea(e){const t=document.createElement("div");t.className="list-item-buttons";const n=document.createElement("button");return n.className="btn-icon",n.innerHTML="ğŸ“",n.title="Ø§ÙØ²ÙˆØ¯Ù†/ÙˆÛŒØ±Ø§ÛŒØ´ ÛŒØ§Ø¯Ø¯Ø§Ø´Øª Ú©Ù„Ø§Ø³",n.style.borderBottom="solid",e.note||(n.style.opacity="0.5",n.style.borderBottom="none"),n.addEventListener("click",s=>{s.stopPropagation(),mn(e)}),t.appendChild(n),t}function va(e){const t=document.createElement("div");t.style.flexGrow="1",t.style.display="flex",t.style.flexDirection="column",t.style.alignItems="flex-start";const n=document.createElement("span");n.textContent=e.info.name,n.classList.add("class-name-display"),t.appendChild(n);const s=F(e.students).length,a=F(e.sessions).filter(r=>r.isFinished).length,i=document.createElement("div");i.classList.add("class-stats-row");const o=document.createElement("span");o.textContent=`${s} Ù†ÙØ±`,o.classList.add("student-count-badge"),i.appendChild(o);const l=document.createElement("span");return l.textContent=`${a} Ø¬Ù„Ø³Ù‡`,l.classList.add("session-count-badge"),i.appendChild(l),t.appendChild(i),t.addEventListener("click",()=>{K(e),Z(null),Je(u.liveSession),G(),w("session-page")}),t}function ba(e){const t=document.createElement("li"),n=va(e);t.appendChild(n);const s=document.createElement("div");if(s.className="list-item-badges",e.liveSession&&!e.liveSession.isCancelled&&!e.liveSession.isDeleted){const o=document.createElement("span");o.className="warning-badge",o.textContent="Ø¬Ù„Ø³Ù‡ Ø¨Ø§Ø²",s.appendChild(o),t.classList.add("has-unfinished-session")}const a=document.createElement("span");a.className=`type-badge ${e.info.type}`,a.textContent=e.info.type==="online"?"Ø¢Ù†Ù„Ø§ÛŒÙ†":"Ø­Ø¶ÙˆØ±ÛŒ",a.title="Ù†ÙˆØ¹ Ú©Ù„Ø§Ø³",s.appendChild(a),t.appendChild(s);const i=Ea(e);return t.appendChild(i),t.addEventListener("contextmenu",o=>{xt(o,[{label:"ØªÙ†Ø¸ÛŒÙ…Ø§Øª Ú©Ù„Ø§Ø³",icon:"âš™ï¸",action:()=>{fn(e)}},{label:"Ú¯Ø²Ø§Ø±Ø´ ÙØ¹Ø§Ù„ÛŒØªâ€ŒÙ‡Ø§",icon:"ğŸ“‹",action:()=>{Xn(e.info.name)}},{isSeparator:!0},{label:"ØªØºÛŒÛŒØ± Ù†Ø§Ù…",icon:"âœï¸",action:()=>{const r=e.info.name,p=document.getElementById("add-note-modal-title");p.textContent="ØªØºÛŒÛŒØ± Ù†Ø§Ù… Ú©Ù„Ø§Ø³",W.value=r,W.rows=1,me(C=>{const h=C.trim();if(h&&h!==r){const d=Nn(r,h);d.success?(Ts(r,h),$(h,`Ù†Ø§Ù… Ú©Ù„Ø§Ø³ Ø§Ø² Â«${r}Â» Ø¨Ù‡ Â«${h}Â» ØªØºÛŒÛŒØ± ÛŒØ§ÙØª.`,{type:"VIEW_SESSIONS"}),k(),re(),S(`âœ…Ù†Ø§Ù… Ú©Ù„Ø§Ø³ Ø¨Ù‡ Â«${h}Â» ØªØºÛŒÛŒØ± ÛŒØ§ÙØª.`)):S(d.message)}p.textContent="Ø«Ø¨Øª ÛŒØ§Ø¯Ø¯Ø§Ø´Øª Ø¬Ø¯ÛŒØ¯",W.rows=4}),te("add-note-modal"),W.focus(),W.select()}},{label:"Ø­Ø°Ù Ú©Ù„Ø§Ø³",icon:"ğŸ—‘ï¸",className:"danger",action:()=>{U(`Ø¢ÛŒØ§ Ø§Ø² Ø­Ø°Ù Ú©Ù„Ø§Ø³ Â«${e.info.name}Â» Ù…Ø·Ù…Ø¦Ù† Ù‡Ø³ØªÛŒØ¯ØŸ Ø§ÛŒÙ† Ø¹Ù…Ù„ ØªÙ…Ø§Ù… Ø¬Ù„Ø³Ø§Øª Ùˆ Ø¢Ù…Ø§Ø± Ù…Ø±Ø¨ÙˆØ· Ø¨Ù‡ Ø¢Ù† Ø±Ø§ Ù†ÛŒØ² Ø­Ø°Ù Ù…ÛŒâ€ŒÚ©Ù†Ø¯.`,()=>{Ze(`Ú©Ù„Ø§Ø³ Â«${e.info.name}Â» Ø­Ø°Ù Ø´Ø¯.`),e.isDeleted=!0,k(),re()},{confirmText:"ØªØ§ÛŒÛŒØ¯ Ø­Ø°Ù",confirmClass:"btn-warning",isDelete:!0})}}])}),t}function re(){Pt.innerHTML="",Object.values(T).sort((t,n)=>new Date(t.info.creationDate)-new Date(n.info.creationDate)).forEach(t=>{if(t.isDeleted)return;const n=ba(t);Pt.appendChild(n)})}function be(){_t.innerHTML="",u&&F(u.students).forEach(e=>{const t=document.createElement("li"),n=document.createElement("span");n.textContent=e.identity.name,n.style.flexGrow="1",t.appendChild(n),t.addEventListener("contextmenu",s=>{xt(s,[{label:"Ø§Ù†ØªÙ‚Ø§Ù„ Ø¯Ø§Ù†Ø´â€ŒØ¢Ù…ÙˆØ²",icon:"â¡ï¸",action:()=>{Qn(e,u)}},{isSeparator:!0},{label:"Ø­Ø°Ù Ø¯Ø§Ù†Ø´â€ŒØ¢Ù…ÙˆØ²",icon:"ğŸ—‘ï¸",className:"danger",action:()=>{U(`Ø¢ÛŒØ§ Ø§Ø² Ø­Ø°Ù Ø¯Ø§Ù†Ø´â€ŒØ¢Ù…ÙˆØ² Â«${e.identity.name}Â» Ù…Ø·Ù…Ø¦Ù† Ù‡Ø³ØªÛŒØ¯ØŸ`,()=>{Ze(`Ø¯Ø§Ù†Ø´â€ŒØ¢Ù…ÙˆØ² Â«${e.identity.name}Â» Ø­Ø°Ù Ø´Ø¯.`),e.isDeleted=!0,$(u.info.name,`Ø¯Ø§Ù†Ø´â€ŒØ¢Ù…ÙˆØ² Â«${e.identity.name}Â» Ø¨Ù‡ Ø³Ø·Ù„ Ø²Ø¨Ø§Ù„Ù‡ Ù…Ù†ØªÙ‚Ù„ Ø´Ø¯.`,{type:"VIEW_TRASH"}),k(),be()},{confirmText:"ØªØ§ÛŒÛŒØ¯ Ø­Ø°Ù",confirmClass:"btn-warning"})}}])}),_t.appendChild(t)})}function Re(){if(Wt.innerHTML="",!u)return;u.categories.filter(t=>!t.isDeleted).forEach(t=>{const n=document.createElement("li"),s=document.createElement("div");s.className="name-and-badge-container";const a=document.createElement("span");if(a.textContent=t.name,s.appendChild(a),t.isGradedCategory){const o=document.createElement("span");o.className="category-badge",o.textContent="Ù‚Ø§Ø¨Ù„ Ù†Ù…Ø±Ù‡â€ŒØ¯Ù‡ÛŒ",s.appendChild(o)}const i=document.createElement("button");i.className="btn-icon",i.innerHTML="ğŸ—‘ï¸",i.style.color="var(--color-warning)",i.addEventListener("click",()=>{Ze(`Ø¯Ø³ØªÙ‡â€ŒØ¨Ù†Ø¯ÛŒ Â«${t.name}Â» Ø­Ø°Ù Ø´Ø¯.`),t.isDeleted=!0,$(u.info.name,`Ø¯Ø³ØªÙ‡â€ŒØ¨Ù†Ø¯ÛŒ Â«${t.name}Â» Ø¨Ù‡ Ø³Ø·Ù„ Ø²Ø¨Ø§Ù„Ù‡ Ù…Ù†ØªÙ‚Ù„ Ø´Ø¯.`,{type:"VIEW_TRASH"}),k(),Re()}),n.appendChild(s),n.appendChild(i),Wt.appendChild(n)})}function je(e){document.querySelectorAll(".page").forEach(n=>{n.classList.remove("active")});const t=document.getElementById(e);t&&t.classList.add("active"),e==="class-management-page"?(re(),Vt.style.display="flex"):Vt.style.display="none",Yn()}function w(e){const t={pageId:e,currentClassName:u?u.info.name:null,selectedSessionNumber:E?E.sessionNumber:null,selectedStudentId:A?A.identity.studentId:null};let n=`#${e}`;const s=new URLSearchParams;u&&s.set("class",u.info.name),E&&s.set("session",E.sessionNumber),A&&s.set("student",A.identity.studentId);const a=s.toString();a&&(n+=`?${a}`),window.location.hash!==n&&history.pushState(t,"",n),je(e)}function Sa(e,t){const n=document.createElement("div");n.className="list-item-buttons";const s=document.createElement("button");if(s.className="btn-icon",s.innerHTML="ğŸ“",s.title="Ø§ÙØ²ÙˆØ¯Ù†/ÙˆÛŒØ±Ø§ÛŒØ´ ÛŒØ§Ø¯Ø¯Ø§Ø´Øª Ø¬Ù„Ø³Ù‡",s.style.borderBottom="solid",e.note||(s.style.opacity="0.5",s.style.borderBottom="none"),s.addEventListener("click",a=>{a.stopPropagation(),W.value=e.note||"",me(i=>{e.note=i,k(),$(u.info.name,`ÛŒØ§Ø¯Ø¯Ø§Ø´Øª Ø¬Ù„Ø³Ù‡ ${t} Ø°Ø®ÛŒØ±Ù‡ Ø´Ø¯.`,{type:"VIEW_SESSIONS"}),G(),S("âœ…ÛŒØ§Ø¯Ø¯Ø§Ø´Øª Ø¬Ù„Ø³Ù‡ Ø°Ø®ÛŒØ±Ù‡ Ø´Ø¯.")}),te("add-note-modal"),W.focus()}),n.appendChild(s),!e.isFinished&&!e.isCancelled){const a=document.createElement("button");a.className="btn-icon",a.innerHTML="âœ…",a.title="Ø®Ø§ØªÙ…Ù‡ Ø¬Ù„Ø³Ù‡",a.addEventListener("click",i=>{i.stopPropagation(),U(`Ø¬Ù„Ø³Ù‡ Ø´Ù…Ø§Ø±Ù‡ ${t} Ø®Ø§ØªÙ…Ù‡ Ù¾ÛŒØ¯Ø§ Ø®ÙˆØ§Ù‡Ø¯ Ú©Ø±Ø¯!`,()=>{u.endSpecificSession(e.sessionNumber),k(),$(u.info.name,`Ø¬Ù„Ø³Ù‡ ${t} Ø®Ø§ØªÙ…Ù‡ ÛŒØ§ÙØª.`,{type:"VIEW_SESSIONS"}),G(),U("Ø¬Ù„Ø³Ù‡ Ø¨Ø§ Ù…ÙˆÙÙ‚ÛŒØª Ø®Ø§ØªÙ…Ù‡ ÛŒØ§ÙØª. Ø¢ÛŒØ§ Ù…Ø§ÛŒÙ„ Ø¨Ù‡ Ø§ÛŒØ¬Ø§Ø¯ ÙØ§ÛŒÙ„ Ù¾Ø´ØªÛŒØ¨Ø§Ù† Ù‡Ø³ØªÛŒØ¯ØŸ",()=>{pn(),S("âœ…ÙØ§ÛŒÙ„ Ù¾Ø´ØªÛŒØ¨Ø§Ù† Ø¨Ø§ Ù…ÙˆÙÙ‚ÛŒØª Ø§ÛŒØ¬Ø§Ø¯ Ø´Ø¯.")},{confirmText:"Ø¨Ù„Ù‡",cancelText:"Ø®ÛŒØ±",confirmClass:"btn-success"})})}),n.appendChild(a)}return n}function La(e,t){const n=document.createElement("div");n.style.display="flex",n.style.flexDirection="column",n.style.alignItems="flex-start",n.style.flexGrow="1";const s=new Date(e.startTime).toLocaleDateString("fa-IR"),a=document.createElement("span"),i=document.createElement("div");i.style.display="flex",i.style.gap="5px",i.style.marginTop="5px";const o=new Date(e.startTime).toLocaleDateString("fa-IR",{weekday:"long"}),l=document.createElement("span");if(l.className="type-badge day-badge",l.textContent=o,i.appendChild(l),e.isCancelled){a.textContent=`âœ…Ø¬Ù„Ø³Ù‡ Ù„ØºÙˆ Ø´Ø¯Ù‡ - ØªØ§Ø±ÛŒØ®: ${s}`,n.style.cursor="default";const r=document.createElement("span");r.className="type-badge cancelled-badge",r.textContent="Ù„ØºÙˆ Ø´Ø¯Ù‡",i.appendChild(r)}else a.textContent=`Ø¬Ù„Ø³Ù‡ ${t} - ØªØ§Ø±ÛŒØ®: ${s}`,n.style.cursor="pointer",n.addEventListener("click",()=>{Z(e),ke()});if(n.appendChild(a),e.isFinished){const r=document.createElement("span");r.className="type-badge",r.textContent="Ø®Ø§ØªÙ…Ù‡ ÛŒØ§ÙØªÙ‡",r.style.backgroundColor="var(--color-secondary)",i.appendChild(r)}if(e.isMakeup){const r=document.createElement("span");r.className="type-badge",r.textContent="Ø¬Ø¨Ø±Ø§Ù†ÛŒ",r.style.backgroundColor="var(--color-warning)",r.style.color="var(--color-text-dark)",i.appendChild(r)}return n.appendChild(i),n}function Ia(e,t){const n=document.createElement("li"),s=t.get(e.sessionNumber),a=La(e,s);n.appendChild(a);const i=Sa(e,s);return n.appendChild(i),n.addEventListener("contextmenu",o=>{const l=[{label:e.isCancelled?"Ø¨Ø§Ø²Ú¯Ø±Ø¯Ø§Ù†ÛŒ Ø¬Ù„Ø³Ù‡":"Ù„ØºÙˆ Ø¬Ù„Ø³Ù‡",icon:"âŒ",action:()=>{const r=e.isCancelled?"Ø¨Ø§Ø²Ú¯Ø±Ø¯Ø§Ù†ÛŒ Ø¬Ù„Ø³Ù‡":"Ù„ØºÙˆ Ø¬Ù„Ø³Ù‡",p=e.isCancelled?"Ø¢ÛŒØ§ Ø§Ø² Ø¨Ø§Ø²Ú¯Ø±Ø¯Ø§Ù†ÛŒ Ø§ÛŒÙ† Ø¬Ù„Ø³Ù‡ Ù…Ø·Ù…Ø¦Ù† Ù‡Ø³ØªÛŒØ¯ØŸ":"Ø¢ÛŒØ§ Ø§Ø² Ù„ØºÙˆ Ø§ÛŒÙ† Ø¬Ù„Ø³Ù‡ Ù…Ø·Ù…Ø¦Ù† Ù‡Ø³ØªÛŒØ¯ØŸ Ø¬Ù„Ø³Ù‡ Ù„ØºÙˆ Ø´Ø¯Ù‡ Ø¯Ø± Ø¢Ù…Ø§Ø± ØªØ§Ø«ÛŒØ±ÛŒ Ù†Ø¯Ø§Ø±Ø¯ Ø§Ù…Ø§ Ù‚Ø§Ø¨Ù„ Ø¨Ø§Ø²Ú¯Ø±Ø¯Ø§Ù†ÛŒ Ø§Ø³Øª.";U(p,()=>{e.isCancelled=!e.isCancelled;const C=e.isCancelled?`Ø¬Ù„Ø³Ù‡ ${s} Ù„ØºÙˆ Ø´Ø¯.`:`Ø¬Ù„Ø³Ù‡ Ù„ØºÙˆ Ø´Ø¯Ù‡ (ØªØ§Ø±ÛŒØ®: ${new Date(e.startTime).toLocaleDateString("fa-IR")}) Ø¨Ø§Ø²Ú¯Ø±Ø¯Ø§Ù†ÛŒ Ø´Ø¯.`;$(u.info.name,C,{type:"VIEW_SESSIONS"}),k(),G(),S(e.isCancelled?"âœ…Ø¬Ù„Ø³Ù‡ Ù„ØºÙˆ Ø´Ø¯.":"âœ…Ø¬Ù„Ø³Ù‡ Ø¨Ø§Ø²Ú¯Ø±Ø¯Ø§Ù†ÛŒ Ø´Ø¯.")},{confirmText:r,confirmClass:"btn-warning"})}},{label:"ØªØºÛŒÛŒØ± ÙˆØ¶Ø¹ÛŒØª Ø¬Ø¨Ø±Ø§Ù†ÛŒ",icon:"ğŸ”„",action:()=>{u.markAsMakeup(e.sessionNumber),k();const r=e.isMakeup?`Ø¬Ù„Ø³Ù‡ ${s} Ø¨Ù‡ Ø¹Ù†ÙˆØ§Ù† Ø¬Ø¨Ø±Ø§Ù†ÛŒ Ø¹Ù„Ø§Ù…Øªâ€ŒÚ¯Ø°Ø§Ø±ÛŒ Ø´Ø¯.`:`Ø¬Ù„Ø³Ù‡ ${s} Ø§Ø² Ø­Ø§Ù„Øª Ø¬Ø¨Ø±Ø§Ù†ÛŒ Ø®Ø§Ø±Ø¬ Ø´Ø¯.`;$(u.info.name,r,{type:"VIEW_SESSIONS"}),G()}},{label:"Ø­Ø°Ù Ø¬Ù„Ø³Ù‡",icon:"ğŸ—‘ï¸",className:"danger",action:()=>{const r=e.isCancelled?"Ù„ØºÙˆ Ø´Ø¯Ù‡":s;U(`Ø¢ÛŒØ§ Ø§Ø² Ø­Ø°Ù Ø¬Ù„Ø³Ù‡ ${r} Ù…Ø·Ù…Ø¦Ù† Ù‡Ø³ØªÛŒØ¯ØŸ Ø§ÛŒÙ† Ø¹Ù…Ù„ Ø¢Ù…Ø§Ø± Ø«Ø¨Øª Ø´Ø¯Ù‡ Ø¯Ø± Ø§ÛŒÙ† Ø¬Ù„Ø³Ù‡ Ø±Ø§ Ù†ÛŒØ² Ø­Ø°Ù Ù…ÛŒâ€ŒÚ©Ù†Ø¯.`,()=>{Ze(`Ø¬Ù„Ø³Ù‡ ${r} Ø­Ø°Ù Ø´Ø¯.`),e.isDeleted=!0,$(u.info.name,`Ø¬Ù„Ø³Ù‡ ${r} Ø¨Ù‡ Ø³Ø·Ù„ Ø²Ø¨Ø§Ù„Ù‡ Ù…Ù†ØªÙ‚Ù„ Ø´Ø¯.`,{type:"VIEW_TRASH"}),k(),G()},{confirmText:"ØªØ§ÛŒÛŒØ¯ Ø­Ø°Ù",confirmClass:"btn-warning",isDelete:!0})}}];xt(o,l)}),n}function G(){const e=document.getElementById("session-list");if(!u)return;if(e.innerHTML="",u.sessions.length===0){e.innerHTML="<li>Ù‡Ù†ÙˆØ² Ø¬Ù„Ø³Ù‡â€ŒØ§ÛŒ Ø´Ø±ÙˆØ¹ Ù†Ø´Ø¯Ù‡ Ø§Ø³Øª.</li>";return}const t=he(u);[...F(u.sessions)].reverse().forEach(s=>{const a=Ia(s,t);e.appendChild(a)})}function Ge(e){if(Ce.innerHTML="",e.length>0)e.forEach(t=>{const n=document.createElement("div");n.textContent=t.identity.name,n.addEventListener("click",()=>{j(t),ee(),w("student-profile-page"),Ce.style.display="none",jt.value=""}),Ce.appendChild(n)}),Ce.style.display="block";else if(jt.value.trim()!==""){const t=document.createElement("div");t.className="no-results",t.textContent="Ù¾ÛŒØ¯Ø§ Ù†Ø´Ø¯",Ce.appendChild(t),Ce.style.display="block"}else Ce.style.display="none"}function ht(e){if(pe.innerHTML="",e.length>0)e.forEach(t=>{const n=document.createElement("div");n.className="global-search-result";const s=document.createElement("span");s.className="student-name",s.textContent=t.student.identity.name;const a=document.createElement("span");a.className="class-name",a.textContent=`Ú©Ù„Ø§Ø³: ${t.classroom.info.name}`,n.addEventListener("click",()=>{K(t.classroom),j(t.student),ee(),w("student-profile-page"),pe.style.display="none",lt.value=""}),a.addEventListener("click",i=>{i.stopPropagation(),K(t.classroom),Z(null),Je(t.classroom.liveSession),G(),w("session-page"),pe.style.display="none",lt.value=""}),n.appendChild(s),n.appendChild(a),pe.appendChild(n)}),pe.style.display="block";else if(lt.value.trim()!==""){const t=document.createElement("div");t.className="no-results",t.textContent="Ù¾ÛŒØ¯Ø§ Ù†Ø´Ø¯",pe.appendChild(t),pe.style.display="block"}else pe.style.display="none"}function J(){rt.innerHTML="",dt.innerHTML="",ut.innerHTML="",mt.innerHTML="",ft.innerHTML="",pt.innerHTML="";const e=Object.values(T).filter(o=>o.isDeleted);e.length===0?rt.innerHTML="<li>Ù‡ÛŒÚ† Ú©Ù„Ø§Ø³ÛŒ Ø¯Ø± Ø³Ø·Ù„ Ø²Ø¨Ø§Ù„Ù‡ Ù†ÛŒØ³Øª.</li>":e.forEach(o=>{const l=document.createElement("li");l.innerHTML=`<span>${o.info.name}</span>`;const r=document.createElement("div");r.className="list-item-buttons";const p=document.createElement("button");p.className="btn-icon",p.innerHTML="ğŸ”„",p.title="Ø¨Ø§Ø²ÛŒØ§Ø¨ÛŒ",p.addEventListener("click",()=>{o.isDeleted=!1,$(o.info.name,`Ú©Ù„Ø§Ø³ Â«${o.info.name}Â» Ø§Ø² Ø³Ø·Ù„ Ø²Ø¨Ø§Ù„Ù‡ Ø¨Ø§Ø²ÛŒØ§Ø¨ÛŒ Ø´Ø¯.`,{type:"VIEW_SESSIONS"}),k(),J(),re(),S(`âœ…Ú©Ù„Ø§Ø³ Â«${o.info.name}Â» Ø¨Ø§Ø²ÛŒØ§Ø¨ÛŒ Ø´Ø¯.`)});const C=document.createElement("button");C.className="btn-icon",C.innerHTML="ğŸ”¥",C.title="Ø­Ø°Ù Ø¯Ø§Ø¦Ù…ÛŒ",C.addEventListener("click",()=>{U(`Ø¢ÛŒØ§ Ø§Ø² Ø­Ø°Ù Ø¯Ø§Ø¦Ù…ÛŒ Ú©Ù„Ø§Ø³ Â«${o.info.name}Â» Ù…Ø·Ù…Ø¦Ù† Ù‡Ø³ØªÛŒØ¯ØŸ Ø§ÛŒÙ† Ø¹Ù…Ù„ ØºÛŒØ±Ù‚Ø§Ø¨Ù„ Ø¨Ø§Ø²Ú¯Ø´Øª Ø§Ø³Øª.`,()=>{delete T[o.info.name],k(),J(),S(`âœ…Ú©Ù„Ø§Ø³ Â«${o.info.name}Â» Ø¨Ø±Ø§ÛŒ Ù‡Ù…ÛŒØ´Ù‡ Ø­Ø°Ù Ø´Ø¯.`)},{confirmText:"Ø­Ø°Ù Ø¯Ø§Ø¦Ù…ÛŒ",confirmClass:"btn-warning"})}),r.appendChild(p),r.appendChild(C),l.appendChild(r),rt.appendChild(l)});const t=[];Object.values(T).forEach(o=>{o.isDeleted||o.students.forEach(l=>{l.isDeleted&&t.push({student:l,classroom:o})})}),t.length===0?dt.innerHTML="<li>Ù‡ÛŒÚ† Ø¯Ø§Ù†Ø´â€ŒØ¢Ù…ÙˆØ²ÛŒ Ø¯Ø± Ø³Ø·Ù„ Ø²Ø¨Ø§Ù„Ù‡ Ù†ÛŒØ³Øª.</li>":t.forEach(({student:o,classroom:l})=>{const r=document.createElement("li");r.innerHTML=`<span>${o.identity.name} <small>(Ø§Ø² Ú©Ù„Ø§Ø³: ${l.info.name})</small></span>`;const p=document.createElement("div");p.className="list-item-buttons";const C=document.createElement("button");C.className="btn-icon",C.innerHTML="ğŸ”„",C.title="Ø¨Ø§Ø²ÛŒØ§Ø¨ÛŒ",C.addEventListener("click",()=>{o.isDeleted=!1,$(l.info.name,`Ø¯Ø§Ù†Ø´â€ŒØ¢Ù…ÙˆØ² Â«${o.identity.name}Â» Ø¨Ø§Ø²ÛŒØ§Ø¨ÛŒ Ø´Ø¯.`,{type:"VIEW_STUDENT_PROFILE",studentId:o.identity.studentId}),k(),J(),S(`Ø¯Ø§Ù†Ø´â€ŒØ¢Ù…ÙˆØ² Â«${o.identity.name}Â» Ø¨Ø§Ø²ÛŒØ§Ø¨ÛŒ Ø´Ø¯.`)});const h=document.createElement("button");h.className="btn-icon",h.innerHTML="ğŸ”¥",h.title="Ø­Ø°Ù Ø¯Ø§Ø¦Ù…ÛŒ",h.addEventListener("click",()=>{U(`Ø¢ÛŒØ§ Ø§Ø² Ø­Ø°Ù Ø¯Ø§Ø¦Ù…ÛŒ Ø¯Ø§Ù†Ø´â€ŒØ¢Ù…ÙˆØ² Â«${o.identity.name}Â» Ù…Ø·Ù…Ø¦Ù† Ù‡Ø³ØªÛŒØ¯ØŸ Ø§ÛŒÙ† Ø¹Ù…Ù„ ØºÛŒØ±Ù‚Ø§Ø¨Ù„ Ø¨Ø§Ø²Ú¯Ø´Øª Ø§Ø³Øª.`,()=>{kt(o,l),k(),J(),S(`Ø¯Ø§Ù†Ø´â€ŒØ¢Ù…ÙˆØ² Â«${o.identity.name}Â» Ø¨Ø±Ø§ÛŒ Ù‡Ù…ÛŒØ´Ù‡ Ø­Ø°Ù Ø´Ø¯.`)},{confirmText:"Ø­Ø°Ù Ø¯Ø§Ø¦Ù…ÛŒ",confirmClass:"btn-warning"})}),p.appendChild(C),p.appendChild(h),r.appendChild(p),dt.appendChild(r)});const n=[];Object.values(T).forEach(o=>{o.isDeleted||o.sessions.forEach(l=>{l.isDeleted&&n.push({session:l,classroom:o})})}),n.length===0?ut.innerHTML="<li>Ù‡ÛŒÚ† Ø¬Ù„Ø³Ù‡â€ŒØ§ÛŒ Ø¯Ø± Ø³Ø·Ù„ Ø²Ø¨Ø§Ù„Ù‡ Ù†ÛŒØ³Øª.</li>":n.forEach(({session:o,classroom:l})=>{const r=document.createElement("li");r.innerHTML=`<span>Ø¬Ù„Ø³Ù‡ ${o.sessionNumber} <small>(Ø§Ø² Ú©Ù„Ø§Ø³: ${l.info.name})</small></span>`;const p=document.createElement("div");p.className="list-item-buttons";const C=document.createElement("button");C.className="btn-icon",C.innerHTML="ğŸ”„",C.title="Ø¨Ø§Ø²ÛŒØ§Ø¨ÛŒ",C.addEventListener("click",()=>{o.isDeleted=!1,$(l.info.name,`Ø¬Ù„Ø³Ù‡ ${o.sessionNumber} Ø¨Ø§Ø²ÛŒØ§Ø¨ÛŒ Ø´Ø¯.`,{type:"VIEW_SESSIONS"}),k(),J(),S(`Ø¬Ù„Ø³Ù‡ ${o.sessionNumber} Ø¨Ø§Ø²ÛŒØ§Ø¨ÛŒ Ø´Ø¯.`)});const h=document.createElement("button");h.className="btn-icon",h.innerHTML="ğŸ”¥",h.title="Ø­Ø°Ù Ø¯Ø§Ø¦Ù…ÛŒ",h.addEventListener("click",()=>{U(`Ø¢ÛŒØ§ Ø§Ø² Ø­Ø°Ù Ø¯Ø§Ø¦Ù…ÛŒ Ø¬Ù„Ø³Ù‡ ${o.sessionNumber} Ù…Ø·Ù…Ø¦Ù† Ù‡Ø³ØªÛŒØ¯ØŸ`,()=>{const d=l.sessions.findIndex(g=>g.sessionNumber===o.sessionNumber);d>-1&&l.sessions.splice(d,1),k(),J(),S(`Ø¬Ù„Ø³Ù‡ ${o.sessionNumber} Ø¨Ø±Ø§ÛŒ Ù‡Ù…ÛŒØ´Ù‡ Ø­Ø°Ù Ø´Ø¯.`)},{confirmText:"Ø­Ø°Ù Ø¯Ø§Ø¦Ù…ÛŒ",confirmClass:"btn-warning"})}),p.appendChild(C),p.appendChild(h),r.appendChild(p),ut.appendChild(r)});const s=[];Object.values(T).forEach(o=>{o.isDeleted||o.categories.forEach(l=>{l.isDeleted&&s.push({category:l,classroom:o})})}),s.length===0?mt.innerHTML="<li>Ù‡ÛŒÚ† Ø¯Ø³ØªÙ‡â€ŒØ¨Ù†Ø¯ÛŒ Ø¯Ø± Ø³Ø·Ù„ Ø²Ø¨Ø§Ù„Ù‡ Ù†ÛŒØ³Øª.</li>":s.forEach(({category:o,classroom:l})=>{const r=document.createElement("li");r.innerHTML=`<span>${o.name} <small>(Ø§Ø² Ú©Ù„Ø§Ø³: ${l.info.name})</small></span>`;const p=document.createElement("div");p.className="list-item-buttons";const C=document.createElement("button");C.className="btn-icon",C.innerHTML="ğŸ”„",C.title="Ø¨Ø§Ø²ÛŒØ§Ø¨ÛŒ",C.addEventListener("click",()=>{o.isDeleted=!1,$(l.info.name,`Ø¯Ø³ØªÙ‡â€ŒØ¨Ù†Ø¯ÛŒ Â«${o.name}Â» Ø¨Ø§Ø²ÛŒØ§Ø¨ÛŒ Ø´Ø¯.`,{type:"VIEW_SESSIONS"}),k(),J(),S(`Ø¯Ø³ØªÙ‡â€ŒØ¨Ù†Ø¯ÛŒ Â«${o.name}Â» Ø¨Ø§Ø²ÛŒØ§Ø¨ÛŒ Ø´Ø¯.`)});const h=document.createElement("button");h.className="btn-icon",h.innerHTML="ğŸ”¥",h.title="Ø­Ø°Ù Ø¯Ø§Ø¦Ù…ÛŒ",h.addEventListener("click",()=>{U(`Ø¢ÛŒØ§ Ø§Ø² Ø­Ø°Ù Ø¯Ø§Ø¦Ù…ÛŒ Ø¯Ø³ØªÙ‡â€ŒØ¨Ù†Ø¯ÛŒ Â«${o.name}Â» Ù…Ø·Ù…Ø¦Ù† Ù‡Ø³ØªÛŒØ¯ØŸ`,()=>{const d=o.name,g=d.toLowerCase();l.students.forEach(v=>{v.categoryCounts&&v.categoryCounts[d]&&delete v.categoryCounts[d],v.categoryIssues&&v.categoryIssues[d]&&delete v.categoryIssues[d],v.logs.scores&&v.logs.scores[g]&&delete v.logs.scores[g]});const L=l.categories.findIndex(v=>v.id===o.id);L>-1&&l.categories.splice(L,1),k(),J(),S(`Ø¯Ø³ØªÙ‡â€ŒØ¨Ù†Ø¯ÛŒ Â«${d}Â» Ùˆ ØªÙ…Ø§Ù… Ø¯Ø§Ø¯Ù‡â€ŒÙ‡Ø§ÛŒ Ù…Ø±ØªØ¨Ø· Ø¨Ø§ Ø¢Ù† Ø¨Ø±Ø§ÛŒ Ù‡Ù…ÛŒØ´Ù‡ Ø­Ø°Ù Ø´Ø¯.`)},{confirmText:"Ø­Ø°Ù Ø¯Ø§Ø¦Ù…ÛŒ",confirmClass:"btn-warning"})}),p.appendChild(C),p.appendChild(h),r.appendChild(p),mt.appendChild(r)});const a=[];Object.values(T).forEach(o=>{o.isDeleted||o.students.forEach(l=>{l.isDeleted||l.profile.notes.forEach(r=>{r.isDeleted&&a.push({note:r,student:l,classroom:o})})})}),a.length===0?ft.innerHTML="<li>Ù‡ÛŒÚ† ÛŒØ§Ø¯Ø¯Ø§Ø´ØªÛŒ Ø¯Ø± Ø³Ø·Ù„ Ø²Ø¨Ø§Ù„Ù‡ Ù†ÛŒØ³Øª.</li>":a.forEach(({note:o,student:l,classroom:r})=>{const p=document.createElement("li"),C=o.content.length>50?o.content.substring(0,50)+"...":o.content;p.innerHTML=`<span>"${C}" <small>(Ø¨Ø±Ø§ÛŒ: ${l.identity.name}ØŒ Ú©Ù„Ø§Ø³: ${r.info.name})</small></span>`;const h=document.createElement("div");h.className="list-item-buttons";const d=document.createElement("button");d.className="btn-icon",d.innerHTML="ğŸ”„",d.title="Ø¨Ø§Ø²ÛŒØ§Ø¨ÛŒ",d.addEventListener("click",()=>{o.isDeleted=!1,$(r.info.name,`ÛŒØ§Ø¯Ø¯Ø§Ø´Øª Ø¯Ø§Ù†Ø´â€ŒØ¢Ù…ÙˆØ² Â«${l.identity.name}Â» Ø¨Ø§Ø²ÛŒØ§Ø¨ÛŒ Ø´Ø¯.`,{type:"VIEW_STUDENT_PROFILE",studentId:l.identity.studentId}),k(),J(),S("ÛŒØ§Ø¯Ø¯Ø§Ø´Øª Ø¨Ø§Ø²ÛŒØ§Ø¨ÛŒ Ø´Ø¯.")});const g=document.createElement("button");g.className="btn-icon",g.innerHTML="ğŸ”¥",g.title="Ø­Ø°Ù Ø¯Ø§Ø¦Ù…ÛŒ",g.addEventListener("click",()=>{U("Ø¢ÛŒØ§ Ø§Ø² Ø­Ø°Ù Ø¯Ø§Ø¦Ù…ÛŒ Ø§ÛŒÙ† ÛŒØ§Ø¯Ø¯Ø§Ø´Øª Ù…Ø·Ù…Ø¦Ù† Ù‡Ø³ØªÛŒØ¯ØŸ Ø§ÛŒÙ† Ø¹Ù…Ù„ ØºÛŒØ±Ù‚Ø§Ø¨Ù„ Ø¨Ø§Ø²Ú¯Ø´Øª Ø§Ø³Øª.",()=>{const L=l.profile.notes.findIndex(v=>v.id===o.id);L>-1&&l.profile.notes.splice(L,1),k(),J(),S("ÛŒØ§Ø¯Ø¯Ø§Ø´Øª Ø¨Ø±Ø§ÛŒ Ù‡Ù…ÛŒØ´Ù‡ Ø­Ø°Ù Ø´Ø¯.")},{confirmText:"Ø­Ø°Ù Ø¯Ø§Ø¦Ù…ÛŒ",confirmClass:"btn-warning"})}),h.appendChild(d),h.appendChild(g),p.appendChild(h),ft.appendChild(p)});const i=[];Object.values(T).forEach(o=>{o.isDeleted||o.students.forEach(l=>{if(!l.isDeleted)for(const r in l.logs.scores)l.logs.scores[r].forEach(p=>{p.isDeleted&&i.push({score:p,student:l,classroom:o})})})}),i.length===0?pt.innerHTML="<li>Ù‡ÛŒÚ† ØªÙˆØ¶ÛŒØ­ Ù†Ù…Ø±Ù‡â€ŒØ§ÛŒ Ø¯Ø± Ø³Ø·Ù„ Ø²Ø¨Ø§Ù„Ù‡ Ù†ÛŒØ³Øª.</li>":i.forEach(({score:o,student:l,classroom:r})=>{const p=document.createElement("li");let C=`Ù†Ù…Ø±Ù‡ ${o.value} Ø¯Ø± Ù…Ù‡Ø§Ø±Øª ${o.skill}`;if(o.comment){const L=o.comment.length>30?o.comment.substring(0,30)+"...":o.comment;C+=` (ØªÙˆØ¶ÛŒØ­Ø§Øª: "${L}")`}p.innerHTML=`<span>${C} <small>(Ø¯Ø§Ù†Ø´â€ŒØ¢Ù…ÙˆØ²: ${l.identity.name}ØŒ Ú©Ù„Ø§Ø³: ${r.info.name})</small></span>`;const h=document.createElement("div");h.className="list-item-buttons";const d=document.createElement("button");d.className="btn-icon",d.innerHTML="ğŸ”„",d.title="Ø¨Ø§Ø²ÛŒØ§Ø¨ÛŒ",d.addEventListener("click",()=>{o.isDeleted=!1,$(r.info.name,`Ù†Ù…Ø±Ù‡ ${o.value} Ø¯Ø± ${o.skill} Ø¨Ø±Ø§ÛŒ Â«${l.identity.name}Â» Ø¨Ø§Ø²ÛŒØ§Ø¨ÛŒ Ø´Ø¯.`,{type:"VIEW_STUDENT_PROFILE",studentId:l.identity.studentId}),k(),J(),S("ØªÙˆØ¶ÛŒØ­ Ù†Ù…Ø±Ù‡ Ø¨Ø§Ø²ÛŒØ§Ø¨ÛŒ Ø´Ø¯.")});const g=document.createElement("button");g.className="btn-icon",g.innerHTML="ğŸ”¥",g.title="Ø­Ø°Ù Ø¯Ø§Ø¦Ù…ÛŒ",g.addEventListener("click",()=>{U("Ø¢ÛŒØ§ Ø§Ø² Ø­Ø°Ù Ø¯Ø§Ø¦Ù…ÛŒ Ø§ÛŒÙ† ØªÙˆØ¶ÛŒØ­ Ù…Ø·Ù…Ø¦Ù† Ù‡Ø³ØªÛŒØ¯ØŸ Ø§ÛŒÙ† Ø¹Ù…Ù„ ØºÛŒØ±Ù‚Ø§Ø¨Ù„ Ø¨Ø§Ø²Ú¯Ø´Øª Ø§Ø³Øª.",()=>{const L=o.skill.toLowerCase(),v=l.logs.scores[L];if(v){const I=v.findIndex(M=>M.id===o.id);I>-1&&v.splice(I,1)}k(),J(),S("ØªÙˆØ¶ÛŒØ­ Ù†Ù…Ø±Ù‡ Ø¨Ø±Ø§ÛŒ Ù‡Ù…ÛŒØ´Ù‡ Ø­Ø°Ù Ø´Ø¯.")},{confirmText:"Ø­Ø°Ù Ø¯Ø§Ø¦Ù…ÛŒ",confirmClass:"btn-warning"})}),h.appendChild(d),h.appendChild(g),p.appendChild(h),pt.appendChild(p)})}function ka(){const e=document.getElementById("absentees-summary-container");e&&(e.innerHTML=`
        <div id="absentees-summary-box" class="absentees-summary">
            <div class="absentees-summary-header">
                <h4>Ù„ÛŒØ³Øª ØºØ§ÛŒØ¨ÛŒÙ† Ø¬Ù„Ø³Ù‡ Ø´Ù…Ø§Ø±Ù‡ <span id="absentee-summary-session-number"></span></h4>
                <button id="copy-absentees-btn" class="btn-icon" title="Ú©Ù¾ÛŒ Ù„ÛŒØ³Øª ØºØ§ÛŒØ¨ÛŒÙ†">ğŸ“‹</button>
            </div>
            <div id="absentees-summary-list" class="summary-list"></div>
        </div>
    `)}function ns(){const e=document.getElementById("absentees-summary-box"),t=document.getElementById("absentees-summary-list"),n=document.getElementById("absentee-summary-session-number");if(!e||!t||!n){console.error("Could not find all absentee summary elements.");return}if(!u||!E){e.classList.remove("visible");return}const s=F(u.students).filter(i=>{const o=E.studentRecords[i.identity.studentId];return o&&o.attendance==="absent"}),a=he(u);n.textContent=a.get(E.sessionNumber),s.length>0?e.classList.add("visible"):e.classList.remove("visible"),t.innerHTML="",s.forEach(i=>{const l=(p=>u.sessions.reduce((C,h)=>{if(h.isDeleted||h.isCancelled)return C;const d=h.studentRecords[p.identity.studentId];return C+(d&&d.attendance==="absent"?1:0)},0))(i),r=document.createElement("span");r.className="summary-name",r.textContent=`${i.identity.name} (ØºÛŒØ¨Øª: ${l})`,r.addEventListener("click",()=>{r.classList.add("fading-out"),setTimeout(()=>{E.setAttendance(i.identity.studentId,"present"),k(),Oe()},200)}),t.appendChild(r)})}function wa(){const e=document.getElementById("copy-absentees-btn");if(!e){console.error("Could not find the copy absentees button to attach listener.");return}e.addEventListener("click",()=>{if(!u||!E)return;const t=F(u.students).filter(a=>{const i=E.studentRecords[a.identity.studentId];return i&&i.attendance==="absent"});if(t.length===0){S("âš ï¸Ù„ÛŒØ³Øª ØºØ§ÛŒØ¨ÛŒÙ† Ø®Ø§Ù„ÛŒ Ø§Ø³Øª.");return}const n=a=>u.sessions.reduce((i,o)=>{if(o.isDeleted||o.isCancelled)return i;const l=o.studentRecords[a.identity.studentId];return i+(l&&l.attendance==="absent"?1:0)},0);let s=`Ù„ÛŒØ³Øª ØºØ§ÛŒØ¨ÛŒÙ† Ø¬Ù„Ø³Ù‡ Ø´Ù…Ø§Ø±Ù‡ ${ga()}:

`;t.forEach(a=>{const i=n(a);s+=`- ${a.identity.name} (ØªØ¹Ø¯Ø§Ø¯ ØºÛŒØ¨Øªâ€ŒÙ‡Ø§: ${i})
`}),navigator.clipboard.writeText(s).then(()=>{S("âœ…Ù„ÛŒØ³Øª ØºØ§ÛŒØ¨ÛŒÙ† Ø¨Ø§ Ù…ÙˆÙÙ‚ÛŒØª Ú©Ù¾ÛŒ Ø´Ø¯.")}).catch(a=>{console.error("Failed to copy text: ",a),S("âŒØ®Ø·Ø§ Ø¯Ø± Ú©Ù¾ÛŒ Ú©Ø±Ø¯Ù† Ù„ÛŒØ³Øª.")})})}const Na=Object.freeze(Object.defineProperty({__proto__:null,_internalShowPage:je,addCategoryBtn:js,addClassBtn:xs,addNoteModal:ca,addScoreBtn:ma,addStudentBtn:Os,appHeader:Vt,attendanceListUl:ot,attendancePage:zs,backToAttendanceBtn:Qs,backToSessionsBtn:$s,backToSessionsFromAttendanceBtn:Ks,backToStudentPageBtn:ua,backupDataBtn:na,breadcrumbContainer:He,cancelImportBtn:qs,cancelNoteBtn:ra,categoryListUl:Wt,classListHeader:Xs,classListUl:Pt,classManagementPage:_n,classSaveNoteBtn:la,closeActiveModal:Y,closeContextMenu:Ie,closeNavBtn:ea,columnMappingPage:Us,columnSelectDropdown:Ut,confirmColumnBtn:Vs,confirmModalCancelBtn:Gt,confirmModalConfirmBtn:Ve,confirmModalMessage:Vn,contextMenu:Ne,csvCancelBtn:_s,csvConfirmBtn:Ps,csvFileInput:Fs,csvPreviewList:Ft,csvPreviewPage:Rs,customConfirmModal:aa,displayWinner:Se,finishAttendanceBtn:Js,globalStudentSearchInput:lt,globalStudentSearchResultsDiv:pe,gradedCategoryPillsContainer:$e,hamburgerMenuBtn:Ys,handleUndo:Jn,importCsvBtn:Ws,initiateBackupProcess:pn,isGradedCheckbox:fa,newCategoryNameInput:Gs,newClassNameInput:Bs,newNoteContent:W,newScoreCommentTextarea:dn,newScoreValueInput:zt,newStudentNameInput:Hs,openContextMenu:xt,openModal:te,overlay:ta,pasteArea:Fn,processPasteBtn:As,profileScoresListUl:ct,profileStatsSummaryDiv:qe,profileStudentNameHeader:jn,quickGradeFormWrapper:Nt,quickGradeSubmitBtn:Ae,quickNoteTextarea:ue,quickScoreInput:ge,renderAttendancePage:Oe,renderBreadcrumbs:Yn,renderClassList:re,renderColumnSelector:ts,renderGlobalSearchResults:ht,renderImportPreview:Kt,renderLogModal:Xn,renderSearchResults:Ge,renderSessions:G,renderSettingsCategories:Re,renderSettingsStudentList:be,renderStudentNotes:Ye,renderStudentPage:ke,renderStudentProfilePage:ee,renderStudentStatsList:le,renderTrashPage:J,restoreDataBtn:sa,restoreFileInput:Un,secureConfirmCancelBtn:ia,secureConfirmCode:Gn,secureConfirmConfirmBtn:it,secureConfirmInput:Me,secureConfirmMessage:qn,secureConfirmModal:oa,selectStudentBtn:ve,selectStudentBtnWrapper:Xe,setAutoDirectionOnInput:Zn,settingsClassNameHeader:rn,settingsPage:Ms,settingsStudentListUl:_t,showClassNoteModal:mn,showCustomConfirm:U,showMoveStudentModal:Qn,showNotification:S,showPage:w,showSecureConfirm:Kn,showSettingsPage:fn,showUndoToast:Ze,sideNavMenu:Zs,studentProfilePage:da,studentSearchInput:jt,studentSearchResultsDiv:Ce,studentStatsHeader:qt,trashedCategoriesList:mt,trashedClassesList:rt,trashedNotesList:ft,trashedScoresList:pt,trashedSessionsList:ut,trashedStudentsList:dt,triggerFileDownload:Jt,undoBtn:Ds,undoMessage:Wn,undoToast:wt},Symbol.toStringTag,{value:"Module"}));function Ta(){const e=window.location.hash;if(!e||e==="#")return!1;const[t,n]=e.split("?"),s=t.substring(1),a=new URLSearchParams(n),i=a.get("class"),o=parseInt(a.get("session"),10),l=a.get("student");if(i&&T[i])K(T[i]),o&&u.getSession(o)&&Z(u.getSession(o)),l&&u.students.find(r=>r.identity.studentId===l)&&j(u.students.find(r=>r.identity.studentId===l));else return!1;switch(s){case"session-page":G(),w("session-page");break;case"student-page":ke();break;case"attendance-page":Oe(),w("attendance-page");break;case"settings-page":rn.textContent=`ØªÙ†Ø¸ÛŒÙ…Ø§Øª Ú©Ù„Ø§Ø³: ${u.info.name}`,be(),Re(),w("settings-page");break;case"student-profile-page":ee(),w("student-profile-page");break;default:return!1}return!0}document.addEventListener("DOMContentLoaded",()=>{const{globalStudentSearchInput:e,newClassNameInput:t,addClassBtn:n,undoBtn:s,backToSessionsBtn:a,newStudentNameInput:i,addStudentBtn:o,pasteArea:l,processPasteBtn:r,csvPreviewList:p,csvConfirmBtn:C,csvCancelBtn:h,importCsvBtn:d,csvFileInput:g,columnSelectDropdown:L,confirmColumnBtn:v,cancelImportBtn:I,newCategoryNameInput:M,addCategoryBtn:O,selectStudentBtn:B,attendancePage:H,finishAttendanceBtn:R,backToSessionsFromAttendanceBtn:ae,backToAttendanceBtn:Q,classListHeader:fe,studentStatsHeader:q,hamburgerMenuBtn:oe,sideNavMenu:ne,closeNavBtn:Te,overlay:P,backupDataBtn:_,restoreDataBtn:z,restoreFileInput:Le,confirmModalCancelBtn:Dt,confirmModalConfirmBtn:Pe,secureConfirmCancelBtn:Mt,secureConfirmConfirmBtn:ss,newNoteContent:et,classSaveNoteBtn:as,cancelNoteBtn:os,studentSearchInput:_e,studentSearchResultsDiv:is,studentProfilePage:cs,profileStudentNameHeader:ls,backToStudentPageBtn:rs,gradedCategoryPillsContainer:ds,newScoreValueInput:us,newScoreCommentTextarea:ms,addScoreBtn:fs,isGradedCheckbox:gn}=Na,ps=document.getElementById("trash-nav-btn");document.querySelector(".global-search-container .search-icon"),Rt(),Ta()||(re(),w("class-management-page"));function hn(c,f){const m=document.querySelector(c);if(!m)return;const y=m.querySelector(".search-icon"),b=m.querySelector(".animated-search-input");!y||!b||(y.addEventListener("mousedown",x=>{x.preventDefault()}),y.addEventListener("click",()=>{m.classList.contains("search-active")||(m.classList.add("search-active"),b.focus())}),b.addEventListener("blur",()=>{setTimeout(()=>{m.classList.remove("search-active"),b.value="",f&&f([])},150)}))}window.addEventListener("scroll",Ie),document.addEventListener("click",c=>{Ne.classList.contains("visible")&&!Ne.contains(c.target)&&Ie(),_e.contains(c.target)||(is.style.display="none");const f=c.target.closest(".log-action-link");if(f&&f.dataset.action)try{const m=JSON.parse(f.dataset.action);bs(m)}catch(m){console.error("Could not parse log action:",m)}}),Xe.addEventListener("click",()=>{(Xe.classList.contains("disabled-wrapper")||ve.disabled)&&(ve.classList.add("shake-animation"),setTimeout(()=>{ve.classList.remove("shake-animation")},200))}),q.addEventListener("click",()=>{const c=new Date().getTime();c-en>500?at(1):at(Et+1),Mn(c),Et===5&&(at(0),U("Ø¢ÛŒØ§ Ø§Ø² ØµÙØ± Ú©Ø±Ø¯Ù† ØªÙ…Ø§Ù… Ø´Ù…Ø§Ø±Ù†Ø¯Ù‡â€ŒÙ‡Ø§ÛŒ Ø¯Ø§Ù†Ø´â€ŒØ¢Ù…ÙˆØ²Ø§Ù† Ù…Ø·Ù…Ø¦Ù† Ù‡Ø³ØªÛŒØ¯ØŸ Ø§ÛŒÙ† Ø¹Ù…Ù„ ØºÛŒØ±Ù‚Ø§Ø¨Ù„ Ø¨Ø§Ø²Ú¯Ø´Øª Ø§Ø³Øª.",()=>{On(),le(),S("ØªÙ…Ø§Ù… Ø¢Ù…Ø§Ø±Ù‡Ø§ ØµÙØ± Ø´Ø¯Ù†Ø¯ âœ….")},{confirmText:"Ø¨Ù„Ù‡",confirmClass:"btn-warning"}))}),fe.addEventListener("click",()=>{const c=new Date().getTime();c-Zt>500?st(1):st(yt+1),Dn(c),yt===5&&(st(0),U("Ø¢ÛŒØ§ Ø§Ø² Ø³Ø§Ø®Øª ÛŒÚ© Ú©Ù„Ø§Ø³ ØªØ³ØªÛŒ ØªØµØ§Ø¯ÙÛŒ Ù…Ø·Ù…Ø¦Ù† Ù‡Ø³ØªÛŒØ¯ØŸ",()=>{function f(){const m=`Ú©Ù„Ø§Ø³ ØªØ³ØªÛŒ ${Object.keys(T).length+1}`,y=new At({name:m,type:"online"});["Ø¹Ù„ÛŒ Ø±Ø¶Ø§ÛŒÛŒ","Ù…Ø±ÛŒÙ… Ø­Ø³ÛŒÙ†ÛŒ","Ø²Ù‡Ø±Ø§ Ø§Ø­Ù…Ø¯ÛŒ","Ø±Ø¶Ø§ Ù…Ø­Ù…Ø¯ÛŒ","ÙØ§Ø·Ù…Ù‡ Ú©Ø±ÛŒÙ…ÛŒ"].forEach(x=>y.addStudent(new tt({name:x}))),T[m]=y,k(),re()}f(),S("Ú©Ù„Ø§Ø³ ØªØ³ØªÛŒ Ø¨Ø§ Ù…ÙˆÙÙ‚ÛŒØª Ø³Ø§Ø®ØªÙ‡ Ø´Ø¯ âœ…!")},{confirmText:"Ø¨Ø³Ø§Ø²",confirmClass:"btn-success"}))}),Mt.addEventListener("click",()=>{Y(),Ke(null)}),ss.addEventListener("click",()=>{typeof vt=="function"&&vt(),Y(),Ke(null)}),Dt.addEventListener("click",()=>{Y(nn)}),Pe.addEventListener("click",()=>{Y(tn)}),Q.addEventListener("click",()=>{u&&E&&(Oe(),w("attendance-page"))}),B.addEventListener("click",()=>{if(ge.value.trim()!==""||ue.value.trim()!==""){S("âš ï¸Ù„Ø·ÙØ§Ù‹ Ø§Ø¨ØªØ¯Ø§ Ø¨Ø§ Ø¯Ú©Ù…Ù‡ Â«Ø«Ø¨ØªÂ»ØŒ ØªØºÛŒÛŒØ±Ø§Øª Ø±Ø§ Ø°Ø®ÛŒØ±Ù‡ Ú©Ù†ÛŒØ¯ Ùˆ ÛŒØ§ Ù†Ù…Ø±Ù‡ Ùˆ ÛŒØ§Ø¯Ø¯Ø§Ø´Øª Ø±Ø§ Ù¾Ø§Ú© Ú©Ù†ÛŒØ¯.");return}if(!u||!E||!ce)return;const c=u.selectNextWinner(ce.name,E);if(c){const f=E.studentRecords[c.identity.studentId];if(f&&f.attendance==="absent"&&c.statusCounters.missedChances++,f&&f.hadIssue){c.statusCounters.missedChances++;const y=ce.name;c.categoryIssues[y]=(c.categoryIssues[y]||0)+1}const m={winner:c,categoryName:ce.name};E.winnerHistory.push(m),E.winnerHistory.length>10&&E.winnerHistory.shift(),we(E.winnerHistory.length-1),E.lastUsedCategoryId=ce.id,E.lastSelectedWinnerId=c.identity.studentId,le(),Se(),k()}else S("âŒØ¯Ø§Ù†Ø´â€ŒØ¢Ù…ÙˆØ² ÙˆØ§Ø¬Ø¯ Ø´Ø±Ø§ÛŒØ·ÛŒ Ø¨Ø±Ø§ÛŒ Ø§Ù†ØªØ®Ø§Ø¨ ÛŒØ§ÙØª Ù†Ø´Ø¯.")}),O.addEventListener("click",()=>{if(!u)return;const c=M.value.trim(),f=gn.checked;if(!c){alert("âš ï¸Ù„Ø·ÙØ§Ù‹ Ù†Ø§Ù… Ø¯Ø³ØªÙ‡â€ŒØ¨Ù†Ø¯ÛŒ Ø±Ø§ ÙˆØ§Ø±Ø¯ Ú©Ù†ÛŒØ¯.");return}const m=u.categories.find(b=>b.name.toLowerCase()===c.toLowerCase());if(m)if(m.isDeleted){const b=u.categories.findIndex(x=>x===m);b>-1&&u.categories.splice(b,1)}else{alert("âš ï¸Ø§ÛŒÙ† Ø¯Ø³ØªÙ‡â€ŒØ¨Ù†Ø¯ÛŒ Ø§Ø² Ù‚Ø¨Ù„ ÙˆØ¬ÙˆØ¯ Ø¯Ø§Ø±Ø¯.");return}const y=new ye(c,"",f);u.categories.push(y),k(),$(u.info.name,`Ø¯Ø³ØªÙ‡â€ŒØ¨Ù†Ø¯ÛŒ Ø¬Ø¯ÛŒØ¯ Â«${c}Â» Ø§Ø¶Ø§ÙÙ‡ Ø´Ø¯.`,{type:"VIEW_CLASS_SETTINGS"}),Re(),M.value="",gn.checked=!1}),M.addEventListener("keyup",c=>{c.key==="Enter"&&O.click()}),v.addEventListener("click",()=>{if(!Ct){alert("âŒØ®Ø·Ø§ÛŒÛŒ Ø±Ø® Ø¯Ø§Ø¯Ù‡ Ø§Ø³Øª. Ù„Ø·ÙØ§Ù‹ ÙØ§ÛŒÙ„ Ø±Ø§ Ø¯ÙˆØ¨Ø§Ø±Ù‡ Ø§Ù†ØªØ®Ø§Ø¨ Ú©Ù†ÛŒØ¯."),w("settings-page");return}const c=parseInt(L.value,10),y=Ct.split(`
`).slice(1).map(b=>{var N;return(N=b.split(",")[c])==null?void 0:N.trim()}).filter(b=>b&&b.length>0);y.length>0?(Ue(y),Kt(),w("csv-preview-page")):alert("Ù‡ÛŒÚ† Ù†Ø§Ù…ÛŒ Ø¯Ø± Ø³ØªÙˆÙ† Ø§Ù†ØªØ®Ø§Ø¨ Ø´Ø¯Ù‡ Ù¾ÛŒØ¯Ø§ Ù†Ø´Ø¯. Ù„Ø·ÙØ§Ù‹ Ø³ØªÙˆÙ† Ø¯ÛŒÚ¯Ø±ÛŒ Ø±Ø§ Ø§Ù…ØªØ­Ø§Ù† Ú©Ù†ÛŒØ¯ ÛŒØ§ ÙØ§ÛŒÙ„ Ø®ÙˆØ¯ Ø±Ø§ Ø¨Ø±Ø±Ø³ÛŒ Ú©Ù†ÛŒØ¯."),nt(null)}),d.addEventListener("click",()=>{g.click()}),g.addEventListener("change",c=>{const f=c.target.files[0];if(!f)return;const m=new FileReader;m.onload=y=>{const b=y.target.result;nt(b);const N=b.split(`
`)[0].split(",");ts(N),w("column-mapping-page")},m.readAsText(f),c.target.value=null}),I.addEventListener("click",()=>{nt(null),w("settings-page")}),C.addEventListener("click",()=>{const c=p.querySelectorAll('input[type="checkbox"]:checked');let f=!1;c.forEach(m=>{const y=m.dataset.name,b=u.students.find(N=>N.identity.name.toLowerCase()===y.toLowerCase());if(b)if(b.isDeleted)kt(b,u);else{console.log(`Ø¯Ø§Ù†Ø´â€ŒØ¢Ù…ÙˆØ² Â«${y}Â» Ø¨Ù‡ Ø¯Ù„ÛŒÙ„ ØªÚ©Ø±Ø§Ø±ÛŒ Ø¨ÙˆØ¯Ù† Ø§Ø¶Ø§ÙÙ‡ Ù†Ø´Ø¯.`);return}const x=new tt({name:y});u.addStudent(x),u.sessions.length>0&&(yn(x,u),f=!0)}),k(),$(u.info.name,`${c.length} Ø¯Ø§Ù†Ø´â€ŒØ¢Ù…ÙˆØ² Ø¬Ø¯ÛŒØ¯ Ø§Ø² Ù„ÛŒØ³Øª ÙˆØ±ÙˆØ¯ÛŒ Ø¨Ù‡ Ú©Ù„Ø§Ø³ Ø§Ø¶Ø§ÙÙ‡ Ø´Ø¯Ù†Ø¯.`,{type:"VIEW_SESSIONS"}),be(),f&&En(c.length),w("settings-page"),l.value="",Ue([])}),h.addEventListener("click",()=>{Ue([]),w("settings-page")}),r.addEventListener("click",()=>{const c=l.value.trim();if(!c){alert("Ú©Ø§Ø¯Ø± Ù…ØªÙ†ÛŒ Ø®Ø§Ù„ÛŒ Ø§Ø³Øª. Ù„Ø·ÙØ§Ù‹ Ø§Ø³Ø§Ù…ÛŒ Ø±Ø§ ÙˆØ§Ø±Ø¯ Ú©Ù†ÛŒØ¯.");return}const f=c.split(`
`).map(m=>m.trim()).filter(m=>m.length>0);f.length>0?(Ue(f),Kt(),w("csv-preview-page")):alert("Ù‡ÛŒÚ† Ù†Ø§Ù… Ù…Ø¹ØªØ¨Ø±ÛŒ Ø¨Ø±Ø§ÛŒ ÙˆØ±ÙˆØ¯ Ù¾ÛŒØ¯Ø§ Ù†Ø´Ø¯.")}),i.addEventListener("keyup",c=>{c.key==="Enter"&&o.click()}),o.addEventListener("click",()=>{if(!u)return;const c=i.value.trim();if(!c){alert("Ù„Ø·ÙØ§Ù‹ Ù†Ø§Ù… Ø¯Ø§Ù†Ø´â€ŒØ¢Ù…ÙˆØ² Ø±Ø§ ÙˆØ§Ø±Ø¯ Ú©Ù†ÛŒØ¯.");return}const f=u.students.find(y=>y.identity.name.toLowerCase()===c.toLowerCase());if(f)if(f.isDeleted)kt(f,u);else{alert("âŒØ¯Ø§Ù†Ø´â€ŒØ¢Ù…ÙˆØ²ÛŒ Ø¨Ø§ Ø§ÛŒÙ† Ù†Ø§Ù… Ø§Ø² Ù‚Ø¨Ù„ Ø¯Ø± Ø§ÛŒÙ† Ú©Ù„Ø§Ø³ ÙˆØ¬ÙˆØ¯ Ø¯Ø§Ø±Ø¯.");return}const m=new tt({name:c});u.addStudent(m),u.sessions.length>0&&(yn(m,u),En(1)),k(),$(u.info.name,`Ø¯Ø§Ù†Ø´â€ŒØ¢Ù…ÙˆØ² Â«${c}Â» Ø¨Ù‡ Ú©Ù„Ø§Ø³ Ø§Ø¶Ø§ÙÙ‡ Ø´Ø¯.`,{type:"VIEW_STUDENT_PROFILE",studentId:m.identity.studentId}),be(),i.value="",i.focus()}),a.addEventListener("click",()=>{G(),w("session-page")}),document.getElementById("new-session-btn").addEventListener("click",()=>{if(u){const c=u.sessions.find(m=>!m.isFinished&&!m.isCancelled&&!m.isDeleted);if(c){S(`âš ï¸ Ø¬Ù„Ø³Ù‡ ${c.sessionNumber} Ù‡Ù†ÙˆØ² ØªÙ…Ø§Ù… Ù†Ø´Ø¯Ù‡ Ø§Ø³Øª. Ù„Ø·ÙØ§Ù‹ Ø§Ø¨ØªØ¯Ø§ Ø¨Ø§ Ø¯Ú©Ù…Ù‡ âœ… Ø¢Ù† Ø±Ø§ Ø®Ø§ØªÙ…Ù‡ Ø¯Ù‡ÛŒØ¯.`);return}const f=()=>{const m=y=>{const b=u.startNewSession();Je(b),Z(b),u.students.forEach(X=>{Qt.setAttendance(X.identity.studentId,"present")}),k();const N=he(u).get(b.sessionNumber);$(u.info.name,`Ø¬Ù„Ø³Ù‡ ${N} Ø´Ø±ÙˆØ¹ Ø´Ø¯.`,{type:"VIEW_SESSIONS"}),y?(Oe(),w("attendance-page")):ke()};U("Ø¢ÛŒØ§ ØªÙ…Ø§ÛŒÙ„ Ø¨Ù‡ Ø§Ù†Ø¬Ø§Ù… ÙØ±Ø¢ÛŒÙ†Ø¯ Ø­Ø¶ÙˆØ± Ùˆ ØºÛŒØ§Ø¨ Ø¯Ø§Ø±ÛŒØ¯ØŸ",()=>m(!0),{confirmText:"Ø¨Ù„Ù‡",cancelText:"Ø®ÛŒØ±",confirmClass:"btn-success",onCancel:()=>m(!1)})};u.hasSessionToday()?U("Ø´Ù…Ø§ Ø§Ù…Ø±ÙˆØ² ÛŒÚ© Ø¬Ù„Ø³Ù‡ Ø¨Ø±Ø§ÛŒ Ø§ÛŒÙ† Ú©Ù„Ø§Ø³ Ø«Ø¨Øª Ú©Ø±Ø¯Ù‡â€ŒØ§ÛŒØ¯. Ø¢ÛŒØ§ Ø§Ø² Ø´Ø±ÙˆØ¹ ÛŒÚ© Ø¬Ù„Ø³Ù‡ Ø¬Ø¯ÛŒØ¯ Ø¯ÛŒÚ¯Ø± Ù…Ø·Ù…Ø¦Ù† Ù‡Ø³ØªÛŒØ¯ØŸ",f,{confirmText:"Ø¨Ù„Ù‡",confirmClass:"btn-warning"}):f()}}),n.addEventListener("click",()=>{const c=t.value.trim(),f=document.querySelector('input[name="class-type"]:checked');if(!c&&!f){S("âš ï¸Ù„Ø·ÙØ§Ù‹ Ù†Ø§Ù… Ùˆ Ù†ÙˆØ¹ Ú©Ù„Ø§Ø³ Ø±Ø§ Ù…Ø´Ø®Øµ Ú©Ù†ÛŒØ¯.");return}if(!c){S("âš ï¸Ù„Ø·ÙØ§Ù‹ Ù†Ø§Ù… Ú©Ù„Ø§Ø³ Ø±Ø§ ÙˆØ§Ø±Ø¯ Ú©Ù†ÛŒØ¯.");return}if(!f){S("âš ï¸Ù„Ø·ÙØ§Ù‹ Ù†ÙˆØ¹ Ú©Ù„Ø§Ø³ Ø±Ø§ Ø§Ù†ØªØ®Ø§Ø¨ Ú©Ù†ÛŒØ¯.");return}if(T[c])if(T[c].isDeleted)delete T[c];else{S("âš ï¸Ú©Ù„Ø§Ø³ÛŒ Ø¨Ø§ Ø§ÛŒÙ† Ù†Ø§Ù… Ø§Ø² Ù‚Ø¨Ù„ ÙˆØ¬ÙˆØ¯ Ø¯Ø§Ø±Ø¯.");return}const m=f.value,y=new At({name:c,type:m});T[c]=y,k(),$(c,`Ú©Ù„Ø§Ø³ Â«${c}Â» Ø§ÛŒØ¬Ø§Ø¯ Ø´Ø¯.`,{type:"VIEW_SESSIONS"}),re(),t.value="",f.checked=!1}),e.addEventListener("input",c=>{const f=c.target.value;if(f.length<2){ht([]);return}const m=f.toLowerCase(),y=bn(m),b=[];for(const x in T){const N=T[x];if(N.isDeleted)continue;F(N.students).filter(V=>{const se=De(V.identity.name.toLowerCase()),Be=se.includes(De(m)),vn=se.includes(De(y));return Be||vn}).forEach(V=>{b.push({student:V,classroom:N})})}ht(b)}),t.addEventListener("keyup",c=>{c.key==="Enter"&&n.click()}),s.addEventListener("click",Jn),document.querySelectorAll(".back-to-classes-btn").forEach(c=>{c.addEventListener("click",()=>{K(null),Z(null),Je(null),w("class-management-page")})}),R.addEventListener("click",()=>{ke()}),ae.addEventListener("click",()=>{G(),w("session-page")}),rs.addEventListener("click",()=>{if(j(null),!E&&u&&u.sessions.length>0){const c=F(u.sessions).filter(f=>!f.isCancelled);if(c.length>0){const f=c[c.length-1];Z(f)}else{G(),w("session-page");return}}ke()}),_e.addEventListener("input",c=>{const f=c.target.value;if(!f){Ge([]);return}const m=f.toLowerCase(),y=bn(m),x=F(u.students).filter(N=>{const X=De(N.identity.name.toLowerCase()),V=X.includes(De(m)),se=X.includes(De(y));return V||se});Ge(x)}),_e.addEventListener("focus",()=>{_e.value&&Ge(_e.value)}),Ae.addEventListener("click",()=>{const c=ge.value,f=ue.value.trim();let m;if(St)m=St.student;else{const b=E==null?void 0:E.winnerHistory[de];m=b==null?void 0:b.winner}if(!m){S("âŒØ®Ø·Ø§: Ø¯Ø§Ù†Ø´â€ŒØ¢Ù…ÙˆØ² Ù…Ø¹ØªØ¨Ø±ÛŒ Ø¨Ø±Ø§ÛŒ Ø«Ø¨Øª Ù†Ù…Ø±Ù‡ ÛŒØ§ÙØª Ù†Ø´Ø¯.");return}const y=ce;if(!m||!y){S("âš ï¸Ù„Ø·ÙØ§Ù‹ Ø§Ø¨ØªØ¯Ø§ ÛŒÚ© Ø¯Ø§Ù†Ø´â€ŒØ¢Ù…ÙˆØ² Ùˆ ÛŒÚ© Ø¯Ø³ØªÙ‡â€ŒØ¨Ù†Ø¯ÛŒ Ø±Ø§ Ø§Ù†ØªØ®Ø§Ø¨ Ú©Ù†ÛŒØ¯.");return}if(!c){S("âš ï¸Ù„Ø·ÙØ§Ù‹ Ù…Ù‚Ø¯Ø§Ø± Ù†Ù…Ø±Ù‡ Ø±Ø§ ÙˆØ§Ø±Ø¯ Ú©Ù†ÛŒØ¯.");return}if(c>100||c<0){S("âŒÙ†Ù…Ø±Ù‡ Ù†Ø¨Ø§ÛŒØ¯ Ø§Ø² Û±Û°Û° Ø¨ÛŒØ´ØªØ± Ùˆ Ø§Ø² ØµÙØ± Ú©Ù…ØªØ± Ø¨Ø§Ø´Ø¯");return}m&&(m.addScore(y.name,parseFloat(c),f),$(u.info.name,`Ù†Ù…Ø±Ù‡ ${c} Ø¯Ø± ${y.name} Ø¨Ø±Ø§ÛŒ Â«${m.identity.name}Â» Ø«Ø¨Øª Ø´Ø¯.`,{type:"VIEW_STUDENT_PROFILE",studentId:m.identity.studentId}),k(),le(),S(`âœ…Ù†Ù…Ø±Ù‡ Ø¨Ø±Ø§ÛŒ ${m.identity.name} Ø¯Ø± Ù…Ù‡Ø§Ø±Øª ${y.name} Ø«Ø¨Øª Ø´Ø¯.`),ge.value="",ue.value="",Se(m,y.name))});const Cn=c=>{c.key==="Enter"&&c.ctrlKey&&(c.preventDefault(),Ae.click())};ge.addEventListener("keydown",Cn),ue.addEventListener("keydown",Cn),fs.addEventListener("click",()=>{const c=ds.querySelector(".pill.active");if(!c){S("âš ï¸Ù„Ø·ÙØ§Ù‹ ÛŒÚ© Ù…Ù‡Ø§Ø±Øª Ø±Ø§ Ø¨Ø±Ø§ÛŒ Ù†Ù…Ø±Ù‡â€ŒØ¯Ù‡ÛŒ Ø§Ù†ØªØ®Ø§Ø¨ Ú©Ù†ÛŒØ¯.");return}const f=c.dataset.skillName,m=us.value,y=ms.value.trim();if(!m){S("Ù„Ø·ÙØ§Ù‹ Ù…Ù‚Ø¯Ø§Ø± Ù†Ù…Ø±Ù‡ Ø±Ø§ ÙˆØ§Ø±Ø¯ Ú©Ù†ÛŒØ¯.");return}A.addScore(f,parseFloat(m),y),k(),$(u.info.name,`Ù†Ù…Ø±Ù‡ ${m} Ø¯Ø± ${f} Ø¨Ø±Ø§ÛŒ Â«${A.identity.name}Â» Ø«Ø¨Øª Ø´Ø¯.`,{type:"VIEW_STUDENT_PROFILE",studentId:A.identity.studentId}),ee(),S(`âœ…Ù†Ù…Ø±Ù‡ Ø¨Ø±Ø§ÛŒ Ù…Ù‡Ø§Ø±Øª ${f} Ø¨Ø§ Ù…ÙˆÙÙ‚ÛŒØª Ø«Ø¨Øª Ø´Ø¯.`)}),document.getElementById("add-note-btn").addEventListener("click",()=>{A&&(et.value="",et.dispatchEvent(new Event("input",{bubbles:!0})),me(c=>{c&&(A.addNote(c),k(),$(u.info.name,`ÛŒØ§Ø¯Ø¯Ø§Ø´Øª Ø¬Ø¯ÛŒØ¯ÛŒ Ø¨Ø±Ø§ÛŒ Ø¯Ø§Ù†Ø´â€ŒØ¢Ù…ÙˆØ² Â«${A.identity.name}Â» Ø«Ø¨Øª Ø´Ø¯.`,{type:"VIEW_STUDENT_PROFILE",studentId:A.identity.studentId}),Ye())}),te("add-note-modal"),et.focus())}),os.addEventListener("click",()=>{Y()}),as.addEventListener("click",()=>{const c=et.value.trim();typeof bt=="function"&&(bt(c),Y(),S("ÛŒØ§Ø¯Ø¯Ø§Ø´Øª Ø¨Ø±Ø§ÛŒ Ú©Ù„Ø§Ø³ Ø°Ø®ÛŒØ±Ù‡ Ø´Ø¯âœ…"))});const gs=document.getElementById("move-student-confirm-btn"),hs=document.getElementById("move-student-cancel-btn"),Cs=document.getElementById("move-student-class-select");hs.addEventListener("click",()=>{Y()}),gs.addEventListener("click",()=>{const c=Cs.value,f=T[c],{studentToMove:m,sourceClassForMove:y}=ks;if(!m||!y||!f){S("Ø®Ø·Ø§ÛŒÛŒ Ø±Ø® Ø¯Ø§Ø¯. Ù„Ø·ÙØ§Ù‹ Ø¯ÙˆØ¨Ø§Ø±Ù‡ Ø§Ù…ØªØ­Ø§Ù† Ú©Ù†ÛŒØ¯âš ï¸.","error"),Y();return}const b=Tn(m,y,f);b.success?($(y.info.name,`Ø¯Ø§Ù†Ø´â€ŒØ¢Ù…ÙˆØ² Â«${m.identity.name}Â» Ø¨Ù‡ Ú©Ù„Ø§Ø³ Â«${c}Â» Ù…Ù†ØªÙ‚Ù„ Ø´Ø¯.`,{type:"VIEW_SESSIONS"}),$(c,`Ø¯Ø§Ù†Ø´â€ŒØ¢Ù…ÙˆØ² Â«${m.identity.name}Â» Ø§Ø² Ú©Ù„Ø§Ø³ Â«${y.info.name}Â» Ø¨Ù‡ Ø§ÛŒÙ† Ú©Ù„Ø§Ø³ Ù…Ù†ØªÙ‚Ù„ Ø´Ø¯.`,{type:"VIEW_SESSIONS"}),k(),be(),S(`Ø¯Ø§Ù†Ø´â€ŒØ¢Ù…ÙˆØ² Â«${m.identity.name}Â» Ø¨Ø§ Ù…ÙˆÙÙ‚ÛŒØª Ø¨Ù‡ Ú©Ù„Ø§Ø³ Â«${c}Â» Ù…Ù†ØªÙ‚Ù„ Ø´Ø¯âœ….`)):S(b.message,"error"),Y()}),oe.addEventListener("click",()=>{ne.style.width="250px",P.classList.add("modal-visible")}),Te.addEventListener("click",We),P.addEventListener("click",We),ps.addEventListener("click",()=>{J(),w("trash-page"),We()}),_.addEventListener("click",()=>{We(),pn()}),z.addEventListener("click",()=>{Le.click(),We()}),Le.addEventListener("change",c=>{const f=c.target.files[0];if(!f)return;const m=new FileReader;m.onload=y=>{try{const b=JSON.parse(y.target.result);U("Ø¢ÛŒØ§ Ø§Ø² Ø¨Ø§Ø²ÛŒØ§Ø¨ÛŒ Ø§Ø·Ù„Ø§Ø¹Ø§Øª Ù…Ø·Ù…Ø¦Ù† Ù‡Ø³ØªÛŒØ¯ØŸ ØªÙ…Ø§Ù… Ø¯Ø§Ø¯Ù‡â€ŒÙ‡Ø§ÛŒ ÙØ¹Ù„ÛŒ Ø´Ù…Ø§ Ø¨Ø§Ø²Ù†ÙˆÛŒØ³ÛŒ Ø®ÙˆØ§Ù‡Ø¯ Ø´Ø¯.",()=>{Bt(b),k(),re(),w("class-management-page"),S("âœ…Ø§Ø·Ù„Ø§Ø¹Ø§Øª Ø¨Ø§ Ù…ÙˆÙÙ‚ÛŒØª Ø¨Ø§Ø²ÛŒØ§Ø¨ÛŒ Ø´Ø¯.")},{confirmText:"Ø¨Ø§Ø²ÛŒØ§Ø¨ÛŒ Ú©Ù†",confirmClass:"btn-warning"})}catch{S("âŒØ®Ø·Ø§ Ø¯Ø± Ø®ÙˆØ§Ù†Ø¯Ù† ÙØ§ÛŒÙ„. Ù„Ø·ÙØ§Ù‹ ÙØ§ÛŒÙ„ Ù¾Ø´ØªÛŒØ¨Ø§Ù† Ù…Ø¹ØªØ¨Ø± Ø§Ù†ØªØ®Ø§Ø¨ Ú©Ù†ÛŒØ¯.")}},m.readAsText(f),c.target.value=null}),window.addEventListener("popstate",c=>{if(Ee&&history.pushState(null,"",location.href),Ie(),c.state){const{pageId:f,currentClassName:m,selectedSessionNumber:y,selectedStudentId:b}=c.state;m&&(K(T[m]),y&&Z(u.getSession(y)),b&&j(u.students.find(x=>x.identity.studentId===b))),f==="student-page"?ke():(f==="session-page"&&G(),je(f))}else K(null),Z(null),j(null),je("class-management-page")}),document.addEventListener("keydown",c=>{var y;const f=document.activeElement;if(!["INPUT","TEXTAREA","SELECT"].includes(f.tagName)){if(c.key.toLowerCase()==="o"&&c.shiftKey&&_n.classList.contains("active")&&(c.preventDefault(),Un.click()),c.key==="Escape"){if(Ne.classList.contains("visible")){Ie();return}if(Ee){Y();return}switch((y=document.querySelector(".page.active"))==null?void 0:y.id){case"csv-preview-page":case"column-mapping-page":w("settings-page");break;case"student-profile-page":j(null),w(E?"student-page":"session-page");break;case"attendance-page":w("student-page");break;case"student-page":Z(null),G(),w("session-page");break;case"settings-page":case"session-page":K(null),w("class-management-page");break}return}if(E){const b=c.key.toLowerCase();switch(" ascfg".includes(b)&&c.preventDefault(),b){case" ":B.click();break;case"a":H.classList.contains("active")?history.back():(Oe(),w("attendance-page"));break;case"s":document.getElementById("session-page").classList.contains("active")?history.back():a.click();break;case"c":document.querySelector(".back-to-classes-btn").click();break;case"f":const x=document.querySelector(".action-column .search-icon");x&&x.click();break;case"g":if(cs.classList.contains("active"))history.back();else{const N=E.lastSelectedWinnerId;if(N){const X=u.students.find(V=>V.identity.studentId===N);X&&(j(X),ee(),w("student-profile-page"))}else S("âš ï¸Ø§Ø¨ØªØ¯Ø§ ÛŒÚ© Ù†ÙØ± Ø±Ø§ Ø§Ù†ØªØ®Ø§Ø¨ Ú©Ù†ÛŒØ¯ ØªØ§ Ù¾Ø±ÙˆÙØ§ÛŒÙ„ Ø§Ùˆ Ù†Ù…Ø§ÛŒØ´ Ø¯Ø§Ø¯Ù‡ Ø´ÙˆØ¯.")}break;case"arrowleft":{const N=document.querySelector('button[title="Ø¨Ø±Ù†Ø¯Ù‡ Ù‚Ø¨Ù„ÛŒ"]');N&&!N.disabled&&(c.preventDefault(),N.click());break}case"arrowright":{const N=document.querySelector('button[title="Ø¨Ø±Ù†Ø¯Ù‡ Ø¨Ø¹Ø¯ÛŒ"]');N&&!N.disabled&&(c.preventDefault(),N.click());break}}}}});function We(){ne.style.width="0",P.classList.add("modal-closing"),setTimeout(()=>{P.classList.remove("modal-visible","modal-closing")},300)}hn(".global-search-container .animated-search-container",ht),hn(".action-column-header .animated-search-container",Ge),[W,dn,ue,Fn].forEach(c=>{c&&Zn(c)}),ls.addEventListener("click",()=>{const c=A,f=u;if(!c||!f)return;const m=c.identity.name;document.getElementById("add-note-modal-title"),me(y=>{const b=y.trim();!b||b===m||(f.students.some(N=>!N.isDeleted&&N.identity.name.toLowerCase()===b.toLowerCase())?S("Ø¯Ø§Ù†Ø´â€ŒØ¢Ù…ÙˆØ²ÛŒ Ø¨Ø§ Ø§ÛŒÙ† Ù†Ø§Ù… Ø§Ø² Ù‚Ø¨Ù„ Ø¯Ø± Ø§ÛŒÙ† Ú©Ù„Ø§Ø³ ÙˆØ¬ÙˆØ¯ Ø¯Ø§Ø±Ø¯."):(c.identity.name=b,k(),$(f.info.name,`Ù†Ø§Ù… Ø¯Ø§Ù†Ø´â€ŒØ¢Ù…ÙˆØ² Â«${m}Â» Ø¨Ù‡ Â«${b}Â» ØªØºÛŒÛŒØ± ÛŒØ§ÙØª.`,{type:"VIEW_STUDENT_PROFILE",studentId:c.identity.studentId}),ee(),le(),S(`âœ…Ù†Ø§Ù… Ø¯Ø§Ù†Ø´â€ŒØ¢Ù…ÙˆØ² Ø¨Ù‡ Â«${b}Â» ØªØºÛŒÛŒØ± ÛŒØ§ÙØª.`)))}),te("add-note-modal"),W.focus(),W.select()});function yn(c,f){const m=F(f.students).filter(D=>D.identity.studentId!==c.identity.studentId);if(m.length===0)return;let y=0;const b=F(f.categories);b.forEach(D=>{const ie=Math.max(0,...m.map(Fe=>Fe.categoryCounts[D.name]||0));c.categoryCounts[D.name]=ie,y+=ie}),c.statusCounters.totalSelections=y;const x=m.reduce((D,ie)=>D+ie.statusCounters.totalSelections,0),N=m.reduce((D,ie)=>D+(ie.statusCounters.missedChances||0),0),X=x>0?N/x:0,V={};b.forEach(D=>{const ie=m.reduce(($t,Ht)=>$t+(Ht.categoryCounts[D.name]||0),0),Fe=m.reduce(($t,Ht)=>$t+(Ht.categoryIssues[D.name]||0),0);V[D.name]=ie>0?Fe/ie:0}),c.statusCounters.missedChances=Math.round(c.statusCounters.totalSelections*X),b.forEach(D=>{const ie=c.categoryCounts[D.name]||0,Fe=V[D.name]||0;c.categoryIssues[D.name]=Math.round(ie*Fe)});const se=F(f.sessions).filter(D=>!D.isCancelled&&D.isFinished);se.forEach(D=>{D.setAttendance(c.identity.studentId,"absent")});const Be="ğŸ“ ÛŒØ§Ø¯Ø¯Ø§Ø´Øª Ø®ÙˆØ¯Ú©Ø§Ø± Ø³ÛŒØ³ØªÙ…",Ss=`Ø§ÛŒÙ† Ø¯Ø§Ù†Ø´â€ŒØ¢Ù…ÙˆØ² Ù¾Ø³ Ø§Ø² Ø¬Ù„Ø³Ù‡ Ø´Ù…Ø§Ø±Ù‡ ${se.length} Ø¨Ù‡ Ú©Ù„Ø§Ø³ Ø§Ø¶Ø§ÙÙ‡ Ø´Ø¯. Ø¢Ù…Ø§Ø± Ù¾Ø§ÛŒÙ‡â€ŒØ§ÛŒ Ø²ÛŒØ± Ø¨Ø±Ø§ÛŒ Ø­ÙØ¸ ØªØ¹Ø§Ø¯Ù„ Ø§Ù„Ú¯ÙˆØ±ÛŒØªÙ… Ø§Ù†ØªØ®Ø§Ø¨ Ø¨Ø±Ø§ÛŒ Ø§Ùˆ Ø«Ø¨Øª Ú¯Ø±Ø¯ÛŒØ¯:`,xe=[];c.statusCounters.totalSelections>0&&xe.push(`Ú©Ù„ Ø§Ù†ØªØ®Ø§Ø¨â€ŒÙ‡Ø§: ${c.statusCounters.totalSelections}`),c.statusCounters.missedChances>0&&xe.push(`ÙØ±ØµØªâ€ŒÙ‡Ø§ÛŒ Ø§Ø² Ø¯Ø³Øª Ø±ÙØªÙ‡: ${c.statusCounters.missedChances}`);for(const D in c.categoryCounts)c.categoryCounts[D]>0&&xe.push(`Ø§Ù†ØªØ®Ø§Ø¨ Ø¯Ø± Â«${D}Â»: ${c.categoryCounts[D]}`);for(const D in c.categoryIssues)c.categoryIssues[D]>0&&xe.push(`Ù…Ø´Ú©Ù„ Ø¯Ø± Â«${D}Â»: ${c.categoryIssues[D]}`);if(xe.length>0){const D=`${Be}
${Ss}

- ${xe.join(`
- `)}`;c.addNote(D)}}function En(c){const m=`Ú†ÙˆÙ† Ø§ÛŒÙ† Ú©Ù„Ø§Ø³ Ø¬Ù„Ø³Ø§Øª Ø¨Ø±Ú¯Ø²Ø§Ø± Ø´Ø¯Ù‡ Ø¯Ø§Ø±Ø¯ØŒ Ø¨Ø±Ø§ÛŒ ${c>1?"Ø¯Ø§Ù†Ø´â€ŒØ¢Ù…ÙˆØ²Ø§Ù† Ø¬Ø¯ÛŒØ¯":"Ø¯Ø§Ù†Ø´â€ŒØ¢Ù…ÙˆØ² Ø¬Ø¯ÛŒØ¯"} Ø¢Ù…Ø§Ø± Ù¾Ø§ÛŒÙ‡â€ŒØ§ÛŒ (Ù…ØªÙ†Ø§Ø³Ø¨ Ø¨Ø§ Ø³Ø§ÛŒØ± Ø¯Ø§Ù†Ø´â€ŒØ¢Ù…ÙˆØ²Ø§Ù†) Ø«Ø¨Øª Ø´Ø¯ ØªØ§ Ø¯Ø± ÙØ±Ø§ÛŒÙ†Ø¯ Ø§Ù†ØªØ®Ø§Ø¨ Ø§Ø®ØªÙ„Ø§Ù„ÛŒ Ø§ÛŒØ¬Ø§Ø¯ Ù†Ø´ÙˆØ¯.`;U(m,()=>{},{confirmText:"Ù…ØªÙˆØ¬Ù‡ Ø´Ø¯Ù…",confirmClass:"btn-success",onCancel:null})}const ys="4.0.1";document.getElementById("app-version").textContent=`Ù†Ø³Ø®Ù‡ ${ys}`;function Es(){console.log("Starting universal backfill for writing scores...");let c=0;for(const f in T){const m=T[f];if(m.isDeleted)continue;let y=0;F(m.students).forEach(x=>{const N=x.logs.scores;if(!(N&&N.writing&&N.writing.length>0)){let V=-1;for(const se in N)se!=="writing"&&N[se].forEach(Be=>{Be.value>V&&(V=Be.value)});if(V>-1){const se=`Automatically assigned based on the highest score (${V}) from other skills.`;x.addScore("Writing",V,se),y++}}}),y>0&&(console.log(`Updated ${y} student(s) in class: ${m.info.name}.`),c+=y)}c>0?(k(),console.log(`Update complete. A total of ${c} student(s) were updated across all classes. Data saved.`),document.getElementById("student-page").classList.contains("active")&&le()):console.log("No students needed updating in any class.")}window.backfillWritingScoresForAll=Es;function vs(){console.log("Starting backfill for 'outOfClassCount' and 'wasOutOfClass' properties...");let c=0,f=0;const m=localStorage.getItem("teacherAssistantData_v2");if(!m){console.log("No data found in localStorage. Nothing to do.");return}const y=JSON.parse(m);for(const b in y){const x=y[b];x.students&&x.students.forEach(N=>{N.statusCounters&&typeof N.statusCounters.outOfClassCount>"u"&&(N.statusCounters.outOfClassCount=0,c++)}),x.sessions&&x.sessions.forEach(N=>{if(N.studentRecords)for(const X in N.studentRecords){const V=N.studentRecords[X];typeof V.wasOutOfClass>"u"&&(V.wasOutOfClass=!1,f++)}})}localStorage.setItem("teacherAssistantData_v2",JSON.stringify(y)),console.log(`Backfill complete. Updated ${c} students and ${f} session records. Data saved.`),Rt(),u&&le()}window.backfillExitCounters=vs;function bs(c){if(!c||!c.classroomName)return;const f=T[c.classroomName];if(!f){S("âš ï¸ Ú©Ù„Ø§Ø³ Ù…Ø±Ø¨ÙˆØ· Ø¨Ù‡ Ø§ÛŒÙ† Ú¯Ø²Ø§Ø±Ø´ ÛŒØ§ÙØª Ù†Ø´Ø¯.");return}K(f),Y(),setTimeout(()=>{switch(c.type){case"VIEW_STUDENT_PROFILE":{const m=f.students.find(y=>y.identity.studentId===c.studentId);m?(j(m),ee(),w("student-profile-page")):S("âš ï¸ Ø¯Ø§Ù†Ø´â€ŒØ¢Ù…ÙˆØ² Ù…ÙˆØ±Ø¯ Ù†Ø¸Ø± ÛŒØ§ÙØª Ù†Ø´Ø¯.");break}case"VIEW_TRASH":J(),w("trash-page");break;case"VIEW_SESSIONS":G(),w("session-page");break;case"VIEW_CLASS_NOTE":mn(f);break;case"VIEW_CLASS_SETTINGS":fn(f);break}},300)}});
