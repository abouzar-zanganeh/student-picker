const Sr=Object.freeze(Object.defineProperty({__proto__:null,get closeSideNav(){return je},get handleUndoLastSelection(){return Cr},get navigateUpHierarchy(){return Ui},get pickAssessmentWinner(){return wr},get toggleSelectionModes(){return Wi}},Symbol.toStringTag,{value:"Module"}));(function(){const s=document.createElement("link").relList;if(s&&s.supports&&s.supports("modulepreload"))return;for(const r of document.querySelectorAll('link[rel="modulepreload"]'))c(r);new MutationObserver(r=>{for(const n of r)if(n.type==="childList")for(const a of n.addedNodes)a.tagName==="LINK"&&a.rel==="modulepreload"&&c(a)}).observe(document,{childList:!0,subtree:!0});function t(r){const n={};return r.integrity&&(n.integrity=r.integrity),r.referrerPolicy&&(n.referrerPolicy=r.referrerPolicy),r.crossOrigin==="use-credentials"?n.credentials="include":r.crossOrigin==="anonymous"?n.credentials="omit":n.credentials="same-origin",n}function c(r){if(r.ep)return;r.ep=!0;const n=t(r);fetch(r.href,n)}})();const _r="modulepreload",kr=function(e){return"/"+e},ji={},Ir=function(s,t,c){let r=Promise.resolve();if(t&&t.length>0){document.getElementsByTagName("link");const a=document.querySelector("meta[property=csp-nonce]"),i=(a==null?void 0:a.nonce)||(a==null?void 0:a.getAttribute("nonce"));r=Promise.allSettled(t.map(o=>{if(o=kr(o),o in ji)return;ji[o]=!0;const l=o.endsWith(".css"),f=l?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${o}"]${f}`))return;const h=document.createElement("link");if(h.rel=l?"stylesheet":_r,l||(h.as="script"),h.crossOrigin="",h.href=o,i&&h.setAttribute("nonce",i),document.head.appendChild(h),l)return new Promise((m,u)=>{h.addEventListener("load",m),h.addEventListener("error",()=>u(new Error(`Unable to preload CSS for ${o}`)))})}))}function n(a){const i=new Event("vite:preloadError",{cancelable:!0});if(i.payload=a,window.dispatchEvent(i),!i.defaultPrevented)throw a}return r.then(a=>{for(const i of a||[])i.status==="rejected"&&n(i.reason);return s().catch(n)})},Dt={ili:{id:"ili",label:"Ú©Ø§Ù†ÙˆÙ† Ø²Ø¨Ø§Ù† Ø§ÛŒØ±Ø§Ù†",ageGroups:{kids:["Primer 1","Primer 2","Step Up 1","Step Up 2","Step Up 3","Step Up 4","Move Up 1","Move Up 2","Move Up 3","Move Up 4","Jump Up 1","Jump Up 2","Jump Up 3","Jump Up 4"],youngAdults:["Start 1","Run 1","Run 2","Run 3","Run 4","Race 1","Race 2","Race 3","Reach 1","Reach 2","Reach 3","Reach 4"],adults:["Basic 1","Basic 2","Basic 3","Elementary 1","Elementary 2","Elementary 3","Pre-intermediate 1","Pre-intermediate 2","Pre-intermediate 3","Intermediate 1","Intermediate 2","Intermediate 3","High-intermediate 1","High-intermediate 2","High-intermediate 3","Advanced 1","Advanced 2","Advanced 3"]},levels:[]},school:{id:"school",label:"Ø¢Ù…ÙˆØ²Ø´ Ùˆ Ù¾Ø±ÙˆØ±Ø´",levels:["Ú©Ù„Ø§Ø³ Ø§ÙˆÙ„","Ú©Ù„Ø§Ø³ Ø¯ÙˆÙ…","Ú©Ù„Ø§Ø³ Ø³ÙˆÙ…","Ú©Ù„Ø§Ø³ Ú†Ù‡Ø§Ø±Ù…","Ú©Ù„Ø§Ø³ Ù¾Ù†Ø¬Ù…","Ú©Ù„Ø§Ø³ Ø´Ø´Ù…","Ú©Ù„Ø§Ø³ Ù‡ÙØªÙ…","Ú©Ù„Ø§Ø³ Ù‡Ø´ØªÙ…","Ú©Ù„Ø§Ø³ Ù†Ù‡Ù…","Ú©Ù„Ø§Ø³ Ø¯Ù‡Ù…","Ú©Ù„Ø§Ø³ ÛŒØ§Ø²Ø¯Ù‡Ù…","Ú©Ù„Ø§Ø³ Ø¯ÙˆØ§Ø²Ø¯Ù‡Ù…"]},custom:{id:"custom",label:"Ø³Ø§ÛŒØ± / Ø¢Ø²Ø§Ø¯",levels:[]}};Dt.ili.levels=[...Dt.ili.ageGroups.kids,...Dt.ili.ageGroups.youngAdults,...Dt.ili.ageGroups.adults];const Yi={ili:{default:[{name:"Ø¹Ù…ÙˆÙ…ÛŒ",description:"Ø¯Ø³ØªÙ‡â€ŒØ¨Ù†Ø¯ÛŒ Ù¾ÛŒØ´â€ŒÙØ±Ø¶",isGraded:!0,weight:1}],levels:{}}};Dt.ili.ageGroups.adults.forEach(e=>{Yi.ili.levels[e]=[{name:"Listen-Speak",description:"Listening and Speaking",isGraded:!0,weight:3},{name:"Reading",description:"",isGraded:!0,weight:2},{name:"Writing",description:"",isGraded:!0,weight:1}]});function xr(e,s){const t=Yi[e];if(!t)return[new hn("Ø¹Ù…ÙˆÙ…ÛŒ","Ø¯Ø³ØªÙ‡â€ŒØ¨Ù†Ø¯ÛŒ Ù¾ÛŒØ´â€ŒÙØ±Ø¶",!0,1)];let c=t.levels[s];return c||(c=t.default),c.map(r=>new hn(r.name,r.description||"",r.isGraded||!1,r.weight||1))}class qn{constructor(s){this.identity={name:s.name,firstName:s.firstName||null,lastName:s.lastName||null,studentId:s.studentId||`id_${new Date().getTime()}_${Math.random()}`,branchName:s.branchName||null,ageGroup:s.ageGroup||"adult",level:s.level||null,contact:{social:s.socialContact||null,parent:s.parentContact||null}},this.isDeleted=!1,this.statusCounters={totalSelections:0,missedChances:0,earlyLeaves:0,outOfClassCount:0},this.categoryCounts={},this.categoryIssues={},this.qualitativeStats={},this.logs={parentContacts:[],scores:{},discipline:{},sessionHistory:{}},this.profile={notes:[],tags:[]},this.finalClassActivityScore=null,this.onboardingSession=null}addScore(s,t,c){if(t>100||t<0){console.log("Ù†Ù…Ø±Ù‡ Ù†Ø¨Ø§ÛŒØ¯ Ø§Ø² Û±Û°Û° Ø¨ÛŒØ´ØªØ± Ùˆ Ø§Ø² ØµÙØ± Ú©Ù…ØªØ± Ø¨Ø§Ø´Ø¯");return}const r=s.toLowerCase();this.logs.scores[r]||(this.logs.scores[r]=[]);const n=new Lr(s,t,c);this.logs.scores[r].push(n)}addNote(s,t=null){const c=new Tr(s,t);this.profile.notes.push(c)}getOverallAverageScore(){let s=0,t=0;for(const r in this.logs.scores)this.logs.scores[r].forEach(n=>{n.isDeleted||(s+=n.value,t++)});if(t===0)return null;const c=s/t;return Math.trunc(c*10)/10}}class Lr{constructor(s,t,c=""){this.id=`score_${new Date().getTime()}`,this.skill=s,this.value=t,this.timestamp=new Date,this.comment=c,this.isDeleted=!1}}class Tr{constructor(s,t=null){this.id=`note_${new Date().getTime()}`,this.timestamp=new Date,this.content=s,this.isDeleted=!1,this.source=t}}class Ds{constructor(s="complete",t=""){this.status=s,this.comment=t,this.timestamp=new Date}}class Xi{constructor(s){this.sessionNumber=s,this.startTime=new Date,this.createdAt=new Date,this.note="",this.isDeleted=!1,this.endTime=null,this.isFinished=!1,this.isMakeup=!1,this.isCancelled=!1,this.studentRecords={},this.lastWinnerByCategory={},this.lastUsedCategoryId=null,this.lastSelectedWinnerId=null,this.winnerHistory=[]}end(){this.isFinished=!0,this.endTime=new Date}markAsMakeup(){this.isMakeup=!this.isMakeup}initializeStudentRecord(s){this.studentRecords[s]||(this.studentRecords[s]={attendance:"present",homework:new Ds,selections:{},hadIssue:!1,wasOutOfClass:!1,performanceRatings:{}})}setAttendance(s,t){this.initializeStudentRecord(s),this.studentRecords[s].attendance=t}setHomeworkStatus(s,t){this.initializeStudentRecord(s),this.studentRecords[s].homework.status=t}selectNextWinner(s,t,c){if(!t||t.length===0)return console.log("Ù‡ÛŒÚ† Ø¯Ø§Ù†Ø´â€ŒØ¢Ù…ÙˆØ²ÛŒ Ø¯Ø± Ú©Ù„Ø§Ø³ Ø¨Ø±Ø§ÛŒ Ø§Ù†ØªØ®Ø§Ø¨ ÙˆØ¬ÙˆØ¯ Ù†Ø¯Ø§Ø±Ø¯."),null;const r=this.lastWinnerByCategory[s];let n=t.filter(m=>m.identity.studentId!==r&&!m.isDeleted);if(n.length===0&&(n=t),n.length===0)return null;const a=(m,u)=>m.categoryCounts[u]||0,i=Math.min(...n.map(m=>a(m,s))),o=n.filter(m=>a(m,s)===i);let l;if(o.length===1)l=o[0];else if(o.length>1){const m=c.filter(b=>!b.isDeleted&&b.name!==s).map(b=>b.name),u=o.map(b=>{const v=m.reduce((C,S)=>C+a(b,S),0);return{student:b,otherCategoriesTotal:v}}),y=Math.min(...u.map(b=>b.otherCategoriesTotal)),p=u.filter(b=>b.otherCategoriesTotal===y).map(b=>b.student);p.length===1?l=p[0]:l=p[Math.floor(Math.random()*p.length)]}else l=n[Math.floor(Math.random()*n.length)];const f=l.identity.studentId;this.initializeStudentRecord(f);const h=(this.studentRecords[f].selections[s]||0)+1;return this.studentRecords[f].selections[s]=h,l.statusCounters.totalSelections++,l.categoryCounts[s]=(l.categoryCounts[s]||0)+1,this.lastWinnerByCategory[s]=f,l}}class Xs{constructor(s){this.info={name:s.name||"NotNamed",teacherName:s.teacherName||null,type:s.type||"in-person",educationalSystem:s.educationalSystem||"custom",term:s.term||null,scheduleText:s.scheduleText||null,level:s.level||null,creationDate:s.creationDate?new Date(s.creationDate):new Date,scheduleCode:s.scheduleCode||`code_${new Date().getTime()}`,scheduleDays:s.scheduleDays||[],scheduleStartTime:s.scheduleStartTime||null,scheduleEndTime:s.scheduleEndTime||null},this.students=[],this.sessions=[],this.note="",this.isDeleted=!1,this.categories=xr(this.info.educationalSystem,this.info.level),this.futurePlans={}}addStudent(s){this.students.push(s)}startNewSession(){const t=this.sessions.reduce((r,n)=>Math.max(r,n.sessionNumber),0)+1,c=new Xi(t);return this.sessions.push(c),c}endSpecificSession(s){const t=this.getSession(s);return t&&!t.isFinished?(t.end(),!0):!1}getSession(s){return this.sessions.find(t=>t.sessionNumber===s)}markAsMakeup(s){const t=this.getSession(s);t&&t.markAsMakeup()}planForSession(s,t){this.futurePlans[s]=t}hasSessionToday(){const s=new Date().toDateString();return this.sessions.some(t=>!t.isDeleted&&t.startTime.toDateString()===s)}selectNextWinner(s,t){return t?t.selectNextWinner(s,this.students,this.categories):null}get liveSession(){for(let s=this.sessions.length-1;s>=0;s--)if(!this.sessions[s].isFinished)return this.sessions[s];return null}calculateFinalStudentScore(s){var a;const t=this.categories.filter(i=>i.isGradedCategory&&!i.isDeleted);if(t.length===0)return null;let c=0,r=0;for(const i of t){const o=i.name.toLowerCase(),l=((a=s.logs.scores[o])==null?void 0:a.filter(h=>!h.isDeleted))||[];if(l.length===0)return null;const f=l.reduce((h,m)=>h+m.value,0)/l.length;c+=f*(i.weight||1),r+=i.weight||1}if(r===0)return null;const n=c/r;return Math.trunc(n*10)/10}}class hn{constructor(s,t="",c=!1,r=1){this.id=`cat_${new Date().getTime()}_${Math.random()}`,this.name=s,this.description=t,this.isDeleted=!1,this.isGradedCategory=c,this.weight=r,this.isDeleted=!1}}var Dn=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function Qi(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}var ea={exports:{}};(function(e){var s=function(){var t=String.fromCharCode,c="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",r="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+-$",n={};function a(o,l){if(!n[o]){n[o]={};for(var f=0;f<o.length;f++)n[o][o.charAt(f)]=f}return n[o][l]}var i={compressToBase64:function(o){if(o==null)return"";var l=i._compress(o,6,function(f){return c.charAt(f)});switch(l.length%4){default:case 0:return l;case 1:return l+"===";case 2:return l+"==";case 3:return l+"="}},decompressFromBase64:function(o){return o==null?"":o==""?null:i._decompress(o.length,32,function(l){return a(c,o.charAt(l))})},compressToUTF16:function(o){return o==null?"":i._compress(o,15,function(l){return t(l+32)})+" "},decompressFromUTF16:function(o){return o==null?"":o==""?null:i._decompress(o.length,16384,function(l){return o.charCodeAt(l)-32})},compressToUint8Array:function(o){for(var l=i.compress(o),f=new Uint8Array(l.length*2),h=0,m=l.length;h<m;h++){var u=l.charCodeAt(h);f[h*2]=u>>>8,f[h*2+1]=u%256}return f},decompressFromUint8Array:function(o){if(o==null)return i.decompress(o);for(var l=new Array(o.length/2),f=0,h=l.length;f<h;f++)l[f]=o[f*2]*256+o[f*2+1];var m=[];return l.forEach(function(u){m.push(t(u))}),i.decompress(m.join(""))},compressToEncodedURIComponent:function(o){return o==null?"":i._compress(o,6,function(l){return r.charAt(l)})},decompressFromEncodedURIComponent:function(o){return o==null?"":o==""?null:(o=o.replace(/ /g,"+"),i._decompress(o.length,32,function(l){return a(r,o.charAt(l))}))},compress:function(o){return i._compress(o,16,function(l){return t(l)})},_compress:function(o,l,f){if(o==null)return"";var h,m,u={},y={},p="",b="",v="",C=2,S=3,_=2,k=[],x=0,L=0,B;for(B=0;B<o.length;B+=1)if(p=o.charAt(B),Object.prototype.hasOwnProperty.call(u,p)||(u[p]=S++,y[p]=!0),b=v+p,Object.prototype.hasOwnProperty.call(u,b))v=b;else{if(Object.prototype.hasOwnProperty.call(y,v)){if(v.charCodeAt(0)<256){for(h=0;h<_;h++)x=x<<1,L==l-1?(L=0,k.push(f(x)),x=0):L++;for(m=v.charCodeAt(0),h=0;h<8;h++)x=x<<1|m&1,L==l-1?(L=0,k.push(f(x)),x=0):L++,m=m>>1}else{for(m=1,h=0;h<_;h++)x=x<<1|m,L==l-1?(L=0,k.push(f(x)),x=0):L++,m=0;for(m=v.charCodeAt(0),h=0;h<16;h++)x=x<<1|m&1,L==l-1?(L=0,k.push(f(x)),x=0):L++,m=m>>1}C--,C==0&&(C=Math.pow(2,_),_++),delete y[v]}else for(m=u[v],h=0;h<_;h++)x=x<<1|m&1,L==l-1?(L=0,k.push(f(x)),x=0):L++,m=m>>1;C--,C==0&&(C=Math.pow(2,_),_++),u[b]=S++,v=String(p)}if(v!==""){if(Object.prototype.hasOwnProperty.call(y,v)){if(v.charCodeAt(0)<256){for(h=0;h<_;h++)x=x<<1,L==l-1?(L=0,k.push(f(x)),x=0):L++;for(m=v.charCodeAt(0),h=0;h<8;h++)x=x<<1|m&1,L==l-1?(L=0,k.push(f(x)),x=0):L++,m=m>>1}else{for(m=1,h=0;h<_;h++)x=x<<1|m,L==l-1?(L=0,k.push(f(x)),x=0):L++,m=0;for(m=v.charCodeAt(0),h=0;h<16;h++)x=x<<1|m&1,L==l-1?(L=0,k.push(f(x)),x=0):L++,m=m>>1}C--,C==0&&(C=Math.pow(2,_),_++),delete y[v]}else for(m=u[v],h=0;h<_;h++)x=x<<1|m&1,L==l-1?(L=0,k.push(f(x)),x=0):L++,m=m>>1;C--,C==0&&(C=Math.pow(2,_),_++)}for(m=2,h=0;h<_;h++)x=x<<1|m&1,L==l-1?(L=0,k.push(f(x)),x=0):L++,m=m>>1;for(;;)if(x=x<<1,L==l-1){k.push(f(x));break}else L++;return k.join("")},decompress:function(o){return o==null?"":o==""?null:i._decompress(o.length,32768,function(l){return o.charCodeAt(l)})},_decompress:function(o,l,f){var h=[],m=4,u=4,y=3,p="",b=[],v,C,S,_,k,x,L,B={val:f(0),position:l,index:1};for(v=0;v<3;v+=1)h[v]=v;for(S=0,k=Math.pow(2,2),x=1;x!=k;)_=B.val&B.position,B.position>>=1,B.position==0&&(B.position=l,B.val=f(B.index++)),S|=(_>0?1:0)*x,x<<=1;switch(S){case 0:for(S=0,k=Math.pow(2,8),x=1;x!=k;)_=B.val&B.position,B.position>>=1,B.position==0&&(B.position=l,B.val=f(B.index++)),S|=(_>0?1:0)*x,x<<=1;L=t(S);break;case 1:for(S=0,k=Math.pow(2,16),x=1;x!=k;)_=B.val&B.position,B.position>>=1,B.position==0&&(B.position=l,B.val=f(B.index++)),S|=(_>0?1:0)*x,x<<=1;L=t(S);break;case 2:return""}for(h[3]=L,C=L,b.push(L);;){if(B.index>o)return"";for(S=0,k=Math.pow(2,y),x=1;x!=k;)_=B.val&B.position,B.position>>=1,B.position==0&&(B.position=l,B.val=f(B.index++)),S|=(_>0?1:0)*x,x<<=1;switch(L=S){case 0:for(S=0,k=Math.pow(2,8),x=1;x!=k;)_=B.val&B.position,B.position>>=1,B.position==0&&(B.position=l,B.val=f(B.index++)),S|=(_>0?1:0)*x,x<<=1;h[u++]=t(S),L=u-1,m--;break;case 1:for(S=0,k=Math.pow(2,16),x=1;x!=k;)_=B.val&B.position,B.position>>=1,B.position==0&&(B.position=l,B.val=f(B.index++)),S|=(_>0?1:0)*x,x<<=1;h[u++]=t(S),L=u-1,m--;break;case 2:return b.join("")}if(m==0&&(m=Math.pow(2,y),y++),h[L])p=h[L];else if(L===u)p=C+C.charAt(0);else return null;b.push(p),h[u++]=C+p.charAt(0),m--,C=p,m==0&&(m=Math.pow(2,y),y++)}}};return i}();e!=null?e.exports=s:typeof angular<"u"&&angular!=null&&angular.module("LZString",[]).factory("LZString",function(){return s})})(ea);var Br=ea.exports;const ta=Qi(Br);function Dr(e){return new Worker("/assets/compression.worker-B3kqe_bR.js",{name:e==null?void 0:e.name})}let na=null;function ps(e){na=e}let ie={},N=null,Qs=null,K=null,Se=null,pn=null,gs=null,ei=[],Gn=null,ti=null,Le=null,at={},Zn=0,ni=0,Vn=0,si=0,ii=null,ai=null,Jn=null,gt=null,tt=-1,ri=null,Kn=null,Yn=null,Xn=null,sa=null,ia=null,vt=!1;function oi(e){vt=e}let aa=null;function ci(e){aa=e}let He=[],it=[],Ot=[],Be={isScreenSaverEnabled:!0,isSoundEnabled:!0,isVibrationEnabled:!0,isDeveloperMode:!1,lastRestoreTimestamp:null,lastBackupTimestamp:null},ra=new Set,_t=!1;function oa(e){_t=e}let li=!1;function di(e){li=e}let Ut=null;const ui=new Dr;ui.onmessage=e=>{const s=e.data;try{localStorage.setItem("teacherAssistantData_v2",s),console.log("Background save complete.")}catch(t){console.error("Background storage failed:",t)}};ui.onerror=e=>{console.error("âŒ Worker Communication Error:",e.message,e)};function se(e=!1){if(vt)return;const t=JSON.stringify({classrooms:ie,trashBin:He,userSettings:Be});if(e){Ut&&clearTimeout(Ut);try{const c=ta.compressToUTF16(t);localStorage.setItem("teacherAssistantData_v2",c),console.log("Immediate save complete.")}catch(c){console.error("Immediate save failed:",c)}return}Ut&&clearTimeout(Ut),Ut=setTimeout(()=>{ui.postMessage(t),Ut=null},500)}function fi(){const e=localStorage.getItem("teacherAssistantData_v2");if(!e)return;let s;try{const t=ta.decompressFromUTF16(e);t?s=JSON.parse(t):s=JSON.parse(e)}catch{console.log("Migration: Parsing legacy uncompressed data..."),s=JSON.parse(e)}s.classrooms!==void 0&&s.trashBin!==void 0?(Rt(s.classrooms),He=s.trashBin||[],Be={...Be,...s.userSettings}):(Rt(s),Nr())}function Nr(){const e=[];Object.values(ie).forEach(s=>{s.isDeleted?e.push({id:`trash_${Date.now()}_${Math.random()}`,timestamp:s.info.creationDate,type:"classroom",description:`Ú©Ù„Ø§Ø³ Â«${s.info.name}Â»`,restoreData:{name:s.info.name}}):s.students.forEach(t=>{t.isDeleted&&e.push({id:`trash_${Date.now()}_${Math.random()}`,timestamp:t.identity.studentId.split("_")[1],type:"student",description:`Ø¯Ø§Ù†Ø´â€ŒØ¢Ù…ÙˆØ² Â«${t.identity.name}Â»`,restoreData:{studentId:t.identity.studentId,classroomName:s.info.name}})})}),He.length===0&&e.length>0&&(He=e,console.log(`Migrated ${e.length} previously deleted item(s) to the new trash bin.`),se())}function ca(e){const s=new qn(e.identity);return s.isDeleted=e.isDeleted,s.statusCounters=e.statusCounters,s.logs=e.logs,s.logs.scores||(s.logs.scores={}),s.profile=e.profile,s.finalClassActivityScore=e.finalClassActivityScore,s.categoryCounts=e.categoryCounts||{},s.categoryIssues=e.categoryIssues||{},s.qualitativeStats=e.qualitativeStats||{},s.onboardingSession=e.onboardingSession||null,s}function Rt(e){ie={};for(const s in e){const t=e[s];let c;t.info?c=t.info:c={...t,name:s};const r=new Xs(c);r.isDeleted=t.isDeleted,r.note=t.note||"",r.students=(t.students||[]).map(ca),r.sessions=(t.sessions||[]).map(n=>{const a=new Xi(n.sessionNumber);a.isDeleted=n.isDeleted,a.note=n.note||"",a.startTime=new Date(n.startTime),a.createdAt=n.createdAt?new Date(n.createdAt):new Date(n.startTime),a.endTime=n.endTime?new Date(n.endTime):null,a.isFinished=n.isFinished,a.isMakeup=n.isMakeup,a.isCancelled=n.isCancelled||!1,a.studentRecords=n.studentRecords;for(const o in a.studentRecords){const l=a.studentRecords[o];l.homework&&!(l.homework instanceof Ds)&&(a.studentRecords[o].homework=new Ds(l.homework.status,l.homework.comment))}a.lastWinnerByCategory=n.lastWinnerByCategory,a.lastUsedCategoryId=n.lastUsedCategoryId,a.lastSelectedWinnerId=n.lastSelectedWinnerId;const i=n.winnerHistory||[];return a.winnerHistory=i.filter(o=>o&&o.winner).map(o=>({winner:r.students.find(f=>f.identity.studentId===o.winner.identity.studentId),categoryName:o.categoryName,rating:o.rating||null})).filter(o=>o.winner),a}),r.categories=(t.categories||[]).map(n=>{const a=new hn(n.name,n.description,n.isGradedCategory,n.weight||1);return a.id=n.id,a.isDeleted=n.isDeleted,a}),r.futurePlans=t.futurePlans,ie[s]=r}}function la(e,s){if(ie[s])return{success:!1,message:"Ú©Ù„Ø§Ø³ÛŒ Ø¨Ø§ Ø§ÛŒÙ† Ù†Ø§Ù… Ø§Ø² Ù‚Ø¨Ù„ ÙˆØ¬ÙˆØ¯ Ø¯Ø§Ø±Ø¯."};const t=ie[e];return t?(t.info.name=s,ie[s]=t,delete ie[e],N===t&&Ge(t),{success:!0}):{success:!1,message:"Ú©Ù„Ø§Ø³ Ù…ÙˆØ±Ø¯ Ù†Ø¸Ø± ÛŒØ§ÙØª Ù†Ø´Ø¯."}}function da(e,s,t){const c=t.trim();if(!c)return{success:!1,message:"Ù†Ø§Ù… Ø¯Ø³ØªÙ‡â€ŒØ¨Ù†Ø¯ÛŒ Ù†Ù…ÛŒâ€ŒØªÙˆØ§Ù†Ø¯ Ø®Ø§Ù„ÛŒ Ø¨Ø§Ø´Ø¯."};if(e.categories.some(o=>o.id!==s.id&&!o.isDeleted&&o.name.toLowerCase()===c.toLowerCase()))return{success:!1,message:"Ø¯Ø³ØªÙ‡â€ŒØ¨Ù†Ø¯ÛŒ Ø¯ÛŒÚ¯Ø±ÛŒ Ø¨Ø§ Ø§ÛŒÙ† Ù†Ø§Ù… ÙˆØ¬ÙˆØ¯ Ø¯Ø§Ø±Ø¯."};const n=s.name,a=n.toLowerCase(),i=c.toLowerCase();return s.name=c,e.students.forEach(o=>{o.categoryCounts&&o.categoryCounts[n]!==void 0&&(o.categoryCounts[c]=o.categoryCounts[n],delete o.categoryCounts[n]),o.categoryIssues&&o.categoryIssues[n]!==void 0&&(o.categoryIssues[c]=o.categoryIssues[n],delete o.categoryIssues[n]),o.logs.scores&&o.logs.scores[a]&&(o.logs.scores[a].forEach(l=>l.skill=c),a!==i&&(o.logs.scores[i]=o.logs.scores[a],delete o.logs.scores[a]))}),e.sessions.forEach(o=>{o.lastWinnerByCategory&&o.lastWinnerByCategory[n]&&(o.lastWinnerByCategory[c]=o.lastWinnerByCategory[n],delete o.lastWinnerByCategory[n]),o.winnerHistory&&o.winnerHistory.forEach(l=>{l.categoryName===n&&(l.categoryName=c)})}),{success:!0}}function ua(e,s,t){if(ge(t.students).some(l=>l.identity.name.toLowerCase()===e.identity.name.toLowerCase()))return{success:!1,message:`Ø¯Ø§Ù†Ø´â€ŒØ¢Ù…ÙˆØ²ÛŒ Ø¨Ø§ Ù†Ø§Ù… Â«${e.identity.name}Â» Ø§Ø² Ù‚Ø¨Ù„ Ø¯Ø± Ú©Ù„Ø§Ø³ Â«${t.info.name}Â» ÙˆØ¬ÙˆØ¯ Ø¯Ø§Ø±Ø¯.`};const r=JSON.parse(JSON.stringify(e)),n=ca(r),a=new Map;s.sessions.forEach(l=>{const f=l.studentRecords[e.identity.studentId];f&&a.set(l.sessionNumber,JSON.parse(JSON.stringify(f)))}),t.addStudent(n);try{const l=ge(t.sessions).filter(b=>!b.isCancelled).sort((b,v)=>v.sessionNumber-b.sessionNumber),f=l.length>0?l[0]:null;let h="ØŸ",m={type:"system",description:"Student Move"};f&&(h=lt(t).get(f.sessionNumber)||f.sessionNumber,m={type:"fromSession",sessionNumber:f.sessionNumber});const u=new Date().toLocaleDateString("fa-IR"),y=s.info.name,p=`Ø§ÛŒÙ† Ø¯Ø§Ù†Ø´ Ø¢Ù…ÙˆØ² Ø¯Ø± Ø¬Ù„Ø³Ù‡ ${h} Ùˆ Ø¯Ø± ØªØ§Ø±ÛŒØ® ${u} Ø§Ø² Ú©Ù„Ø§Ø³ Â«${y}Â» Ø¨Ù‡ Ø§ÛŒÙ† Ú©Ù„Ø§Ø³ Ø§Ù†ØªÙ‚Ø§Ù„ Ù¾ÛŒØ¯Ø§ Ú©Ø±Ø¯`;n.addNote(p,m)}catch(l){console.error("Failed to add automated move note:",l)}a.size>0&&t.sessions.forEach(l=>{const f=a.get(l.sessionNumber);f&&!l.isDeleted&&!l.isCancelled&&(l.studentRecords[n.identity.studentId]=f)});const i={id:`trash_${Date.now()}_${Math.random()}`,timestamp:new Date().toISOString(),type:"student",description:`(Ø§Ù†ØªÙ‚Ø§Ù„) Ø¯Ø§Ù†Ø´â€ŒØ¢Ù…ÙˆØ² Â«${e.identity.name}Â» Ø§Ø² Ú©Ù„Ø§Ø³ Â«${s.info.name}Â»`,restoreData:{studentId:e.identity.studentId,classId:s.info.scheduleCode}};ct(i);const o=s.students.find(l=>l.identity.studentId===e.identity.studentId);return o&&(o.isDeleted=!0),{success:!0}}function fa(){for(const e in ie){const s=ie[e];s.students.forEach(t=>{t.statusCounters={totalSelections:0,missedChances:0,earlyLeaves:0},t.categoryCounts={},t.categoryIssues={},s.sessions.forEach(c=>{const r=t.identity.studentId;c.studentRecords[r]&&(c.studentRecords[r].attendance="present")})})}se()}function ge(e){return Array.isArray(e)?e.filter(s=>!s.isDeleted):[]}function lt(e){const s=new Map;return e&&ge(e.sessions).filter(c=>!c.isCancelled).sort((c,r)=>c.sessionNumber-r.sessionNumber).forEach((c,r)=>{s.set(c.sessionNumber,r+1)}),s}function bt(e){tt=e}function dt(e){ri=e}function ys(e,s){if(!e||!s)return;const t=e.identity.studentId,c=s.students.findIndex(r=>r.identity.studentId===t);c>-1&&s.students.splice(c,1),s.sessions.forEach(r=>{r.studentRecords[t]&&delete r.studentRecords[t];for(const n in r.lastWinnerByCategory)r.lastWinnerByCategory[n]===t&&delete r.lastWinnerByCategory[n];r.lastSelectedWinnerId===t&&(r.lastSelectedWinnerId=null),r.winnerHistory=r.winnerHistory.filter(n=>n.winner&&n.winner.identity.studentId!==t)})}function mi(e,s){const t=ie[e];if(!t)return;const c=t.sessions.findIndex(r=>r.sessionNumber===s);c>-1&&(t.students.forEach(r=>{r.profile.notes&&r.profile.notes.length>0&&(r.profile.notes=r.profile.notes.filter(n=>!n.source||n.source.type!=="fromAttendance"||n.source.sessionNumber!==s)),r.onboardingSession===s&&(r.onboardingSession=null)}),t.sessions.splice(c,1))}function hi(e,s){const t=ie[e];if(!t)return;const c=t.categories.findIndex(i=>i.id===s);if(c===-1)return;const n=t.categories[c].name,a=n.toLowerCase();t.students.forEach(i=>{i.categoryCounts&&delete i.categoryCounts[n],i.categoryIssues&&delete i.categoryIssues[n],i.logs.scores&&delete i.logs.scores[a]}),t.sessions.forEach(i=>{i.lastWinnerByCategory[n]&&delete i.lastWinnerByCategory[n],i.winnerHistory=i.winnerHistory.filter(o=>o.categoryName!==n)}),t.categories.splice(c,1)}function pi(e,s,t,c){const r=ie[e];if(!r)return;const n=r.students.find(o=>o.identity.studentId===s);if(!n||!n.logs.scores[t.toLowerCase()])return;const a=n.logs.scores[t.toLowerCase()],i=a.findIndex(o=>o.id===c);i>-1&&a.splice(i,1)}function gi(e,s,t){const c=ie[e];if(!c)return;const r=c.students.find(a=>a.identity.studentId===s);if(!r||!r.profile.notes)return;const n=r.profile.notes.findIndex(a=>a.id===t);n>-1&&r.profile.notes.splice(n,1)}function ct(e){for(He.unshift(e);He.length>50;){const s=He.pop();ma(s)}se()}function ma(e){var s;if(!(!e||!e.restoreData))switch(console.log(`ðŸ—‘ï¸ Auto-cleaning overflow item: ${e.description}`),e.type){case"classroom":e.restoreData.name&&ie[e.restoreData.name]&&delete ie[e.restoreData.name];break;case"student":(s=e.restoreData.identity)!=null&&s.studentId&&ys(e.restoreData.identity.studentId);break;case"session":e.restoreData.id&&mi(e.restoreData.id);break;case"category":e.restoreData.id&&hi(e.restoreData.id);break;case"score":pi(e.restoreData);break;case"note":e.restoreData.id&&gi(e.restoreData.id);break}}function Ge(e){N=e}function gn(e){Qs=e}function rt(e){K=e}function kt(e){Se=e}function Qn(e){pn=e}function ha(e){gs=e}function nn(e){ei=e}function An(e){Gn=e}function pa(e){ti=e}function es(e){Le=e}function Mn(e){Zn=e}function ga(e){ni=e}function On(e){Vn=e}function ya(e){si=e}function yi(e){ii=e}function vi(e){ai=e}function yn(e){Jn=e}function bi(e){gt=e}function Jt(e){Yn=e}function va(e){sa=e}function ba(e){ia=e}function Ci(e){He=e}function vn(e){Kn=e}function bn(e){Ot=e}function Ct(e){Be={...Be,...e},se()}function Rn(e){it=e}function wi(){Be.lastBackupTimestamp=new Date().toISOString(),se()}function ts(e){Xn=e}function Ar(){ra.clear()}function Mr(e){at=e}function Or(){at={}}function Ei(e,s){at[e]||(at[e]={toBeScored:[],scoredThisSession:[]}),at[e].scoredThisSession.includes(s)||at[e].scoredThisSession.push(s)}const Ca=Object.freeze(Object.defineProperty({__proto__:null,get activeModal(){return gt},addToTrashBin:ct,get assessmentPools(){return at},assessmentSessionExclusions:ra,get cancelCallback(){return ai},get classrooms(){return ie},get confirmCallback(){return ii},get currentClassroom(){return N},get datePickerCallback(){return Xn},get displayedWinnerID(){return na},get easterEggClickCount(){return Zn},get easterEggLastClickTime(){return ni},getActiveItems:ge,getSessionDisplayMap:lt,get importedFileContent(){return Gn},get isAssessmentModeActive(){return _t},get isDemoMode(){return vt},get isModalTransitioning(){return li},get liveSession(){return Qs},loadData:fi,get manualSelection(){return Yn},markStudentAsScoredInSession:Ei,moveStudent:ua,get namesToImport(){return ei},get notificationTimeout(){return ti},get originalStateBackup(){return aa},permanentlyDeleteCategory:hi,permanentlyDeleteFromTrash:ma,permanentlyDeleteNote:gi,permanentlyDeleteScore:pi,permanentlyDeleteSession:mi,permanentlyDeleteStudent:ys,get previousState(){return pn},rehydrateData:Rt,renameCategory:da,renameClassroom:la,resetAllStudentCounters:fa,resetAssessmentExclusions:Ar,resetAssessmentPools:Or,get resetEasterEggClickCount(){return Vn},get resetEasterEggLastClickTime(){return si},get saveCategoryCallback(){return Kn},saveData:se,get saveNoteCallback(){return ri},get secureConfirmCallback(){return Jn},get selectedCategory(){return Le},get selectedClassIds(){return it},get selectedSession(){return K},get selectedStudentForProfile(){return Se},get selectedStudentsForMassComment(){return Ot},setActiveModal:bi,setAssessmentPools:Mr,setCancelCallback:vi,setConfirmCallback:yi,setCurrentClassroom:Ge,setDatePickerCallback:ts,setDisplayedWinnerID:ps,setEasterEggClickCount:Mn,setEasterEggLastClickTime:ga,setImportedFileContent:An,setIsAssessmentModeActive:oa,setIsDemoMode:oi,setIsModalTransitioning:di,setLastBackupTimestamp:wi,setLiveSession:gn,setManualSelection:Jt,setNamesToImport:nn,setNotificationTimeout:pa,setOriginalStateBackup:ci,setPreviousState:Qn,setResetEasterEggClickCount:On,setResetEasterEggLastClickTime:ya,setSaveCategoryCallback:vn,setSaveNoteCallback:dt,setSecureConfirmCallback:yn,setSelectedCategory:es,setSelectedClassIds:Rn,setSelectedSession:rt,setSelectedStudentForProfile:kt,setSelectedStudentsForMassComment:bn,setSourceClassForMove:ba,setStudentToMove:va,setTrashBin:Ci,setUndoTimeout:ha,setUserSettings:Ct,setWinnerHistoryIndex:bt,get sourceClassForMove(){return ia},get studentToMove(){return sa},get trashBin(){return He},get undoTimeout(){return gs},get userSettings(){return Be},get winnerHistoryIndex(){return tt}},Symbol.toStringTag,{value:"Module"})),Rr="TeacherAssistantDB",zr=1,mt="backups";function Si(){return new Promise((e,s)=>{const t=indexedDB.open(Rr,zr);t.onupgradeneeded=c=>{const r=c.target.result;r.objectStoreNames.contains(mt)||r.createObjectStore(mt,{keyPath:"id"})},t.onsuccess=c=>e(c.target.result),t.onerror=c=>s(c.target.error)})}async function wa(e,s){const t=await Si(),c=t.transaction(mt,"readwrite"),r=c.objectStore(mt),n={id:Date.now(),file:e,metadata:s,timestamp:new Date().toISOString()};r.add(n),c.oncomplete=()=>{const i=t.transaction(mt,"readwrite").objectStore(mt),o=i.count();o.onsuccess=()=>{if(o.result>10){const l=i.getAllKeys();l.onsuccess=()=>{const f=l.result;for(;f.length>10;){const h=f.shift();i.delete(h),console.log(`â™»ï¸ Auto-deleted old backup snapshot: ${h}`)}}}}}}async function Ea(){const e=await Si();return new Promise((s,t)=>{const n=e.transaction(mt,"readonly").objectStore(mt).getAll();n.onsuccess=()=>{const a=n.result.sort((i,o)=>o.id-i.id);s(a)},n.onerror=()=>t(n.error)})}async function $r(e){(await Si()).transaction(mt,"readwrite").objectStore(mt).delete(e)}const Pr=Object.freeze(Object.defineProperty({__proto__:null,addBackupSnapshot:wa,deleteBackupSnapshot:$r,getBackupSnapshots:Ea},Symbol.toStringTag,{value:"Module"}));function Nn(e){throw new Error('Could not dynamically require "'+e+'". Please configure the dynamicRequireTargets or/and ignoreDynamicRequires option of @rollup/plugin-commonjs appropriately for this require call to work.')}var Sa={exports:{}};/*!

JSZip v3.10.1 - A JavaScript class for generating and reading zip files
<http://stuartk.com/jszip>

(c) 2009-2016 Stuart Knightley <stuart [at] stuartk.com>
Dual licenced under the MIT license or GPLv3. See https://raw.github.com/Stuk/jszip/main/LICENSE.markdown.

JSZip uses the library pako released under the MIT license :
https://github.com/nodeca/pako/blob/main/LICENSE
*/(function(e,s){(function(t){e.exports=t()})(function(){return function t(c,r,n){function a(l,f){if(!r[l]){if(!c[l]){var h=typeof Nn=="function"&&Nn;if(!f&&h)return h(l,!0);if(i)return i(l,!0);var m=new Error("Cannot find module '"+l+"'");throw m.code="MODULE_NOT_FOUND",m}var u=r[l]={exports:{}};c[l][0].call(u.exports,function(y){var p=c[l][1][y];return a(p||y)},u,u.exports,t,c,r,n)}return r[l].exports}for(var i=typeof Nn=="function"&&Nn,o=0;o<n.length;o++)a(n[o]);return a}({1:[function(t,c,r){var n=t("./utils"),a=t("./support"),i="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";r.encode=function(o){for(var l,f,h,m,u,y,p,b=[],v=0,C=o.length,S=C,_=n.getTypeOf(o)!=="string";v<o.length;)S=C-v,h=_?(l=o[v++],f=v<C?o[v++]:0,v<C?o[v++]:0):(l=o.charCodeAt(v++),f=v<C?o.charCodeAt(v++):0,v<C?o.charCodeAt(v++):0),m=l>>2,u=(3&l)<<4|f>>4,y=1<S?(15&f)<<2|h>>6:64,p=2<S?63&h:64,b.push(i.charAt(m)+i.charAt(u)+i.charAt(y)+i.charAt(p));return b.join("")},r.decode=function(o){var l,f,h,m,u,y,p=0,b=0,v="data:";if(o.substr(0,v.length)===v)throw new Error("Invalid base64 input, it looks like a data url.");var C,S=3*(o=o.replace(/[^A-Za-z0-9+/=]/g,"")).length/4;if(o.charAt(o.length-1)===i.charAt(64)&&S--,o.charAt(o.length-2)===i.charAt(64)&&S--,S%1!=0)throw new Error("Invalid base64 input, bad content length.");for(C=a.uint8array?new Uint8Array(0|S):new Array(0|S);p<o.length;)l=i.indexOf(o.charAt(p++))<<2|(m=i.indexOf(o.charAt(p++)))>>4,f=(15&m)<<4|(u=i.indexOf(o.charAt(p++)))>>2,h=(3&u)<<6|(y=i.indexOf(o.charAt(p++))),C[b++]=l,u!==64&&(C[b++]=f),y!==64&&(C[b++]=h);return C}},{"./support":30,"./utils":32}],2:[function(t,c,r){var n=t("./external"),a=t("./stream/DataWorker"),i=t("./stream/Crc32Probe"),o=t("./stream/DataLengthProbe");function l(f,h,m,u,y){this.compressedSize=f,this.uncompressedSize=h,this.crc32=m,this.compression=u,this.compressedContent=y}l.prototype={getContentWorker:function(){var f=new a(n.Promise.resolve(this.compressedContent)).pipe(this.compression.uncompressWorker()).pipe(new o("data_length")),h=this;return f.on("end",function(){if(this.streamInfo.data_length!==h.uncompressedSize)throw new Error("Bug : uncompressed data size mismatch")}),f},getCompressedWorker:function(){return new a(n.Promise.resolve(this.compressedContent)).withStreamInfo("compressedSize",this.compressedSize).withStreamInfo("uncompressedSize",this.uncompressedSize).withStreamInfo("crc32",this.crc32).withStreamInfo("compression",this.compression)}},l.createWorkerFrom=function(f,h,m){return f.pipe(new i).pipe(new o("uncompressedSize")).pipe(h.compressWorker(m)).pipe(new o("compressedSize")).withStreamInfo("compression",h)},c.exports=l},{"./external":6,"./stream/Crc32Probe":25,"./stream/DataLengthProbe":26,"./stream/DataWorker":27}],3:[function(t,c,r){var n=t("./stream/GenericWorker");r.STORE={magic:"\0\0",compressWorker:function(){return new n("STORE compression")},uncompressWorker:function(){return new n("STORE decompression")}},r.DEFLATE=t("./flate")},{"./flate":7,"./stream/GenericWorker":28}],4:[function(t,c,r){var n=t("./utils"),a=function(){for(var i,o=[],l=0;l<256;l++){i=l;for(var f=0;f<8;f++)i=1&i?3988292384^i>>>1:i>>>1;o[l]=i}return o}();c.exports=function(i,o){return i!==void 0&&i.length?n.getTypeOf(i)!=="string"?function(l,f,h,m){var u=a,y=m+h;l^=-1;for(var p=m;p<y;p++)l=l>>>8^u[255&(l^f[p])];return-1^l}(0|o,i,i.length,0):function(l,f,h,m){var u=a,y=m+h;l^=-1;for(var p=m;p<y;p++)l=l>>>8^u[255&(l^f.charCodeAt(p))];return-1^l}(0|o,i,i.length,0):0}},{"./utils":32}],5:[function(t,c,r){r.base64=!1,r.binary=!1,r.dir=!1,r.createFolders=!0,r.date=null,r.compression=null,r.compressionOptions=null,r.comment=null,r.unixPermissions=null,r.dosPermissions=null},{}],6:[function(t,c,r){var n=null;n=typeof Promise<"u"?Promise:t("lie"),c.exports={Promise:n}},{lie:37}],7:[function(t,c,r){var n=typeof Uint8Array<"u"&&typeof Uint16Array<"u"&&typeof Uint32Array<"u",a=t("pako"),i=t("./utils"),o=t("./stream/GenericWorker"),l=n?"uint8array":"array";function f(h,m){o.call(this,"FlateWorker/"+h),this._pako=null,this._pakoAction=h,this._pakoOptions=m,this.meta={}}r.magic="\b\0",i.inherits(f,o),f.prototype.processChunk=function(h){this.meta=h.meta,this._pako===null&&this._createPako(),this._pako.push(i.transformTo(l,h.data),!1)},f.prototype.flush=function(){o.prototype.flush.call(this),this._pako===null&&this._createPako(),this._pako.push([],!0)},f.prototype.cleanUp=function(){o.prototype.cleanUp.call(this),this._pako=null},f.prototype._createPako=function(){this._pako=new a[this._pakoAction]({raw:!0,level:this._pakoOptions.level||-1});var h=this;this._pako.onData=function(m){h.push({data:m,meta:h.meta})}},r.compressWorker=function(h){return new f("Deflate",h)},r.uncompressWorker=function(){return new f("Inflate",{})}},{"./stream/GenericWorker":28,"./utils":32,pako:38}],8:[function(t,c,r){function n(u,y){var p,b="";for(p=0;p<y;p++)b+=String.fromCharCode(255&u),u>>>=8;return b}function a(u,y,p,b,v,C){var S,_,k=u.file,x=u.compression,L=C!==l.utf8encode,B=i.transformTo("string",C(k.name)),M=i.transformTo("string",l.utf8encode(k.name)),U=k.comment,Q=i.transformTo("string",C(U)),I=i.transformTo("string",l.utf8encode(U)),z=M.length!==k.name.length,g=I.length!==U.length,F="",re="",G="",de=k.dir,V=k.date,le={crc32:0,compressedSize:0,uncompressedSize:0};y&&!p||(le.crc32=u.crc32,le.compressedSize=u.compressedSize,le.uncompressedSize=u.uncompressedSize);var O=0;y&&(O|=8),L||!z&&!g||(O|=2048);var A=0,oe=0;de&&(A|=16),v==="UNIX"?(oe=798,A|=function(X,xe){var Me=X;return X||(Me=xe?16893:33204),(65535&Me)<<16}(k.unixPermissions,de)):(oe=20,A|=function(X){return 63&(X||0)}(k.dosPermissions)),S=V.getUTCHours(),S<<=6,S|=V.getUTCMinutes(),S<<=5,S|=V.getUTCSeconds()/2,_=V.getUTCFullYear()-1980,_<<=4,_|=V.getUTCMonth()+1,_<<=5,_|=V.getUTCDate(),z&&(re=n(1,1)+n(f(B),4)+M,F+="up"+n(re.length,2)+re),g&&(G=n(1,1)+n(f(Q),4)+I,F+="uc"+n(G.length,2)+G);var ee="";return ee+=`
\0`,ee+=n(O,2),ee+=x.magic,ee+=n(S,2),ee+=n(_,2),ee+=n(le.crc32,4),ee+=n(le.compressedSize,4),ee+=n(le.uncompressedSize,4),ee+=n(B.length,2),ee+=n(F.length,2),{fileRecord:h.LOCAL_FILE_HEADER+ee+B+F,dirRecord:h.CENTRAL_FILE_HEADER+n(oe,2)+ee+n(Q.length,2)+"\0\0\0\0"+n(A,4)+n(b,4)+B+F+Q}}var i=t("../utils"),o=t("../stream/GenericWorker"),l=t("../utf8"),f=t("../crc32"),h=t("../signature");function m(u,y,p,b){o.call(this,"ZipFileWorker"),this.bytesWritten=0,this.zipComment=y,this.zipPlatform=p,this.encodeFileName=b,this.streamFiles=u,this.accumulate=!1,this.contentBuffer=[],this.dirRecords=[],this.currentSourceOffset=0,this.entriesCount=0,this.currentFile=null,this._sources=[]}i.inherits(m,o),m.prototype.push=function(u){var y=u.meta.percent||0,p=this.entriesCount,b=this._sources.length;this.accumulate?this.contentBuffer.push(u):(this.bytesWritten+=u.data.length,o.prototype.push.call(this,{data:u.data,meta:{currentFile:this.currentFile,percent:p?(y+100*(p-b-1))/p:100}}))},m.prototype.openedSource=function(u){this.currentSourceOffset=this.bytesWritten,this.currentFile=u.file.name;var y=this.streamFiles&&!u.file.dir;if(y){var p=a(u,y,!1,this.currentSourceOffset,this.zipPlatform,this.encodeFileName);this.push({data:p.fileRecord,meta:{percent:0}})}else this.accumulate=!0},m.prototype.closedSource=function(u){this.accumulate=!1;var y=this.streamFiles&&!u.file.dir,p=a(u,y,!0,this.currentSourceOffset,this.zipPlatform,this.encodeFileName);if(this.dirRecords.push(p.dirRecord),y)this.push({data:function(b){return h.DATA_DESCRIPTOR+n(b.crc32,4)+n(b.compressedSize,4)+n(b.uncompressedSize,4)}(u),meta:{percent:100}});else for(this.push({data:p.fileRecord,meta:{percent:0}});this.contentBuffer.length;)this.push(this.contentBuffer.shift());this.currentFile=null},m.prototype.flush=function(){for(var u=this.bytesWritten,y=0;y<this.dirRecords.length;y++)this.push({data:this.dirRecords[y],meta:{percent:100}});var p=this.bytesWritten-u,b=function(v,C,S,_,k){var x=i.transformTo("string",k(_));return h.CENTRAL_DIRECTORY_END+"\0\0\0\0"+n(v,2)+n(v,2)+n(C,4)+n(S,4)+n(x.length,2)+x}(this.dirRecords.length,p,u,this.zipComment,this.encodeFileName);this.push({data:b,meta:{percent:100}})},m.prototype.prepareNextSource=function(){this.previous=this._sources.shift(),this.openedSource(this.previous.streamInfo),this.isPaused?this.previous.pause():this.previous.resume()},m.prototype.registerPrevious=function(u){this._sources.push(u);var y=this;return u.on("data",function(p){y.processChunk(p)}),u.on("end",function(){y.closedSource(y.previous.streamInfo),y._sources.length?y.prepareNextSource():y.end()}),u.on("error",function(p){y.error(p)}),this},m.prototype.resume=function(){return!!o.prototype.resume.call(this)&&(!this.previous&&this._sources.length?(this.prepareNextSource(),!0):this.previous||this._sources.length||this.generatedError?void 0:(this.end(),!0))},m.prototype.error=function(u){var y=this._sources;if(!o.prototype.error.call(this,u))return!1;for(var p=0;p<y.length;p++)try{y[p].error(u)}catch{}return!0},m.prototype.lock=function(){o.prototype.lock.call(this);for(var u=this._sources,y=0;y<u.length;y++)u[y].lock()},c.exports=m},{"../crc32":4,"../signature":23,"../stream/GenericWorker":28,"../utf8":31,"../utils":32}],9:[function(t,c,r){var n=t("../compressions"),a=t("./ZipFileWorker");r.generateWorker=function(i,o,l){var f=new a(o.streamFiles,l,o.platform,o.encodeFileName),h=0;try{i.forEach(function(m,u){h++;var y=function(C,S){var _=C||S,k=n[_];if(!k)throw new Error(_+" is not a valid compression method !");return k}(u.options.compression,o.compression),p=u.options.compressionOptions||o.compressionOptions||{},b=u.dir,v=u.date;u._compressWorker(y,p).withStreamInfo("file",{name:m,dir:b,date:v,comment:u.comment||"",unixPermissions:u.unixPermissions,dosPermissions:u.dosPermissions}).pipe(f)}),f.entriesCount=h}catch(m){f.error(m)}return f}},{"../compressions":3,"./ZipFileWorker":8}],10:[function(t,c,r){function n(){if(!(this instanceof n))return new n;if(arguments.length)throw new Error("The constructor with parameters has been removed in JSZip 3.0, please check the upgrade guide.");this.files=Object.create(null),this.comment=null,this.root="",this.clone=function(){var a=new n;for(var i in this)typeof this[i]!="function"&&(a[i]=this[i]);return a}}(n.prototype=t("./object")).loadAsync=t("./load"),n.support=t("./support"),n.defaults=t("./defaults"),n.version="3.10.1",n.loadAsync=function(a,i){return new n().loadAsync(a,i)},n.external=t("./external"),c.exports=n},{"./defaults":5,"./external":6,"./load":11,"./object":15,"./support":30}],11:[function(t,c,r){var n=t("./utils"),a=t("./external"),i=t("./utf8"),o=t("./zipEntries"),l=t("./stream/Crc32Probe"),f=t("./nodejsUtils");function h(m){return new a.Promise(function(u,y){var p=m.decompressed.getContentWorker().pipe(new l);p.on("error",function(b){y(b)}).on("end",function(){p.streamInfo.crc32!==m.decompressed.crc32?y(new Error("Corrupted zip : CRC32 mismatch")):u()}).resume()})}c.exports=function(m,u){var y=this;return u=n.extend(u||{},{base64:!1,checkCRC32:!1,optimizedBinaryString:!1,createFolders:!1,decodeFileName:i.utf8decode}),f.isNode&&f.isStream(m)?a.Promise.reject(new Error("JSZip can't accept a stream when loading a zip file.")):n.prepareContent("the loaded zip file",m,!0,u.optimizedBinaryString,u.base64).then(function(p){var b=new o(u);return b.load(p),b}).then(function(p){var b=[a.Promise.resolve(p)],v=p.files;if(u.checkCRC32)for(var C=0;C<v.length;C++)b.push(h(v[C]));return a.Promise.all(b)}).then(function(p){for(var b=p.shift(),v=b.files,C=0;C<v.length;C++){var S=v[C],_=S.fileNameStr,k=n.resolve(S.fileNameStr);y.file(k,S.decompressed,{binary:!0,optimizedBinaryString:!0,date:S.date,dir:S.dir,comment:S.fileCommentStr.length?S.fileCommentStr:null,unixPermissions:S.unixPermissions,dosPermissions:S.dosPermissions,createFolders:u.createFolders}),S.dir||(y.file(k).unsafeOriginalName=_)}return b.zipComment.length&&(y.comment=b.zipComment),y})}},{"./external":6,"./nodejsUtils":14,"./stream/Crc32Probe":25,"./utf8":31,"./utils":32,"./zipEntries":33}],12:[function(t,c,r){var n=t("../utils"),a=t("../stream/GenericWorker");function i(o,l){a.call(this,"Nodejs stream input adapter for "+o),this._upstreamEnded=!1,this._bindStream(l)}n.inherits(i,a),i.prototype._bindStream=function(o){var l=this;(this._stream=o).pause(),o.on("data",function(f){l.push({data:f,meta:{percent:0}})}).on("error",function(f){l.isPaused?this.generatedError=f:l.error(f)}).on("end",function(){l.isPaused?l._upstreamEnded=!0:l.end()})},i.prototype.pause=function(){return!!a.prototype.pause.call(this)&&(this._stream.pause(),!0)},i.prototype.resume=function(){return!!a.prototype.resume.call(this)&&(this._upstreamEnded?this.end():this._stream.resume(),!0)},c.exports=i},{"../stream/GenericWorker":28,"../utils":32}],13:[function(t,c,r){var n=t("readable-stream").Readable;function a(i,o,l){n.call(this,o),this._helper=i;var f=this;i.on("data",function(h,m){f.push(h)||f._helper.pause(),l&&l(m)}).on("error",function(h){f.emit("error",h)}).on("end",function(){f.push(null)})}t("../utils").inherits(a,n),a.prototype._read=function(){this._helper.resume()},c.exports=a},{"../utils":32,"readable-stream":16}],14:[function(t,c,r){c.exports={isNode:typeof Buffer<"u",newBufferFrom:function(n,a){if(Buffer.from&&Buffer.from!==Uint8Array.from)return Buffer.from(n,a);if(typeof n=="number")throw new Error('The "data" argument must not be a number');return new Buffer(n,a)},allocBuffer:function(n){if(Buffer.alloc)return Buffer.alloc(n);var a=new Buffer(n);return a.fill(0),a},isBuffer:function(n){return Buffer.isBuffer(n)},isStream:function(n){return n&&typeof n.on=="function"&&typeof n.pause=="function"&&typeof n.resume=="function"}}},{}],15:[function(t,c,r){function n(k,x,L){var B,M=i.getTypeOf(x),U=i.extend(L||{},f);U.date=U.date||new Date,U.compression!==null&&(U.compression=U.compression.toUpperCase()),typeof U.unixPermissions=="string"&&(U.unixPermissions=parseInt(U.unixPermissions,8)),U.unixPermissions&&16384&U.unixPermissions&&(U.dir=!0),U.dosPermissions&&16&U.dosPermissions&&(U.dir=!0),U.dir&&(k=v(k)),U.createFolders&&(B=b(k))&&C.call(this,B,!0);var Q=M==="string"&&U.binary===!1&&U.base64===!1;L&&L.binary!==void 0||(U.binary=!Q),(x instanceof h&&x.uncompressedSize===0||U.dir||!x||x.length===0)&&(U.base64=!1,U.binary=!0,x="",U.compression="STORE",M="string");var I=null;I=x instanceof h||x instanceof o?x:y.isNode&&y.isStream(x)?new p(k,x):i.prepareContent(k,x,U.binary,U.optimizedBinaryString,U.base64);var z=new m(k,I,U);this.files[k]=z}var a=t("./utf8"),i=t("./utils"),o=t("./stream/GenericWorker"),l=t("./stream/StreamHelper"),f=t("./defaults"),h=t("./compressedObject"),m=t("./zipObject"),u=t("./generate"),y=t("./nodejsUtils"),p=t("./nodejs/NodejsStreamInputAdapter"),b=function(k){k.slice(-1)==="/"&&(k=k.substring(0,k.length-1));var x=k.lastIndexOf("/");return 0<x?k.substring(0,x):""},v=function(k){return k.slice(-1)!=="/"&&(k+="/"),k},C=function(k,x){return x=x!==void 0?x:f.createFolders,k=v(k),this.files[k]||n.call(this,k,null,{dir:!0,createFolders:x}),this.files[k]};function S(k){return Object.prototype.toString.call(k)==="[object RegExp]"}var _={load:function(){throw new Error("This method has been removed in JSZip 3.0, please check the upgrade guide.")},forEach:function(k){var x,L,B;for(x in this.files)B=this.files[x],(L=x.slice(this.root.length,x.length))&&x.slice(0,this.root.length)===this.root&&k(L,B)},filter:function(k){var x=[];return this.forEach(function(L,B){k(L,B)&&x.push(B)}),x},file:function(k,x,L){if(arguments.length!==1)return k=this.root+k,n.call(this,k,x,L),this;if(S(k)){var B=k;return this.filter(function(U,Q){return!Q.dir&&B.test(U)})}var M=this.files[this.root+k];return M&&!M.dir?M:null},folder:function(k){if(!k)return this;if(S(k))return this.filter(function(M,U){return U.dir&&k.test(M)});var x=this.root+k,L=C.call(this,x),B=this.clone();return B.root=L.name,B},remove:function(k){k=this.root+k;var x=this.files[k];if(x||(k.slice(-1)!=="/"&&(k+="/"),x=this.files[k]),x&&!x.dir)delete this.files[k];else for(var L=this.filter(function(M,U){return U.name.slice(0,k.length)===k}),B=0;B<L.length;B++)delete this.files[L[B].name];return this},generate:function(){throw new Error("This method has been removed in JSZip 3.0, please check the upgrade guide.")},generateInternalStream:function(k){var x,L={};try{if((L=i.extend(k||{},{streamFiles:!1,compression:"STORE",compressionOptions:null,type:"",platform:"DOS",comment:null,mimeType:"application/zip",encodeFileName:a.utf8encode})).type=L.type.toLowerCase(),L.compression=L.compression.toUpperCase(),L.type==="binarystring"&&(L.type="string"),!L.type)throw new Error("No output type specified.");i.checkSupport(L.type),L.platform!=="darwin"&&L.platform!=="freebsd"&&L.platform!=="linux"&&L.platform!=="sunos"||(L.platform="UNIX"),L.platform==="win32"&&(L.platform="DOS");var B=L.comment||this.comment||"";x=u.generateWorker(this,L,B)}catch(M){(x=new o("error")).error(M)}return new l(x,L.type||"string",L.mimeType)},generateAsync:function(k,x){return this.generateInternalStream(k).accumulate(x)},generateNodeStream:function(k,x){return(k=k||{}).type||(k.type="nodebuffer"),this.generateInternalStream(k).toNodejsStream(x)}};c.exports=_},{"./compressedObject":2,"./defaults":5,"./generate":9,"./nodejs/NodejsStreamInputAdapter":12,"./nodejsUtils":14,"./stream/GenericWorker":28,"./stream/StreamHelper":29,"./utf8":31,"./utils":32,"./zipObject":35}],16:[function(t,c,r){c.exports=t("stream")},{stream:void 0}],17:[function(t,c,r){var n=t("./DataReader");function a(i){n.call(this,i);for(var o=0;o<this.data.length;o++)i[o]=255&i[o]}t("../utils").inherits(a,n),a.prototype.byteAt=function(i){return this.data[this.zero+i]},a.prototype.lastIndexOfSignature=function(i){for(var o=i.charCodeAt(0),l=i.charCodeAt(1),f=i.charCodeAt(2),h=i.charCodeAt(3),m=this.length-4;0<=m;--m)if(this.data[m]===o&&this.data[m+1]===l&&this.data[m+2]===f&&this.data[m+3]===h)return m-this.zero;return-1},a.prototype.readAndCheckSignature=function(i){var o=i.charCodeAt(0),l=i.charCodeAt(1),f=i.charCodeAt(2),h=i.charCodeAt(3),m=this.readData(4);return o===m[0]&&l===m[1]&&f===m[2]&&h===m[3]},a.prototype.readData=function(i){if(this.checkOffset(i),i===0)return[];var o=this.data.slice(this.zero+this.index,this.zero+this.index+i);return this.index+=i,o},c.exports=a},{"../utils":32,"./DataReader":18}],18:[function(t,c,r){var n=t("../utils");function a(i){this.data=i,this.length=i.length,this.index=0,this.zero=0}a.prototype={checkOffset:function(i){this.checkIndex(this.index+i)},checkIndex:function(i){if(this.length<this.zero+i||i<0)throw new Error("End of data reached (data length = "+this.length+", asked index = "+i+"). Corrupted zip ?")},setIndex:function(i){this.checkIndex(i),this.index=i},skip:function(i){this.setIndex(this.index+i)},byteAt:function(){},readInt:function(i){var o,l=0;for(this.checkOffset(i),o=this.index+i-1;o>=this.index;o--)l=(l<<8)+this.byteAt(o);return this.index+=i,l},readString:function(i){return n.transformTo("string",this.readData(i))},readData:function(){},lastIndexOfSignature:function(){},readAndCheckSignature:function(){},readDate:function(){var i=this.readInt(4);return new Date(Date.UTC(1980+(i>>25&127),(i>>21&15)-1,i>>16&31,i>>11&31,i>>5&63,(31&i)<<1))}},c.exports=a},{"../utils":32}],19:[function(t,c,r){var n=t("./Uint8ArrayReader");function a(i){n.call(this,i)}t("../utils").inherits(a,n),a.prototype.readData=function(i){this.checkOffset(i);var o=this.data.slice(this.zero+this.index,this.zero+this.index+i);return this.index+=i,o},c.exports=a},{"../utils":32,"./Uint8ArrayReader":21}],20:[function(t,c,r){var n=t("./DataReader");function a(i){n.call(this,i)}t("../utils").inherits(a,n),a.prototype.byteAt=function(i){return this.data.charCodeAt(this.zero+i)},a.prototype.lastIndexOfSignature=function(i){return this.data.lastIndexOf(i)-this.zero},a.prototype.readAndCheckSignature=function(i){return i===this.readData(4)},a.prototype.readData=function(i){this.checkOffset(i);var o=this.data.slice(this.zero+this.index,this.zero+this.index+i);return this.index+=i,o},c.exports=a},{"../utils":32,"./DataReader":18}],21:[function(t,c,r){var n=t("./ArrayReader");function a(i){n.call(this,i)}t("../utils").inherits(a,n),a.prototype.readData=function(i){if(this.checkOffset(i),i===0)return new Uint8Array(0);var o=this.data.subarray(this.zero+this.index,this.zero+this.index+i);return this.index+=i,o},c.exports=a},{"../utils":32,"./ArrayReader":17}],22:[function(t,c,r){var n=t("../utils"),a=t("../support"),i=t("./ArrayReader"),o=t("./StringReader"),l=t("./NodeBufferReader"),f=t("./Uint8ArrayReader");c.exports=function(h){var m=n.getTypeOf(h);return n.checkSupport(m),m!=="string"||a.uint8array?m==="nodebuffer"?new l(h):a.uint8array?new f(n.transformTo("uint8array",h)):new i(n.transformTo("array",h)):new o(h)}},{"../support":30,"../utils":32,"./ArrayReader":17,"./NodeBufferReader":19,"./StringReader":20,"./Uint8ArrayReader":21}],23:[function(t,c,r){r.LOCAL_FILE_HEADER="PK",r.CENTRAL_FILE_HEADER="PK",r.CENTRAL_DIRECTORY_END="PK",r.ZIP64_CENTRAL_DIRECTORY_LOCATOR="PK\x07",r.ZIP64_CENTRAL_DIRECTORY_END="PK",r.DATA_DESCRIPTOR="PK\x07\b"},{}],24:[function(t,c,r){var n=t("./GenericWorker"),a=t("../utils");function i(o){n.call(this,"ConvertWorker to "+o),this.destType=o}a.inherits(i,n),i.prototype.processChunk=function(o){this.push({data:a.transformTo(this.destType,o.data),meta:o.meta})},c.exports=i},{"../utils":32,"./GenericWorker":28}],25:[function(t,c,r){var n=t("./GenericWorker"),a=t("../crc32");function i(){n.call(this,"Crc32Probe"),this.withStreamInfo("crc32",0)}t("../utils").inherits(i,n),i.prototype.processChunk=function(o){this.streamInfo.crc32=a(o.data,this.streamInfo.crc32||0),this.push(o)},c.exports=i},{"../crc32":4,"../utils":32,"./GenericWorker":28}],26:[function(t,c,r){var n=t("../utils"),a=t("./GenericWorker");function i(o){a.call(this,"DataLengthProbe for "+o),this.propName=o,this.withStreamInfo(o,0)}n.inherits(i,a),i.prototype.processChunk=function(o){if(o){var l=this.streamInfo[this.propName]||0;this.streamInfo[this.propName]=l+o.data.length}a.prototype.processChunk.call(this,o)},c.exports=i},{"../utils":32,"./GenericWorker":28}],27:[function(t,c,r){var n=t("../utils"),a=t("./GenericWorker");function i(o){a.call(this,"DataWorker");var l=this;this.dataIsReady=!1,this.index=0,this.max=0,this.data=null,this.type="",this._tickScheduled=!1,o.then(function(f){l.dataIsReady=!0,l.data=f,l.max=f&&f.length||0,l.type=n.getTypeOf(f),l.isPaused||l._tickAndRepeat()},function(f){l.error(f)})}n.inherits(i,a),i.prototype.cleanUp=function(){a.prototype.cleanUp.call(this),this.data=null},i.prototype.resume=function(){return!!a.prototype.resume.call(this)&&(!this._tickScheduled&&this.dataIsReady&&(this._tickScheduled=!0,n.delay(this._tickAndRepeat,[],this)),!0)},i.prototype._tickAndRepeat=function(){this._tickScheduled=!1,this.isPaused||this.isFinished||(this._tick(),this.isFinished||(n.delay(this._tickAndRepeat,[],this),this._tickScheduled=!0))},i.prototype._tick=function(){if(this.isPaused||this.isFinished)return!1;var o=null,l=Math.min(this.max,this.index+16384);if(this.index>=this.max)return this.end();switch(this.type){case"string":o=this.data.substring(this.index,l);break;case"uint8array":o=this.data.subarray(this.index,l);break;case"array":case"nodebuffer":o=this.data.slice(this.index,l)}return this.index=l,this.push({data:o,meta:{percent:this.max?this.index/this.max*100:0}})},c.exports=i},{"../utils":32,"./GenericWorker":28}],28:[function(t,c,r){function n(a){this.name=a||"default",this.streamInfo={},this.generatedError=null,this.extraStreamInfo={},this.isPaused=!0,this.isFinished=!1,this.isLocked=!1,this._listeners={data:[],end:[],error:[]},this.previous=null}n.prototype={push:function(a){this.emit("data",a)},end:function(){if(this.isFinished)return!1;this.flush();try{this.emit("end"),this.cleanUp(),this.isFinished=!0}catch(a){this.emit("error",a)}return!0},error:function(a){return!this.isFinished&&(this.isPaused?this.generatedError=a:(this.isFinished=!0,this.emit("error",a),this.previous&&this.previous.error(a),this.cleanUp()),!0)},on:function(a,i){return this._listeners[a].push(i),this},cleanUp:function(){this.streamInfo=this.generatedError=this.extraStreamInfo=null,this._listeners=[]},emit:function(a,i){if(this._listeners[a])for(var o=0;o<this._listeners[a].length;o++)this._listeners[a][o].call(this,i)},pipe:function(a){return a.registerPrevious(this)},registerPrevious:function(a){if(this.isLocked)throw new Error("The stream '"+this+"' has already been used.");this.streamInfo=a.streamInfo,this.mergeStreamInfo(),this.previous=a;var i=this;return a.on("data",function(o){i.processChunk(o)}),a.on("end",function(){i.end()}),a.on("error",function(o){i.error(o)}),this},pause:function(){return!this.isPaused&&!this.isFinished&&(this.isPaused=!0,this.previous&&this.previous.pause(),!0)},resume:function(){if(!this.isPaused||this.isFinished)return!1;var a=this.isPaused=!1;return this.generatedError&&(this.error(this.generatedError),a=!0),this.previous&&this.previous.resume(),!a},flush:function(){},processChunk:function(a){this.push(a)},withStreamInfo:function(a,i){return this.extraStreamInfo[a]=i,this.mergeStreamInfo(),this},mergeStreamInfo:function(){for(var a in this.extraStreamInfo)Object.prototype.hasOwnProperty.call(this.extraStreamInfo,a)&&(this.streamInfo[a]=this.extraStreamInfo[a])},lock:function(){if(this.isLocked)throw new Error("The stream '"+this+"' has already been used.");this.isLocked=!0,this.previous&&this.previous.lock()},toString:function(){var a="Worker "+this.name;return this.previous?this.previous+" -> "+a:a}},c.exports=n},{}],29:[function(t,c,r){var n=t("../utils"),a=t("./ConvertWorker"),i=t("./GenericWorker"),o=t("../base64"),l=t("../support"),f=t("../external"),h=null;if(l.nodestream)try{h=t("../nodejs/NodejsStreamOutputAdapter")}catch{}function m(y,p){return new f.Promise(function(b,v){var C=[],S=y._internalType,_=y._outputType,k=y._mimeType;y.on("data",function(x,L){C.push(x),p&&p(L)}).on("error",function(x){C=[],v(x)}).on("end",function(){try{var x=function(L,B,M){switch(L){case"blob":return n.newBlob(n.transformTo("arraybuffer",B),M);case"base64":return o.encode(B);default:return n.transformTo(L,B)}}(_,function(L,B){var M,U=0,Q=null,I=0;for(M=0;M<B.length;M++)I+=B[M].length;switch(L){case"string":return B.join("");case"array":return Array.prototype.concat.apply([],B);case"uint8array":for(Q=new Uint8Array(I),M=0;M<B.length;M++)Q.set(B[M],U),U+=B[M].length;return Q;case"nodebuffer":return Buffer.concat(B);default:throw new Error("concat : unsupported type '"+L+"'")}}(S,C),k);b(x)}catch(L){v(L)}C=[]}).resume()})}function u(y,p,b){var v=p;switch(p){case"blob":case"arraybuffer":v="uint8array";break;case"base64":v="string"}try{this._internalType=v,this._outputType=p,this._mimeType=b,n.checkSupport(v),this._worker=y.pipe(new a(v)),y.lock()}catch(C){this._worker=new i("error"),this._worker.error(C)}}u.prototype={accumulate:function(y){return m(this,y)},on:function(y,p){var b=this;return y==="data"?this._worker.on(y,function(v){p.call(b,v.data,v.meta)}):this._worker.on(y,function(){n.delay(p,arguments,b)}),this},resume:function(){return n.delay(this._worker.resume,[],this._worker),this},pause:function(){return this._worker.pause(),this},toNodejsStream:function(y){if(n.checkSupport("nodestream"),this._outputType!=="nodebuffer")throw new Error(this._outputType+" is not supported by this method");return new h(this,{objectMode:this._outputType!=="nodebuffer"},y)}},c.exports=u},{"../base64":1,"../external":6,"../nodejs/NodejsStreamOutputAdapter":13,"../support":30,"../utils":32,"./ConvertWorker":24,"./GenericWorker":28}],30:[function(t,c,r){if(r.base64=!0,r.array=!0,r.string=!0,r.arraybuffer=typeof ArrayBuffer<"u"&&typeof Uint8Array<"u",r.nodebuffer=typeof Buffer<"u",r.uint8array=typeof Uint8Array<"u",typeof ArrayBuffer>"u")r.blob=!1;else{var n=new ArrayBuffer(0);try{r.blob=new Blob([n],{type:"application/zip"}).size===0}catch{try{var a=new(self.BlobBuilder||self.WebKitBlobBuilder||self.MozBlobBuilder||self.MSBlobBuilder);a.append(n),r.blob=a.getBlob("application/zip").size===0}catch{r.blob=!1}}}try{r.nodestream=!!t("readable-stream").Readable}catch{r.nodestream=!1}},{"readable-stream":16}],31:[function(t,c,r){for(var n=t("./utils"),a=t("./support"),i=t("./nodejsUtils"),o=t("./stream/GenericWorker"),l=new Array(256),f=0;f<256;f++)l[f]=252<=f?6:248<=f?5:240<=f?4:224<=f?3:192<=f?2:1;l[254]=l[254]=1;function h(){o.call(this,"utf-8 decode"),this.leftOver=null}function m(){o.call(this,"utf-8 encode")}r.utf8encode=function(u){return a.nodebuffer?i.newBufferFrom(u,"utf-8"):function(y){var p,b,v,C,S,_=y.length,k=0;for(C=0;C<_;C++)(64512&(b=y.charCodeAt(C)))==55296&&C+1<_&&(64512&(v=y.charCodeAt(C+1)))==56320&&(b=65536+(b-55296<<10)+(v-56320),C++),k+=b<128?1:b<2048?2:b<65536?3:4;for(p=a.uint8array?new Uint8Array(k):new Array(k),C=S=0;S<k;C++)(64512&(b=y.charCodeAt(C)))==55296&&C+1<_&&(64512&(v=y.charCodeAt(C+1)))==56320&&(b=65536+(b-55296<<10)+(v-56320),C++),b<128?p[S++]=b:(b<2048?p[S++]=192|b>>>6:(b<65536?p[S++]=224|b>>>12:(p[S++]=240|b>>>18,p[S++]=128|b>>>12&63),p[S++]=128|b>>>6&63),p[S++]=128|63&b);return p}(u)},r.utf8decode=function(u){return a.nodebuffer?n.transformTo("nodebuffer",u).toString("utf-8"):function(y){var p,b,v,C,S=y.length,_=new Array(2*S);for(p=b=0;p<S;)if((v=y[p++])<128)_[b++]=v;else if(4<(C=l[v]))_[b++]=65533,p+=C-1;else{for(v&=C===2?31:C===3?15:7;1<C&&p<S;)v=v<<6|63&y[p++],C--;1<C?_[b++]=65533:v<65536?_[b++]=v:(v-=65536,_[b++]=55296|v>>10&1023,_[b++]=56320|1023&v)}return _.length!==b&&(_.subarray?_=_.subarray(0,b):_.length=b),n.applyFromCharCode(_)}(u=n.transformTo(a.uint8array?"uint8array":"array",u))},n.inherits(h,o),h.prototype.processChunk=function(u){var y=n.transformTo(a.uint8array?"uint8array":"array",u.data);if(this.leftOver&&this.leftOver.length){if(a.uint8array){var p=y;(y=new Uint8Array(p.length+this.leftOver.length)).set(this.leftOver,0),y.set(p,this.leftOver.length)}else y=this.leftOver.concat(y);this.leftOver=null}var b=function(C,S){var _;for((S=S||C.length)>C.length&&(S=C.length),_=S-1;0<=_&&(192&C[_])==128;)_--;return _<0||_===0?S:_+l[C[_]]>S?_:S}(y),v=y;b!==y.length&&(a.uint8array?(v=y.subarray(0,b),this.leftOver=y.subarray(b,y.length)):(v=y.slice(0,b),this.leftOver=y.slice(b,y.length))),this.push({data:r.utf8decode(v),meta:u.meta})},h.prototype.flush=function(){this.leftOver&&this.leftOver.length&&(this.push({data:r.utf8decode(this.leftOver),meta:{}}),this.leftOver=null)},r.Utf8DecodeWorker=h,n.inherits(m,o),m.prototype.processChunk=function(u){this.push({data:r.utf8encode(u.data),meta:u.meta})},r.Utf8EncodeWorker=m},{"./nodejsUtils":14,"./stream/GenericWorker":28,"./support":30,"./utils":32}],32:[function(t,c,r){var n=t("./support"),a=t("./base64"),i=t("./nodejsUtils"),o=t("./external");function l(p){return p}function f(p,b){for(var v=0;v<p.length;++v)b[v]=255&p.charCodeAt(v);return b}t("setimmediate"),r.newBlob=function(p,b){r.checkSupport("blob");try{return new Blob([p],{type:b})}catch{try{var v=new(self.BlobBuilder||self.WebKitBlobBuilder||self.MozBlobBuilder||self.MSBlobBuilder);return v.append(p),v.getBlob(b)}catch{throw new Error("Bug : can't construct the Blob.")}}};var h={stringifyByChunk:function(p,b,v){var C=[],S=0,_=p.length;if(_<=v)return String.fromCharCode.apply(null,p);for(;S<_;)b==="array"||b==="nodebuffer"?C.push(String.fromCharCode.apply(null,p.slice(S,Math.min(S+v,_)))):C.push(String.fromCharCode.apply(null,p.subarray(S,Math.min(S+v,_)))),S+=v;return C.join("")},stringifyByChar:function(p){for(var b="",v=0;v<p.length;v++)b+=String.fromCharCode(p[v]);return b},applyCanBeUsed:{uint8array:function(){try{return n.uint8array&&String.fromCharCode.apply(null,new Uint8Array(1)).length===1}catch{return!1}}(),nodebuffer:function(){try{return n.nodebuffer&&String.fromCharCode.apply(null,i.allocBuffer(1)).length===1}catch{return!1}}()}};function m(p){var b=65536,v=r.getTypeOf(p),C=!0;if(v==="uint8array"?C=h.applyCanBeUsed.uint8array:v==="nodebuffer"&&(C=h.applyCanBeUsed.nodebuffer),C)for(;1<b;)try{return h.stringifyByChunk(p,v,b)}catch{b=Math.floor(b/2)}return h.stringifyByChar(p)}function u(p,b){for(var v=0;v<p.length;v++)b[v]=p[v];return b}r.applyFromCharCode=m;var y={};y.string={string:l,array:function(p){return f(p,new Array(p.length))},arraybuffer:function(p){return y.string.uint8array(p).buffer},uint8array:function(p){return f(p,new Uint8Array(p.length))},nodebuffer:function(p){return f(p,i.allocBuffer(p.length))}},y.array={string:m,array:l,arraybuffer:function(p){return new Uint8Array(p).buffer},uint8array:function(p){return new Uint8Array(p)},nodebuffer:function(p){return i.newBufferFrom(p)}},y.arraybuffer={string:function(p){return m(new Uint8Array(p))},array:function(p){return u(new Uint8Array(p),new Array(p.byteLength))},arraybuffer:l,uint8array:function(p){return new Uint8Array(p)},nodebuffer:function(p){return i.newBufferFrom(new Uint8Array(p))}},y.uint8array={string:m,array:function(p){return u(p,new Array(p.length))},arraybuffer:function(p){return p.buffer},uint8array:l,nodebuffer:function(p){return i.newBufferFrom(p)}},y.nodebuffer={string:m,array:function(p){return u(p,new Array(p.length))},arraybuffer:function(p){return y.nodebuffer.uint8array(p).buffer},uint8array:function(p){return u(p,new Uint8Array(p.length))},nodebuffer:l},r.transformTo=function(p,b){if(b=b||"",!p)return b;r.checkSupport(p);var v=r.getTypeOf(b);return y[v][p](b)},r.resolve=function(p){for(var b=p.split("/"),v=[],C=0;C<b.length;C++){var S=b[C];S==="."||S===""&&C!==0&&C!==b.length-1||(S===".."?v.pop():v.push(S))}return v.join("/")},r.getTypeOf=function(p){return typeof p=="string"?"string":Object.prototype.toString.call(p)==="[object Array]"?"array":n.nodebuffer&&i.isBuffer(p)?"nodebuffer":n.uint8array&&p instanceof Uint8Array?"uint8array":n.arraybuffer&&p instanceof ArrayBuffer?"arraybuffer":void 0},r.checkSupport=function(p){if(!n[p.toLowerCase()])throw new Error(p+" is not supported by this platform")},r.MAX_VALUE_16BITS=65535,r.MAX_VALUE_32BITS=-1,r.pretty=function(p){var b,v,C="";for(v=0;v<(p||"").length;v++)C+="\\x"+((b=p.charCodeAt(v))<16?"0":"")+b.toString(16).toUpperCase();return C},r.delay=function(p,b,v){setImmediate(function(){p.apply(v||null,b||[])})},r.inherits=function(p,b){function v(){}v.prototype=b.prototype,p.prototype=new v},r.extend=function(){var p,b,v={};for(p=0;p<arguments.length;p++)for(b in arguments[p])Object.prototype.hasOwnProperty.call(arguments[p],b)&&v[b]===void 0&&(v[b]=arguments[p][b]);return v},r.prepareContent=function(p,b,v,C,S){return o.Promise.resolve(b).then(function(_){return n.blob&&(_ instanceof Blob||["[object File]","[object Blob]"].indexOf(Object.prototype.toString.call(_))!==-1)&&typeof FileReader<"u"?new o.Promise(function(k,x){var L=new FileReader;L.onload=function(B){k(B.target.result)},L.onerror=function(B){x(B.target.error)},L.readAsArrayBuffer(_)}):_}).then(function(_){var k=r.getTypeOf(_);return k?(k==="arraybuffer"?_=r.transformTo("uint8array",_):k==="string"&&(S?_=a.decode(_):v&&C!==!0&&(_=function(x){return f(x,n.uint8array?new Uint8Array(x.length):new Array(x.length))}(_))),_):o.Promise.reject(new Error("Can't read the data of '"+p+"'. Is it in a supported JavaScript type (String, Blob, ArrayBuffer, etc) ?"))})}},{"./base64":1,"./external":6,"./nodejsUtils":14,"./support":30,setimmediate:54}],33:[function(t,c,r){var n=t("./reader/readerFor"),a=t("./utils"),i=t("./signature"),o=t("./zipEntry"),l=t("./support");function f(h){this.files=[],this.loadOptions=h}f.prototype={checkSignature:function(h){if(!this.reader.readAndCheckSignature(h)){this.reader.index-=4;var m=this.reader.readString(4);throw new Error("Corrupted zip or bug: unexpected signature ("+a.pretty(m)+", expected "+a.pretty(h)+")")}},isSignature:function(h,m){var u=this.reader.index;this.reader.setIndex(h);var y=this.reader.readString(4)===m;return this.reader.setIndex(u),y},readBlockEndOfCentral:function(){this.diskNumber=this.reader.readInt(2),this.diskWithCentralDirStart=this.reader.readInt(2),this.centralDirRecordsOnThisDisk=this.reader.readInt(2),this.centralDirRecords=this.reader.readInt(2),this.centralDirSize=this.reader.readInt(4),this.centralDirOffset=this.reader.readInt(4),this.zipCommentLength=this.reader.readInt(2);var h=this.reader.readData(this.zipCommentLength),m=l.uint8array?"uint8array":"array",u=a.transformTo(m,h);this.zipComment=this.loadOptions.decodeFileName(u)},readBlockZip64EndOfCentral:function(){this.zip64EndOfCentralSize=this.reader.readInt(8),this.reader.skip(4),this.diskNumber=this.reader.readInt(4),this.diskWithCentralDirStart=this.reader.readInt(4),this.centralDirRecordsOnThisDisk=this.reader.readInt(8),this.centralDirRecords=this.reader.readInt(8),this.centralDirSize=this.reader.readInt(8),this.centralDirOffset=this.reader.readInt(8),this.zip64ExtensibleData={};for(var h,m,u,y=this.zip64EndOfCentralSize-44;0<y;)h=this.reader.readInt(2),m=this.reader.readInt(4),u=this.reader.readData(m),this.zip64ExtensibleData[h]={id:h,length:m,value:u}},readBlockZip64EndOfCentralLocator:function(){if(this.diskWithZip64CentralDirStart=this.reader.readInt(4),this.relativeOffsetEndOfZip64CentralDir=this.reader.readInt(8),this.disksCount=this.reader.readInt(4),1<this.disksCount)throw new Error("Multi-volumes zip are not supported")},readLocalFiles:function(){var h,m;for(h=0;h<this.files.length;h++)m=this.files[h],this.reader.setIndex(m.localHeaderOffset),this.checkSignature(i.LOCAL_FILE_HEADER),m.readLocalPart(this.reader),m.handleUTF8(),m.processAttributes()},readCentralDir:function(){var h;for(this.reader.setIndex(this.centralDirOffset);this.reader.readAndCheckSignature(i.CENTRAL_FILE_HEADER);)(h=new o({zip64:this.zip64},this.loadOptions)).readCentralPart(this.reader),this.files.push(h);if(this.centralDirRecords!==this.files.length&&this.centralDirRecords!==0&&this.files.length===0)throw new Error("Corrupted zip or bug: expected "+this.centralDirRecords+" records in central dir, got "+this.files.length)},readEndOfCentral:function(){var h=this.reader.lastIndexOfSignature(i.CENTRAL_DIRECTORY_END);if(h<0)throw this.isSignature(0,i.LOCAL_FILE_HEADER)?new Error("Corrupted zip: can't find end of central directory"):new Error("Can't find end of central directory : is this a zip file ? If it is, see https://stuk.github.io/jszip/documentation/howto/read_zip.html");this.reader.setIndex(h);var m=h;if(this.checkSignature(i.CENTRAL_DIRECTORY_END),this.readBlockEndOfCentral(),this.diskNumber===a.MAX_VALUE_16BITS||this.diskWithCentralDirStart===a.MAX_VALUE_16BITS||this.centralDirRecordsOnThisDisk===a.MAX_VALUE_16BITS||this.centralDirRecords===a.MAX_VALUE_16BITS||this.centralDirSize===a.MAX_VALUE_32BITS||this.centralDirOffset===a.MAX_VALUE_32BITS){if(this.zip64=!0,(h=this.reader.lastIndexOfSignature(i.ZIP64_CENTRAL_DIRECTORY_LOCATOR))<0)throw new Error("Corrupted zip: can't find the ZIP64 end of central directory locator");if(this.reader.setIndex(h),this.checkSignature(i.ZIP64_CENTRAL_DIRECTORY_LOCATOR),this.readBlockZip64EndOfCentralLocator(),!this.isSignature(this.relativeOffsetEndOfZip64CentralDir,i.ZIP64_CENTRAL_DIRECTORY_END)&&(this.relativeOffsetEndOfZip64CentralDir=this.reader.lastIndexOfSignature(i.ZIP64_CENTRAL_DIRECTORY_END),this.relativeOffsetEndOfZip64CentralDir<0))throw new Error("Corrupted zip: can't find the ZIP64 end of central directory");this.reader.setIndex(this.relativeOffsetEndOfZip64CentralDir),this.checkSignature(i.ZIP64_CENTRAL_DIRECTORY_END),this.readBlockZip64EndOfCentral()}var u=this.centralDirOffset+this.centralDirSize;this.zip64&&(u+=20,u+=12+this.zip64EndOfCentralSize);var y=m-u;if(0<y)this.isSignature(m,i.CENTRAL_FILE_HEADER)||(this.reader.zero=y);else if(y<0)throw new Error("Corrupted zip: missing "+Math.abs(y)+" bytes.")},prepareReader:function(h){this.reader=n(h)},load:function(h){this.prepareReader(h),this.readEndOfCentral(),this.readCentralDir(),this.readLocalFiles()}},c.exports=f},{"./reader/readerFor":22,"./signature":23,"./support":30,"./utils":32,"./zipEntry":34}],34:[function(t,c,r){var n=t("./reader/readerFor"),a=t("./utils"),i=t("./compressedObject"),o=t("./crc32"),l=t("./utf8"),f=t("./compressions"),h=t("./support");function m(u,y){this.options=u,this.loadOptions=y}m.prototype={isEncrypted:function(){return(1&this.bitFlag)==1},useUTF8:function(){return(2048&this.bitFlag)==2048},readLocalPart:function(u){var y,p;if(u.skip(22),this.fileNameLength=u.readInt(2),p=u.readInt(2),this.fileName=u.readData(this.fileNameLength),u.skip(p),this.compressedSize===-1||this.uncompressedSize===-1)throw new Error("Bug or corrupted zip : didn't get enough information from the central directory (compressedSize === -1 || uncompressedSize === -1)");if((y=function(b){for(var v in f)if(Object.prototype.hasOwnProperty.call(f,v)&&f[v].magic===b)return f[v];return null}(this.compressionMethod))===null)throw new Error("Corrupted zip : compression "+a.pretty(this.compressionMethod)+" unknown (inner file : "+a.transformTo("string",this.fileName)+")");this.decompressed=new i(this.compressedSize,this.uncompressedSize,this.crc32,y,u.readData(this.compressedSize))},readCentralPart:function(u){this.versionMadeBy=u.readInt(2),u.skip(2),this.bitFlag=u.readInt(2),this.compressionMethod=u.readString(2),this.date=u.readDate(),this.crc32=u.readInt(4),this.compressedSize=u.readInt(4),this.uncompressedSize=u.readInt(4);var y=u.readInt(2);if(this.extraFieldsLength=u.readInt(2),this.fileCommentLength=u.readInt(2),this.diskNumberStart=u.readInt(2),this.internalFileAttributes=u.readInt(2),this.externalFileAttributes=u.readInt(4),this.localHeaderOffset=u.readInt(4),this.isEncrypted())throw new Error("Encrypted zip are not supported");u.skip(y),this.readExtraFields(u),this.parseZIP64ExtraField(u),this.fileComment=u.readData(this.fileCommentLength)},processAttributes:function(){this.unixPermissions=null,this.dosPermissions=null;var u=this.versionMadeBy>>8;this.dir=!!(16&this.externalFileAttributes),u==0&&(this.dosPermissions=63&this.externalFileAttributes),u==3&&(this.unixPermissions=this.externalFileAttributes>>16&65535),this.dir||this.fileNameStr.slice(-1)!=="/"||(this.dir=!0)},parseZIP64ExtraField:function(){if(this.extraFields[1]){var u=n(this.extraFields[1].value);this.uncompressedSize===a.MAX_VALUE_32BITS&&(this.uncompressedSize=u.readInt(8)),this.compressedSize===a.MAX_VALUE_32BITS&&(this.compressedSize=u.readInt(8)),this.localHeaderOffset===a.MAX_VALUE_32BITS&&(this.localHeaderOffset=u.readInt(8)),this.diskNumberStart===a.MAX_VALUE_32BITS&&(this.diskNumberStart=u.readInt(4))}},readExtraFields:function(u){var y,p,b,v=u.index+this.extraFieldsLength;for(this.extraFields||(this.extraFields={});u.index+4<v;)y=u.readInt(2),p=u.readInt(2),b=u.readData(p),this.extraFields[y]={id:y,length:p,value:b};u.setIndex(v)},handleUTF8:function(){var u=h.uint8array?"uint8array":"array";if(this.useUTF8())this.fileNameStr=l.utf8decode(this.fileName),this.fileCommentStr=l.utf8decode(this.fileComment);else{var y=this.findExtraFieldUnicodePath();if(y!==null)this.fileNameStr=y;else{var p=a.transformTo(u,this.fileName);this.fileNameStr=this.loadOptions.decodeFileName(p)}var b=this.findExtraFieldUnicodeComment();if(b!==null)this.fileCommentStr=b;else{var v=a.transformTo(u,this.fileComment);this.fileCommentStr=this.loadOptions.decodeFileName(v)}}},findExtraFieldUnicodePath:function(){var u=this.extraFields[28789];if(u){var y=n(u.value);return y.readInt(1)!==1||o(this.fileName)!==y.readInt(4)?null:l.utf8decode(y.readData(u.length-5))}return null},findExtraFieldUnicodeComment:function(){var u=this.extraFields[25461];if(u){var y=n(u.value);return y.readInt(1)!==1||o(this.fileComment)!==y.readInt(4)?null:l.utf8decode(y.readData(u.length-5))}return null}},c.exports=m},{"./compressedObject":2,"./compressions":3,"./crc32":4,"./reader/readerFor":22,"./support":30,"./utf8":31,"./utils":32}],35:[function(t,c,r){function n(y,p,b){this.name=y,this.dir=b.dir,this.date=b.date,this.comment=b.comment,this.unixPermissions=b.unixPermissions,this.dosPermissions=b.dosPermissions,this._data=p,this._dataBinary=b.binary,this.options={compression:b.compression,compressionOptions:b.compressionOptions}}var a=t("./stream/StreamHelper"),i=t("./stream/DataWorker"),o=t("./utf8"),l=t("./compressedObject"),f=t("./stream/GenericWorker");n.prototype={internalStream:function(y){var p=null,b="string";try{if(!y)throw new Error("No output type specified.");var v=(b=y.toLowerCase())==="string"||b==="text";b!=="binarystring"&&b!=="text"||(b="string"),p=this._decompressWorker();var C=!this._dataBinary;C&&!v&&(p=p.pipe(new o.Utf8EncodeWorker)),!C&&v&&(p=p.pipe(new o.Utf8DecodeWorker))}catch(S){(p=new f("error")).error(S)}return new a(p,b,"")},async:function(y,p){return this.internalStream(y).accumulate(p)},nodeStream:function(y,p){return this.internalStream(y||"nodebuffer").toNodejsStream(p)},_compressWorker:function(y,p){if(this._data instanceof l&&this._data.compression.magic===y.magic)return this._data.getCompressedWorker();var b=this._decompressWorker();return this._dataBinary||(b=b.pipe(new o.Utf8EncodeWorker)),l.createWorkerFrom(b,y,p)},_decompressWorker:function(){return this._data instanceof l?this._data.getContentWorker():this._data instanceof f?this._data:new i(this._data)}};for(var h=["asText","asBinary","asNodeBuffer","asUint8Array","asArrayBuffer"],m=function(){throw new Error("This method has been removed in JSZip 3.0, please check the upgrade guide.")},u=0;u<h.length;u++)n.prototype[h[u]]=m;c.exports=n},{"./compressedObject":2,"./stream/DataWorker":27,"./stream/GenericWorker":28,"./stream/StreamHelper":29,"./utf8":31}],36:[function(t,c,r){(function(n){var a,i,o=n.MutationObserver||n.WebKitMutationObserver;if(o){var l=0,f=new o(y),h=n.document.createTextNode("");f.observe(h,{characterData:!0}),a=function(){h.data=l=++l%2}}else if(n.setImmediate||n.MessageChannel===void 0)a="document"in n&&"onreadystatechange"in n.document.createElement("script")?function(){var p=n.document.createElement("script");p.onreadystatechange=function(){y(),p.onreadystatechange=null,p.parentNode.removeChild(p),p=null},n.document.documentElement.appendChild(p)}:function(){setTimeout(y,0)};else{var m=new n.MessageChannel;m.port1.onmessage=y,a=function(){m.port2.postMessage(0)}}var u=[];function y(){var p,b;i=!0;for(var v=u.length;v;){for(b=u,u=[],p=-1;++p<v;)b[p]();v=u.length}i=!1}c.exports=function(p){u.push(p)!==1||i||a()}}).call(this,typeof Dn<"u"?Dn:typeof self<"u"?self:typeof window<"u"?window:{})},{}],37:[function(t,c,r){var n=t("immediate");function a(){}var i={},o=["REJECTED"],l=["FULFILLED"],f=["PENDING"];function h(v){if(typeof v!="function")throw new TypeError("resolver must be a function");this.state=f,this.queue=[],this.outcome=void 0,v!==a&&p(this,v)}function m(v,C,S){this.promise=v,typeof C=="function"&&(this.onFulfilled=C,this.callFulfilled=this.otherCallFulfilled),typeof S=="function"&&(this.onRejected=S,this.callRejected=this.otherCallRejected)}function u(v,C,S){n(function(){var _;try{_=C(S)}catch(k){return i.reject(v,k)}_===v?i.reject(v,new TypeError("Cannot resolve promise with itself")):i.resolve(v,_)})}function y(v){var C=v&&v.then;if(v&&(typeof v=="object"||typeof v=="function")&&typeof C=="function")return function(){C.apply(v,arguments)}}function p(v,C){var S=!1;function _(L){S||(S=!0,i.reject(v,L))}function k(L){S||(S=!0,i.resolve(v,L))}var x=b(function(){C(k,_)});x.status==="error"&&_(x.value)}function b(v,C){var S={};try{S.value=v(C),S.status="success"}catch(_){S.status="error",S.value=_}return S}(c.exports=h).prototype.finally=function(v){if(typeof v!="function")return this;var C=this.constructor;return this.then(function(S){return C.resolve(v()).then(function(){return S})},function(S){return C.resolve(v()).then(function(){throw S})})},h.prototype.catch=function(v){return this.then(null,v)},h.prototype.then=function(v,C){if(typeof v!="function"&&this.state===l||typeof C!="function"&&this.state===o)return this;var S=new this.constructor(a);return this.state!==f?u(S,this.state===l?v:C,this.outcome):this.queue.push(new m(S,v,C)),S},m.prototype.callFulfilled=function(v){i.resolve(this.promise,v)},m.prototype.otherCallFulfilled=function(v){u(this.promise,this.onFulfilled,v)},m.prototype.callRejected=function(v){i.reject(this.promise,v)},m.prototype.otherCallRejected=function(v){u(this.promise,this.onRejected,v)},i.resolve=function(v,C){var S=b(y,C);if(S.status==="error")return i.reject(v,S.value);var _=S.value;if(_)p(v,_);else{v.state=l,v.outcome=C;for(var k=-1,x=v.queue.length;++k<x;)v.queue[k].callFulfilled(C)}return v},i.reject=function(v,C){v.state=o,v.outcome=C;for(var S=-1,_=v.queue.length;++S<_;)v.queue[S].callRejected(C);return v},h.resolve=function(v){return v instanceof this?v:i.resolve(new this(a),v)},h.reject=function(v){var C=new this(a);return i.reject(C,v)},h.all=function(v){var C=this;if(Object.prototype.toString.call(v)!=="[object Array]")return this.reject(new TypeError("must be an array"));var S=v.length,_=!1;if(!S)return this.resolve([]);for(var k=new Array(S),x=0,L=-1,B=new this(a);++L<S;)M(v[L],L);return B;function M(U,Q){C.resolve(U).then(function(I){k[Q]=I,++x!==S||_||(_=!0,i.resolve(B,k))},function(I){_||(_=!0,i.reject(B,I))})}},h.race=function(v){var C=this;if(Object.prototype.toString.call(v)!=="[object Array]")return this.reject(new TypeError("must be an array"));var S=v.length,_=!1;if(!S)return this.resolve([]);for(var k=-1,x=new this(a);++k<S;)L=v[k],C.resolve(L).then(function(B){_||(_=!0,i.resolve(x,B))},function(B){_||(_=!0,i.reject(x,B))});var L;return x}},{immediate:36}],38:[function(t,c,r){var n={};(0,t("./lib/utils/common").assign)(n,t("./lib/deflate"),t("./lib/inflate"),t("./lib/zlib/constants")),c.exports=n},{"./lib/deflate":39,"./lib/inflate":40,"./lib/utils/common":41,"./lib/zlib/constants":44}],39:[function(t,c,r){var n=t("./zlib/deflate"),a=t("./utils/common"),i=t("./utils/strings"),o=t("./zlib/messages"),l=t("./zlib/zstream"),f=Object.prototype.toString,h=0,m=-1,u=0,y=8;function p(v){if(!(this instanceof p))return new p(v);this.options=a.assign({level:m,method:y,chunkSize:16384,windowBits:15,memLevel:8,strategy:u,to:""},v||{});var C=this.options;C.raw&&0<C.windowBits?C.windowBits=-C.windowBits:C.gzip&&0<C.windowBits&&C.windowBits<16&&(C.windowBits+=16),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new l,this.strm.avail_out=0;var S=n.deflateInit2(this.strm,C.level,C.method,C.windowBits,C.memLevel,C.strategy);if(S!==h)throw new Error(o[S]);if(C.header&&n.deflateSetHeader(this.strm,C.header),C.dictionary){var _;if(_=typeof C.dictionary=="string"?i.string2buf(C.dictionary):f.call(C.dictionary)==="[object ArrayBuffer]"?new Uint8Array(C.dictionary):C.dictionary,(S=n.deflateSetDictionary(this.strm,_))!==h)throw new Error(o[S]);this._dict_set=!0}}function b(v,C){var S=new p(C);if(S.push(v,!0),S.err)throw S.msg||o[S.err];return S.result}p.prototype.push=function(v,C){var S,_,k=this.strm,x=this.options.chunkSize;if(this.ended)return!1;_=C===~~C?C:C===!0?4:0,typeof v=="string"?k.input=i.string2buf(v):f.call(v)==="[object ArrayBuffer]"?k.input=new Uint8Array(v):k.input=v,k.next_in=0,k.avail_in=k.input.length;do{if(k.avail_out===0&&(k.output=new a.Buf8(x),k.next_out=0,k.avail_out=x),(S=n.deflate(k,_))!==1&&S!==h)return this.onEnd(S),!(this.ended=!0);k.avail_out!==0&&(k.avail_in!==0||_!==4&&_!==2)||(this.options.to==="string"?this.onData(i.buf2binstring(a.shrinkBuf(k.output,k.next_out))):this.onData(a.shrinkBuf(k.output,k.next_out)))}while((0<k.avail_in||k.avail_out===0)&&S!==1);return _===4?(S=n.deflateEnd(this.strm),this.onEnd(S),this.ended=!0,S===h):_!==2||(this.onEnd(h),!(k.avail_out=0))},p.prototype.onData=function(v){this.chunks.push(v)},p.prototype.onEnd=function(v){v===h&&(this.options.to==="string"?this.result=this.chunks.join(""):this.result=a.flattenChunks(this.chunks)),this.chunks=[],this.err=v,this.msg=this.strm.msg},r.Deflate=p,r.deflate=b,r.deflateRaw=function(v,C){return(C=C||{}).raw=!0,b(v,C)},r.gzip=function(v,C){return(C=C||{}).gzip=!0,b(v,C)}},{"./utils/common":41,"./utils/strings":42,"./zlib/deflate":46,"./zlib/messages":51,"./zlib/zstream":53}],40:[function(t,c,r){var n=t("./zlib/inflate"),a=t("./utils/common"),i=t("./utils/strings"),o=t("./zlib/constants"),l=t("./zlib/messages"),f=t("./zlib/zstream"),h=t("./zlib/gzheader"),m=Object.prototype.toString;function u(p){if(!(this instanceof u))return new u(p);this.options=a.assign({chunkSize:16384,windowBits:0,to:""},p||{});var b=this.options;b.raw&&0<=b.windowBits&&b.windowBits<16&&(b.windowBits=-b.windowBits,b.windowBits===0&&(b.windowBits=-15)),!(0<=b.windowBits&&b.windowBits<16)||p&&p.windowBits||(b.windowBits+=32),15<b.windowBits&&b.windowBits<48&&!(15&b.windowBits)&&(b.windowBits|=15),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new f,this.strm.avail_out=0;var v=n.inflateInit2(this.strm,b.windowBits);if(v!==o.Z_OK)throw new Error(l[v]);this.header=new h,n.inflateGetHeader(this.strm,this.header)}function y(p,b){var v=new u(b);if(v.push(p,!0),v.err)throw v.msg||l[v.err];return v.result}u.prototype.push=function(p,b){var v,C,S,_,k,x,L=this.strm,B=this.options.chunkSize,M=this.options.dictionary,U=!1;if(this.ended)return!1;C=b===~~b?b:b===!0?o.Z_FINISH:o.Z_NO_FLUSH,typeof p=="string"?L.input=i.binstring2buf(p):m.call(p)==="[object ArrayBuffer]"?L.input=new Uint8Array(p):L.input=p,L.next_in=0,L.avail_in=L.input.length;do{if(L.avail_out===0&&(L.output=new a.Buf8(B),L.next_out=0,L.avail_out=B),(v=n.inflate(L,o.Z_NO_FLUSH))===o.Z_NEED_DICT&&M&&(x=typeof M=="string"?i.string2buf(M):m.call(M)==="[object ArrayBuffer]"?new Uint8Array(M):M,v=n.inflateSetDictionary(this.strm,x)),v===o.Z_BUF_ERROR&&U===!0&&(v=o.Z_OK,U=!1),v!==o.Z_STREAM_END&&v!==o.Z_OK)return this.onEnd(v),!(this.ended=!0);L.next_out&&(L.avail_out!==0&&v!==o.Z_STREAM_END&&(L.avail_in!==0||C!==o.Z_FINISH&&C!==o.Z_SYNC_FLUSH)||(this.options.to==="string"?(S=i.utf8border(L.output,L.next_out),_=L.next_out-S,k=i.buf2string(L.output,S),L.next_out=_,L.avail_out=B-_,_&&a.arraySet(L.output,L.output,S,_,0),this.onData(k)):this.onData(a.shrinkBuf(L.output,L.next_out)))),L.avail_in===0&&L.avail_out===0&&(U=!0)}while((0<L.avail_in||L.avail_out===0)&&v!==o.Z_STREAM_END);return v===o.Z_STREAM_END&&(C=o.Z_FINISH),C===o.Z_FINISH?(v=n.inflateEnd(this.strm),this.onEnd(v),this.ended=!0,v===o.Z_OK):C!==o.Z_SYNC_FLUSH||(this.onEnd(o.Z_OK),!(L.avail_out=0))},u.prototype.onData=function(p){this.chunks.push(p)},u.prototype.onEnd=function(p){p===o.Z_OK&&(this.options.to==="string"?this.result=this.chunks.join(""):this.result=a.flattenChunks(this.chunks)),this.chunks=[],this.err=p,this.msg=this.strm.msg},r.Inflate=u,r.inflate=y,r.inflateRaw=function(p,b){return(b=b||{}).raw=!0,y(p,b)},r.ungzip=y},{"./utils/common":41,"./utils/strings":42,"./zlib/constants":44,"./zlib/gzheader":47,"./zlib/inflate":49,"./zlib/messages":51,"./zlib/zstream":53}],41:[function(t,c,r){var n=typeof Uint8Array<"u"&&typeof Uint16Array<"u"&&typeof Int32Array<"u";r.assign=function(o){for(var l=Array.prototype.slice.call(arguments,1);l.length;){var f=l.shift();if(f){if(typeof f!="object")throw new TypeError(f+"must be non-object");for(var h in f)f.hasOwnProperty(h)&&(o[h]=f[h])}}return o},r.shrinkBuf=function(o,l){return o.length===l?o:o.subarray?o.subarray(0,l):(o.length=l,o)};var a={arraySet:function(o,l,f,h,m){if(l.subarray&&o.subarray)o.set(l.subarray(f,f+h),m);else for(var u=0;u<h;u++)o[m+u]=l[f+u]},flattenChunks:function(o){var l,f,h,m,u,y;for(l=h=0,f=o.length;l<f;l++)h+=o[l].length;for(y=new Uint8Array(h),l=m=0,f=o.length;l<f;l++)u=o[l],y.set(u,m),m+=u.length;return y}},i={arraySet:function(o,l,f,h,m){for(var u=0;u<h;u++)o[m+u]=l[f+u]},flattenChunks:function(o){return[].concat.apply([],o)}};r.setTyped=function(o){o?(r.Buf8=Uint8Array,r.Buf16=Uint16Array,r.Buf32=Int32Array,r.assign(r,a)):(r.Buf8=Array,r.Buf16=Array,r.Buf32=Array,r.assign(r,i))},r.setTyped(n)},{}],42:[function(t,c,r){var n=t("./common"),a=!0,i=!0;try{String.fromCharCode.apply(null,[0])}catch{a=!1}try{String.fromCharCode.apply(null,new Uint8Array(1))}catch{i=!1}for(var o=new n.Buf8(256),l=0;l<256;l++)o[l]=252<=l?6:248<=l?5:240<=l?4:224<=l?3:192<=l?2:1;function f(h,m){if(m<65537&&(h.subarray&&i||!h.subarray&&a))return String.fromCharCode.apply(null,n.shrinkBuf(h,m));for(var u="",y=0;y<m;y++)u+=String.fromCharCode(h[y]);return u}o[254]=o[254]=1,r.string2buf=function(h){var m,u,y,p,b,v=h.length,C=0;for(p=0;p<v;p++)(64512&(u=h.charCodeAt(p)))==55296&&p+1<v&&(64512&(y=h.charCodeAt(p+1)))==56320&&(u=65536+(u-55296<<10)+(y-56320),p++),C+=u<128?1:u<2048?2:u<65536?3:4;for(m=new n.Buf8(C),p=b=0;b<C;p++)(64512&(u=h.charCodeAt(p)))==55296&&p+1<v&&(64512&(y=h.charCodeAt(p+1)))==56320&&(u=65536+(u-55296<<10)+(y-56320),p++),u<128?m[b++]=u:(u<2048?m[b++]=192|u>>>6:(u<65536?m[b++]=224|u>>>12:(m[b++]=240|u>>>18,m[b++]=128|u>>>12&63),m[b++]=128|u>>>6&63),m[b++]=128|63&u);return m},r.buf2binstring=function(h){return f(h,h.length)},r.binstring2buf=function(h){for(var m=new n.Buf8(h.length),u=0,y=m.length;u<y;u++)m[u]=h.charCodeAt(u);return m},r.buf2string=function(h,m){var u,y,p,b,v=m||h.length,C=new Array(2*v);for(u=y=0;u<v;)if((p=h[u++])<128)C[y++]=p;else if(4<(b=o[p]))C[y++]=65533,u+=b-1;else{for(p&=b===2?31:b===3?15:7;1<b&&u<v;)p=p<<6|63&h[u++],b--;1<b?C[y++]=65533:p<65536?C[y++]=p:(p-=65536,C[y++]=55296|p>>10&1023,C[y++]=56320|1023&p)}return f(C,y)},r.utf8border=function(h,m){var u;for((m=m||h.length)>h.length&&(m=h.length),u=m-1;0<=u&&(192&h[u])==128;)u--;return u<0||u===0?m:u+o[h[u]]>m?u:m}},{"./common":41}],43:[function(t,c,r){c.exports=function(n,a,i,o){for(var l=65535&n|0,f=n>>>16&65535|0,h=0;i!==0;){for(i-=h=2e3<i?2e3:i;f=f+(l=l+a[o++]|0)|0,--h;);l%=65521,f%=65521}return l|f<<16|0}},{}],44:[function(t,c,r){c.exports={Z_NO_FLUSH:0,Z_PARTIAL_FLUSH:1,Z_SYNC_FLUSH:2,Z_FULL_FLUSH:3,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_ERRNO:-1,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_BUF_ERROR:-5,Z_NO_COMPRESSION:0,Z_BEST_SPEED:1,Z_BEST_COMPRESSION:9,Z_DEFAULT_COMPRESSION:-1,Z_FILTERED:1,Z_HUFFMAN_ONLY:2,Z_RLE:3,Z_FIXED:4,Z_DEFAULT_STRATEGY:0,Z_BINARY:0,Z_TEXT:1,Z_UNKNOWN:2,Z_DEFLATED:8}},{}],45:[function(t,c,r){var n=function(){for(var a,i=[],o=0;o<256;o++){a=o;for(var l=0;l<8;l++)a=1&a?3988292384^a>>>1:a>>>1;i[o]=a}return i}();c.exports=function(a,i,o,l){var f=n,h=l+o;a^=-1;for(var m=l;m<h;m++)a=a>>>8^f[255&(a^i[m])];return-1^a}},{}],46:[function(t,c,r){var n,a=t("../utils/common"),i=t("./trees"),o=t("./adler32"),l=t("./crc32"),f=t("./messages"),h=0,m=4,u=0,y=-2,p=-1,b=4,v=2,C=8,S=9,_=286,k=30,x=19,L=2*_+1,B=15,M=3,U=258,Q=U+M+1,I=42,z=113,g=1,F=2,re=3,G=4;function de(d,P){return d.msg=f[P],P}function V(d){return(d<<1)-(4<d?9:0)}function le(d){for(var P=d.length;0<=--P;)d[P]=0}function O(d){var P=d.state,$=P.pending;$>d.avail_out&&($=d.avail_out),$!==0&&(a.arraySet(d.output,P.pending_buf,P.pending_out,$,d.next_out),d.next_out+=$,P.pending_out+=$,d.total_out+=$,d.avail_out-=$,P.pending-=$,P.pending===0&&(P.pending_out=0))}function A(d,P){i._tr_flush_block(d,0<=d.block_start?d.block_start:-1,d.strstart-d.block_start,P),d.block_start=d.strstart,O(d.strm)}function oe(d,P){d.pending_buf[d.pending++]=P}function ee(d,P){d.pending_buf[d.pending++]=P>>>8&255,d.pending_buf[d.pending++]=255&P}function X(d,P){var $,E,w=d.max_chain_length,T=d.strstart,W=d.prev_length,q=d.nice_match,D=d.strstart>d.w_size-Q?d.strstart-(d.w_size-Q):0,J=d.window,te=d.w_mask,Y=d.prev,ae=d.strstart+U,we=J[T+W-1],fe=J[T+W];d.prev_length>=d.good_match&&(w>>=2),q>d.lookahead&&(q=d.lookahead);do if(J[($=P)+W]===fe&&J[$+W-1]===we&&J[$]===J[T]&&J[++$]===J[T+1]){T+=2,$++;do;while(J[++T]===J[++$]&&J[++T]===J[++$]&&J[++T]===J[++$]&&J[++T]===J[++$]&&J[++T]===J[++$]&&J[++T]===J[++$]&&J[++T]===J[++$]&&J[++T]===J[++$]&&T<ae);if(E=U-(ae-T),T=ae-U,W<E){if(d.match_start=P,q<=(W=E))break;we=J[T+W-1],fe=J[T+W]}}while((P=Y[P&te])>D&&--w!=0);return W<=d.lookahead?W:d.lookahead}function xe(d){var P,$,E,w,T,W,q,D,J,te,Y=d.w_size;do{if(w=d.window_size-d.lookahead-d.strstart,d.strstart>=Y+(Y-Q)){for(a.arraySet(d.window,d.window,Y,Y,0),d.match_start-=Y,d.strstart-=Y,d.block_start-=Y,P=$=d.hash_size;E=d.head[--P],d.head[P]=Y<=E?E-Y:0,--$;);for(P=$=Y;E=d.prev[--P],d.prev[P]=Y<=E?E-Y:0,--$;);w+=Y}if(d.strm.avail_in===0)break;if(W=d.strm,q=d.window,D=d.strstart+d.lookahead,J=w,te=void 0,te=W.avail_in,J<te&&(te=J),$=te===0?0:(W.avail_in-=te,a.arraySet(q,W.input,W.next_in,te,D),W.state.wrap===1?W.adler=o(W.adler,q,te,D):W.state.wrap===2&&(W.adler=l(W.adler,q,te,D)),W.next_in+=te,W.total_in+=te,te),d.lookahead+=$,d.lookahead+d.insert>=M)for(T=d.strstart-d.insert,d.ins_h=d.window[T],d.ins_h=(d.ins_h<<d.hash_shift^d.window[T+1])&d.hash_mask;d.insert&&(d.ins_h=(d.ins_h<<d.hash_shift^d.window[T+M-1])&d.hash_mask,d.prev[T&d.w_mask]=d.head[d.ins_h],d.head[d.ins_h]=T,T++,d.insert--,!(d.lookahead+d.insert<M)););}while(d.lookahead<Q&&d.strm.avail_in!==0)}function Me(d,P){for(var $,E;;){if(d.lookahead<Q){if(xe(d),d.lookahead<Q&&P===h)return g;if(d.lookahead===0)break}if($=0,d.lookahead>=M&&(d.ins_h=(d.ins_h<<d.hash_shift^d.window[d.strstart+M-1])&d.hash_mask,$=d.prev[d.strstart&d.w_mask]=d.head[d.ins_h],d.head[d.ins_h]=d.strstart),$!==0&&d.strstart-$<=d.w_size-Q&&(d.match_length=X(d,$)),d.match_length>=M)if(E=i._tr_tally(d,d.strstart-d.match_start,d.match_length-M),d.lookahead-=d.match_length,d.match_length<=d.max_lazy_match&&d.lookahead>=M){for(d.match_length--;d.strstart++,d.ins_h=(d.ins_h<<d.hash_shift^d.window[d.strstart+M-1])&d.hash_mask,$=d.prev[d.strstart&d.w_mask]=d.head[d.ins_h],d.head[d.ins_h]=d.strstart,--d.match_length!=0;);d.strstart++}else d.strstart+=d.match_length,d.match_length=0,d.ins_h=d.window[d.strstart],d.ins_h=(d.ins_h<<d.hash_shift^d.window[d.strstart+1])&d.hash_mask;else E=i._tr_tally(d,0,d.window[d.strstart]),d.lookahead--,d.strstart++;if(E&&(A(d,!1),d.strm.avail_out===0))return g}return d.insert=d.strstart<M-1?d.strstart:M-1,P===m?(A(d,!0),d.strm.avail_out===0?re:G):d.last_lit&&(A(d,!1),d.strm.avail_out===0)?g:F}function he(d,P){for(var $,E,w;;){if(d.lookahead<Q){if(xe(d),d.lookahead<Q&&P===h)return g;if(d.lookahead===0)break}if($=0,d.lookahead>=M&&(d.ins_h=(d.ins_h<<d.hash_shift^d.window[d.strstart+M-1])&d.hash_mask,$=d.prev[d.strstart&d.w_mask]=d.head[d.ins_h],d.head[d.ins_h]=d.strstart),d.prev_length=d.match_length,d.prev_match=d.match_start,d.match_length=M-1,$!==0&&d.prev_length<d.max_lazy_match&&d.strstart-$<=d.w_size-Q&&(d.match_length=X(d,$),d.match_length<=5&&(d.strategy===1||d.match_length===M&&4096<d.strstart-d.match_start)&&(d.match_length=M-1)),d.prev_length>=M&&d.match_length<=d.prev_length){for(w=d.strstart+d.lookahead-M,E=i._tr_tally(d,d.strstart-1-d.prev_match,d.prev_length-M),d.lookahead-=d.prev_length-1,d.prev_length-=2;++d.strstart<=w&&(d.ins_h=(d.ins_h<<d.hash_shift^d.window[d.strstart+M-1])&d.hash_mask,$=d.prev[d.strstart&d.w_mask]=d.head[d.ins_h],d.head[d.ins_h]=d.strstart),--d.prev_length!=0;);if(d.match_available=0,d.match_length=M-1,d.strstart++,E&&(A(d,!1),d.strm.avail_out===0))return g}else if(d.match_available){if((E=i._tr_tally(d,0,d.window[d.strstart-1]))&&A(d,!1),d.strstart++,d.lookahead--,d.strm.avail_out===0)return g}else d.match_available=1,d.strstart++,d.lookahead--}return d.match_available&&(E=i._tr_tally(d,0,d.window[d.strstart-1]),d.match_available=0),d.insert=d.strstart<M-1?d.strstart:M-1,P===m?(A(d,!0),d.strm.avail_out===0?re:G):d.last_lit&&(A(d,!1),d.strm.avail_out===0)?g:F}function ve(d,P,$,E,w){this.good_length=d,this.max_lazy=P,this.nice_length=$,this.max_chain=E,this.func=w}function Oe(){this.strm=null,this.status=0,this.pending_buf=null,this.pending_buf_size=0,this.pending_out=0,this.pending=0,this.wrap=0,this.gzhead=null,this.gzindex=0,this.method=C,this.last_flush=-1,this.w_size=0,this.w_bits=0,this.w_mask=0,this.window=null,this.window_size=0,this.prev=null,this.head=null,this.ins_h=0,this.hash_size=0,this.hash_bits=0,this.hash_mask=0,this.hash_shift=0,this.block_start=0,this.match_length=0,this.prev_match=0,this.match_available=0,this.strstart=0,this.match_start=0,this.lookahead=0,this.prev_length=0,this.max_chain_length=0,this.max_lazy_match=0,this.level=0,this.strategy=0,this.good_match=0,this.nice_match=0,this.dyn_ltree=new a.Buf16(2*L),this.dyn_dtree=new a.Buf16(2*(2*k+1)),this.bl_tree=new a.Buf16(2*(2*x+1)),le(this.dyn_ltree),le(this.dyn_dtree),le(this.bl_tree),this.l_desc=null,this.d_desc=null,this.bl_desc=null,this.bl_count=new a.Buf16(B+1),this.heap=new a.Buf16(2*_+1),le(this.heap),this.heap_len=0,this.heap_max=0,this.depth=new a.Buf16(2*_+1),le(this.depth),this.l_buf=0,this.lit_bufsize=0,this.last_lit=0,this.d_buf=0,this.opt_len=0,this.static_len=0,this.matches=0,this.insert=0,this.bi_buf=0,this.bi_valid=0}function Ne(d){var P;return d&&d.state?(d.total_in=d.total_out=0,d.data_type=v,(P=d.state).pending=0,P.pending_out=0,P.wrap<0&&(P.wrap=-P.wrap),P.status=P.wrap?I:z,d.adler=P.wrap===2?0:1,P.last_flush=h,i._tr_init(P),u):de(d,y)}function Ze(d){var P=Ne(d);return P===u&&function($){$.window_size=2*$.w_size,le($.head),$.max_lazy_match=n[$.level].max_lazy,$.good_match=n[$.level].good_length,$.nice_match=n[$.level].nice_length,$.max_chain_length=n[$.level].max_chain,$.strstart=0,$.block_start=0,$.lookahead=0,$.insert=0,$.match_length=$.prev_length=M-1,$.match_available=0,$.ins_h=0}(d.state),P}function Ve(d,P,$,E,w,T){if(!d)return y;var W=1;if(P===p&&(P=6),E<0?(W=0,E=-E):15<E&&(W=2,E-=16),w<1||S<w||$!==C||E<8||15<E||P<0||9<P||T<0||b<T)return de(d,y);E===8&&(E=9);var q=new Oe;return(d.state=q).strm=d,q.wrap=W,q.gzhead=null,q.w_bits=E,q.w_size=1<<q.w_bits,q.w_mask=q.w_size-1,q.hash_bits=w+7,q.hash_size=1<<q.hash_bits,q.hash_mask=q.hash_size-1,q.hash_shift=~~((q.hash_bits+M-1)/M),q.window=new a.Buf8(2*q.w_size),q.head=new a.Buf16(q.hash_size),q.prev=new a.Buf16(q.w_size),q.lit_bufsize=1<<w+6,q.pending_buf_size=4*q.lit_bufsize,q.pending_buf=new a.Buf8(q.pending_buf_size),q.d_buf=1*q.lit_bufsize,q.l_buf=3*q.lit_bufsize,q.level=P,q.strategy=T,q.method=$,Ze(d)}n=[new ve(0,0,0,0,function(d,P){var $=65535;for($>d.pending_buf_size-5&&($=d.pending_buf_size-5);;){if(d.lookahead<=1){if(xe(d),d.lookahead===0&&P===h)return g;if(d.lookahead===0)break}d.strstart+=d.lookahead,d.lookahead=0;var E=d.block_start+$;if((d.strstart===0||d.strstart>=E)&&(d.lookahead=d.strstart-E,d.strstart=E,A(d,!1),d.strm.avail_out===0)||d.strstart-d.block_start>=d.w_size-Q&&(A(d,!1),d.strm.avail_out===0))return g}return d.insert=0,P===m?(A(d,!0),d.strm.avail_out===0?re:G):(d.strstart>d.block_start&&(A(d,!1),d.strm.avail_out),g)}),new ve(4,4,8,4,Me),new ve(4,5,16,8,Me),new ve(4,6,32,32,Me),new ve(4,4,16,16,he),new ve(8,16,32,32,he),new ve(8,16,128,128,he),new ve(8,32,128,256,he),new ve(32,128,258,1024,he),new ve(32,258,258,4096,he)],r.deflateInit=function(d,P){return Ve(d,P,C,15,8,0)},r.deflateInit2=Ve,r.deflateReset=Ze,r.deflateResetKeep=Ne,r.deflateSetHeader=function(d,P){return d&&d.state?d.state.wrap!==2?y:(d.state.gzhead=P,u):y},r.deflate=function(d,P){var $,E,w,T;if(!d||!d.state||5<P||P<0)return d?de(d,y):y;if(E=d.state,!d.output||!d.input&&d.avail_in!==0||E.status===666&&P!==m)return de(d,d.avail_out===0?-5:y);if(E.strm=d,$=E.last_flush,E.last_flush=P,E.status===I)if(E.wrap===2)d.adler=0,oe(E,31),oe(E,139),oe(E,8),E.gzhead?(oe(E,(E.gzhead.text?1:0)+(E.gzhead.hcrc?2:0)+(E.gzhead.extra?4:0)+(E.gzhead.name?8:0)+(E.gzhead.comment?16:0)),oe(E,255&E.gzhead.time),oe(E,E.gzhead.time>>8&255),oe(E,E.gzhead.time>>16&255),oe(E,E.gzhead.time>>24&255),oe(E,E.level===9?2:2<=E.strategy||E.level<2?4:0),oe(E,255&E.gzhead.os),E.gzhead.extra&&E.gzhead.extra.length&&(oe(E,255&E.gzhead.extra.length),oe(E,E.gzhead.extra.length>>8&255)),E.gzhead.hcrc&&(d.adler=l(d.adler,E.pending_buf,E.pending,0)),E.gzindex=0,E.status=69):(oe(E,0),oe(E,0),oe(E,0),oe(E,0),oe(E,0),oe(E,E.level===9?2:2<=E.strategy||E.level<2?4:0),oe(E,3),E.status=z);else{var W=C+(E.w_bits-8<<4)<<8;W|=(2<=E.strategy||E.level<2?0:E.level<6?1:E.level===6?2:3)<<6,E.strstart!==0&&(W|=32),W+=31-W%31,E.status=z,ee(E,W),E.strstart!==0&&(ee(E,d.adler>>>16),ee(E,65535&d.adler)),d.adler=1}if(E.status===69)if(E.gzhead.extra){for(w=E.pending;E.gzindex<(65535&E.gzhead.extra.length)&&(E.pending!==E.pending_buf_size||(E.gzhead.hcrc&&E.pending>w&&(d.adler=l(d.adler,E.pending_buf,E.pending-w,w)),O(d),w=E.pending,E.pending!==E.pending_buf_size));)oe(E,255&E.gzhead.extra[E.gzindex]),E.gzindex++;E.gzhead.hcrc&&E.pending>w&&(d.adler=l(d.adler,E.pending_buf,E.pending-w,w)),E.gzindex===E.gzhead.extra.length&&(E.gzindex=0,E.status=73)}else E.status=73;if(E.status===73)if(E.gzhead.name){w=E.pending;do{if(E.pending===E.pending_buf_size&&(E.gzhead.hcrc&&E.pending>w&&(d.adler=l(d.adler,E.pending_buf,E.pending-w,w)),O(d),w=E.pending,E.pending===E.pending_buf_size)){T=1;break}T=E.gzindex<E.gzhead.name.length?255&E.gzhead.name.charCodeAt(E.gzindex++):0,oe(E,T)}while(T!==0);E.gzhead.hcrc&&E.pending>w&&(d.adler=l(d.adler,E.pending_buf,E.pending-w,w)),T===0&&(E.gzindex=0,E.status=91)}else E.status=91;if(E.status===91)if(E.gzhead.comment){w=E.pending;do{if(E.pending===E.pending_buf_size&&(E.gzhead.hcrc&&E.pending>w&&(d.adler=l(d.adler,E.pending_buf,E.pending-w,w)),O(d),w=E.pending,E.pending===E.pending_buf_size)){T=1;break}T=E.gzindex<E.gzhead.comment.length?255&E.gzhead.comment.charCodeAt(E.gzindex++):0,oe(E,T)}while(T!==0);E.gzhead.hcrc&&E.pending>w&&(d.adler=l(d.adler,E.pending_buf,E.pending-w,w)),T===0&&(E.status=103)}else E.status=103;if(E.status===103&&(E.gzhead.hcrc?(E.pending+2>E.pending_buf_size&&O(d),E.pending+2<=E.pending_buf_size&&(oe(E,255&d.adler),oe(E,d.adler>>8&255),d.adler=0,E.status=z)):E.status=z),E.pending!==0){if(O(d),d.avail_out===0)return E.last_flush=-1,u}else if(d.avail_in===0&&V(P)<=V($)&&P!==m)return de(d,-5);if(E.status===666&&d.avail_in!==0)return de(d,-5);if(d.avail_in!==0||E.lookahead!==0||P!==h&&E.status!==666){var q=E.strategy===2?function(D,J){for(var te;;){if(D.lookahead===0&&(xe(D),D.lookahead===0)){if(J===h)return g;break}if(D.match_length=0,te=i._tr_tally(D,0,D.window[D.strstart]),D.lookahead--,D.strstart++,te&&(A(D,!1),D.strm.avail_out===0))return g}return D.insert=0,J===m?(A(D,!0),D.strm.avail_out===0?re:G):D.last_lit&&(A(D,!1),D.strm.avail_out===0)?g:F}(E,P):E.strategy===3?function(D,J){for(var te,Y,ae,we,fe=D.window;;){if(D.lookahead<=U){if(xe(D),D.lookahead<=U&&J===h)return g;if(D.lookahead===0)break}if(D.match_length=0,D.lookahead>=M&&0<D.strstart&&(Y=fe[ae=D.strstart-1])===fe[++ae]&&Y===fe[++ae]&&Y===fe[++ae]){we=D.strstart+U;do;while(Y===fe[++ae]&&Y===fe[++ae]&&Y===fe[++ae]&&Y===fe[++ae]&&Y===fe[++ae]&&Y===fe[++ae]&&Y===fe[++ae]&&Y===fe[++ae]&&ae<we);D.match_length=U-(we-ae),D.match_length>D.lookahead&&(D.match_length=D.lookahead)}if(D.match_length>=M?(te=i._tr_tally(D,1,D.match_length-M),D.lookahead-=D.match_length,D.strstart+=D.match_length,D.match_length=0):(te=i._tr_tally(D,0,D.window[D.strstart]),D.lookahead--,D.strstart++),te&&(A(D,!1),D.strm.avail_out===0))return g}return D.insert=0,J===m?(A(D,!0),D.strm.avail_out===0?re:G):D.last_lit&&(A(D,!1),D.strm.avail_out===0)?g:F}(E,P):n[E.level].func(E,P);if(q!==re&&q!==G||(E.status=666),q===g||q===re)return d.avail_out===0&&(E.last_flush=-1),u;if(q===F&&(P===1?i._tr_align(E):P!==5&&(i._tr_stored_block(E,0,0,!1),P===3&&(le(E.head),E.lookahead===0&&(E.strstart=0,E.block_start=0,E.insert=0))),O(d),d.avail_out===0))return E.last_flush=-1,u}return P!==m?u:E.wrap<=0?1:(E.wrap===2?(oe(E,255&d.adler),oe(E,d.adler>>8&255),oe(E,d.adler>>16&255),oe(E,d.adler>>24&255),oe(E,255&d.total_in),oe(E,d.total_in>>8&255),oe(E,d.total_in>>16&255),oe(E,d.total_in>>24&255)):(ee(E,d.adler>>>16),ee(E,65535&d.adler)),O(d),0<E.wrap&&(E.wrap=-E.wrap),E.pending!==0?u:1)},r.deflateEnd=function(d){var P;return d&&d.state?(P=d.state.status)!==I&&P!==69&&P!==73&&P!==91&&P!==103&&P!==z&&P!==666?de(d,y):(d.state=null,P===z?de(d,-3):u):y},r.deflateSetDictionary=function(d,P){var $,E,w,T,W,q,D,J,te=P.length;if(!d||!d.state||(T=($=d.state).wrap)===2||T===1&&$.status!==I||$.lookahead)return y;for(T===1&&(d.adler=o(d.adler,P,te,0)),$.wrap=0,te>=$.w_size&&(T===0&&(le($.head),$.strstart=0,$.block_start=0,$.insert=0),J=new a.Buf8($.w_size),a.arraySet(J,P,te-$.w_size,$.w_size,0),P=J,te=$.w_size),W=d.avail_in,q=d.next_in,D=d.input,d.avail_in=te,d.next_in=0,d.input=P,xe($);$.lookahead>=M;){for(E=$.strstart,w=$.lookahead-(M-1);$.ins_h=($.ins_h<<$.hash_shift^$.window[E+M-1])&$.hash_mask,$.prev[E&$.w_mask]=$.head[$.ins_h],$.head[$.ins_h]=E,E++,--w;);$.strstart=E,$.lookahead=M-1,xe($)}return $.strstart+=$.lookahead,$.block_start=$.strstart,$.insert=$.lookahead,$.lookahead=0,$.match_length=$.prev_length=M-1,$.match_available=0,d.next_in=q,d.input=D,d.avail_in=W,$.wrap=T,u},r.deflateInfo="pako deflate (from Nodeca project)"},{"../utils/common":41,"./adler32":43,"./crc32":45,"./messages":51,"./trees":52}],47:[function(t,c,r){c.exports=function(){this.text=0,this.time=0,this.xflags=0,this.os=0,this.extra=null,this.extra_len=0,this.name="",this.comment="",this.hcrc=0,this.done=!1}},{}],48:[function(t,c,r){c.exports=function(n,a){var i,o,l,f,h,m,u,y,p,b,v,C,S,_,k,x,L,B,M,U,Q,I,z,g,F;i=n.state,o=n.next_in,g=n.input,l=o+(n.avail_in-5),f=n.next_out,F=n.output,h=f-(a-n.avail_out),m=f+(n.avail_out-257),u=i.dmax,y=i.wsize,p=i.whave,b=i.wnext,v=i.window,C=i.hold,S=i.bits,_=i.lencode,k=i.distcode,x=(1<<i.lenbits)-1,L=(1<<i.distbits)-1;e:do{S<15&&(C+=g[o++]<<S,S+=8,C+=g[o++]<<S,S+=8),B=_[C&x];t:for(;;){if(C>>>=M=B>>>24,S-=M,(M=B>>>16&255)===0)F[f++]=65535&B;else{if(!(16&M)){if(!(64&M)){B=_[(65535&B)+(C&(1<<M)-1)];continue t}if(32&M){i.mode=12;break e}n.msg="invalid literal/length code",i.mode=30;break e}U=65535&B,(M&=15)&&(S<M&&(C+=g[o++]<<S,S+=8),U+=C&(1<<M)-1,C>>>=M,S-=M),S<15&&(C+=g[o++]<<S,S+=8,C+=g[o++]<<S,S+=8),B=k[C&L];n:for(;;){if(C>>>=M=B>>>24,S-=M,!(16&(M=B>>>16&255))){if(!(64&M)){B=k[(65535&B)+(C&(1<<M)-1)];continue n}n.msg="invalid distance code",i.mode=30;break e}if(Q=65535&B,S<(M&=15)&&(C+=g[o++]<<S,(S+=8)<M&&(C+=g[o++]<<S,S+=8)),u<(Q+=C&(1<<M)-1)){n.msg="invalid distance too far back",i.mode=30;break e}if(C>>>=M,S-=M,(M=f-h)<Q){if(p<(M=Q-M)&&i.sane){n.msg="invalid distance too far back",i.mode=30;break e}if(z=v,(I=0)===b){if(I+=y-M,M<U){for(U-=M;F[f++]=v[I++],--M;);I=f-Q,z=F}}else if(b<M){if(I+=y+b-M,(M-=b)<U){for(U-=M;F[f++]=v[I++],--M;);if(I=0,b<U){for(U-=M=b;F[f++]=v[I++],--M;);I=f-Q,z=F}}}else if(I+=b-M,M<U){for(U-=M;F[f++]=v[I++],--M;);I=f-Q,z=F}for(;2<U;)F[f++]=z[I++],F[f++]=z[I++],F[f++]=z[I++],U-=3;U&&(F[f++]=z[I++],1<U&&(F[f++]=z[I++]))}else{for(I=f-Q;F[f++]=F[I++],F[f++]=F[I++],F[f++]=F[I++],2<(U-=3););U&&(F[f++]=F[I++],1<U&&(F[f++]=F[I++]))}break}}break}}while(o<l&&f<m);o-=U=S>>3,C&=(1<<(S-=U<<3))-1,n.next_in=o,n.next_out=f,n.avail_in=o<l?l-o+5:5-(o-l),n.avail_out=f<m?m-f+257:257-(f-m),i.hold=C,i.bits=S}},{}],49:[function(t,c,r){var n=t("../utils/common"),a=t("./adler32"),i=t("./crc32"),o=t("./inffast"),l=t("./inftrees"),f=1,h=2,m=0,u=-2,y=1,p=852,b=592;function v(I){return(I>>>24&255)+(I>>>8&65280)+((65280&I)<<8)+((255&I)<<24)}function C(){this.mode=0,this.last=!1,this.wrap=0,this.havedict=!1,this.flags=0,this.dmax=0,this.check=0,this.total=0,this.head=null,this.wbits=0,this.wsize=0,this.whave=0,this.wnext=0,this.window=null,this.hold=0,this.bits=0,this.length=0,this.offset=0,this.extra=0,this.lencode=null,this.distcode=null,this.lenbits=0,this.distbits=0,this.ncode=0,this.nlen=0,this.ndist=0,this.have=0,this.next=null,this.lens=new n.Buf16(320),this.work=new n.Buf16(288),this.lendyn=null,this.distdyn=null,this.sane=0,this.back=0,this.was=0}function S(I){var z;return I&&I.state?(z=I.state,I.total_in=I.total_out=z.total=0,I.msg="",z.wrap&&(I.adler=1&z.wrap),z.mode=y,z.last=0,z.havedict=0,z.dmax=32768,z.head=null,z.hold=0,z.bits=0,z.lencode=z.lendyn=new n.Buf32(p),z.distcode=z.distdyn=new n.Buf32(b),z.sane=1,z.back=-1,m):u}function _(I){var z;return I&&I.state?((z=I.state).wsize=0,z.whave=0,z.wnext=0,S(I)):u}function k(I,z){var g,F;return I&&I.state?(F=I.state,z<0?(g=0,z=-z):(g=1+(z>>4),z<48&&(z&=15)),z&&(z<8||15<z)?u:(F.window!==null&&F.wbits!==z&&(F.window=null),F.wrap=g,F.wbits=z,_(I))):u}function x(I,z){var g,F;return I?(F=new C,(I.state=F).window=null,(g=k(I,z))!==m&&(I.state=null),g):u}var L,B,M=!0;function U(I){if(M){var z;for(L=new n.Buf32(512),B=new n.Buf32(32),z=0;z<144;)I.lens[z++]=8;for(;z<256;)I.lens[z++]=9;for(;z<280;)I.lens[z++]=7;for(;z<288;)I.lens[z++]=8;for(l(f,I.lens,0,288,L,0,I.work,{bits:9}),z=0;z<32;)I.lens[z++]=5;l(h,I.lens,0,32,B,0,I.work,{bits:5}),M=!1}I.lencode=L,I.lenbits=9,I.distcode=B,I.distbits=5}function Q(I,z,g,F){var re,G=I.state;return G.window===null&&(G.wsize=1<<G.wbits,G.wnext=0,G.whave=0,G.window=new n.Buf8(G.wsize)),F>=G.wsize?(n.arraySet(G.window,z,g-G.wsize,G.wsize,0),G.wnext=0,G.whave=G.wsize):(F<(re=G.wsize-G.wnext)&&(re=F),n.arraySet(G.window,z,g-F,re,G.wnext),(F-=re)?(n.arraySet(G.window,z,g-F,F,0),G.wnext=F,G.whave=G.wsize):(G.wnext+=re,G.wnext===G.wsize&&(G.wnext=0),G.whave<G.wsize&&(G.whave+=re))),0}r.inflateReset=_,r.inflateReset2=k,r.inflateResetKeep=S,r.inflateInit=function(I){return x(I,15)},r.inflateInit2=x,r.inflate=function(I,z){var g,F,re,G,de,V,le,O,A,oe,ee,X,xe,Me,he,ve,Oe,Ne,Ze,Ve,d,P,$,E,w=0,T=new n.Buf8(4),W=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15];if(!I||!I.state||!I.output||!I.input&&I.avail_in!==0)return u;(g=I.state).mode===12&&(g.mode=13),de=I.next_out,re=I.output,le=I.avail_out,G=I.next_in,F=I.input,V=I.avail_in,O=g.hold,A=g.bits,oe=V,ee=le,P=m;e:for(;;)switch(g.mode){case y:if(g.wrap===0){g.mode=13;break}for(;A<16;){if(V===0)break e;V--,O+=F[G++]<<A,A+=8}if(2&g.wrap&&O===35615){T[g.check=0]=255&O,T[1]=O>>>8&255,g.check=i(g.check,T,2,0),A=O=0,g.mode=2;break}if(g.flags=0,g.head&&(g.head.done=!1),!(1&g.wrap)||(((255&O)<<8)+(O>>8))%31){I.msg="incorrect header check",g.mode=30;break}if((15&O)!=8){I.msg="unknown compression method",g.mode=30;break}if(A-=4,d=8+(15&(O>>>=4)),g.wbits===0)g.wbits=d;else if(d>g.wbits){I.msg="invalid window size",g.mode=30;break}g.dmax=1<<d,I.adler=g.check=1,g.mode=512&O?10:12,A=O=0;break;case 2:for(;A<16;){if(V===0)break e;V--,O+=F[G++]<<A,A+=8}if(g.flags=O,(255&g.flags)!=8){I.msg="unknown compression method",g.mode=30;break}if(57344&g.flags){I.msg="unknown header flags set",g.mode=30;break}g.head&&(g.head.text=O>>8&1),512&g.flags&&(T[0]=255&O,T[1]=O>>>8&255,g.check=i(g.check,T,2,0)),A=O=0,g.mode=3;case 3:for(;A<32;){if(V===0)break e;V--,O+=F[G++]<<A,A+=8}g.head&&(g.head.time=O),512&g.flags&&(T[0]=255&O,T[1]=O>>>8&255,T[2]=O>>>16&255,T[3]=O>>>24&255,g.check=i(g.check,T,4,0)),A=O=0,g.mode=4;case 4:for(;A<16;){if(V===0)break e;V--,O+=F[G++]<<A,A+=8}g.head&&(g.head.xflags=255&O,g.head.os=O>>8),512&g.flags&&(T[0]=255&O,T[1]=O>>>8&255,g.check=i(g.check,T,2,0)),A=O=0,g.mode=5;case 5:if(1024&g.flags){for(;A<16;){if(V===0)break e;V--,O+=F[G++]<<A,A+=8}g.length=O,g.head&&(g.head.extra_len=O),512&g.flags&&(T[0]=255&O,T[1]=O>>>8&255,g.check=i(g.check,T,2,0)),A=O=0}else g.head&&(g.head.extra=null);g.mode=6;case 6:if(1024&g.flags&&(V<(X=g.length)&&(X=V),X&&(g.head&&(d=g.head.extra_len-g.length,g.head.extra||(g.head.extra=new Array(g.head.extra_len)),n.arraySet(g.head.extra,F,G,X,d)),512&g.flags&&(g.check=i(g.check,F,X,G)),V-=X,G+=X,g.length-=X),g.length))break e;g.length=0,g.mode=7;case 7:if(2048&g.flags){if(V===0)break e;for(X=0;d=F[G+X++],g.head&&d&&g.length<65536&&(g.head.name+=String.fromCharCode(d)),d&&X<V;);if(512&g.flags&&(g.check=i(g.check,F,X,G)),V-=X,G+=X,d)break e}else g.head&&(g.head.name=null);g.length=0,g.mode=8;case 8:if(4096&g.flags){if(V===0)break e;for(X=0;d=F[G+X++],g.head&&d&&g.length<65536&&(g.head.comment+=String.fromCharCode(d)),d&&X<V;);if(512&g.flags&&(g.check=i(g.check,F,X,G)),V-=X,G+=X,d)break e}else g.head&&(g.head.comment=null);g.mode=9;case 9:if(512&g.flags){for(;A<16;){if(V===0)break e;V--,O+=F[G++]<<A,A+=8}if(O!==(65535&g.check)){I.msg="header crc mismatch",g.mode=30;break}A=O=0}g.head&&(g.head.hcrc=g.flags>>9&1,g.head.done=!0),I.adler=g.check=0,g.mode=12;break;case 10:for(;A<32;){if(V===0)break e;V--,O+=F[G++]<<A,A+=8}I.adler=g.check=v(O),A=O=0,g.mode=11;case 11:if(g.havedict===0)return I.next_out=de,I.avail_out=le,I.next_in=G,I.avail_in=V,g.hold=O,g.bits=A,2;I.adler=g.check=1,g.mode=12;case 12:if(z===5||z===6)break e;case 13:if(g.last){O>>>=7&A,A-=7&A,g.mode=27;break}for(;A<3;){if(V===0)break e;V--,O+=F[G++]<<A,A+=8}switch(g.last=1&O,A-=1,3&(O>>>=1)){case 0:g.mode=14;break;case 1:if(U(g),g.mode=20,z!==6)break;O>>>=2,A-=2;break e;case 2:g.mode=17;break;case 3:I.msg="invalid block type",g.mode=30}O>>>=2,A-=2;break;case 14:for(O>>>=7&A,A-=7&A;A<32;){if(V===0)break e;V--,O+=F[G++]<<A,A+=8}if((65535&O)!=(O>>>16^65535)){I.msg="invalid stored block lengths",g.mode=30;break}if(g.length=65535&O,A=O=0,g.mode=15,z===6)break e;case 15:g.mode=16;case 16:if(X=g.length){if(V<X&&(X=V),le<X&&(X=le),X===0)break e;n.arraySet(re,F,G,X,de),V-=X,G+=X,le-=X,de+=X,g.length-=X;break}g.mode=12;break;case 17:for(;A<14;){if(V===0)break e;V--,O+=F[G++]<<A,A+=8}if(g.nlen=257+(31&O),O>>>=5,A-=5,g.ndist=1+(31&O),O>>>=5,A-=5,g.ncode=4+(15&O),O>>>=4,A-=4,286<g.nlen||30<g.ndist){I.msg="too many length or distance symbols",g.mode=30;break}g.have=0,g.mode=18;case 18:for(;g.have<g.ncode;){for(;A<3;){if(V===0)break e;V--,O+=F[G++]<<A,A+=8}g.lens[W[g.have++]]=7&O,O>>>=3,A-=3}for(;g.have<19;)g.lens[W[g.have++]]=0;if(g.lencode=g.lendyn,g.lenbits=7,$={bits:g.lenbits},P=l(0,g.lens,0,19,g.lencode,0,g.work,$),g.lenbits=$.bits,P){I.msg="invalid code lengths set",g.mode=30;break}g.have=0,g.mode=19;case 19:for(;g.have<g.nlen+g.ndist;){for(;ve=(w=g.lencode[O&(1<<g.lenbits)-1])>>>16&255,Oe=65535&w,!((he=w>>>24)<=A);){if(V===0)break e;V--,O+=F[G++]<<A,A+=8}if(Oe<16)O>>>=he,A-=he,g.lens[g.have++]=Oe;else{if(Oe===16){for(E=he+2;A<E;){if(V===0)break e;V--,O+=F[G++]<<A,A+=8}if(O>>>=he,A-=he,g.have===0){I.msg="invalid bit length repeat",g.mode=30;break}d=g.lens[g.have-1],X=3+(3&O),O>>>=2,A-=2}else if(Oe===17){for(E=he+3;A<E;){if(V===0)break e;V--,O+=F[G++]<<A,A+=8}A-=he,d=0,X=3+(7&(O>>>=he)),O>>>=3,A-=3}else{for(E=he+7;A<E;){if(V===0)break e;V--,O+=F[G++]<<A,A+=8}A-=he,d=0,X=11+(127&(O>>>=he)),O>>>=7,A-=7}if(g.have+X>g.nlen+g.ndist){I.msg="invalid bit length repeat",g.mode=30;break}for(;X--;)g.lens[g.have++]=d}}if(g.mode===30)break;if(g.lens[256]===0){I.msg="invalid code -- missing end-of-block",g.mode=30;break}if(g.lenbits=9,$={bits:g.lenbits},P=l(f,g.lens,0,g.nlen,g.lencode,0,g.work,$),g.lenbits=$.bits,P){I.msg="invalid literal/lengths set",g.mode=30;break}if(g.distbits=6,g.distcode=g.distdyn,$={bits:g.distbits},P=l(h,g.lens,g.nlen,g.ndist,g.distcode,0,g.work,$),g.distbits=$.bits,P){I.msg="invalid distances set",g.mode=30;break}if(g.mode=20,z===6)break e;case 20:g.mode=21;case 21:if(6<=V&&258<=le){I.next_out=de,I.avail_out=le,I.next_in=G,I.avail_in=V,g.hold=O,g.bits=A,o(I,ee),de=I.next_out,re=I.output,le=I.avail_out,G=I.next_in,F=I.input,V=I.avail_in,O=g.hold,A=g.bits,g.mode===12&&(g.back=-1);break}for(g.back=0;ve=(w=g.lencode[O&(1<<g.lenbits)-1])>>>16&255,Oe=65535&w,!((he=w>>>24)<=A);){if(V===0)break e;V--,O+=F[G++]<<A,A+=8}if(ve&&!(240&ve)){for(Ne=he,Ze=ve,Ve=Oe;ve=(w=g.lencode[Ve+((O&(1<<Ne+Ze)-1)>>Ne)])>>>16&255,Oe=65535&w,!(Ne+(he=w>>>24)<=A);){if(V===0)break e;V--,O+=F[G++]<<A,A+=8}O>>>=Ne,A-=Ne,g.back+=Ne}if(O>>>=he,A-=he,g.back+=he,g.length=Oe,ve===0){g.mode=26;break}if(32&ve){g.back=-1,g.mode=12;break}if(64&ve){I.msg="invalid literal/length code",g.mode=30;break}g.extra=15&ve,g.mode=22;case 22:if(g.extra){for(E=g.extra;A<E;){if(V===0)break e;V--,O+=F[G++]<<A,A+=8}g.length+=O&(1<<g.extra)-1,O>>>=g.extra,A-=g.extra,g.back+=g.extra}g.was=g.length,g.mode=23;case 23:for(;ve=(w=g.distcode[O&(1<<g.distbits)-1])>>>16&255,Oe=65535&w,!((he=w>>>24)<=A);){if(V===0)break e;V--,O+=F[G++]<<A,A+=8}if(!(240&ve)){for(Ne=he,Ze=ve,Ve=Oe;ve=(w=g.distcode[Ve+((O&(1<<Ne+Ze)-1)>>Ne)])>>>16&255,Oe=65535&w,!(Ne+(he=w>>>24)<=A);){if(V===0)break e;V--,O+=F[G++]<<A,A+=8}O>>>=Ne,A-=Ne,g.back+=Ne}if(O>>>=he,A-=he,g.back+=he,64&ve){I.msg="invalid distance code",g.mode=30;break}g.offset=Oe,g.extra=15&ve,g.mode=24;case 24:if(g.extra){for(E=g.extra;A<E;){if(V===0)break e;V--,O+=F[G++]<<A,A+=8}g.offset+=O&(1<<g.extra)-1,O>>>=g.extra,A-=g.extra,g.back+=g.extra}if(g.offset>g.dmax){I.msg="invalid distance too far back",g.mode=30;break}g.mode=25;case 25:if(le===0)break e;if(X=ee-le,g.offset>X){if((X=g.offset-X)>g.whave&&g.sane){I.msg="invalid distance too far back",g.mode=30;break}xe=X>g.wnext?(X-=g.wnext,g.wsize-X):g.wnext-X,X>g.length&&(X=g.length),Me=g.window}else Me=re,xe=de-g.offset,X=g.length;for(le<X&&(X=le),le-=X,g.length-=X;re[de++]=Me[xe++],--X;);g.length===0&&(g.mode=21);break;case 26:if(le===0)break e;re[de++]=g.length,le--,g.mode=21;break;case 27:if(g.wrap){for(;A<32;){if(V===0)break e;V--,O|=F[G++]<<A,A+=8}if(ee-=le,I.total_out+=ee,g.total+=ee,ee&&(I.adler=g.check=g.flags?i(g.check,re,ee,de-ee):a(g.check,re,ee,de-ee)),ee=le,(g.flags?O:v(O))!==g.check){I.msg="incorrect data check",g.mode=30;break}A=O=0}g.mode=28;case 28:if(g.wrap&&g.flags){for(;A<32;){if(V===0)break e;V--,O+=F[G++]<<A,A+=8}if(O!==(4294967295&g.total)){I.msg="incorrect length check",g.mode=30;break}A=O=0}g.mode=29;case 29:P=1;break e;case 30:P=-3;break e;case 31:return-4;case 32:default:return u}return I.next_out=de,I.avail_out=le,I.next_in=G,I.avail_in=V,g.hold=O,g.bits=A,(g.wsize||ee!==I.avail_out&&g.mode<30&&(g.mode<27||z!==4))&&Q(I,I.output,I.next_out,ee-I.avail_out)?(g.mode=31,-4):(oe-=I.avail_in,ee-=I.avail_out,I.total_in+=oe,I.total_out+=ee,g.total+=ee,g.wrap&&ee&&(I.adler=g.check=g.flags?i(g.check,re,ee,I.next_out-ee):a(g.check,re,ee,I.next_out-ee)),I.data_type=g.bits+(g.last?64:0)+(g.mode===12?128:0)+(g.mode===20||g.mode===15?256:0),(oe==0&&ee===0||z===4)&&P===m&&(P=-5),P)},r.inflateEnd=function(I){if(!I||!I.state)return u;var z=I.state;return z.window&&(z.window=null),I.state=null,m},r.inflateGetHeader=function(I,z){var g;return I&&I.state&&2&(g=I.state).wrap?((g.head=z).done=!1,m):u},r.inflateSetDictionary=function(I,z){var g,F=z.length;return I&&I.state?(g=I.state).wrap!==0&&g.mode!==11?u:g.mode===11&&a(1,z,F,0)!==g.check?-3:Q(I,z,F,F)?(g.mode=31,-4):(g.havedict=1,m):u},r.inflateInfo="pako inflate (from Nodeca project)"},{"../utils/common":41,"./adler32":43,"./crc32":45,"./inffast":48,"./inftrees":50}],50:[function(t,c,r){var n=t("../utils/common"),a=[3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0],i=[16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78],o=[1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0],l=[16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64];c.exports=function(f,h,m,u,y,p,b,v){var C,S,_,k,x,L,B,M,U,Q=v.bits,I=0,z=0,g=0,F=0,re=0,G=0,de=0,V=0,le=0,O=0,A=null,oe=0,ee=new n.Buf16(16),X=new n.Buf16(16),xe=null,Me=0;for(I=0;I<=15;I++)ee[I]=0;for(z=0;z<u;z++)ee[h[m+z]]++;for(re=Q,F=15;1<=F&&ee[F]===0;F--);if(F<re&&(re=F),F===0)return y[p++]=20971520,y[p++]=20971520,v.bits=1,0;for(g=1;g<F&&ee[g]===0;g++);for(re<g&&(re=g),I=V=1;I<=15;I++)if(V<<=1,(V-=ee[I])<0)return-1;if(0<V&&(f===0||F!==1))return-1;for(X[1]=0,I=1;I<15;I++)X[I+1]=X[I]+ee[I];for(z=0;z<u;z++)h[m+z]!==0&&(b[X[h[m+z]]++]=z);if(L=f===0?(A=xe=b,19):f===1?(A=a,oe-=257,xe=i,Me-=257,256):(A=o,xe=l,-1),I=g,x=p,de=z=O=0,_=-1,k=(le=1<<(G=re))-1,f===1&&852<le||f===2&&592<le)return 1;for(;;){for(B=I-de,U=b[z]<L?(M=0,b[z]):b[z]>L?(M=xe[Me+b[z]],A[oe+b[z]]):(M=96,0),C=1<<I-de,g=S=1<<G;y[x+(O>>de)+(S-=C)]=B<<24|M<<16|U|0,S!==0;);for(C=1<<I-1;O&C;)C>>=1;if(C!==0?(O&=C-1,O+=C):O=0,z++,--ee[I]==0){if(I===F)break;I=h[m+b[z]]}if(re<I&&(O&k)!==_){for(de===0&&(de=re),x+=g,V=1<<(G=I-de);G+de<F&&!((V-=ee[G+de])<=0);)G++,V<<=1;if(le+=1<<G,f===1&&852<le||f===2&&592<le)return 1;y[_=O&k]=re<<24|G<<16|x-p|0}}return O!==0&&(y[x+O]=I-de<<24|64<<16|0),v.bits=re,0}},{"../utils/common":41}],51:[function(t,c,r){c.exports={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"}},{}],52:[function(t,c,r){var n=t("../utils/common"),a=0,i=1;function o(w){for(var T=w.length;0<=--T;)w[T]=0}var l=0,f=29,h=256,m=h+1+f,u=30,y=19,p=2*m+1,b=15,v=16,C=7,S=256,_=16,k=17,x=18,L=[0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0],B=[0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13],M=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,3,7],U=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15],Q=new Array(2*(m+2));o(Q);var I=new Array(2*u);o(I);var z=new Array(512);o(z);var g=new Array(256);o(g);var F=new Array(f);o(F);var re,G,de,V=new Array(u);function le(w,T,W,q,D){this.static_tree=w,this.extra_bits=T,this.extra_base=W,this.elems=q,this.max_length=D,this.has_stree=w&&w.length}function O(w,T){this.dyn_tree=w,this.max_code=0,this.stat_desc=T}function A(w){return w<256?z[w]:z[256+(w>>>7)]}function oe(w,T){w.pending_buf[w.pending++]=255&T,w.pending_buf[w.pending++]=T>>>8&255}function ee(w,T,W){w.bi_valid>v-W?(w.bi_buf|=T<<w.bi_valid&65535,oe(w,w.bi_buf),w.bi_buf=T>>v-w.bi_valid,w.bi_valid+=W-v):(w.bi_buf|=T<<w.bi_valid&65535,w.bi_valid+=W)}function X(w,T,W){ee(w,W[2*T],W[2*T+1])}function xe(w,T){for(var W=0;W|=1&w,w>>>=1,W<<=1,0<--T;);return W>>>1}function Me(w,T,W){var q,D,J=new Array(b+1),te=0;for(q=1;q<=b;q++)J[q]=te=te+W[q-1]<<1;for(D=0;D<=T;D++){var Y=w[2*D+1];Y!==0&&(w[2*D]=xe(J[Y]++,Y))}}function he(w){var T;for(T=0;T<m;T++)w.dyn_ltree[2*T]=0;for(T=0;T<u;T++)w.dyn_dtree[2*T]=0;for(T=0;T<y;T++)w.bl_tree[2*T]=0;w.dyn_ltree[2*S]=1,w.opt_len=w.static_len=0,w.last_lit=w.matches=0}function ve(w){8<w.bi_valid?oe(w,w.bi_buf):0<w.bi_valid&&(w.pending_buf[w.pending++]=w.bi_buf),w.bi_buf=0,w.bi_valid=0}function Oe(w,T,W,q){var D=2*T,J=2*W;return w[D]<w[J]||w[D]===w[J]&&q[T]<=q[W]}function Ne(w,T,W){for(var q=w.heap[W],D=W<<1;D<=w.heap_len&&(D<w.heap_len&&Oe(T,w.heap[D+1],w.heap[D],w.depth)&&D++,!Oe(T,q,w.heap[D],w.depth));)w.heap[W]=w.heap[D],W=D,D<<=1;w.heap[W]=q}function Ze(w,T,W){var q,D,J,te,Y=0;if(w.last_lit!==0)for(;q=w.pending_buf[w.d_buf+2*Y]<<8|w.pending_buf[w.d_buf+2*Y+1],D=w.pending_buf[w.l_buf+Y],Y++,q===0?X(w,D,T):(X(w,(J=g[D])+h+1,T),(te=L[J])!==0&&ee(w,D-=F[J],te),X(w,J=A(--q),W),(te=B[J])!==0&&ee(w,q-=V[J],te)),Y<w.last_lit;);X(w,S,T)}function Ve(w,T){var W,q,D,J=T.dyn_tree,te=T.stat_desc.static_tree,Y=T.stat_desc.has_stree,ae=T.stat_desc.elems,we=-1;for(w.heap_len=0,w.heap_max=p,W=0;W<ae;W++)J[2*W]!==0?(w.heap[++w.heap_len]=we=W,w.depth[W]=0):J[2*W+1]=0;for(;w.heap_len<2;)J[2*(D=w.heap[++w.heap_len]=we<2?++we:0)]=1,w.depth[D]=0,w.opt_len--,Y&&(w.static_len-=te[2*D+1]);for(T.max_code=we,W=w.heap_len>>1;1<=W;W--)Ne(w,J,W);for(D=ae;W=w.heap[1],w.heap[1]=w.heap[w.heap_len--],Ne(w,J,1),q=w.heap[1],w.heap[--w.heap_max]=W,w.heap[--w.heap_max]=q,J[2*D]=J[2*W]+J[2*q],w.depth[D]=(w.depth[W]>=w.depth[q]?w.depth[W]:w.depth[q])+1,J[2*W+1]=J[2*q+1]=D,w.heap[1]=D++,Ne(w,J,1),2<=w.heap_len;);w.heap[--w.heap_max]=w.heap[1],function(fe,Je){var wt,Ke,Tt,Te,Pt,Ft,nt=Je.dyn_tree,en=Je.max_code,Tn=Je.stat_desc.static_tree,Bn=Je.stat_desc.has_stree,R=Je.stat_desc.extra_bits,Z=Je.stat_desc.extra_base,H=Je.stat_desc.max_length,ne=0;for(Te=0;Te<=b;Te++)fe.bl_count[Te]=0;for(nt[2*fe.heap[fe.heap_max]+1]=0,wt=fe.heap_max+1;wt<p;wt++)H<(Te=nt[2*nt[2*(Ke=fe.heap[wt])+1]+1]+1)&&(Te=H,ne++),nt[2*Ke+1]=Te,en<Ke||(fe.bl_count[Te]++,Pt=0,Z<=Ke&&(Pt=R[Ke-Z]),Ft=nt[2*Ke],fe.opt_len+=Ft*(Te+Pt),Bn&&(fe.static_len+=Ft*(Tn[2*Ke+1]+Pt)));if(ne!==0){do{for(Te=H-1;fe.bl_count[Te]===0;)Te--;fe.bl_count[Te]--,fe.bl_count[Te+1]+=2,fe.bl_count[H]--,ne-=2}while(0<ne);for(Te=H;Te!==0;Te--)for(Ke=fe.bl_count[Te];Ke!==0;)en<(Tt=fe.heap[--wt])||(nt[2*Tt+1]!==Te&&(fe.opt_len+=(Te-nt[2*Tt+1])*nt[2*Tt],nt[2*Tt+1]=Te),Ke--)}}(w,T),Me(J,we,w.bl_count)}function d(w,T,W){var q,D,J=-1,te=T[1],Y=0,ae=7,we=4;for(te===0&&(ae=138,we=3),T[2*(W+1)+1]=65535,q=0;q<=W;q++)D=te,te=T[2*(q+1)+1],++Y<ae&&D===te||(Y<we?w.bl_tree[2*D]+=Y:D!==0?(D!==J&&w.bl_tree[2*D]++,w.bl_tree[2*_]++):Y<=10?w.bl_tree[2*k]++:w.bl_tree[2*x]++,J=D,we=(Y=0)===te?(ae=138,3):D===te?(ae=6,3):(ae=7,4))}function P(w,T,W){var q,D,J=-1,te=T[1],Y=0,ae=7,we=4;for(te===0&&(ae=138,we=3),q=0;q<=W;q++)if(D=te,te=T[2*(q+1)+1],!(++Y<ae&&D===te)){if(Y<we)for(;X(w,D,w.bl_tree),--Y!=0;);else D!==0?(D!==J&&(X(w,D,w.bl_tree),Y--),X(w,_,w.bl_tree),ee(w,Y-3,2)):Y<=10?(X(w,k,w.bl_tree),ee(w,Y-3,3)):(X(w,x,w.bl_tree),ee(w,Y-11,7));J=D,we=(Y=0)===te?(ae=138,3):D===te?(ae=6,3):(ae=7,4)}}o(V);var $=!1;function E(w,T,W,q){ee(w,(l<<1)+(q?1:0),3),function(D,J,te,Y){ve(D),oe(D,te),oe(D,~te),n.arraySet(D.pending_buf,D.window,J,te,D.pending),D.pending+=te}(w,T,W)}r._tr_init=function(w){$||(function(){var T,W,q,D,J,te=new Array(b+1);for(D=q=0;D<f-1;D++)for(F[D]=q,T=0;T<1<<L[D];T++)g[q++]=D;for(g[q-1]=D,D=J=0;D<16;D++)for(V[D]=J,T=0;T<1<<B[D];T++)z[J++]=D;for(J>>=7;D<u;D++)for(V[D]=J<<7,T=0;T<1<<B[D]-7;T++)z[256+J++]=D;for(W=0;W<=b;W++)te[W]=0;for(T=0;T<=143;)Q[2*T+1]=8,T++,te[8]++;for(;T<=255;)Q[2*T+1]=9,T++,te[9]++;for(;T<=279;)Q[2*T+1]=7,T++,te[7]++;for(;T<=287;)Q[2*T+1]=8,T++,te[8]++;for(Me(Q,m+1,te),T=0;T<u;T++)I[2*T+1]=5,I[2*T]=xe(T,5);re=new le(Q,L,h+1,m,b),G=new le(I,B,0,u,b),de=new le(new Array(0),M,0,y,C)}(),$=!0),w.l_desc=new O(w.dyn_ltree,re),w.d_desc=new O(w.dyn_dtree,G),w.bl_desc=new O(w.bl_tree,de),w.bi_buf=0,w.bi_valid=0,he(w)},r._tr_stored_block=E,r._tr_flush_block=function(w,T,W,q){var D,J,te=0;0<w.level?(w.strm.data_type===2&&(w.strm.data_type=function(Y){var ae,we=4093624447;for(ae=0;ae<=31;ae++,we>>>=1)if(1&we&&Y.dyn_ltree[2*ae]!==0)return a;if(Y.dyn_ltree[18]!==0||Y.dyn_ltree[20]!==0||Y.dyn_ltree[26]!==0)return i;for(ae=32;ae<h;ae++)if(Y.dyn_ltree[2*ae]!==0)return i;return a}(w)),Ve(w,w.l_desc),Ve(w,w.d_desc),te=function(Y){var ae;for(d(Y,Y.dyn_ltree,Y.l_desc.max_code),d(Y,Y.dyn_dtree,Y.d_desc.max_code),Ve(Y,Y.bl_desc),ae=y-1;3<=ae&&Y.bl_tree[2*U[ae]+1]===0;ae--);return Y.opt_len+=3*(ae+1)+5+5+4,ae}(w),D=w.opt_len+3+7>>>3,(J=w.static_len+3+7>>>3)<=D&&(D=J)):D=J=W+5,W+4<=D&&T!==-1?E(w,T,W,q):w.strategy===4||J===D?(ee(w,2+(q?1:0),3),Ze(w,Q,I)):(ee(w,4+(q?1:0),3),function(Y,ae,we,fe){var Je;for(ee(Y,ae-257,5),ee(Y,we-1,5),ee(Y,fe-4,4),Je=0;Je<fe;Je++)ee(Y,Y.bl_tree[2*U[Je]+1],3);P(Y,Y.dyn_ltree,ae-1),P(Y,Y.dyn_dtree,we-1)}(w,w.l_desc.max_code+1,w.d_desc.max_code+1,te+1),Ze(w,w.dyn_ltree,w.dyn_dtree)),he(w),q&&ve(w)},r._tr_tally=function(w,T,W){return w.pending_buf[w.d_buf+2*w.last_lit]=T>>>8&255,w.pending_buf[w.d_buf+2*w.last_lit+1]=255&T,w.pending_buf[w.l_buf+w.last_lit]=255&W,w.last_lit++,T===0?w.dyn_ltree[2*W]++:(w.matches++,T--,w.dyn_ltree[2*(g[W]+h+1)]++,w.dyn_dtree[2*A(T)]++),w.last_lit===w.lit_bufsize-1},r._tr_align=function(w){ee(w,2,3),X(w,S,Q),function(T){T.bi_valid===16?(oe(T,T.bi_buf),T.bi_buf=0,T.bi_valid=0):8<=T.bi_valid&&(T.pending_buf[T.pending++]=255&T.bi_buf,T.bi_buf>>=8,T.bi_valid-=8)}(w)}},{"../utils/common":41}],53:[function(t,c,r){c.exports=function(){this.input=null,this.next_in=0,this.avail_in=0,this.total_in=0,this.output=null,this.next_out=0,this.avail_out=0,this.total_out=0,this.msg="",this.state=null,this.data_type=2,this.adler=0}},{}],54:[function(t,c,r){(function(n){(function(a,i){if(!a.setImmediate){var o,l,f,h,m=1,u={},y=!1,p=a.document,b=Object.getPrototypeOf&&Object.getPrototypeOf(a);b=b&&b.setTimeout?b:a,o={}.toString.call(a.process)==="[object process]"?function(_){process.nextTick(function(){C(_)})}:function(){if(a.postMessage&&!a.importScripts){var _=!0,k=a.onmessage;return a.onmessage=function(){_=!1},a.postMessage("","*"),a.onmessage=k,_}}()?(h="setImmediate$"+Math.random()+"$",a.addEventListener?a.addEventListener("message",S,!1):a.attachEvent("onmessage",S),function(_){a.postMessage(h+_,"*")}):a.MessageChannel?((f=new MessageChannel).port1.onmessage=function(_){C(_.data)},function(_){f.port2.postMessage(_)}):p&&"onreadystatechange"in p.createElement("script")?(l=p.documentElement,function(_){var k=p.createElement("script");k.onreadystatechange=function(){C(_),k.onreadystatechange=null,l.removeChild(k),k=null},l.appendChild(k)}):function(_){setTimeout(C,0,_)},b.setImmediate=function(_){typeof _!="function"&&(_=new Function(""+_));for(var k=new Array(arguments.length-1),x=0;x<k.length;x++)k[x]=arguments[x+1];var L={callback:_,args:k};return u[m]=L,o(m),m++},b.clearImmediate=v}function v(_){delete u[_]}function C(_){if(y)setTimeout(C,0,_);else{var k=u[_];if(k){y=!0;try{(function(x){var L=x.callback,B=x.args;switch(B.length){case 0:L();break;case 1:L(B[0]);break;case 2:L(B[0],B[1]);break;case 3:L(B[0],B[1],B[2]);break;default:L.apply(i,B)}})(k)}finally{v(_),y=!1}}}}function S(_){_.source===a&&typeof _.data=="string"&&_.data.indexOf(h)===0&&C(+_.data.slice(h.length))}})(typeof self>"u"?n===void 0?this:n:self)}).call(this,typeof Dn<"u"?Dn:typeof self<"u"?self:typeof window<"u"?window:{})},{}]},{},[10])(10)})})(Sa);var Fr=Sa.exports;const _i=Qi(Fr);async function Hr(e=[]){const s={};if(e.length>0)e.forEach(l=>{ie[l]&&(s[l]=ie[l])});else for(const l in ie)ie[l].isDeleted||(s[l]=ie[l]);const t={metadata:{version:"2.0-b64",createdAt:new Date().toISOString()},data:{classrooms:s,trashBin:He,userSettings:Be}},c=JSON.stringify(t),r=new Date,n=new Intl.DateTimeFormat("fa-IR-u-nu-latn",{year:"numeric",month:"numeric",day:"numeric",hour:"2-digit",minute:"2-digit",hour12:!1}).formatToParts(r).reduce((l,f)=>(l[f.type]=f.value,l),{}),i=`${n.year.slice(-2)}-${n.month}-${n.day}_${n.hour}-${n.minute}`;let o;e.length===0?o=`SP_Full_${i}.txt`:e.length===1?o=`SP_${e[0].replace(/[<>:"/\\|?*]/g,"").replace(/\s+/g,"_")}_${i}.txt`:o=`SP_Selected-${e.length}_${i}.txt`;try{const l=new _i;l.file("backup.json",c);const f=await l.generateAsync({type:"blob",compression:"DEFLATE",compressionOptions:{level:9}}),h=await Ur(f);return new File([h],o,{type:"text/plain"})}catch(l){return console.error("Error creating base64 backup file:",l),null}}function Ur(e){return new Promise((s,t)=>{const c=new FileReader;c.onerror=t,c.onload=()=>{s(c.result.split(",")[1])},c.readAsDataURL(e)})}function Wr(e,s){if(s)Rt(e.data.classrooms),Ci(e.data.trashBin||[]);else{const t=e.data.classrooms,c=e.data.trashBin||[],r=new Map;for(const a in ie){const i=ie[a];i.info&&i.info.scheduleCode&&r.set(i.info.scheduleCode,a)}for(const a in t){const i=t[a],o=i.info.scheduleCode;if(r.has(o)){const l=r.get(o);l!==i.info.name&&delete ie[l],ie[i.info.name]=i}else{let l=i.info.name;for(;ie[l];)l=`${l} (Imported)`;l!==i.info.name&&(i.info.name=l),ie[l]=i}}const n=new Set(He.map(a=>a.id));c.forEach(a=>{n.has(a.id)||He.push(a)}),Rt(ie)}e.data.userSettings&&Ct(e.data.userSettings),Ct({lastRestoreTimestamp:new Date().toISOString()}),se()}async function ns(e=[]){const s=await Hr(e);if(!s){j("âŒ Ø®Ø·Ø§ Ø¯Ø± Ø§ÛŒØ¬Ø§Ø¯ ÙØ§ÛŒÙ„ Ù¾Ø´ØªÛŒØ¨Ø§Ù†.");return}let t="Ù¾Ø´ØªÛŒØ¨Ø§Ù† Ú©Ø§Ù…Ù„ Ø³ÛŒØ³ØªÙ…";if(e.length>0){const r=e.join("ØŒ ");t=`${e.length===1?"Ù¾Ø´ØªÛŒØ¨Ø§Ù† Ú©Ù„Ø§Ø³:":"Ù¾Ø´ØªÛŒØ¨Ø§Ù† Ú©Ù„Ø§Ø³â€ŒÙ‡Ø§ÛŒ:"} ${r}`}wa(s,{name:s.name,description:t,version:"2.0-b64"}).catch(r=>console.error("Failed to save local snapshot:",r)),("ontouchstart"in window||navigator.maxTouchPoints>0)&&navigator.share&&navigator.canShare&&navigator.canShare({files:[s]})?me("ÙØ§ÛŒÙ„ Ù¾Ø´ØªÛŒØ¨Ø§Ù† Ø´Ù…Ø§ Ø¢Ù…Ø§Ø¯Ù‡ Ø§Ø³Øª. Ø¢ÛŒØ§ Ù…Ø§ÛŒÙ„ Ø¨Ù‡ Ø§Ø´ØªØ±Ø§Ú©â€ŒÚ¯Ø°Ø§Ø±ÛŒ Ø¢Ù† Ù‡Ø³ØªÛŒØ¯ØŸ",()=>{try{navigator.share({title:s.name,text:"ÙØ§ÛŒÙ„ Ù¾Ø´ØªÛŒØ¨Ø§Ù† Ø¯Ø§Ø¯Ù‡â€ŒÙ‡Ø§ÛŒ Ø¨Ø±Ù†Ø§Ù…Ù‡",files:[s]}).then(()=>{me("Ø¢ÛŒØ§ ÙØ§ÛŒÙ„ Ù¾Ø´ØªÛŒØ¨Ø§Ù† Ø¨Ø§ Ù…ÙˆÙÙ‚ÛŒØª Ø§Ø±Ø³Ø§Ù„/Ø°Ø®ÛŒØ±Ù‡ Ø´Ø¯ØŸ",()=>{wi(),Es(),j("âœ… ØªØ§Ø±ÛŒØ® Ù¾Ø´ØªÛŒØ¨Ø§Ù† Ø«Ø¨Øª Ø´Ø¯.")},{confirmText:"Ø¨Ù„Ù‡",cancelText:"Ø®ÛŒØ±",confirmClass:"btn-success"})})}catch(r){console.error("Error during sharing process:",r),qs(s),j("âš ï¸Ø®Ø·Ø§ Ø¯Ø± ÙØ±Ø¢ÛŒÙ†Ø¯ Ø§Ø´ØªØ±Ø§Ú©â€ŒÚ¯Ø°Ø§Ø±ÛŒ. ÙØ§ÛŒÙ„ Ø¯Ø± Ø­Ø§Ù„ Ø¯Ø§Ù†Ù„ÙˆØ¯ Ø§Ø³Øª.")}},{confirmText:"Ø¨Ù„Ù‡",cancelText:"Ø®ÛŒØ±",confirmClass:"btn-success"}):(qs(s),j("âœ…Ù¾Ø´ØªÛŒØ¨Ø§Ù†â€ŒÚ¯ÛŒØ±ÛŒ Ø¨Ø§ Ù…ÙˆÙÙ‚ÛŒØª Ø§Ù†Ø¬Ø§Ù… Ø´Ø¯."))}function jr(e){e.addEventListener("click",()=>{if(vt){j("âš ï¸ Ù¾Ø´ØªÛŒØ¨Ø§Ù†â€ŒÚ¯ÛŒØ±ÛŒ Ø¯Ø± Ø­Ø§Ù„Øª Ù†Ù…Ø§ÛŒØ´ (Demo) ØºÛŒØ±ÙØ¹Ø§Ù„ Ø§Ø³Øª."),je();return}je(),ns()})}function qr(e,s){e.addEventListener("click",()=>{if(vt){j("âš ï¸ Ø¨Ø§Ø²ÛŒØ§Ø¨ÛŒ Ø§Ø·Ù„Ø§Ø¹Ø§Øª Ø¯Ø± Ø­Ø§Ù„Øª Ù†Ù…Ø§ÛŒØ´ (Demo) ØºÛŒØ±ÙØ¹Ø§Ù„ Ø§Ø³Øª."),je();return}s.click(),je()})}function Gr(e){e.addEventListener("change",s=>{const t=s.target.files[0];if(!t)return;const c=new FileReader;c.onload=async r=>{const n=r.target.result;try{const a=JSON.parse(n);if(a.metadata&&a.data)ls(a);else{const i=a.classrooms||a,o=a.trashBin||[];me("Ø¢ÛŒØ§ Ø§Ø² Ø¨Ø§Ø²ÛŒØ§Ø¨ÛŒ Ø§Ø·Ù„Ø§Ø¹Ø§Øª Ù…Ø·Ù…Ø¦Ù† Ù‡Ø³ØªÛŒØ¯ØŸ ØªÙ…Ø§Ù… Ø¯Ø§Ø¯Ù‡â€ŒÙ‡Ø§ÛŒ ÙØ¹Ù„ÛŒ Ø´Ù…Ø§ Ø¨Ø§Ø²Ù†ÙˆÛŒØ³ÛŒ Ø®ÙˆØ§Ù‡Ø¯ Ø´Ø¯.",()=>{Rt(i),Ci(o),Ct({lastRestoreTimestamp:new Date().toISOString()}),se(),Fe(),Ee("class-management-page"),j("âœ…Ø§Ø·Ù„Ø§Ø¹Ø§Øª Ø¨Ø§ Ù…ÙˆÙÙ‚ÛŒØª Ø¨Ø§Ø²ÛŒØ§Ø¨ÛŒ Ø´Ø¯.")},{confirmText:"Ø¨Ø§Ø²ÛŒØ§Ø¨ÛŒ Ú©Ù†",confirmClass:"btn-warning"})}}catch{try{const l=(await new _i().loadAsync(n,{base64:!0})).file("backup.json");if(!l)throw new Error("ÙØ§ÛŒÙ„ backup.json Ø¯Ø± ÙØ§ÛŒÙ„ Ù¾Ø´ØªÛŒØ¨Ø§Ù† ÛŒØ§ÙØª Ù†Ø´Ø¯.");const f=await l.async("string"),h=JSON.parse(f);if(h.metadata&&h.metadata.version==="2.0-b64")ls(h);else throw new Error("ÙØ§ÛŒÙ„ Ù¾Ø´ØªÛŒØ¨Ø§Ù† Ù…Ø¹ØªØ¨Ø± Ù†ÛŒØ³Øª (Ù†Ø³Ø®Ù‡ Ù†Ø§Ù…Ø´Ø®Øµ).")}catch(i){j("âŒØ®Ø·Ø§ Ø¯Ø± Ø®ÙˆØ§Ù†Ø¯Ù† ÙØ§ÛŒÙ„. Ù„Ø·ÙØ§Ù‹ ÙØ§ÛŒÙ„ Ù¾Ø´ØªÛŒØ¨Ø§Ù† Ù…Ø¹ØªØ¨Ø± Ø§Ù†ØªØ®Ø§Ø¨ Ú©Ù†ÛŒØ¯."),console.error("Restore error (zip/base64):",i)}}},c.readAsText(t),s.target.value=null})}function Pe(e){return typeof e!="string"?"":e.replace(/ÙŠ/g,"ÛŒ").replace(/Ùƒ/g,"Ú©").replace(/[\s\u200c]/g,"")}function vs(e){return typeof e!="string"||e.length===0?"ltr":/[\u0590-\u07FF]/.test(e)?"rtl":"ltr"}function ki(e){return!e||!e.trim()?"":e.split(`
`).map(c=>`<div dir="${vs(c)}">${c||"&nbsp;"}</div>`).join("")}function zn(e){if(typeof e!="string")return"";const s={q:"Ø¶",w:"Øµ",e:"Ø«",r:"Ù‚",t:"Ù",y:"Øº",u:"Ø¹",i:"Ù‡",o:"Ø®",p:"Ø­","[":"Ø¬","]":"Ú†",a:"Ø´",s:"Ø³",d:"ÛŒ",f:"Ø¨",g:"Ù„",h:"Ø§",j:"Øª",k:"Ù†",l:"Ù…",";":"Ú©","'":"Ú¯",z:"Ø¸",x:"Ø·",c:"Ø²",v:"Ø±",b:"Ø°",n:"Ø¯",m:"Ù¾",",":"Ùˆ"};let t="";for(let c=0;c<e.length;c++){const r=e[c].toLowerCase();t+=s[r]||e[c]}return t}function Gt(e){if(!e||typeof e!="string")return{name:"",firstName:"",lastName:""};const s=e.split(".").map(t=>t.trim());if(s.length>1){const t=s[0],c=s.slice(1).join(" ");return{firstName:t,lastName:c,name:`${t} ${c}`.trim()}}return{name:e.trim(),firstName:"",lastName:""}}let Ls=null;function $n(){if(!Be.isSoundEnabled)return;const e=window.AudioContext||window.webkitAudioContext;if(!e)return;Ls||(Ls=new e);const s=Ls,t=()=>{const c=s.createOscillator(),r=s.createGain();c.connect(r),r.connect(s.destination),c.type="sine";const n=s.currentTime;c.frequency.setValueAtTime(450,n),r.gain.setValueAtTime(0,n),r.gain.linearRampToValueAtTime(.3,n+.002),r.gain.exponentialRampToValueAtTime(.001,n+.025),r.gain.linearRampToValueAtTime(0,n+.03),c.start(n),c.stop(n+.04)};s.state==="suspended"?s.resume().then(()=>{t()}).catch(c=>console.error("Audio resume failed:",c)):t()}function In(e){const s=e.filter(r=>r.identity.firstName&&r.identity.lastName),t=e.filter(r=>(!r.identity.firstName||!r.identity.lastName)&&typeof r.identity.name=="string"),c=e.filter(r=>(!r.identity.firstName||!r.identity.lastName)&&!r.identity.name);return s.sort((r,n)=>{const a=r.identity.lastName.localeCompare(n.identity.lastName,"fa");return a!==0?a:r.identity.firstName.localeCompare(n.identity.firstName,"fa")}),t.sort((r,n)=>r.identity.name.localeCompare(n.identity.name,"fa")),[...s,...t,...c]}function _a(e,s){let t=0;e.addEventListener("dblclick",s),e.addEventListener("touchend",c=>{const r=new Date().getTime(),n=r-t;n<400&&n>0&&(c.preventDefault(),s(c)),t=r})}function Cn(e){e&&typeof e.blur=="function"&&(e==null?void 0:e.tagName)==="INPUT"&&e.blur()}function Ii(e){e&&e.addEventListener("focus",()=>{e.select()})}function pt(e,s=4e3,t=!0){t&&xi(e),e.classList.add("blink-error"),setTimeout(()=>{e.classList.remove("blink-error")},s)}function xi(e){e&&e.scrollIntoView({behavior:"smooth",block:"center"})}function ka(){const e=document.getElementById("session-dashboard-page"),s=document.getElementById("student-stats-table-container");if(!e)return;let t=0,c=0;e.addEventListener("touchstart",n=>{if(s&&s.contains(n.target)){const a=n.target.closest("td, th");a&&a.parentElement.firstElementChild===a?t=n.changedTouches[0].screenX:t=0}else t=n.changedTouches[0].screenX},{passive:!0}),e.addEventListener("touchend",n=>{t!==0&&(c=n.changedTouches[0].screenX,r())});function r(){const a=t-c;Math.abs(a)>150&&(document.getElementById("selector-tab-btn").classList.contains("active")?(Ee("session-dashboard-page",{tab:"attendance"}),Yt("attendance")):(Ee("session-dashboard-page",{tab:"selector"}),Yt("selector"))),t=0,c=0}}function xn(e,s){let t=null;const c=500;e.addEventListener("contextmenu",r=>{r.preventDefault(),Gs(r,s(e))}),e.addEventListener("touchstart",r=>{if(r.touches.length!==1)return;const n=r.touches[0];t=setTimeout(()=>{const a={preventDefault:()=>{},clientX:n.clientX,clientY:n.clientY,target:e};Gs(a,s(e))},c)}),["touchend","touchmove","touchcancel"].forEach(r=>{e.addEventListener(r,()=>clearTimeout(t))})}function Zr(e,s){for(const t of Object.values(s)){const c=t.students.find(r=>r.identity.studentId===e);if(c)return c.identity.name}return null}const Vr={"dashboard-attendance":"attendance-pane","dashboard-selector":"selector-pane","column-mapping-page":"column-mapping-page","csv-preview-page":"csv-preview-page","restore-points-page":"restore-points-page","session-page":"session-page","settings-page":"settings-page","trash-page":"trash-page","class-management-page":"class-management-page"};function Jr(){for(const[e,s]of Object.entries(Vr)){const t=document.getElementById(s);if(t&&t.classList.contains("active")&&t.offsetParent!==null)return e}return null}const Kr=Object.freeze(Object.defineProperty({__proto__:null,attachUniversalContextMenu:xn,detectTextDirection:vs,flashElement:pt,getCurrentView:Jr,getStudentNameById:Zr,hideKeyboard:Cn,normalizeKeyboard:zn,normalizeText:Pe,parseStudentName:Gt,playSuccessSound:$n,renderMultiLineText:ki,scrollToElement:xi,setupAutoSelectOnFocus:Ii,setupDoubleAction:_a,setupSwipeNavigation:ka,sortStudents:In},Symbol.toStringTag,{value:"Module"}));function Yr(e,s){document.addEventListener("keydown",t=>{const c=document.activeElement;if(!["INPUT","TEXTAREA","SELECT"].includes(c.tagName)){if(t.key.toLowerCase()==="o"&&t.shiftKey&&Na.classList.contains("active")&&(t.preventDefault(),$a.click()),t.key==="Escape"){if($t.classList.contains("visible")){Mt();return}if(gt){ue();return}Ui(!1);return}if(K){const n=t.key.toLowerCase();switch(" ascfg".includes(n)&&t.preventDefault(),n){case" ":e.click();break;case"s":document.getElementById("session-page").classList.contains("active")&&history.back();break;case"f":const a=document.querySelector(".action-column .search-icon");a&&a.click();break;case"arrowleft":{const i=document.querySelector('button[title="Ø¨Ø±Ù†Ø¯Ù‡ Ù‚Ø¨Ù„ÛŒ"]');i&&!i.disabled&&(t.preventDefault(),i.click());break}case"arrowright":{const i=document.querySelector('button[title="Ø¨Ø±Ù†Ø¯Ù‡ Ø¨Ø¹Ø¯ÛŒ"]');i&&!i.disabled&&(t.preventDefault(),i.click());break}}}}})}function ss(e,s,t){e&&e.addEventListener("keydown",c=>{if(e.tagName==="TEXTAREA"&&s==="Enter"){(c.ctrlKey||c.metaKey)&&c.key==="Enter"&&t(c);return}c.shiftKey&&s==="Enter"||c.key===s&&t(c)})}const Ia="teacherAssistantLogs_v2",Xr=100;function Li(){try{const e=localStorage.getItem(Ia);return e?JSON.parse(e):{}}catch(e){return console.error("Error reading logs from localStorage:",e),{}}}function xa(e){try{localStorage.setItem(Ia,JSON.stringify(e))}catch(s){console.error("Error saving logs to localStorage:",s)}}function be(e,s,t=null){if(!e)return;const c=Li();c[e]||(c[e]=[]);const r={timestamp:new Date().toISOString(),message:s,action:t,classroomName:e};c[e].unshift(r),c[e].length>Xr&&c[e].pop(),xa(c)}function Qr(e){return Li()[e]||[]}function eo(e,s){const t=Li();t[e]&&!t[s]&&(t[s]=t[e],delete t[e],xa(t))}var qi={toJalaali:to,toGregorian:La,isValidJalaaliDate:no,isLeapJalaaliYear:Ta,jalaaliMonthLength:Ba,jalCal:Ti,j2d:is,d2j:as,g2d:bs,d2g:Bi,jalaaliToDateObject:Da,jalaaliWeek:io},St=[-61,9,38,199,426,686,756,818,1111,1181,1210,1635,2060,2097,2192,2262,2324,2394,2456,3178];function to(e,s,t){return Object.prototype.toString.call(e)==="[object Date]"&&(t=e.getDate(),s=e.getMonth()+1,e=e.getFullYear()),as(bs(e,s,t))}function La(e,s,t){return Bi(is(e,s,t))}function no(e,s,t){return e>=-61&&e<=3177&&s>=1&&s<=12&&t>=1&&t<=Ba(e,s)}function Ta(e){return so(e)===0}function Ba(e,s){return s<=6?31:s<=11||Ta(e)?30:29}function so(e){var s=St.length,t=St[0],c,r,n,a,i;if(e<t||e>=St[s-1])throw new Error("Invalid Jalaali year "+e);for(i=1;i<s&&(c=St[i],r=c-t,!(e<c));i+=1)t=c;return a=e-t,r-a<6&&(a=a-r+Ie(r+4,33)*33),n=et(et(a+1,33)-1,4),n===-1&&(n=4),n}function Ti(e,s){var t=St.length,c=e+621,r=-14,n=St[0],a,i,o,l,f,h,m;if(e<n||e>=St[t-1])throw new Error("Invalid Jalaali year "+e);for(m=1;m<t&&(a=St[m],i=a-n,!(e<a));m+=1)r=r+Ie(i,33)*8+Ie(et(i,33),4),n=a;return h=e-n,r=r+Ie(h,33)*8+Ie(et(h,33)+3,4),et(i,33)===4&&i-h===4&&(r+=1),l=Ie(c,4)-Ie((Ie(c,100)+1)*3,4)-150,f=20+r-l,s?{gy:c,march:f}:(i-h<6&&(h=h-i+Ie(i+4,33)*33),o=et(et(h+1,33)-1,4),o===-1&&(o=4),{leap:o,gy:c,march:f})}function is(e,s,t){var c=Ti(e,!0);return bs(c.gy,3,c.march)+(s-1)*31-Ie(s,7)*(s-7)+t-1}function as(e){var s=Bi(e).gy,t=s-621,c=Ti(t,!1),r=bs(s,3,c.march),n,a,i;if(i=e-r,i>=0){if(i<=185)return a=1+Ie(i,31),n=et(i,31)+1,{jy:t,jm:a,jd:n};i-=186}else t-=1,i+=179,c.leap===1&&(i+=1);return a=7+Ie(i,30),n=et(i,30)+1,{jy:t,jm:a,jd:n}}function bs(e,s,t){var c=Ie((e+Ie(s-8,6)+100100)*1461,4)+Ie(153*et(s+9,12)+2,5)+t-34840408;return c=c-Ie(Ie(e+100100+Ie(s-8,6),100)*3,4)+752,c}function Bi(e){var s,t,c,r,n;return s=4*e+139361631,s=s+Ie(Ie(4*e+183187720,146097)*3,4)*4-3908,t=Ie(et(s,1461),4)*5+308,c=Ie(et(t,153),5)+1,r=et(Ie(t,153),12)+1,n=Ie(s,1461)-100100+Ie(8-r,6),{gy:n,gm:r,gd:c}}function io(e,s,t){var c=Da(e,s,t).getDay(),r=c==6?0:-(c+1),n=6+r;return{saturday:as(is(e,s,t+r)),friday:as(is(e,s,t+n))}}function Da(e,s,t,c,r,n,a){var i=La(e,s,t);return new Date(i.gy,i.gm-1,i.gd,c||0,r||0,n||0,a||0)}function Ie(e,s){return~~(e/s)}function et(e,s){return e-~~(e/s)*s}function ao(e,s,t="default",c=!1){let r=[...ge(e.students)];const n=new Date().toLocaleDateString("fa-IR",{year:"numeric",month:"long",day:"numeric",weekday:"long"});t==="alpha"&&(r=In(r));let a="<tr>";s.forEach(m=>{a+=`<th>${m.label}</th>`}),a+="</tr>";let i="";r.forEach((m,u)=>{i+="<tr>",s.forEach(y=>{var C;let p="-";if(y.id==="row_num")p=u+1;else if(y.id==="name")m.identity.firstName&&m.identity.lastName?p=`${m.identity.lastName}ØŒ ${m.identity.firstName}`:p=m.identity.name;else if(y.id==="total_selections")p=m.statusCounters.totalSelections;else if(y.id==="absences")p=e.sessions.reduce((S,_)=>{if(_.isDeleted||_.isCancelled)return S;const k=_.studentRecords[m.identity.studentId];return S+(k&&k.attendance==="absent"?1:0)},0);else if(y.id==="exit_count")p=m.statusCounters.outOfClassCount||0;else if(y.id==="missed_chances")p=m.statusCounters.missedChances;else if(y.id==="issues")p=Object.values(m.categoryIssues||{}).reduce((S,_)=>S+_,0);else if(y.id==="avg_score")p=m.getOverallAverageScore()||"-";else if(y.id==="final_score")p=e.calculateFinalStudentScore(m)||"-";else if(y.type==="category")p=m.categoryCounts[y.id]||0;else if(y.type==="category_scores"){const S=y.id.toLowerCase(),_=((C=m.logs.scores[S])==null?void 0:C.filter(k=>!k.isDeleted))||[];p=_.length>0?_.map(k=>k.value).join("ØŒ "):"-"}let b="text-align: center;";y.id==="name"?b="text-align: right; white-space: nowrap;":y.type==="category_scores"&&(b="text-align: center; white-space: nowrap;");const v=`style="${b}"`;i+=`<td ${v}>${p}</td>`}),i+="</tr>"});let o="";c&&(o=`
            <div class="warning-footnote">
                âš ï¸ <strong>ØªÙˆØ¬Ù‡:</strong> ØªØ±ØªÛŒØ¨ Ø§Ù„ÙØ¨Ø§ÛŒÛŒ Ø§ÛŒÙ† Ù„ÛŒØ³Øª Ù…Ù…Ú©Ù† Ø§Ø³Øª Ø¯Ù‚ÛŒÙ‚ Ù†Ø¨Ø§Ø´Ø¯. (Ù†Ø§Ù… Ø®Ø§Ù†ÙˆØ§Ø¯Ú¯ÛŒ Ø¨Ø±Ø®ÛŒ Ø¯Ø§Ù†Ø´â€ŒØ¢Ù…ÙˆØ²Ø§Ù† Ø¯Ø± Ø³ÛŒØ³ØªÙ… ØªÙÚ©ÛŒÚ© Ù†Ø´Ø¯Ù‡ Ø§Ø³Øª)
            </div>
        `);const l=Array.from(document.querySelectorAll('link[rel="stylesheet"]')).map(m=>m.outerHTML).join(""),f=window.open("","_blank");if(!f){j("âš ï¸ Ù…Ø±ÙˆØ±Ú¯Ø± Ø´Ù…Ø§ Ù¾Ù†Ø¬Ø±Ù‡ Ø¬Ø¯ÛŒØ¯ Ø±Ø§ Ù…Ø³Ø¯ÙˆØ¯ Ú©Ø±Ø¯. Ù„Ø·ÙØ§Ù‹ Ø§Ø¬Ø§Ø²Ù‡ Ø¯Ù‡ÛŒØ¯.","error");return}const h=`
        <!DOCTYPE html>
        <html lang="fa" dir="rtl">
        <head>
            <title>Ú¯Ø²Ø§Ø±Ø´ Ú©Ù„Ø§Ø³ ${e.info.name}</title>
            ${l} <style>
                @media print {
                    @page { size: A4; margin: 10mm; }
                    /* Updated Font Family */
                    body { font-family: 'Vazirmatn', 'Vazir', Tahoma, sans-serif; color: #000; }
                }
                /* Updated Font Family */
                body { font-family: 'Vazirmatn', 'Vazir', Tahoma, sans-serif; padding: 20px; direction: rtl; }
                h1 { text-align: center; margin-bottom: 5px; font-size: 24px; }
                .meta { text-align: center; margin-bottom: 30px; font-size: 14px; color: #444; }
                table { width: 100%; border-collapse: collapse; font-size: 12px; }
                th, td { border: 1px solid #333; padding: 6px 8px; text-align: center; }
                th { background-color: #eee; font-weight: bold; }
                tr:nth-child(even) { background-color: #f9f9f9; }
                .signature { margin-top: 50px; display: flex; justify-content: space-between; padding: 0 50px; }
                
                .warning-footnote {
                    margin-top: 20px;
                    font-size: 11px;
                    color: #555;
                    font-style: italic;
                    border-top: 1px solid #ccc;
                    padding-top: 10px;
                }
            </style>
        </head>
        <body>
            <h1>Ú¯Ø²Ø§Ø±Ø´ ÙˆØ¶Ø¹ÛŒØª Ú©Ù„Ø§Ø³ ${e.info.name}</h1>
            <div class="meta">
                ØªØ§Ø±ÛŒØ® Ú¯Ø²Ø§Ø±Ø´: ${n} | ØªØ¹Ø¯Ø§Ø¯ Ø¯Ø§Ù†Ø´â€ŒØ¢Ù…ÙˆØ²Ø§Ù†: ${r.length}
            </div>
            <table>
                <thead>${a}</thead>
                <tbody>${i}</tbody>
            </table>
            ${o}
            <div class="signature">
                <div>Ø§Ù…Ø¶Ø§ÛŒ Ù…Ø¹Ù„Ù…</div>
                <div>Ù…Ù‡Ø± Ùˆ Ø§Ù…Ø¶Ø§ÛŒ Ù…Ø¯Ø±Ø³Ù‡</div>
            </div>
            <script>
                window.onload = function() { window.print(); }
            <\/script>
        </body>
        </html>
    `;f.document.write(h),f.document.close()}function ro(e){const s=Wa;s.innerHTML="";const c=ge(e.students).filter(m=>!m.identity.lastName).length,r=[{id:"row_num",label:"Ø±Ø¯ÛŒÙ",checked:!0},{id:"name",label:"Ù†Ø§Ù… Ø¯Ø§Ù†Ø´â€ŒØ¢Ù…ÙˆØ²",checked:!0},{id:"total_selections",label:"Ú©Ù„ Ø§Ù†ØªØ®Ø§Ø¨â€ŒÙ‡Ø§",checked:!0},{id:"absences",label:"ØªØ¹Ø¯Ø§Ø¯ ØºÛŒØ¨Øª",checked:!0},{id:"exit_count",label:"ØªØ¹Ø¯Ø§Ø¯ Ø®Ø±ÙˆØ¬",checked:!1},{id:"missed_chances",label:"ÙØ±ØµØª Ø³ÙˆØ®ØªÙ‡",checked:!1},{id:"issues",label:"Ù…Ø´Ú©Ù„â€ŒÙ¾Ø§Ø³Ø®Ú¯ÙˆÛŒÛŒ",checked:!1},{id:"avg_score",label:"Ù…ÛŒØ§Ù†Ú¯ÛŒÙ† Ù†Ù…Ø±Ø§Øª",checked:!0},{id:"final_score",label:"Ù†Ù…Ø±Ù‡ Ù†Ù‡Ø§ÛŒÛŒ (Ú©Ø§Ù†ÙˆÙ†)",checked:!0}];e.categories.forEach(m=>{m.isDeleted||(r.push({id:m.name,label:`ØªØ¹Ø¯Ø§Ø¯ ${m.name}`,type:"category",checked:!1}),m.isGradedCategory&&r.push({id:m.name,label:`Ù†Ù…Ø±Ø§Øª ${m.name}`,type:"category_scores",checked:!1}))}),r.forEach(m=>{const u=document.createElement("label");u.className="report-column-item";const y=document.createElement("input");y.type="checkbox",y.checked=m.checked,y.dataset.colId=m.id,y.dataset.colLabel=m.label,m.type&&(y.dataset.colType=m.type);const p=document.createElement("span");p.textContent=m.label,u.appendChild(y),u.appendChild(p),s.appendChild(u)});const n=s.parentElement,a=n.querySelector("#report-sort-options");a&&a.remove();const i=document.createElement("div");i.id="report-sort-options",i.style.marginTop="20px",i.style.padding="15px",i.style.backgroundColor="#f8f9fa",i.style.borderRadius="5px",i.style.border="1px solid #e9ecef",i.innerHTML=`
        <div style="margin-bottom: 10px; font-weight: bold; color: #333;">ØªØ±ØªÛŒØ¨ Ù†Ù…Ø§ÛŒØ´ Ù„ÛŒØ³Øª:</div>
        
        <div style="display: flex; flex-direction: column; gap: 10px;">
            <label style="cursor: pointer; display: flex; align-items: center; gap: 8px;">
                <input type="radio" name="report-sort" value="alpha" checked style="accent-color: var(--color-primary);">
                <span>Ø¨Ø± Ø§Ø³Ø§Ø³ Ù†Ø§Ù… Ø®Ø§Ù†ÙˆØ§Ø¯Ú¯ÛŒ</span>
            </label>

            <label style="cursor: pointer; display: flex; align-items: center; gap: 8px;">
                <input type="radio" name="report-sort" value="default" style="accent-color: var(--color-primary);">
                <span>Ø¨Ø± Ø§Ø³Ø§Ø³ Ø²Ù…Ø§Ù† ÙˆØ±ÙˆØ¯ Ø¨Ù‡ Ú©Ù„Ø§Ø³</span>
            </label>
        </div>

        <div id="sort-warning" style="
            display: none; 
            margin-top: 12px; 
            background-color: #fff3cd; 
            color: #856404; 
            padding: 10px; 
            border-radius: 4px; 
            font-size: 13px; 
            border: 1px solid #ffeeba;
            line-height: 1.5;
        ">
            âš ï¸ <strong>ØªÙˆØ¬Ù‡:</strong> Ù†Ø§Ù… Ø®Ø§Ù†ÙˆØ§Ø¯Ú¯ÛŒ ${c} Ø¯Ø§Ù†Ø´â€ŒØ¢Ù…ÙˆØ² Ù‡Ù†ÙˆØ² ØªÙÚ©ÛŒÚ© Ù†Ø´Ø¯Ù‡ Ø§Ø³Øª. Ù…Ø±ØªØ¨â€ŒØ³Ø§Ø²ÛŒ Ø§ÛŒÙ† Ù…ÙˆØ§Ø±Ø¯ Ù…Ù…Ú©Ù† Ø§Ø³Øª Ú©Ø§Ù…Ù„Ø§Ù‹ Ø¯Ù‚ÛŒÙ‚ Ù†Ø¨Ø§Ø´Ø¯.
        </div>
    `;const o=n.querySelector(".modal-actions");n.insertBefore(i,o);const l=i.querySelectorAll('input[name="report-sort"]'),f=i.querySelector("#sort-warning"),h=()=>{const m=i.querySelector('input[value="alpha"]').checked;f.style.display=m&&c>0?"block":"none"};l.forEach(m=>m.addEventListener("change",h)),h(),ja.onclick=()=>{const m=[];if(s.querySelectorAll('input[type="checkbox"]:checked').forEach(b=>{m.push({id:b.dataset.colId,label:b.dataset.colLabel,type:b.dataset.colType})}),m.length===0){j("âš ï¸ Ù„Ø·ÙØ§Ù‹ Ø­Ø¯Ø§Ù‚Ù„ ÛŒÚ© Ø³ØªÙˆÙ† Ø±Ø§ Ø§Ù†ØªØ®Ø§Ø¨ Ú©Ù†ÛŒØ¯.");return}const y=i.querySelector('input[name="report-sort"]:checked').value,p=y==="alpha"&&c>0;ue(),ao(e,m,y,p)},qa.onclick=()=>{ue()},De("report-config-modal")}const Na=document.getElementById("class-management-page"),oo=document.getElementById("open-add-class-modal-btn"),co=document.getElementById("add-class-modal"),wn=document.getElementById("modal-new-class-name"),Di=document.getElementById("modal-add-class-system"),Ni=document.getElementById("modal-add-class-level"),Ns=document.getElementById("confirm-add-class-btn"),As=document.getElementById("cancel-add-class-btn"),At=document.getElementById("class-list"),rs=document.getElementById("undo-toast"),Aa=document.getElementById("undo-message"),lo=document.getElementById("undo-btn"),uo=document.getElementById("settings-page"),Ma=document.getElementById("settings-class-name-header"),Ms=document.getElementById("settings-student-list"),Os=document.getElementById("category-list"),fo=document.getElementById("back-to-sessions-btn"),mo=document.getElementById("new-student-name"),ho=document.getElementById("add-student-btn"),Oa=document.getElementById("paste-area"),po=document.getElementById("process-paste-btn"),go=document.getElementById("csv-preview-page"),Rs=document.getElementById("csv-preview-list"),yo=document.getElementById("csv-confirm-btn"),vo=document.getElementById("csv-cancel-btn"),bo=document.getElementById("import-csv-btn"),Co=document.getElementById("csv-file-input"),wo=document.getElementById("column-mapping-page"),zs=document.getElementById("column-select-dropdown"),Eo=document.getElementById("confirm-column-btn"),So=document.getElementById("cancel-import-btn"),$s=document.querySelector(".app-header"),Qe=document.getElementById("select-student-btn"),zt=document.getElementById("select-student-btn-wrapper"),_o=document.getElementById("assessment-mode-label"),sn=document.getElementById("category-weight-label"),ko=document.getElementById("attendance-page"),dn=document.getElementById("attendance-list"),Io=document.getElementById("finish-attendance-btn"),xo=document.querySelector("#class-management-page h2"),Ps=document.getElementById("student-stats-header"),Lo=document.getElementById("hamburger-menu-btn"),Ra=document.getElementById("side-nav-menu"),To=document.getElementById("close-nav-btn"),za=document.getElementById("overlay"),Bo=document.getElementById("backup-data-btn"),Do=document.getElementById("restore-data-btn"),$a=document.getElementById("restore-file-input"),No=document.getElementById("custom-confirm-modal"),Pa=document.getElementById("confirm-modal-message"),Fs=document.getElementById("confirm-modal-cancel-btn"),an=document.getElementById("confirm-modal-confirm-btn"),Ao=document.getElementById("secure-confirm-modal"),Fa=document.getElementById("secure-confirm-message"),Ha=document.getElementById("secure-confirm-code"),Wt=document.getElementById("secure-confirm-input"),Mo=document.getElementById("secure-confirm-cancel-btn"),Pn=document.getElementById("secure-confirm-confirm-btn"),Oo=document.getElementById("add-note-modal"),ye=document.getElementById("new-note-content"),Ro=document.getElementById("class-save-note-btn"),zo=document.getElementById("cancel-note-btn"),Hs=document.getElementById("student-search-input"),Et=document.getElementById("student-search-results"),$o=document.getElementById("back-to-student-page-btn"),Po=document.getElementById("graded-category-pills-container"),Fo=document.getElementById("new-score-value"),Ua=document.getElementById("new-score-comment"),Ho=document.getElementById("add-score-btn"),Uo=document.getElementById("profile-stats-summary"),Wo=document.getElementById("profile-scores-list"),rn=document.getElementById("global-student-search-input"),ut=document.getElementById("global-student-search-results"),jo=document.getElementById("trashed-classes-list"),qo=document.getElementById("trashed-students-list"),Go=document.getElementById("trashed-sessions-list"),Zo=document.getElementById("trashed-categories-list"),Vo=document.getElementById("trashed-notes-list"),Jo=document.getElementById("trashed-scores-list"),qt=document.getElementById("quick-grade-form-wrapper"),Ye=document.getElementById("quick-score-input"),Xe=document.getElementById("quick-note-textarea"),It=document.getElementById("quick-grade-submit-btn"),un=document.getElementById("category-selection-container");document.getElementById("selected-student-result");const $t=document.getElementById("custom-context-menu"),jt=document.getElementById("breadcrumb-container"),Ko=document.getElementById("report-config-modal"),Wa=document.getElementById("report-columns-container"),ja=document.getElementById("report-print-btn"),qa=document.getElementById("report-cancel-btn");let tn=null,Zt=null;const Yo=document.getElementById("category-modal"),Ga=document.getElementById("category-modal-title"),Vt=document.getElementById("new-category-modal-name"),En=document.getElementById("new-category-modal-is-graded"),Xo=document.getElementById("category-modal-cancel-btn"),Za=document.getElementById("category-modal-save-btn"),Qo=document.getElementById("mass-comment-modal"),ec=document.getElementById("mass-comment-modal-title"),Va=document.getElementById("mass-comment-student-count-message"),fn=document.getElementById("mass-comment-content"),Ai=document.getElementById("mass-comment-append-checkbox"),tc=document.getElementById("mass-comment-cancel-btn"),nc=document.getElementById("mass-comment-save-btn"),Us=document.getElementById("mass-comment-btn"),Fn=document.getElementById("attendance-mass-actions-container"),Bt=document.createElement("input"),sc=document.getElementById("session-dashboard-page"),Kt=document.getElementById("attendance-pane"),Hn=document.getElementById("settings-edu-system"),on=document.getElementById("settings-level"),Ja=document.getElementById("modal-schedule-text"),os=document.getElementById("modal-schedule-days"),Ka=document.getElementById("modal-schedule-start-time"),Ya=document.getElementById("modal-schedule-end-time"),cn=document.getElementById("modal-schedule-toggle"),Xa=document.getElementById("modal-schedule-content"),cs=document.getElementById("new-category-modal-weight"),ic=document.getElementById("category-modal"),mn=document.getElementById("new-category-modal-weight-group"),ac=document.getElementById("open-add-category-btn");let Cs=!1;function Qa(e){Cs=e}function Nt(e,s,t=800){let c,r=t;const n=i=>{c=setTimeout(()=>{Be.isVibrationEnabled&&navigator.vibrate&&navigator.vibrate(50),s(i)},r)},a=()=>{clearTimeout(c)};e.addEventListener("touchstart",n,{passive:!0}),e.addEventListener("touchend",a),e.addEventListener("touchmove",a),e.addEventListener("mousedown",n),e.addEventListener("mouseup",a),e.addEventListener("mouseleave",a)}function Ln(e="selector"){if(!N||!K){Ee("class-management-page");return}dc(),Wn(),Re(),ot(),Ee("session-dashboard-page",{tab:e}),er(),Yt(e),uc()}function Yt(e){const s=document.getElementById("selector-tab-btn"),t=document.getElementById("attendance-tab-btn"),c=document.getElementById("selector-pane"),r=e==="selector";s.classList.toggle("active",r),t.classList.toggle("active",!r),c.classList.toggle("active",r),Kt.classList.toggle("active",!r)}function er(){const e=document.getElementById("selector-tab-btn"),s=document.getElementById("attendance-tab-btn"),t=document.getElementById("selector-pane");e.addEventListener("click",()=>{Re(),Ae(),e.classList.add("active"),s.classList.remove("active"),t.classList.add("active"),Kt.classList.remove("active"),Ee("session-dashboard-page",{tab:"selector"})}),s.addEventListener("click",()=>{ot(),s.classList.add("active"),e.classList.remove("active"),Kt.classList.add("active"),t.classList.remove("active"),Ee("session-dashboard-page",{tab:"attendance"})}),_a(s,c=>{Yt("attendance"),ot(),setTimeout(()=>{const r=document.getElementById("attendance-search-input");r&&r.focus()},100)})}function rc(e){clearTimeout(gs),pn||Qn(JSON.stringify(ie)),Aa.textContent=e,rs.classList.add("show"),ha(setTimeout(()=>{rs.classList.remove("show"),Qn(null)},5e3))}function tr(){if(pn){const e=N?N.info.name:null,s=JSON.parse(pn);Rt(s),e&&ie[e]?Ge(ie[e]):Ge(null),N?(Lt(),Qt(),qe()):Fe(),rs.classList.remove("show"),clearTimeout(gs),Qn(null)}}function j(e,s=3e3){const t=document.getElementById("notification-toast");t&&(t.textContent=e,t.classList.add("show"),clearTimeout(ti),pa(setTimeout(()=>{t.classList.remove("show")},s)))}function ls(e){var b;const s=document.getElementById("restore-confirm-modal"),t=document.getElementById("restore-modal-message"),c=document.getElementById("restore-append-checkbox"),r=document.querySelector('label[for="restore-append-checkbox"]'),n=document.getElementById("restore-confirm-cancel-btn"),a=document.getElementById("restore-confirm-confirm-btn"),i=document.getElementById("restore-modal-warning");i.style.display="none";const o=((b=e.metadata)==null?void 0:b.createdAt)||0;if(Be.lastRestoreTimestamp&&o<Be.lastRestoreTimestamp){const v=new Date(o).toLocaleDateString("fa-IR"),C=new Date(Be.lastRestoreTimestamp).toLocaleDateString("fa-IR");i.textContent=`âš ï¸ Ù‡Ø´Ø¯Ø§Ø±: Ø§ÛŒÙ† ÙØ§ÛŒÙ„ Ù¾Ø´ØªÛŒØ¨Ø§Ù† (${v}) Ù‚Ø¯ÛŒÙ…ÛŒâ€ŒØªØ± Ø§Ø² Ø¢Ø®Ø±ÛŒÙ† Ø¨Ø§Ø²ÛŒØ§Ø¨ÛŒ Ø´Ù…Ø§ (${C}) Ø§Ø³Øª.`,i.style.display="block"}const l=e.data.classrooms||{},f=Object.values(l).map(v=>v.info.name),h=f.length,m="Ú©Ù„Ø§Ø³",u=f.map(v=>`<li style="margin-bottom: 4px;">ðŸ”¹ ${v}</li>`).join("");t.innerHTML=`
        <div style="margin-bottom: 10px;">
            ÙØ§ÛŒÙ„ Ù¾Ø´ØªÛŒØ¨Ø§Ù† Ø´Ø§Ù…Ù„ <strong>${h} ${m}</strong> Ø²ÛŒØ± Ø§Ø³Øª:
        </div>
        <ul style="
            margin: 0; 
            padding: 10px; 
            background-color: #f8f9fa; 
            border-radius: 5px; 
            border: 1px solid #e9ecef;
            list-style: none; 
            max-height: 150px; 
            overflow-y: auto;
            text-align: right;
        ">
            ${u}
        </ul>
        <div style="margin-top: 15px;">
            Ù„Ø·ÙØ§Ù‹ Ù†Ø­ÙˆÙ‡ Ø¨Ø§Ø²ÛŒØ§Ø¨ÛŒ Ø±Ø§ Ù…Ø´Ø®Øµ Ú©Ù†ÛŒØ¯.
        </div>
    `,c.checked=!1,r&&(r.textContent="Ø¬Ø§ÛŒÚ¯Ø²ÛŒÙ†ÛŒ Ú©Ø§Ù…Ù„ (Ø­Ø°Ù Ø¯Ø§Ø¯Ù‡â€ŒÙ‡Ø§ÛŒ ÙØ¹Ù„ÛŒ)");const y=()=>{const v=c.checked;Wr(e,v),a.onclick=null,n.onclick=null,s.removeEventListener("click",y),ue(),Fe(),Ee("class-management-page"),j(`âœ… Ø§Ø·Ù„Ø§Ø¹Ø§Øª Ø¨Ø§ Ù…ÙˆÙÙ‚ÛŒØª Ø¨Ø§Ø²ÛŒØ§Ø¨ÛŒ Ø´Ø¯ (${v?"Ù¾Ø§Ú©â€ŒØ³Ø§Ø²ÛŒ Ùˆ Ø¨Ø§Ø²ÛŒØ§Ø¨ÛŒ":"Ù‡Ù…Ú¯Ø§Ù…â€ŒØ³Ø§Ø²ÛŒ Ù‡ÙˆØ´Ù…Ù†Ø¯"}).`)},p=()=>{a.onclick=null,n.onclick=null,ue()};a.onclick=y,n.onclick=p,De("restore-confirm-modal")}function me(e,s,t={}){const{confirmText:c="ØªØ§ÛŒÛŒØ¯",cancelText:r="Ù„ØºÙˆ",confirmClass:n="btn-success",onCancel:a=()=>{},isDelete:i=!1}=t,o=i?()=>nr(e,s):s;Pa.innerHTML=e.replace(/\n/g,"<br>"),an.textContent=c,Fs.textContent=r,an.className="modal-action-btn",an.classList.add(n),yi(o),vi(a);const l=an.parentElement;Fs.style.display=a===null?"none":"inline-block",l.style.justifyContent=a===null?"center":"space-between",De("custom-confirm-modal")}function nr(e,s){const t=Math.floor(1e4+Math.random()*9e4).toString();Fa.textContent=e,Ha.textContent=t,Wt.value="",Pn.disabled=!0,yn(s),De("secure-confirm-modal"),Wt.focus();const c=()=>{Wt.value===t?Pn.disabled=!1:Pn.disabled=!0};return Wt.addEventListener("input",c),()=>{Wt.removeEventListener("input",c)}}function Ws(e,s={}){const{title:t="Ø§ÛŒØ¬Ø§Ø¯ Ø¯Ø³ØªÙ‡â€ŒØ¨Ù†Ø¯ÛŒ Ø¬Ø¯ÛŒØ¯",initialName:c="",initialIsGraded:r=!1,initialWeight:n=1,saveButtonText:a="Ø°Ø®ÛŒØ±Ù‡"}=s;Ga.textContent=t,Vt.value=c,En.checked=r,kn(),cs.value=n,Za.textContent=a,vn((i,o)=>{const l=parseFloat(cs.value)||1;if(!i){j("âš ï¸ Ù„Ø·ÙØ§Ù‹ Ù†Ø§Ù… Ø¯Ø³ØªÙ‡â€ŒØ¨Ù†Ø¯ÛŒ Ø±Ø§ ÙˆØ§Ø±Ø¯ Ú©Ù†ÛŒØ¯.");return}e(i,o,l),ue()}),De("category-modal"),Vt.focus(),c&&Vt.select()}function Mi(e,s){const t=Object.values(ie).filter(a=>!a.isDeleted&&a.info.name!==s.info.name),c=document.getElementById("move-student-modal-title"),r=document.getElementById("move-student-class-select"),n=document.getElementById("move-student-confirm-btn");c.textContent=`Ø§Ù†ØªÙ‚Ø§Ù„ Ø¯Ø§Ù†Ø´â€ŒØ¢Ù…ÙˆØ²: ${e.identity.name}`,r.innerHTML="",t.length===0?(r.innerHTML='<option value="">Ú©Ù„Ø§Ø³ Ø¯ÛŒÚ¯Ø±ÛŒ Ø¨Ø±Ø§ÛŒ Ø§Ù†ØªÙ‚Ø§Ù„ ÙˆØ¬ÙˆØ¯ Ù†Ø¯Ø§Ø±Ø¯</option>',n.disabled=!0):(t.forEach(a=>{const i=document.createElement("option");i.value=a.info.name,i.textContent=a.info.name,r.appendChild(i)}),n.disabled=!1),va(e),ba(s),De("move-student-modal")}function Oi(e,s){if(!e||!s)return;const t=e.identity.name,c=e.identity.firstName||"";e.identity.lastName;const r=document.getElementById("add-note-modal-title");r.textContent="ØªØºÛŒÛŒØ± Ù†Ø§Ù… Ø¯Ø§Ù†Ø´â€Œ Ø¢Ù…ÙˆØ²";const n=e.identity.firstName&&e.identity.lastName?`${e.identity.firstName} . ${e.identity.lastName}`:t;ye.value=n,ye.rows=1,ye.dispatchEvent(new Event("input",{bubbles:!0})),dt(a=>{const i=a.indexOf(".");if(i<=0||i>=a.length-1)return j("Ù„Ø·ÙØ§ Ù†Ø§Ù… Ùˆ Ù†Ø§Ù… Ø®Ø§Ù†ÙˆØ§Ø¯Ú¯ÛŒ Ø´Ø®Øµ Ø±Ø§ Ø¨Ø§ ÛŒÚ© Ù†Ù‚Ø·Ù‡ Ø§Ø² Ù‡Ù… Ø¬Ø¯Ø§ Ú©Ù†ÛŒØ¯. Ù…Ø«Ø§Ù„: Ø¹Ù„ÛŒ . Ø§Ø­Ù…Ø¯ÛŒ"),!1;const o=Gt(a),l=o.name,f=o.firstName||"";if(e.identity.firstName&&e.identity.lastName&&!o.firstName)return j("âš ï¸ Ø§ÛŒÙ† Ø¯Ø§Ù†Ø´â€ŒØ¢Ù…ÙˆØ² Ø¯Ø§Ø±Ø§ÛŒ Ù†Ø§Ù… Ùˆ Ù†Ø§Ù…â€ŒØ®Ø§Ù†ÙˆØ§Ø¯Ú¯ÛŒ ØªÙÚ©ÛŒÚ© Ø´Ø¯Ù‡ Ø§Ø³Øª. Ù„Ø·ÙØ§Ù‹ Ø­ØªÙ…Ø§Ù‹ Ø§Ø² Ù†Ù‚Ø·Ù‡ (.) Ø¨ÛŒÙ† Ù†Ø§Ù… Ùˆ Ù†Ø§Ù…â€ŒØ®Ø§Ù†ÙˆØ§Ø¯Ú¯ÛŒ Ø§Ø³ØªÙØ§Ø¯Ù‡ Ú©Ù†ÛŒØ¯."),!1;if(l&&(l!==t||f!==c)){if(ge(s.students).some(p=>p.identity.studentId!==e.identity.studentId&&p.identity.name.toLowerCase()===l.toLowerCase()))return j("Ø¯Ø§Ù†Ø´â€ŒØ¢Ù…ÙˆØ²ÛŒ Ø¨Ø§ Ø§ÛŒÙ† Ù†Ø§Ù… Ø§Ø² Ù‚Ø¨Ù„ Ø¯Ø± Ø§ÛŒÙ† Ú©Ù„Ø§Ø³ ÙˆØ¬ÙˆØ¯ Ø¯Ø§Ø±Ø¯."),!1;{e.identity.name=l,e.identity.firstName=o.firstName,e.identity.lastName=o.lastName,be(s.info.name,`Ù†Ø§Ù… Ø¯Ø§Ù†Ø´â€ŒØ¢Ù…ÙˆØ² Â«${t}Â» Ø¨Ù‡ Â«${l}Â» ØªØºÛŒÛŒØ± ÛŒØ§ÙØª.`,{type:"VIEW_STUDENT_PROFILE",studentId:e.identity.studentId}),se(),Lt(),Re(),ot(),Ae(),Se&&Se.identity.studentId===e.identity.studentId&&Ue(e);const p=document.querySelector(`#settings-student-list li[data-student-id="${e.identity.studentId}"]`);p&&(p.classList.add("recently-updated"),setTimeout(()=>{p&&p.classList.remove("recently-updated")},1e4),p.scrollIntoView({behavior:"smooth",block:"center"})),j(`âœ… Ù†Ø§Ù… Ø¯Ø§Ù†Ø´â€ŒØ¢Ù…ÙˆØ² Ø¨Ù‡ Â«${l}Â» ØªØºÛŒÛŒØ± ÛŒØ§ÙØª.`)}}else if(!l)return j("âš ï¸ Ù†Ø§Ù… Ù†Ù…ÛŒâ€ŒØªÙˆØ§Ù†Ø¯ Ø®Ø§Ù„ÛŒ Ø¨Ø§Ø´Ø¯."),!1;const u=document.getElementById("add-note-modal-title");u.textContent="Ø«Ø¨Øª ÛŒØ§Ø¯Ø¯Ø§Ø´Øª Ø¬Ø¯ÛŒØ¯",ye.rows=4}),De("add-note-modal"),ye.focus(),ye.select()}function De(e){const s=document.getElementById(e);if(s){if(gt)return;s.classList.add("modal-visible"),bi(e),document.body.style.overflow="hidden",history.pushState(null,"",location.href)}}function ue(e,s=!1){if(document.body.style.overflow="auto",!gt)return;di(!0);const t=document.getElementById(gt),c=gt;bi(null),c==="student-profile-modal"&&kt(null),s||history.back(),t&&(t.classList.add("modal-closing"),setTimeout(()=>{t.classList.remove("modal-visible"),t.classList.remove("modal-closing"),c==="custom-confirm-modal"&&(yi(null),vi(null)),c==="secure-confirm-modal"&&yn(null),c==="category-modal"&&vn(null),c==="mass-comment-modal"&&(fn.value=""),c==="add-note-modal"&&dt(null),typeof e=="function"&&e()},300))}function Ri(){if(!Kt||!Kt.classList.contains("active")){Fn.style.display="none";return}const e=Ot.length;e<1?Fn.style.display="none":Fn.style.display="block",Us.disabled=e<1,Us.textContent=`ðŸ“ Ø«Ø¨Øª ÛŒØ§Ø¯Ø¯Ø§Ø´Øª Ú¯Ø±ÙˆÙ‡ÛŒ (${e} Ù†ÙØ±)`}function zi(){const e=Ot,s=e.length;let t=!1;s>0&&(t=e.some(r=>{var n;return(n=K.studentRecords[r])==null?void 0:n.homework.comment})),Va.textContent=`ÛŒØ§Ø¯Ø¯Ø§Ø´Øª Ø¨Ø±Ø§ÛŒ ${s} Ø¯Ø§Ù†Ø´â€ŒØ¢Ù…ÙˆØ² Ø«Ø¨Øª Ø®ÙˆØ§Ù‡Ø¯ Ø´Ø¯.`,fn.value="",fn.dispatchEvent(new Event("input",{bubbles:!0})),Ai.checked=!0;const c=document.querySelector("#mass-comment-modal .modal-options");c.style.display=t?"flex":"none",De("mass-comment-modal"),fn.focus()}function js(e,s){if(!N||!K)return;let t=0;const c=Ot,r=K;c.forEach(n=>{const a=r.studentRecords[n];if(a&&a.homework){const i=a.homework.comment||"";let o=e;s&&i.length>0?o=i+`
---
`+e:o=e,a.homework.comment=o.trim();const l=N.students.find(f=>f.identity.studentId===n);l&&oc(l,r,o.trim()),t++}}),bn([]),se(),ot(),be(N.info.name,`${t} Ø¯Ø§Ù†Ø´â€ŒØ¢Ù…ÙˆØ² Ø¨Ù‡ ØµÙˆØ±Øª Ú¯Ø±ÙˆÙ‡ÛŒ ÛŒØ§Ø¯Ø¯Ø§Ø´Øª ØªÚ©Ù„ÛŒÙ Ú¯Ø±ÙØªÙ†Ø¯.`,{type:"VIEW_SESSIONS"}),j(`âœ… ÛŒØ§Ø¯Ø¯Ø§Ø´Øª Ø¨Ø±Ø§ÛŒ ${t} Ø¯Ø§Ù†Ø´â€ŒØ¢Ù…ÙˆØ² Ø«Ø¨Øª Ø´Ø¯.`)}function oc(e,s,t){const r=lt(N).get(s.sessionNumber),n={type:"fromAttendance",sessionNumber:s.sessionNumber},a=`ÛŒØ§Ø¯Ø¯Ø§Ø´Øª Ø¬Ù„Ø³Ù‡ ${r}:
`,i=e.profile.notes.find(o=>!o.isDeleted&&o.source&&o.source.type==="fromAttendance"&&o.source.sessionNumber===n.sessionNumber);i?t?(i.content=a+t,i.isDeleted=!1):i.isDeleted=!0:t&&e.addNote(a+t,n)}function ws(e){ye.value=e.note||"",dt(s=>{e.note=s,se(),be(e.info.name,"ÛŒØ§Ø¯Ø¯Ø§Ø´Øª Ú©Ù„Ø§Ø³ Ø°Ø®ÛŒØ±Ù‡ Ø´Ø¯.",{type:"VIEW_CLASS_NOTE"}),Fe(),j("âœ… ÛŒØ§Ø¯Ø¯Ø§Ø´Øª Ú©Ù„Ø§Ø³ Ø°Ø®ÛŒØ±Ù‡ Ø´Ø¯.")}),De("add-note-modal"),ye.focus()}function $i(e,s){ye.value=e.note||"",ye.dispatchEvent(new Event("input",{bubbles:!0})),dt(t=>{e.note=t,se(),be(N.info.name,`ÛŒØ§Ø¯Ø¯Ø§Ø´Øª Ø¬Ù„Ø³Ù‡ ${s} Ø°Ø®ÛŒØ±Ù‡ Ø´Ø¯.`,{type:"VIEW_SESSIONS"}),qe(),j("âœ…ÛŒØ§Ø¯Ø¯Ø§Ø´Øª Ø¬Ù„Ø³Ù‡ Ø°Ø®ÛŒØ±Ù‡ Ø´Ø¯.")}),De("add-note-modal"),ye.focus()}function xt(e){Ge(e),Ma.textContent=`ØªÙ†Ø¸ÛŒÙ…Ø§Øª Ú©Ù„Ø§Ø³: ${e.info.name}`,Lt(),Qt(),dr(),Ee("settings-page")}function sr(e){const s=document.getElementById("log-modal-title"),t=document.getElementById("log-list");s.textContent=`Ú¯Ø²Ø§Ø±Ø´ ÙØ¹Ø§Ù„ÛŒØªâ€ŒÙ‡Ø§ÛŒ Ú©Ù„Ø§Ø³: ${e}`,t.innerHTML="";const c=Qr(e);c.length===0?t.innerHTML='<li class="no-content-message">Ù‡Ù†ÙˆØ² ÙØ¹Ø§Ù„ÛŒØªÛŒ Ø¨Ø±Ø§ÛŒ Ø§ÛŒÙ† Ú©Ù„Ø§Ø³ Ø«Ø¨Øª Ù†Ø´Ø¯Ù‡ Ø§Ø³Øª.</li>':c.forEach(r=>{const n=document.createElement("li");n.className="log-entry";const a=new Date(r.timestamp),i=`${a.toLocaleDateString("fa-IR")} - ${a.toLocaleTimeString("fa-IR",{hour:"2-digit",minute:"2-digit"})}`,o=document.createElement("span");o.className="log-timestamp",o.textContent=i;const l=document.createElement("span");l.className="log-message",l.textContent=r.message,r.action&&(l.classList.add("log-action-link"),l.dataset.action=JSON.stringify({...r.action,classroomName:r.classroomName})),n.appendChild(o),n.appendChild(l),t.appendChild(n)}),De("log-modal")}document.getElementById("log-modal-close-btn").addEventListener("click",()=>{ue()});function qs(e){const s=URL.createObjectURL(e),t=document.createElement("a");t.href=s,t.download=e.name,document.body.appendChild(t),t.click(),document.body.removeChild(t),URL.revokeObjectURL(s),setTimeout(()=>{me("Ø¢ÛŒØ§ ÙØ§ÛŒÙ„ Ù¾Ø´ØªÛŒØ¨Ø§Ù† Ø¨Ø§ Ù…ÙˆÙÙ‚ÛŒØª Ø°Ø®ÛŒØ±Ù‡ Ø´Ø¯ØŸ",()=>{wi(),Es(),j("âœ… ØªØ§Ø±ÛŒØ® Ù¾Ø´ØªÛŒØ¨Ø§Ù† Ø«Ø¨Øª Ø´Ø¯.")},{confirmText:"Ø¨Ù„Ù‡ØŒ Ø°Ø®ÛŒØ±Ù‡ Ø´Ø¯",cancelText:"Ø®ÛŒØ±",confirmClass:"btn-success"})},500)}function Gs(e,s){e.preventDefault(),Mt(),Zt=e.target.closest("li"),Zt&&Zt.classList.add("context-menu-target"),setTimeout(()=>{const t=$t,c=t.querySelector("ul");c.innerHTML="",s.forEach(l=>{const f=document.createElement("li");l.isSeparator?f.className="separator":(f.innerHTML=`
                    <span class="icon">${l.icon||""}</span>
                    <span class="label">${l.label}</span>
                `,l.className&&f.classList.add(l.className),f.addEventListener("click",()=>{l.action(),Mt()})),c.appendChild(f)}),t.classList.add("visible");const{offsetWidth:r,offsetHeight:n}=t,{innerHeight:a}=window,i=document.body.getBoundingClientRect();t.style.top=`${(a-n)/2}px`;const o=i.left+i.width/2;t.style.left=`${o-r/2}px`},50)}function Mt(){$t.classList.contains("visible")&&$t.classList.remove("visible"),Zt&&(Zt.classList.remove("context-menu-target"),Zt=null)}function ir(){var t;jt.innerHTML="";const e=document.getElementById("header-settings-btn");if(!e)return;const s=[];if(s.push({label:"Ú©Ù„Ø§Ø³â€ŒÙ‡Ø§",handler:()=>{Ge(null),rt(null),kt(null),Ee("class-management-page")}}),N){s.push({label:N.info.name,handler:()=>{rt(null),kt(null),qe(),Ee("session-page")}});const c=(t=document.querySelector(".page.active"))==null?void 0:t.id;if(c==="session-page"?e.style.visibility="visible":e.style.visibility="hidden",c==="settings-page")s.push({label:"ØªÙ†Ø¸ÛŒÙ…Ø§Øª"});else if(K){const n=lt(N).get(K.sessionNumber)||` (#${K.sessionNumber})`;s.push({label:`Ø¬Ù„Ø³Ù‡ ${n}`,handler:()=>{kt(null),Ln("selector")}}),Se&&s.push({label:`Ù¾Ø±ÙˆÙØ§ÛŒÙ„: ${Se.identity.name}`})}}else e.style.visibility="hidden";if(s.length<=1){jt.style.display="none";return}jt.style.display="flex",s.forEach((c,r)=>{const n=document.createElement("a");if(n.textContent=c.label,n.className="breadcrumb-item",r===s.length-1||!c.handler?n.classList.add("active"):n.addEventListener("click",c.handler),jt.appendChild(n),r<s.length-1){const a=document.createElement("span");a.className="breadcrumb-separator",a.textContent="/",jt.appendChild(a)}})}function Gi(e,s,t){t.innerHTML="";const c=N.sessions.filter(r=>{var n;return!r.isDeleted&&!r.isCancelled&&((n=r.studentRecords[e.identity.studentId])==null?void 0:n.attendance)==="absent"}).map(r=>({number:s.get(r.sessionNumber),isMakeup:r.isMakeup})).filter(r=>r.number!==void 0);c.length>0?(t.appendChild(document.createTextNode("Ø¬Ù„Ø³Ø§Øª ØºØ§ÛŒØ¨: ")),c.forEach((r,n)=>{const a=document.createElement("span");a.textContent=r.number,r.isMakeup&&a.classList.add("makeup-absence"),t.appendChild(a),n<c.length-1&&t.appendChild(document.createTextNode("ØŒ "))})):t.textContent="Ø¬Ù„Ø³Ø§Øª ØºØ§ÛŒØ¨: Ø¨Ø¯ÙˆÙ† ØºÛŒØ¨Øª"}function Un(e,s,t,c={}){const{includePrefix:r=!0}=c;t.innerHTML="";const n=N.sessions.filter(a=>{if(a.isDeleted||a.isCancelled)return!1;const i=a.studentRecords[e.identity.studentId];return i&&i.homework&&(i.homework.status==="incomplete"||i.homework.status==="none")}).map(a=>({number:s.get(a.sessionNumber),status:a.studentRecords[e.identity.studentId].homework.status})).filter(a=>a.number!==void 0);n.length>0?(r&&t.appendChild(document.createTextNode("ØªÚ©Ø§Ù„ÛŒÙ Ù†Ø§Ù‚Øµ: ")),n.forEach((a,i)=>{const o=document.createElement("span");o.textContent=a.number,a.status==="incomplete"&&o.classList.add("incomplete-homework"),t.appendChild(o),i<n.length-1&&t.appendChild(document.createTextNode("ØŒ"))})):r?t.textContent="ØªÚ©Ø§Ù„ÛŒÙ Ù†Ø§Ù‚Øµ: Ù†Ø¯Ø§Ø±Ø¯":t.textContent="Ù†Ø¯Ø§Ø±Ø¯"}function cc(e,s){var L,B,M;const t=document.createElement("li");t.className="attendance-list-item";const c=document.createElement("span");c.className="absence-info";const r=document.createElement("span");r.className="homework-info";const n=document.createElement("div");n.className="att-row-1";let a=!1;n.addEventListener("mousedown",()=>a=!1),n.addEventListener("touchstart",()=>a=!1,{passive:!0});const i=document.createElement("input");i.type="checkbox",i.className="mass-comment-checkbox",i.checked=Ot.includes(e.identity.studentId),i.addEventListener("change",()=>{const U=e.identity.studentId,Q=Ot;if(i.checked)Q.includes(U)||Q.push(U);else{const z=Q.indexOf(U);z>-1&&Q.splice(z,1)}Ri();const I=document.getElementById("attendance-list");Q.length===0&&I.classList.contains("selection-mode-active")&&I.classList.remove("selection-mode-active")});const o=document.createElement("span");o.className="student-name",o.textContent=e.identity.firstName&&e.identity.lastName?`${e.identity.lastName}ØŒ ${e.identity.firstName}`:e.identity.name,o.addEventListener("click",U=>{if(a){U.stopPropagation(),U.preventDefault(),a=!1;return}Ue(e)}),Nt(n,U=>{a=!0;const Q=document.getElementById("attendance-list");Q.classList.contains("selection-mode-active")||Q.classList.add("selection-mode-active"),i.checked||(i.checked=!0,i.dispatchEvent(new Event("change")))}),n.appendChild(i),n.appendChild(o);const l=document.createElement("div");l.className="att-row-2";const f=document.createElement("button");let h=!1;f.addEventListener("mousedown",()=>h=!1),f.addEventListener("touchstart",()=>h=!1,{passive:!0});const m=((L=K.studentRecords[e.identity.studentId])==null?void 0:L.attendance)||"present",u=U=>{U==="present"?(f.textContent="Ø­Ø§Ø¶Ø±",f.className="attendance-status-btn present active"):(f.textContent="ØºØ§ÛŒØ¨",f.className="attendance-status-btn absent active")};u(m),f.addEventListener("click",U=>{var z;if(h){U.stopPropagation();return}const I=(((z=K.studentRecords[e.identity.studentId])==null?void 0:z.attendance)||"present")==="present"?"absent":"present";K.setAttendance(e.identity.studentId,I),I==="absent"&&(K.studentRecords[e.identity.studentId].hadIssue=!1),se(),u(I),Gi(e,s,c),Re(),ur()}),Nt(f,()=>{h=!0;const U=m==="present"?"absent":"present",Q=U==="present"?"Ø­Ø§Ø¶Ø±":"ØºØ§ÛŒØ¨";me(`Ø¢ÛŒØ§ Ù…Ø·Ù…Ø¦Ù† Ù‡Ø³ØªÛŒØ¯ Ú©Ù‡ Ù…ÛŒâ€ŒØ®ÙˆØ§Ù‡ÛŒØ¯ ÙˆØ¶Ø¹ÛŒØª Ø­Ø¶ÙˆØ± ØªÙ…Ø§Ù… Ø¯Ø§Ù†Ø´â€ŒØ¢Ù…ÙˆØ²Ø§Ù† Ø±Ø§ Ø¨Ù‡ Â«${Q}Â» ØªØºÛŒÛŒØ± Ø¯Ù‡ÛŒØ¯ØŸ`,()=>{ge(N.students).forEach(I=>{K.setAttendance(I.identity.studentId,U),U==="absent"&&(K.studentRecords[I.identity.studentId].hadIssue=!1)}),se(),ot(),j(`âœ… ÙˆØ¶Ø¹ÛŒØª ØªÙ…Ø§Ù… Ø¯Ø§Ù†Ø´â€ŒØ¢Ù…ÙˆØ²Ø§Ù† Ø¨Ù‡ Â«${Q}Â» ØªØºÛŒÛŒØ± ÛŒØ§ÙØª.`)},{confirmText:"Ø¨Ù„Ù‡ØŒ Ø§Ø¹Ù…Ø§Ù„ Ú©Ù†",confirmClass:"btn-warning"})});const y=document.createElement("div");y.className="homework-controls";const p={none:"Ø¨Ø¯ÙˆÙ† ØªÚ©Ù„ÛŒÙ",complete:"ØªÚ©Ù„ÛŒÙ Ú©Ø§Ù…Ù„",incomplete:"ØªÚ©Ù„ÛŒÙ Ù†Ø§Ù‚Øµ"},b=document.createElement("button");let v=!1;b.addEventListener("mousedown",()=>v=!1),b.addEventListener("touchstart",()=>v=!1,{passive:!0});const C=((B=K.studentRecords[e.identity.studentId])==null?void 0:B.homework.status)||"none";b.className=`homework-status-btn ${C}`,b.title=p[C],b.addEventListener("click",U=>{if(v){U.stopPropagation();return}const Q=K.studentRecords[e.identity.studentId].homework,z={none:"incomplete",incomplete:"complete",complete:"none"}[Q.status];K.setHomeworkStatus(e.identity.studentId,z),se(),b.className=`homework-status-btn ${z}`,b.title=p[z],Un(e,s,r)}),Nt(b,()=>{v=!0;const Q={none:"incomplete",incomplete:"complete",complete:"none"}[C],I=p[Q];me(`Ø¢ÛŒØ§ Ø§Ø² ØªØºÛŒÛŒØ± ÙˆØ¶Ø¹ÛŒØª ØªÚ©Ù„ÛŒÙ ØªÙ…Ø§Ù… Ø¯Ø§Ù†Ø´â€ŒØ¢Ù…ÙˆØ²Ø§Ù† Ø¨Ù‡ Â«${I}Â» Ù…Ø·Ù…Ø¦Ù† Ù‡Ø³ØªÛŒØ¯ØŸ`,()=>{ge(N.students).forEach(z=>{K.setHomeworkStatus(z.identity.studentId,Q)}),se(),ot(),j(`âœ… ÙˆØ¶Ø¹ÛŒØª ØªÚ©Ù„ÛŒÙ Ù‡Ù…Ù‡ Ø¨Ù‡ Â«${I}Â» ØªØºÛŒÛŒØ± ÛŒØ§ÙØª.`)},{confirmText:"Ø¨Ù„Ù‡",confirmClass:"btn-warning"})});const S=document.createElement("button");let _=!1;S.addEventListener("mousedown",()=>_=!1),S.addEventListener("touchstart",()=>_=!1,{passive:!0}),S.className="btn-icon",S.innerHTML="ðŸ“",S.title="Ø§ÙØ²ÙˆØ¯Ù† ÛŒØ§Ø¯Ø¯Ø§Ø´Øª Ø¨Ø±Ø§ÛŒ ØªÚ©Ù„ÛŒÙ",((M=K.studentRecords[e.identity.studentId])==null?void 0:M.homework.comment)||(S.style.opacity="0.3"),S.addEventListener("click",U=>{if(_){U.stopPropagation();return}const Q=K.studentRecords[e.identity.studentId].homework;ye.value=Q.comment||"",ye.dispatchEvent(new Event("input",{bubbles:!0})),dt(I=>{Q.comment=I;const z=lt(N),g=z.get(K.sessionNumber),F={type:"fromAttendance",sessionNumber:K.sessionNumber},re=`ÛŒØ§Ø¯Ø¯Ø§Ø´Øª Ø¬Ù„Ø³Ù‡ ${g}:
`,G=e.profile.notes.find(de=>!de.isDeleted&&de.source&&de.source.type==="fromAttendance"&&de.source.sessionNumber===F.sessionNumber);G?I?G.content=re+I:G.isDeleted=!0:I&&e.addNote(re+I,F),se(),j("âœ…ÛŒØ§Ø¯Ø¯Ø§Ø´Øª ØªÚ©Ù„ÛŒÙ Ø°Ø®ÛŒØ±Ù‡ Ø´Ø¯."),S.style.opacity=I?"1":"0.3",Un(e,z,r)}),De("add-note-modal"),ye.focus()}),Nt(S,()=>{_=!0,me("Ø¢ÛŒØ§ Ù…ÛŒâ€ŒØ®ÙˆØ§Ù‡ÛŒØ¯ Ø¨Ø±Ø§ÛŒ **ØªÙ…Ø§Ù…** Ø¯Ø§Ù†Ø´â€ŒØ¢Ù…ÙˆØ²Ø§Ù† Ú©Ù„Ø§Ø³ ÛŒØ§Ø¯Ø¯Ø§Ø´Øª ØªÚ©Ù„ÛŒÙ Ø«Ø¨Øª Ú©Ù†ÛŒØ¯ØŸ",()=>{const U=ge(N.students).map(Q=>Q.identity.studentId);bn(U),zi()},{confirmText:"Ø¨Ù„Ù‡",confirmClass:"btn-primary"})}),l.appendChild(f),y.appendChild(S),y.appendChild(b),l.appendChild(y);const x=document.createElement("div");return x.className="att-row-3",Gi(e,s,c),Un(e,s,r),x.appendChild(c),x.appendChild(r),t.appendChild(n),t.appendChild(l),t.appendChild(x),t}function lc(){return lt(N).get(K.sessionNumber)}function ot(){const e=ge(N.students),s=In(e);if(!N||!K)return;s.forEach(a=>{K.initializeStudentRecord(a.identity.studentId)}),bn([]);const t=lt(N);Cc(),dn.innerHTML="";const c=document.createElement("li");c.className="attendance-list-header",Bt.id="attendance-search-input",Bt.type="text",Bt.className="inline-search-input",Bt.placeholder="Ø¬Ø³ØªØ¬Ùˆ...",Bt.value="";const r=document.createElement("div");r.className="student-search-container",r.appendChild(Bt);const n=document.createElement("div");n.className="header-labels-container",n.innerHTML=`
    <span class="header-label">ØªÚ©Ù„ÛŒÙ</span>
    <span class="header-label">Ø­Ø¶ÙˆØ±</span>
`,c.appendChild(r),c.appendChild(n),dn.appendChild(c),s.forEach(a=>{const i=cc(a,t);dn.appendChild(i)}),bn([]),Ri(),wc(),ur()}function Re(){const e=document.getElementById("student-stats-table-container");if(!e||(e.innerHTML="",!N))return;ge(N.students).length,Ps.textContent="Ø¢Ù…Ø§Ø± Ø¹Ù…Ù„Ú©Ø±Ø¯";const s=["Ù†Ø§Ù…"],t=["Ú©Ù„ Ø§Ù†ØªØ®Ø§Ø¨ Ù‡Ø§","ØºÛŒØ¨Øª","Ø®Ø±ÙˆØ¬","ÙØ±ØµØª Ø§Ø²Ø¯Ø³Øªâ€ŒØ±ÙØªÙ‡","Ù…Ø´Ú©Ù„","Ù…ÛŒØ§Ù†Ú¯ÛŒÙ†","Ù†Ù…Ø±Ù‡ Ù†Ù‡Ø§ÛŒÛŒ"],c=N.categories.filter(u=>u.isGradedCategory&&!u.isDeleted).map(u=>u.name),r=[...s,...c,...t],n=document.createElement("table");n.className="student-stats-table";const i=n.createTHead().insertRow();r.forEach((u,y)=>{const p=document.createElement("th");y===0?(p.innerHTML=`${u} <span style="opacity: 0.6;">ðŸ”—</span>`,p.title="Ø±Ø¯ÛŒÙâ€ŒÙ‡Ø§ÛŒ Ø§ÛŒÙ† Ø³ØªÙˆÙ† Ù‚Ø§Ø¨Ù„ Ú©Ù„ÛŒÚ© Ù‡Ø³ØªÙ†Ø¯"):p.textContent=u,i.appendChild(p)});const o=n.createTBody(),l=In(ge(N.students)),f=u=>{let y=0;return N.sessions.forEach(p=>{if(p.isDeleted||p.isCancelled)return;const b=p.studentRecords[u.identity.studentId];b&&b.attendance==="absent"&&y++}),y};l.forEach(u=>{const y=o.insertRow();if(y.dataset.studentId=u.identity.studentId,K){const _=K.studentRecords[u.identity.studentId];_&&_.attendance==="absent"&&y.classList.add("absent-row-highlight")}const p=y.insertCell(),b=document.createElement("span");b.textContent=`${u.identity.lastName}ØŒ ${u.identity.firstName}`,b.className="student-name-link",b.addEventListener("click",()=>{Ue(u)}),p.appendChild(b),c.forEach(_=>{var B;const k=y.insertCell();k.style.direction="ltr";const x=_.toLowerCase(),L=((B=u.logs.scores[x])==null?void 0:B.filter(M=>!M.isDeleted))||[];L.length>0?L.forEach((M,U)=>{const Q=document.createElement("span");Q.textContent=M.value+(M.comment?"'":""),Q.style.position="relative",M.comment&&(Q.dataset.tooltip=M.comment),k.appendChild(Q),U<L.length-1&&k.appendChild(document.createTextNode(","))}):k.textContent="",k.style.cursor="pointer",k.addEventListener("click",()=>{Ae(u,_);const M=document.getElementById("category-selection-container");M&&M.scrollIntoView({behavior:"smooth",block:"center"})})}),y.insertCell().textContent=u.statusCounters.totalSelections||0,y.insertCell().textContent=f(u),y.insertCell().textContent=u.statusCounters.outOfClassCount||0,y.insertCell().textContent=u.statusCounters.missedChances||0;const v=Object.values(u.categoryIssues||{}).reduce((_,k)=>_+k,0);y.insertCell().textContent=v;const C=u.getOverallAverageScore();y.insertCell().textContent=C!==null?C:"-";const S=N.calculateFinalStudentScore(u);y.insertCell().textContent=S!==null?S:"-"}),ge(N.students),Ps.setAttribute("data-student-count",l.length),e.appendChild(n);const h=e.querySelector(".student-stats-table"),m=h==null?void 0:h.querySelector("thead th:first-child");m&&m.addEventListener("click",()=>{h.classList.toggle("name-column-expanded")})}function yt(){const e=document.getElementById("selected-student-result");e&&(e.innerHTML="",e.classList.remove("absent"),ps(null))}function Ae(e=null,s=null){yt();const t=_c(e,s);if(!t)return;const{winner:c,categoryName:r}=t;kc(c,r);const n=document.getElementById("selected-student-result"),a=!e,i=K.studentRecords[c.identity.studentId],{nameContainer:o}=Ic(c,r,a);n.appendChild(o);const l=xc(c,i,r);if(n.appendChild(l),r&&typeof Zi=="function"){const h=Zi(c,r);h&&n.appendChild(h)}const f=Lc(c);n.appendChild(f)}function Pi(e){e.addEventListener("input",()=>{const s=e.value,t=vs(s);e.setAttribute("dir",t)})}function dc(){Fi(null),un.innerHTML="",yt(),qt.classList.add("tooltip-container"),Ye.disabled=!0,Xe.disabled=!0,It.disabled=!0,Ye.value="",Xe.value="",zt.classList.add("disabled-wrapper"),Qe.disabled=!0}function Wn(){un.innerHTML="",N.categories.filter(t=>!t.isDeleted).forEach(t=>{const c=document.createElement("span");c.className="pill",c.textContent=t.name,c.dataset.categoryId=t.id,t.description&&(c.dataset.tooltip=t.description),K.isFinished?c.classList.add("disabled"):c.addEventListener("click",()=>{if(document.querySelectorAll("#category-selection-container .pill").forEach(n=>n.classList.remove("active")),c.classList.add("active"),!t.isGradedCategory&&_t){Cs=!0,Wi(),yt();return}ar(t,c),es(t),Fi(t),Zs(t),Sn(t),Xt(t.name),zt.classList.remove("disabled-wrapper"),Qe.disabled=K.isFinished;const r=K.lastWinnerByCategory[t.name];if(r){const n=N.students.find(a=>a.identity.studentId===r);n&&Ae(n,t.name)}else{yt(),Jt(null),bt(-1),Qe.disabled=!1;const n=document.querySelector(".current-winner-highlight");n&&n.classList.remove("current-winner-highlight")}}),K.isFinished||xn(c,()=>[{label:"ØªØºÛŒÛŒØ± Ù†Ø§Ù…",icon:"âœï¸",action:()=>{kn(),Ws((r,n,a)=>{const i=da(N,t,r);i.success?(t.isGradedCategory=n,t.weight=a,se(),be(N.info.name,`Ù†Ø§Ù… Ø¯Ø³ØªÙ‡â€ŒØ¨Ù†Ø¯ÛŒ Â«${t.name}Â» Ø¨Ù‡ Â«${r}Â» ØªØºÛŒÛŒØ± ÛŒØ§ÙØª.`),Wn(),Re(),Zs(t),j(`âœ… Ù†Ø§Ù… Ø¯Ø³ØªÙ‡â€ŒØ¨Ù†Ø¯ÛŒ Ø¨Ù‡ Â«${r}Â» ØªØºÛŒÛŒØ± ÛŒØ§ÙØª.`)):j(`âš ï¸ ${i.message}`)},{title:"ÙˆÛŒØ±Ø§ÛŒØ´ Ø¯Ø³ØªÙ‡â€ŒØ¨Ù†Ø¯ÛŒ",initialName:t.name,initialIsGraded:t.isGradedCategory,initialWeight:t.weight||1,saveButtonText:"Ø°Ø®ÛŒØ±Ù‡ ØªØºÛŒÛŒØ±Ø§Øª"})}},{label:"Ø­Ø°Ù Ø¯Ø³ØªÙ‡â€ŒØ¨Ù†Ø¯ÛŒ",icon:"ðŸ—‘ï¸",className:"danger",action:()=>{me(`Ø¢ÛŒØ§ Ø§Ø² Ø§Ù†ØªÙ‚Ø§Ù„ Ø¯Ø³ØªÙ‡â€ŒØ¨Ù†Ø¯ÛŒ Â«${t.name}Â» Ø¨Ù‡ Ø³Ø·Ù„ Ø²Ø¨Ø§Ù„Ù‡ Ù…Ø·Ù…Ø¦Ù† Ù‡Ø³ØªÛŒØ¯ØŸ`,()=>{const r={id:`trash_${Date.now()}_${Math.random()}`,timestamp:new Date().toISOString(),type:"category",description:`Ø¯Ø³ØªÙ‡â€ŒØ¨Ù†Ø¯ÛŒ Â«${t.name}Â» Ø§Ø² Ú©Ù„Ø§Ø³ Â«${N.info.name}Â»`,restoreData:{categoryId:t.id,classId:N.info.scheduleCode}};ct(r);const n=t.name.toLowerCase();if(N.students.forEach(a=>{var i;(i=a.logs.scores)!=null&&i[n]&&a.logs.scores[n].forEach(o=>o.isDeleted=!0)}),(Le==null?void 0:Le.id)===t.id){es(null),yt(),Sn(null),Xt(null),zt.classList.add("disabled-wrapper"),Qe.disabled=!0;const a=document.querySelector(".current-winner-highlight");a&&a.classList.remove("current-winner-highlight")}t.isDeleted=!0,be(N.info.name,`Ø¯Ø³ØªÙ‡â€ŒØ¨Ù†Ø¯ÛŒ Â«${t.name}Â» Ø¨Ù‡ Ø³Ø·Ù„ Ø²Ø¨Ø§Ù„Ù‡ Ù…Ù†ØªÙ‚Ù„ Ø´Ø¯.`,{type:"VIEW_TRASH"}),se(),Wn(),Re(),j(`âœ… Ø¯Ø³ØªÙ‡â€ŒØ¨Ù†Ø¯ÛŒ Â«${t.name}Â» Ø¨Ù‡ Ø³Ø·Ù„ Ø²Ø¨Ø§Ù„Ù‡ Ù…Ù†ØªÙ‚Ù„ Ø´Ø¯.`)},{confirmText:"Ø¨Ù„Ù‡",confirmClass:"btn-warning"})}}]),un.appendChild(c)});const s=document.createElement("span");s.className="pill add-category-pill",s.textContent="+",s.title="Ø§ÙØ²ÙˆØ¯Ù† Ø¯Ø³ØªÙ‡â€ŒØ¨Ù†Ø¯ÛŒ Ø¬Ø¯ÛŒØ¯",K.isFinished?s.classList.add("disabled"):s.addEventListener("click",()=>{kn(),Ws((t,c,r)=>{if(N.categories.find(i=>i.name.toLowerCase()===t.toLowerCase()&&!i.isDeleted)){j("âš ï¸ Ø§ÛŒÙ† Ø¯Ø³ØªÙ‡â€ŒØ¨Ù†Ø¯ÛŒ Ø§Ø² Ù‚Ø¨Ù„ ÙˆØ¬ÙˆØ¯ Ø¯Ø§Ø±Ø¯.");return}const a=new hn(t,"",c,r);N.categories.push(a),se(),be(N.info.name,`Ø¯Ø³ØªÙ‡â€ŒØ¨Ù†Ø¯ÛŒ Ø¬Ø¯ÛŒØ¯ Â«${t}Â» Ø§Ø¶Ø§ÙÙ‡ Ø´Ø¯.`,{type:"VIEW_CLASS_SETTINGS"}),Wn(),j(`âœ… Ø¯Ø³ØªÙ‡â€ŒØ¨Ù†Ø¯ÛŒ Â«${t}Â» Ø§Ø¶Ø§ÙÙ‡ Ø´Ø¯.`)},{initialWeight:1})}),un.appendChild(s)}function ar(e,s){e.isGradedCategory&&s.classList.add("graded-category-pill")}function uc(){if(K.lastUsedCategoryId){if(K.isFinished)return;const e=un.querySelector(`.pill[data-category-id="${K.lastUsedCategoryId}"]`);e&&e.click()}K.winnerHistory&&K.winnerHistory.length>0&&(bt(K.winnerHistory.length-1),Ae())}function Fi(e){e?Qe.textContent=`Ù†ÙØ± Ø¨Ø¹Ø¯ÛŒ Ø¯Ø± ${e.name}`:Qe.textContent="Ù†ÙØ± Ø¨Ø¹Ø¯ÛŒ"}function Zs(e){e&&e.isGradedCategory?(sn.textContent=`Ø¶Ø±ÛŒØ¨: ${e.weight||1}`,sn.style.display="inline-block",sn.style.visibility="visible"):sn.style.display="none"}function ds(e,s){const t=document.getElementById("qualitative-stats-label");if(!t)return;if(!e){t.textContent="...";return}const c=e.qualitativeStats[s.name]||{excellent:0,good:0,effort:0},r=Object.values(e.qualitativeStats).reduce((a,i)=>(a.excellent+=i.excellent||0,a.good+=i.good||0,a.effort+=i.effort||0,a),{excellent:0,good:0,effort:0}),n=a=>`
        <span class="stat-excellent">${a.excellent}</span>ØŒ 
        <span class="stat-good">${a.good}</span>ØŒ 
        <span class="stat-effort">${a.effort}</span>
    `;t.innerHTML=`Ø§ÛŒÙ† Ø¯Ø³ØªÙ‡â€ŒØ¨Ù†Ø¯ÛŒ: ${n(c)} | Ú©Ù„: ${n(r)}`}function Sn(e){if(K.isFinished){Ye.disabled=!0,Xe.disabled=!0,It.disabled=!0,qt.setAttribute("title","Ø¬Ù„Ø³Ù‡ Ø®Ø§ØªÙ…Ù‡ ÛŒØ§ÙØªÙ‡ Ø§Ø³Øª");return}e&&e.isGradedCategory?(Ye.disabled=!1,Xe.disabled=!1,It.disabled=!1,qt.removeAttribute("title")):(Ye.disabled=!0,Xe.disabled=!0,It.disabled=!0,e?qt.setAttribute("title","Ø¨Ø±Ø§ÛŒ Ø§ÛŒÙ† Ø¯Ø³ØªÙ‡â€ŒØ¨Ù†Ø¯ÛŒ Ù‚Ø§Ø¨Ù„ÛŒØª Ù†Ù…Ø±Ù‡ Ø¯Ù‡ÛŒ ØªØ¹Ø±ÛŒÙ Ù†Ø´Ø¯Ù‡ Ø§Ø³Øª"):qt.setAttribute("title","Ø§Ø¨ØªØ¯Ø§ ÛŒÚ© Ø¯Ø³ØªÙ‡â€ŒØ¨Ù†Ø¯ÛŒ Ø±Ø§ Ø§Ù†ØªØ®Ø§Ø¨ Ú©Ù†ÛŒØ¯"))}function Xt(e){const s=document.querySelector(".student-stats-table");if(!s||(s.querySelectorAll(".current-category-highlight").forEach(a=>{a.classList.remove("current-category-highlight")}),!e))return;let c=-1;const r=s.querySelectorAll("thead th");if(r.forEach((a,i)=>{a.textContent.trim()===e&&(c=i)}),c===-1)return;r[c].classList.add("current-category-highlight"),s.querySelectorAll("tbody tr").forEach(a=>{const i=a.cells[c];i&&i.classList.add("current-category-highlight")})}function Ue(e){kt(e);const s=document.getElementById("student-profile-modal"),t=document.getElementById("modal-profile-student-name"),c=document.getElementById("modal-profile-content-container"),r=document.getElementById("modal-profile-close-btn");if(!s||!t||!c||!r)return;t.textContent=`Ù¾Ø±ÙˆÙØ§ÛŒÙ„: ${e.identity.name}`,t.style.cursor="pointer",t.onclick=()=>{const f=Se,h=N;ue(()=>{Oi(f,h)})},c.innerHTML="";const n=document.createElement("div");n.className="profile-header-actions";const a=document.createElement("button");a.className="btn-icon btn-icon-label",a.title="Ø§Ù†ØªÙ‚Ø§Ù„ Ø¯Ø§Ù†Ø´â€ŒØ¢Ù…ÙˆØ²",a.innerHTML="<span>âž¡ï¸</span><span>Ø§Ù†ØªÙ‚Ø§Ù„</span>",a.addEventListener("click",()=>{const f=Se,h=N;ue(()=>{Mi(f,h)})});const i=document.createElement("button");i.className="btn-icon btn-icon-label",i.title="Ø­Ø°Ù Ø¯Ø§Ù†Ø´â€ŒØ¢Ù…ÙˆØ²",i.innerHTML="<span>ðŸ—‘ï¸</span><span>Ø­Ø°Ù</span>",i.style.color="var(--color-strong-warning)",i.addEventListener("click",()=>{const f=Se,h=N;ue(()=>{me(`Ø¢ÛŒØ§ Ø§Ø² Ø§Ù†ØªÙ‚Ø§Ù„ Ø¯Ø§Ù†Ø´â€ŒØ¢Ù…ÙˆØ² Â«${f.identity.name}Â» Ø¨Ù‡ Ø³Ø·Ù„ Ø²Ø¨Ø§Ù„Ù‡ Ù…Ø·Ù…Ø¦Ù† Ù‡Ø³ØªÛŒØ¯ØŸ`,()=>{const m={id:`trash_${Date.now()}_${Math.random()}`,timestamp:new Date().toISOString(),type:"student",description:`Ø¯Ø§Ù†Ø´â€ŒØ¢Ù…ÙˆØ² Â«${f.identity.name}Â» Ø§Ø² Ú©Ù„Ø§Ø³ Â«${h.info.name}Â»`,restoreData:{studentId:f.identity.studentId,classId:h.info.scheduleCode}};ct(m),f.isDeleted=!0,be(h.info.name,`Ø¯Ø§Ù†Ø´â€ŒØ¢Ù…ÙˆØ² Â«${f.identity.name}Â» Ø¨Ù‡ Ø³Ø·Ù„ Ø²Ø¨Ø§Ù„Ù‡ Ù…Ù†ØªÙ‚Ù„ Ø´Ø¯.`,{type:"VIEW_TRASH"}),se(),Lt(),Re(),ot(),j(`âœ… Ø¯Ø§Ù†Ø´â€ŒØ¢Ù…ÙˆØ² Â«${f.identity.name}Â» Ø¨Ù‡ Ø³Ø·Ù„ Ø²Ø¨Ø§Ù„Ù‡ Ù…Ù†ØªÙ‚Ù„ Ø´Ø¯.`)},{confirmText:"Ø¨Ù„Ù‡",confirmClass:"btn-warning",isDelete:!0,onCancel:()=>{Ue(f)}})})});const o=document.createElement("button");o.className="btn-icon btn-icon-label",o.title="Ú¯Ø²Ø§Ø±Ø´ ÙˆØ¶Ø¹ÛŒØª Ø¯Ø§Ù†Ø´â€ŒØ¢Ù…ÙˆØ²",o.innerHTML="<span>ðŸ“Š</span><span>Ú¯Ø²Ø§Ø±Ø´</span>",o.addEventListener("click",()=>{j("ðŸ—ï¸ Ø§ÛŒÙ† Ù‚Ø§Ø¨Ù„ÛŒØª Ø¯Ø± Ù†Ø³Ø®Ù‡â€ŒÙ‡Ø§ÛŒ Ø¢ÛŒÙ†Ø¯Ù‡ ÙØ¹Ø§Ù„ Ø®ÙˆØ§Ù‡Ø¯ Ø´Ø¯.")}),n.appendChild(o);const l=document.createElement("button");l.className="btn-icon btn-icon-label",l.title="Ø§ÙØ²ÙˆØ¯Ù† ÛŒØ§Ø¯Ø¯Ø§Ø´Øª Ø¬Ø¯ÛŒØ¯",l.innerHTML="<span>ðŸ“</span><span>ÛŒØ§Ø¯Ø¯Ø§Ø´Øª</span>",l.addEventListener("click",()=>{const f=Se;ye.value="",ye.dispatchEvent(new Event("input",{bubbles:!0})),dt(h=>{if(h)return f.addNote(h),se(),be(N.info.name,`ÛŒØ§Ø¯Ø¯Ø§Ø´Øª Ø¬Ø¯ÛŒØ¯ÛŒ Ø¨Ø±Ø§ÛŒ Ø¯Ø§Ù†Ø´â€ŒØ¢Ù…ÙˆØ² Â«${f.identity.name}Â» Ø«Ø¨Øª Ø´Ø¯.`,{type:"VIEW_STUDENT_PROFILE",studentId:f.identity.studentId}),Ae(),j("âœ… ÛŒØ§Ø¯Ø¯Ø§Ø´Øª Ø¨Ø§ Ù…ÙˆÙÙ‚ÛŒØª Ø«Ø¨Øª Ø´Ø¯."),()=>Ue(f)}),ue(()=>{De("add-note-modal"),ye.focus()})}),n.appendChild(a),n.appendChild(i),n.appendChild(l),c.appendChild(n),fc(c),rr(c),r.onclick=()=>ue(),De("student-profile-modal")}function fc(e){if(!Se||!N)return;const s=document.createElement("div");s.className="scoring-section",s.innerHTML=`
    <h3>Ø«Ø¨Øª Ù†Ù…Ø±Ù‡ Ø¬Ø¯ÛŒØ¯</h3>
    <div id="modal-graded-pills" class="category-pills"></div>
    <div class="input-group" style="margin-top: 15px; display: flex; gap: 10px;">
        <input type="number" id="modal-new-score-value" placeholder="Ù†Ù…Ø±Ù‡" style="width: 70px; text-align: center;">
        <input type="text" id="modal-new-score-comment" placeholder="ØªÙˆØ¶ÛŒØ­Ø§Øª (Ø§Ø®ØªÛŒØ§Ø±ÛŒ)..." style="flex-grow: 1;">
    </div>
    <button id="modal-add-score-btn" class="btn-success" style="width: 100%; margin-top: 10px;">Ø«Ø¨Øª Ù†Ù…Ø±Ù‡</button>
`,Pi(s.querySelector("#modal-new-score-comment"));const t=s.querySelector("#modal-graded-pills");ge(N.categories).filter(i=>i.isGradedCategory).forEach(i=>{const o=document.createElement("span");o.className="pill",o.textContent=i.name,o.dataset.skillName=i.name,o.addEventListener("click",()=>{t.querySelectorAll(".pill").forEach(l=>l.classList.remove("active")),o.classList.add("active"),ar(i,o)}),t.appendChild(o)});const r=s.querySelector("#modal-add-score-btn"),n=s.querySelector("#modal-new-score-value"),a=s.querySelector("#modal-new-score-comment");ss(n,"Enter",()=>{r.click(),Cn(n)}),Ii(n),ss(a,"Enter",()=>{r.click(),Cn(a)}),r.addEventListener("click",()=>{const i=t.querySelector(".pill.active");if(!i){j("âš ï¸Ù„Ø·ÙØ§Ù‹ ÛŒÚ© Ù…Ù‡Ø§Ø±Øª Ø±Ø§ Ø¨Ø±Ø§ÛŒ Ù†Ù…Ø±Ù‡â€ŒØ¯Ù‡ÛŒ Ø§Ù†ØªØ®Ø§Ø¨ Ú©Ù†ÛŒØ¯.");return}const o=i.dataset.skillName,l=n.value,f=a.value.trim();if(!l){j("Ù„Ø·ÙØ§Ù‹ Ù…Ù‚Ø¯Ø§Ø± Ù†Ù…Ø±Ù‡ Ø±Ø§ ÙˆØ§Ø±Ø¯ Ú©Ù†ÛŒØ¯.");return}Se.addScore(o,parseFloat(l),f),se(),be(N.info.name,`Ù†Ù…Ø±Ù‡ ${l} Ø¯Ø± ${o} Ø¨Ø±Ø§ÛŒ Â«${Se.identity.name}Â» Ø«Ø¨Øª Ø´Ø¯.`,{type:"VIEW_STUDENT_PROFILE",studentId:Se.identity.studentId}),Re(),Ae(),n.value="",a.value="";const h=document.getElementById("modal-profile-content-container"),m=h.querySelector(".history-section");m&&m.remove(),rr(h),j(`âœ… Ù†Ù…Ø±Ù‡ Ø¨Ø±Ø§ÛŒ Ù…Ù‡Ø§Ø±Øª ${o} Ø¨Ø±Ø§ÛŒ Ø¯Ø§Ù†Ø´ Ø¢Ù…ÙˆØ² ${Se.identity.name} Ø¨Ø§ Ù…ÙˆÙÙ‚ÛŒØª Ø«Ø¨Øª Ø´Ø¯.`)}),e.appendChild(s)}function rr(e){if(!Se)return;const s=document.createElement("div");s.className="history-section";const t=document.createElement("div");t.className="history-section-header";const c=document.createElement("h3");c.textContent="Ø³ÙˆØ§Ø¨Ù‚ Ø¯Ø§Ù†Ø´â€ŒØ¢Ù…ÙˆØ²",t.appendChild(c),s.appendChild(t),mc(s),or(s),cr(s),e.appendChild(s)}function mc(e){if(!Se)return;const s=Se,t=N.sessions.reduce((_,k)=>{const x=k.studentRecords[s.identity.studentId];return _+(x&&x.attendance==="absent"?1:0)},0),c=Object.values(s.categoryIssues||{}).reduce((_,k)=>_+k,0);let r=0,n=0,a=0;const i=s.qualitativeStats||{};Object.values(i).forEach(_=>{r+=_.effort||0,n+=_.good||0,a+=_.excellent||0});const o=r+n+a,l=document.createElement("div");l.className="stats-summary-box",l.innerHTML=`
        <p><strong>Ú©Ù„ Ø§Ù†ØªØ®Ø§Ø¨:</strong> ${s.statusCounters.totalSelections}</p>
        <p><strong>ØºÛŒØ¨Øª:</strong> ${t}</p>
        <p><strong>ÙØ±ØµØª Ø§Ø² Ø¯Ø³Øª Ø±ÙØªÙ‡:</strong> ${s.statusCounters.missedChances||0}</p>
        <p><strong>Ù…Ø´Ú©Ù„:</strong> ${c}</p>
        <p><strong>Ø¹Ù…Ù„Ú©Ø±Ø¯ Ú©ÛŒÙÛŒ:</strong> ${o}</p>
    `,e.appendChild(l),l.querySelector("p:nth-child(1)");const f=l.querySelector("p:nth-child(4)"),h=l.querySelector("p:nth-child(5)");e.appendChild(l);const m=ge(N.categories),u=document.createElement("div");if(u.className="stats-breakdown",m.length>0){m.forEach(k=>{var M;const x=k.name,L=((M=s.categoryCounts)==null?void 0:M[x])||0,B=document.createElement("p");B.className="stats-breakdown-item",B.innerHTML=`<strong>${x}:</strong> ${L}`,u.appendChild(B)});const _=l.querySelector("p:first-child");_&&(_.classList.add("collapsible-toggle"),_.onclick=()=>{u.classList.toggle("open"),_.classList.toggle("open")},_.after(u))}const y=document.createElement("div");y.className="stats-breakdown",m.length>0&&(m.forEach(_=>{var B;const k=_.name,x=((B=s.categoryIssues)==null?void 0:B[k])||0,L=document.createElement("p");L.className="stats-breakdown-item",L.innerHTML=`<strong>${k}:</strong> ${x}`,y.appendChild(L)}),f&&c>0&&(f.classList.add("collapsible-toggle"),f.onclick=()=>{y.classList.toggle("open"),f.classList.toggle("open")},f.after(y)));const p=document.createElement("div");if(p.className="stats-breakdown",o>0){for(const _ in i){const k=i[_];if((k.effort||0)+(k.good||0)+(k.excellent||0)>0){const L=document.createElement("p");L.className="stats-breakdown-item",L.innerHTML=`<strong>${_}:</strong> <span style="color:var(--color-primary)">Ø¹Ø§Ù„ÛŒ:${k.excellent}</span> | <span style="color:var(--color-success)">Ø®ÙˆØ¨:${k.good}</span> | <span style="color:#fd7e14">ØªÙ„Ø§Ø´:${k.effort}</span>`,p.appendChild(L)}}h&&o>0&&(h.classList.add("collapsible-toggle"),h.onclick=()=>{p.classList.toggle("open"),h.classList.toggle("open")},h.after(p))}const b=document.createElement("p"),v=document.createElement("strong");v.textContent="ØªÚ©Ø§Ù„ÛŒÙ Ù†Ø§Ù‚Øµ:";const C=document.createElement("span");C.style.marginRight="5px";const S=lt(N);Un(s,S,C,{includePrefix:!1}),b.appendChild(v),b.appendChild(C),l.appendChild(b)}function or(e){if(!Se)return;const s=Se,t=document.createElement("h4");t.textContent="ØªØ§Ø±ÛŒØ®Ú†Ù‡ Ù†Ù…Ø±Ø§Øª:",t.style.marginTop="20px";const c=s.getOverallAverageScore(),r=document.createElement("span");r.className="profile-avg-badge",r.textContent=` (Ù…ÛŒØ§Ù†Ú¯ÛŒÙ†: ${c!==null?c:"-"})`,t.appendChild(r);const n=N.calculateFinalStudentScore(s),a=document.createElement("span");a.className="profile-avg-badge",a.textContent=` (Ù†Ù…Ø±Ù‡ Ù†Ù‡Ø§ÛŒÛŒ: ${n!==null?n:"-"})`,t.appendChild(a);const i=document.createElement("ul");i.className="list-container";const o=Object.values(s.logs.scores||{}).flat().filter(l=>!l.isDeleted).sort((l,f)=>new Date(f.timestamp)-new Date(l.timestamp));o.length===0?i.innerHTML='<div class="no-content-message">Ù‡Ù†ÙˆØ² Ù†Ù…Ø±Ù‡â€ŒØ§ÛŒ Ø«Ø¨Øª Ù†Ø´Ø¯Ù‡ Ø§Ø³Øª.</div>':o.forEach(l=>{const f=document.createElement("li");f.className="score-history-item";const h=document.createElement("div");h.className="item-content";const m=document.createElement("div");m.className="score-info";const u=document.createElement("span");u.className="score-skill-badge",u.textContent=l.skill;const y=document.createElement("span");y.className="score-value",y.textContent=`Ù†Ù…Ø±Ù‡: ${l.value}`;const p=document.createElement("span");if(p.className="score-date",p.textContent=new Date(l.timestamp).toLocaleDateString("fa-IR"),m.appendChild(u),m.appendChild(y),m.appendChild(p),h.appendChild(m),l.comment){const v=document.createElement("p");v.className="score-comment",v.innerHTML=ki(l.comment),v.addEventListener("click",()=>{ye.value=l.comment,ye.dispatchEvent(new Event("input",{bubbles:!0})),dt(C=>{l.comment=C,se(),be(N.info.name,`ØªÙˆØ¶ÛŒØ­Ø§Øª Ù†Ù…Ø±Ù‡ ${l.value} (${l.skill}) Ø¨Ø±Ø§ÛŒ Ø¯Ø§Ù†Ø´â€ŒØ¢Ù…ÙˆØ² Â«${s.identity.name}Â» Ø¨Ù‡â€ŒØ±ÙˆØ²Ø±Ø³Ø§Ù†ÛŒ Ø´Ø¯.`,{type:"VIEW_STUDENT_PROFILE",studentId:s.identity.studentId}),Ue(s),j("âœ… ØªÙˆØ¶ÛŒØ­Ø§Øª Ù†Ù…Ø±Ù‡ Ø¨Ø§ Ù…ÙˆÙÙ‚ÛŒØª ÙˆÛŒØ±Ø§ÛŒØ´ Ø´Ø¯.")}),ue(()=>{De("add-note-modal"),ye.focus()})}),h.appendChild(v)}const b=document.createElement("button");b.className="btn-icon delete-item-btn",b.innerHTML="ðŸ—‘ï¸",b.title="Ø­Ø°Ù Ø§ÛŒÙ† Ù†Ù…Ø±Ù‡",b.addEventListener("click",()=>{ue(()=>{me(`Ø¢ÛŒØ§ Ø§Ø² Ø§Ù†ØªÙ‚Ø§Ù„ Ù†Ù…Ø±Ù‡ ${l.value} Ø¯Ø± Ù…Ù‡Ø§Ø±Øª Â«${l.skill}Â» Ø¨Ø±Ø§ÛŒ Ø¯Ø§Ù†Ø´ Ø¢Ù…ÙˆØ² Â«${s.identity.name}Â» Ø¨Ù‡ Ø³Ø·Ù„ Ø²Ø¨Ø§Ù„Ù‡ Ù…Ø·Ù…Ø¦Ù† Ù‡Ø³ØªÛŒØ¯ØŸ`,()=>{const v={id:`trash_${Date.now()}_${Math.random()}`,timestamp:new Date().toISOString(),type:"score",description:`Ù†Ù…Ø±Ù‡ ${l.value} (${l.skill}) Ø¨Ø±Ø§ÛŒ Â«${s.identity.name}Â»`,restoreData:{scoreId:l.id,skill:l.skill,studentId:s.identity.studentId,classId:N.info.scheduleCode}};ct(v),l.isDeleted=!0,se(),be(N.info.name,`Ù†Ù…Ø±Ù‡ ${l.value} (${l.skill}) Ø¯Ø§Ù†Ø´â€ŒØ¢Ù…ÙˆØ² Â«${s.identity.name}Â» Ø¨Ù‡ Ø³Ø·Ù„ Ø²Ø¨Ø§Ù„Ù‡ Ù…Ù†ØªÙ‚Ù„ Ø´Ø¯.`,{type:"VIEW_TRASH"}),Ue(s),j(`âœ… Ù†Ù…Ø±Ù‡ Ø¯Ø§Ù†Ø´ Ø¢Ù…ÙˆØ² ${s.identity.name} Ø¨Ù‡ Ø³Ø·Ù„ Ø²Ø¨Ø§Ù„Ù‡ Ù…Ù†ØªÙ‚Ù„ Ø´Ø¯.`)},{confirmText:"ØªØ§ÛŒÛŒØ¯ Ø§Ù†ØªÙ‚Ø§Ù„",confirmClass:"btn-warning",onCancel:()=>{Ue(s)}})})}),f.appendChild(h),f.appendChild(b),i.appendChild(f)}),e.appendChild(t),e.appendChild(i)}function cr(e){if(!Se)return;const s=document.createElement("h4");s.textContent="ØªØ§Ø±ÛŒØ®Ú†Ù‡ ÛŒØ§Ø¯Ø¯Ø§Ø´Øªâ€ŒÙ‡Ø§:",s.style.marginTop="20px";const t=document.createElement("ul");t.className="list-container",!Se.profile.notes||Se.profile.notes.length===0?t.innerHTML='<div class="no-content-message">Ù‡Ù†ÙˆØ² ÛŒØ§Ø¯Ø¯Ø§Ø´ØªÛŒ Ø«Ø¨Øª Ù†Ø´Ø¯Ù‡ Ø§Ø³Øª.</div>':[...Se.profile.notes].filter(r=>!r.isDeleted).sort((r,n)=>new Date(n.timestamp)-new Date(r.timestamp)).forEach(r=>{const n=document.createElement("li");n.className="note-history-item";const a=document.createElement("div");a.className="item-content";const i=document.createElement("div");i.className="note-info";const o=document.createElement("span");o.className="note-date",o.textContent=new Date(r.timestamp).toLocaleDateString("fa-IR");const l=document.createElement("button");l.className="btn-icon delete-item-btn",l.innerHTML="ðŸ—‘ï¸",l.title="Ø­Ø°Ù Ø§ÛŒÙ† ÛŒØ§Ø¯Ø¯Ø§Ø´Øª",l.addEventListener("click",()=>{const h=Se;ue(()=>{me("Ø¢ÛŒØ§ Ø§Ø² Ø§Ù†ØªÙ‚Ø§Ù„ Ø§ÛŒÙ† ÛŒØ§Ø¯Ø¯Ø§Ø´Øª Ø¨Ù‡ Ø³Ø·Ù„ Ø²Ø¨Ø§Ù„Ù‡ Ù…Ø·Ù…Ø¦Ù† Ù‡Ø³ØªÛŒØ¯ØŸ",()=>{const m={id:`trash_${Date.now()}_${Math.random()}`,timestamp:new Date().toISOString(),type:"note",description:`ÛŒØ§Ø¯Ø¯Ø§Ø´Øª Ø¨Ø±Ø§ÛŒ Ø¯Ø§Ù†Ø´â€ŒØ¢Ù…ÙˆØ² Â«${h.identity.name}Â»`,restoreData:{noteId:r.id,studentId:h.identity.studentId,classId:N.info.scheduleCode}};ct(m),r.isDeleted=!0,be(N.info.name,`ÛŒØ§Ø¯Ø¯Ø§Ø´Øª Ø¯Ø§Ù†Ø´â€ŒØ¢Ù…ÙˆØ² Â«${h.identity.name}Â» Ø¨Ù‡ Ø³Ø·Ù„ Ø²Ø¨Ø§Ù„Ù‡ Ù…Ù†ØªÙ‚Ù„ Ø´Ø¯.`,{type:"VIEW_TRASH"}),se(),Ue(h),j("âœ… ÛŒØ§Ø¯Ø¯Ø§Ø´Øª Ø¨Ù‡ Ø³Ø·Ù„ Ø²Ø¨Ø§Ù„Ù‡ Ù…Ù†ØªÙ‚Ù„ Ø´Ø¯.")},{confirmText:"ØªØ§ÛŒÛŒØ¯ Ø§Ù†ØªÙ‚Ø§Ù„",confirmClass:"btn-warning",onCancel:()=>{Ue(h)}})})}),i.appendChild(o),i.appendChild(l);const f=document.createElement("p");f.className="note-content",f.innerHTML=ki(r.content),f.addEventListener("click",()=>{const h=Se;ye.value=r.content,ye.dispatchEvent(new Event("input",{bubbles:!0})),dt(m=>{r.content=m,se(),be(N.info.name,`ÛŒØ§Ø¯Ø¯Ø§Ø´Øª Ø¯Ø§Ù†Ø´â€ŒØ¢Ù…ÙˆØ² Â«${h.identity.name}Â» Ø¨Ù‡â€ŒØ±ÙˆØ²Ø±Ø³Ø§Ù†ÛŒ Ø´Ø¯.`,{type:"VIEW_STUDENT_PROFILE",studentId:h.identity.studentId}),Ue(h),j("âœ…ÛŒØ§Ø¯Ø¯Ø§Ø´Øª Ø¨Ø§ Ù…ÙˆÙÙ‚ÛŒØª ÙˆÛŒØ±Ø§ÛŒØ´ Ø´Ø¯.")}),ue(()=>{De("add-note-modal"),ye.focus()})}),a.appendChild(i),a.appendChild(f),n.appendChild(a),t.appendChild(n)}),e.appendChild(s),e.appendChild(t)}function lr(e){zs.innerHTML="",e.forEach((s,t)=>{const c=document.createElement("option");c.value=t,c.textContent=s.trim(),zs.appendChild(c)})}function Vs(){Rs.innerHTML="",ei.forEach(e=>{const s=document.createElement("li");s.className="preview-item";const t=document.createElement("input");t.type="checkbox",t.checked=!0,t.dataset.name=e;const c=document.createElement("label");c.textContent=e,s.appendChild(t),s.appendChild(c),Rs.appendChild(s)})}function hc(e){const s=document.createElement("div");s.className="list-item-buttons";const t=document.createElement("button");return t.className="btn-icon",t.innerHTML="ðŸ“",t.title="ÙˆÛŒØ±Ø§ÛŒØ´ ÛŒØ§Ø¯Ø¯Ø§Ø´Øª Ú©Ù„Ø§Ø³",e.note||(t.style.display="none"),t.addEventListener("click",c=>{c.stopPropagation(),ws(e)}),s.appendChild(t),s}function pc(e){const s=document.createElement("div");s.style.flexGrow="1",s.style.display="flex",s.style.flexDirection="column",s.style.alignItems="flex-start";const t=document.createElement("span");t.textContent=e.info.name,t.classList.add("class-name-display"),s.appendChild(t);const c=ge(e.students).length,r=ge(e.sessions).filter(l=>l.isFinished).length,n=Sc(e.info.scheduleDays),a=document.createElement("div");a.classList.add("class-stats-row");const i=document.createElement("span");i.textContent=`${c} Ù†ÙØ±`,i.classList.add("student-count-badge"),a.appendChild(i);const o=document.createElement("span");if(o.textContent=`${r} Ø¬Ù„Ø³Ù‡`,o.classList.add("session-count-badge"),a.appendChild(o),n){const l=document.createElement("span");l.textContent=n,l.classList.add("schedule-days-badge"),a.appendChild(l)}return s.appendChild(a),s.addEventListener("click",()=>{Ge(e),rt(null),gn(N.liveSession),qe(),Ee("session-page")}),s}function gc(e){const s=document.createElement("li");fs(e).type==="active"&&(s.classList.add("active-class-card"),s.title="Ø§ÛŒÙ† Ú©Ù„Ø§Ø³ Ù‡Ù…â€ŒØ§Ú©Ù†ÙˆÙ† Ø¯Ø± Ø­Ø§Ù„ Ø¨Ø±Ú¯Ø²Ø§Ø±ÛŒ Ø§Ø³Øª");const c=document.createElement("input");c.type="checkbox",c.className="mass-selection-checkbox",c.checked=it.includes(e.info.name),c.addEventListener("click",f=>{f.stopPropagation()}),c.addEventListener("change",()=>{const f=e.info.name;if(c.checked)it.includes(f)||it.push(f);else{const h=it.indexOf(f);h>-1&&it.splice(h,1)}}),s.appendChild(c);const r=pc(e);s.appendChild(r);const n=document.createElement("div");n.style.display="flex",n.style.flexDirection="column",n.style.gap="5px",n.style.alignItems="flex-end",n.style.marginLeft="10px";const a=document.createElement("div");if(a.className="list-item-badges",e.liveSession&&!e.liveSession.isCancelled&&!e.liveSession.isDeleted){const f=document.createElement("span");f.className="warning-badge",f.textContent="Ø¬Ù„Ø³Ù‡ Ø¨Ø§Ø²",a.appendChild(f),s.classList.add("has-unfinished-session")}const i=document.createElement("span");if(i.className=`type-badge ${e.info.type}`,i.textContent=e.info.type==="online"?"Ø¢Ù†Ù„Ø§ÛŒÙ†":"Ø­Ø¶ÙˆØ±ÛŒ",i.title="Ù†ÙˆØ¹ Ú©Ù„Ø§Ø³",a.appendChild(i),fs(e).type==="incomplete"){const f=document.createElement("span");f.className="type-badge cancelled-badge",f.textContent="Ø²Ù…Ø§Ù†â€ŒØ¨Ù†Ø¯ÛŒ Ù†Ø§Ù‚Øµ",f.style.cursor="pointer",f.title="Ø¨Ø±Ø§ÛŒ ØªÚ©Ù…ÛŒÙ„ Ø²Ù…Ø§Ù†â€ŒØ¨Ù†Ø¯ÛŒ Ú©Ù„ÛŒÚ© Ú©Ù†ÛŒØ¯",f.addEventListener("click",h=>{h.stopPropagation(),me("Ø²Ù…Ø§Ù†â€ŒØ¨Ù†Ø¯ÛŒ Ø§ÛŒÙ† Ú©Ù„Ø§Ø³ Ú©Ø§Ù…Ù„ Ù†ÛŒØ³Øª. Ø¨Ø±Ø§ÛŒ Ù†Ù…Ø§ÛŒØ´ ØµØ­ÛŒØ­ Ø¯Ø± Ù„ÛŒØ³ØªØŒ Ù„Ø·ÙØ§Ù‹ Ø±ÙˆØ²Ù‡Ø§ Ùˆ Ø³Ø§Ø¹Øª Ø¨Ø±Ú¯Ø²Ø§Ø±ÛŒ Ø±Ø§ Ù…Ø´Ø®Øµ Ú©Ù†ÛŒØ¯.",()=>{xt(e)},{confirmText:"ØªÙ†Ø¸ÛŒÙ…Ø§Øª",confirmClass:"btn-primary"})}),a.appendChild(f)}else{const f=Ec(e,ie);if(f){const h=document.createElement("span");h.className="type-badge conflict-badge",h.textContent="ØªØ¯Ø§Ø®Ù„ Ø²Ù…Ø§Ù†ÛŒ",h.style.cursor="pointer",h.title=`ØªØ¯Ø§Ø®Ù„ Ø¨Ø§ Ú©Ù„Ø§Ø³: ${f}`,h.addEventListener("click",m=>{m.stopPropagation(),me(`Ø²Ù…Ø§Ù† Ø¨Ø±Ú¯Ø²Ø§Ø±ÛŒ Ø§ÛŒÙ† Ú©Ù„Ø§Ø³ Ø¨Ø§ Ú©Ù„Ø§Ø³ Â«${f}Â» ØªØ¯Ø§Ø®Ù„ Ø¯Ø§Ø±Ø¯. Ù„Ø·ÙØ§Ù‹ Ø²Ù…Ø§Ù†â€ŒØ¨Ù†Ø¯ÛŒ Ø±Ø§ Ø¨Ø±Ø±Ø³ÛŒ Ú©Ù†ÛŒØ¯.`,()=>{xt(e)},{confirmText:"ØªÙ†Ø¸ÛŒÙ…Ø§Øª",confirmClass:"btn-primary"})}),a.appendChild(h)}}n.appendChild(a);const l=hc(e);return n.appendChild(l),s.appendChild(n),xn(s,()=>{const f={label:"Ù¾Ø´ØªÛŒØ¨Ø§Ù†â€ŒÚ¯ÛŒØ±ÛŒ Ø§Ø² Ø§ÛŒÙ† Ú©Ù„Ø§Ø³",icon:"ðŸ“¤",action:()=>{ns([e.info.name])}},h=it.length;h>1&&it.includes(e.info.name)&&(f.label=`Ù¾Ø´ØªÛŒØ¨Ø§Ù†â€ŒÚ¯ÛŒØ±ÛŒ Ø§Ø² ${h} Ú©Ù„Ø§Ø³`,f.action=()=>{ns(it),Rn([]),Fe()});const m={label:"Ø­Ø°Ù Ú©Ù„Ø§Ø³",icon:"ðŸ—‘ï¸",className:"danger",action:()=>{me(`Ø¢ÛŒØ§ Ø§Ø² Ø§Ù†ØªÙ‚Ø§Ù„ Ú©Ù„Ø§Ø³ Â«${e.info.name}Â» Ø¨Ù‡ Ø³Ø·Ù„ Ø²Ø¨Ø§Ù„Ù‡ Ù…Ø·Ù…Ø¦Ù† Ù‡Ø³ØªÛŒØ¯ØŸ`,()=>{const u={id:`trash_${Date.now()}_${Math.random()}`,timestamp:new Date().toISOString(),type:"classroom",description:`Ú©Ù„Ø§Ø³ Â«${e.info.name}Â»`,restoreData:{name:e.info.name}};ct(u),e.isDeleted=!0,be(e.info.name,`Ú©Ù„Ø§Ø³ Â«${e.info.name}Â» Ø¨Ù‡ Ø³Ø·Ù„ Ø²Ø¨Ø§Ù„Ù‡ Ù…Ù†ØªÙ‚Ù„ Ø´Ø¯.`,{type:"VIEW_TRASH"}),se(),Fe(),j(`âœ… Ú©Ù„Ø§Ø³ Â«${e.info.name}Â» Ø¨Ù‡ Ø³Ø·Ù„ Ø²Ø¨Ø§Ù„Ù‡ Ù…Ù†ØªÙ‚Ù„ Ø´Ø¯.`)},{confirmText:"Ø¨Ù„Ù‡",confirmClass:"btn-warning",isDelete:!0})}};return h>1&&it.includes(e.info.name)&&(m.label=`Ø­Ø°Ù ${h} Ú©Ù„Ø§Ø³`,m.action=()=>{me(`Ø¢ÛŒØ§ Ø§Ø² Ø§Ù†ØªÙ‚Ø§Ù„ ${h} Ú©Ù„Ø§Ø³ Ø§Ù†ØªØ®Ø§Ø¨ Ø´Ø¯Ù‡ Ø¨Ù‡ Ø³Ø·Ù„ Ø²Ø¨Ø§Ù„Ù‡ Ù…Ø·Ù…Ø¦Ù† Ù‡Ø³ØªÛŒØ¯ØŸ`,()=>{it.forEach(u=>{const y=ie[u];if(y&&!y.isDeleted){const p={id:`trash_${Date.now()}_${Math.random()}`,timestamp:new Date().toISOString(),type:"classroom",description:`Ú©Ù„Ø§Ø³ Â«${y.info.name}Â»`,restoreData:{name:y.info.name}};ct(p),y.isDeleted=!0,be(y.info.name,`Ú©Ù„Ø§Ø³ Â«${y.info.name}Â» Ø¨Ù‡ Ø³Ø·Ù„ Ø²Ø¨Ø§Ù„Ù‡ Ù…Ù†ØªÙ‚Ù„ Ø´Ø¯.`,{type:"VIEW_TRASH"})}}),Rn([]),se(),Fe(),j(`âœ… ${h} Ú©Ù„Ø§Ø³ Ø¨Ù‡ Ø³Ø·Ù„ Ø²Ø¨Ø§Ù„Ù‡ Ù…Ù†ØªÙ‚Ù„ Ø´Ø¯Ù†Ø¯.`)},{confirmText:"Ø¨Ù„Ù‡",confirmClass:"btn-warning",isDelete:!0})}),[{label:"Ú†Ø§Ù¾ Ú¯Ø²Ø§Ø±Ø´ Ú©Ù„Ø§Ø³",icon:"ðŸ–¨ï¸",action:()=>ro(e)},{label:At.classList.contains("selection-mode-active")?"Ù„ØºÙˆ Ø§Ù†ØªØ®Ø§Ø¨":"Ø§Ù†ØªØ®Ø§Ø¨ Ú†Ù†Ø¯ Ú©Ù„Ø§Ø³",icon:"âœ”ï¸",action:()=>{const u=At.classList.contains("selection-mode-active");At.classList.toggle("selection-mode-active"),u&&(Rn([]),Fe())}},f,{label:"ÛŒØ§Ø¯Ø¯Ø§Ø´Øª Ú©Ù„Ø§Ø³",icon:"ðŸ“",action:()=>ws(e)},{label:"ØªÙ†Ø¸ÛŒÙ…Ø§Øª Ú©Ù„Ø§Ø³",icon:"âš™ï¸",action:()=>xt(e)},{label:"Ú¯Ø²Ø§Ø±Ø´ ÙØ¹Ø§Ù„ÛŒØªâ€ŒÙ‡Ø§",icon:"ðŸ“‹",action:()=>sr(e.info.name)},{label:"ØªØºÛŒÛŒØ± Ù†Ø§Ù…",icon:"âœï¸",action:()=>{const u=e.info.name,y=document.getElementById("add-note-modal-title");y.textContent="ØªØºÛŒÛŒØ± Ù†Ø§Ù… Ú©Ù„Ø§Ø³",ye.value=u,ye.rows=1,dt(p=>{const b=p.trim();if(b&&b!==u){const v=la(u,b);v.success?(eo(u,b),be(b,`Ù†Ø§Ù… Ú©Ù„Ø§Ø³ Ø§Ø² Â«${u}Â» Ø¨Ù‡ Â«${b}Â» ØªØºÛŒÛŒØ± ÛŒØ§ÙØª.`,{type:"VIEW_SESSIONS"}),se(),Fe(),j(`âœ…Ù†Ø§Ù… Ú©Ù„Ø§Ø³ Ø¨Ù‡ Â«${b}Â» ØªØºÛŒÛŒØ± ÛŒØ§ÙØª.`)):j(v.message)}y.textContent="Ø«Ø¨Øª ÛŒØ§Ø¯Ø¯Ø§Ø´Øª Ø¬Ø¯ÛŒØ¯",ye.rows=4}),De("add-note-modal"),ye.focus(),ye.select()}},m]}),s}function Es(){const e=document.getElementById("class-management-stats");if(!e)return;const s=Object.values(ie).filter(n=>!n.isDeleted),t=s.length,c=s.reduce((n,a)=>n+ge(a.students).length,0);let r="";Be.lastBackupTimestamp&&(r=`
            <div class="stats-row backup-stat">
                <span>Ø¢Ø®Ø±ÛŒÙ† Ù¾Ø´ØªÛŒØ¨Ø§Ù†: <strong>${new Date(Be.lastBackupTimestamp).toLocaleString("fa-IR",{year:"numeric",month:"numeric",day:"numeric",weekday:"long",hour:"2-digit",minute:"2-digit"})}</strong></span>
            </div>
        `),e.innerHTML=`
        <div class="stats-row main-stats">
            <span>Ú©Ù„ Ú©Ù„Ø§Ø³â€ŒÙ‡Ø§: <strong>${t}</strong></span>
            <span>|</span>
            <span>Ú©Ù„ Ø¯Ø§Ù†Ø´â€ŒØ¢Ù…ÙˆØ²Ø§Ù†: <strong>${c}</strong></span>
        </div>
        ${r} 
    `}function Fe(){Es(),At.innerHTML="";const e=Object.values(ie).filter(r=>!r.isDeleted),s=document.querySelector(".fab-container"),t=document.querySelector(".global-search-container");if(e.length===0){s&&s.classList.add("center-empty-state"),t&&(t.style.display="none"),At.innerHTML='<li class="no-content-message" style="text-align:center; margin-top:20px;">Ù‡Ù†ÙˆØ² Ú©Ù„Ø§Ø³ÛŒ Ø§ÛŒØ¬Ø§Ø¯ Ù†Ø´Ø¯Ù‡ Ø§Ø³Øª.</li>';return}else s&&s.classList.remove("center-empty-state"),t&&(t.style.display="");e.sort((r,n)=>{const a=fs(r),i=fs(n);return a.sortIndex!==i.sortIndex?a.sortIndex-i.sortIndex:a.type==="upcoming"?a.nextTimestamp-i.nextTimestamp:new Date(r.info.creationDate)-new Date(n.info.creationDate)}).forEach(r=>{const n=gc(r);At.appendChild(n)})}function Lt(){if(!N)return;Ms.innerHTML="";const e=ge(N.students);In(e).forEach(t=>{const c=document.createElement("li");c.dataset.studentId=t.identity.studentId;const r=document.createElement("span");r.className="student-name-link",r.style.flexGrow="1",t.identity.firstName&&t.identity.lastName?r.textContent=`${t.identity.lastName}ØŒ ${t.identity.firstName}`:r.textContent=t.identity.name,r.addEventListener("click",()=>{Ue(t)}),xn(c,()=>[{label:"ØªØºÛŒÛŒØ± Ù†Ø§Ù…",icon:"âœï¸",action:()=>{Oi(t,N)}},{label:"Ø§Ù†ØªÙ‚Ø§Ù„ Ø¯Ø§Ù†Ø´â€ŒØ¢Ù…ÙˆØ²",icon:"âž¡ï¸",action:()=>{Mi(t,N)}},{label:"Ø­Ø°Ù Ø¯Ø§Ù†Ø´â€ŒØ¢Ù…ÙˆØ²",icon:"ðŸ—‘ï¸",className:"danger",action:()=>{me(`Ø¢ÛŒØ§ Ø§Ø² Ø§Ù†ØªÙ‚Ø§Ù„ Ø¯Ø§Ù†Ø´â€ŒØ¢Ù…ÙˆØ² Â«${t.identity.name}Â» Ø¨Ù‡ Ø³Ø·Ù„ Ø²Ø¨Ø§Ù„Ù‡ Ù…Ø·Ù…Ø¦Ù† Ù‡Ø³ØªÛŒØ¯ØŸ`,()=>{const n={id:`trash_${Date.now()}_${Math.random()}`,timestamp:new Date().toISOString(),type:"student",description:`Ø¯Ø§Ù†Ø´â€ŒØ¢Ù…ÙˆØ² Â«${t.identity.name}Â» Ø§Ø² Ú©Ù„Ø§Ø³ Â«${N.info.name}Â»`,restoreData:{studentId:t.identity.studentId,classId:N.info.scheduleCode}};ct(n),t.isDeleted=!0,be(N.info.name,`Ø¯Ø§Ù†Ø´â€ŒØ¢Ù…ÙˆØ² Â«${t.identity.name}Â» Ø¨Ù‡ Ø³Ø·Ù„ Ø²Ø¨Ø§Ù„Ù‡ Ù…Ù†ØªÙ‚Ù„ Ø´Ø¯.`,{type:"VIEW_TRASH"}),se(),Lt(),Re(),ot(),j(`âœ… Ø¯Ø§Ù†Ø´â€ŒØ¢Ù…ÙˆØ² Â«${t.identity.name}Â» Ø¨Ù‡ Ø³Ø·Ù„ Ø²Ø¨Ø§Ù„Ù‡ Ù…Ù†ØªÙ‚Ù„ Ø´Ø¯.`)},{confirmText:"Ø¨Ù„Ù‡",confirmClass:"btn-warning"})}}]),c.appendChild(r),Ms.appendChild(c)})}function Qt(){if(Os.innerHTML="",!N)return;N.categories.filter(s=>!s.isDeleted).forEach(s=>{const t=document.createElement("li"),c=document.createElement("div");c.className="name-and-badge-container";const r=document.createElement("span");if(r.textContent=s.name,c.appendChild(r),s.isGradedCategory){const a=document.createElement("span");a.className="category-badge",a.textContent="Ù†Ù…Ø±Ù‡â€ŒØ¯Ø§Ø±",c.appendChild(a)}if(s.isGradedCategory){const a=document.createElement("span");a.className="category-badge weight-badge",a.textContent=`Ø¶Ø±ÛŒØ¨: ${s.weight||1}`,c.appendChild(a)}const n=document.createElement("button");n.className="btn-icon",n.innerHTML="ðŸ—‘ï¸",n.style.color="var(--color-warning)",n.addEventListener("click",()=>{me(`Ø¢ÛŒØ§ Ø§Ø² Ø§Ù†ØªÙ‚Ø§Ù„ Ø¯Ø³ØªÙ‡â€ŒØ¨Ù†Ø¯ÛŒ Â«${s.name}Â» Ø¨Ù‡ Ø³Ø·Ù„ Ø²Ø¨Ø§Ù„Ù‡ Ù…Ø·Ù…Ø¦Ù† Ù‡Ø³ØªÛŒØ¯ØŸ`,()=>{const a={id:`trash_${Date.now()}_${Math.random()}`,timestamp:new Date().toISOString(),type:"category",description:`Ø¯Ø³ØªÙ‡â€ŒØ¨Ù†Ø¯ÛŒ Â«${s.name}Â» Ø§Ø² Ú©Ù„Ø§Ø³ Â«${N.info.name}Â»`,restoreData:{categoryId:s.id,classId:N.info.scheduleCode}};ct(a),s.isDeleted=!0,be(N.info.name,`Ø¯Ø³ØªÙ‡â€ŒØ¨Ù†Ø¯ÛŒ Â«${s.name}Â» Ø¨Ù‡ Ø³Ø·Ù„ Ø²Ø¨Ø§Ù„Ù‡ Ù…Ù†ØªÙ‚Ù„ Ø´Ø¯.`,{type:"VIEW_TRASH"}),se(),Qt(),j(`âœ… Ø¯Ø³ØªÙ‡â€ŒØ¨Ù†Ø¯ÛŒ Â«${s.name}Â» Ø¨Ù‡ Ø³Ø·Ù„ Ø²Ø¨Ø§Ù„Ù‡ Ù…Ù†ØªÙ‚Ù„ Ø´Ø¯.`)},{confirmText:"Ø¨Ù„Ù‡",confirmClass:"btn-warning"})}),t.appendChild(c),t.appendChild(n),Os.appendChild(t)})}function dr(){if(!N)return;const e=N;Hi(Hn,on,e.info.educationalSystem,e.info.level),Hn.addEventListener("change",()=>{e.info.educationalSystem=Hn.value,e.info.level=on.value,se()}),on.addEventListener("change",()=>{e.info.level=on.value,se()});const s=e.info.type||"in-person",t=document.querySelector(`#settings-page input[name="class-type-setting"][value="${s}"]`);t&&(t.checked=!0);const c=e.info.scheduleDays||[];document.querySelectorAll('input[name="schedule-day"]').forEach(r=>{r.checked=c.includes(parseInt(r.value))}),document.getElementById("settings-schedule-start").value=e.info.scheduleStartTime||"",document.getElementById("settings-schedule-end").value=e.info.scheduleEndTime||""}function us(e){ps(null),document.querySelectorAll(".page").forEach(t=>{t.classList.remove("active")});const s=document.getElementById(e);s&&s.classList.add("active"),e==="class-management-page"?(Fe(),$s.style.display="flex"):$s.style.display="none",ir()}function Ee(e,s={}){const{tab:t}=s;let c=`#${e}`;const r=new URLSearchParams;N&&r.set("class",N.info.name),K&&r.set("session",K.sessionNumber),Se&&r.set("student",Se.identity.studentId),e==="session-dashboard-page"&&t&&r.set("tab",t);const n=r.toString();n&&(c+=`?${n}`),window.location.hash!==c&&history.pushState({pageId:e},"",c),us(e)}function yc(e,s){const t=document.createElement("div");t.className="list-item-buttons",t.style.gap="10px";const c=document.createElement("button");if(c.className="btn-icon",c.innerHTML="ðŸ“",c.title="ÙˆÛŒØ±Ø§ÛŒØ´ ÛŒØ§Ø¯Ø¯Ø§Ø´Øª Ø¬Ù„Ø³Ù‡",e.note||(c.style.display="none"),c.addEventListener("click",r=>{r.stopPropagation(),$i(e,s)}),!e.isFinished&&!e.isCancelled){const r=document.createElement("button");r.className="btn-success",r.textContent="Ù¾Ø§ÛŒØ§Ù† Ø¬Ù„Ø³Ù‡",r.style.fontSize="12px",r.style.padding="4px 10px",r.style.whiteSpace="nowrap",r.addEventListener("click",n=>{n.stopPropagation(),me(`Ø¬Ù„Ø³Ù‡ Ø´Ù…Ø§Ø±Ù‡ ${s} Ø®Ø§ØªÙ…Ù‡ Ù¾ÛŒØ¯Ø§ Ø®ÙˆØ§Ù‡Ø¯ Ú©Ø±Ø¯!`,()=>{N.endSpecificSession(e.sessionNumber),se(),be(N.info.name,`Ø¬Ù„Ø³Ù‡ ${s} Ø®Ø§ØªÙ…Ù‡ ÛŒØ§ÙØª.`,{type:"VIEW_SESSIONS"}),qe(),me("Ø¬Ù„Ø³Ù‡ Ø¨Ø§ Ù…ÙˆÙÙ‚ÛŒØª Ø®Ø§ØªÙ…Ù‡ ÛŒØ§ÙØª. Ø¢ÛŒØ§ Ù…Ø§ÛŒÙ„ Ø¨Ù‡ Ø§ÛŒØ¬Ø§Ø¯ ÙØ§ÛŒÙ„ Ù¾Ø´ØªÛŒØ¨Ø§Ù† Ù‡Ø³ØªÛŒØ¯ØŸ",()=>{if(vt){j("âš ï¸ Ù¾Ø´ØªÛŒØ¨Ø§Ù†â€ŒÚ¯ÛŒØ±ÛŒ Ø¯Ø± Ø­Ø§Ù„Øª Ù†Ù…Ø§ÛŒØ´ (Demo) ØºÛŒØ±ÙØ¹Ø§Ù„ Ø§Ø³Øª.");return}ns(),j("âœ…ÙØ§ÛŒÙ„ Ù¾Ø´ØªÛŒØ¨Ø§Ù† Ø¨Ø§ Ù…ÙˆÙÙ‚ÛŒØª Ø§ÛŒØ¬Ø§Ø¯ Ø´Ø¯.")},{confirmText:"Ø¨Ù„Ù‡",cancelText:"Ø®ÛŒØ±",confirmClass:"btn-success"})})}),t.appendChild(r)}return t.appendChild(c),t}function vc(e,s){const t=document.createElement("div");t.style.display="flex",t.style.flexDirection="column",t.style.alignItems="flex-start",t.style.flexGrow="1";const c=new Date(e.startTime).toLocaleDateString("fa-IR"),r=document.createElement("span");r.className="session-list-title";const n=document.createElement("div");n.style.display="flex",n.style.gap="5px",n.style.marginTop="5px";const a=new Date(e.startTime).toLocaleDateString("fa-IR",{weekday:"long"}),i=document.createElement("span");if(i.className="type-badge day-badge",i.textContent=a,n.appendChild(i),e.isCancelled){r.textContent=`Ù„ØºÙˆ Ø´Ø¯Ù‡ - ØªØ§Ø±ÛŒØ®: ${c}`,t.style.cursor="default";const o=document.createElement("span");o.className="type-badge cancelled-badge",o.textContent="Ù„ØºÙˆ Ø´Ø¯Ù‡",n.appendChild(o)}else r.textContent=`Ø¬Ù„Ø³Ù‡ ${s} - ØªØ§Ø±ÛŒØ®: ${c}`,t.style.cursor="pointer",t.addEventListener("click",()=>{rt(e),Ln()});if(t.appendChild(r),e.isFinished){const o=document.createElement("span");o.className="type-badge finished-badge",o.textContent="Ø®Ø§ØªÙ…Ù‡ ÛŒØ§ÙØªÙ‡",n.appendChild(o)}if(e.isMakeup){const o=document.createElement("span");o.className="type-badge makeup-badge",o.textContent="Ø¬Ø¨Ø±Ø§Ù†ÛŒ",n.appendChild(o)}return t.appendChild(n),t}function bc(e,s){const t=document.createElement("li"),c=s.get(e.sessionNumber),r=vc(e,c);t.appendChild(r);const n=yc(e,c);return t.appendChild(n),xn(t,()=>[{label:"ÛŒØ§Ø¯Ø¯Ø§Ø´Øª Ø¬Ù„Ø³Ù‡",icon:"ðŸ“",action:()=>{$i(e,c)}},{label:e.isCancelled?"Ø¨Ø§Ø²Ú¯Ø±Ø¯Ø§Ù†ÛŒ Ø¬Ù„Ø³Ù‡":"Ù„ØºÙˆ Ø¬Ù„Ø³Ù‡",icon:"âŒ",action:()=>{const a=e.isCancelled?"Ø¨Ø§Ø²Ú¯Ø±Ø¯Ø§Ù†ÛŒ Ø¬Ù„Ø³Ù‡":"Ù„ØºÙˆ Ø¬Ù„Ø³Ù‡",i=e.isCancelled?"Ø¢ÛŒØ§ Ø§Ø² Ø¨Ø§Ø²Ú¯Ø±Ø¯Ø§Ù†ÛŒ Ø§ÛŒÙ† Ø¬Ù„Ø³Ù‡ Ù…Ø·Ù…Ø¦Ù† Ù‡Ø³ØªÛŒØ¯ØŸ":"Ø¢ÛŒØ§ Ø§Ø² Ù„ØºÙˆ Ø§ÛŒÙ† Ø¬Ù„Ø³Ù‡ Ù…Ø·Ù…Ø¦Ù† Ù‡Ø³ØªÛŒØ¯ØŸ Ø¬Ù„Ø³Ù‡ Ù„ØºÙˆ Ø´Ø¯Ù‡ Ø¯Ø± Ø¢Ù…Ø§Ø± ØªØ§Ø«ÛŒØ±ÛŒ Ù†Ø¯Ø§Ø±Ø¯ Ø§Ù…Ø§ Ù‚Ø§Ø¨Ù„ Ø¨Ø§Ø²Ú¯Ø±Ø¯Ø§Ù†ÛŒ Ø§Ø³Øª.";me(i,()=>{e.isCancelled=!e.isCancelled;const o=e.isCancelled?`Ø¬Ù„Ø³Ù‡ ${c} Ù„ØºÙˆ Ø´Ø¯.`:`Ø¬Ù„Ø³Ù‡ Ù„ØºÙˆ Ø´Ø¯Ù‡ (ØªØ§Ø±ÛŒØ®: ${new Date(e.startTime).toLocaleDateString("fa-IR")}) Ø¨Ø§Ø²Ú¯Ø±Ø¯Ø§Ù†ÛŒ Ø´Ø¯.`;be(N.info.name,o,{type:"VIEW_SESSIONS"}),se(),qe(),j(e.isCancelled?"âœ…Ø¬Ù„Ø³Ù‡ Ù„ØºÙˆ Ø´Ø¯.":"âœ…Ø¬Ù„Ø³Ù‡ Ø¨Ø§Ø²Ú¯Ø±Ø¯Ø§Ù†ÛŒ Ø´Ø¯.")},{confirmText:a,confirmClass:"btn-warning"})}},{label:"ØªØºÛŒÛŒØ± ÙˆØ¶Ø¹ÛŒØª Ø¬Ø¨Ø±Ø§Ù†ÛŒ",icon:"ðŸ”„",action:()=>{N.markAsMakeup(e.sessionNumber),se();const a=e.isMakeup?`Ø¬Ù„Ø³Ù‡ ${c} Ø¨Ù‡ Ø¹Ù†ÙˆØ§Ù† Ø¬Ø¨Ø±Ø§Ù†ÛŒ Ø¹Ù„Ø§Ù…Øªâ€ŒÚ¯Ø°Ø§Ø±ÛŒ Ø´Ø¯.`:`Ø¬Ù„Ø³Ù‡ ${c} Ø§Ø² Ø­Ø§Ù„Øª Ø¬Ø¨Ø±Ø§Ù†ÛŒ Ø®Ø§Ø±Ø¬ Ø´Ø¯.`;be(N.info.name,a,{type:"VIEW_SESSIONS"}),qe()}},{label:"Ø­Ø°Ù Ø¬Ù„Ø³Ù‡",icon:"ðŸ—‘ï¸",className:"danger",action:()=>{const a=e.isCancelled?"Ù„ØºÙˆ Ø´Ø¯Ù‡":c;me(`Ø¢ÛŒØ§ Ø§Ø² Ø§Ù†ØªÙ‚Ø§Ù„ Ø¬Ù„Ø³Ù‡ ${a} Ø¨Ù‡ Ø³Ø·Ù„ Ø²Ø¨Ø§Ù„Ù‡ Ù…Ø·Ù…Ø¦Ù† Ù‡Ø³ØªÛŒØ¯ØŸ`,()=>{const i={id:`trash_${Date.now()}_${Math.random()}`,timestamp:new Date().toISOString(),type:"session",description:`Ø¬Ù„Ø³Ù‡ ${a} Ø§Ø² Ú©Ù„Ø§Ø³ Â«${N.info.name}Â»`,restoreData:{sessionNumber:e.sessionNumber,classId:N.info.scheduleCode}};ct(i),e.isDeleted=!0,be(N.info.name,`Ø¬Ù„Ø³Ù‡ ${a} Ø¨Ù‡ Ø³Ø·Ù„ Ø²Ø¨Ø§Ù„Ù‡ Ù…Ù†ØªÙ‚Ù„ Ø´Ø¯.`,{type:"VIEW_TRASH"}),se(),qe(),j(`âœ… Ø¬Ù„Ø³Ù‡ ${a} Ø¨Ù‡ Ø³Ø·Ù„ Ø²Ø¨Ø§Ù„Ù‡ Ù…Ù†ØªÙ‚Ù„ Ø´Ø¯.`)},{confirmText:"Ø¨Ù„Ù‡",confirmClass:"btn-warning",isDelete:!0})}},{label:"ØªØºÛŒÛŒØ± ØªØ§Ø±ÛŒØ®",icon:"ðŸ“…",action:()=>{const a=document.getElementById("dp-day"),i=document.getElementById("dp-month"),o=document.getElementById("dp-year"),l=qi.toJalaali(e.startTime);a.innerHTML="";for(let m=1;m<=31;m++){const u=document.createElement("option");u.value=m,u.textContent=m.toLocaleString("fa-IR"),m===l.jd&&(u.selected=!0),a.appendChild(u)}const f=["ÙØ±ÙˆØ±Ø¯ÛŒÙ†","Ø§Ø±Ø¯ÛŒØ¨Ù‡Ø´Øª","Ø®Ø±Ø¯Ø§Ø¯","ØªÛŒØ±","Ù…Ø±Ø¯Ø§Ø¯","Ø´Ù‡Ø±ÛŒÙˆØ±","Ù…Ù‡Ø±","Ø¢Ø¨Ø§Ù†","Ø¢Ø°Ø±","Ø¯ÛŒ","Ø¨Ù‡Ù…Ù†","Ø§Ø³ÙÙ†Ø¯"];i.innerHTML="",f.forEach((m,u)=>{const y=document.createElement("option");y.value=u+1,y.textContent=m,u+1===l.jm&&(y.selected=!0),i.appendChild(y)}),o.innerHTML="";const h=l.jy;for(let m=h-5;m<=h+5;m++){const u=document.createElement("option");u.value=m,u.textContent=m.toString().replace(/\d/g,y=>"Û°Û±Û²Û³Û´ÛµÛ¶Û·Û¸Û¹"[y]),m===l.jy&&(u.selected=!0),o.appendChild(u)}ts(m=>{if(!m)return;const u=qi.toGregorian(parseInt(m.jy),parseInt(m.jm),parseInt(m.jd)),y=new Date(u.gy,u.gm-1,u.gd);y.setHours(e.startTime.getHours()),y.setMinutes(e.startTime.getMinutes()),y.setSeconds(e.startTime.getSeconds());const p=e.startTime.toLocaleDateString("fa-IR");e.startTime=y;const b=e.startTime.toLocaleDateString("fa-IR");be(N.info.name,`ØªØ§Ø±ÛŒØ® Ø¬Ù„Ø³Ù‡ ${c} Ø§Ø² ${p} Ø¨Ù‡ ${b} ØªØºÛŒÛŒØ± ÛŒØ§ÙØª.`,{type:"VIEW_SESSIONS"}),se(),qe(),j(`âœ… ØªØ§Ø±ÛŒØ® Ø¬Ù„Ø³Ù‡ Ø¨Ù‡ ${b} ØªØºÛŒÛŒØ± ÛŒØ§ÙØª.`)}),De("date-picker-modal")}}]),t}function qe(){const e=document.getElementById("session-list");if(!N)return;if(e.innerHTML="",N.sessions.length===0){e.innerHTML="<li>Ù‡Ù†ÙˆØ² Ø¬Ù„Ø³Ù‡â€ŒØ§ÛŒ Ø´Ø±ÙˆØ¹ Ù†Ø´Ø¯Ù‡ Ø§Ø³Øª.</li>";return}const s=lt(N);[...ge(N.sessions)].reverse().forEach(c=>{const r=bc(c,s);e.appendChild(r)})}function ln(e){if(Et.innerHTML="",e.length>0)e.forEach(s=>{const t=document.createElement("div");t.textContent=s.identity.name,t.addEventListener("click",()=>{Ue(s),Et.style.display="none",Hs.value=""}),Et.appendChild(t)}),Et.style.display="block";else if(Hs.value.trim()!==""){const s=document.createElement("div");s.className="no-results",s.textContent="Ù¾ÛŒØ¯Ø§ Ù†Ø´Ø¯",Et.appendChild(s),Et.style.display="block"}else Et.style.display="none"}function jn(e){if(ut.innerHTML="",e.length>0)e.forEach(s=>{const t=document.createElement("div");if(t.className="global-search-result",s.type==="student"){const c=document.createElement("span");c.className="student-name",c.textContent=s.student.identity.name;const r=document.createElement("span");r.className="class-name",r.textContent=`Ú©Ù„Ø§Ø³: ${s.classroom.info.name}`,t.addEventListener("click",()=>{Ge(s.classroom),Ue(s.student),ut.style.display="none",rn.value=""}),r.addEventListener("click",n=>{n.stopPropagation(),Ge(s.classroom),rt(null),gn(s.classroom.liveSession),qe(),Ee("session-page"),ut.style.display="none",rn.value=""}),t.appendChild(c),t.appendChild(r)}else if(s.type==="classroom"){const c=document.createElement("span");c.className="student-name",c.textContent=`[Ú©Ù„Ø§Ø³] ${s.classroom.info.name}`,t.addEventListener("click",()=>{Ge(s.classroom),rt(null),gn(s.classroom.liveSession),qe(),Ee("session-page"),ut.style.display="none",rn.value=""}),t.appendChild(c)}ut.appendChild(t)}),ut.style.display="block";else if(rn.value.trim()!==""){const s=document.createElement("div");s.className="no-results",s.textContent="Ù¾ÛŒØ¯Ø§ Ù†Ø´Ø¯",ut.appendChild(s),ut.style.display="block"}else ut.style.display="none"}function _n(){const e=document.getElementById("trashed-items-list");if(e.innerHTML="",He.length===0){e.innerHTML='<li style="text-align: center; padding: 20px;">Ø³Ø·Ù„ Ø²Ø¨Ø§Ù„Ù‡ Ø®Ø§Ù„ÛŒ Ø§Ø³Øª.</li>';return}He.forEach((s,t)=>{const c=document.createElement("li"),r=document.createElement("span");r.textContent=s.description,r.style.flexGrow="1";const n=document.createElement("div");n.className="list-item-buttons";const a=document.createElement("button");a.className="btn-icon",a.innerHTML="ðŸ”„",a.title="Ø¨Ø§Ø²ÛŒØ§Ø¨ÛŒ",a.addEventListener("click",()=>{var h;let o=!1,l=null;const f=s.restoreData;switch(s.type){case"classroom":{const m=ie[f.name];m&&!m.isDeleted?l=`Ú©Ù„Ø§Ø³ÛŒ Ø¨Ø§ Ù†Ø§Ù… Â«${f.name}Â» Ø§Ø² Ù‚Ø¨Ù„ ÙØ¹Ø§Ù„ Ø§Ø³Øª.`:m&&m.isDeleted&&(m.isDeleted=!1,o=!0);break}case"student":{const m=Object.values(ie).find(y=>y.info.scheduleCode===f.classId),u=m==null?void 0:m.students.find(y=>y.identity.studentId===f.studentId);u&&(u.isDeleted=!1,o=!0);break}case"session":{const m=Object.values(ie).find(y=>y.info.scheduleCode===f.classId),u=m==null?void 0:m.sessions.find(y=>y.sessionNumber===f.sessionNumber);u&&(u.isDeleted=!1,o=!0);break}case"category":{const m=Object.values(ie).find(y=>y.info.scheduleCode===f.classId),u=m==null?void 0:m.categories.find(y=>y.id===f.categoryId);u&&(u.isDeleted=!1,o=!0);break}case"score":{const m=Object.values(ie).find(p=>p.info.scheduleCode===f.classId),u=m==null?void 0:m.students.find(p=>p.identity.studentId===f.studentId),y=(h=u==null?void 0:u.logs.scores[f.skill.toLowerCase()])==null?void 0:h.find(p=>p.id===f.scoreId);y&&(y.isDeleted=!1,o=!0);break}case"note":{const m=Object.values(ie).find(p=>p.info.scheduleCode===f.classId),u=m==null?void 0:m.students.find(p=>p.identity.studentId===f.studentId),y=u==null?void 0:u.profile.notes.find(p=>p.id===f.noteId);y&&(y.isDeleted=!1,o=!0);break}}o?(He.splice(t,1),se(),_n(),s.type==="classroom"&&Fe(),j("âœ… Ø¢ÛŒØªÙ… Ø¨Ø§ Ù…ÙˆÙÙ‚ÛŒØª Ø¨Ø§Ø²ÛŒØ§Ø¨ÛŒ Ø´Ø¯.")):j(l?`âš ï¸ ${l}`:"âš ï¸ Ø¢ÛŒØªÙ… Ø§ØµÙ„ÛŒ Ø¨Ø±Ø§ÛŒ Ø¨Ø§Ø²ÛŒØ§Ø¨ÛŒ ÛŒØ§ÙØª Ù†Ø´Ø¯.")});const i=document.createElement("button");i.className="btn-icon",i.innerHTML="ðŸ”¥",i.title="Ø­Ø°Ù Ø¯Ø§Ø¦Ù…ÛŒ",i.addEventListener("click",()=>{me("Ø¢ÛŒØ§ Ø§Ø² Ø­Ø°Ù Ø¯Ø§Ø¦Ù…ÛŒ Ø§ÛŒÙ† Ø¢ÛŒØªÙ… Ù…Ø·Ù…Ø¦Ù† Ù‡Ø³ØªÛŒØ¯ØŸ Ø§ÛŒÙ† Ø¹Ù…Ù„ ØºÛŒØ±Ù‚Ø§Ø¨Ù„ Ø¨Ø§Ø²gØ´Øª Ø§Ø³Øª.",()=>{const o=s.restoreData,l=h=>Object.values(ie).find(m=>m.info.scheduleCode===h);let f;switch(s.type){case"classroom":delete ie[o.name];break;case"student":f=l(o.classId),ys({identity:{studentId:o.studentId}},f);break;case"session":f=l(o.classId),f&&mi(f.info.name,o.sessionNumber);break;case"category":f=l(o.classId),f&&hi(f.info.name,o.categoryId);break;case"score":f=l(o.classId),f&&pi(f.info.name,o.studentId,o.skill,o.scoreId);break;case"note":f=l(o.classId),f&&gi(f.info.name,o.studentId,o.noteId);break}He.splice(t,1),se(),_n(),j("âœ… Ø¢ÛŒØªÙ… Ø¨Ø±Ø§ÛŒ Ù‡Ù…ÛŒØ´Ù‡ Ø­Ø°Ù Ø´Ø¯.")},{confirmText:"Ø­Ø°Ù Ø¯Ø§Ø¦Ù…ÛŒ",confirmClass:"btn-warning"})}),n.appendChild(a),n.appendChild(i),c.appendChild(r),c.appendChild(n),e.appendChild(c)})}function Cc(){const e=document.getElementById("absentees-summary-container");e&&(e.innerHTML=`
        <div id="absentees-summary-box" class="absentees-summary">
            <div class="absentees-summary-header">
                <h4>Ù„ÛŒØ³Øª ØºØ§ÛŒØ¨ÛŒÙ† Ø¬Ù„Ø³Ù‡ Ø´Ù…Ø§Ø±Ù‡ <span id="absentee-summary-session-number"></span></h4>
                <button id="copy-absentees-btn" class="btn-icon" title="Ú©Ù¾ÛŒ Ù„ÛŒØ³Øª ØºØ§ÛŒØ¨ÛŒÙ†">ðŸ“‹</button>
            </div>
            <div id="absentees-summary-list" class="summary-list"></div>
            <div class="attendance-counters">
                <span>ØªØ¹Ø¯Ø§Ø¯ Ø­Ø§Ø¶Ø±ÛŒÙ†: <strong id="present-count">0</strong></span>
                <span>ØªØ¹Ø¯Ø§Ø¯ ØºØ§ÛŒØ¨ÛŒÙ†: <strong id="absent-count">0</strong></span>
            </div>
        </div>
    `)}function ur(){const e=document.getElementById("absentees-summary-box"),s=document.getElementById("absentees-summary-list"),t=document.getElementById("absentee-summary-session-number");if(!e||!s||!t){console.error("Could not find all absentee summary elements.");return}if(!N||!K){e.classList.remove("visible");return}const c=ge(N.students).filter(f=>{const h=K.studentRecords[f.identity.studentId];return h&&h.attendance==="absent"}),r=ge(N.students),n=c.length,a=r.length-n,i=document.getElementById("present-count"),o=document.getElementById("absent-count");i&&(i.textContent=a.toLocaleString("fa-IR")),o&&(o.textContent=n.toLocaleString("fa-IR"));const l=lt(N);t.textContent=l.get(K.sessionNumber),c.length>0?e.classList.add("visible"):e.classList.remove("visible"),s.innerHTML="",c.forEach(f=>{const m=(y=>N.sessions.reduce((p,b)=>{if(b.isDeleted||b.isCancelled)return p;const v=b.studentRecords[y.identity.studentId];return p+(v&&v.attendance==="absent"?1:0)},0))(f),u=document.createElement("span");u.className="summary-name",u.textContent=`${f.identity.name} (ØºÛŒØ¨Øª: ${m})`,u.addEventListener("click",()=>{u.classList.add("fading-out"),setTimeout(()=>{K.setAttendance(f.identity.studentId,"present"),se(),ot()},200)}),s.appendChild(u)})}function wc(){const e=document.getElementById("copy-absentees-btn");if(!e){console.error("Could not find the copy absentees button to attach listener.");return}e.addEventListener("click",()=>{if(!N||!K)return;const s=ge(N.students).filter(i=>{const o=K.studentRecords[i.identity.studentId];return o&&o.attendance==="absent"});if(s.length===0){j("âš ï¸Ù„ÛŒØ³Øª ØºØ§ÛŒØ¨ÛŒÙ† Ø®Ø§Ù„ÛŒ Ø§Ø³Øª.");return}const t=i=>N.sessions.reduce((o,l)=>{if(l.isDeleted||l.isCancelled)return o;const f=l.studentRecords[i.identity.studentId];return o+(f&&f.attendance==="absent"?1:0)},0),c=ge(N.students),r=s.length,n=c.length-r;let a=`Ú¯Ø²Ø§Ø±Ø´ Ø­Ø¶ÙˆØ± Ùˆ ØºÛŒØ§Ø¨ Ø¬Ù„Ø³Ù‡ Ø´Ù…Ø§Ø±Ù‡ ${lc()}:
`;a+=`âœ… Ø­Ø§Ø¶Ø±ÛŒÙ†: ${n.toLocaleString("fa-IR")}
`,a+=`âŒ ØºØ§ÛŒØ¨ÛŒÙ†: ${r.toLocaleString("fa-IR")}

`,a+=`Ù„ÛŒØ³Øª Ø§Ø³Ø§Ù…ÛŒ ØºØ§ÛŒØ¨ÛŒÙ†:
`,s.forEach(i=>{const o=t(i);a+=`- ${i.identity.name} (ØªØ¹Ø¯Ø§Ø¯ ØºÛŒØ¨Øªâ€ŒÙ‡Ø§: ${o})
`}),navigator.clipboard.writeText(a).then(()=>{j("âœ…Ù„ÛŒØ³Øª ØºØ§ÛŒØ¨ÛŒÙ† Ø¨Ø§ Ù…ÙˆÙÙ‚ÛŒØª Ú©Ù¾ÛŒ Ø´Ø¯.")}).catch(i=>{console.error("Failed to copy text: ",i),j("âŒØ®Ø·Ø§ Ø¯Ø± Ú©Ù¾ÛŒ Ú©Ø±Ø¯Ù† Ù„ÛŒØ³Øª.")})})}function Ss(){const e=document.getElementById("demo-mode-banner");e&&(vt?(e.classList.add("visible"),document.body.classList.add("demo-mode-active")):(e.classList.remove("visible"),document.body.classList.remove("demo-mode-active")))}function fs(e){const{scheduleDays:s,scheduleStartTime:t,scheduleEndTime:c}=e.info,r=s&&s.length>0,n=t&&c;if(!r&&!n)return{type:"unscheduled",sortIndex:3};if(!r||!n)return{type:"incomplete",sortIndex:2};const a=new Date,i=a.getDay(),o=a.getHours()*60+a.getMinutes(),[l,f]=t.split(":").map(Number),[h,m]=c.split(":").map(Number),u=l*60+f,y=h*60+m;if(s.includes(i)&&o>=u&&o<y)return{type:"active",sortIndex:0};for(let p=0;p<=7;p++){const b=(i+p)%7;if(s.includes(b)){if(p===0&&o>=u)continue;const v=new Date(a);return v.setDate(a.getDate()+p),v.setHours(l,f,0,0),{type:"upcoming",sortIndex:1,nextTimestamp:v.getTime()}}}return{type:"upcoming",sortIndex:1,nextTimestamp:9999999999999}}function Ec(e,s){const{scheduleDays:t,scheduleStartTime:c,scheduleEndTime:r}=e.info;if(!t||!t.length||!c||!r)return null;const[n,a]=c.split(":").map(Number),[i,o]=r.split(":").map(Number),l=n*60+a,f=i*60+o;for(const h of Object.values(s)){if(h===e||h.isDeleted||h.info.name===e.info.name)continue;const m=h.info;if(!m.scheduleDays||!m.scheduleDays.length||!m.scheduleStartTime||!m.scheduleEndTime||!t.some(_=>m.scheduleDays.includes(_)))continue;const[y,p]=m.scheduleStartTime.split(":").map(Number),[b,v]=m.scheduleEndTime.split(":").map(Number),C=y*60+p,S=b*60+v;if(l<S&&f>C)return h.info.name}return null}function Sc(e){if(!e||e.length===0)return"";const s={6:"Ø´Ù†Ø¨Ù‡",0:"Û±Ø´Ù†Ø¨Ù‡",1:"Û²Ø´Ù†Ø¨Ù‡",2:"Û³Ø´Ù†Ø¨Ù‡",3:"Û´Ø´Ù†Ø¨Ù‡",4:"ÛµØ´Ù†Ø¨Ù‡",5:"Ø¬Ù…Ø¹Ù‡"};return[...e].sort((c,r)=>{const n={6:0,0:1,1:2,2:3,3:4,4:5,5:6};return n[c]-n[r]}).map(c=>s[c]).join("ØŒ ")}async function fr(){const e=document.getElementById("restore-points-list");e.innerHTML='<li style="text-align:center; padding:20px;">Ø¯Ø± Ø­Ø§Ù„ Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ...</li>';try{const s=await Ea();if(s.length===0){e.innerHTML='<li style="text-align:center; padding:20px;">Ù‡ÛŒÚ† ÙØ§ÛŒÙ„ Ù¾Ø´ØªÛŒØ¨Ø§Ù†ÛŒ ÛŒØ§ÙØª Ù†Ø´Ø¯.</li>';return}e.innerHTML="",s.forEach(t=>{const c=document.createElement("li");c.className="restore-point-card";const r=new Date(t.timestamp).toLocaleString("fa-IR",{weekday:"long",year:"numeric",month:"numeric",day:"numeric",hour:"2-digit",minute:"2-digit"}),n=(t.file.size/1024).toFixed(1)+" KB";c.innerHTML=`
                <div class="restore-card-header">
                    <span class="restore-date">${r}</span>
                    <span class="restore-size">${n}</span>
                </div>
                <div class="restore-desc">${t.metadata.description||"Ø¨Ø¯ÙˆÙ† ØªÙˆØ¶ÛŒØ­Ø§Øª"}</div>
                <div class="restore-actions">
                    <button class="btn-restore-action">Ø¨Ø§Ø²Ú¯Ø±Ø¯Ø§Ù†ÛŒ</button>
                </div>
            `,c.querySelector(".btn-restore-action").addEventListener("click",async()=>{try{const i=await t.file.text(),f=(await new _i().loadAsync(i,{base64:!0})).file("backup.json");if(!f)throw new Error("ÙØ§ÛŒÙ„ backup.json ÛŒØ§ÙØª Ù†Ø´Ø¯.");const h=await f.async("string"),m=JSON.parse(h);ls(m)}catch(i){console.error("Restore failed:",i),j("âŒ ÙØ§ÛŒÙ„ Ù¾Ø´ØªÛŒØ¨Ø§Ù† Ù…Ø¹ØªØ¨Ø± Ù†ÛŒØ³Øª.")}}),e.appendChild(c)})}catch(s){console.error("Failed to load snapshots:",s),e.innerHTML='<li style="text-align:center; color:red;">Ø®Ø·Ø§ Ø¯Ø± Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ Ø§Ø·Ù„Ø§Ø¹Ø§Øª.</li>'}}function Zi(e,s){const t=document.createElement("div");t.className="qualitative-button-container";const c=tt,r=c!==-1&&K.winnerHistory[c],n=r?K.winnerHistory[c]:null,a=K.studentRecords[e.identity.studentId];e.qualitativeStats||(e.qualitativeStats={}),e.qualitativeStats[s]||(e.qualitativeStats[s]={effort:0,good:0,excellent:0}),a.performanceRatings||(a.performanceRatings={});const i=r?n.rating:a.performanceRatings[s],o=K.isFinished||a.attendance==="absent"||a.hadIssue||a.wasOutOfClass;return[{key:"effort",label:"ØªÙ„Ø§Ø´",className:"effort-btn"},{key:"good",label:"Ø®ÙˆØ¨",className:"good-btn"},{key:"excellent",label:"Ø¹Ø§Ù„ÛŒ",className:"excellent-btn"}].forEach(f=>{const h=document.createElement("button");h.className=`qualitative-btn ${f.className}`,h.textContent=f.label,h.disabled=o,i===f.key&&h.classList.add("active"),h.addEventListener("click",()=>{const m=f.key;i&&e.qualitativeStats[s][i]>0&&e.qualitativeStats[s][i]--,i!==m&&(e.qualitativeStats[s][m]=(e.qualitativeStats[s][m]||0)+1);const u=i===m?null:m;r?n.rating=u:u?a.performanceRatings[s]=u:delete a.performanceRatings[s],se(),r?Ae():Ae(e,s)}),t.appendChild(h)}),t}function Hi(e,s,t="custom",c=null){e.innerHTML="",Object.values(Dt).forEach(n=>{const a=document.createElement("option");a.value=n.id,a.textContent=n.label,e.appendChild(a)}),e.value=t;const r=n=>{s.innerHTML="";const a=Dt[n];if(a&&a.levels.length>0)a.levels.forEach(i=>{const o=document.createElement("option");o.value=i,o.textContent=i,s.appendChild(o)}),s.disabled=!1;else{const i=document.createElement("option");i.value="",i.textContent="---",s.appendChild(i),s.disabled=!0}};r(t),c&&(s.value=c),e.onchange=()=>{r(e.value),s.dispatchEvent(new Event("change"))}}function mr(){wn.value="",Hi(Di,Ni,"custom"),De("add-class-modal");const e=[{label:"Ø´Ù†Ø¨Ù‡",value:6},{label:"ÛŒÚ©Ø´Ù†Ø¨Ù‡",value:0},{label:"Ø¯ÙˆØ´Ù†Ø¨Ù‡",value:1},{label:"Ø³Ù‡â€ŒØ´Ù†Ø¨Ù‡",value:2},{label:"Ú†Ù‡Ø§Ø±Ø´Ù†Ø¨Ù‡",value:3},{label:"Ù¾Ù†Ø¬â€ŒØ´Ù†Ø¨Ù‡",value:4},{label:"Ø¬Ù…Ø¹Ù‡",value:5}];os.innerHTML="",e.forEach(s=>{const t=document.createElement("label"),c=document.createElement("input");c.type="checkbox",c.value=s.value,t.appendChild(c),t.appendChild(document.createTextNode(s.label)),os.appendChild(t)}),cn.addEventListener("click",()=>{cn.classList.toggle("open"),Xa.classList.toggle("open");const s=cn.querySelector(".arrow");s.textContent=cn.classList.contains("open")?"â–¼":"â–¶"}),wn.focus()}function hr(){Vt.value="",En.checked=!1,cs.value=1,mn.style.visibility="hidden",De("category-modal"),Vt.focus()}function Js(){ue()}function _c(e,s){let t,c;if(e&&s)t=e,c=s,Jt({student:e,categoryName:s}),bt(-1);else{if(Jt(null),Xt(null),!K||tt<0||!K.winnerHistory[tt])return null;const r=K.winnerHistory[tt];t=r.winner,c=r.categoryName}return{winner:t,categoryName:c}}function kc(e,s){yt();const t=document.querySelector(".current-winner-highlight");if(t&&t.classList.remove("current-winner-highlight"),e){const r=document.querySelector(`.student-stats-table tr[data-student-id="${e.identity.studentId}"]`);r&&r.classList.add("current-winner-highlight")}const c=N.categories.find(r=>r.name===s);if(c){es(c),Fi(c),Zs(c),ds(e,Le),Sn(c),Xt(c.name);const r=document.querySelectorAll("#category-selection-container .pill");r.forEach(a=>a.classList.remove("active"));const n=Array.from(r).find(a=>a.textContent===s);n&&n.classList.add("active")}}function Ic(e,s,t){const c=document.createElement("div");c.className="winner-name-container";const r=document.createElement("button");r.className="btn-icon",r.innerHTML="Ë…",r.title="Ø¨Ø±Ù†Ø¯Ù‡ Ù‚Ø¨Ù„ÛŒ",r.classList.toggle("is-disabled",!t||tt<=0),r.addEventListener("click",()=>{r.classList.contains("is-disabled")?(r.classList.add("shake-animation"),setTimeout(()=>r.classList.remove("shake-animation"),200)):(bt(tt-1),Ae())});const n=K.studentRecords[e.identity.studentId],a=(n==null?void 0:n.attendance)==="absent",i=document.createElement("div");i.className="winner-name",i.innerHTML=`âœ¨ <strong>${e.identity.name}</strong>âœ¨`,ps(e.identity.studentId),i.classList.add("heartbeat-animation"),a?(i.style.textDecoration="line-through",i.style.opacity="0.6",i.style.color="var(--color-secondary)"):n!=null&&n.hadIssue?(i.style.color="var(--color-warning)",i.title="Ø§ÛŒÙ† Ø¯Ø§Ù†Ø´â€ŒØ¢Ù…ÙˆØ² Ø¯Ø± Ø§Ù†ØªØ®Ø§Ø¨ Ù‚Ø¨Ù„ÛŒ Ø¨Ø§ Ù…Ø´Ú©Ù„ Ù…ÙˆØ§Ø¬Ù‡ Ø´Ø¯Ù‡ Ø¨ÙˆØ¯"):n!=null&&n.wasOutOfClass&&(i.style.color="var(--color-strong-warning)",i.title="Ø§ÛŒÙ† Ø¯Ø§Ù†Ø´â€ŒØ¢Ù…ÙˆØ² Ø¯Ø± Ø²Ù…Ø§Ù† Ø§Ù†ØªØ®Ø§Ø¨ Ø®Ø§Ø±Ø¬ Ø§Ø² Ú©Ù„Ø§Ø³ Ø¨ÙˆØ¯");const o=()=>{tn=setTimeout(()=>{Cr(e,s),tn=null},1e3)},l=()=>{tn&&(clearTimeout(tn),tn=null)};["mousedown","touchstart"].forEach(m=>i.addEventListener(m,o)),["mouseup","mouseout","touchend","touchcancel","touchmove"].forEach(m=>i.addEventListener(m,l));const f=document.createElement("button");if(f.className="btn-icon",f.innerHTML="Ë„",f.title="Ø¨Ø±Ù†Ø¯Ù‡ Ø¨Ø¹Ø¯ÛŒ",f.classList.toggle("is-disabled",!t||tt>=K.winnerHistory.length-1),f.addEventListener("click",()=>{f.classList.contains("is-disabled")?(f.classList.add("shake-animation"),setTimeout(()=>f.classList.remove("shake-animation"),200)):(bt(tt+1),Ae())}),c.appendChild(f),c.appendChild(i),e.onboardingSession===K.sessionNumber){const m=document.createElement("div");m.className="new-student-badge",m.textContent="Ø¯Ø§Ù†Ø´ Ø¢Ù…ÙˆØ² Ø¬Ø¯ÛŒØ¯",c.appendChild(m)}c.appendChild(r);const h=document.getElementById("select-student-btn");return h&&(h.disabled=t&&!f.classList.contains("is-disabled")),{nameContainer:c,winnerNameEl:i}}function xc(e,s,t){const c=document.createElement("div");c.className="status-button-container";const r=document.createElement("button");r.textContent="ØºØ§ÛŒØ¨",r.classList.add("status-button","absent-btn"),(s==null?void 0:s.attendance)==="absent"&&r.classList.add("active");const n=document.createElement("button");n.textContent="Ù…Ø´Ú©Ù„",n.classList.add("status-button","issue-btn"),s!=null&&s.hadIssue&&n.classList.add("active");const a=document.createElement("button");a.textContent="Ø®Ø±ÙˆØ¬",a.classList.add("status-button","exit-btn"),s!=null&&s.wasOutOfClass&&a.classList.add("active");const i=document.createElement("button");i.textContent="Ù¾Ø±ÙˆÙØ§ÛŒÙ„",i.className="status-button profile-btn";const o=()=>{Re(),setTimeout(()=>{tt!==-1?Ae():Ae(e,t)},0),se()};return K.isFinished?[r,n,a,i].forEach(l=>l.disabled=!0):(r.addEventListener("click",()=>{const l=r.classList.contains("active");a.classList.contains("active")&&(a.classList.remove("active"),s.wasOutOfClass=!1,e.statusCounters.outOfClassCount=Math.max(0,(e.statusCounters.outOfClassCount||0)-1),e.statusCounters.missedChances=Math.max(0,e.statusCounters.missedChances-1)),l?(r.classList.remove("active"),K.setAttendance(e.identity.studentId,"present"),e.statusCounters.missedChances=Math.max(0,e.statusCounters.missedChances-1)):(n.classList.contains("active")&&(n.classList.remove("active"),s.hadIssue=!1,e.statusCounters.otherIssues=Math.max(0,e.statusCounters.otherIssues-1),e.statusCounters.missedChances=Math.max(0,e.statusCounters.missedChances-1)),r.classList.add("active"),K.setAttendance(e.identity.studentId,"absent"),e.statusCounters.missedChances++),o()}),n.addEventListener("click",()=>{const l=n.classList.contains("active");a.classList.contains("active")&&(a.classList.remove("active"),s.wasOutOfClass=!1,e.statusCounters.outOfClassCount=Math.max(0,(e.statusCounters.outOfClassCount||0)-1),e.statusCounters.missedChances=Math.max(0,e.statusCounters.missedChances-1)),l?(n.classList.remove("active"),s.hadIssue=!1,e.categoryIssues[t]&&(e.categoryIssues[t]=Math.max(0,e.categoryIssues[t]-1)),e.statusCounters.missedChances=Math.max(0,e.statusCounters.missedChances-1)):(r.classList.contains("active")&&(r.classList.remove("active"),K.setAttendance(e.identity.studentId,"present"),e.statusCounters.missedChances=Math.max(0,e.statusCounters.missedChances-1)),n.classList.add("active"),s.hadIssue=!0,e.categoryIssues[t]=(e.categoryIssues[t]||0)+1,e.statusCounters.missedChances++),o()}),a.addEventListener("click",()=>{a.classList.contains("active")?(a.classList.remove("active"),s.wasOutOfClass=!1,e.statusCounters.outOfClassCount=Math.max(0,(e.statusCounters.outOfClassCount||0)-1),e.statusCounters.missedChances=Math.max(0,e.statusCounters.missedChances-1)):(r.classList.contains("active")&&(r.classList.remove("active"),K.setAttendance(e.identity.studentId,"present"),e.statusCounters.missedChances=Math.max(0,e.statusCounters.missedChances-1)),n.classList.contains("active")&&(n.classList.remove("active"),s.hadIssue=!1,e.categoryIssues[t]&&(e.categoryIssues[t]=Math.max(0,e.categoryIssues[t]-1)),e.statusCounters.missedChances=Math.max(0,e.statusCounters.missedChances-1)),a.classList.add("active"),s.wasOutOfClass=!0,e.statusCounters.outOfClassCount=(e.statusCounters.outOfClassCount||0)+1,e.statusCounters.missedChances++),o()}),i.addEventListener("click",()=>{Ue(e)})),c.appendChild(r),c.appendChild(a),c.appendChild(n),c.appendChild(i),c}function Lc(e,s){const t=document.createElement("div");t.className="student-details-container";const c=document.createElement("div");c.className="student-details-scores",c.innerHTML="<h4>Ø¢Ø®Ø±ÛŒÙ† Ù†Ù…Ø±Ø§Øª</h4>";const r=document.createElement("ul");r.className="scores-list";const n=N.categories.filter(u=>u.isGradedCategory&&!u.isDeleted);let a=!1;const i=e.logs.scores||{};n.forEach(u=>{var _;const y=u.name,p=y.toLowerCase(),b=(_=i[p])==null?void 0:_.filter(k=>!k.isDeleted),v=document.createElement("li"),C=document.createElement("span");C.className="skill-name",C.textContent=`${y}:`;const S=document.createElement("span");if(S.className="skill-scores",b&&b.length>0){a=!0;const k=b.slice(-3);k.forEach((x,L)=>{const B=document.createElement("span");B.textContent=x.value+(x.comment?"'":""),x.comment&&(B.dataset.tooltip=x.comment,B.style.position="relative",B.style.cursor="help",B.classList.add("tooltip-container")),S.appendChild(B),L<k.length-1&&S.appendChild(document.createTextNode(","))})}else S.textContent="none";v.appendChild(C),v.appendChild(S),r.appendChild(v)}),a||(r.innerHTML='<div class="no-content-message">Ù‡Ù†ÙˆØ² Ù†Ù…Ø±Ù‡â€ŒØ§ÛŒ Ø«Ø¨Øª Ù†Ø´Ø¯Ù‡ Ø§Ø³Øª.</div>'),c.appendChild(r),t.appendChild(c);const o=document.createElement("div");o.className="student-details-notes";const l=document.createElement("div");l.className="history-section-header";const f=document.createElement("h4");f.textContent="ÛŒØ§Ø¯Ø¯Ø§Ø´Øªâ€ŒÙ‡Ø§";const h=document.createElement("button");h.className="btn-icon",h.innerHTML="ðŸ“",h.title="Ø§ÙØ²ÙˆØ¯Ù† ÛŒØ§Ø¯Ø¯Ø§Ø´Øª Ø¬Ø¯ÛŒØ¯",K.isFinished?h.disabled=!0:h.addEventListener("click",()=>{ye.value="",ye.dispatchEvent(new Event("input",{bubbles:!0})),dt(u=>{u&&(e.addNote(u),se(),Ae(),j("âœ… ÛŒØ§Ø¯Ø¯Ø§Ø´Øª Ø¨Ø§ Ù…ÙˆÙÙ‚ÛŒØª Ø«Ø¨Øª Ø´Ø¯."))}),De("add-note-modal"),ye.focus()}),l.appendChild(f),l.appendChild(h),o.appendChild(l);const m=document.createElement("ul");return m.className="notes-list",e.profile.notes&&e.profile.notes.length>0?[...e.profile.notes].sort((y,p)=>new Date(p.timestamp)-new Date(y.timestamp)).forEach(y=>{const p=document.createElement("li");p.dir=vs(y.content),p.textContent=y.content,m.appendChild(p)}):m.innerHTML='<div class="no-content-message">ÛŒØ§Ø¯Ø¯Ø§Ø´ØªÛŒ ÙˆØ¬ÙˆØ¯ Ù†Ø¯Ø§Ø±Ø¯.</div>',o.appendChild(m),t.appendChild(o),t}function kn(){if(En&&mn){mn.style.display="flex";const e=En.checked;mn.style.visibility=e?"visible":"hidden"}}const pr=Object.freeze(Object.defineProperty({__proto__:null,_internalShowPage:us,addClassModal:co,addNoteModal:Oo,addScoreBtn:Ho,addStudentBtn:ho,appHeader:$s,assessmentModeLabel:_o,attendanceListUl:dn,attendanceMassActionsContainer:Fn,attendancePage:ko,attendancePane:Kt,attendanceSearchInput:Bt,backToSessionsBtn:fo,backToStudentPageBtn:$o,backupDataBtn:Bo,breadcrumbContainer:jt,cancelAddClassBtn:As,cancelImportBtn:So,cancelNoteBtn:zo,categoryListUl:Os,categoryModal:Yo,categoryModalCancelBtn:Xo,categoryModalSaveBtn:Za,categoryModalTitle:Ga,categoryWeightLabel:sn,classListHeader:xo,classListUl:At,classManagementPage:Na,classSaveNoteBtn:Ro,clearWinnerDisplay:yt,closeActiveModal:ue,closeAddClassModal:Js,closeContextMenu:Mt,closeNavBtn:To,columnMappingPage:wo,columnSelectDropdown:zs,confirmAddClassBtn:Ns,confirmColumnBtn:Eo,confirmModalCancelBtn:Fs,confirmModalConfirmBtn:an,confirmModalMessage:Pa,contextMenu:$t,csvCancelBtn:vo,csvConfirmBtn:yo,csvFileInput:Co,csvPreviewList:Rs,csvPreviewPage:go,customConfirmModal:No,displayWinner:Ae,finishAttendanceBtn:Io,get fromAssessmentToNormalSelection(){return Cs},globalStudentSearchInput:rn,globalStudentSearchResultsDiv:ut,gradedCategoryPillsContainer:Po,hamburgerMenuBtn:Lo,handleUndo:tr,importCsvBtn:bo,massCommentAppendCheckbox:Ai,massCommentBtn:Us,massCommentCancelBtn:tc,massCommentContent:fn,massCommentModal:Qo,massCommentModalTitle:ec,massCommentSaveBtn:nc,massCommentStudentCountMessage:Va,modalAddClassLevelSelect:Ni,modalAddClassSystemSelect:Di,modalNewClassNameInput:wn,modalScheduleContent:Xa,modalScheduleDaysContainer:os,modalScheduleEndTimeInput:Ya,modalScheduleStartTimeInput:Ka,modalScheduleTextInput:Ja,modalScheduleToggle:cn,newCategoryModal:ic,newCategoryModalIsGradedCheckbox:En,newCategoryModalNameInput:Vt,newCategoryModalWeightGroup:mn,newCategoryModalWeightInput:cs,newNoteContent:ye,newScoreCommentTextarea:Ua,newScoreValueInput:Fo,newStudentNameInput:mo,openAddCategoryBtn:ac,openAddCategoryModal:hr,openAddClassModal:mr,openAddClassModalBtn:oo,openContextMenu:Gs,openModal:De,overlay:za,pasteArea:Oa,populateSystemLevelSelects:Hi,processMassHomeworkComment:js,processPasteBtn:po,profileScoresListUl:Wo,profileStatsSummaryDiv:Uo,quickGradeFormWrapper:qt,quickGradeSubmitBtn:It,quickNoteTextarea:Xe,quickScoreInput:Ye,renderAttendancePage:ot,renderBreadcrumbs:ir,renderClassList:Fe,renderClassManagementStats:Es,renderColumnSelector:lr,renderGlobalSearchResults:jn,renderImportPreview:Vs,renderLogModal:sr,renderMassCommentControls:Ri,renderRestorePointsPage:fr,renderScoresHistory:or,renderSearchResults:ln,renderSessionDashboard:Ln,renderSessions:qe,renderSettingsCategories:Qt,renderSettingsOther:dr,renderSettingsStudentList:Lt,renderStudentNotes:cr,renderStudentStatsList:Re,renderTrashPage:_n,reportCancelBtn:qa,reportColumnsContainer:Wa,reportConfigModal:Ko,reportPrintBtn:ja,restoreDataBtn:Do,restoreFileInput:$a,secureConfirmCancelBtn:Mo,secureConfirmCode:Ha,secureConfirmConfirmBtn:Pn,secureConfirmInput:Wt,secureConfirmMessage:Fa,secureConfirmModal:Ao,selectStudentBtn:Qe,selectStudentBtnWrapper:zt,sessionDashboardPage:sc,setAutoDirectionOnInput:Pi,setFromAssessmentToNormalSelection:Qa,settingsClassNameHeader:Ma,settingsEduSystemSelect:Hn,settingsLevelSelect:on,settingsPage:uo,settingsStudentListUl:Ms,setupDashboardTabs:er,setupLongPress:Nt,showCategoryModal:Ws,showClassNoteModal:ws,showCustomConfirm:me,showMassCommentModal:zi,showMoveStudentModal:Mi,showNotification:j,showPage:Ee,showRenameStudentModal:Oi,showRestoreConfirmModal:ls,showSecureConfirm:nr,showSessionNoteModal:$i,showSettingsPage:xt,showStudentProfile:Ue,showUndoToast:rc,sideNavMenu:Ra,studentSearchInput:Hs,studentSearchResultsDiv:Et,studentStatsHeader:Ps,switchDashboardTab:Yt,syncWeightGroupVisibility:kn,trashedCategoriesList:Zo,trashedClassesList:jo,trashedNotesList:Vo,trashedScoresList:Jo,trashedSessionsList:Go,trashedStudentsList:qo,triggerFileDownload:qs,undoBtn:lo,undoMessage:Aa,undoToast:rs,updateCategoryColumnHighlight:Xt,updateDemoModeBanner:Ss,updateQualitativeStatsLabel:ds,updateQuickGradeUIForCategory:Sn},Symbol.toStringTag,{value:"Module"}));function Tc(){ci(JSON.parse(JSON.stringify({classrooms:ie,trashBin:He}))),oi(!0)}function Bc(){oi(!1),fi(),ci(null)}function Vi(){me("Ø¢ÛŒØ§ Ø§Ø² Ø®Ø±ÙˆØ¬ Ø§Ø² Ø­Ø§Ù„Øª Ù†Ù…Ø§ÛŒØ´ (Demo) Ù…Ø·Ù…Ø¦Ù† Ù‡Ø³ØªÛŒØ¯ØŸ Ø¨Ø§ Ø®Ø±ÙˆØ¬ØŒ ØªÙ…Ø§Ù… ØªØºÛŒÛŒØ±Ø§Øª Ø¢Ø²Ù…Ø§ÛŒØ´ÛŒ Ø´Ù…Ø§ Ø­Ø°Ù Ø´Ø¯Ù‡ Ùˆ Ø¯Ø§Ø¯Ù‡â€ŒÙ‡Ø§ÛŒ Ø§ØµÙ„ÛŒ Ø´Ù…Ø§ Ø¨Ø§Ø²ÛŒØ§Ø¨ÛŒ Ø®ÙˆØ§Ù‡Ù†Ø¯ Ø´Ø¯.",()=>{Bc(),Ge(null),rt(null),kt(null),Fe(),Ee("class-management-page"),Ss(),je()},{confirmText:"Ø®Ø±ÙˆØ¬",confirmClass:"btn-success"})}function Dc(){document.getElementById("demo-mode-btn").addEventListener("click",()=>{vt?Vi():(je(),me("Ø´Ù…Ø§ Ø¯Ø± Ø­Ø§Ù„ ÙˆØ±ÙˆØ¯ Ø¨Ù‡ Ø­Ø§Ù„Øª Ù†Ù…Ø§ÛŒØ´ (Demo) Ù‡Ø³ØªÛŒØ¯. Ø¯Ø± Ø§ÛŒÙ† Ø­Ø§Ù„ØªØŒ Ù‡ÛŒÚ†â€ŒÚ©Ø¯Ø§Ù… Ø§Ø² ØªØºÛŒÛŒØ±Ø§Øª Ø´Ù…Ø§ Ø°Ø®ÛŒØ±Ù‡ Ù†Ø®ÙˆØ§Ù‡Ø¯ Ø´Ø¯. Ø¢ÛŒØ§ Ø§Ø¯Ø§Ù…Ù‡ Ù…ÛŒâ€ŒØ¯Ù‡ÛŒØ¯ØŸ",()=>{Tc(),Ss(),je()},{confirmText:"ØªØ§ÛŒÛŒØ¯",confirmClass:"btn-warning",onCancel:je}))});const s=document.getElementById("exit-demo-btn");s&&s.addEventListener("click",()=>{vt&&Vi()})}let Ts=0,Ji=!1;function gr(){window.dev={state:Ca,ui:pr,utils:Kr,db:Pr,main:Sr},console.log("ðŸ› ï¸ Developer Mode Active! Modules exposed to 'window.dev'");const e=document.querySelector(".app-header h1");e&&(e.style.color="var(--color-primary)",e.classList.add("dev-mode-tilt"))}function yr(){if(Ji){console.warn("Developer access is already initialized. Remove the redundant call.");return}const e=document.querySelector(".app-header h1");e&&(e.addEventListener("click",()=>{Be.isDeveloperMode||(Ts++,Ts===10&&(Ct({isDeveloperMode:!0}),gr(),j("ðŸ› ï¸ Ø­Ø§Ù„Øª ØªÙˆØ³Ø¹Ù‡â€ŒØ¯Ù‡Ù†Ø¯Ù‡ ÙØ¹Ø§Ù„ Ø´Ø¯."),Ts=0))}),Nt(e,()=>{Be.isDeveloperMode&&me("Ø¢ÛŒØ§ Ø§Ø² Ø®Ø±ÙˆØ¬ Ø§Ø² Ø­Ø§Ù„Øª ØªÙˆØ³Ø¹Ù‡â€ŒØ¯Ù‡Ù†Ø¯Ù‡ Ù…Ø·Ù…Ø¦Ù† Ù‡Ø³ØªÛŒØ¯ØŸ",()=>{Ct({isDeveloperMode:!1}),se(!0),window.location.reload()},{confirmText:"Ø¨Ù„Ù‡",confirmClass:"btn-warning"})}),Ji=!0)}const Nc=Object.freeze(Object.defineProperty({__proto__:null,activateDeveloperAccessOnConsole:yr,bootstrapDeveloperMode:gr},Symbol.toStringTag,{value:"Module"}));function Ac(e){e.addEventListener("click",()=>{const s=new Date().getTime();s-ni>500?Mn(1):Mn(Zn+1),ga(s),Zn===5&&(Mn(0),me("Ø¢ÛŒØ§ Ø§Ø² Ø³Ø§Ø®Øª ÛŒÚ© Ú©Ù„Ø§Ø³ ØªØ³ØªÛŒ ØªØµØ§Ø¯ÙÛŒ Ù…Ø·Ù…Ø¦Ù† Ù‡Ø³ØªÛŒØ¯ØŸ",()=>{function t(){const c=`Ú©Ù„Ø§Ø³ ØªØ³ØªÛŒ ${Object.keys(ie).length+1}`,r=new Xs({name:c,type:"online"});["Ø¹Ù„ÛŒ . Ø±Ø¶Ø§ÛŒÛŒ","Ù…Ø±ÛŒÙ… . Ø­Ø³ÛŒÙ†ÛŒ","Ø²Ù‡Ø±Ø§ . Ø§Ø­Ù…Ø¯ÛŒ","Ø±Ø¶Ø§ . Ù…Ø­Ù…Ø¯ÛŒ","ÙØ§Ø·Ù…Ù‡ . Ú©Ø±ÛŒÙ…ÛŒ"].forEach(a=>r.addStudent(new qn(Gt(a)))),ie[c]=r,se(),Fe()}t(),j("Ú©Ù„Ø§Ø³ ØªØ³ØªÛŒ Ø¨Ø§ Ù…ÙˆÙÙ‚ÛŒØª Ø³Ø§Ø®ØªÙ‡ Ø´Ø¯ âœ…!")},{confirmText:"Ø¨Ø³Ø§Ø²",confirmClass:"btn-success"}))})}let Ks=null;const Mc=2*60*1e3,vr=["mousemove","keypress","scroll","click","touchstart"];let ft=null;function Oc(){ft.classList.add("visible")}function br(){ft.classList.remove("visible")}function ms(){br(),clearTimeout(Ks),Ks=setTimeout(Oc,Mc)}function hs(e){e.preventDefault(),e.stopPropagation(),setTimeout(ms,0)}function Ys(){if(!ft&&(ft=document.getElementById("screen-saver-overlay"),!ft))return;ms(),vr.forEach(s=>window.addEventListener(s,ms)),ft.addEventListener("click",hs),ft.addEventListener("touchstart",hs);const e="23.5.0";{const s=document.getElementById("screen-saver-version");s&&(s.textContent=`v${e}`)}}function Rc(){clearTimeout(Ks),br(),vr.forEach(e=>window.removeEventListener(e,ms)),ft&&(ft.removeEventListener("click",hs),ft.removeEventListener("touchstart",hs))}function zc(e){e&&e.addEventListener("change",s=>{const t=s.target.checked;Ct({isScreenSaverEnabled:t}),t?Ys():Rc()})}let Bs=!1;const $c={"session-dashboard-page":"session-page","column-mapping-page":"settings-page","csv-preview-page":"settings-page","restore-points-page":"class-management-page","session-page":"class-management-page","settings-page":"class-management-page","trash-page":"class-management-page","class-management-page":null};function Pc(e){if(e==="class-management-page"){Ge(null),rt(null),history.replaceState({pageId:e},"","#class-management-page"),us(e);return}else e==="session-page"&&(rt(null),N&&qe());const s=new URLSearchParams;N&&s.set("class",N.info.name),K&&s.set("session",K.sessionNumber);const t=`#${e}${s.toString()?"?"+s.toString():""}`;history.replaceState({pageId:e},"",t),us(e)}function Ui(e=!1){if(gt){ue();return}const s=document.querySelector(".page.active");if(!s)return;const t=$c[s.id];t&&(e?Pc(t):Ee(t))}function Fc(){const e=window.location.hash;if(!e||e==="#")return!1;const[s,t]=e.split("?"),c=s.substring(1),r=new URLSearchParams(t),n=r.get("class"),a=parseInt(r.get("session"),10),i=r.get("student"),o=r.get("tab")||"selector";if(n&&ie[n])Ge(ie[n]),a&&N.getSession(a)&&rt(N.getSession(a)),i&&N.students.find(l=>l.identity.studentId===i)&&kt(N.students.find(l=>l.identity.studentId===i));else return!1;switch(c){case"session-page":qe(),Ee("session-page");break;case"session-dashboard-page":Ln(c==="attendance-page"?"attendance":o);break;case"settings-page":xt(N);break;default:return!1}return!0}document.addEventListener("DOMContentLoaded",()=>{const{globalStudentSearchInput:e,undoBtn:s,newStudentNameInput:t,addStudentBtn:c,pasteArea:r,processPasteBtn:n,csvPreviewList:a,csvConfirmBtn:i,csvCancelBtn:o,importCsvBtn:l,csvFileInput:f,columnSelectDropdown:h,confirmColumnBtn:m,cancelImportBtn:u,selectStudentBtn:y,finishAttendanceBtn:p,classListHeader:b,studentStatsHeader:v,hamburgerMenuBtn:C,sideNavMenu:S,closeNavBtn:_,overlay:k,backupDataBtn:x,restoreDataBtn:L,restoreFileInput:B,confirmModalCancelBtn:M,confirmModalConfirmBtn:U,secureConfirmCancelBtn:Q,secureConfirmConfirmBtn:I,newNoteContent:z,classSaveNoteBtn:g,cancelNoteBtn:F,studentSearchInput:re,studentSearchResultsDiv:G,categoryModalSaveBtn:de,categoryModalCancelBtn:V,massCommentBtn:le,massCommentCancelBtn:O,massCommentSaveBtn:A,massCommentContent:oe,massCommentAppendCheckbox:ee,attendanceSearchInput:X,newCategoryModalNameInput:xe,newCategoryModalIsGradedCheckbox:Me,newCategoryModalWeightInput:he,openAddCategoryBtn:ve}=pr,Oe=document.getElementById("trash-nav-btn");document.querySelector(".global-search-container .search-icon"),fi(),Be.isDeveloperMode&&Ir(()=>Promise.resolve().then(()=>Nc),void 0).then(R=>{R.bootstrapDeveloperMode()}),Ss(),Fc()||(Fe(),Ee("class-management-page"));function Ze(R,Z){const H=document.querySelector(R);if(!H)return;const ne=H.querySelector(".search-icon"),ce=H.querySelector(".animated-search-input");!ne||!ce||(ne.addEventListener("mousedown",Ce=>{Ce.preventDefault()}),ne.addEventListener("click",()=>{H.classList.contains("search-active")||(H.classList.add("search-active"),ce.focus())}),ce.addEventListener("blur",()=>{setTimeout(()=>{H.classList.remove("search-active"),ce.value="",Z&&Z([])},150)}))}X.addEventListener("input",()=>{const R=X.value.toLowerCase().trim(),Z=zn(R);dn.querySelectorAll(".attendance-list-item").forEach(ne=>{const ce=ne.querySelector(".student-name");if(ce){const Ce=ce.textContent,pe=Pe(Ce.toLowerCase()),ke=pe.includes(Pe(R)),ze=pe.includes(Pe(Z));ke||ze?ne.style.display="flex":ne.style.display="none"}})}),V.addEventListener("click",()=>{ue(),vn(null)}),de.addEventListener("click",()=>{const R=xe.value.trim(),Z=Me.checked,H=parseInt(he.value,10)||1;if(!R){pt(xe,3e3),j("âš ï¸ Ù†Ø§Ù… Ø¯Ø³ØªÙ‡â€ŒØ¨Ù†Ø¯ÛŒ Ù†Ù…ÛŒâ€ŒØªÙˆØ§Ù†Ø¯ Ø®Ø§Ù„ÛŒ Ø¨Ø§Ø´Ø¯.");return}typeof Kn=="function"&&Kn(R,Z,H),ue(),j(`âœ… Ø¯Ø³ØªÙ‡â€ŒØ¨Ù†Ø¯ÛŒ Ø¬Ø¯ÛŒØ¯ ${R} Ø¨Ø§ Ù…ÙˆÙÙ‚ÛŒØª Ø§Ø¶Ø§ÙÙ‡ Ø´Ø¯.`),Qt(),Re()}),window.addEventListener("scroll",Mt),document.addEventListener("click",R=>{$t.classList.contains("visible")&&!$t.contains(R.target)&&Mt(),re.contains(R.target)||(G.style.display="none");const Z=R.target.closest(".log-action-link");if(Z&&Z.dataset.action)try{const H=JSON.parse(Z.dataset.action);Pt(H)}catch(H){console.error("Could not parse log action:",H)}}),zt.addEventListener("click",()=>{(zt.classList.contains("disabled-wrapper")||Qe.disabled)&&(Qe.classList.add("shake-animation"),setTimeout(()=>{Qe.classList.remove("shake-animation")},200))}),v.addEventListener("click",()=>{const R=new Date().getTime();R-si>500?On(1):On(Vn+1),ya(R),Vn===5&&(On(0),me("Ø¢ÛŒØ§ Ø§Ø² ØµÙØ± Ú©Ø±Ø¯Ù† ØªÙ…Ø§Ù… Ø´Ù…Ø§Ø±Ù†Ø¯Ù‡â€ŒÙ‡Ø§ÛŒ Ø¯Ø§Ù†Ø´â€ŒØ¢Ù…ÙˆØ²Ø§Ù† Ù…Ø·Ù…Ø¦Ù† Ù‡Ø³ØªÛŒØ¯ØŸ Ø§ÛŒÙ† Ø¹Ù…Ù„ ØºÛŒØ±Ù‚Ø§Ø¨Ù„ Ø¨Ø§Ø²Ú¯Ø´Øª Ø§Ø³Øª.",()=>{fa(),Re(),j("ØªÙ…Ø§Ù… Ø¢Ù…Ø§Ø±Ù‡Ø§ ØµÙØ± Ø´Ø¯Ù†Ø¯ âœ….")},{confirmText:"Ø¨Ù„Ù‡",confirmClass:"btn-warning"}))}),Ac(b),yr(),Q.addEventListener("click",()=>{ue(),yn(null)});const Ve=document.getElementById("date-picker-confirm-btn"),d=document.getElementById("date-picker-cancel-btn"),P=document.getElementById("dp-day"),$=document.getElementById("dp-month"),E=document.getElementById("dp-year");Ve.addEventListener("click",()=>{const R=E.value,Z=$.value,H=P.value;R&&Z&&H&&typeof Xn=="function"?(Xn({jy:R,jm:Z,jd:H}),ue()):j("âš ï¸ Ø®Ø·Ø§ Ø¯Ø± Ø§Ù†ØªØ®Ø§Ø¨ ØªØ§Ø±ÛŒØ®."),ts(null)}),d&&d.addEventListener("click",()=>{ue(),ts(null)}),I.addEventListener("click",()=>{typeof Jn=="function"&&Jn(),ue(),yn(null)}),M.addEventListener("click",()=>{ue(ai)}),U.addEventListener("click",()=>{ue(ii)}),Qe.addEventListener("click",()=>{if(xi(y),Bs){Bs=!1;return}if(Ye.value.trim()!==""||Xe.value.trim()!==""){j("âš ï¸Ù„Ø·ÙØ§Ù‹ Ø§Ø¨ØªØ¯Ø§ Ø¨Ø§ Ø¯Ú©Ù…Ù‡ Â«Ø«Ø¨ØªÂ»ØŒ ØªØºÛŒÛŒØ±Ø§Øª Ø±Ø§ Ø°Ø®ÛŒØ±Ù‡ Ú©Ù†ÛŒØ¯ Ùˆ ÛŒØ§ Ù†Ù…Ø±Ù‡ Ùˆ ÛŒØ§Ø¯Ø¯Ø§Ø´Øª Ø±Ø§ Ù¾Ø§Ú© Ú©Ù†ÛŒØ¯.",4200),pt(Ye),pt(Xe);return}if(_t){const R=wr(N,Le);R?($n(),Re(),Ae(R,Le.name),ds(R,Le),Xt(Le.name),se()):me("Ø¨Ø±Ø§ÛŒ ØªÙ…Ø§Ù… Ø¯Ø§Ù†Ø´â€ŒØ¢Ù…ÙˆØ²Ø§Ù† Ø¯Ø± Ø§ÛŒÙ† Ø¬Ù„Ø³Ù‡ ÛŒÚ© Ø¨Ø§Ø± ÙØ±ØµØª Ù†Ù…Ø±Ù‡â€ŒÚ¯ÛŒØ±ÛŒ ÙØ±Ø§Ù‡Ù… Ø´Ø¯Ù‡Ø› Ø¢ÛŒØ§ Ù…ÛŒâ€ŒØ®ÙˆØ§Ù‡ÛŒØ¯ Ø¨Ø±Ø§ÛŒ Ø¨Ø§Ø± Ø¯ÙˆÙ… Ø§ÛŒÙ† Ú©Ø§Ø± Ø±Ø§ ØªÚ©Ø±Ø§Ø± Ú©Ù†ÛŒØ¯ØŸ",()=>{const Z=Le.id;at[Z].scoredThisSession=[],Qe.click()},{confirmText:"Ø¨Ù„Ù‡",cancelText:"Ø®ÛŒØ±",confirmClass:"btn-success"})}else{if(!N||!K||!Le)return;const R=N.selectNextWinner(Le.name,K);if(R){$n();const Z=K.studentRecords[R.identity.studentId];(Z==null?void 0:Z.attendance)==="absent"&&R.statusCounters.missedChances++,Z!=null&&Z.hadIssue&&(R.statusCounters.missedChances++,R.categoryIssues[Le.name]=(R.categoryIssues[Le.name]||0)+1),Z!=null&&Z.wasOutOfClass&&(R.statusCounters.outOfClassCount=(R.statusCounters.outOfClassCount||0)+1,R.statusCounters.missedChances++);const H={winner:R,categoryName:Le.name};K.winnerHistory.push(H),K.winnerHistory.length>10&&K.winnerHistory.shift(),bt(K.winnerHistory.length-1),K.lastUsedCategoryId=Le.id,K.lastSelectedWinnerId=R.identity.studentId,Re(),setTimeout(()=>{Ae(),ds(R,Le)},0),se()}else j("âŒØ¯Ø§Ù†Ø´â€ŒØ¢Ù…ÙˆØ² ÙˆØ§Ø¬Ø¯ Ø´Ø±Ø§ÛŒØ·ÛŒ Ø¨Ø±Ø§ÛŒ Ø§Ù†ØªØ®Ø§Ø¨ ÛŒØ§ÙØª Ù†Ø´Ø¯.")}}),document.querySelectorAll('#settings-page input[name="class-type-setting"]').forEach(R=>{R.addEventListener("change",()=>{if(!N)return;const Z=R.value,H=N.info.type||"in-person";if(Z===H)return;const ne=pe=>pe==="online"?"Ø¢Ù†Ù„Ø§ÛŒÙ†":"Ø­Ø¶ÙˆØ±ÛŒ",ce=ne(H),Ce=ne(Z);me(`Ø¢ÛŒØ§ Ø§Ø² ØªØºÛŒÛŒØ± Ù†ÙˆØ¹ Ú©Ù„Ø§Ø³ Ø§Ø² Â«${ce}Â» Ø¨Ù‡ Â«${Ce}Â» Ù…Ø·Ù…Ø¦Ù† Ù‡Ø³ØªÛŒØ¯ØŸ`,()=>{N.info.type=Z,se(),be(N.info.name,`Ù†ÙˆØ¹ Ú©Ù„Ø§Ø³ Ø¨Ù‡ Â«${Ce}Â» ØªØºÛŒÛŒØ± ÛŒØ§ÙØª.`,{type:"VIEW_CLASS_SETTINGS"}),Fe(),j(`âœ… Ù†ÙˆØ¹ Ú©Ù„Ø§Ø³ Ø¨Ù‡ Â«${Ce}Â» ØªØºÛŒÛŒØ± ÛŒØ§ÙØª.`)},{confirmText:"Ø¨Ù„Ù‡",confirmClass:"btn-warning",onCancel:()=>{const pe=document.querySelector(`#settings-page input[name="class-type-setting"][value="${H}"]`);pe&&(pe.checked=!0)}})})});const T=document.querySelectorAll('input[name="schedule-day"]'),W=document.getElementById("settings-schedule-start"),q=document.getElementById("settings-schedule-end");T.forEach(R=>{R.addEventListener("change",()=>{if(!N)return;const Z=Array.from(T).filter(H=>H.checked).map(H=>parseInt(H.value));N.info.scheduleDays=Z,se()})});const D=()=>{N&&(N.info.scheduleStartTime=W.value,N.info.scheduleEndTime=q.value,se())};W.addEventListener("change",D),q.addEventListener("change",D),m.addEventListener("click",()=>{if(!Gn){j("âŒØ®Ø·Ø§ÛŒÛŒ Ø±Ø® Ø¯Ø§Ø¯Ù‡ Ø§Ø³Øª. Ù„Ø·ÙØ§Ù‹ ÙØ§ÛŒÙ„ Ø±Ø§ Ø¯ÙˆØ¨Ø§Ø±Ù‡ Ø§Ù†ØªØ®Ø§Ø¨ Ú©Ù†ÛŒØ¯."),Ee("settings-page");return}const R=parseInt(h.value,10),ne=Gn.split(`
`).slice(1).map(ce=>{var pe;return(pe=ce.split(",")[R])==null?void 0:pe.trim()}).filter(ce=>ce&&ce.length>0);ne.length>0?(nn(ne),Vs(),Ee("csv-preview-page")):j("Ù‡ÛŒÚ† Ù†Ø§Ù…ÛŒ Ø¯Ø± Ø³ØªÙˆÙ† Ø§Ù†ØªØ®Ø§Ø¨ Ø´Ø¯Ù‡ Ù¾ÛŒØ¯Ø§ Ù†Ø´Ø¯. Ù„Ø·ÙØ§Ù‹ Ø³ØªÙˆÙ† Ø¯ÛŒÚ¯Ø±ÛŒ Ø±Ø§ Ø§Ù…ØªØ­Ø§Ù† Ú©Ù†ÛŒØ¯ ÛŒØ§ ÙØ§ÛŒÙ„ Ø®ÙˆØ¯ Ø±Ø§ Ø¨Ø±Ø±Ø³ÛŒ Ú©Ù†ÛŒØ¯."),An(null)}),l.addEventListener("click",()=>{f.click()}),f.addEventListener("change",R=>{const Z=R.target.files[0];if(!Z)return;const H=new FileReader;H.onload=ne=>{const ce=ne.target.result;An(ce);const pe=ce.split(`
`)[0].split(",");lr(pe),Ee("column-mapping-page")},H.readAsText(Z),R.target.value=null}),u.addEventListener("click",()=>{An(null),Ee("settings-page")}),i.addEventListener("click",()=>{const R=a.querySelectorAll('input[type="checkbox"]:checked');let Z=0,H=[],ne=!1;R.forEach(Ce=>{const pe=Ce.dataset.name,ke=Gt(pe),ze=Pe(ke.name),We=N.students.find(st=>Pe(st.identity.name)===ze&&ze!=="");if(We)if(We.isDeleted)ys(We,N);else{H.push(ke.name);return}const ht=new qn(ke);N.addStudent(ht),N.sessions.length>0&&(ge(N.sessions).filter(st=>st.isFinished&&!st.isCancelled).forEach(st=>{st.setAttendance(ht.identity.studentId,"absent")}),wt(ht,N),ne=!0),Z++}),se(),Z>0&&be(N.info.name,`${Z} Ø¯Ø§Ù†Ø´â€ŒØ¢Ù…ÙˆØ² Ø¬Ø¯ÛŒØ¯ Ø§Ø² Ù„ÛŒØ³Øª ÙˆØ±ÙˆØ¯ÛŒ Ø¨Ù‡ Ú©Ù„Ø§Ø³ Ø§Ø¶Ø§ÙÙ‡ Ø´Ø¯Ù†Ø¯.`,{type:"VIEW_SESSIONS"}),xt(N);let ce=H.length>0?`âš ï¸ Ù…ÙˆØ§Ø±Ø¯ Ø²ÛŒØ± Ø¨Ù‡ Ø¯Ù„ÛŒÙ„ ØªÚ©Ø±Ø§Ø±ÛŒ Ø¨ÙˆØ¯Ù† Ù†Ø§Ø¯ÛŒØ¯Ù‡ Ú¯Ø±ÙØªÙ‡ Ø´Ø¯Ù†Ø¯:
- ${H.join(`
- `)}`:"";if(ne)Ke(Z,ce);else if(H.length>0||Z>0){const Ce=Z>0?`âœ… ${Z} Ø¯Ø§Ù†Ø´â€ŒØ¢Ù…ÙˆØ² Ø¨Ø§ Ù…ÙˆÙÙ‚ÛŒØª Ø§Ø¶Ø§ÙÙ‡ Ø´Ø¯Ù†Ø¯.
${ce}`:ce;me(Ce,()=>{},{confirmText:"Ù…ØªÙˆØ¬Ù‡ Ø´Ø¯Ù…",confirmClass:"btn-success",onCancel:null})}r.value="",nn([])}),o.addEventListener("click",()=>{nn([]),Ee("settings-page")}),r.addEventListener("keydown",R=>{if(R.key==="Enter"){const Z=r.value,H=r.selectionStart,ne=Z.lastIndexOf(`
`,H-1),ce=Z.substring(ne+1,H).trim(),Ce=ce.indexOf(".");ce&&(Ce<=0||Ce>=ce.length-1)&&(R.preventDefault(),j("Ù„Ø·ÙØ§ ÛŒÚ© Ù†Ù‚Ø·Ù‡ Ø¨ÛŒÙ† Ù†Ø§Ù… Ùˆ Ù†Ø§Ù… Ø®Ø§Ù†ÙˆØ§Ø¯Ú¯ÛŒ Ù‚Ø±Ø§Ø± Ø¯Ù‡ÛŒØ¯.âš ï¸ Ù…Ø«Ø§Ù„: Ø¹Ù„ÛŒ . Ø§Ø­Ù…Ø¯ÛŒ",5e3))}}),n.addEventListener("click",()=>{const R=r.value.trim();if(!R){pt(r,3e3),j("Ú©Ø§Ø¯Ø± Ù…ØªÙ†ÛŒ Ø®Ø§Ù„ÛŒ Ø§Ø³Øª. Ù„Ø·ÙØ§Ù‹ Ø§Ø³Ø§Ù…ÛŒ Ø±Ø§ ÙˆØ§Ø±Ø¯ Ú©Ù†ÛŒØ¯.");return}const Z=R.split(`
`).map(ne=>ne.trim()).filter(ne=>ne.length>0),H=Z.find(ne=>{const ce=ne.indexOf(".");return ce<=0||ce>=ne.length-1});if(H){j(`ÙØ±Ù…Øª Ù†Ø§Ù… Â«${H}Â» ØµØ­ÛŒØ­ Ù†ÛŒØ³Øª. Ù„Ø·ÙØ§ Ù†Ø§Ù… Ùˆ Ù†Ø§Ù… Ø®Ø§Ù†ÙˆØ§Ø¯Ú¯ÛŒ Ø±Ø§ Ø¨Ø§ Ù†Ù‚Ø·Ù‡ Ø¬Ø¯Ø§ Ú©Ù†ÛŒØ¯âš ï¸.`,5e3);return}Z.length>0?(nn(Z),Vs(),Ee("csv-preview-page")):j("Ù‡ÛŒÚ† Ù†Ø§Ù… Ù…Ø¹ØªØ¨Ø±ÛŒ Ø¨Ø±Ø§ÛŒ ÙˆØ±ÙˆØ¯ Ù¾ÛŒØ¯Ø§ Ù†Ø´Ø¯.")}),t.addEventListener("keyup",R=>{R.key==="Enter"&&c.click()}),c.addEventListener("click",()=>{if(!N)return;const R=t.value.trim();if(!R){pt(t,3e3),j("Ù„Ø·ÙØ§Ù‹ Ù†Ø§Ù… Ø¯Ø§Ù†Ø´â€ŒØ¢Ù…ÙˆØ² Ø±Ø§ ÙˆØ§Ø±Ø¯ Ú©Ù†ÛŒØ¯.");return}const Z=R.indexOf(".");if(Z<=0||Z>=R.length-1){j("Ù„Ø·ÙØ§ ÛŒÚ© Ù†Ù‚Ø·Ù‡ Ø¨ÛŒÙ† Ù†Ø§Ù… Ùˆ Ù†Ø§Ù… Ø®Ø§Ù†ÙˆØ§Ø¯Ú¯ÛŒ Ù‚Ø±Ø§Ø± Ø¯Ù‡ÛŒØ¯.âš ï¸ Ù…Ø«Ø§Ù„: Ø¹Ù„ÛŒ . Ø§Ø­Ù…Ø¯ÛŒ",5e3);return}const H=Gt(t.value),ne=Pe(H.name);if(ge(N.students).some(ke=>Pe(ke.identity.name)===ne)){j(`Ø¯Ø§Ù†Ø´â€ŒØ¢Ù…ÙˆØ² Â«${H.name}Â» Ù‚Ø¨Ù„Ø§Ù‹ Ø¯Ø± Ù„ÛŒØ³Øª ÙˆØ¬ÙˆØ¯ Ø¯Ø§Ø±Ø¯.`,4e3);return}const Ce=Gt(R),pe=new qn(Ce);N.addStudent(pe),N.sessions.length>0&&(ge(N.sessions).filter(ke=>ke.isFinished&&!ke.isCancelled).forEach(ke=>{ke.setAttendance(pe.identity.studentId,"absent")}),wt(pe,N),Ke(1)),se(),be(N.info.name,`Ø¯Ø§Ù†Ø´â€ŒØ¢Ù…ÙˆØ² Â«${R}Â» Ø¨Ù‡ Ú©Ù„Ø§Ø³ Ø§Ø¶Ø§ÙÙ‡ Ø´Ø¯.`,{type:"VIEW_STUDENT_PROFILE",studentId:pe.identity.studentId}),Lt(),Re(),t.value="",t.focus()}),document.getElementById("new-session-btn").addEventListener("click",()=>{if(N){const R=N.sessions.find(H=>!H.isFinished&&!H.isCancelled&&!H.isDeleted);if(R){j(`âš ï¸ Ø¬Ù„Ø³Ù‡ ${R.sessionNumber} Ù‡Ù†ÙˆØ² ØªÙ…Ø§Ù… Ù†Ø´Ø¯Ù‡ Ø§Ø³Øª. Ù„Ø·ÙØ§Ù‹ Ø§Ø¨ØªØ¯Ø§ Ø¨Ø§ Ø¯Ú©Ù…Ù‡ Â«Ù¾Ø§ÛŒØ§Ù† Ø¬Ù„Ø³Ù‡Â» Ø¢Ù† Ø±Ø§ Ø®Ø§ØªÙ…Ù‡ Ø¯Ù‡ÛŒØ¯.`,4500);const H=document.querySelector("#session-list > li:nth-child(1) > div.list-item-buttons > button.btn-success");H&&pt(H);return}const Z=()=>{const H=ne=>{const ce=N.startNewSession();gn(ce),rt(ce),N.students.forEach(ke=>{Qs.setAttendance(ke.identity.studentId,"present")}),se();const pe=lt(N).get(ce.sessionNumber);be(N.info.name,`Ø¬Ù„Ø³Ù‡ ${pe} Ø´Ø±ÙˆØ¹ Ø´Ø¯.`,{type:"VIEW_SESSIONS"}),Ln(ne?"attendance":"selector")};me("Ø¢ÛŒØ§ ØªÙ…Ø§ÛŒÙ„ Ø¨Ù‡ Ø§Ù†Ø¬Ø§Ù… ÙØ±Ø¢ÛŒÙ†Ø¯ Ø­Ø¶ÙˆØ± Ùˆ ØºÛŒØ§Ø¨ Ø¯Ø§Ø±ÛŒØ¯ØŸ",()=>H(!0),{confirmText:"Ø¨Ù„Ù‡",cancelText:"Ø®ÛŒØ±",confirmClass:"btn-success",onCancel:()=>H(!1)})};N.hasSessionToday()?me("Ø´Ù…Ø§ Ø§Ù…Ø±ÙˆØ² ÛŒÚ© Ø¬Ù„Ø³Ù‡ Ø¨Ø±Ø§ÛŒ Ø§ÛŒÙ† Ú©Ù„Ø§Ø³ Ø«Ø¨Øª Ú©Ø±Ø¯Ù‡â€ŒØ§ÛŒØ¯. Ø¢ÛŒØ§ Ø§Ø² Ø´Ø±ÙˆØ¹ ÛŒÚ© Ø¬Ù„Ø³Ù‡ Ø¬Ø¯ÛŒØ¯ Ø¯ÛŒÚ¯Ø± Ù…Ø·Ù…Ø¦Ù† Ù‡Ø³ØªÛŒØ¯ØŸ",Z,{confirmText:"Ø¨Ù„Ù‡",confirmClass:"btn-warning"}):Z()}});const J=document.getElementById("open-add-class-modal-btn");J&&J.addEventListener("click",()=>{mr()}),As&&As.addEventListener("click",()=>{Js()}),Ns?Ns.addEventListener("click",()=>{const R=wn;if(!R){console.error("âŒ DEBUG: Name Input element is missing!");return}const Z=R.value.trim();if(!Z){pt(R,3e3),j("Ù„Ø·ÙØ§Ù‹ Ù†Ø§Ù… Ú©Ù„Ø§Ø³ Ø±Ø§ ÙˆØ§Ø±Ø¯ Ú©Ù†ÛŒØ¯.");return}if(ie[Z]){pt(R,3e3),j("Ú©Ù„Ø§Ø³ÛŒ Ø¨Ø§ Ø§ÛŒÙ† Ù†Ø§Ù… Ù‚Ø¨Ù„Ø§Ù‹ Ø§ÛŒØ¬Ø§Ø¯ Ø´Ø¯Ù‡ Ø§Ø³Øª.");return}try{const H=wn.value.trim();if(!H){j("âš ï¸ Ù„Ø·ÙØ§Ù‹ Ù†Ø§Ù… Ú©Ù„Ø§Ø³ Ø±Ø§ ÙˆØ§Ø±Ø¯ Ú©Ù†ÛŒØ¯.");return}if(ie[H]){j("âš ï¸ Ú©Ù„Ø§Ø³ÛŒ Ø¨Ø§ Ø§ÛŒÙ† Ù†Ø§Ù… ÙˆØ¬ÙˆØ¯ Ø¯Ø§Ø±Ø¯.");return}const ne=document.querySelector('input[name="modal-class-type"]:checked');if(!ne){console.error("Class type radio not selected");return}const ce=ne.value,Ce=Di.value,pe=Ni.value||null,ke=Ja.value.trim()||null,ze=Array.from(os.querySelectorAll("input:checked")).map(_s=>parseInt(_s.value,10)),We=Ka.value||null,ht=Ya.value||null,st=new Xs({name:H,type:ce,educationalSystem:Ce,level:pe,scheduleText:ke,scheduleDays:ze,scheduleStartTime:We,scheduleEndTime:ht});ie[H]=st,se(),Fe(),Js(),j(`âœ… Ú©Ù„Ø§Ø³ Â«${H}Â» Ø§ÛŒØ¬Ø§Ø¯ Ø´Ø¯.`)}catch(H){console.error("CRASH ERROR:",H),j("Ø®Ø·Ø§ÛŒÛŒ Ø±Ø® Ø¯Ø§Ø¯: "+H.message)}}):console.error("âŒ DEBUG: Create Button (ui.confirmAddClassBtn) is NOT found!"),e.addEventListener("input",R=>{const Z=R.target.value;if(Z.length<2){jn([]);return}const H=Z.toLowerCase(),ne=zn(H),ce=[];for(const Ce in ie){const pe=ie[Ce];if(pe.isDeleted)continue;const ke=Pe(Ce.toLowerCase()),ze=ke.includes(Pe(H)),We=ke.includes(Pe(ne));(ze||We)&&ce.push({type:"classroom",classroom:pe})}for(const Ce in ie){const pe=ie[Ce];if(pe.isDeleted)continue;ge(pe.students).filter(ze=>{const We=Pe(ze.identity.name.toLowerCase()),ht=We.includes(Pe(H)),st=We.includes(Pe(ne));return ht||st}).forEach(ze=>{ce.push({type:"student",student:ze,classroom:pe})})}jn(ce)}),s.addEventListener("click",tr),p.addEventListener("click",()=>{Yt("selector")}),re.addEventListener("input",R=>{const Z=R.target.value;if(!Z){ln([]);return}const H=Z.toLowerCase(),ne=zn(H),Ce=ge(N.students).filter(pe=>{const ke=Pe(pe.identity.name.toLowerCase()),ze=ke.includes(Pe(H)),We=ke.includes(Pe(ne));return ze||We});ln(Ce)}),re.addEventListener("focus",()=>{re.value&&ln(re.value)}),It.addEventListener("click",()=>{const R=Ye.value,Z=Xe.value.trim();let H;if(Yn)H=Yn.student;else{const ce=K==null?void 0:K.winnerHistory[tt];H=ce==null?void 0:ce.winner}if(!H){j("âŒØ®Ø·Ø§: Ø¯Ø§Ù†Ø´â€ŒØ¢Ù…ÙˆØ² Ù…Ø¹ØªØ¨Ø±ÛŒ Ø¨Ø±Ø§ÛŒ Ø«Ø¨Øª Ù†Ù…Ø±Ù‡ ÛŒØ§ÙØª Ù†Ø´Ø¯.");return}const ne=Le;if(!H||!ne){j("âš ï¸Ù„Ø·ÙØ§Ù‹ Ø§Ø¨ØªØ¯Ø§ ÛŒÚ© Ø¯Ø§Ù†Ø´â€ŒØ¢Ù…ÙˆØ² Ùˆ ÛŒÚ© Ø¯Ø³ØªÙ‡â€ŒØ¨Ù†Ø¯ÛŒ Ø±Ø§ Ø§Ù†ØªØ®Ø§Ø¨ Ú©Ù†ÛŒØ¯.");return}if(!R){j("âš ï¸Ù„Ø·ÙØ§Ù‹ Ù…Ù‚Ø¯Ø§Ø± Ù†Ù…Ø±Ù‡ Ø±Ø§ ÙˆØ§Ø±Ø¯ Ú©Ù†ÛŒØ¯.");return}if(R>100||R<0){j("âŒÙ†Ù…Ø±Ù‡ Ù†Ø¨Ø§ÛŒØ¯ Ø§Ø² Û±Û°Û° Ø¨ÛŒØ´ØªØ± Ùˆ Ø§Ø² ØµÙØ± Ú©Ù…ØªØ± Ø¨Ø§Ø´Ø¯");return}H&&(H.addScore(ne.name,parseFloat(R),Z),be(N.info.name,`Ù†Ù…Ø±Ù‡ ${R} Ø¯Ø± ${ne.name} Ø¨Ø±Ø§ÛŒ Â«${H.identity.name}Â» Ø«Ø¨Øª Ø´Ø¯.`,{type:"VIEW_STUDENT_PROFILE",studentId:H.identity.studentId}),se(),Re(),j(`âœ…Ù†Ù…Ø±Ù‡ Ø¨Ø±Ø§ÛŒ ${H.identity.name} Ø¯Ø± Ù…Ù‡Ø§Ø±Øª ${ne.name} Ø«Ø¨Øª Ø´Ø¯.`),Ei(Le.id,H.identity.studentId),Ye.value="",Xe.value="",Ae())}),ss(Ye,"Enter",()=>{Cn(Ye),It.click()}),Ii(Ye),ss(Xe,"Enter",()=>{Cn(Xe),It.click()}),F.addEventListener("click",()=>{ue()}),g.addEventListener("click",()=>{const R=z.value.trim(),Z=ri;if(typeof Z=="function"){const H=Z(R);if(H===!1)return;ue(()=>{typeof H=="function"&&H()})}else ue()});const te=document.getElementById("move-student-confirm-btn"),Y=document.getElementById("move-student-cancel-btn"),ae=document.getElementById("move-student-class-select");Y.addEventListener("click",()=>{ue()}),te.addEventListener("click",()=>{const R=ae.value,Z=ie[R],{studentToMove:H,sourceClassForMove:ne}=Ca;if(!H||!ne||!Z){j("Ø®Ø·Ø§ÛŒÛŒ Ø±Ø® Ø¯Ø§Ø¯. Ù„Ø·ÙØ§Ù‹ Ø¯ÙˆØ¨Ø§Ø±Ù‡ Ø§Ù…ØªØ­Ø§Ù† Ú©Ù†ÛŒØ¯âš ï¸.","error"),ue();return}const ce=ua(H,ne,Z);ce.success?(be(ne.info.name,`Ø¯Ø§Ù†Ø´â€ŒØ¢Ù…ÙˆØ² Â«${H.identity.name}Â» Ø¨Ù‡ Ú©Ù„Ø§Ø³ Â«${R}Â» Ù…Ù†ØªÙ‚Ù„ Ø´Ø¯.`,{type:"VIEW_SESSIONS"}),be(R,`Ø¯Ø§Ù†Ø´â€ŒØ¢Ù…ÙˆØ² Â«${H.identity.name}Â» Ø§Ø² Ú©Ù„Ø§Ø³ Â«${ne.info.name}Â» Ø¨Ù‡ Ø§ÛŒÙ† Ú©Ù„Ø§Ø³ Ù…Ù†ØªÙ‚Ù„ Ø´Ø¯.`,{type:"VIEW_SESSIONS"}),se(),Lt(),Re(),ot(),j(`Ø¯Ø§Ù†Ø´â€ŒØ¢Ù…ÙˆØ² Â«${H.identity.name}Â» Ø¨Ø§ Ù…ÙˆÙÙ‚ÛŒØª Ø¨Ù‡ Ú©Ù„Ø§Ø³ Â«${R}Â» Ù…Ù†ØªÙ‚Ù„ Ø´Ø¯âœ….`)):j(ce.message,"error"),ue()}),C.addEventListener("click",()=>{S.style.width="300px",k.classList.add("modal-visible")}),C.addEventListener("click",()=>{S.style.width="300px",k.classList.add("modal-visible")});const we=document.getElementById("header-settings-btn");we&&we.addEventListener("click",()=>{N&&xt(N)}),_.addEventListener("click",je),_.addEventListener("click",je),k.addEventListener("click",je),Oe.addEventListener("click",()=>{_n(),Ee("trash-page"),je()});const fe=document.getElementById("restore-points-nav-btn");fe&&fe.addEventListener("click",()=>{fr(),Ee("restore-points-page"),je()}),Dc(),jr(x),qr(L,B),Gr(B),window.addEventListener("popstate",R=>{if(gt||li){ue(null,!0),di(!1);return}Mt(),Ui(!0)}),Yr(y),Ze(".global-search-container .animated-search-container",jn),Ze(".action-column-header .animated-search-container",ln),ka(),[ye,Ua,Xe,Oa].forEach(R=>{R&&Pi(R)});function wt(R,Z){const H=ge(Z.students).filter(_e=>_e.identity.studentId!==R.identity.studentId);if(H.length===0)return;const ne=H.reduce((_e,$e)=>$e.statusCounters.totalSelections>_e.statusCounters.totalSelections?$e:_e,H[0]);if(!ne||ne.statusCounters.totalSelections===0)return;R.categoryCounts=JSON.parse(JSON.stringify(ne.categoryCounts)),R.statusCounters.totalSelections=ne.statusCounters.totalSelections;const ce=H.reduce((_e,$e)=>_e+$e.statusCounters.totalSelections,0),Ce=H.reduce((_e,$e)=>_e+($e.statusCounters.missedChances||0),0),pe=ce>0?Ce/ce:0;R.statusCounters.missedChances=Math.round(R.statusCounters.totalSelections*pe);const ke=ge(Z.categories),ze={};ke.forEach(_e=>{const $e=H.reduce((Is,xs)=>Is+(xs.categoryCounts[_e.name]||0),0),ks=H.reduce((Is,xs)=>Is+(xs.categoryIssues[_e.name]||0),0);ze[_e.name]=$e>0?ks/$e:0}),ke.forEach(_e=>{const $e=R.categoryCounts[_e.name]||0,ks=ze[_e.name]||0;R.categoryIssues[_e.name]=Math.round($e*ks)});const We=Z.liveSession;We?R.onboardingSession=We.sessionNumber:R.onboardingSession=Z.sessions.length+1;const ht=ge(Z.sessions).filter(_e=>_e.isFinished&&!_e.isCancelled),st="ðŸ“ ÛŒØ§Ø¯Ø¯Ø§Ø´Øª Ø®ÙˆØ¯Ú©Ø§Ø± Ø³ÛŒØ³ØªÙ…",Er=`Ø§ÛŒÙ† Ø¯Ø§Ù†Ø´â€ŒØ¢Ù…ÙˆØ²  Ø§Ø² Ø¬Ù„Ø³Ù‡ Ø´Ù…Ø§Ø±Ù‡ ${ht.length} Ø¨Ù‡ Ú©Ù„Ø§Ø³ Ø§Ø¶Ø§ÙÙ‡ Ø´Ø¯. Ø¢Ù…Ø§Ø± Ù…Ø´Ø§Ø±Ú©Øª Ø§Ùˆ Ø¨Ø± Ø§Ø³Ø§Ø³ ÙØ¹Ø§Ù„â€ŒØªØ±ÛŒÙ† Ø¯Ø§Ù†Ø´â€ŒØ¢Ù…ÙˆØ² Ùˆ Ø¢Ù…Ø§Ø± Â«ÙØ±ØµØª Ø§Ø² Ø¯Ø³Øª Ø±ÙØªÙ‡Â» Ø§Ùˆ Ø¨Ø± Ø§Ø³Ø§Ø³ Ù…ÛŒØ§Ù†Ú¯ÛŒÙ† Ú©Ù„Ø§Ø³ Ø«Ø¨Øª Ú¯Ø±Ø¯ÛŒØ¯:`,Ht=[];R.statusCounters.totalSelections>0&&Ht.push(`Ú©Ù„ Ø§Ù†ØªØ®Ø§Ø¨â€ŒÙ‡Ø§: ${R.statusCounters.totalSelections}`),R.statusCounters.missedChances>0&&Ht.push(`ÙØ±ØµØªâ€ŒÙ‡Ø§ÛŒ Ø§Ø² Ø¯Ø³Øª Ø±ÙØªÙ‡: ${R.statusCounters.missedChances}`);for(const _e in R.categoryCounts){const $e=R.categoryCounts[_e];$e>0&&Ht.push(`Ø§Ù†ØªØ®Ø§Ø¨ Ø¯Ø± Â«${_e}Â»: ${$e}`)}for(const _e in R.categoryIssues){const $e=R.categoryIssues[_e];$e>0&&Ht.push(`Ù…Ø´Ú©Ù„ Ø¯Ø± Â«${_e}Â»: ${$e}`)}if(Ht.length>0){const _e=`${st}
${Er}

- ${Ht.join(`
- `)}`;R.addNote(_e)}}function Ke(R,Z=""){const H=R>1?"Ø¯Ø§Ù†Ø´â€ŒØ¢Ù…ÙˆØ²Ø§Ù† Ø¬Ø¯ÛŒØ¯":"Ø¯Ø§Ù†Ø´â€ŒØ¢Ù…ÙˆØ² Ø¬Ø¯ÛŒØ¯";let ne=`âœ… ${R} ${H} Ø¨Ø§ Ù…ÙˆÙÙ‚ÛŒØª Ø§Ø¶Ø§ÙÙ‡ Ø´Ø¯Ù†Ø¯.
`;ne+="ðŸ’¡ Ú†ÙˆÙ† Ø§ÛŒÙ† Ú©Ù„Ø§Ø³ Ø¬Ù„Ø³Ø§Øª Ø¨Ø±Ú¯Ø²Ø§Ø± Ø´Ø¯Ù‡ Ø¯Ø§Ø±Ø¯ØŒ Ø¨Ø±Ø§ÛŒ Ø§ÛŒÙ† Ø§ÙØ±Ø§Ø¯ Ø¢Ù…Ø§Ø± Ù¾Ø§ÛŒÙ‡â€ŒØ§ÛŒ (Ù…ØªÙ†Ø§Ø³Ø¨ Ø¨Ø§ Ú©Ù„Ø§Ø³) Ø«Ø¨Øª Ø´Ø¯ ØªØ§ Ø¯Ø± ÙØ±Ø§ÛŒÙ†Ø¯ Ø§Ù†ØªØ®Ø§Ø¨ Ø§Ø®ØªÙ„Ø§Ù„ÛŒ Ø§ÛŒØ¬Ø§Ø¯ Ù†Ø´ÙˆØ¯.",Z&&(ne+=`
${Z}`),me(ne,()=>{},{confirmText:"Ù…ØªÙˆØ¬Ù‡ Ø´Ø¯Ù…",confirmClass:"btn-success",onCancel:null})}const Tt="23.5.0",Te="1050";{const R=` (Ø³Ø§Ø®Øª ${Te})`;document.getElementById("app-version").textContent=`Ù†Ø³Ø®Ù‡ ${Tt}${R}`}function Pt(R){if(!R||!R.classroomName)return;const Z=ie[R.classroomName];if(!Z){j("âš ï¸ Ú©Ù„Ø§Ø³ Ù…Ø±Ø¨ÙˆØ· Ø¨Ù‡ Ø§ÛŒÙ† Ú¯Ø²Ø§Ø±Ø´ ÛŒØ§ÙØª Ù†Ø´Ø¯.");return}Ge(Z),ue(),setTimeout(()=>{switch(R.type){case"VIEW_STUDENT_PROFILE":{const H=Z.students.find(ne=>ne.identity.studentId===R.studentId);H?Ue(H):j("âš ï¸ Ø¯Ø§Ù†Ø´â€ŒØ¢Ù…ÙˆØ² Ù…ÙˆØ±Ø¯ Ù†Ø¸Ø± ÛŒØ§ÙØª Ù†Ø´Ø¯.");break}case"VIEW_TRASH":_n(),Ee("trash-page");break;case"VIEW_SESSIONS":qe(),Ee("session-page");break;case"VIEW_CLASS_NOTE":ws(Z);break;case"VIEW_CLASS_SETTINGS":xt(Z);break}},300)}le.addEventListener("click",()=>{zi()}),O.addEventListener("click",()=>{ue()}),A.addEventListener("click",()=>{const R=oe.value.trim(),Z=ee.checked;if(!R){Ai.style.display==="flex"?me("Ú©Ø§Ø¯Ø± ÛŒØ§Ø¯Ø¯Ø§Ø´Øª Ø®Ø§Ù„ÛŒ Ø§Ø³Øª. Ø¢ÛŒØ§ Ù…Ø·Ù…Ø¦Ù†ÛŒØ¯ Ú©Ù‡ Ù…ÛŒâ€ŒØ®ÙˆØ§Ù‡ÛŒØ¯ ÛŒØ§Ø¯Ø¯Ø§Ø´Øªâ€ŒÙ‡Ø§ÛŒ Ù‚Ø¨Ù„ÛŒ Ø¯Ø§Ù†Ø´â€ŒØ¢Ù…ÙˆØ²Ø§Ù† Ø§Ù†ØªØ®Ø§Ø¨â€ŒØ´Ø¯Ù‡ Ø±Ø§ Ù¾Ø§Ú© Ú©Ù†ÛŒØ¯ØŸ",()=>{ue(),js("",!1)},{confirmText:"Ù¾Ø§Ú© Ú©Ø±Ø¯Ù†",confirmClass:"btn-warning"}):j("âš ï¸ Ù„Ø·ÙØ§Ù‹ Ù…ØªÙ† ÛŒØ§Ø¯Ø¯Ø§Ø´Øª Ø±Ø§ ÙˆØ§Ø±Ø¯ Ú©Ù†ÛŒØ¯.");return}ue(()=>{js(R,Z)})}),document.getElementById("app-settings-modal");const Ft=document.getElementById("app-settings-nav-btn"),nt=document.getElementById("close-settings-btn"),en=document.getElementById("setting-sound-toggle"),Tn=document.getElementById("setting-vibration-toggle"),Bn=document.getElementById("setting-screensaver-toggle");Be.isScreenSaverEnabled&&Ys(),zc(Bn),Ft&&Ft.addEventListener("click",()=>{je(),en.checked=Be.isSoundEnabled,Tn.checked=Be.isVibrationEnabled,Bn.checked=Be.isScreenSaverEnabled,De("app-settings-modal")}),nt&&nt.addEventListener("click",()=>{ue()}),en.addEventListener("change",R=>{Ct({isSoundEnabled:R.target.checked}),R.target.checked&&$n()}),Tn.addEventListener("change",R=>{Ct({isVibrationEnabled:R.target.checked}),R.target.checked&&navigator.vibrate&&navigator.vibrate(50)}),Be.isScreenSaverEnabled&&Ys(),Nt(Qe,()=>{Bs=!0,Wi()}),ve.addEventListener("click",()=>{vn((R,Z,H)=>{if(R){if(N.categories.some(ne=>ne.name.toLowerCase()===R.toLowerCase())){j("âš ï¸ Ø§ÛŒÙ† Ø¯Ø³ØªÙ‡â€ŒØ¨Ù†Ø¯ÛŒ Ù‚Ø¨Ù„Ø§Ù‹ Ø§Ø¶Ø§ÙÙ‡ Ø´Ø¯Ù‡ Ø§Ø³Øª.");return}N.categories.push(new hn(R,"",Z,H)),se(),Qt()}}),hr()}),Me&&Me.addEventListener("change",kn)});function je(){Ra.style.width="0",za.classList.add("modal-closing"),setTimeout(()=>{overlay.classList.remove("modal-visible","modal-closing")},300)}function Cr(e,s){if(!K||K.isFinished){j("âš ï¸ Ø§Ù…Ú©Ø§Ù† Ù„ØºÙˆ Ø§Ù†ØªØ®Ø§Ø¨ Ø¯Ø± Ø¬Ù„Ø³Ù‡ Ø®Ø§ØªÙ…Ù‡ ÛŒØ§ÙØªÙ‡ ÙˆØ¬ÙˆØ¯ Ù†Ø¯Ø§Ø±Ø¯.");return}if(_t){me(`Ø¢ÛŒØ§ Ø§Ø² Ù„ØºÙˆ ÙˆØ¶Ø¹ÛŒØª Ù†Ù…Ø±Ù‡â€ŒØ¯Ù‡ÛŒ Â«${e.identity.name}Â» Ù…Ø·Ù…Ø¦Ù† Ù‡Ø³ØªÛŒØ¯ØŸ Ø§ÛŒÙ† Ø¯Ø§Ù†Ø´â€ŒØ¢Ù…ÙˆØ² Ø¨Ù‡ Ù„ÛŒØ³Øª Ø§Ù†ØªØ¸Ø§Ø± Ø¨Ø§Ø²Ù…ÛŒâ€ŒÚ¯Ø±Ø¯Ø¯.`,()=>{const r=Le.id,n=at[r];n&&(n.scoredThisSession=n.scoredThisSession.filter(a=>a!==e.identity.studentId)),Jt(null),Re(),Ae(),se(),j(`âœ… Â«${e.identity.name}Â» Ø¨Ù‡ Ù„ÛŒØ³Øª Ø§Ù†ØªØ¸Ø§Ø± Ù†Ù…Ø±Ù‡ Ø¨Ø§Ø²Ú¯Ø´Øª.`)});return}const t=K.winnerHistory;if(!(tt===t.length-1)||t.length===0){j("âš ï¸ ÙÙ‚Ø· Ø¢Ø®Ø±ÛŒÙ† Ø§Ù†ØªØ®Ø§Ø¨ Ù‚Ø§Ø¨Ù„ Ù„ØºÙˆ Ø§Ø³Øª.");return}if(t[t.length-1].winner.identity.studentId!==e.identity.studentId){console.error("Undo mismatch!");return}me(`Ø¢ÛŒØ§ Ø§Ø² Ø­Ø°Ù Ø§Ù†ØªØ®Ø§Ø¨ Â«${e.identity.name}Â» Ø¨Ø±Ø§ÛŒ Â«${s}Â» Ù…Ø·Ù…Ø¦Ù† Ù‡Ø³ØªÛŒØ¯ØŸ Ø¢Ù…Ø§Ø± Ø§ÛŒÙ† Ø§Ù†ØªØ®Ø§Ø¨ Ø¨Ø§Ø²Ú¯Ø±Ø¯Ø§Ù†ÛŒ Ø®ÙˆØ§Ù‡Ø¯ Ø´Ø¯.`,()=>{const r=K.winnerHistory,n=r.pop();if(!n)return;const a=n.winner,i=n.categoryName,o=a.identity.studentId;a.statusCounters.totalSelections=Math.max(0,a.statusCounters.totalSelections-1),a.categoryCounts[i]&&(a.categoryCounts[i]=Math.max(0,a.categoryCounts[i]-1));const l=K.studentRecords[o];if(l&&l.selections[i]&&(l.selections[i]=Math.max(0,l.selections[i]-1)),n.rating){const h=n.rating;a.qualitativeStats&&a.qualitativeStats[i]&&a.qualitativeStats[i][h]>0&&a.qualitativeStats[i][h]--}let f=null;for(let h=r.length-1;h>=0;h--)if(r[h].categoryName===i){f=r[h].winner.identity.studentId;break}f?K.lastWinnerByCategory[i]=f:delete K.lastWinnerByCategory[i],bt(r.length-1),Re(),Ae(),se(),j(`âœ… Ø§Ù†ØªØ®Ø§Ø¨ Â«${a.identity.name}Â» Ù„ØºÙˆ Ø´Ø¯.`)},{confirmText:"Ø¨Ù„Ù‡",confirmClass:"btn-warning"})}function Ki(e,s){const t=s.toLowerCase();return(e.logs.scores[t]||[]).filter(r=>!r.isDeleted).length}function Hc(e,s){const t=s.id;at[t]||(at[t]={toBeScored:[],scoredThisSession:[]});const c=at[t],n=ge(e.students).filter(o=>!c.scoredThisSession.includes(o.identity.studentId));if(n.length===0)return c.toBeScored=[],[];const a=n.map(o=>Ki(o,s.name)),i=Math.min(...a);return c.toBeScored=n.filter(o=>Ki(o,s.name)===i).map(o=>o.identity.studentId),c.toBeScored}function wr(e,s){const t=Hc(e,s);if(t.length===0)return null;const c=Math.floor(Math.random()*t.length),r=t[c];return Ei(s.id,r),e.students.find(n=>n.identity.studentId===r)}function Wi(){if(!Le){j("âš ï¸ Ø§Ø¨ØªØ¯Ø§ ÛŒÚ© Ø¯Ø³ØªÙ‡â€ŒØ¨Ù†Ø¯ÛŒ Ø§Ù†ØªØ®Ø§Ø¨ Ú©Ù†ÛŒØ¯.");return}if(!Le.isGradedCategory){j("âš ï¸ Ø§ÛŒÙ† Ø¯Ø³ØªÙ‡â€ŒØ¨Ù†Ø¯ÛŒ Ù†Ù…Ø±Ù‡â€ŒØ¯Ø§Ø± Ù†ÛŒØ³Øª.");return}oa(!_t),bt(-1),Jt(null),Ae(),Sn(Le),zt.classList.toggle("assessment-mode-active",_t);const e=_t?"Ø­Ø§Ù„Øª Â«Ù†Ù…Ø±Ù‡â€ŒØ¯Ù‡ÛŒÂ» ÙØ¹Ø§Ù„ Ø´Ø¯ âœ…":"Ø­Ø§Ù„Øª Â«Ø§Ù†ØªØ®Ø§Ø¨Â» ÙØ¹Ø§Ù„ Ø´Ø¯ âœ…";Cs?(yt(),j("Ø­Ø§Ù„Øª Ø§Ù†ØªØ®Ø§Ø¨ Ø¨Ø±Ø§ÛŒ Ù†Ù…Ø±Ù‡â€ŒØ¯Ù‡ÛŒ ØºÛŒØ±ÙØ¹Ø§Ù„ Ø´Ø¯. Ø¯Ø³ØªÙ‡â€ŒØ¨Ù†Ø¯ÛŒ Ø§Ù†ØªØ®Ø§Ø¨ Ø´Ø¯Ù‡ Ù‚Ø§Ø¨Ù„ Ù†Ù…Ø±Ù‡ Ø¯Ù‡ÛŒ Ù†ÛŒØ³Øª.âš ï¸",4500),Qa(!1)):(yt(),j(e))}
