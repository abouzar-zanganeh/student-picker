(function(){const o=document.createElement("link").relList;if(o&&o.supports&&o.supports("modulepreload"))return;for(const r of document.querySelectorAll('link[rel="modulepreload"]'))c(r);new MutationObserver(r=>{for(const t of r)if(t.type==="childList")for(const i of t.addedNodes)i.tagName==="LINK"&&i.rel==="modulepreload"&&c(i)}).observe(document,{childList:!0,subtree:!0});function e(r){const t={};return r.integrity&&(t.integrity=r.integrity),r.referrerPolicy&&(t.referrerPolicy=r.referrerPolicy),r.crossOrigin==="use-credentials"?t.credentials="include":r.crossOrigin==="anonymous"?t.credentials="omit":t.credentials="same-origin",t}function c(r){if(r.ep)return;r.ep=!0;const t=e(r);fetch(r.href,t)}})();class pn{constructor(o){this.identity={name:o.name,studentId:o.studentId||`id_${new Date().getTime()}_${Math.random()}`,branchName:o.branchName||null,ageGroup:o.ageGroup||"adult",level:o.level||null,contact:{social:o.socialContact||null,parent:o.parentContact||null}},this.isDeleted=!1,this.statusCounters={totalSelections:0,missedChances:0,earlyLeaves:0,outOfClassCount:0},this.categoryCounts={},this.categoryIssues={},this.logs={parentContacts:[],scores:{},discipline:{},sessionHistory:{}},this.profile={notes:[],tags:[]},this.finalClassActivityScore=null,this.onboardingSession=null}addScore(o,e,c){if(e>100||e<0){console.log("نمره نباید از ۱۰۰ بیشتر و از صفر کمتر باشد");return}const r=o.toLowerCase();this.logs.scores[r]||(this.logs.scores[r]=[]);const t=new Wi(o,e,c);this.logs.scores[r].push(t)}addNote(o,e=null){const c=new Hi(o,e);this.profile.notes.push(c)}getOverallAverageScore(){let o=0,e=0;for(const r in this.logs.scores)this.logs.scores[r].forEach(t=>{t.isDeleted||(o+=t.value,e++)});if(e===0)return null;const c=o/e;return Math.round(c*100)/100}}class Wi{constructor(o,e,c=""){this.id=`score_${new Date().getTime()}`,this.skill=o,this.value=e,this.timestamp=new Date,this.comment=c,this.isDeleted=!1}}class Hi{constructor(o,e=null){this.id=`note_${new Date().getTime()}`,this.timestamp=new Date,this.content=o,this.isDeleted=!1,this.source=e}}class qn{constructor(o="complete",e=""){this.status=o,this.comment=e,this.timestamp=new Date}}class Ps{constructor(o){this.sessionNumber=o,this.startTime=new Date,this.note="",this.isDeleted=!1,this.endTime=null,this.isFinished=!1,this.isMakeup=!1,this.isCancelled=!1,this.studentRecords={},this.lastWinnerByCategory={},this.lastUsedCategoryId=null,this.lastSelectedWinnerId=null,this.winnerHistory=[]}end(){this.isFinished=!0,this.endTime=new Date}markAsMakeup(){this.isMakeup=!this.isMakeup}initializeStudentRecord(o){this.studentRecords[o]||(this.studentRecords[o]={attendance:"present",homework:new qn,selections:{},hadIssue:!1,wasOutOfClass:!1})}setAttendance(o,e){this.initializeStudentRecord(o),this.studentRecords[o].attendance=e}setHomeworkStatus(o,e){this.initializeStudentRecord(o),this.studentRecords[o].homework.status=e}selectNextWinner(o,e,c){if(!e||e.length===0)return console.log("هیچ دانش‌آموزی در کلاس برای انتخاب وجود ندارد."),null;const r=this.lastWinnerByCategory[o];let t=e.filter(m=>m.identity.studentId!==r&&!m.isDeleted);if(t.length===0&&(t=e),t.length===0)return null;const i=(m,u)=>m.categoryCounts[u]||0,a=Math.min(...t.map(m=>i(m,o))),n=t.filter(m=>i(m,o)===a);let d;if(n.length===1)d=n[0];else if(n.length>1){const m=c.filter(v=>!v.isDeleted&&v.name!==o).map(v=>v.name),u=n.map(v=>{const g=m.reduce((C,E)=>C+i(v,E),0);return{student:v,otherCategoriesTotal:g}}),b=Math.min(...u.map(v=>v.otherCategoriesTotal)),h=u.filter(v=>v.otherCategoriesTotal===b).map(v=>v.student);h.length===1?d=h[0]:d=h[Math.floor(Math.random()*h.length)]}else d=t[Math.floor(Math.random()*t.length)];const p=d.identity.studentId;this.initializeStudentRecord(p);const y=(this.studentRecords[p].selections[o]||0)+1;return this.studentRecords[p].selections[o]=y,d.statusCounters.totalSelections++,d.categoryCounts[o]=(d.categoryCounts[o]||0)+1,this.lastWinnerByCategory[o]=p,d}}class Gn{constructor(o){this.info={name:o.name||"NotNamed",teacherName:o.teacherName||null,type:o.type||"in-person",term:o.term||null,scheduleText:o.scheduleText||null,level:o.level||null,creationDate:o.creationDate?new Date(o.creationDate):new Date,scheduleCode:o.scheduleCode||`code_${new Date().getTime()}`,scheduleDays:o.scheduleDays||[],scheduleStartTime:o.scheduleStartTime||null,scheduleEndTime:o.scheduleEndTime||null},this.students=[],this.sessions=[],this.note="",this.isDeleted=!1,this.categories=[new ut("Vocabulary","Questions about words and meanings."),new ut("Grammar","Questions about sentence structure and rules."),new ut("Listening",void 0,!0),new ut("Speaking",void 0,!0),new ut("Reading",void 0,!0),new ut("Writing",void 0,!0)],this.futurePlans={}}addStudent(o){this.students.push(o)}removeStudent(o){this.students=this.students.filter(e=>e.identity.studentId!==o)}startNewSession(){const o=this.sessions.length+1,e=new Ps(o);return this.sessions.push(e),e}endSpecificSession(o){const e=this.getSession(o);return e&&!e.isFinished?(e.end(),!0):!1}getSession(o){return this.sessions.find(e=>e.sessionNumber===o)}markAsMakeup(o){const e=this.getSession(o);e&&e.markAsMakeup()}planForSession(o,e){this.futurePlans[o]=e}hasSessionToday(){const o=new Date().toDateString();return this.sessions.some(e=>!e.isDeleted&&e.startTime.toDateString()===o)}selectNextWinner(o,e){return e?e.selectNextWinner(o,this.students,this.categories):null}get liveSession(){for(let o=this.sessions.length-1;o>=0;o--)if(!this.sessions[o].isFinished)return this.sessions[o];return null}endLiveSession(){const o=this.liveSession;return o?(o.end(),!0):!1}calculateFinalStudentScore(o){const e=o.logs.scores,c=["reading","writing"];for(const m of c)if(!e[m]||e[m].length===0)return null;const r=e.listening&&e.listening.length>0,t=e.speaking&&e.speaking.length>0;if(!r&&!t)return null;const i=m=>e[m].reduce((b,h)=>b+h.value,0)/e[m].length;let a;r&&t?a=(i("listening")+i("speaking"))/2:r?a=i("listening"):a=i("speaking");const n=i("reading"),d=i("writing"),y=(a*3+n*2+d*1)/6;return Math.trunc(y*10)/10}assignAllFinalScores(){let o=0,e=[];console.log("شروع عملیات محاسبه نمره نهایی برای تمام دانش‌آموزان..."),this.students.forEach(r=>{const t=this.calculateFinalStudentScore(r);t!==null?(r.finalClassActivityScore=t,o++):(r.finalClassActivityScore=null,e.push(r.identity.name))});const c=e.length;console.log(`عملیات پایان یافت. تعداد نمرات موفق: ${o} | تعداد ناموفق (نمرات ناقص): ${c}`),c>0&&(console.log("اسامی دانش‌آموزانی که نمراتشان ناقص است:"),e.forEach(r=>console.log(`- ${r}`)))}}class ut{constructor(o,e="",c=!1){this.id=`cat_${new Date().getTime()}_${Math.random()}`,this.name=o,this.description=e,this.isDeleted=!1,this.isGradedCategory=c,this.isDeleted=!1}}var mn=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function Ws(s){return s&&s.__esModule&&Object.prototype.hasOwnProperty.call(s,"default")?s.default:s}function hn(s){throw new Error('Could not dynamically require "'+s+'". Please configure the dynamicRequireTargets or/and ignoreDynamicRequires option of @rollup/plugin-commonjs appropriately for this require call to work.')}var Hs={exports:{}};/*!

JSZip v3.10.1 - A JavaScript class for generating and reading zip files
<http://stuartk.com/jszip>

(c) 2009-2016 Stuart Knightley <stuart [at] stuartk.com>
Dual licenced under the MIT license or GPLv3. See https://raw.github.com/Stuk/jszip/main/LICENSE.markdown.

JSZip uses the library pako released under the MIT license :
https://github.com/nodeca/pako/blob/main/LICENSE
*/(function(s,o){(function(e){s.exports=e()})(function(){return function e(c,r,t){function i(d,p){if(!r[d]){if(!c[d]){var y=typeof hn=="function"&&hn;if(!p&&y)return y(d,!0);if(a)return a(d,!0);var m=new Error("Cannot find module '"+d+"'");throw m.code="MODULE_NOT_FOUND",m}var u=r[d]={exports:{}};c[d][0].call(u.exports,function(b){var h=c[d][1][b];return i(h||b)},u,u.exports,e,c,r,t)}return r[d].exports}for(var a=typeof hn=="function"&&hn,n=0;n<t.length;n++)i(t[n]);return i}({1:[function(e,c,r){var t=e("./utils"),i=e("./support"),a="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";r.encode=function(n){for(var d,p,y,m,u,b,h,v=[],g=0,C=n.length,E=C,S=t.getTypeOf(n)!=="string";g<n.length;)E=C-g,y=S?(d=n[g++],p=g<C?n[g++]:0,g<C?n[g++]:0):(d=n.charCodeAt(g++),p=g<C?n.charCodeAt(g++):0,g<C?n.charCodeAt(g++):0),m=d>>2,u=(3&d)<<4|p>>4,b=1<E?(15&p)<<2|y>>6:64,h=2<E?63&y:64,v.push(a.charAt(m)+a.charAt(u)+a.charAt(b)+a.charAt(h));return v.join("")},r.decode=function(n){var d,p,y,m,u,b,h=0,v=0,g="data:";if(n.substr(0,g.length)===g)throw new Error("Invalid base64 input, it looks like a data url.");var C,E=3*(n=n.replace(/[^A-Za-z0-9+/=]/g,"")).length/4;if(n.charAt(n.length-1)===a.charAt(64)&&E--,n.charAt(n.length-2)===a.charAt(64)&&E--,E%1!=0)throw new Error("Invalid base64 input, bad content length.");for(C=i.uint8array?new Uint8Array(0|E):new Array(0|E);h<n.length;)d=a.indexOf(n.charAt(h++))<<2|(m=a.indexOf(n.charAt(h++)))>>4,p=(15&m)<<4|(u=a.indexOf(n.charAt(h++)))>>2,y=(3&u)<<6|(b=a.indexOf(n.charAt(h++))),C[v++]=d,u!==64&&(C[v++]=p),b!==64&&(C[v++]=y);return C}},{"./support":30,"./utils":32}],2:[function(e,c,r){var t=e("./external"),i=e("./stream/DataWorker"),a=e("./stream/Crc32Probe"),n=e("./stream/DataLengthProbe");function d(p,y,m,u,b){this.compressedSize=p,this.uncompressedSize=y,this.crc32=m,this.compression=u,this.compressedContent=b}d.prototype={getContentWorker:function(){var p=new i(t.Promise.resolve(this.compressedContent)).pipe(this.compression.uncompressWorker()).pipe(new n("data_length")),y=this;return p.on("end",function(){if(this.streamInfo.data_length!==y.uncompressedSize)throw new Error("Bug : uncompressed data size mismatch")}),p},getCompressedWorker:function(){return new i(t.Promise.resolve(this.compressedContent)).withStreamInfo("compressedSize",this.compressedSize).withStreamInfo("uncompressedSize",this.uncompressedSize).withStreamInfo("crc32",this.crc32).withStreamInfo("compression",this.compression)}},d.createWorkerFrom=function(p,y,m){return p.pipe(new a).pipe(new n("uncompressedSize")).pipe(y.compressWorker(m)).pipe(new n("compressedSize")).withStreamInfo("compression",y)},c.exports=d},{"./external":6,"./stream/Crc32Probe":25,"./stream/DataLengthProbe":26,"./stream/DataWorker":27}],3:[function(e,c,r){var t=e("./stream/GenericWorker");r.STORE={magic:"\0\0",compressWorker:function(){return new t("STORE compression")},uncompressWorker:function(){return new t("STORE decompression")}},r.DEFLATE=e("./flate")},{"./flate":7,"./stream/GenericWorker":28}],4:[function(e,c,r){var t=e("./utils"),i=function(){for(var a,n=[],d=0;d<256;d++){a=d;for(var p=0;p<8;p++)a=1&a?3988292384^a>>>1:a>>>1;n[d]=a}return n}();c.exports=function(a,n){return a!==void 0&&a.length?t.getTypeOf(a)!=="string"?function(d,p,y,m){var u=i,b=m+y;d^=-1;for(var h=m;h<b;h++)d=d>>>8^u[255&(d^p[h])];return-1^d}(0|n,a,a.length,0):function(d,p,y,m){var u=i,b=m+y;d^=-1;for(var h=m;h<b;h++)d=d>>>8^u[255&(d^p.charCodeAt(h))];return-1^d}(0|n,a,a.length,0):0}},{"./utils":32}],5:[function(e,c,r){r.base64=!1,r.binary=!1,r.dir=!1,r.createFolders=!0,r.date=null,r.compression=null,r.compressionOptions=null,r.comment=null,r.unixPermissions=null,r.dosPermissions=null},{}],6:[function(e,c,r){var t=null;t=typeof Promise<"u"?Promise:e("lie"),c.exports={Promise:t}},{lie:37}],7:[function(e,c,r){var t=typeof Uint8Array<"u"&&typeof Uint16Array<"u"&&typeof Uint32Array<"u",i=e("pako"),a=e("./utils"),n=e("./stream/GenericWorker"),d=t?"uint8array":"array";function p(y,m){n.call(this,"FlateWorker/"+y),this._pako=null,this._pakoAction=y,this._pakoOptions=m,this.meta={}}r.magic="\b\0",a.inherits(p,n),p.prototype.processChunk=function(y){this.meta=y.meta,this._pako===null&&this._createPako(),this._pako.push(a.transformTo(d,y.data),!1)},p.prototype.flush=function(){n.prototype.flush.call(this),this._pako===null&&this._createPako(),this._pako.push([],!0)},p.prototype.cleanUp=function(){n.prototype.cleanUp.call(this),this._pako=null},p.prototype._createPako=function(){this._pako=new i[this._pakoAction]({raw:!0,level:this._pakoOptions.level||-1});var y=this;this._pako.onData=function(m){y.push({data:m,meta:y.meta})}},r.compressWorker=function(y){return new p("Deflate",y)},r.uncompressWorker=function(){return new p("Inflate",{})}},{"./stream/GenericWorker":28,"./utils":32,pako:38}],8:[function(e,c,r){function t(u,b){var h,v="";for(h=0;h<b;h++)v+=String.fromCharCode(255&u),u>>>=8;return v}function i(u,b,h,v,g,C){var E,S,I=u.file,x=u.compression,L=C!==d.utf8encode,D=a.transformTo("string",C(I.name)),R=a.transformTo("string",d.utf8encode(I.name)),P=I.comment,Q=a.transformTo("string",C(P)),k=a.transformTo("string",d.utf8encode(P)),z=R.length!==I.name.length,f=k.length!==P.length,W="",ue="",Z="",fe=I.dir,F=I.date,ne={crc32:0,compressedSize:0,uncompressedSize:0};b&&!h||(ne.crc32=u.crc32,ne.compressedSize=u.compressedSize,ne.uncompressedSize=u.uncompressedSize);var A=0;b&&(A|=8),L||!z&&!f||(A|=2048);var M=0,re=0;fe&&(M|=16),g==="UNIX"?(re=798,M|=function(Y,Te){var Ne=Y;return Y||(Ne=Te?16893:33204),(65535&Ne)<<16}(I.unixPermissions,fe)):(re=20,M|=function(Y){return 63&(Y||0)}(I.dosPermissions)),E=F.getUTCHours(),E<<=6,E|=F.getUTCMinutes(),E<<=5,E|=F.getUTCSeconds()/2,S=F.getUTCFullYear()-1980,S<<=4,S|=F.getUTCMonth()+1,S<<=5,S|=F.getUTCDate(),z&&(ue=t(1,1)+t(p(D),4)+R,W+="up"+t(ue.length,2)+ue),f&&(Z=t(1,1)+t(p(Q),4)+k,W+="uc"+t(Z.length,2)+Z);var te="";return te+=`
\0`,te+=t(A,2),te+=x.magic,te+=t(E,2),te+=t(S,2),te+=t(ne.crc32,4),te+=t(ne.compressedSize,4),te+=t(ne.uncompressedSize,4),te+=t(D.length,2),te+=t(W.length,2),{fileRecord:y.LOCAL_FILE_HEADER+te+D+W,dirRecord:y.CENTRAL_FILE_HEADER+t(re,2)+te+t(Q.length,2)+"\0\0\0\0"+t(M,4)+t(v,4)+D+W+Q}}var a=e("../utils"),n=e("../stream/GenericWorker"),d=e("../utf8"),p=e("../crc32"),y=e("../signature");function m(u,b,h,v){n.call(this,"ZipFileWorker"),this.bytesWritten=0,this.zipComment=b,this.zipPlatform=h,this.encodeFileName=v,this.streamFiles=u,this.accumulate=!1,this.contentBuffer=[],this.dirRecords=[],this.currentSourceOffset=0,this.entriesCount=0,this.currentFile=null,this._sources=[]}a.inherits(m,n),m.prototype.push=function(u){var b=u.meta.percent||0,h=this.entriesCount,v=this._sources.length;this.accumulate?this.contentBuffer.push(u):(this.bytesWritten+=u.data.length,n.prototype.push.call(this,{data:u.data,meta:{currentFile:this.currentFile,percent:h?(b+100*(h-v-1))/h:100}}))},m.prototype.openedSource=function(u){this.currentSourceOffset=this.bytesWritten,this.currentFile=u.file.name;var b=this.streamFiles&&!u.file.dir;if(b){var h=i(u,b,!1,this.currentSourceOffset,this.zipPlatform,this.encodeFileName);this.push({data:h.fileRecord,meta:{percent:0}})}else this.accumulate=!0},m.prototype.closedSource=function(u){this.accumulate=!1;var b=this.streamFiles&&!u.file.dir,h=i(u,b,!0,this.currentSourceOffset,this.zipPlatform,this.encodeFileName);if(this.dirRecords.push(h.dirRecord),b)this.push({data:function(v){return y.DATA_DESCRIPTOR+t(v.crc32,4)+t(v.compressedSize,4)+t(v.uncompressedSize,4)}(u),meta:{percent:100}});else for(this.push({data:h.fileRecord,meta:{percent:0}});this.contentBuffer.length;)this.push(this.contentBuffer.shift());this.currentFile=null},m.prototype.flush=function(){for(var u=this.bytesWritten,b=0;b<this.dirRecords.length;b++)this.push({data:this.dirRecords[b],meta:{percent:100}});var h=this.bytesWritten-u,v=function(g,C,E,S,I){var x=a.transformTo("string",I(S));return y.CENTRAL_DIRECTORY_END+"\0\0\0\0"+t(g,2)+t(g,2)+t(C,4)+t(E,4)+t(x.length,2)+x}(this.dirRecords.length,h,u,this.zipComment,this.encodeFileName);this.push({data:v,meta:{percent:100}})},m.prototype.prepareNextSource=function(){this.previous=this._sources.shift(),this.openedSource(this.previous.streamInfo),this.isPaused?this.previous.pause():this.previous.resume()},m.prototype.registerPrevious=function(u){this._sources.push(u);var b=this;return u.on("data",function(h){b.processChunk(h)}),u.on("end",function(){b.closedSource(b.previous.streamInfo),b._sources.length?b.prepareNextSource():b.end()}),u.on("error",function(h){b.error(h)}),this},m.prototype.resume=function(){return!!n.prototype.resume.call(this)&&(!this.previous&&this._sources.length?(this.prepareNextSource(),!0):this.previous||this._sources.length||this.generatedError?void 0:(this.end(),!0))},m.prototype.error=function(u){var b=this._sources;if(!n.prototype.error.call(this,u))return!1;for(var h=0;h<b.length;h++)try{b[h].error(u)}catch{}return!0},m.prototype.lock=function(){n.prototype.lock.call(this);for(var u=this._sources,b=0;b<u.length;b++)u[b].lock()},c.exports=m},{"../crc32":4,"../signature":23,"../stream/GenericWorker":28,"../utf8":31,"../utils":32}],9:[function(e,c,r){var t=e("../compressions"),i=e("./ZipFileWorker");r.generateWorker=function(a,n,d){var p=new i(n.streamFiles,d,n.platform,n.encodeFileName),y=0;try{a.forEach(function(m,u){y++;var b=function(C,E){var S=C||E,I=t[S];if(!I)throw new Error(S+" is not a valid compression method !");return I}(u.options.compression,n.compression),h=u.options.compressionOptions||n.compressionOptions||{},v=u.dir,g=u.date;u._compressWorker(b,h).withStreamInfo("file",{name:m,dir:v,date:g,comment:u.comment||"",unixPermissions:u.unixPermissions,dosPermissions:u.dosPermissions}).pipe(p)}),p.entriesCount=y}catch(m){p.error(m)}return p}},{"../compressions":3,"./ZipFileWorker":8}],10:[function(e,c,r){function t(){if(!(this instanceof t))return new t;if(arguments.length)throw new Error("The constructor with parameters has been removed in JSZip 3.0, please check the upgrade guide.");this.files=Object.create(null),this.comment=null,this.root="",this.clone=function(){var i=new t;for(var a in this)typeof this[a]!="function"&&(i[a]=this[a]);return i}}(t.prototype=e("./object")).loadAsync=e("./load"),t.support=e("./support"),t.defaults=e("./defaults"),t.version="3.10.1",t.loadAsync=function(i,a){return new t().loadAsync(i,a)},t.external=e("./external"),c.exports=t},{"./defaults":5,"./external":6,"./load":11,"./object":15,"./support":30}],11:[function(e,c,r){var t=e("./utils"),i=e("./external"),a=e("./utf8"),n=e("./zipEntries"),d=e("./stream/Crc32Probe"),p=e("./nodejsUtils");function y(m){return new i.Promise(function(u,b){var h=m.decompressed.getContentWorker().pipe(new d);h.on("error",function(v){b(v)}).on("end",function(){h.streamInfo.crc32!==m.decompressed.crc32?b(new Error("Corrupted zip : CRC32 mismatch")):u()}).resume()})}c.exports=function(m,u){var b=this;return u=t.extend(u||{},{base64:!1,checkCRC32:!1,optimizedBinaryString:!1,createFolders:!1,decodeFileName:a.utf8decode}),p.isNode&&p.isStream(m)?i.Promise.reject(new Error("JSZip can't accept a stream when loading a zip file.")):t.prepareContent("the loaded zip file",m,!0,u.optimizedBinaryString,u.base64).then(function(h){var v=new n(u);return v.load(h),v}).then(function(h){var v=[i.Promise.resolve(h)],g=h.files;if(u.checkCRC32)for(var C=0;C<g.length;C++)v.push(y(g[C]));return i.Promise.all(v)}).then(function(h){for(var v=h.shift(),g=v.files,C=0;C<g.length;C++){var E=g[C],S=E.fileNameStr,I=t.resolve(E.fileNameStr);b.file(I,E.decompressed,{binary:!0,optimizedBinaryString:!0,date:E.date,dir:E.dir,comment:E.fileCommentStr.length?E.fileCommentStr:null,unixPermissions:E.unixPermissions,dosPermissions:E.dosPermissions,createFolders:u.createFolders}),E.dir||(b.file(I).unsafeOriginalName=S)}return v.zipComment.length&&(b.comment=v.zipComment),b})}},{"./external":6,"./nodejsUtils":14,"./stream/Crc32Probe":25,"./utf8":31,"./utils":32,"./zipEntries":33}],12:[function(e,c,r){var t=e("../utils"),i=e("../stream/GenericWorker");function a(n,d){i.call(this,"Nodejs stream input adapter for "+n),this._upstreamEnded=!1,this._bindStream(d)}t.inherits(a,i),a.prototype._bindStream=function(n){var d=this;(this._stream=n).pause(),n.on("data",function(p){d.push({data:p,meta:{percent:0}})}).on("error",function(p){d.isPaused?this.generatedError=p:d.error(p)}).on("end",function(){d.isPaused?d._upstreamEnded=!0:d.end()})},a.prototype.pause=function(){return!!i.prototype.pause.call(this)&&(this._stream.pause(),!0)},a.prototype.resume=function(){return!!i.prototype.resume.call(this)&&(this._upstreamEnded?this.end():this._stream.resume(),!0)},c.exports=a},{"../stream/GenericWorker":28,"../utils":32}],13:[function(e,c,r){var t=e("readable-stream").Readable;function i(a,n,d){t.call(this,n),this._helper=a;var p=this;a.on("data",function(y,m){p.push(y)||p._helper.pause(),d&&d(m)}).on("error",function(y){p.emit("error",y)}).on("end",function(){p.push(null)})}e("../utils").inherits(i,t),i.prototype._read=function(){this._helper.resume()},c.exports=i},{"../utils":32,"readable-stream":16}],14:[function(e,c,r){c.exports={isNode:typeof Buffer<"u",newBufferFrom:function(t,i){if(Buffer.from&&Buffer.from!==Uint8Array.from)return Buffer.from(t,i);if(typeof t=="number")throw new Error('The "data" argument must not be a number');return new Buffer(t,i)},allocBuffer:function(t){if(Buffer.alloc)return Buffer.alloc(t);var i=new Buffer(t);return i.fill(0),i},isBuffer:function(t){return Buffer.isBuffer(t)},isStream:function(t){return t&&typeof t.on=="function"&&typeof t.pause=="function"&&typeof t.resume=="function"}}},{}],15:[function(e,c,r){function t(I,x,L){var D,R=a.getTypeOf(x),P=a.extend(L||{},p);P.date=P.date||new Date,P.compression!==null&&(P.compression=P.compression.toUpperCase()),typeof P.unixPermissions=="string"&&(P.unixPermissions=parseInt(P.unixPermissions,8)),P.unixPermissions&&16384&P.unixPermissions&&(P.dir=!0),P.dosPermissions&&16&P.dosPermissions&&(P.dir=!0),P.dir&&(I=g(I)),P.createFolders&&(D=v(I))&&C.call(this,D,!0);var Q=R==="string"&&P.binary===!1&&P.base64===!1;L&&L.binary!==void 0||(P.binary=!Q),(x instanceof y&&x.uncompressedSize===0||P.dir||!x||x.length===0)&&(P.base64=!1,P.binary=!0,x="",P.compression="STORE",R="string");var k=null;k=x instanceof y||x instanceof n?x:b.isNode&&b.isStream(x)?new h(I,x):a.prepareContent(I,x,P.binary,P.optimizedBinaryString,P.base64);var z=new m(I,k,P);this.files[I]=z}var i=e("./utf8"),a=e("./utils"),n=e("./stream/GenericWorker"),d=e("./stream/StreamHelper"),p=e("./defaults"),y=e("./compressedObject"),m=e("./zipObject"),u=e("./generate"),b=e("./nodejsUtils"),h=e("./nodejs/NodejsStreamInputAdapter"),v=function(I){I.slice(-1)==="/"&&(I=I.substring(0,I.length-1));var x=I.lastIndexOf("/");return 0<x?I.substring(0,x):""},g=function(I){return I.slice(-1)!=="/"&&(I+="/"),I},C=function(I,x){return x=x!==void 0?x:p.createFolders,I=g(I),this.files[I]||t.call(this,I,null,{dir:!0,createFolders:x}),this.files[I]};function E(I){return Object.prototype.toString.call(I)==="[object RegExp]"}var S={load:function(){throw new Error("This method has been removed in JSZip 3.0, please check the upgrade guide.")},forEach:function(I){var x,L,D;for(x in this.files)D=this.files[x],(L=x.slice(this.root.length,x.length))&&x.slice(0,this.root.length)===this.root&&I(L,D)},filter:function(I){var x=[];return this.forEach(function(L,D){I(L,D)&&x.push(D)}),x},file:function(I,x,L){if(arguments.length!==1)return I=this.root+I,t.call(this,I,x,L),this;if(E(I)){var D=I;return this.filter(function(P,Q){return!Q.dir&&D.test(P)})}var R=this.files[this.root+I];return R&&!R.dir?R:null},folder:function(I){if(!I)return this;if(E(I))return this.filter(function(R,P){return P.dir&&I.test(R)});var x=this.root+I,L=C.call(this,x),D=this.clone();return D.root=L.name,D},remove:function(I){I=this.root+I;var x=this.files[I];if(x||(I.slice(-1)!=="/"&&(I+="/"),x=this.files[I]),x&&!x.dir)delete this.files[I];else for(var L=this.filter(function(R,P){return P.name.slice(0,I.length)===I}),D=0;D<L.length;D++)delete this.files[L[D].name];return this},generate:function(){throw new Error("This method has been removed in JSZip 3.0, please check the upgrade guide.")},generateInternalStream:function(I){var x,L={};try{if((L=a.extend(I||{},{streamFiles:!1,compression:"STORE",compressionOptions:null,type:"",platform:"DOS",comment:null,mimeType:"application/zip",encodeFileName:i.utf8encode})).type=L.type.toLowerCase(),L.compression=L.compression.toUpperCase(),L.type==="binarystring"&&(L.type="string"),!L.type)throw new Error("No output type specified.");a.checkSupport(L.type),L.platform!=="darwin"&&L.platform!=="freebsd"&&L.platform!=="linux"&&L.platform!=="sunos"||(L.platform="UNIX"),L.platform==="win32"&&(L.platform="DOS");var D=L.comment||this.comment||"";x=u.generateWorker(this,L,D)}catch(R){(x=new n("error")).error(R)}return new d(x,L.type||"string",L.mimeType)},generateAsync:function(I,x){return this.generateInternalStream(I).accumulate(x)},generateNodeStream:function(I,x){return(I=I||{}).type||(I.type="nodebuffer"),this.generateInternalStream(I).toNodejsStream(x)}};c.exports=S},{"./compressedObject":2,"./defaults":5,"./generate":9,"./nodejs/NodejsStreamInputAdapter":12,"./nodejsUtils":14,"./stream/GenericWorker":28,"./stream/StreamHelper":29,"./utf8":31,"./utils":32,"./zipObject":35}],16:[function(e,c,r){c.exports=e("stream")},{stream:void 0}],17:[function(e,c,r){var t=e("./DataReader");function i(a){t.call(this,a);for(var n=0;n<this.data.length;n++)a[n]=255&a[n]}e("../utils").inherits(i,t),i.prototype.byteAt=function(a){return this.data[this.zero+a]},i.prototype.lastIndexOfSignature=function(a){for(var n=a.charCodeAt(0),d=a.charCodeAt(1),p=a.charCodeAt(2),y=a.charCodeAt(3),m=this.length-4;0<=m;--m)if(this.data[m]===n&&this.data[m+1]===d&&this.data[m+2]===p&&this.data[m+3]===y)return m-this.zero;return-1},i.prototype.readAndCheckSignature=function(a){var n=a.charCodeAt(0),d=a.charCodeAt(1),p=a.charCodeAt(2),y=a.charCodeAt(3),m=this.readData(4);return n===m[0]&&d===m[1]&&p===m[2]&&y===m[3]},i.prototype.readData=function(a){if(this.checkOffset(a),a===0)return[];var n=this.data.slice(this.zero+this.index,this.zero+this.index+a);return this.index+=a,n},c.exports=i},{"../utils":32,"./DataReader":18}],18:[function(e,c,r){var t=e("../utils");function i(a){this.data=a,this.length=a.length,this.index=0,this.zero=0}i.prototype={checkOffset:function(a){this.checkIndex(this.index+a)},checkIndex:function(a){if(this.length<this.zero+a||a<0)throw new Error("End of data reached (data length = "+this.length+", asked index = "+a+"). Corrupted zip ?")},setIndex:function(a){this.checkIndex(a),this.index=a},skip:function(a){this.setIndex(this.index+a)},byteAt:function(){},readInt:function(a){var n,d=0;for(this.checkOffset(a),n=this.index+a-1;n>=this.index;n--)d=(d<<8)+this.byteAt(n);return this.index+=a,d},readString:function(a){return t.transformTo("string",this.readData(a))},readData:function(){},lastIndexOfSignature:function(){},readAndCheckSignature:function(){},readDate:function(){var a=this.readInt(4);return new Date(Date.UTC(1980+(a>>25&127),(a>>21&15)-1,a>>16&31,a>>11&31,a>>5&63,(31&a)<<1))}},c.exports=i},{"../utils":32}],19:[function(e,c,r){var t=e("./Uint8ArrayReader");function i(a){t.call(this,a)}e("../utils").inherits(i,t),i.prototype.readData=function(a){this.checkOffset(a);var n=this.data.slice(this.zero+this.index,this.zero+this.index+a);return this.index+=a,n},c.exports=i},{"../utils":32,"./Uint8ArrayReader":21}],20:[function(e,c,r){var t=e("./DataReader");function i(a){t.call(this,a)}e("../utils").inherits(i,t),i.prototype.byteAt=function(a){return this.data.charCodeAt(this.zero+a)},i.prototype.lastIndexOfSignature=function(a){return this.data.lastIndexOf(a)-this.zero},i.prototype.readAndCheckSignature=function(a){return a===this.readData(4)},i.prototype.readData=function(a){this.checkOffset(a);var n=this.data.slice(this.zero+this.index,this.zero+this.index+a);return this.index+=a,n},c.exports=i},{"../utils":32,"./DataReader":18}],21:[function(e,c,r){var t=e("./ArrayReader");function i(a){t.call(this,a)}e("../utils").inherits(i,t),i.prototype.readData=function(a){if(this.checkOffset(a),a===0)return new Uint8Array(0);var n=this.data.subarray(this.zero+this.index,this.zero+this.index+a);return this.index+=a,n},c.exports=i},{"../utils":32,"./ArrayReader":17}],22:[function(e,c,r){var t=e("../utils"),i=e("../support"),a=e("./ArrayReader"),n=e("./StringReader"),d=e("./NodeBufferReader"),p=e("./Uint8ArrayReader");c.exports=function(y){var m=t.getTypeOf(y);return t.checkSupport(m),m!=="string"||i.uint8array?m==="nodebuffer"?new d(y):i.uint8array?new p(t.transformTo("uint8array",y)):new a(t.transformTo("array",y)):new n(y)}},{"../support":30,"../utils":32,"./ArrayReader":17,"./NodeBufferReader":19,"./StringReader":20,"./Uint8ArrayReader":21}],23:[function(e,c,r){r.LOCAL_FILE_HEADER="PK",r.CENTRAL_FILE_HEADER="PK",r.CENTRAL_DIRECTORY_END="PK",r.ZIP64_CENTRAL_DIRECTORY_LOCATOR="PK\x07",r.ZIP64_CENTRAL_DIRECTORY_END="PK",r.DATA_DESCRIPTOR="PK\x07\b"},{}],24:[function(e,c,r){var t=e("./GenericWorker"),i=e("../utils");function a(n){t.call(this,"ConvertWorker to "+n),this.destType=n}i.inherits(a,t),a.prototype.processChunk=function(n){this.push({data:i.transformTo(this.destType,n.data),meta:n.meta})},c.exports=a},{"../utils":32,"./GenericWorker":28}],25:[function(e,c,r){var t=e("./GenericWorker"),i=e("../crc32");function a(){t.call(this,"Crc32Probe"),this.withStreamInfo("crc32",0)}e("../utils").inherits(a,t),a.prototype.processChunk=function(n){this.streamInfo.crc32=i(n.data,this.streamInfo.crc32||0),this.push(n)},c.exports=a},{"../crc32":4,"../utils":32,"./GenericWorker":28}],26:[function(e,c,r){var t=e("../utils"),i=e("./GenericWorker");function a(n){i.call(this,"DataLengthProbe for "+n),this.propName=n,this.withStreamInfo(n,0)}t.inherits(a,i),a.prototype.processChunk=function(n){if(n){var d=this.streamInfo[this.propName]||0;this.streamInfo[this.propName]=d+n.data.length}i.prototype.processChunk.call(this,n)},c.exports=a},{"../utils":32,"./GenericWorker":28}],27:[function(e,c,r){var t=e("../utils"),i=e("./GenericWorker");function a(n){i.call(this,"DataWorker");var d=this;this.dataIsReady=!1,this.index=0,this.max=0,this.data=null,this.type="",this._tickScheduled=!1,n.then(function(p){d.dataIsReady=!0,d.data=p,d.max=p&&p.length||0,d.type=t.getTypeOf(p),d.isPaused||d._tickAndRepeat()},function(p){d.error(p)})}t.inherits(a,i),a.prototype.cleanUp=function(){i.prototype.cleanUp.call(this),this.data=null},a.prototype.resume=function(){return!!i.prototype.resume.call(this)&&(!this._tickScheduled&&this.dataIsReady&&(this._tickScheduled=!0,t.delay(this._tickAndRepeat,[],this)),!0)},a.prototype._tickAndRepeat=function(){this._tickScheduled=!1,this.isPaused||this.isFinished||(this._tick(),this.isFinished||(t.delay(this._tickAndRepeat,[],this),this._tickScheduled=!0))},a.prototype._tick=function(){if(this.isPaused||this.isFinished)return!1;var n=null,d=Math.min(this.max,this.index+16384);if(this.index>=this.max)return this.end();switch(this.type){case"string":n=this.data.substring(this.index,d);break;case"uint8array":n=this.data.subarray(this.index,d);break;case"array":case"nodebuffer":n=this.data.slice(this.index,d)}return this.index=d,this.push({data:n,meta:{percent:this.max?this.index/this.max*100:0}})},c.exports=a},{"../utils":32,"./GenericWorker":28}],28:[function(e,c,r){function t(i){this.name=i||"default",this.streamInfo={},this.generatedError=null,this.extraStreamInfo={},this.isPaused=!0,this.isFinished=!1,this.isLocked=!1,this._listeners={data:[],end:[],error:[]},this.previous=null}t.prototype={push:function(i){this.emit("data",i)},end:function(){if(this.isFinished)return!1;this.flush();try{this.emit("end"),this.cleanUp(),this.isFinished=!0}catch(i){this.emit("error",i)}return!0},error:function(i){return!this.isFinished&&(this.isPaused?this.generatedError=i:(this.isFinished=!0,this.emit("error",i),this.previous&&this.previous.error(i),this.cleanUp()),!0)},on:function(i,a){return this._listeners[i].push(a),this},cleanUp:function(){this.streamInfo=this.generatedError=this.extraStreamInfo=null,this._listeners=[]},emit:function(i,a){if(this._listeners[i])for(var n=0;n<this._listeners[i].length;n++)this._listeners[i][n].call(this,a)},pipe:function(i){return i.registerPrevious(this)},registerPrevious:function(i){if(this.isLocked)throw new Error("The stream '"+this+"' has already been used.");this.streamInfo=i.streamInfo,this.mergeStreamInfo(),this.previous=i;var a=this;return i.on("data",function(n){a.processChunk(n)}),i.on("end",function(){a.end()}),i.on("error",function(n){a.error(n)}),this},pause:function(){return!this.isPaused&&!this.isFinished&&(this.isPaused=!0,this.previous&&this.previous.pause(),!0)},resume:function(){if(!this.isPaused||this.isFinished)return!1;var i=this.isPaused=!1;return this.generatedError&&(this.error(this.generatedError),i=!0),this.previous&&this.previous.resume(),!i},flush:function(){},processChunk:function(i){this.push(i)},withStreamInfo:function(i,a){return this.extraStreamInfo[i]=a,this.mergeStreamInfo(),this},mergeStreamInfo:function(){for(var i in this.extraStreamInfo)Object.prototype.hasOwnProperty.call(this.extraStreamInfo,i)&&(this.streamInfo[i]=this.extraStreamInfo[i])},lock:function(){if(this.isLocked)throw new Error("The stream '"+this+"' has already been used.");this.isLocked=!0,this.previous&&this.previous.lock()},toString:function(){var i="Worker "+this.name;return this.previous?this.previous+" -> "+i:i}},c.exports=t},{}],29:[function(e,c,r){var t=e("../utils"),i=e("./ConvertWorker"),a=e("./GenericWorker"),n=e("../base64"),d=e("../support"),p=e("../external"),y=null;if(d.nodestream)try{y=e("../nodejs/NodejsStreamOutputAdapter")}catch{}function m(b,h){return new p.Promise(function(v,g){var C=[],E=b._internalType,S=b._outputType,I=b._mimeType;b.on("data",function(x,L){C.push(x),h&&h(L)}).on("error",function(x){C=[],g(x)}).on("end",function(){try{var x=function(L,D,R){switch(L){case"blob":return t.newBlob(t.transformTo("arraybuffer",D),R);case"base64":return n.encode(D);default:return t.transformTo(L,D)}}(S,function(L,D){var R,P=0,Q=null,k=0;for(R=0;R<D.length;R++)k+=D[R].length;switch(L){case"string":return D.join("");case"array":return Array.prototype.concat.apply([],D);case"uint8array":for(Q=new Uint8Array(k),R=0;R<D.length;R++)Q.set(D[R],P),P+=D[R].length;return Q;case"nodebuffer":return Buffer.concat(D);default:throw new Error("concat : unsupported type '"+L+"'")}}(E,C),I);v(x)}catch(L){g(L)}C=[]}).resume()})}function u(b,h,v){var g=h;switch(h){case"blob":case"arraybuffer":g="uint8array";break;case"base64":g="string"}try{this._internalType=g,this._outputType=h,this._mimeType=v,t.checkSupport(g),this._worker=b.pipe(new i(g)),b.lock()}catch(C){this._worker=new a("error"),this._worker.error(C)}}u.prototype={accumulate:function(b){return m(this,b)},on:function(b,h){var v=this;return b==="data"?this._worker.on(b,function(g){h.call(v,g.data,g.meta)}):this._worker.on(b,function(){t.delay(h,arguments,v)}),this},resume:function(){return t.delay(this._worker.resume,[],this._worker),this},pause:function(){return this._worker.pause(),this},toNodejsStream:function(b){if(t.checkSupport("nodestream"),this._outputType!=="nodebuffer")throw new Error(this._outputType+" is not supported by this method");return new y(this,{objectMode:this._outputType!=="nodebuffer"},b)}},c.exports=u},{"../base64":1,"../external":6,"../nodejs/NodejsStreamOutputAdapter":13,"../support":30,"../utils":32,"./ConvertWorker":24,"./GenericWorker":28}],30:[function(e,c,r){if(r.base64=!0,r.array=!0,r.string=!0,r.arraybuffer=typeof ArrayBuffer<"u"&&typeof Uint8Array<"u",r.nodebuffer=typeof Buffer<"u",r.uint8array=typeof Uint8Array<"u",typeof ArrayBuffer>"u")r.blob=!1;else{var t=new ArrayBuffer(0);try{r.blob=new Blob([t],{type:"application/zip"}).size===0}catch{try{var i=new(self.BlobBuilder||self.WebKitBlobBuilder||self.MozBlobBuilder||self.MSBlobBuilder);i.append(t),r.blob=i.getBlob("application/zip").size===0}catch{r.blob=!1}}}try{r.nodestream=!!e("readable-stream").Readable}catch{r.nodestream=!1}},{"readable-stream":16}],31:[function(e,c,r){for(var t=e("./utils"),i=e("./support"),a=e("./nodejsUtils"),n=e("./stream/GenericWorker"),d=new Array(256),p=0;p<256;p++)d[p]=252<=p?6:248<=p?5:240<=p?4:224<=p?3:192<=p?2:1;d[254]=d[254]=1;function y(){n.call(this,"utf-8 decode"),this.leftOver=null}function m(){n.call(this,"utf-8 encode")}r.utf8encode=function(u){return i.nodebuffer?a.newBufferFrom(u,"utf-8"):function(b){var h,v,g,C,E,S=b.length,I=0;for(C=0;C<S;C++)(64512&(v=b.charCodeAt(C)))==55296&&C+1<S&&(64512&(g=b.charCodeAt(C+1)))==56320&&(v=65536+(v-55296<<10)+(g-56320),C++),I+=v<128?1:v<2048?2:v<65536?3:4;for(h=i.uint8array?new Uint8Array(I):new Array(I),C=E=0;E<I;C++)(64512&(v=b.charCodeAt(C)))==55296&&C+1<S&&(64512&(g=b.charCodeAt(C+1)))==56320&&(v=65536+(v-55296<<10)+(g-56320),C++),v<128?h[E++]=v:(v<2048?h[E++]=192|v>>>6:(v<65536?h[E++]=224|v>>>12:(h[E++]=240|v>>>18,h[E++]=128|v>>>12&63),h[E++]=128|v>>>6&63),h[E++]=128|63&v);return h}(u)},r.utf8decode=function(u){return i.nodebuffer?t.transformTo("nodebuffer",u).toString("utf-8"):function(b){var h,v,g,C,E=b.length,S=new Array(2*E);for(h=v=0;h<E;)if((g=b[h++])<128)S[v++]=g;else if(4<(C=d[g]))S[v++]=65533,h+=C-1;else{for(g&=C===2?31:C===3?15:7;1<C&&h<E;)g=g<<6|63&b[h++],C--;1<C?S[v++]=65533:g<65536?S[v++]=g:(g-=65536,S[v++]=55296|g>>10&1023,S[v++]=56320|1023&g)}return S.length!==v&&(S.subarray?S=S.subarray(0,v):S.length=v),t.applyFromCharCode(S)}(u=t.transformTo(i.uint8array?"uint8array":"array",u))},t.inherits(y,n),y.prototype.processChunk=function(u){var b=t.transformTo(i.uint8array?"uint8array":"array",u.data);if(this.leftOver&&this.leftOver.length){if(i.uint8array){var h=b;(b=new Uint8Array(h.length+this.leftOver.length)).set(this.leftOver,0),b.set(h,this.leftOver.length)}else b=this.leftOver.concat(b);this.leftOver=null}var v=function(C,E){var S;for((E=E||C.length)>C.length&&(E=C.length),S=E-1;0<=S&&(192&C[S])==128;)S--;return S<0||S===0?E:S+d[C[S]]>E?S:E}(b),g=b;v!==b.length&&(i.uint8array?(g=b.subarray(0,v),this.leftOver=b.subarray(v,b.length)):(g=b.slice(0,v),this.leftOver=b.slice(v,b.length))),this.push({data:r.utf8decode(g),meta:u.meta})},y.prototype.flush=function(){this.leftOver&&this.leftOver.length&&(this.push({data:r.utf8decode(this.leftOver),meta:{}}),this.leftOver=null)},r.Utf8DecodeWorker=y,t.inherits(m,n),m.prototype.processChunk=function(u){this.push({data:r.utf8encode(u.data),meta:u.meta})},r.Utf8EncodeWorker=m},{"./nodejsUtils":14,"./stream/GenericWorker":28,"./support":30,"./utils":32}],32:[function(e,c,r){var t=e("./support"),i=e("./base64"),a=e("./nodejsUtils"),n=e("./external");function d(h){return h}function p(h,v){for(var g=0;g<h.length;++g)v[g]=255&h.charCodeAt(g);return v}e("setimmediate"),r.newBlob=function(h,v){r.checkSupport("blob");try{return new Blob([h],{type:v})}catch{try{var g=new(self.BlobBuilder||self.WebKitBlobBuilder||self.MozBlobBuilder||self.MSBlobBuilder);return g.append(h),g.getBlob(v)}catch{throw new Error("Bug : can't construct the Blob.")}}};var y={stringifyByChunk:function(h,v,g){var C=[],E=0,S=h.length;if(S<=g)return String.fromCharCode.apply(null,h);for(;E<S;)v==="array"||v==="nodebuffer"?C.push(String.fromCharCode.apply(null,h.slice(E,Math.min(E+g,S)))):C.push(String.fromCharCode.apply(null,h.subarray(E,Math.min(E+g,S)))),E+=g;return C.join("")},stringifyByChar:function(h){for(var v="",g=0;g<h.length;g++)v+=String.fromCharCode(h[g]);return v},applyCanBeUsed:{uint8array:function(){try{return t.uint8array&&String.fromCharCode.apply(null,new Uint8Array(1)).length===1}catch{return!1}}(),nodebuffer:function(){try{return t.nodebuffer&&String.fromCharCode.apply(null,a.allocBuffer(1)).length===1}catch{return!1}}()}};function m(h){var v=65536,g=r.getTypeOf(h),C=!0;if(g==="uint8array"?C=y.applyCanBeUsed.uint8array:g==="nodebuffer"&&(C=y.applyCanBeUsed.nodebuffer),C)for(;1<v;)try{return y.stringifyByChunk(h,g,v)}catch{v=Math.floor(v/2)}return y.stringifyByChar(h)}function u(h,v){for(var g=0;g<h.length;g++)v[g]=h[g];return v}r.applyFromCharCode=m;var b={};b.string={string:d,array:function(h){return p(h,new Array(h.length))},arraybuffer:function(h){return b.string.uint8array(h).buffer},uint8array:function(h){return p(h,new Uint8Array(h.length))},nodebuffer:function(h){return p(h,a.allocBuffer(h.length))}},b.array={string:m,array:d,arraybuffer:function(h){return new Uint8Array(h).buffer},uint8array:function(h){return new Uint8Array(h)},nodebuffer:function(h){return a.newBufferFrom(h)}},b.arraybuffer={string:function(h){return m(new Uint8Array(h))},array:function(h){return u(new Uint8Array(h),new Array(h.byteLength))},arraybuffer:d,uint8array:function(h){return new Uint8Array(h)},nodebuffer:function(h){return a.newBufferFrom(new Uint8Array(h))}},b.uint8array={string:m,array:function(h){return u(h,new Array(h.length))},arraybuffer:function(h){return h.buffer},uint8array:d,nodebuffer:function(h){return a.newBufferFrom(h)}},b.nodebuffer={string:m,array:function(h){return u(h,new Array(h.length))},arraybuffer:function(h){return b.nodebuffer.uint8array(h).buffer},uint8array:function(h){return u(h,new Uint8Array(h.length))},nodebuffer:d},r.transformTo=function(h,v){if(v=v||"",!h)return v;r.checkSupport(h);var g=r.getTypeOf(v);return b[g][h](v)},r.resolve=function(h){for(var v=h.split("/"),g=[],C=0;C<v.length;C++){var E=v[C];E==="."||E===""&&C!==0&&C!==v.length-1||(E===".."?g.pop():g.push(E))}return g.join("/")},r.getTypeOf=function(h){return typeof h=="string"?"string":Object.prototype.toString.call(h)==="[object Array]"?"array":t.nodebuffer&&a.isBuffer(h)?"nodebuffer":t.uint8array&&h instanceof Uint8Array?"uint8array":t.arraybuffer&&h instanceof ArrayBuffer?"arraybuffer":void 0},r.checkSupport=function(h){if(!t[h.toLowerCase()])throw new Error(h+" is not supported by this platform")},r.MAX_VALUE_16BITS=65535,r.MAX_VALUE_32BITS=-1,r.pretty=function(h){var v,g,C="";for(g=0;g<(h||"").length;g++)C+="\\x"+((v=h.charCodeAt(g))<16?"0":"")+v.toString(16).toUpperCase();return C},r.delay=function(h,v,g){setImmediate(function(){h.apply(g||null,v||[])})},r.inherits=function(h,v){function g(){}g.prototype=v.prototype,h.prototype=new g},r.extend=function(){var h,v,g={};for(h=0;h<arguments.length;h++)for(v in arguments[h])Object.prototype.hasOwnProperty.call(arguments[h],v)&&g[v]===void 0&&(g[v]=arguments[h][v]);return g},r.prepareContent=function(h,v,g,C,E){return n.Promise.resolve(v).then(function(S){return t.blob&&(S instanceof Blob||["[object File]","[object Blob]"].indexOf(Object.prototype.toString.call(S))!==-1)&&typeof FileReader<"u"?new n.Promise(function(I,x){var L=new FileReader;L.onload=function(D){I(D.target.result)},L.onerror=function(D){x(D.target.error)},L.readAsArrayBuffer(S)}):S}).then(function(S){var I=r.getTypeOf(S);return I?(I==="arraybuffer"?S=r.transformTo("uint8array",S):I==="string"&&(E?S=i.decode(S):g&&C!==!0&&(S=function(x){return p(x,t.uint8array?new Uint8Array(x.length):new Array(x.length))}(S))),S):n.Promise.reject(new Error("Can't read the data of '"+h+"'. Is it in a supported JavaScript type (String, Blob, ArrayBuffer, etc) ?"))})}},{"./base64":1,"./external":6,"./nodejsUtils":14,"./support":30,setimmediate:54}],33:[function(e,c,r){var t=e("./reader/readerFor"),i=e("./utils"),a=e("./signature"),n=e("./zipEntry"),d=e("./support");function p(y){this.files=[],this.loadOptions=y}p.prototype={checkSignature:function(y){if(!this.reader.readAndCheckSignature(y)){this.reader.index-=4;var m=this.reader.readString(4);throw new Error("Corrupted zip or bug: unexpected signature ("+i.pretty(m)+", expected "+i.pretty(y)+")")}},isSignature:function(y,m){var u=this.reader.index;this.reader.setIndex(y);var b=this.reader.readString(4)===m;return this.reader.setIndex(u),b},readBlockEndOfCentral:function(){this.diskNumber=this.reader.readInt(2),this.diskWithCentralDirStart=this.reader.readInt(2),this.centralDirRecordsOnThisDisk=this.reader.readInt(2),this.centralDirRecords=this.reader.readInt(2),this.centralDirSize=this.reader.readInt(4),this.centralDirOffset=this.reader.readInt(4),this.zipCommentLength=this.reader.readInt(2);var y=this.reader.readData(this.zipCommentLength),m=d.uint8array?"uint8array":"array",u=i.transformTo(m,y);this.zipComment=this.loadOptions.decodeFileName(u)},readBlockZip64EndOfCentral:function(){this.zip64EndOfCentralSize=this.reader.readInt(8),this.reader.skip(4),this.diskNumber=this.reader.readInt(4),this.diskWithCentralDirStart=this.reader.readInt(4),this.centralDirRecordsOnThisDisk=this.reader.readInt(8),this.centralDirRecords=this.reader.readInt(8),this.centralDirSize=this.reader.readInt(8),this.centralDirOffset=this.reader.readInt(8),this.zip64ExtensibleData={};for(var y,m,u,b=this.zip64EndOfCentralSize-44;0<b;)y=this.reader.readInt(2),m=this.reader.readInt(4),u=this.reader.readData(m),this.zip64ExtensibleData[y]={id:y,length:m,value:u}},readBlockZip64EndOfCentralLocator:function(){if(this.diskWithZip64CentralDirStart=this.reader.readInt(4),this.relativeOffsetEndOfZip64CentralDir=this.reader.readInt(8),this.disksCount=this.reader.readInt(4),1<this.disksCount)throw new Error("Multi-volumes zip are not supported")},readLocalFiles:function(){var y,m;for(y=0;y<this.files.length;y++)m=this.files[y],this.reader.setIndex(m.localHeaderOffset),this.checkSignature(a.LOCAL_FILE_HEADER),m.readLocalPart(this.reader),m.handleUTF8(),m.processAttributes()},readCentralDir:function(){var y;for(this.reader.setIndex(this.centralDirOffset);this.reader.readAndCheckSignature(a.CENTRAL_FILE_HEADER);)(y=new n({zip64:this.zip64},this.loadOptions)).readCentralPart(this.reader),this.files.push(y);if(this.centralDirRecords!==this.files.length&&this.centralDirRecords!==0&&this.files.length===0)throw new Error("Corrupted zip or bug: expected "+this.centralDirRecords+" records in central dir, got "+this.files.length)},readEndOfCentral:function(){var y=this.reader.lastIndexOfSignature(a.CENTRAL_DIRECTORY_END);if(y<0)throw this.isSignature(0,a.LOCAL_FILE_HEADER)?new Error("Corrupted zip: can't find end of central directory"):new Error("Can't find end of central directory : is this a zip file ? If it is, see https://stuk.github.io/jszip/documentation/howto/read_zip.html");this.reader.setIndex(y);var m=y;if(this.checkSignature(a.CENTRAL_DIRECTORY_END),this.readBlockEndOfCentral(),this.diskNumber===i.MAX_VALUE_16BITS||this.diskWithCentralDirStart===i.MAX_VALUE_16BITS||this.centralDirRecordsOnThisDisk===i.MAX_VALUE_16BITS||this.centralDirRecords===i.MAX_VALUE_16BITS||this.centralDirSize===i.MAX_VALUE_32BITS||this.centralDirOffset===i.MAX_VALUE_32BITS){if(this.zip64=!0,(y=this.reader.lastIndexOfSignature(a.ZIP64_CENTRAL_DIRECTORY_LOCATOR))<0)throw new Error("Corrupted zip: can't find the ZIP64 end of central directory locator");if(this.reader.setIndex(y),this.checkSignature(a.ZIP64_CENTRAL_DIRECTORY_LOCATOR),this.readBlockZip64EndOfCentralLocator(),!this.isSignature(this.relativeOffsetEndOfZip64CentralDir,a.ZIP64_CENTRAL_DIRECTORY_END)&&(this.relativeOffsetEndOfZip64CentralDir=this.reader.lastIndexOfSignature(a.ZIP64_CENTRAL_DIRECTORY_END),this.relativeOffsetEndOfZip64CentralDir<0))throw new Error("Corrupted zip: can't find the ZIP64 end of central directory");this.reader.setIndex(this.relativeOffsetEndOfZip64CentralDir),this.checkSignature(a.ZIP64_CENTRAL_DIRECTORY_END),this.readBlockZip64EndOfCentral()}var u=this.centralDirOffset+this.centralDirSize;this.zip64&&(u+=20,u+=12+this.zip64EndOfCentralSize);var b=m-u;if(0<b)this.isSignature(m,a.CENTRAL_FILE_HEADER)||(this.reader.zero=b);else if(b<0)throw new Error("Corrupted zip: missing "+Math.abs(b)+" bytes.")},prepareReader:function(y){this.reader=t(y)},load:function(y){this.prepareReader(y),this.readEndOfCentral(),this.readCentralDir(),this.readLocalFiles()}},c.exports=p},{"./reader/readerFor":22,"./signature":23,"./support":30,"./utils":32,"./zipEntry":34}],34:[function(e,c,r){var t=e("./reader/readerFor"),i=e("./utils"),a=e("./compressedObject"),n=e("./crc32"),d=e("./utf8"),p=e("./compressions"),y=e("./support");function m(u,b){this.options=u,this.loadOptions=b}m.prototype={isEncrypted:function(){return(1&this.bitFlag)==1},useUTF8:function(){return(2048&this.bitFlag)==2048},readLocalPart:function(u){var b,h;if(u.skip(22),this.fileNameLength=u.readInt(2),h=u.readInt(2),this.fileName=u.readData(this.fileNameLength),u.skip(h),this.compressedSize===-1||this.uncompressedSize===-1)throw new Error("Bug or corrupted zip : didn't get enough information from the central directory (compressedSize === -1 || uncompressedSize === -1)");if((b=function(v){for(var g in p)if(Object.prototype.hasOwnProperty.call(p,g)&&p[g].magic===v)return p[g];return null}(this.compressionMethod))===null)throw new Error("Corrupted zip : compression "+i.pretty(this.compressionMethod)+" unknown (inner file : "+i.transformTo("string",this.fileName)+")");this.decompressed=new a(this.compressedSize,this.uncompressedSize,this.crc32,b,u.readData(this.compressedSize))},readCentralPart:function(u){this.versionMadeBy=u.readInt(2),u.skip(2),this.bitFlag=u.readInt(2),this.compressionMethod=u.readString(2),this.date=u.readDate(),this.crc32=u.readInt(4),this.compressedSize=u.readInt(4),this.uncompressedSize=u.readInt(4);var b=u.readInt(2);if(this.extraFieldsLength=u.readInt(2),this.fileCommentLength=u.readInt(2),this.diskNumberStart=u.readInt(2),this.internalFileAttributes=u.readInt(2),this.externalFileAttributes=u.readInt(4),this.localHeaderOffset=u.readInt(4),this.isEncrypted())throw new Error("Encrypted zip are not supported");u.skip(b),this.readExtraFields(u),this.parseZIP64ExtraField(u),this.fileComment=u.readData(this.fileCommentLength)},processAttributes:function(){this.unixPermissions=null,this.dosPermissions=null;var u=this.versionMadeBy>>8;this.dir=!!(16&this.externalFileAttributes),u==0&&(this.dosPermissions=63&this.externalFileAttributes),u==3&&(this.unixPermissions=this.externalFileAttributes>>16&65535),this.dir||this.fileNameStr.slice(-1)!=="/"||(this.dir=!0)},parseZIP64ExtraField:function(){if(this.extraFields[1]){var u=t(this.extraFields[1].value);this.uncompressedSize===i.MAX_VALUE_32BITS&&(this.uncompressedSize=u.readInt(8)),this.compressedSize===i.MAX_VALUE_32BITS&&(this.compressedSize=u.readInt(8)),this.localHeaderOffset===i.MAX_VALUE_32BITS&&(this.localHeaderOffset=u.readInt(8)),this.diskNumberStart===i.MAX_VALUE_32BITS&&(this.diskNumberStart=u.readInt(4))}},readExtraFields:function(u){var b,h,v,g=u.index+this.extraFieldsLength;for(this.extraFields||(this.extraFields={});u.index+4<g;)b=u.readInt(2),h=u.readInt(2),v=u.readData(h),this.extraFields[b]={id:b,length:h,value:v};u.setIndex(g)},handleUTF8:function(){var u=y.uint8array?"uint8array":"array";if(this.useUTF8())this.fileNameStr=d.utf8decode(this.fileName),this.fileCommentStr=d.utf8decode(this.fileComment);else{var b=this.findExtraFieldUnicodePath();if(b!==null)this.fileNameStr=b;else{var h=i.transformTo(u,this.fileName);this.fileNameStr=this.loadOptions.decodeFileName(h)}var v=this.findExtraFieldUnicodeComment();if(v!==null)this.fileCommentStr=v;else{var g=i.transformTo(u,this.fileComment);this.fileCommentStr=this.loadOptions.decodeFileName(g)}}},findExtraFieldUnicodePath:function(){var u=this.extraFields[28789];if(u){var b=t(u.value);return b.readInt(1)!==1||n(this.fileName)!==b.readInt(4)?null:d.utf8decode(b.readData(u.length-5))}return null},findExtraFieldUnicodeComment:function(){var u=this.extraFields[25461];if(u){var b=t(u.value);return b.readInt(1)!==1||n(this.fileComment)!==b.readInt(4)?null:d.utf8decode(b.readData(u.length-5))}return null}},c.exports=m},{"./compressedObject":2,"./compressions":3,"./crc32":4,"./reader/readerFor":22,"./support":30,"./utf8":31,"./utils":32}],35:[function(e,c,r){function t(b,h,v){this.name=b,this.dir=v.dir,this.date=v.date,this.comment=v.comment,this.unixPermissions=v.unixPermissions,this.dosPermissions=v.dosPermissions,this._data=h,this._dataBinary=v.binary,this.options={compression:v.compression,compressionOptions:v.compressionOptions}}var i=e("./stream/StreamHelper"),a=e("./stream/DataWorker"),n=e("./utf8"),d=e("./compressedObject"),p=e("./stream/GenericWorker");t.prototype={internalStream:function(b){var h=null,v="string";try{if(!b)throw new Error("No output type specified.");var g=(v=b.toLowerCase())==="string"||v==="text";v!=="binarystring"&&v!=="text"||(v="string"),h=this._decompressWorker();var C=!this._dataBinary;C&&!g&&(h=h.pipe(new n.Utf8EncodeWorker)),!C&&g&&(h=h.pipe(new n.Utf8DecodeWorker))}catch(E){(h=new p("error")).error(E)}return new i(h,v,"")},async:function(b,h){return this.internalStream(b).accumulate(h)},nodeStream:function(b,h){return this.internalStream(b||"nodebuffer").toNodejsStream(h)},_compressWorker:function(b,h){if(this._data instanceof d&&this._data.compression.magic===b.magic)return this._data.getCompressedWorker();var v=this._decompressWorker();return this._dataBinary||(v=v.pipe(new n.Utf8EncodeWorker)),d.createWorkerFrom(v,b,h)},_decompressWorker:function(){return this._data instanceof d?this._data.getContentWorker():this._data instanceof p?this._data:new a(this._data)}};for(var y=["asText","asBinary","asNodeBuffer","asUint8Array","asArrayBuffer"],m=function(){throw new Error("This method has been removed in JSZip 3.0, please check the upgrade guide.")},u=0;u<y.length;u++)t.prototype[y[u]]=m;c.exports=t},{"./compressedObject":2,"./stream/DataWorker":27,"./stream/GenericWorker":28,"./stream/StreamHelper":29,"./utf8":31}],36:[function(e,c,r){(function(t){var i,a,n=t.MutationObserver||t.WebKitMutationObserver;if(n){var d=0,p=new n(b),y=t.document.createTextNode("");p.observe(y,{characterData:!0}),i=function(){y.data=d=++d%2}}else if(t.setImmediate||t.MessageChannel===void 0)i="document"in t&&"onreadystatechange"in t.document.createElement("script")?function(){var h=t.document.createElement("script");h.onreadystatechange=function(){b(),h.onreadystatechange=null,h.parentNode.removeChild(h),h=null},t.document.documentElement.appendChild(h)}:function(){setTimeout(b,0)};else{var m=new t.MessageChannel;m.port1.onmessage=b,i=function(){m.port2.postMessage(0)}}var u=[];function b(){var h,v;a=!0;for(var g=u.length;g;){for(v=u,u=[],h=-1;++h<g;)v[h]();g=u.length}a=!1}c.exports=function(h){u.push(h)!==1||a||i()}}).call(this,typeof mn<"u"?mn:typeof self<"u"?self:typeof window<"u"?window:{})},{}],37:[function(e,c,r){var t=e("immediate");function i(){}var a={},n=["REJECTED"],d=["FULFILLED"],p=["PENDING"];function y(g){if(typeof g!="function")throw new TypeError("resolver must be a function");this.state=p,this.queue=[],this.outcome=void 0,g!==i&&h(this,g)}function m(g,C,E){this.promise=g,typeof C=="function"&&(this.onFulfilled=C,this.callFulfilled=this.otherCallFulfilled),typeof E=="function"&&(this.onRejected=E,this.callRejected=this.otherCallRejected)}function u(g,C,E){t(function(){var S;try{S=C(E)}catch(I){return a.reject(g,I)}S===g?a.reject(g,new TypeError("Cannot resolve promise with itself")):a.resolve(g,S)})}function b(g){var C=g&&g.then;if(g&&(typeof g=="object"||typeof g=="function")&&typeof C=="function")return function(){C.apply(g,arguments)}}function h(g,C){var E=!1;function S(L){E||(E=!0,a.reject(g,L))}function I(L){E||(E=!0,a.resolve(g,L))}var x=v(function(){C(I,S)});x.status==="error"&&S(x.value)}function v(g,C){var E={};try{E.value=g(C),E.status="success"}catch(S){E.status="error",E.value=S}return E}(c.exports=y).prototype.finally=function(g){if(typeof g!="function")return this;var C=this.constructor;return this.then(function(E){return C.resolve(g()).then(function(){return E})},function(E){return C.resolve(g()).then(function(){throw E})})},y.prototype.catch=function(g){return this.then(null,g)},y.prototype.then=function(g,C){if(typeof g!="function"&&this.state===d||typeof C!="function"&&this.state===n)return this;var E=new this.constructor(i);return this.state!==p?u(E,this.state===d?g:C,this.outcome):this.queue.push(new m(E,g,C)),E},m.prototype.callFulfilled=function(g){a.resolve(this.promise,g)},m.prototype.otherCallFulfilled=function(g){u(this.promise,this.onFulfilled,g)},m.prototype.callRejected=function(g){a.reject(this.promise,g)},m.prototype.otherCallRejected=function(g){u(this.promise,this.onRejected,g)},a.resolve=function(g,C){var E=v(b,C);if(E.status==="error")return a.reject(g,E.value);var S=E.value;if(S)h(g,S);else{g.state=d,g.outcome=C;for(var I=-1,x=g.queue.length;++I<x;)g.queue[I].callFulfilled(C)}return g},a.reject=function(g,C){g.state=n,g.outcome=C;for(var E=-1,S=g.queue.length;++E<S;)g.queue[E].callRejected(C);return g},y.resolve=function(g){return g instanceof this?g:a.resolve(new this(i),g)},y.reject=function(g){var C=new this(i);return a.reject(C,g)},y.all=function(g){var C=this;if(Object.prototype.toString.call(g)!=="[object Array]")return this.reject(new TypeError("must be an array"));var E=g.length,S=!1;if(!E)return this.resolve([]);for(var I=new Array(E),x=0,L=-1,D=new this(i);++L<E;)R(g[L],L);return D;function R(P,Q){C.resolve(P).then(function(k){I[Q]=k,++x!==E||S||(S=!0,a.resolve(D,I))},function(k){S||(S=!0,a.reject(D,k))})}},y.race=function(g){var C=this;if(Object.prototype.toString.call(g)!=="[object Array]")return this.reject(new TypeError("must be an array"));var E=g.length,S=!1;if(!E)return this.resolve([]);for(var I=-1,x=new this(i);++I<E;)L=g[I],C.resolve(L).then(function(D){S||(S=!0,a.resolve(x,D))},function(D){S||(S=!0,a.reject(x,D))});var L;return x}},{immediate:36}],38:[function(e,c,r){var t={};(0,e("./lib/utils/common").assign)(t,e("./lib/deflate"),e("./lib/inflate"),e("./lib/zlib/constants")),c.exports=t},{"./lib/deflate":39,"./lib/inflate":40,"./lib/utils/common":41,"./lib/zlib/constants":44}],39:[function(e,c,r){var t=e("./zlib/deflate"),i=e("./utils/common"),a=e("./utils/strings"),n=e("./zlib/messages"),d=e("./zlib/zstream"),p=Object.prototype.toString,y=0,m=-1,u=0,b=8;function h(g){if(!(this instanceof h))return new h(g);this.options=i.assign({level:m,method:b,chunkSize:16384,windowBits:15,memLevel:8,strategy:u,to:""},g||{});var C=this.options;C.raw&&0<C.windowBits?C.windowBits=-C.windowBits:C.gzip&&0<C.windowBits&&C.windowBits<16&&(C.windowBits+=16),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new d,this.strm.avail_out=0;var E=t.deflateInit2(this.strm,C.level,C.method,C.windowBits,C.memLevel,C.strategy);if(E!==y)throw new Error(n[E]);if(C.header&&t.deflateSetHeader(this.strm,C.header),C.dictionary){var S;if(S=typeof C.dictionary=="string"?a.string2buf(C.dictionary):p.call(C.dictionary)==="[object ArrayBuffer]"?new Uint8Array(C.dictionary):C.dictionary,(E=t.deflateSetDictionary(this.strm,S))!==y)throw new Error(n[E]);this._dict_set=!0}}function v(g,C){var E=new h(C);if(E.push(g,!0),E.err)throw E.msg||n[E.err];return E.result}h.prototype.push=function(g,C){var E,S,I=this.strm,x=this.options.chunkSize;if(this.ended)return!1;S=C===~~C?C:C===!0?4:0,typeof g=="string"?I.input=a.string2buf(g):p.call(g)==="[object ArrayBuffer]"?I.input=new Uint8Array(g):I.input=g,I.next_in=0,I.avail_in=I.input.length;do{if(I.avail_out===0&&(I.output=new i.Buf8(x),I.next_out=0,I.avail_out=x),(E=t.deflate(I,S))!==1&&E!==y)return this.onEnd(E),!(this.ended=!0);I.avail_out!==0&&(I.avail_in!==0||S!==4&&S!==2)||(this.options.to==="string"?this.onData(a.buf2binstring(i.shrinkBuf(I.output,I.next_out))):this.onData(i.shrinkBuf(I.output,I.next_out)))}while((0<I.avail_in||I.avail_out===0)&&E!==1);return S===4?(E=t.deflateEnd(this.strm),this.onEnd(E),this.ended=!0,E===y):S!==2||(this.onEnd(y),!(I.avail_out=0))},h.prototype.onData=function(g){this.chunks.push(g)},h.prototype.onEnd=function(g){g===y&&(this.options.to==="string"?this.result=this.chunks.join(""):this.result=i.flattenChunks(this.chunks)),this.chunks=[],this.err=g,this.msg=this.strm.msg},r.Deflate=h,r.deflate=v,r.deflateRaw=function(g,C){return(C=C||{}).raw=!0,v(g,C)},r.gzip=function(g,C){return(C=C||{}).gzip=!0,v(g,C)}},{"./utils/common":41,"./utils/strings":42,"./zlib/deflate":46,"./zlib/messages":51,"./zlib/zstream":53}],40:[function(e,c,r){var t=e("./zlib/inflate"),i=e("./utils/common"),a=e("./utils/strings"),n=e("./zlib/constants"),d=e("./zlib/messages"),p=e("./zlib/zstream"),y=e("./zlib/gzheader"),m=Object.prototype.toString;function u(h){if(!(this instanceof u))return new u(h);this.options=i.assign({chunkSize:16384,windowBits:0,to:""},h||{});var v=this.options;v.raw&&0<=v.windowBits&&v.windowBits<16&&(v.windowBits=-v.windowBits,v.windowBits===0&&(v.windowBits=-15)),!(0<=v.windowBits&&v.windowBits<16)||h&&h.windowBits||(v.windowBits+=32),15<v.windowBits&&v.windowBits<48&&!(15&v.windowBits)&&(v.windowBits|=15),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new p,this.strm.avail_out=0;var g=t.inflateInit2(this.strm,v.windowBits);if(g!==n.Z_OK)throw new Error(d[g]);this.header=new y,t.inflateGetHeader(this.strm,this.header)}function b(h,v){var g=new u(v);if(g.push(h,!0),g.err)throw g.msg||d[g.err];return g.result}u.prototype.push=function(h,v){var g,C,E,S,I,x,L=this.strm,D=this.options.chunkSize,R=this.options.dictionary,P=!1;if(this.ended)return!1;C=v===~~v?v:v===!0?n.Z_FINISH:n.Z_NO_FLUSH,typeof h=="string"?L.input=a.binstring2buf(h):m.call(h)==="[object ArrayBuffer]"?L.input=new Uint8Array(h):L.input=h,L.next_in=0,L.avail_in=L.input.length;do{if(L.avail_out===0&&(L.output=new i.Buf8(D),L.next_out=0,L.avail_out=D),(g=t.inflate(L,n.Z_NO_FLUSH))===n.Z_NEED_DICT&&R&&(x=typeof R=="string"?a.string2buf(R):m.call(R)==="[object ArrayBuffer]"?new Uint8Array(R):R,g=t.inflateSetDictionary(this.strm,x)),g===n.Z_BUF_ERROR&&P===!0&&(g=n.Z_OK,P=!1),g!==n.Z_STREAM_END&&g!==n.Z_OK)return this.onEnd(g),!(this.ended=!0);L.next_out&&(L.avail_out!==0&&g!==n.Z_STREAM_END&&(L.avail_in!==0||C!==n.Z_FINISH&&C!==n.Z_SYNC_FLUSH)||(this.options.to==="string"?(E=a.utf8border(L.output,L.next_out),S=L.next_out-E,I=a.buf2string(L.output,E),L.next_out=S,L.avail_out=D-S,S&&i.arraySet(L.output,L.output,E,S,0),this.onData(I)):this.onData(i.shrinkBuf(L.output,L.next_out)))),L.avail_in===0&&L.avail_out===0&&(P=!0)}while((0<L.avail_in||L.avail_out===0)&&g!==n.Z_STREAM_END);return g===n.Z_STREAM_END&&(C=n.Z_FINISH),C===n.Z_FINISH?(g=t.inflateEnd(this.strm),this.onEnd(g),this.ended=!0,g===n.Z_OK):C!==n.Z_SYNC_FLUSH||(this.onEnd(n.Z_OK),!(L.avail_out=0))},u.prototype.onData=function(h){this.chunks.push(h)},u.prototype.onEnd=function(h){h===n.Z_OK&&(this.options.to==="string"?this.result=this.chunks.join(""):this.result=i.flattenChunks(this.chunks)),this.chunks=[],this.err=h,this.msg=this.strm.msg},r.Inflate=u,r.inflate=b,r.inflateRaw=function(h,v){return(v=v||{}).raw=!0,b(h,v)},r.ungzip=b},{"./utils/common":41,"./utils/strings":42,"./zlib/constants":44,"./zlib/gzheader":47,"./zlib/inflate":49,"./zlib/messages":51,"./zlib/zstream":53}],41:[function(e,c,r){var t=typeof Uint8Array<"u"&&typeof Uint16Array<"u"&&typeof Int32Array<"u";r.assign=function(n){for(var d=Array.prototype.slice.call(arguments,1);d.length;){var p=d.shift();if(p){if(typeof p!="object")throw new TypeError(p+"must be non-object");for(var y in p)p.hasOwnProperty(y)&&(n[y]=p[y])}}return n},r.shrinkBuf=function(n,d){return n.length===d?n:n.subarray?n.subarray(0,d):(n.length=d,n)};var i={arraySet:function(n,d,p,y,m){if(d.subarray&&n.subarray)n.set(d.subarray(p,p+y),m);else for(var u=0;u<y;u++)n[m+u]=d[p+u]},flattenChunks:function(n){var d,p,y,m,u,b;for(d=y=0,p=n.length;d<p;d++)y+=n[d].length;for(b=new Uint8Array(y),d=m=0,p=n.length;d<p;d++)u=n[d],b.set(u,m),m+=u.length;return b}},a={arraySet:function(n,d,p,y,m){for(var u=0;u<y;u++)n[m+u]=d[p+u]},flattenChunks:function(n){return[].concat.apply([],n)}};r.setTyped=function(n){n?(r.Buf8=Uint8Array,r.Buf16=Uint16Array,r.Buf32=Int32Array,r.assign(r,i)):(r.Buf8=Array,r.Buf16=Array,r.Buf32=Array,r.assign(r,a))},r.setTyped(t)},{}],42:[function(e,c,r){var t=e("./common"),i=!0,a=!0;try{String.fromCharCode.apply(null,[0])}catch{i=!1}try{String.fromCharCode.apply(null,new Uint8Array(1))}catch{a=!1}for(var n=new t.Buf8(256),d=0;d<256;d++)n[d]=252<=d?6:248<=d?5:240<=d?4:224<=d?3:192<=d?2:1;function p(y,m){if(m<65537&&(y.subarray&&a||!y.subarray&&i))return String.fromCharCode.apply(null,t.shrinkBuf(y,m));for(var u="",b=0;b<m;b++)u+=String.fromCharCode(y[b]);return u}n[254]=n[254]=1,r.string2buf=function(y){var m,u,b,h,v,g=y.length,C=0;for(h=0;h<g;h++)(64512&(u=y.charCodeAt(h)))==55296&&h+1<g&&(64512&(b=y.charCodeAt(h+1)))==56320&&(u=65536+(u-55296<<10)+(b-56320),h++),C+=u<128?1:u<2048?2:u<65536?3:4;for(m=new t.Buf8(C),h=v=0;v<C;h++)(64512&(u=y.charCodeAt(h)))==55296&&h+1<g&&(64512&(b=y.charCodeAt(h+1)))==56320&&(u=65536+(u-55296<<10)+(b-56320),h++),u<128?m[v++]=u:(u<2048?m[v++]=192|u>>>6:(u<65536?m[v++]=224|u>>>12:(m[v++]=240|u>>>18,m[v++]=128|u>>>12&63),m[v++]=128|u>>>6&63),m[v++]=128|63&u);return m},r.buf2binstring=function(y){return p(y,y.length)},r.binstring2buf=function(y){for(var m=new t.Buf8(y.length),u=0,b=m.length;u<b;u++)m[u]=y.charCodeAt(u);return m},r.buf2string=function(y,m){var u,b,h,v,g=m||y.length,C=new Array(2*g);for(u=b=0;u<g;)if((h=y[u++])<128)C[b++]=h;else if(4<(v=n[h]))C[b++]=65533,u+=v-1;else{for(h&=v===2?31:v===3?15:7;1<v&&u<g;)h=h<<6|63&y[u++],v--;1<v?C[b++]=65533:h<65536?C[b++]=h:(h-=65536,C[b++]=55296|h>>10&1023,C[b++]=56320|1023&h)}return p(C,b)},r.utf8border=function(y,m){var u;for((m=m||y.length)>y.length&&(m=y.length),u=m-1;0<=u&&(192&y[u])==128;)u--;return u<0||u===0?m:u+n[y[u]]>m?u:m}},{"./common":41}],43:[function(e,c,r){c.exports=function(t,i,a,n){for(var d=65535&t|0,p=t>>>16&65535|0,y=0;a!==0;){for(a-=y=2e3<a?2e3:a;p=p+(d=d+i[n++]|0)|0,--y;);d%=65521,p%=65521}return d|p<<16|0}},{}],44:[function(e,c,r){c.exports={Z_NO_FLUSH:0,Z_PARTIAL_FLUSH:1,Z_SYNC_FLUSH:2,Z_FULL_FLUSH:3,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_ERRNO:-1,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_BUF_ERROR:-5,Z_NO_COMPRESSION:0,Z_BEST_SPEED:1,Z_BEST_COMPRESSION:9,Z_DEFAULT_COMPRESSION:-1,Z_FILTERED:1,Z_HUFFMAN_ONLY:2,Z_RLE:3,Z_FIXED:4,Z_DEFAULT_STRATEGY:0,Z_BINARY:0,Z_TEXT:1,Z_UNKNOWN:2,Z_DEFLATED:8}},{}],45:[function(e,c,r){var t=function(){for(var i,a=[],n=0;n<256;n++){i=n;for(var d=0;d<8;d++)i=1&i?3988292384^i>>>1:i>>>1;a[n]=i}return a}();c.exports=function(i,a,n,d){var p=t,y=d+n;i^=-1;for(var m=d;m<y;m++)i=i>>>8^p[255&(i^a[m])];return-1^i}},{}],46:[function(e,c,r){var t,i=e("../utils/common"),a=e("./trees"),n=e("./adler32"),d=e("./crc32"),p=e("./messages"),y=0,m=4,u=0,b=-2,h=-1,v=4,g=2,C=8,E=9,S=286,I=30,x=19,L=2*S+1,D=15,R=3,P=258,Q=P+R+1,k=42,z=113,f=1,W=2,ue=3,Z=4;function fe(l,H){return l.msg=p[H],H}function F(l){return(l<<1)-(4<l?9:0)}function ne(l){for(var H=l.length;0<=--H;)l[H]=0}function A(l){var H=l.state,$=H.pending;$>l.avail_out&&($=l.avail_out),$!==0&&(i.arraySet(l.output,H.pending_buf,H.pending_out,$,l.next_out),l.next_out+=$,H.pending_out+=$,l.total_out+=$,l.avail_out-=$,H.pending-=$,H.pending===0&&(H.pending_out=0))}function M(l,H){a._tr_flush_block(l,0<=l.block_start?l.block_start:-1,l.strstart-l.block_start,H),l.block_start=l.strstart,A(l.strm)}function re(l,H){l.pending_buf[l.pending++]=H}function te(l,H){l.pending_buf[l.pending++]=H>>>8&255,l.pending_buf[l.pending++]=255&H}function Y(l,H){var $,_,w=l.max_chain_length,T=l.strstart,j=l.prev_length,q=l.nice_match,O=l.strstart>l.w_size-Q?l.strstart-(l.w_size-Q):0,V=l.window,se=l.w_mask,J=l.prev,le=l.strstart+P,he=V[T+j-1],ye=V[T+j];l.prev_length>=l.good_match&&(w>>=2),q>l.lookahead&&(q=l.lookahead);do if(V[($=H)+j]===ye&&V[$+j-1]===he&&V[$]===V[T]&&V[++$]===V[T+1]){T+=2,$++;do;while(V[++T]===V[++$]&&V[++T]===V[++$]&&V[++T]===V[++$]&&V[++T]===V[++$]&&V[++T]===V[++$]&&V[++T]===V[++$]&&V[++T]===V[++$]&&V[++T]===V[++$]&&T<le);if(_=P-(le-T),T=le-P,j<_){if(l.match_start=H,q<=(j=_))break;he=V[T+j-1],ye=V[T+j]}}while((H=J[H&se])>O&&--w!=0);return j<=l.lookahead?j:l.lookahead}function Te(l){var H,$,_,w,T,j,q,O,V,se,J=l.w_size;do{if(w=l.window_size-l.lookahead-l.strstart,l.strstart>=J+(J-Q)){for(i.arraySet(l.window,l.window,J,J,0),l.match_start-=J,l.strstart-=J,l.block_start-=J,H=$=l.hash_size;_=l.head[--H],l.head[H]=J<=_?_-J:0,--$;);for(H=$=J;_=l.prev[--H],l.prev[H]=J<=_?_-J:0,--$;);w+=J}if(l.strm.avail_in===0)break;if(j=l.strm,q=l.window,O=l.strstart+l.lookahead,V=w,se=void 0,se=j.avail_in,V<se&&(se=V),$=se===0?0:(j.avail_in-=se,i.arraySet(q,j.input,j.next_in,se,O),j.state.wrap===1?j.adler=n(j.adler,q,se,O):j.state.wrap===2&&(j.adler=d(j.adler,q,se,O)),j.next_in+=se,j.total_in+=se,se),l.lookahead+=$,l.lookahead+l.insert>=R)for(T=l.strstart-l.insert,l.ins_h=l.window[T],l.ins_h=(l.ins_h<<l.hash_shift^l.window[T+1])&l.hash_mask;l.insert&&(l.ins_h=(l.ins_h<<l.hash_shift^l.window[T+R-1])&l.hash_mask,l.prev[T&l.w_mask]=l.head[l.ins_h],l.head[l.ins_h]=T,T++,l.insert--,!(l.lookahead+l.insert<R)););}while(l.lookahead<Q&&l.strm.avail_in!==0)}function Ne(l,H){for(var $,_;;){if(l.lookahead<Q){if(Te(l),l.lookahead<Q&&H===y)return f;if(l.lookahead===0)break}if($=0,l.lookahead>=R&&(l.ins_h=(l.ins_h<<l.hash_shift^l.window[l.strstart+R-1])&l.hash_mask,$=l.prev[l.strstart&l.w_mask]=l.head[l.ins_h],l.head[l.ins_h]=l.strstart),$!==0&&l.strstart-$<=l.w_size-Q&&(l.match_length=Y(l,$)),l.match_length>=R)if(_=a._tr_tally(l,l.strstart-l.match_start,l.match_length-R),l.lookahead-=l.match_length,l.match_length<=l.max_lazy_match&&l.lookahead>=R){for(l.match_length--;l.strstart++,l.ins_h=(l.ins_h<<l.hash_shift^l.window[l.strstart+R-1])&l.hash_mask,$=l.prev[l.strstart&l.w_mask]=l.head[l.ins_h],l.head[l.ins_h]=l.strstart,--l.match_length!=0;);l.strstart++}else l.strstart+=l.match_length,l.match_length=0,l.ins_h=l.window[l.strstart],l.ins_h=(l.ins_h<<l.hash_shift^l.window[l.strstart+1])&l.hash_mask;else _=a._tr_tally(l,0,l.window[l.strstart]),l.lookahead--,l.strstart++;if(_&&(M(l,!1),l.strm.avail_out===0))return f}return l.insert=l.strstart<R-1?l.strstart:R-1,H===m?(M(l,!0),l.strm.avail_out===0?ue:Z):l.last_lit&&(M(l,!1),l.strm.avail_out===0)?f:W}function ve(l,H){for(var $,_,w;;){if(l.lookahead<Q){if(Te(l),l.lookahead<Q&&H===y)return f;if(l.lookahead===0)break}if($=0,l.lookahead>=R&&(l.ins_h=(l.ins_h<<l.hash_shift^l.window[l.strstart+R-1])&l.hash_mask,$=l.prev[l.strstart&l.w_mask]=l.head[l.ins_h],l.head[l.ins_h]=l.strstart),l.prev_length=l.match_length,l.prev_match=l.match_start,l.match_length=R-1,$!==0&&l.prev_length<l.max_lazy_match&&l.strstart-$<=l.w_size-Q&&(l.match_length=Y(l,$),l.match_length<=5&&(l.strategy===1||l.match_length===R&&4096<l.strstart-l.match_start)&&(l.match_length=R-1)),l.prev_length>=R&&l.match_length<=l.prev_length){for(w=l.strstart+l.lookahead-R,_=a._tr_tally(l,l.strstart-1-l.prev_match,l.prev_length-R),l.lookahead-=l.prev_length-1,l.prev_length-=2;++l.strstart<=w&&(l.ins_h=(l.ins_h<<l.hash_shift^l.window[l.strstart+R-1])&l.hash_mask,$=l.prev[l.strstart&l.w_mask]=l.head[l.ins_h],l.head[l.ins_h]=l.strstart),--l.prev_length!=0;);if(l.match_available=0,l.match_length=R-1,l.strstart++,_&&(M(l,!1),l.strm.avail_out===0))return f}else if(l.match_available){if((_=a._tr_tally(l,0,l.window[l.strstart-1]))&&M(l,!1),l.strstart++,l.lookahead--,l.strm.avail_out===0)return f}else l.match_available=1,l.strstart++,l.lookahead--}return l.match_available&&(_=a._tr_tally(l,0,l.window[l.strstart-1]),l.match_available=0),l.insert=l.strstart<R-1?l.strstart:R-1,H===m?(M(l,!0),l.strm.avail_out===0?ue:Z):l.last_lit&&(M(l,!1),l.strm.avail_out===0)?f:W}function _e(l,H,$,_,w){this.good_length=l,this.max_lazy=H,this.nice_length=$,this.max_chain=_,this.func=w}function Ae(){this.strm=null,this.status=0,this.pending_buf=null,this.pending_buf_size=0,this.pending_out=0,this.pending=0,this.wrap=0,this.gzhead=null,this.gzindex=0,this.method=C,this.last_flush=-1,this.w_size=0,this.w_bits=0,this.w_mask=0,this.window=null,this.window_size=0,this.prev=null,this.head=null,this.ins_h=0,this.hash_size=0,this.hash_bits=0,this.hash_mask=0,this.hash_shift=0,this.block_start=0,this.match_length=0,this.prev_match=0,this.match_available=0,this.strstart=0,this.match_start=0,this.lookahead=0,this.prev_length=0,this.max_chain_length=0,this.max_lazy_match=0,this.level=0,this.strategy=0,this.good_match=0,this.nice_match=0,this.dyn_ltree=new i.Buf16(2*L),this.dyn_dtree=new i.Buf16(2*(2*I+1)),this.bl_tree=new i.Buf16(2*(2*x+1)),ne(this.dyn_ltree),ne(this.dyn_dtree),ne(this.bl_tree),this.l_desc=null,this.d_desc=null,this.bl_desc=null,this.bl_count=new i.Buf16(D+1),this.heap=new i.Buf16(2*S+1),ne(this.heap),this.heap_len=0,this.heap_max=0,this.depth=new i.Buf16(2*S+1),ne(this.depth),this.l_buf=0,this.lit_bufsize=0,this.last_lit=0,this.d_buf=0,this.opt_len=0,this.static_len=0,this.matches=0,this.insert=0,this.bi_buf=0,this.bi_valid=0}function Be(l){var H;return l&&l.state?(l.total_in=l.total_out=0,l.data_type=g,(H=l.state).pending=0,H.pending_out=0,H.wrap<0&&(H.wrap=-H.wrap),H.status=H.wrap?k:z,l.adler=H.wrap===2?0:1,H.last_flush=y,a._tr_init(H),u):fe(l,b)}function Je(l){var H=Be(l);return H===u&&function($){$.window_size=2*$.w_size,ne($.head),$.max_lazy_match=t[$.level].max_lazy,$.good_match=t[$.level].good_length,$.nice_match=t[$.level].nice_length,$.max_chain_length=t[$.level].max_chain,$.strstart=0,$.block_start=0,$.lookahead=0,$.insert=0,$.match_length=$.prev_length=R-1,$.match_available=0,$.ins_h=0}(l.state),H}function Ye(l,H,$,_,w,T){if(!l)return b;var j=1;if(H===h&&(H=6),_<0?(j=0,_=-_):15<_&&(j=2,_-=16),w<1||E<w||$!==C||_<8||15<_||H<0||9<H||T<0||v<T)return fe(l,b);_===8&&(_=9);var q=new Ae;return(l.state=q).strm=l,q.wrap=j,q.gzhead=null,q.w_bits=_,q.w_size=1<<q.w_bits,q.w_mask=q.w_size-1,q.hash_bits=w+7,q.hash_size=1<<q.hash_bits,q.hash_mask=q.hash_size-1,q.hash_shift=~~((q.hash_bits+R-1)/R),q.window=new i.Buf8(2*q.w_size),q.head=new i.Buf16(q.hash_size),q.prev=new i.Buf16(q.w_size),q.lit_bufsize=1<<w+6,q.pending_buf_size=4*q.lit_bufsize,q.pending_buf=new i.Buf8(q.pending_buf_size),q.d_buf=1*q.lit_bufsize,q.l_buf=3*q.lit_bufsize,q.level=H,q.strategy=T,q.method=$,Je(l)}t=[new _e(0,0,0,0,function(l,H){var $=65535;for($>l.pending_buf_size-5&&($=l.pending_buf_size-5);;){if(l.lookahead<=1){if(Te(l),l.lookahead===0&&H===y)return f;if(l.lookahead===0)break}l.strstart+=l.lookahead,l.lookahead=0;var _=l.block_start+$;if((l.strstart===0||l.strstart>=_)&&(l.lookahead=l.strstart-_,l.strstart=_,M(l,!1),l.strm.avail_out===0)||l.strstart-l.block_start>=l.w_size-Q&&(M(l,!1),l.strm.avail_out===0))return f}return l.insert=0,H===m?(M(l,!0),l.strm.avail_out===0?ue:Z):(l.strstart>l.block_start&&(M(l,!1),l.strm.avail_out),f)}),new _e(4,4,8,4,Ne),new _e(4,5,16,8,Ne),new _e(4,6,32,32,Ne),new _e(4,4,16,16,ve),new _e(8,16,32,32,ve),new _e(8,16,128,128,ve),new _e(8,32,128,256,ve),new _e(32,128,258,1024,ve),new _e(32,258,258,4096,ve)],r.deflateInit=function(l,H){return Ye(l,H,C,15,8,0)},r.deflateInit2=Ye,r.deflateReset=Je,r.deflateResetKeep=Be,r.deflateSetHeader=function(l,H){return l&&l.state?l.state.wrap!==2?b:(l.state.gzhead=H,u):b},r.deflate=function(l,H){var $,_,w,T;if(!l||!l.state||5<H||H<0)return l?fe(l,b):b;if(_=l.state,!l.output||!l.input&&l.avail_in!==0||_.status===666&&H!==m)return fe(l,l.avail_out===0?-5:b);if(_.strm=l,$=_.last_flush,_.last_flush=H,_.status===k)if(_.wrap===2)l.adler=0,re(_,31),re(_,139),re(_,8),_.gzhead?(re(_,(_.gzhead.text?1:0)+(_.gzhead.hcrc?2:0)+(_.gzhead.extra?4:0)+(_.gzhead.name?8:0)+(_.gzhead.comment?16:0)),re(_,255&_.gzhead.time),re(_,_.gzhead.time>>8&255),re(_,_.gzhead.time>>16&255),re(_,_.gzhead.time>>24&255),re(_,_.level===9?2:2<=_.strategy||_.level<2?4:0),re(_,255&_.gzhead.os),_.gzhead.extra&&_.gzhead.extra.length&&(re(_,255&_.gzhead.extra.length),re(_,_.gzhead.extra.length>>8&255)),_.gzhead.hcrc&&(l.adler=d(l.adler,_.pending_buf,_.pending,0)),_.gzindex=0,_.status=69):(re(_,0),re(_,0),re(_,0),re(_,0),re(_,0),re(_,_.level===9?2:2<=_.strategy||_.level<2?4:0),re(_,3),_.status=z);else{var j=C+(_.w_bits-8<<4)<<8;j|=(2<=_.strategy||_.level<2?0:_.level<6?1:_.level===6?2:3)<<6,_.strstart!==0&&(j|=32),j+=31-j%31,_.status=z,te(_,j),_.strstart!==0&&(te(_,l.adler>>>16),te(_,65535&l.adler)),l.adler=1}if(_.status===69)if(_.gzhead.extra){for(w=_.pending;_.gzindex<(65535&_.gzhead.extra.length)&&(_.pending!==_.pending_buf_size||(_.gzhead.hcrc&&_.pending>w&&(l.adler=d(l.adler,_.pending_buf,_.pending-w,w)),A(l),w=_.pending,_.pending!==_.pending_buf_size));)re(_,255&_.gzhead.extra[_.gzindex]),_.gzindex++;_.gzhead.hcrc&&_.pending>w&&(l.adler=d(l.adler,_.pending_buf,_.pending-w,w)),_.gzindex===_.gzhead.extra.length&&(_.gzindex=0,_.status=73)}else _.status=73;if(_.status===73)if(_.gzhead.name){w=_.pending;do{if(_.pending===_.pending_buf_size&&(_.gzhead.hcrc&&_.pending>w&&(l.adler=d(l.adler,_.pending_buf,_.pending-w,w)),A(l),w=_.pending,_.pending===_.pending_buf_size)){T=1;break}T=_.gzindex<_.gzhead.name.length?255&_.gzhead.name.charCodeAt(_.gzindex++):0,re(_,T)}while(T!==0);_.gzhead.hcrc&&_.pending>w&&(l.adler=d(l.adler,_.pending_buf,_.pending-w,w)),T===0&&(_.gzindex=0,_.status=91)}else _.status=91;if(_.status===91)if(_.gzhead.comment){w=_.pending;do{if(_.pending===_.pending_buf_size&&(_.gzhead.hcrc&&_.pending>w&&(l.adler=d(l.adler,_.pending_buf,_.pending-w,w)),A(l),w=_.pending,_.pending===_.pending_buf_size)){T=1;break}T=_.gzindex<_.gzhead.comment.length?255&_.gzhead.comment.charCodeAt(_.gzindex++):0,re(_,T)}while(T!==0);_.gzhead.hcrc&&_.pending>w&&(l.adler=d(l.adler,_.pending_buf,_.pending-w,w)),T===0&&(_.status=103)}else _.status=103;if(_.status===103&&(_.gzhead.hcrc?(_.pending+2>_.pending_buf_size&&A(l),_.pending+2<=_.pending_buf_size&&(re(_,255&l.adler),re(_,l.adler>>8&255),l.adler=0,_.status=z)):_.status=z),_.pending!==0){if(A(l),l.avail_out===0)return _.last_flush=-1,u}else if(l.avail_in===0&&F(H)<=F($)&&H!==m)return fe(l,-5);if(_.status===666&&l.avail_in!==0)return fe(l,-5);if(l.avail_in!==0||_.lookahead!==0||H!==y&&_.status!==666){var q=_.strategy===2?function(O,V){for(var se;;){if(O.lookahead===0&&(Te(O),O.lookahead===0)){if(V===y)return f;break}if(O.match_length=0,se=a._tr_tally(O,0,O.window[O.strstart]),O.lookahead--,O.strstart++,se&&(M(O,!1),O.strm.avail_out===0))return f}return O.insert=0,V===m?(M(O,!0),O.strm.avail_out===0?ue:Z):O.last_lit&&(M(O,!1),O.strm.avail_out===0)?f:W}(_,H):_.strategy===3?function(O,V){for(var se,J,le,he,ye=O.window;;){if(O.lookahead<=P){if(Te(O),O.lookahead<=P&&V===y)return f;if(O.lookahead===0)break}if(O.match_length=0,O.lookahead>=R&&0<O.strstart&&(J=ye[le=O.strstart-1])===ye[++le]&&J===ye[++le]&&J===ye[++le]){he=O.strstart+P;do;while(J===ye[++le]&&J===ye[++le]&&J===ye[++le]&&J===ye[++le]&&J===ye[++le]&&J===ye[++le]&&J===ye[++le]&&J===ye[++le]&&le<he);O.match_length=P-(he-le),O.match_length>O.lookahead&&(O.match_length=O.lookahead)}if(O.match_length>=R?(se=a._tr_tally(O,1,O.match_length-R),O.lookahead-=O.match_length,O.strstart+=O.match_length,O.match_length=0):(se=a._tr_tally(O,0,O.window[O.strstart]),O.lookahead--,O.strstart++),se&&(M(O,!1),O.strm.avail_out===0))return f}return O.insert=0,V===m?(M(O,!0),O.strm.avail_out===0?ue:Z):O.last_lit&&(M(O,!1),O.strm.avail_out===0)?f:W}(_,H):t[_.level].func(_,H);if(q!==ue&&q!==Z||(_.status=666),q===f||q===ue)return l.avail_out===0&&(_.last_flush=-1),u;if(q===W&&(H===1?a._tr_align(_):H!==5&&(a._tr_stored_block(_,0,0,!1),H===3&&(ne(_.head),_.lookahead===0&&(_.strstart=0,_.block_start=0,_.insert=0))),A(l),l.avail_out===0))return _.last_flush=-1,u}return H!==m?u:_.wrap<=0?1:(_.wrap===2?(re(_,255&l.adler),re(_,l.adler>>8&255),re(_,l.adler>>16&255),re(_,l.adler>>24&255),re(_,255&l.total_in),re(_,l.total_in>>8&255),re(_,l.total_in>>16&255),re(_,l.total_in>>24&255)):(te(_,l.adler>>>16),te(_,65535&l.adler)),A(l),0<_.wrap&&(_.wrap=-_.wrap),_.pending!==0?u:1)},r.deflateEnd=function(l){var H;return l&&l.state?(H=l.state.status)!==k&&H!==69&&H!==73&&H!==91&&H!==103&&H!==z&&H!==666?fe(l,b):(l.state=null,H===z?fe(l,-3):u):b},r.deflateSetDictionary=function(l,H){var $,_,w,T,j,q,O,V,se=H.length;if(!l||!l.state||(T=($=l.state).wrap)===2||T===1&&$.status!==k||$.lookahead)return b;for(T===1&&(l.adler=n(l.adler,H,se,0)),$.wrap=0,se>=$.w_size&&(T===0&&(ne($.head),$.strstart=0,$.block_start=0,$.insert=0),V=new i.Buf8($.w_size),i.arraySet(V,H,se-$.w_size,$.w_size,0),H=V,se=$.w_size),j=l.avail_in,q=l.next_in,O=l.input,l.avail_in=se,l.next_in=0,l.input=H,Te($);$.lookahead>=R;){for(_=$.strstart,w=$.lookahead-(R-1);$.ins_h=($.ins_h<<$.hash_shift^$.window[_+R-1])&$.hash_mask,$.prev[_&$.w_mask]=$.head[$.ins_h],$.head[$.ins_h]=_,_++,--w;);$.strstart=_,$.lookahead=R-1,Te($)}return $.strstart+=$.lookahead,$.block_start=$.strstart,$.insert=$.lookahead,$.lookahead=0,$.match_length=$.prev_length=R-1,$.match_available=0,l.next_in=q,l.input=O,l.avail_in=j,$.wrap=T,u},r.deflateInfo="pako deflate (from Nodeca project)"},{"../utils/common":41,"./adler32":43,"./crc32":45,"./messages":51,"./trees":52}],47:[function(e,c,r){c.exports=function(){this.text=0,this.time=0,this.xflags=0,this.os=0,this.extra=null,this.extra_len=0,this.name="",this.comment="",this.hcrc=0,this.done=!1}},{}],48:[function(e,c,r){c.exports=function(t,i){var a,n,d,p,y,m,u,b,h,v,g,C,E,S,I,x,L,D,R,P,Q,k,z,f,W;a=t.state,n=t.next_in,f=t.input,d=n+(t.avail_in-5),p=t.next_out,W=t.output,y=p-(i-t.avail_out),m=p+(t.avail_out-257),u=a.dmax,b=a.wsize,h=a.whave,v=a.wnext,g=a.window,C=a.hold,E=a.bits,S=a.lencode,I=a.distcode,x=(1<<a.lenbits)-1,L=(1<<a.distbits)-1;e:do{E<15&&(C+=f[n++]<<E,E+=8,C+=f[n++]<<E,E+=8),D=S[C&x];t:for(;;){if(C>>>=R=D>>>24,E-=R,(R=D>>>16&255)===0)W[p++]=65535&D;else{if(!(16&R)){if(!(64&R)){D=S[(65535&D)+(C&(1<<R)-1)];continue t}if(32&R){a.mode=12;break e}t.msg="invalid literal/length code",a.mode=30;break e}P=65535&D,(R&=15)&&(E<R&&(C+=f[n++]<<E,E+=8),P+=C&(1<<R)-1,C>>>=R,E-=R),E<15&&(C+=f[n++]<<E,E+=8,C+=f[n++]<<E,E+=8),D=I[C&L];n:for(;;){if(C>>>=R=D>>>24,E-=R,!(16&(R=D>>>16&255))){if(!(64&R)){D=I[(65535&D)+(C&(1<<R)-1)];continue n}t.msg="invalid distance code",a.mode=30;break e}if(Q=65535&D,E<(R&=15)&&(C+=f[n++]<<E,(E+=8)<R&&(C+=f[n++]<<E,E+=8)),u<(Q+=C&(1<<R)-1)){t.msg="invalid distance too far back",a.mode=30;break e}if(C>>>=R,E-=R,(R=p-y)<Q){if(h<(R=Q-R)&&a.sane){t.msg="invalid distance too far back",a.mode=30;break e}if(z=g,(k=0)===v){if(k+=b-R,R<P){for(P-=R;W[p++]=g[k++],--R;);k=p-Q,z=W}}else if(v<R){if(k+=b+v-R,(R-=v)<P){for(P-=R;W[p++]=g[k++],--R;);if(k=0,v<P){for(P-=R=v;W[p++]=g[k++],--R;);k=p-Q,z=W}}}else if(k+=v-R,R<P){for(P-=R;W[p++]=g[k++],--R;);k=p-Q,z=W}for(;2<P;)W[p++]=z[k++],W[p++]=z[k++],W[p++]=z[k++],P-=3;P&&(W[p++]=z[k++],1<P&&(W[p++]=z[k++]))}else{for(k=p-Q;W[p++]=W[k++],W[p++]=W[k++],W[p++]=W[k++],2<(P-=3););P&&(W[p++]=W[k++],1<P&&(W[p++]=W[k++]))}break}}break}}while(n<d&&p<m);n-=P=E>>3,C&=(1<<(E-=P<<3))-1,t.next_in=n,t.next_out=p,t.avail_in=n<d?d-n+5:5-(n-d),t.avail_out=p<m?m-p+257:257-(p-m),a.hold=C,a.bits=E}},{}],49:[function(e,c,r){var t=e("../utils/common"),i=e("./adler32"),a=e("./crc32"),n=e("./inffast"),d=e("./inftrees"),p=1,y=2,m=0,u=-2,b=1,h=852,v=592;function g(k){return(k>>>24&255)+(k>>>8&65280)+((65280&k)<<8)+((255&k)<<24)}function C(){this.mode=0,this.last=!1,this.wrap=0,this.havedict=!1,this.flags=0,this.dmax=0,this.check=0,this.total=0,this.head=null,this.wbits=0,this.wsize=0,this.whave=0,this.wnext=0,this.window=null,this.hold=0,this.bits=0,this.length=0,this.offset=0,this.extra=0,this.lencode=null,this.distcode=null,this.lenbits=0,this.distbits=0,this.ncode=0,this.nlen=0,this.ndist=0,this.have=0,this.next=null,this.lens=new t.Buf16(320),this.work=new t.Buf16(288),this.lendyn=null,this.distdyn=null,this.sane=0,this.back=0,this.was=0}function E(k){var z;return k&&k.state?(z=k.state,k.total_in=k.total_out=z.total=0,k.msg="",z.wrap&&(k.adler=1&z.wrap),z.mode=b,z.last=0,z.havedict=0,z.dmax=32768,z.head=null,z.hold=0,z.bits=0,z.lencode=z.lendyn=new t.Buf32(h),z.distcode=z.distdyn=new t.Buf32(v),z.sane=1,z.back=-1,m):u}function S(k){var z;return k&&k.state?((z=k.state).wsize=0,z.whave=0,z.wnext=0,E(k)):u}function I(k,z){var f,W;return k&&k.state?(W=k.state,z<0?(f=0,z=-z):(f=1+(z>>4),z<48&&(z&=15)),z&&(z<8||15<z)?u:(W.window!==null&&W.wbits!==z&&(W.window=null),W.wrap=f,W.wbits=z,S(k))):u}function x(k,z){var f,W;return k?(W=new C,(k.state=W).window=null,(f=I(k,z))!==m&&(k.state=null),f):u}var L,D,R=!0;function P(k){if(R){var z;for(L=new t.Buf32(512),D=new t.Buf32(32),z=0;z<144;)k.lens[z++]=8;for(;z<256;)k.lens[z++]=9;for(;z<280;)k.lens[z++]=7;for(;z<288;)k.lens[z++]=8;for(d(p,k.lens,0,288,L,0,k.work,{bits:9}),z=0;z<32;)k.lens[z++]=5;d(y,k.lens,0,32,D,0,k.work,{bits:5}),R=!1}k.lencode=L,k.lenbits=9,k.distcode=D,k.distbits=5}function Q(k,z,f,W){var ue,Z=k.state;return Z.window===null&&(Z.wsize=1<<Z.wbits,Z.wnext=0,Z.whave=0,Z.window=new t.Buf8(Z.wsize)),W>=Z.wsize?(t.arraySet(Z.window,z,f-Z.wsize,Z.wsize,0),Z.wnext=0,Z.whave=Z.wsize):(W<(ue=Z.wsize-Z.wnext)&&(ue=W),t.arraySet(Z.window,z,f-W,ue,Z.wnext),(W-=ue)?(t.arraySet(Z.window,z,f-W,W,0),Z.wnext=W,Z.whave=Z.wsize):(Z.wnext+=ue,Z.wnext===Z.wsize&&(Z.wnext=0),Z.whave<Z.wsize&&(Z.whave+=ue))),0}r.inflateReset=S,r.inflateReset2=I,r.inflateResetKeep=E,r.inflateInit=function(k){return x(k,15)},r.inflateInit2=x,r.inflate=function(k,z){var f,W,ue,Z,fe,F,ne,A,M,re,te,Y,Te,Ne,ve,_e,Ae,Be,Je,Ye,l,H,$,_,w=0,T=new t.Buf8(4),j=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15];if(!k||!k.state||!k.output||!k.input&&k.avail_in!==0)return u;(f=k.state).mode===12&&(f.mode=13),fe=k.next_out,ue=k.output,ne=k.avail_out,Z=k.next_in,W=k.input,F=k.avail_in,A=f.hold,M=f.bits,re=F,te=ne,H=m;e:for(;;)switch(f.mode){case b:if(f.wrap===0){f.mode=13;break}for(;M<16;){if(F===0)break e;F--,A+=W[Z++]<<M,M+=8}if(2&f.wrap&&A===35615){T[f.check=0]=255&A,T[1]=A>>>8&255,f.check=a(f.check,T,2,0),M=A=0,f.mode=2;break}if(f.flags=0,f.head&&(f.head.done=!1),!(1&f.wrap)||(((255&A)<<8)+(A>>8))%31){k.msg="incorrect header check",f.mode=30;break}if((15&A)!=8){k.msg="unknown compression method",f.mode=30;break}if(M-=4,l=8+(15&(A>>>=4)),f.wbits===0)f.wbits=l;else if(l>f.wbits){k.msg="invalid window size",f.mode=30;break}f.dmax=1<<l,k.adler=f.check=1,f.mode=512&A?10:12,M=A=0;break;case 2:for(;M<16;){if(F===0)break e;F--,A+=W[Z++]<<M,M+=8}if(f.flags=A,(255&f.flags)!=8){k.msg="unknown compression method",f.mode=30;break}if(57344&f.flags){k.msg="unknown header flags set",f.mode=30;break}f.head&&(f.head.text=A>>8&1),512&f.flags&&(T[0]=255&A,T[1]=A>>>8&255,f.check=a(f.check,T,2,0)),M=A=0,f.mode=3;case 3:for(;M<32;){if(F===0)break e;F--,A+=W[Z++]<<M,M+=8}f.head&&(f.head.time=A),512&f.flags&&(T[0]=255&A,T[1]=A>>>8&255,T[2]=A>>>16&255,T[3]=A>>>24&255,f.check=a(f.check,T,4,0)),M=A=0,f.mode=4;case 4:for(;M<16;){if(F===0)break e;F--,A+=W[Z++]<<M,M+=8}f.head&&(f.head.xflags=255&A,f.head.os=A>>8),512&f.flags&&(T[0]=255&A,T[1]=A>>>8&255,f.check=a(f.check,T,2,0)),M=A=0,f.mode=5;case 5:if(1024&f.flags){for(;M<16;){if(F===0)break e;F--,A+=W[Z++]<<M,M+=8}f.length=A,f.head&&(f.head.extra_len=A),512&f.flags&&(T[0]=255&A,T[1]=A>>>8&255,f.check=a(f.check,T,2,0)),M=A=0}else f.head&&(f.head.extra=null);f.mode=6;case 6:if(1024&f.flags&&(F<(Y=f.length)&&(Y=F),Y&&(f.head&&(l=f.head.extra_len-f.length,f.head.extra||(f.head.extra=new Array(f.head.extra_len)),t.arraySet(f.head.extra,W,Z,Y,l)),512&f.flags&&(f.check=a(f.check,W,Y,Z)),F-=Y,Z+=Y,f.length-=Y),f.length))break e;f.length=0,f.mode=7;case 7:if(2048&f.flags){if(F===0)break e;for(Y=0;l=W[Z+Y++],f.head&&l&&f.length<65536&&(f.head.name+=String.fromCharCode(l)),l&&Y<F;);if(512&f.flags&&(f.check=a(f.check,W,Y,Z)),F-=Y,Z+=Y,l)break e}else f.head&&(f.head.name=null);f.length=0,f.mode=8;case 8:if(4096&f.flags){if(F===0)break e;for(Y=0;l=W[Z+Y++],f.head&&l&&f.length<65536&&(f.head.comment+=String.fromCharCode(l)),l&&Y<F;);if(512&f.flags&&(f.check=a(f.check,W,Y,Z)),F-=Y,Z+=Y,l)break e}else f.head&&(f.head.comment=null);f.mode=9;case 9:if(512&f.flags){for(;M<16;){if(F===0)break e;F--,A+=W[Z++]<<M,M+=8}if(A!==(65535&f.check)){k.msg="header crc mismatch",f.mode=30;break}M=A=0}f.head&&(f.head.hcrc=f.flags>>9&1,f.head.done=!0),k.adler=f.check=0,f.mode=12;break;case 10:for(;M<32;){if(F===0)break e;F--,A+=W[Z++]<<M,M+=8}k.adler=f.check=g(A),M=A=0,f.mode=11;case 11:if(f.havedict===0)return k.next_out=fe,k.avail_out=ne,k.next_in=Z,k.avail_in=F,f.hold=A,f.bits=M,2;k.adler=f.check=1,f.mode=12;case 12:if(z===5||z===6)break e;case 13:if(f.last){A>>>=7&M,M-=7&M,f.mode=27;break}for(;M<3;){if(F===0)break e;F--,A+=W[Z++]<<M,M+=8}switch(f.last=1&A,M-=1,3&(A>>>=1)){case 0:f.mode=14;break;case 1:if(P(f),f.mode=20,z!==6)break;A>>>=2,M-=2;break e;case 2:f.mode=17;break;case 3:k.msg="invalid block type",f.mode=30}A>>>=2,M-=2;break;case 14:for(A>>>=7&M,M-=7&M;M<32;){if(F===0)break e;F--,A+=W[Z++]<<M,M+=8}if((65535&A)!=(A>>>16^65535)){k.msg="invalid stored block lengths",f.mode=30;break}if(f.length=65535&A,M=A=0,f.mode=15,z===6)break e;case 15:f.mode=16;case 16:if(Y=f.length){if(F<Y&&(Y=F),ne<Y&&(Y=ne),Y===0)break e;t.arraySet(ue,W,Z,Y,fe),F-=Y,Z+=Y,ne-=Y,fe+=Y,f.length-=Y;break}f.mode=12;break;case 17:for(;M<14;){if(F===0)break e;F--,A+=W[Z++]<<M,M+=8}if(f.nlen=257+(31&A),A>>>=5,M-=5,f.ndist=1+(31&A),A>>>=5,M-=5,f.ncode=4+(15&A),A>>>=4,M-=4,286<f.nlen||30<f.ndist){k.msg="too many length or distance symbols",f.mode=30;break}f.have=0,f.mode=18;case 18:for(;f.have<f.ncode;){for(;M<3;){if(F===0)break e;F--,A+=W[Z++]<<M,M+=8}f.lens[j[f.have++]]=7&A,A>>>=3,M-=3}for(;f.have<19;)f.lens[j[f.have++]]=0;if(f.lencode=f.lendyn,f.lenbits=7,$={bits:f.lenbits},H=d(0,f.lens,0,19,f.lencode,0,f.work,$),f.lenbits=$.bits,H){k.msg="invalid code lengths set",f.mode=30;break}f.have=0,f.mode=19;case 19:for(;f.have<f.nlen+f.ndist;){for(;_e=(w=f.lencode[A&(1<<f.lenbits)-1])>>>16&255,Ae=65535&w,!((ve=w>>>24)<=M);){if(F===0)break e;F--,A+=W[Z++]<<M,M+=8}if(Ae<16)A>>>=ve,M-=ve,f.lens[f.have++]=Ae;else{if(Ae===16){for(_=ve+2;M<_;){if(F===0)break e;F--,A+=W[Z++]<<M,M+=8}if(A>>>=ve,M-=ve,f.have===0){k.msg="invalid bit length repeat",f.mode=30;break}l=f.lens[f.have-1],Y=3+(3&A),A>>>=2,M-=2}else if(Ae===17){for(_=ve+3;M<_;){if(F===0)break e;F--,A+=W[Z++]<<M,M+=8}M-=ve,l=0,Y=3+(7&(A>>>=ve)),A>>>=3,M-=3}else{for(_=ve+7;M<_;){if(F===0)break e;F--,A+=W[Z++]<<M,M+=8}M-=ve,l=0,Y=11+(127&(A>>>=ve)),A>>>=7,M-=7}if(f.have+Y>f.nlen+f.ndist){k.msg="invalid bit length repeat",f.mode=30;break}for(;Y--;)f.lens[f.have++]=l}}if(f.mode===30)break;if(f.lens[256]===0){k.msg="invalid code -- missing end-of-block",f.mode=30;break}if(f.lenbits=9,$={bits:f.lenbits},H=d(p,f.lens,0,f.nlen,f.lencode,0,f.work,$),f.lenbits=$.bits,H){k.msg="invalid literal/lengths set",f.mode=30;break}if(f.distbits=6,f.distcode=f.distdyn,$={bits:f.distbits},H=d(y,f.lens,f.nlen,f.ndist,f.distcode,0,f.work,$),f.distbits=$.bits,H){k.msg="invalid distances set",f.mode=30;break}if(f.mode=20,z===6)break e;case 20:f.mode=21;case 21:if(6<=F&&258<=ne){k.next_out=fe,k.avail_out=ne,k.next_in=Z,k.avail_in=F,f.hold=A,f.bits=M,n(k,te),fe=k.next_out,ue=k.output,ne=k.avail_out,Z=k.next_in,W=k.input,F=k.avail_in,A=f.hold,M=f.bits,f.mode===12&&(f.back=-1);break}for(f.back=0;_e=(w=f.lencode[A&(1<<f.lenbits)-1])>>>16&255,Ae=65535&w,!((ve=w>>>24)<=M);){if(F===0)break e;F--,A+=W[Z++]<<M,M+=8}if(_e&&!(240&_e)){for(Be=ve,Je=_e,Ye=Ae;_e=(w=f.lencode[Ye+((A&(1<<Be+Je)-1)>>Be)])>>>16&255,Ae=65535&w,!(Be+(ve=w>>>24)<=M);){if(F===0)break e;F--,A+=W[Z++]<<M,M+=8}A>>>=Be,M-=Be,f.back+=Be}if(A>>>=ve,M-=ve,f.back+=ve,f.length=Ae,_e===0){f.mode=26;break}if(32&_e){f.back=-1,f.mode=12;break}if(64&_e){k.msg="invalid literal/length code",f.mode=30;break}f.extra=15&_e,f.mode=22;case 22:if(f.extra){for(_=f.extra;M<_;){if(F===0)break e;F--,A+=W[Z++]<<M,M+=8}f.length+=A&(1<<f.extra)-1,A>>>=f.extra,M-=f.extra,f.back+=f.extra}f.was=f.length,f.mode=23;case 23:for(;_e=(w=f.distcode[A&(1<<f.distbits)-1])>>>16&255,Ae=65535&w,!((ve=w>>>24)<=M);){if(F===0)break e;F--,A+=W[Z++]<<M,M+=8}if(!(240&_e)){for(Be=ve,Je=_e,Ye=Ae;_e=(w=f.distcode[Ye+((A&(1<<Be+Je)-1)>>Be)])>>>16&255,Ae=65535&w,!(Be+(ve=w>>>24)<=M);){if(F===0)break e;F--,A+=W[Z++]<<M,M+=8}A>>>=Be,M-=Be,f.back+=Be}if(A>>>=ve,M-=ve,f.back+=ve,64&_e){k.msg="invalid distance code",f.mode=30;break}f.offset=Ae,f.extra=15&_e,f.mode=24;case 24:if(f.extra){for(_=f.extra;M<_;){if(F===0)break e;F--,A+=W[Z++]<<M,M+=8}f.offset+=A&(1<<f.extra)-1,A>>>=f.extra,M-=f.extra,f.back+=f.extra}if(f.offset>f.dmax){k.msg="invalid distance too far back",f.mode=30;break}f.mode=25;case 25:if(ne===0)break e;if(Y=te-ne,f.offset>Y){if((Y=f.offset-Y)>f.whave&&f.sane){k.msg="invalid distance too far back",f.mode=30;break}Te=Y>f.wnext?(Y-=f.wnext,f.wsize-Y):f.wnext-Y,Y>f.length&&(Y=f.length),Ne=f.window}else Ne=ue,Te=fe-f.offset,Y=f.length;for(ne<Y&&(Y=ne),ne-=Y,f.length-=Y;ue[fe++]=Ne[Te++],--Y;);f.length===0&&(f.mode=21);break;case 26:if(ne===0)break e;ue[fe++]=f.length,ne--,f.mode=21;break;case 27:if(f.wrap){for(;M<32;){if(F===0)break e;F--,A|=W[Z++]<<M,M+=8}if(te-=ne,k.total_out+=te,f.total+=te,te&&(k.adler=f.check=f.flags?a(f.check,ue,te,fe-te):i(f.check,ue,te,fe-te)),te=ne,(f.flags?A:g(A))!==f.check){k.msg="incorrect data check",f.mode=30;break}M=A=0}f.mode=28;case 28:if(f.wrap&&f.flags){for(;M<32;){if(F===0)break e;F--,A+=W[Z++]<<M,M+=8}if(A!==(4294967295&f.total)){k.msg="incorrect length check",f.mode=30;break}M=A=0}f.mode=29;case 29:H=1;break e;case 30:H=-3;break e;case 31:return-4;case 32:default:return u}return k.next_out=fe,k.avail_out=ne,k.next_in=Z,k.avail_in=F,f.hold=A,f.bits=M,(f.wsize||te!==k.avail_out&&f.mode<30&&(f.mode<27||z!==4))&&Q(k,k.output,k.next_out,te-k.avail_out)?(f.mode=31,-4):(re-=k.avail_in,te-=k.avail_out,k.total_in+=re,k.total_out+=te,f.total+=te,f.wrap&&te&&(k.adler=f.check=f.flags?a(f.check,ue,te,k.next_out-te):i(f.check,ue,te,k.next_out-te)),k.data_type=f.bits+(f.last?64:0)+(f.mode===12?128:0)+(f.mode===20||f.mode===15?256:0),(re==0&&te===0||z===4)&&H===m&&(H=-5),H)},r.inflateEnd=function(k){if(!k||!k.state)return u;var z=k.state;return z.window&&(z.window=null),k.state=null,m},r.inflateGetHeader=function(k,z){var f;return k&&k.state&&2&(f=k.state).wrap?((f.head=z).done=!1,m):u},r.inflateSetDictionary=function(k,z){var f,W=z.length;return k&&k.state?(f=k.state).wrap!==0&&f.mode!==11?u:f.mode===11&&i(1,z,W,0)!==f.check?-3:Q(k,z,W,W)?(f.mode=31,-4):(f.havedict=1,m):u},r.inflateInfo="pako inflate (from Nodeca project)"},{"../utils/common":41,"./adler32":43,"./crc32":45,"./inffast":48,"./inftrees":50}],50:[function(e,c,r){var t=e("../utils/common"),i=[3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0],a=[16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78],n=[1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0],d=[16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64];c.exports=function(p,y,m,u,b,h,v,g){var C,E,S,I,x,L,D,R,P,Q=g.bits,k=0,z=0,f=0,W=0,ue=0,Z=0,fe=0,F=0,ne=0,A=0,M=null,re=0,te=new t.Buf16(16),Y=new t.Buf16(16),Te=null,Ne=0;for(k=0;k<=15;k++)te[k]=0;for(z=0;z<u;z++)te[y[m+z]]++;for(ue=Q,W=15;1<=W&&te[W]===0;W--);if(W<ue&&(ue=W),W===0)return b[h++]=20971520,b[h++]=20971520,g.bits=1,0;for(f=1;f<W&&te[f]===0;f++);for(ue<f&&(ue=f),k=F=1;k<=15;k++)if(F<<=1,(F-=te[k])<0)return-1;if(0<F&&(p===0||W!==1))return-1;for(Y[1]=0,k=1;k<15;k++)Y[k+1]=Y[k]+te[k];for(z=0;z<u;z++)y[m+z]!==0&&(v[Y[y[m+z]]++]=z);if(L=p===0?(M=Te=v,19):p===1?(M=i,re-=257,Te=a,Ne-=257,256):(M=n,Te=d,-1),k=f,x=h,fe=z=A=0,S=-1,I=(ne=1<<(Z=ue))-1,p===1&&852<ne||p===2&&592<ne)return 1;for(;;){for(D=k-fe,P=v[z]<L?(R=0,v[z]):v[z]>L?(R=Te[Ne+v[z]],M[re+v[z]]):(R=96,0),C=1<<k-fe,f=E=1<<Z;b[x+(A>>fe)+(E-=C)]=D<<24|R<<16|P|0,E!==0;);for(C=1<<k-1;A&C;)C>>=1;if(C!==0?(A&=C-1,A+=C):A=0,z++,--te[k]==0){if(k===W)break;k=y[m+v[z]]}if(ue<k&&(A&I)!==S){for(fe===0&&(fe=ue),x+=f,F=1<<(Z=k-fe);Z+fe<W&&!((F-=te[Z+fe])<=0);)Z++,F<<=1;if(ne+=1<<Z,p===1&&852<ne||p===2&&592<ne)return 1;b[S=A&I]=ue<<24|Z<<16|x-h|0}}return A!==0&&(b[x+A]=k-fe<<24|64<<16|0),g.bits=ue,0}},{"../utils/common":41}],51:[function(e,c,r){c.exports={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"}},{}],52:[function(e,c,r){var t=e("../utils/common"),i=0,a=1;function n(w){for(var T=w.length;0<=--T;)w[T]=0}var d=0,p=29,y=256,m=y+1+p,u=30,b=19,h=2*m+1,v=15,g=16,C=7,E=256,S=16,I=17,x=18,L=[0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0],D=[0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13],R=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,3,7],P=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15],Q=new Array(2*(m+2));n(Q);var k=new Array(2*u);n(k);var z=new Array(512);n(z);var f=new Array(256);n(f);var W=new Array(p);n(W);var ue,Z,fe,F=new Array(u);function ne(w,T,j,q,O){this.static_tree=w,this.extra_bits=T,this.extra_base=j,this.elems=q,this.max_length=O,this.has_stree=w&&w.length}function A(w,T){this.dyn_tree=w,this.max_code=0,this.stat_desc=T}function M(w){return w<256?z[w]:z[256+(w>>>7)]}function re(w,T){w.pending_buf[w.pending++]=255&T,w.pending_buf[w.pending++]=T>>>8&255}function te(w,T,j){w.bi_valid>g-j?(w.bi_buf|=T<<w.bi_valid&65535,re(w,w.bi_buf),w.bi_buf=T>>g-w.bi_valid,w.bi_valid+=j-g):(w.bi_buf|=T<<w.bi_valid&65535,w.bi_valid+=j)}function Y(w,T,j){te(w,j[2*T],j[2*T+1])}function Te(w,T){for(var j=0;j|=1&w,w>>>=1,j<<=1,0<--T;);return j>>>1}function Ne(w,T,j){var q,O,V=new Array(v+1),se=0;for(q=1;q<=v;q++)V[q]=se=se+j[q-1]<<1;for(O=0;O<=T;O++){var J=w[2*O+1];J!==0&&(w[2*O]=Te(V[J]++,J))}}function ve(w){var T;for(T=0;T<m;T++)w.dyn_ltree[2*T]=0;for(T=0;T<u;T++)w.dyn_dtree[2*T]=0;for(T=0;T<b;T++)w.bl_tree[2*T]=0;w.dyn_ltree[2*E]=1,w.opt_len=w.static_len=0,w.last_lit=w.matches=0}function _e(w){8<w.bi_valid?re(w,w.bi_buf):0<w.bi_valid&&(w.pending_buf[w.pending++]=w.bi_buf),w.bi_buf=0,w.bi_valid=0}function Ae(w,T,j,q){var O=2*T,V=2*j;return w[O]<w[V]||w[O]===w[V]&&q[T]<=q[j]}function Be(w,T,j){for(var q=w.heap[j],O=j<<1;O<=w.heap_len&&(O<w.heap_len&&Ae(T,w.heap[O+1],w.heap[O],w.depth)&&O++,!Ae(T,q,w.heap[O],w.depth));)w.heap[j]=w.heap[O],j=O,O<<=1;w.heap[j]=q}function Je(w,T,j){var q,O,V,se,J=0;if(w.last_lit!==0)for(;q=w.pending_buf[w.d_buf+2*J]<<8|w.pending_buf[w.d_buf+2*J+1],O=w.pending_buf[w.l_buf+J],J++,q===0?Y(w,O,T):(Y(w,(V=f[O])+y+1,T),(se=L[V])!==0&&te(w,O-=W[V],se),Y(w,V=M(--q),j),(se=D[V])!==0&&te(w,q-=F[V],se)),J<w.last_lit;);Y(w,E,T)}function Ye(w,T){var j,q,O,V=T.dyn_tree,se=T.stat_desc.static_tree,J=T.stat_desc.has_stree,le=T.stat_desc.elems,he=-1;for(w.heap_len=0,w.heap_max=h,j=0;j<le;j++)V[2*j]!==0?(w.heap[++w.heap_len]=he=j,w.depth[j]=0):V[2*j+1]=0;for(;w.heap_len<2;)V[2*(O=w.heap[++w.heap_len]=he<2?++he:0)]=1,w.depth[O]=0,w.opt_len--,J&&(w.static_len-=se[2*O+1]);for(T.max_code=he,j=w.heap_len>>1;1<=j;j--)Be(w,V,j);for(O=le;j=w.heap[1],w.heap[1]=w.heap[w.heap_len--],Be(w,V,1),q=w.heap[1],w.heap[--w.heap_max]=j,w.heap[--w.heap_max]=q,V[2*O]=V[2*j]+V[2*q],w.depth[O]=(w.depth[j]>=w.depth[q]?w.depth[j]:w.depth[q])+1,V[2*j+1]=V[2*q+1]=O,w.heap[1]=O++,Be(w,V,1),2<=w.heap_len;);w.heap[--w.heap_max]=w.heap[1],function(ye,qe){var ft,Ge,yt,De,kt,$t,et=qe.dyn_tree,cn=qe.max_code,dt=qe.stat_desc.static_tree,ln=qe.stat_desc.has_stree,Ft=qe.stat_desc.extra_bits,dn=qe.stat_desc.extra_base,mt=qe.stat_desc.max_length,St=0;for(De=0;De<=v;De++)ye.bl_count[De]=0;for(et[2*ye.heap[ye.heap_max]+1]=0,ft=ye.heap_max+1;ft<h;ft++)mt<(De=et[2*et[2*(Ge=ye.heap[ft])+1]+1]+1)&&(De=mt,St++),et[2*Ge+1]=De,cn<Ge||(ye.bl_count[De]++,kt=0,dn<=Ge&&(kt=Ft[Ge-dn]),$t=et[2*Ge],ye.opt_len+=$t*(De+kt),ln&&(ye.static_len+=$t*(dt[2*Ge+1]+kt)));if(St!==0){do{for(De=mt-1;ye.bl_count[De]===0;)De--;ye.bl_count[De]--,ye.bl_count[De+1]+=2,ye.bl_count[mt]--,St-=2}while(0<St);for(De=mt;De!==0;De--)for(Ge=ye.bl_count[De];Ge!==0;)cn<(yt=ye.heap[--ft])||(et[2*yt+1]!==De&&(ye.opt_len+=(De-et[2*yt+1])*et[2*yt],et[2*yt+1]=De),Ge--)}}(w,T),Ne(V,he,w.bl_count)}function l(w,T,j){var q,O,V=-1,se=T[1],J=0,le=7,he=4;for(se===0&&(le=138,he=3),T[2*(j+1)+1]=65535,q=0;q<=j;q++)O=se,se=T[2*(q+1)+1],++J<le&&O===se||(J<he?w.bl_tree[2*O]+=J:O!==0?(O!==V&&w.bl_tree[2*O]++,w.bl_tree[2*S]++):J<=10?w.bl_tree[2*I]++:w.bl_tree[2*x]++,V=O,he=(J=0)===se?(le=138,3):O===se?(le=6,3):(le=7,4))}function H(w,T,j){var q,O,V=-1,se=T[1],J=0,le=7,he=4;for(se===0&&(le=138,he=3),q=0;q<=j;q++)if(O=se,se=T[2*(q+1)+1],!(++J<le&&O===se)){if(J<he)for(;Y(w,O,w.bl_tree),--J!=0;);else O!==0?(O!==V&&(Y(w,O,w.bl_tree),J--),Y(w,S,w.bl_tree),te(w,J-3,2)):J<=10?(Y(w,I,w.bl_tree),te(w,J-3,3)):(Y(w,x,w.bl_tree),te(w,J-11,7));V=O,he=(J=0)===se?(le=138,3):O===se?(le=6,3):(le=7,4)}}n(F);var $=!1;function _(w,T,j,q){te(w,(d<<1)+(q?1:0),3),function(O,V,se,J){_e(O),re(O,se),re(O,~se),t.arraySet(O.pending_buf,O.window,V,se,O.pending),O.pending+=se}(w,T,j)}r._tr_init=function(w){$||(function(){var T,j,q,O,V,se=new Array(v+1);for(O=q=0;O<p-1;O++)for(W[O]=q,T=0;T<1<<L[O];T++)f[q++]=O;for(f[q-1]=O,O=V=0;O<16;O++)for(F[O]=V,T=0;T<1<<D[O];T++)z[V++]=O;for(V>>=7;O<u;O++)for(F[O]=V<<7,T=0;T<1<<D[O]-7;T++)z[256+V++]=O;for(j=0;j<=v;j++)se[j]=0;for(T=0;T<=143;)Q[2*T+1]=8,T++,se[8]++;for(;T<=255;)Q[2*T+1]=9,T++,se[9]++;for(;T<=279;)Q[2*T+1]=7,T++,se[7]++;for(;T<=287;)Q[2*T+1]=8,T++,se[8]++;for(Ne(Q,m+1,se),T=0;T<u;T++)k[2*T+1]=5,k[2*T]=Te(T,5);ue=new ne(Q,L,y+1,m,v),Z=new ne(k,D,0,u,v),fe=new ne(new Array(0),R,0,b,C)}(),$=!0),w.l_desc=new A(w.dyn_ltree,ue),w.d_desc=new A(w.dyn_dtree,Z),w.bl_desc=new A(w.bl_tree,fe),w.bi_buf=0,w.bi_valid=0,ve(w)},r._tr_stored_block=_,r._tr_flush_block=function(w,T,j,q){var O,V,se=0;0<w.level?(w.strm.data_type===2&&(w.strm.data_type=function(J){var le,he=4093624447;for(le=0;le<=31;le++,he>>>=1)if(1&he&&J.dyn_ltree[2*le]!==0)return i;if(J.dyn_ltree[18]!==0||J.dyn_ltree[20]!==0||J.dyn_ltree[26]!==0)return a;for(le=32;le<y;le++)if(J.dyn_ltree[2*le]!==0)return a;return i}(w)),Ye(w,w.l_desc),Ye(w,w.d_desc),se=function(J){var le;for(l(J,J.dyn_ltree,J.l_desc.max_code),l(J,J.dyn_dtree,J.d_desc.max_code),Ye(J,J.bl_desc),le=b-1;3<=le&&J.bl_tree[2*P[le]+1]===0;le--);return J.opt_len+=3*(le+1)+5+5+4,le}(w),O=w.opt_len+3+7>>>3,(V=w.static_len+3+7>>>3)<=O&&(O=V)):O=V=j+5,j+4<=O&&T!==-1?_(w,T,j,q):w.strategy===4||V===O?(te(w,2+(q?1:0),3),Je(w,Q,k)):(te(w,4+(q?1:0),3),function(J,le,he,ye){var qe;for(te(J,le-257,5),te(J,he-1,5),te(J,ye-4,4),qe=0;qe<ye;qe++)te(J,J.bl_tree[2*P[qe]+1],3);H(J,J.dyn_ltree,le-1),H(J,J.dyn_dtree,he-1)}(w,w.l_desc.max_code+1,w.d_desc.max_code+1,se+1),Je(w,w.dyn_ltree,w.dyn_dtree)),ve(w),q&&_e(w)},r._tr_tally=function(w,T,j){return w.pending_buf[w.d_buf+2*w.last_lit]=T>>>8&255,w.pending_buf[w.d_buf+2*w.last_lit+1]=255&T,w.pending_buf[w.l_buf+w.last_lit]=255&j,w.last_lit++,T===0?w.dyn_ltree[2*j]++:(w.matches++,T--,w.dyn_ltree[2*(f[j]+y+1)]++,w.dyn_dtree[2*M(T)]++),w.last_lit===w.lit_bufsize-1},r._tr_align=function(w){te(w,2,3),Y(w,E,Q),function(T){T.bi_valid===16?(re(T,T.bi_buf),T.bi_buf=0,T.bi_valid=0):8<=T.bi_valid&&(T.pending_buf[T.pending++]=255&T.bi_buf,T.bi_buf>>=8,T.bi_valid-=8)}(w)}},{"../utils/common":41}],53:[function(e,c,r){c.exports=function(){this.input=null,this.next_in=0,this.avail_in=0,this.total_in=0,this.output=null,this.next_out=0,this.avail_out=0,this.total_out=0,this.msg="",this.state=null,this.data_type=2,this.adler=0}},{}],54:[function(e,c,r){(function(t){(function(i,a){if(!i.setImmediate){var n,d,p,y,m=1,u={},b=!1,h=i.document,v=Object.getPrototypeOf&&Object.getPrototypeOf(i);v=v&&v.setTimeout?v:i,n={}.toString.call(i.process)==="[object process]"?function(S){process.nextTick(function(){C(S)})}:function(){if(i.postMessage&&!i.importScripts){var S=!0,I=i.onmessage;return i.onmessage=function(){S=!1},i.postMessage("","*"),i.onmessage=I,S}}()?(y="setImmediate$"+Math.random()+"$",i.addEventListener?i.addEventListener("message",E,!1):i.attachEvent("onmessage",E),function(S){i.postMessage(y+S,"*")}):i.MessageChannel?((p=new MessageChannel).port1.onmessage=function(S){C(S.data)},function(S){p.port2.postMessage(S)}):h&&"onreadystatechange"in h.createElement("script")?(d=h.documentElement,function(S){var I=h.createElement("script");I.onreadystatechange=function(){C(S),I.onreadystatechange=null,d.removeChild(I),I=null},d.appendChild(I)}):function(S){setTimeout(C,0,S)},v.setImmediate=function(S){typeof S!="function"&&(S=new Function(""+S));for(var I=new Array(arguments.length-1),x=0;x<I.length;x++)I[x]=arguments[x+1];var L={callback:S,args:I};return u[m]=L,n(m),m++},v.clearImmediate=g}function g(S){delete u[S]}function C(S){if(b)setTimeout(C,0,S);else{var I=u[S];if(I){b=!0;try{(function(x){var L=x.callback,D=x.args;switch(D.length){case 0:L();break;case 1:L(D[0]);break;case 2:L(D[0],D[1]);break;case 3:L(D[0],D[1],D[2]);break;default:L.apply(a,D)}})(I)}finally{g(S),b=!1}}}}function E(S){S.source===i&&typeof S.data=="string"&&S.data.indexOf(y)===0&&C(+S.data.slice(y.length))}})(typeof self>"u"?t===void 0?this:t:self)}).call(this,typeof mn<"u"?mn:typeof self<"u"?self:typeof window<"u"?window:{})},{}]},{},[10])(10)})})(Hs);var Ui=Hs.exports;const Us=Ws(Ui);var js={exports:{}};(function(s){var o=function(){var e=String.fromCharCode,c="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",r="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+-$",t={};function i(n,d){if(!t[n]){t[n]={};for(var p=0;p<n.length;p++)t[n][n.charAt(p)]=p}return t[n][d]}var a={compressToBase64:function(n){if(n==null)return"";var d=a._compress(n,6,function(p){return c.charAt(p)});switch(d.length%4){default:case 0:return d;case 1:return d+"===";case 2:return d+"==";case 3:return d+"="}},decompressFromBase64:function(n){return n==null?"":n==""?null:a._decompress(n.length,32,function(d){return i(c,n.charAt(d))})},compressToUTF16:function(n){return n==null?"":a._compress(n,15,function(d){return e(d+32)})+" "},decompressFromUTF16:function(n){return n==null?"":n==""?null:a._decompress(n.length,16384,function(d){return n.charCodeAt(d)-32})},compressToUint8Array:function(n){for(var d=a.compress(n),p=new Uint8Array(d.length*2),y=0,m=d.length;y<m;y++){var u=d.charCodeAt(y);p[y*2]=u>>>8,p[y*2+1]=u%256}return p},decompressFromUint8Array:function(n){if(n==null)return a.decompress(n);for(var d=new Array(n.length/2),p=0,y=d.length;p<y;p++)d[p]=n[p*2]*256+n[p*2+1];var m=[];return d.forEach(function(u){m.push(e(u))}),a.decompress(m.join(""))},compressToEncodedURIComponent:function(n){return n==null?"":a._compress(n,6,function(d){return r.charAt(d)})},decompressFromEncodedURIComponent:function(n){return n==null?"":n==""?null:(n=n.replace(/ /g,"+"),a._decompress(n.length,32,function(d){return i(r,n.charAt(d))}))},compress:function(n){return a._compress(n,16,function(d){return e(d)})},_compress:function(n,d,p){if(n==null)return"";var y,m,u={},b={},h="",v="",g="",C=2,E=3,S=2,I=[],x=0,L=0,D;for(D=0;D<n.length;D+=1)if(h=n.charAt(D),Object.prototype.hasOwnProperty.call(u,h)||(u[h]=E++,b[h]=!0),v=g+h,Object.prototype.hasOwnProperty.call(u,v))g=v;else{if(Object.prototype.hasOwnProperty.call(b,g)){if(g.charCodeAt(0)<256){for(y=0;y<S;y++)x=x<<1,L==d-1?(L=0,I.push(p(x)),x=0):L++;for(m=g.charCodeAt(0),y=0;y<8;y++)x=x<<1|m&1,L==d-1?(L=0,I.push(p(x)),x=0):L++,m=m>>1}else{for(m=1,y=0;y<S;y++)x=x<<1|m,L==d-1?(L=0,I.push(p(x)),x=0):L++,m=0;for(m=g.charCodeAt(0),y=0;y<16;y++)x=x<<1|m&1,L==d-1?(L=0,I.push(p(x)),x=0):L++,m=m>>1}C--,C==0&&(C=Math.pow(2,S),S++),delete b[g]}else for(m=u[g],y=0;y<S;y++)x=x<<1|m&1,L==d-1?(L=0,I.push(p(x)),x=0):L++,m=m>>1;C--,C==0&&(C=Math.pow(2,S),S++),u[v]=E++,g=String(h)}if(g!==""){if(Object.prototype.hasOwnProperty.call(b,g)){if(g.charCodeAt(0)<256){for(y=0;y<S;y++)x=x<<1,L==d-1?(L=0,I.push(p(x)),x=0):L++;for(m=g.charCodeAt(0),y=0;y<8;y++)x=x<<1|m&1,L==d-1?(L=0,I.push(p(x)),x=0):L++,m=m>>1}else{for(m=1,y=0;y<S;y++)x=x<<1|m,L==d-1?(L=0,I.push(p(x)),x=0):L++,m=0;for(m=g.charCodeAt(0),y=0;y<16;y++)x=x<<1|m&1,L==d-1?(L=0,I.push(p(x)),x=0):L++,m=m>>1}C--,C==0&&(C=Math.pow(2,S),S++),delete b[g]}else for(m=u[g],y=0;y<S;y++)x=x<<1|m&1,L==d-1?(L=0,I.push(p(x)),x=0):L++,m=m>>1;C--,C==0&&(C=Math.pow(2,S),S++)}for(m=2,y=0;y<S;y++)x=x<<1|m&1,L==d-1?(L=0,I.push(p(x)),x=0):L++,m=m>>1;for(;;)if(x=x<<1,L==d-1){I.push(p(x));break}else L++;return I.join("")},decompress:function(n){return n==null?"":n==""?null:a._decompress(n.length,32768,function(d){return n.charCodeAt(d)})},_decompress:function(n,d,p){var y=[],m=4,u=4,b=3,h="",v=[],g,C,E,S,I,x,L,D={val:p(0),position:d,index:1};for(g=0;g<3;g+=1)y[g]=g;for(E=0,I=Math.pow(2,2),x=1;x!=I;)S=D.val&D.position,D.position>>=1,D.position==0&&(D.position=d,D.val=p(D.index++)),E|=(S>0?1:0)*x,x<<=1;switch(E){case 0:for(E=0,I=Math.pow(2,8),x=1;x!=I;)S=D.val&D.position,D.position>>=1,D.position==0&&(D.position=d,D.val=p(D.index++)),E|=(S>0?1:0)*x,x<<=1;L=e(E);break;case 1:for(E=0,I=Math.pow(2,16),x=1;x!=I;)S=D.val&D.position,D.position>>=1,D.position==0&&(D.position=d,D.val=p(D.index++)),E|=(S>0?1:0)*x,x<<=1;L=e(E);break;case 2:return""}for(y[3]=L,C=L,v.push(L);;){if(D.index>n)return"";for(E=0,I=Math.pow(2,b),x=1;x!=I;)S=D.val&D.position,D.position>>=1,D.position==0&&(D.position=d,D.val=p(D.index++)),E|=(S>0?1:0)*x,x<<=1;switch(L=E){case 0:for(E=0,I=Math.pow(2,8),x=1;x!=I;)S=D.val&D.position,D.position>>=1,D.position==0&&(D.position=d,D.val=p(D.index++)),E|=(S>0?1:0)*x,x<<=1;y[u++]=e(E),L=u-1,m--;break;case 1:for(E=0,I=Math.pow(2,16),x=1;x!=I;)S=D.val&D.position,D.position>>=1,D.position==0&&(D.position=d,D.val=p(D.index++)),E|=(S>0?1:0)*x,x<<=1;y[u++]=e(E),L=u-1,m--;break;case 2:return v.join("")}if(m==0&&(m=Math.pow(2,b),b++),y[L])h=y[L];else if(L===u)h=C+C.charAt(0);else return null;v.push(h),y[u++]=C+h.charAt(0),m--,C=h,m==0&&(m=Math.pow(2,b),b++)}}};return a}();s!=null?s.exports=o:typeof angular<"u"&&angular!=null&&angular.module("LZString",[]).factory("LZString",function(){return o})})(js);var ji=js.exports;const Zs=Ws(ji);function Zi(s){return new Worker("/assets/compression.worker-B3kqe_bR.js",{name:s==null?void 0:s.name})}let oe={},N=null,ms=null,K=null,Ee=null,Qt=null,$n=null,hs=[],Sn=null,ps=null,Ve=null,In=0,gs=0,xn=0,ys=0,vs=null,bs=null,Ln=null,pt=null,Ue=-1,Cs=null,Tn=null,Bn=null,qs=null,Gs=null,ot=!1,pe=[],rt=[],_t=[],Ze={isScreenSaverEnabled:!0,lastRestoreTimestamp:null,lastBackupTimestamp:null},xt=null;const ws=new Zi;ws.onmessage=s=>{const o=s.data;try{localStorage.setItem("teacherAssistantData_v2",o),console.log("Background save complete.")}catch(e){console.error("Background storage failed:",e)}};ws.onerror=s=>{console.error("❌ Worker Communication Error:",s.message,s)};function ce(s=!1){if(ot)return;const e=JSON.stringify({classrooms:oe,trashBin:pe,userSettings:Ze});if(s){xt&&clearTimeout(xt);try{const c=Zs.compressToUTF16(e);localStorage.setItem("teacherAssistantData_v2",c),console.log("Immediate save complete.")}catch(c){console.error("Immediate save failed:",c)}return}xt&&clearTimeout(xt),xt=setTimeout(()=>{ws.postMessage(e),xt=null},500)}function qi(s){return new Promise((o,e)=>{const c=new FileReader;c.onerror=e,c.onload=()=>{o(c.result.split(",")[1])},c.readAsDataURL(s)})}async function Vs(s=[]){const o={};if(s.length>0)s.forEach(n=>{oe[n]&&(o[n]=oe[n])});else for(const n in oe)oe[n].isDeleted||(o[n]=oe[n]);const e={metadata:{version:"2.0-b64",createdAt:new Date().toISOString()},data:{classrooms:o,trashBin:pe}},c=JSON.stringify(e),r=new Date,t=new Intl.DateTimeFormat("fa-IR-u-nu-latn",{year:"numeric",month:"numeric",day:"numeric",hour:"2-digit",minute:"2-digit",hour12:!1}).formatToParts(r).reduce((n,d)=>(n[d.type]=d.value,n),{}),a=`SP_${t.year.slice(-2)}-${t.month}-${t.day}_${t.hour}-${t.minute}.txt`;try{const n=new Us;n.file("backup.json",c);const d=await n.generateAsync({type:"blob",compression:"DEFLATE",compressionOptions:{level:9}}),p=await qi(d);return new File([p],a,{type:"text/plain"})}catch(n){return console.error("Error creating base64 backup file:",n),null}}function Nn(){const s=localStorage.getItem("teacherAssistantData_v2");if(!s)return;let o;try{const e=Zs.decompressFromUTF16(s);e?o=JSON.parse(e):o=JSON.parse(s)}catch{console.log("Migration: Parsing legacy uncompressed data..."),o=JSON.parse(s)}o.classrooms!==void 0&&o.trashBin!==void 0?(Et(o.classrooms),pe=o.trashBin||[],Ze={...Ze,...o.userSettings}):(Et(o),Gi())}function Gi(){const s=[];Object.values(oe).forEach(o=>{o.isDeleted?s.push({id:`trash_${Date.now()}_${Math.random()}`,timestamp:o.info.creationDate,type:"classroom",description:`کلاس «${o.info.name}»`,restoreData:{name:o.info.name}}):o.students.forEach(e=>{e.isDeleted&&s.push({id:`trash_${Date.now()}_${Math.random()}`,timestamp:e.identity.studentId.split("_")[1],type:"student",description:`دانش‌آموز «${e.identity.name}»`,restoreData:{studentId:e.identity.studentId,classroomName:o.info.name}})})}),pe.length===0&&s.length>0&&(pe=s,console.log(`Migrated ${s.length} previously deleted item(s) to the new trash bin.`),ce())}function Ks(s){const o=new pn(s.identity);return o.isDeleted=s.isDeleted,o.statusCounters=s.statusCounters,o.logs=s.logs,o.logs.scores||(o.logs.scores={}),o.profile=s.profile,o.finalClassActivityScore=s.finalClassActivityScore,o.categoryCounts=s.categoryCounts||{},o.categoryIssues=s.categoryIssues||{},o.onboardingSession=s.onboardingSession||null,o}function Et(s){oe={};for(const o in s){const e=s[o];let c;e.info?c=e.info:c={...e,name:o};const r=new Gn(c);r.isDeleted=e.isDeleted,r.note=e.note||"",r.students=(e.students||[]).map(Ks),r.sessions=(e.sessions||[]).map(t=>{const i=new Ps(t.sessionNumber);i.isDeleted=t.isDeleted,i.note=t.note||"",i.startTime=new Date(t.startTime),i.endTime=t.endTime?new Date(t.endTime):null,i.isFinished=t.isFinished,i.isMakeup=t.isMakeup,i.isCancelled=t.isCancelled||!1,i.studentRecords=t.studentRecords;for(const n in i.studentRecords){const d=i.studentRecords[n];d.homework&&!(d.homework instanceof qn)&&(i.studentRecords[n].homework=new qn(d.homework.status,d.homework.comment))}i.lastWinnerByCategory=t.lastWinnerByCategory,i.lastUsedCategoryId=t.lastUsedCategoryId,i.lastSelectedWinnerId=t.lastSelectedWinnerId;const a=t.winnerHistory||[];return i.winnerHistory=a.filter(n=>n&&n.winner).map(n=>({winner:r.students.find(p=>p.identity.studentId===n.winner.identity.studentId),categoryName:n.categoryName})).filter(n=>n.winner),i}),r.categories=(e.categories||[]).map(t=>{const i=new ut(t.name,t.description,t.isGradedCategory);return i.id=t.id,i.isDeleted=t.isDeleted,i}),r.futurePlans=e.futurePlans,oe[o]=r}}function Js(s,o){if(o){const e=s.data.classrooms;for(let c in e){let r=c;const t=e[c];for(;oe[r];)r=`${r} (Restored)`;r!==c&&(t.info.name=r),oe[r]=t}if(s.data.trashBin){const c=[...pe,...s.data.trashBin],r=[...new Map(c.map(t=>[t.id,t])).values()];Rn(r)}Et(oe)}else Et(s.data.classrooms),Rn(s.data.trashBin||[]);Gt({lastRestoreTimestamp:new Date().toISOString()}),ce()}function Ys(s,o){if(oe[o])return{success:!1,message:"کلاسی با این نام از قبل وجود دارد."};const e=oe[s];return e?(e.info.name=o,oe[o]=e,delete oe[s],N===e&&Pe(e),{success:!0}):{success:!1,message:"کلاس مورد نظر یافت نشد."}}function Xs(s,o,e){const c=e.trim();if(!c)return{success:!1,message:"نام دسته‌بندی نمی‌تواند خالی باشد."};if(s.categories.some(n=>n.id!==o.id&&!n.isDeleted&&n.name.toLowerCase()===c.toLowerCase()))return{success:!1,message:"دسته‌بندی دیگری با این نام وجود دارد."};const t=o.name,i=t.toLowerCase(),a=c.toLowerCase();return o.name=c,s.students.forEach(n=>{n.categoryCounts&&n.categoryCounts[t]!==void 0&&(n.categoryCounts[c]=n.categoryCounts[t],delete n.categoryCounts[t]),n.categoryIssues&&n.categoryIssues[t]!==void 0&&(n.categoryIssues[c]=n.categoryIssues[t],delete n.categoryIssues[t]),n.logs.scores&&n.logs.scores[i]&&(n.logs.scores[i].forEach(d=>d.skill=c),i!==a&&(n.logs.scores[a]=n.logs.scores[i],delete n.logs.scores[i]))}),s.sessions.forEach(n=>{n.lastWinnerByCategory&&n.lastWinnerByCategory[t]&&(n.lastWinnerByCategory[c]=n.lastWinnerByCategory[t],delete n.lastWinnerByCategory[t]),n.winnerHistory&&n.winnerHistory.forEach(d=>{d.categoryName===t&&(d.categoryName=c)})}),{success:!0}}function Qs(s,o,e){if(Ie(e.students).some(d=>d.identity.name.toLowerCase()===s.identity.name.toLowerCase()))return{success:!1,message:`دانش‌آموزی با نام «${s.identity.name}» از قبل در کلاس «${e.info.name}» وجود دارد.`};const r=JSON.parse(JSON.stringify(s)),t=Ks(r),i=new Map;o.sessions.forEach(d=>{const p=d.studentRecords[s.identity.studentId];p&&i.set(d.sessionNumber,JSON.parse(JSON.stringify(p)))}),e.addStudent(t);try{const d=Ie(e.sessions).filter(v=>!v.isCancelled).sort((v,g)=>g.sessionNumber-v.sessionNumber),p=d.length>0?d[0]:null;let y="؟",m={type:"system",description:"Student Move"};p&&(y=Qe(e).get(p.sessionNumber)||p.sessionNumber,m={type:"fromSession",sessionNumber:p.sessionNumber});const u=new Date().toLocaleDateString("fa-IR"),b=o.info.name,h=`این دانش آموز در جلسه ${y} و در تاریخ ${u} از کلاس «${b}» به این کلاس انتقال پیدا کرد`;t.addNote(h,m)}catch(d){console.error("Failed to add automated move note:",d)}i.size>0&&e.sessions.forEach(d=>{const p=i.get(d.sessionNumber);p&&!d.isDeleted&&!d.isCancelled&&(d.studentRecords[t.identity.studentId]=p)});const a={id:`trash_${Date.now()}_${Math.random()}`,timestamp:new Date().toISOString(),type:"student",description:`(انتقال) دانش‌آموز «${s.identity.name}» از کلاس «${o.info.name}»`,restoreData:{studentId:s.identity.studentId,classId:o.info.scheduleCode}};pe.unshift(a),pe.length>50&&pe.pop();const n=o.students.find(d=>d.identity.studentId===s.identity.studentId);return n&&(n.isDeleted=!0),{success:!0}}function ei(){for(const s in oe){const o=oe[s];o.students.forEach(e=>{e.statusCounters={totalSelections:0,missedChances:0,earlyLeaves:0},e.categoryCounts={},e.categoryIssues={},o.sessions.forEach(c=>{const r=e.identity.studentId;c.studentRecords[r]&&(c.studentRecords[r].attendance="present")})})}ce()}function Ie(s){return Array.isArray(s)?s.filter(o=>!o.isDeleted):[]}function Qe(s){const o=new Map;return s&&Ie(s.sessions).filter(c=>!c.isCancelled).sort((c,r)=>c.sessionNumber-r.sessionNumber).forEach((c,r)=>{o.set(c.sessionNumber,r+1)}),o}function gt(s){Ue=s}function it(s){Cs=s}function Dn(s,o){if(!s||!o)return;const e=s.identity.studentId,c=o.students.findIndex(r=>r.identity.studentId===e);c>-1&&o.students.splice(c,1),o.sessions.forEach(r=>{r.studentRecords[e]&&delete r.studentRecords[e];for(const t in r.lastWinnerByCategory)r.lastWinnerByCategory[t]===e&&delete r.lastWinnerByCategory[t];r.lastSelectedWinnerId===e&&(r.lastSelectedWinnerId=null),r.winnerHistory=r.winnerHistory.filter(t=>t.winner&&t.winner.identity.studentId!==e)})}function ti(s,o){const e=oe[s];if(!e)return;const c=e.sessions.findIndex(r=>r.sessionNumber===o);c>-1&&(e.students.forEach(r=>{r.profile.notes&&r.profile.notes.length>0&&(r.profile.notes=r.profile.notes.filter(t=>!t.source||t.source.type!=="fromAttendance"||t.source.sessionNumber!==o)),r.onboardingSession===o&&(r.onboardingSession=null)}),e.sessions.splice(c,1))}function ni(s,o){const e=oe[s];if(!e)return;const c=e.categories.findIndex(a=>a.id===o);if(c===-1)return;const t=e.categories[c].name,i=t.toLowerCase();e.students.forEach(a=>{a.categoryCounts&&delete a.categoryCounts[t],a.categoryIssues&&delete a.categoryIssues[t],a.logs.scores&&delete a.logs.scores[i]}),e.sessions.forEach(a=>{a.lastWinnerByCategory[t]&&delete a.lastWinnerByCategory[t],a.winnerHistory=a.winnerHistory.filter(n=>n.categoryName!==t)}),e.categories.splice(c,1)}function si(s,o,e,c){const r=oe[s];if(!r)return;const t=r.students.find(n=>n.identity.studentId===o);if(!t||!t.logs.scores[e.toLowerCase()])return;const i=t.logs.scores[e.toLowerCase()],a=i.findIndex(n=>n.id===c);a>-1&&i.splice(a,1)}function ii(s,o,e){const c=oe[s];if(!c)return;const r=c.students.find(i=>i.identity.studentId===o);if(!r||!r.profile.notes)return;const t=r.profile.notes.findIndex(i=>i.id===e);t>-1&&r.profile.notes.splice(t,1)}function ai(){JSON.parse(JSON.stringify({classrooms:oe,trashBin:pe})),ot=!0}function ri(){ot=!1,Nn()}function Pe(s){N=s}function en(s){ms=s}function je(s){K=s}function Ke(s){Ee=s}function An(s){Qt=s}function oi(s){$n=s}function Ht(s){hs=s}function gn(s){Sn=s}function ci(s){ps=s}function On(s){Ve=s}function yn(s){In=s}function li(s){gs=s}function vn(s){xn=s}function di(s){ys=s}function _s(s){vs=s}function Es(s){bs=s}function tn(s){Ln=s}function ks(s){pt=s}function Mn(s){Bn=s}function ui(s){qs=s}function fi(s){Gs=s}function Rn(s){pe=s}function Fn(s){Tn=s}function nn(s){_t=s}function Gt(s){Ze={...Ze,...s},ce()}function Vn(s){rt=s}function Ss(){Ze.lastBackupTimestamp=new Date().toISOString(),ce()}const Vi=Object.freeze(Object.defineProperty({__proto__:null,get activeModal(){return pt},get cancelCallback(){return bs},get classrooms(){return oe},get confirmCallback(){return vs},get currentClassroom(){return N},get easterEggClickCount(){return In},get easterEggLastClickTime(){return gs},enterDemoMode:ai,exitDemoMode:ri,getActiveItems:Ie,getSessionDisplayMap:Qe,get importedFileContent(){return Sn},get isDemoMode(){return ot},get liveSession(){return ms},loadData:Nn,get manualSelection(){return Bn},moveStudent:Qs,get namesToImport(){return hs},get notificationTimeout(){return ps},permanentlyDeleteCategory:ni,permanentlyDeleteNote:ii,permanentlyDeleteScore:si,permanentlyDeleteSession:ti,permanentlyDeleteStudent:Dn,prepareBackupData:Vs,get previousState(){return Qt},processRestore:Js,rehydrateData:Et,renameCategory:Xs,renameClassroom:Ys,resetAllStudentCounters:ei,get resetEasterEggClickCount(){return xn},get resetEasterEggLastClickTime(){return ys},get saveCategoryCallback(){return Tn},saveData:ce,get saveNoteCallback(){return Cs},get secureConfirmCallback(){return Ln},get selectedCategory(){return Ve},get selectedClassIds(){return rt},get selectedSession(){return K},get selectedStudentForProfile(){return Ee},get selectedStudentsForMassComment(){return _t},setActiveModal:ks,setCancelCallback:Es,setConfirmCallback:_s,setCurrentClassroom:Pe,setEasterEggClickCount:yn,setEasterEggLastClickTime:li,setImportedFileContent:gn,setLastBackupTimestamp:Ss,setLiveSession:en,setManualSelection:Mn,setNamesToImport:Ht,setNotificationTimeout:ci,setPreviousState:An,setResetEasterEggClickCount:vn,setResetEasterEggLastClickTime:di,setSaveCategoryCallback:Fn,setSaveNoteCallback:it,setSecureConfirmCallback:tn,setSelectedCategory:On,setSelectedClassIds:Vn,setSelectedSession:je,setSelectedStudentForProfile:Ke,setSelectedStudentsForMassComment:nn,setSourceClassForMove:fi,setStudentToMove:ui,setTrashBin:Rn,setUndoTimeout:oi,setUserSettings:Gt,setWinnerHistoryIndex:gt,get sourceClassForMove(){return Gs},get studentToMove(){return qs},get trashBin(){return pe},get undoTimeout(){return $n},get userSettings(){return Ze},get winnerHistoryIndex(){return Ue}},Symbol.toStringTag,{value:"Module"}));function Xe(s){return typeof s!="string"?"":s.replace(/ي/g,"ی").replace(/ك/g,"ک").replace(/[\s\u200c]/g,"")}function Is(s){return typeof s!="string"||s.length===0?"ltr":/[\u0590-\u07FF]/.test(s)?"rtl":"ltr"}function mi(s){return!s||!s.trim()?"":s.split(`
`).map(c=>`<div dir="${Is(c)}">${c||"&nbsp;"}</div>`).join("")}function Zn(s){if(typeof s!="string")return"";const o={q:"ض",w:"ص",e:"ث",r:"ق",t:"ف",y:"غ",u:"ع",i:"ه",o:"خ",p:"ح","[":"ج","]":"چ",a:"ش",s:"س",d:"ی",f:"ب",g:"ل",h:"ا",j:"ت",k:"ن",l:"م",";":"ک","'":"گ",z:"ظ",x:"ط",c:"ز",v:"ر",b:"ذ",n:"د",m:"پ",",":"و"};let e="";for(let c=0;c<s.length;c++){const r=s[c].toLowerCase();e+=o[r]||s[c]}return e}const hi="teacherAssistantLogs_v2",Ki=100;function xs(){try{const s=localStorage.getItem(hi);return s?JSON.parse(s):{}}catch(s){return console.error("Error reading logs from localStorage:",s),{}}}function pi(s){try{localStorage.setItem(hi,JSON.stringify(s))}catch(o){console.error("Error saving logs to localStorage:",o)}}function Se(s,o,e=null){if(!s)return;const c=xs();c[s]||(c[s]=[]);const r={timestamp:new Date().toISOString(),message:o,action:e,classroomName:s};c[s].unshift(r),c[s].length>Ki&&c[s].pop(),pi(c)}function Ji(s){return xs()[s]||[]}function Yi(s,o){const e=xs();e[s]&&!e[o]&&(e[o]=e[s],delete e[s],pi(e))}const gi=document.getElementById("class-management-page"),Xi=document.getElementById("new-class-name"),Qi=document.getElementById("add-class-btn"),Nt=document.getElementById("class-list"),zn=document.getElementById("undo-toast"),yi=document.getElementById("undo-message"),ea=document.getElementById("undo-btn"),ta=document.getElementById("settings-page"),Ls=document.getElementById("settings-class-name-header"),Kn=document.getElementById("settings-student-list"),Jn=document.getElementById("category-list"),na=document.getElementById("back-to-sessions-btn"),sa=document.getElementById("new-student-name"),ia=document.getElementById("add-student-btn"),vi=document.getElementById("paste-area"),aa=document.getElementById("process-paste-btn"),ra=document.getElementById("csv-preview-page"),Yn=document.getElementById("csv-preview-list"),oa=document.getElementById("csv-confirm-btn"),ca=document.getElementById("csv-cancel-btn"),la=document.getElementById("import-csv-btn"),da=document.getElementById("csv-file-input"),ua=document.getElementById("column-mapping-page"),Xn=document.getElementById("column-select-dropdown"),fa=document.getElementById("confirm-column-btn"),ma=document.getElementById("cancel-import-btn"),ha=document.getElementById("new-category-name"),pa=document.getElementById("add-category-btn"),Qn=document.querySelector(".app-header"),nt=document.getElementById("select-student-btn"),Ot=document.getElementById("select-student-btn-wrapper"),ga=document.getElementById("attendance-page"),Vt=document.getElementById("attendance-list"),ya=document.getElementById("finish-attendance-btn"),va=document.querySelector("#class-management-page h2"),es=document.getElementById("student-stats-header"),ba=document.getElementById("hamburger-menu-btn"),Ca=document.getElementById("side-nav-menu"),wa=document.getElementById("close-nav-btn"),_a=document.getElementById("overlay"),Ea=document.getElementById("backup-data-btn"),ka=document.getElementById("restore-data-btn"),bi=document.getElementById("restore-file-input"),Sa=document.getElementById("custom-confirm-modal"),Ci=document.getElementById("confirm-modal-message"),ts=document.getElementById("confirm-modal-cancel-btn"),Ut=document.getElementById("confirm-modal-confirm-btn"),Ia=document.getElementById("secure-confirm-modal"),wi=document.getElementById("secure-confirm-message"),_i=document.getElementById("secure-confirm-code"),Lt=document.getElementById("secure-confirm-input"),xa=document.getElementById("secure-confirm-cancel-btn"),bn=document.getElementById("secure-confirm-confirm-btn"),La=document.getElementById("add-note-modal"),we=document.getElementById("new-note-content"),Ta=document.getElementById("class-save-note-btn"),Ba=document.getElementById("cancel-note-btn"),ns=document.getElementById("student-search-input"),ht=document.getElementById("student-search-results"),Na=document.getElementById("back-to-student-page-btn"),Da=document.getElementById("graded-category-pills-container"),Aa=document.getElementById("new-score-value"),Ei=document.getElementById("new-score-comment"),Oa=document.getElementById("add-score-btn"),Ma=document.getElementById("profile-stats-summary"),Ra=document.getElementById("profile-scores-list"),jt=document.getElementById("global-student-search-input"),at=document.getElementById("global-student-search-results"),za=document.getElementById("is-graded-checkbox"),$a=document.getElementById("trashed-classes-list"),Fa=document.getElementById("trashed-students-list"),Pa=document.getElementById("trashed-sessions-list"),Wa=document.getElementById("trashed-categories-list"),Ha=document.getElementById("trashed-notes-list"),Ua=document.getElementById("trashed-scores-list"),Bt=document.getElementById("quick-grade-form-wrapper"),ct=document.getElementById("quick-score-input"),tt=document.getElementById("quick-note-textarea"),Ct=document.getElementById("quick-grade-submit-btn"),Kt=document.getElementById("category-selection-container"),ss=document.getElementById("selected-student-result"),wt=document.getElementById("custom-context-menu"),Tt=document.getElementById("breadcrumb-container");let Wt=null,Dt=null;const ja=document.getElementById("category-modal"),ki=document.getElementById("category-modal-title"),Jt=document.getElementById("new-category-modal-name"),Ts=document.getElementById("new-category-modal-is-graded"),Za=document.getElementById("category-modal-cancel-btn"),Si=document.getElementById("category-modal-save-btn"),qa=document.getElementById("mass-comment-modal"),Ga=document.getElementById("mass-comment-modal-title"),Ii=document.getElementById("mass-comment-student-count-message"),Yt=document.getElementById("mass-comment-content"),Bs=document.getElementById("mass-comment-append-checkbox"),Va=document.getElementById("mass-comment-cancel-btn"),Ka=document.getElementById("mass-comment-save-btn"),is=document.getElementById("mass-comment-btn"),Cn=document.getElementById("attendance-mass-actions-container"),vt=document.createElement("input"),Ja=document.getElementById("session-dashboard-page"),Mt=document.getElementById("attendance-pane");function Zt(s,o){let e;const r=i=>{e=setTimeout(()=>{navigator.vibrate&&navigator.vibrate(50),o(i)},800)},t=()=>{clearTimeout(e)};s.addEventListener("touchstart",r,{passive:!0}),s.addEventListener("touchend",t),s.addEventListener("touchmove",t),s.addEventListener("mousedown",r),s.addEventListener("mouseup",t),s.addEventListener("mouseleave",t)}function Rt(s="selector"){if(!N||!K){ge("class-management-page");return}tr(),_n(),Re(),st(),ge("session-dashboard-page",{tab:s}),xi(),sn(s),nr()}function sn(s){const o=document.getElementById("selector-tab-btn"),e=document.getElementById("attendance-tab-btn"),c=document.getElementById("selector-pane"),r=s==="selector";o.classList.toggle("active",r),e.classList.toggle("active",!r),c.classList.toggle("active",r),Mt.classList.toggle("active",!r)}function xi(){const s=document.getElementById("selector-tab-btn"),o=document.getElementById("attendance-tab-btn"),e=document.getElementById("selector-pane");s.addEventListener("click",()=>{Re(),Me(),s.classList.add("active"),o.classList.remove("active"),e.classList.add("active"),Mt.classList.remove("active"),ge("session-dashboard-page",{tab:"selector"})}),o.addEventListener("click",()=>{st(),o.classList.add("active"),s.classList.remove("active"),Mt.classList.add("active"),e.classList.remove("active"),ge("session-dashboard-page",{tab:"attendance"})})}function Ya(s){clearTimeout($n),Qt||An(JSON.stringify(oe)),yi.textContent=s,zn.classList.add("show"),oi(setTimeout(()=>{zn.classList.remove("show"),An(null)},5e3))}function Li(){if(Qt){const s=N?N.info.name:null,o=JSON.parse(Qt);Et(o),s&&oe[s]?Pe(oe[s]):Pe(null),N?(lt(),zt(),He()):We(),zn.classList.remove("show"),clearTimeout($n),An(null)}}function ee(s,o=3e3){const e=document.getElementById("notification-toast");e&&(e.textContent=s,e.classList.add("show"),clearTimeout(ps),ci(setTimeout(()=>{e.classList.remove("show")},o)))}function as(s){const o=document.getElementById("restore-confirm-modal"),e=document.getElementById("restore-modal-message"),c=document.getElementById("restore-append-checkbox"),r=document.getElementById("restore-confirm-cancel-btn"),t=document.getElementById("restore-confirm-confirm-btn"),i=document.getElementById("restore-modal-warning");i.style.display="none";const a=s.metadata.createdAt;if(Ze.lastRestoreTimestamp&&a<Ze.lastRestoreTimestamp){const m=new Date(a).toLocaleDateString("fa-IR"),u=new Date(Ze.lastRestoreTimestamp).toLocaleDateString("fa-IR");i.textContent=`⚠️ هشدار: این فایل پشتیبان (${m}) قدیمی‌تر از آخرین بازیابی شما (${u}) است.`,i.style.display="block"}const n=Object.keys(s.data.classrooms).length,d="کلاس";e.textContent=`فایل پشتیبان شما حاوی ${n} ${d} است. لطفاً نحوه بازیابی را مشخص کنید.`,c.checked=!0;const p=()=>{const m=c.checked;Js(s,m),o.removeEventListener("click",p),ke(),We(),ge("class-management-page"),ee("✅ اطلاعات با موفقیت بازیابی شد.")},y=()=>{ke()};t.onclick=p,r.onclick=y,$e("restore-confirm-modal")}function Ce(s,o,e={}){const{confirmText:c="تایید",cancelText:r="لغو",confirmClass:t="btn-success",onCancel:i=()=>{},isDelete:a=!1}=e,n=a?()=>Ti(s,o):o;Ci.textContent=s,Ut.textContent=c,ts.textContent=r,Ut.className="modal-action-btn",Ut.classList.add(t),_s(n),Es(i);const d=Ut.parentElement;ts.style.display=i===null?"none":"inline-block",d.style.justifyContent=i===null?"center":"space-between",$e("custom-confirm-modal")}function Ti(s,o){const e=Math.floor(1e4+Math.random()*9e4).toString();wi.textContent=s,_i.textContent=e,Lt.value="",bn.disabled=!0,tn(o),$e("secure-confirm-modal"),Lt.focus();const c=()=>{Lt.value===e?bn.disabled=!1:bn.disabled=!0};return Lt.addEventListener("input",c),()=>{Lt.removeEventListener("input",c)}}function rs(s,o={}){const{title:e="ایجاد دسته‌بندی جدید",initialName:c="",initialIsGraded:r=!1,saveButtonText:t="ذخیره"}=o;ki.textContent=e,Jt.value=c,Ts.checked=r,Si.textContent=t,Fn((i,a)=>{if(!i){ee("⚠️ لطفاً نام دسته‌بندی را وارد کنید.");return}s(i,a),ke()}),$e("category-modal"),Jt.focus(),c&&Jt.select()}function Ns(s,o){const e=Object.values(oe).filter(i=>!i.isDeleted&&i.info.name!==o.info.name),c=document.getElementById("move-student-modal-title"),r=document.getElementById("move-student-class-select"),t=document.getElementById("move-student-confirm-btn");c.textContent=`انتقال دانش‌آموز: ${s.identity.name}`,r.innerHTML="",e.length===0?(r.innerHTML='<option value="">کلاس دیگری برای انتقال وجود ندارد</option>',t.disabled=!0):(e.forEach(i=>{const a=document.createElement("option");a.value=i.info.name,a.textContent=i.info.name,r.appendChild(a)}),t.disabled=!1),ui(s),fi(o),$e("move-student-modal")}function Ds(s,o){if(!s||!o)return;const e=s.identity.name,c=document.getElementById("add-note-modal-title");c.textContent="تغییر نام دانش‌آموز",we.value=e,we.rows=1,we.dispatchEvent(new Event("input",{bubbles:!0})),it(r=>{const t=r.trim();t&&t!==e&&(Ie(o.students).some(a=>a.identity.studentId!==s.identity.studentId&&a.identity.name.toLowerCase()===t.toLowerCase())?ee("دانش‌آموزی با این نام از قبل در این کلاس وجود دارد."):(s.identity.name=t,Se(o.info.name,`نام دانش‌آموز «${e}» به «${t}» تغییر یافت.`,{type:"VIEW_STUDENT_PROFILE",studentId:s.identity.studentId}),ce(),lt(),Re(),st(),Me(),Ee&&Ee.identity.studentId===s.identity.studentId&&ze(s),ee(`✅نام دانش‌آموز به «${t}» تغییر یافت.`))),c.textContent="ثبت یادداشت جدید",we.rows=4}),$e("add-note-modal"),we.focus(),we.select()}function $e(s){const o=document.getElementById(s);if(o){if(pt)return;document.body.classList.add("modal-active"),o.classList.add("modal-visible"),ks(s),history.pushState(null,"",location.href)}}function ke(s,o=!1){if(!pt)return;const e=document.getElementById(pt),c=pt;ks(null),c==="student-profile-modal"&&Ke(null),o||history.back(),e&&(e.classList.add("modal-closing"),setTimeout(()=>{e.classList.remove("modal-visible"),e.classList.remove("modal-closing"),document.body.classList.remove("modal-active"),c==="custom-confirm-modal"&&(_s(null),Es(null)),c==="secure-confirm-modal"&&tn(null),c==="category-modal"&&Fn(null),c==="mass-comment-modal"&&(Yt.value=""),c==="add-note-modal"&&it(null),typeof s=="function"&&s()},300))}function As(){if(!Mt||!Mt.classList.contains("active")){Cn.style.display="none";return}const s=_t.length;s<1?Cn.style.display="none":Cn.style.display="block",is.disabled=s<1,is.textContent=`📝 ثبت یادداشت گروهی (${s} نفر)`}function Os(){const s=_t,o=s.length;let e=!1;o>0&&(e=s.some(r=>{var t;return(t=K.studentRecords[r])==null?void 0:t.homework.comment})),Ii.textContent=`یادداشت برای ${o} دانش‌آموز ثبت خواهد شد.`,Yt.value="",Yt.dispatchEvent(new Event("input",{bubbles:!0})),Bs.checked=!0;const c=document.querySelector("#mass-comment-modal .modal-options");c.style.display=e?"flex":"none",$e("mass-comment-modal"),Yt.focus()}function os(s,o){if(!N||!K)return;let e=0;const c=_t,r=K;c.forEach(t=>{const i=r.studentRecords[t];if(i&&i.homework){const a=i.homework.comment||"";let n=s;o&&a.length>0?n=a+`
---
`+s:n=s,i.homework.comment=n.trim();const d=N.students.find(p=>p.identity.studentId===t);d&&Xa(d,r,n.trim()),e++}}),nn([]),ce(),st(),Se(N.info.name,`${e} دانش‌آموز به صورت گروهی یادداشت تکلیف گرفتند.`,{type:"VIEW_SESSIONS"}),ee(`✅ یادداشت برای ${e} دانش‌آموز ثبت شد.`)}function Xa(s,o,e){const r=Qe(N).get(o.sessionNumber),t={type:"fromAttendance",sessionNumber:o.sessionNumber},i=`یادداشت مربوط به جلسه ${r}: `,a=s.profile.notes.find(n=>!n.isDeleted&&n.source&&n.source.type==="fromAttendance"&&n.source.sessionNumber===t.sessionNumber);a?e?(a.content=i+e,a.isDeleted=!1):a.isDeleted=!0:e&&s.addNote(i+e,t)}function Pn(s){we.value=s.note||"",it(o=>{s.note=o,ce(),Se(s.info.name,"یادداشت کلاس ذخیره شد.",{type:"VIEW_CLASS_NOTE"}),We(),ee("✅ یادداشت کلاس ذخیره شد.")}),$e("add-note-modal"),we.focus()}function Ms(s,o){we.value=s.note||"",we.dispatchEvent(new Event("input",{bubbles:!0})),it(e=>{s.note=e,ce(),Se(N.info.name,`یادداشت جلسه ${o} ذخیره شد.`,{type:"VIEW_SESSIONS"}),He(),ee("✅یادداشت جلسه ذخیره شد.")}),$e("add-note-modal"),we.focus()}function At(s){Pe(s),Ls.textContent=`تنظیمات کلاس: ${s.info.name}`,lt(),zt(),zi(),ge("settings-page")}function Bi(s){const o=document.getElementById("log-modal-title"),e=document.getElementById("log-list");o.textContent=`گزارش فعالیت‌های کلاس: ${s}`,e.innerHTML="";const c=Ji(s);c.length===0?e.innerHTML='<li class="no-content-message">هنوز فعالیتی برای این کلاس ثبت نشده است.</li>':c.forEach(r=>{const t=document.createElement("li");t.className="log-entry";const i=new Date(r.timestamp),a=`${i.toLocaleDateString("fa-IR")} - ${i.toLocaleTimeString("fa-IR",{hour:"2-digit",minute:"2-digit"})}`,n=document.createElement("span");n.className="log-timestamp",n.textContent=a;const d=document.createElement("span");d.className="log-message",d.textContent=r.message,r.action&&(d.classList.add("log-action-link"),d.dataset.action=JSON.stringify({...r.action,classroomName:r.classroomName})),t.appendChild(n),t.appendChild(d),e.appendChild(t)}),$e("log-modal")}document.getElementById("log-modal-close-btn").addEventListener("click",()=>{ke()});function cs(s){const o=URL.createObjectURL(s),e=document.createElement("a");e.href=o,e.download=s.name,document.body.appendChild(e),e.click(),document.body.removeChild(e),URL.revokeObjectURL(o),setTimeout(()=>{Ce("آیا فایل پشتیبان با موفقیت ذخیره شد؟",()=>{Ss(),Wn(),ee("✅ تاریخ پشتیبان ثبت شد.")},{confirmText:"بله، ذخیره شد",cancelText:"خیر",confirmClass:"btn-success"})},500)}async function an(s=[]){const o=await Vs(s);if(!o){ee("❌ خطا در ایجاد فایل پشتیبان.");return}("ontouchstart"in window||navigator.maxTouchPoints>0)&&navigator.share&&navigator.canShare&&navigator.canShare({files:[o]})?Ce("فایل پشتیبان شما آماده است. آیا مایل به اشتراک‌گذاری آن هستید؟",()=>{try{navigator.share({title:o.name,text:"فایل پشتیبان داده‌های برنامه",files:[o]}).then(()=>{Ce("آیا فایل پشتیبان با موفقیت ارسال/ذخیره شد؟",()=>{Ss(),Wn(),ee("✅ تاریخ پشتیبان ثبت شد.")},{confirmText:"بله",cancelText:"خیر",confirmClass:"btn-success"})})}catch(c){console.error("Error during sharing process:",c),cs(o),ee("⚠️خطا در فرآیند اشتراک‌گذاری. فایل در حال دانلود است.")}},{confirmText:"بله",cancelText:"خیر",confirmClass:"btn-success"}):(cs(o),ee("✅پشتیبان‌گیری با موفقیت انجام شد."))}function on(s,o){s.preventDefault(),bt(),Dt=s.target.closest("li"),Dt&&Dt.classList.add("context-menu-target"),setTimeout(()=>{const e=wt,c=e.querySelector("ul");c.innerHTML="",o.forEach(d=>{const p=document.createElement("li");d.isSeparator?p.className="separator":(p.innerHTML=`
                    <span class="icon">${d.icon||""}</span>
                    <span class="label">${d.label}</span>
                `,d.className&&p.classList.add(d.className),p.addEventListener("click",()=>{d.action(),bt()})),c.appendChild(p)}),e.classList.add("visible");const{offsetWidth:r,offsetHeight:t}=e,{innerHeight:i}=window,a=document.body.getBoundingClientRect();e.style.top=`${(i-t)/2}px`;const n=a.left+a.width/2;e.style.left=`${n-r/2}px`},50)}function bt(){wt.classList.contains("visible")&&wt.classList.remove("visible"),Dt&&(Dt.classList.remove("context-menu-target"),Dt=null)}function Ni(){var e;Tt.innerHTML="";const s=document.getElementById("header-settings-btn");if(!s)return;const o=[];if(o.push({label:"کلاس‌ها",handler:()=>{Pe(null),je(null),Ke(null),ge("class-management-page")}}),N){o.push({label:N.info.name,handler:()=>{je(null),Ke(null),He(),ge("session-page")}});const c=(e=document.querySelector(".page.active"))==null?void 0:e.id;if(c==="session-page"?s.style.visibility="visible":s.style.visibility="hidden",c==="settings-page")o.push({label:"تنظیمات"});else if(K){const t=Qe(N).get(K.sessionNumber)||` (#${K.sessionNumber})`;o.push({label:`جلسه ${t}`,handler:()=>{Ke(null),Rt("selector")}}),Ee?o.push({label:`پروفایل: ${Ee.identity.name}`}):c==="session-dashboard-page"&&(document.getElementById("attendance-tab-btn").classList.contains("active")?o.push({label:"حضور و غیاب"}):o.push({label:"انتخابگر"}))}}else s.style.visibility="hidden";if(o.length<=1){Tt.style.display="none";return}Tt.style.display="flex",o.forEach((c,r)=>{const t=document.createElement("a");if(t.textContent=c.label,t.className="breadcrumb-item",r===o.length-1||!c.handler?t.classList.add("active"):t.addEventListener("click",c.handler),Tt.appendChild(t),r<o.length-1){const i=document.createElement("span");i.className="breadcrumb-separator",i.textContent="/",Tt.appendChild(i)}})}function Fs(s,o,e){e.innerHTML="";const c=N.sessions.filter(r=>{var t;return!r.isDeleted&&!r.isCancelled&&((t=r.studentRecords[s.identity.studentId])==null?void 0:t.attendance)==="absent"}).map(r=>({number:o.get(r.sessionNumber),isMakeup:r.isMakeup})).filter(r=>r.number!==void 0);c.length>0?(e.appendChild(document.createTextNode("جلسات غایب: ")),c.forEach((r,t)=>{const i=document.createElement("span");i.textContent=r.number,r.isMakeup&&i.classList.add("makeup-absence"),e.appendChild(i),t<c.length-1&&e.appendChild(document.createTextNode("، "))})):e.textContent="جلسات غایب: بدون غیبت"}function wn(s,o,e,c={}){const{includePrefix:r=!0}=c;e.innerHTML="";const t=N.sessions.filter(i=>{if(i.isDeleted||i.isCancelled)return!1;const a=i.studentRecords[s.identity.studentId];return a&&a.homework&&(a.homework.status==="incomplete"||a.homework.status==="none")}).map(i=>({number:o.get(i.sessionNumber),status:i.studentRecords[s.identity.studentId].homework.status})).filter(i=>i.number!==void 0);t.length>0?(r&&e.appendChild(document.createTextNode("تکالیف ناقص: ")),t.forEach((i,a)=>{const n=document.createElement("span");n.textContent=i.number,i.status==="incomplete"&&n.classList.add("incomplete-homework"),e.appendChild(n),a<t.length-1&&e.appendChild(document.createTextNode("،"))})):r?e.textContent="تکالیف ناقص: ندارد":e.textContent="ندارد"}function Qa(s,o){var L,D,R;const e=document.createElement("li");e.className="attendance-list-item";const c=document.createElement("span");c.className="absence-info";const r=document.createElement("span");r.className="homework-info";const t=document.createElement("div");t.className="att-row-1";let i=!1;t.addEventListener("mousedown",()=>i=!1),t.addEventListener("touchstart",()=>i=!1,{passive:!0});const a=document.createElement("input");a.type="checkbox",a.className="mass-comment-checkbox",a.checked=_t.includes(s.identity.studentId),a.addEventListener("change",()=>{const P=s.identity.studentId,Q=_t;if(a.checked)Q.includes(P)||Q.push(P);else{const z=Q.indexOf(P);z>-1&&Q.splice(z,1)}As();const k=document.getElementById("attendance-list");Q.length===0&&k.classList.contains("selection-mode-active")&&k.classList.remove("selection-mode-active")});const n=document.createElement("span");n.className="student-name",n.textContent=s.identity.name,n.addEventListener("click",P=>{if(i){P.stopPropagation(),P.preventDefault(),i=!1;return}ze(s)}),Zt(t,P=>{i=!0;const Q=document.getElementById("attendance-list");Q.classList.contains("selection-mode-active")||Q.classList.add("selection-mode-active"),a.checked||(a.checked=!0,a.dispatchEvent(new Event("change")))}),t.appendChild(a),t.appendChild(n);const d=document.createElement("div");d.className="att-row-2";const p=document.createElement("button");let y=!1;p.addEventListener("mousedown",()=>y=!1),p.addEventListener("touchstart",()=>y=!1,{passive:!0});const m=((L=K.studentRecords[s.identity.studentId])==null?void 0:L.attendance)||"present",u=P=>{P==="present"?(p.textContent="حاضر",p.className="attendance-status-btn present active"):(p.textContent="غایب",p.className="attendance-status-btn absent active")};u(m),p.addEventListener("click",P=>{var z;if(y){P.stopPropagation();return}const k=(((z=K.studentRecords[s.identity.studentId])==null?void 0:z.attendance)||"present")==="present"?"absent":"present";K.setAttendance(s.identity.studentId,k),k==="absent"&&(K.studentRecords[s.identity.studentId].hadIssue=!1),ce(),u(k),Fs(s,o,c),Re(),$i()}),Zt(p,()=>{y=!0;const P=m==="present"?"absent":"present",Q=P==="present"?"حاضر":"غایب";Ce(`آیا مطمئن هستید که می‌خواهید وضعیت حضور تمام دانش‌آموزان را به «${Q}» تغییر دهید؟`,()=>{Ie(N.students).forEach(k=>{K.setAttendance(k.identity.studentId,P),P==="absent"&&(K.studentRecords[k.identity.studentId].hadIssue=!1)}),ce(),st(),ee(`✅ وضعیت تمام دانش‌آموزان به «${Q}» تغییر یافت.`)},{confirmText:"بله، اعمال کن",confirmClass:"btn-warning"})});const b=document.createElement("div");b.className="homework-controls";const h={none:"بدون تکلیف",complete:"تکلیف کامل",incomplete:"تکلیف ناقص"},v=document.createElement("button");let g=!1;v.addEventListener("mousedown",()=>g=!1),v.addEventListener("touchstart",()=>g=!1,{passive:!0});const C=((D=K.studentRecords[s.identity.studentId])==null?void 0:D.homework.status)||"none";v.className=`homework-status-btn ${C}`,v.title=h[C],v.addEventListener("click",P=>{if(g){P.stopPropagation();return}const Q=K.studentRecords[s.identity.studentId].homework,z={none:"incomplete",incomplete:"complete",complete:"none"}[Q.status];K.setHomeworkStatus(s.identity.studentId,z),ce(),v.className=`homework-status-btn ${z}`,v.title=h[z],wn(s,o,r)}),Zt(v,()=>{g=!0;const Q={none:"incomplete",incomplete:"complete",complete:"none"}[C],k=h[Q];Ce(`آیا از تغییر وضعیت تکلیف تمام دانش‌آموزان به «${k}» مطمئن هستید؟`,()=>{Ie(N.students).forEach(z=>{K.setHomeworkStatus(z.identity.studentId,Q)}),ce(),st(),ee(`✅ وضعیت تکلیف همه به «${k}» تغییر یافت.`)},{confirmText:"بله",confirmClass:"btn-warning"})});const E=document.createElement("button");let S=!1;E.addEventListener("mousedown",()=>S=!1),E.addEventListener("touchstart",()=>S=!1,{passive:!0}),E.className="btn-icon",E.innerHTML="📝",E.title="افزودن یادداشت برای تکلیف",((R=K.studentRecords[s.identity.studentId])==null?void 0:R.homework.comment)||(E.style.opacity="0.3"),E.addEventListener("click",P=>{if(S){P.stopPropagation();return}const Q=K.studentRecords[s.identity.studentId].homework;we.value=Q.comment||"",we.dispatchEvent(new Event("input",{bubbles:!0})),it(k=>{Q.comment=k;const z=Qe(N),f=z.get(K.sessionNumber),W={type:"fromAttendance",sessionNumber:K.sessionNumber},ue=`یادداشت مربوط به جلسه ${f}: `,Z=s.profile.notes.find(fe=>!fe.isDeleted&&fe.source&&fe.source.type==="fromAttendance"&&fe.source.sessionNumber===W.sessionNumber);Z?k?Z.content=ue+k:Z.isDeleted=!0:k&&s.addNote(ue+k,W),ce(),ee("✅یادداشت تکلیف ذخیره شد."),E.style.opacity=k?"1":"0.3",wn(s,z,r)}),$e("add-note-modal"),we.focus()}),Zt(E,()=>{S=!0,Ce("آیا می‌خواهید برای **تمام** دانش‌آموزان کلاس یادداشت تکلیف ثبت کنید؟",()=>{const P=Ie(N.students).map(Q=>Q.identity.studentId);nn(P),Os()},{confirmText:"بله",confirmClass:"btn-primary"})}),d.appendChild(p),b.appendChild(E),b.appendChild(v),d.appendChild(b);const x=document.createElement("div");return x.className="att-row-3",Fs(s,o,c),wn(s,o,r),x.appendChild(c),x.appendChild(r),e.appendChild(t),e.appendChild(d),e.appendChild(x),e}function er(){return Qe(N).get(K.sessionNumber)}function st(){if(!N||!K)return;Ie(N.students).forEach(r=>{K.initializeStudentRecord(r.identity.studentId)}),nn([]);const s=Qe(N);ur(),Vt.innerHTML="";const o=document.createElement("li");o.className="attendance-list-header",vt.id="attendance-search-input",vt.type="text",vt.className="inline-search-input",vt.placeholder="جستجو...",vt.value="";const e=document.createElement("div");e.className="student-search-container",e.appendChild(vt);const c=document.createElement("div");c.className="header-labels-container",c.innerHTML=`
    <span class="header-label">تکلیف</span>
    <span class="header-label">حضور</span>
`,o.appendChild(e),o.appendChild(c),Vt.appendChild(o),Ie(N.students).forEach(r=>{const t=Qa(r,s);Vt.appendChild(t)}),nn([]),As(),fr(),$i()}function Re(){const s=document.getElementById("student-stats-table-container");if(!s||(s.innerHTML="",!N))return;Ie(N.students).length,es.textContent="آمار عملکرد";const o=["نام"],e=["کل انتخاب ها","غیبت","خروج","فرصت ازدست‌رفته","مشکل","میانگین","نمره کلاسی (کانون)"],c=N.categories.filter(u=>u.isGradedCategory&&!u.isDeleted).map(u=>u.name),r=[...o,...c,...e],t=document.createElement("table");t.className="student-stats-table";const a=t.createTHead().insertRow();r.forEach((u,b)=>{const h=document.createElement("th");b===0?(h.innerHTML=`${u} <span style="opacity: 0.6;">🔗</span>`,h.title="ردیف‌های این ستون قابل کلیک هستند"):h.textContent=u,a.appendChild(h)});const n=t.createTBody(),d=Ie(N.students),p=u=>{let b=0;return N.sessions.forEach(h=>{if(h.isDeleted||h.isCancelled)return;const v=h.studentRecords[u.identity.studentId];v&&v.attendance==="absent"&&b++}),b};d.forEach(u=>{const b=n.insertRow();if(b.dataset.studentId=u.identity.studentId,K){const S=K.studentRecords[u.identity.studentId];S&&S.attendance==="absent"&&b.classList.add("absent-row-highlight")}const h=b.insertCell(),v=document.createElement("span");v.textContent=u.identity.name,v.className="student-name-link",v.addEventListener("click",()=>{ze(u)}),h.appendChild(v),c.forEach(S=>{var D;const I=b.insertCell();I.style.direction="ltr";const x=S.toLowerCase(),L=((D=u.logs.scores[x])==null?void 0:D.filter(R=>!R.isDeleted))||[];L.length>0?L.forEach((R,P)=>{const Q=document.createElement("span");Q.textContent=R.value+(R.comment?"'":""),Q.style.position="relative",R.comment&&(Q.dataset.tooltip=R.comment),I.appendChild(Q),P<L.length-1&&I.appendChild(document.createTextNode(","))}):I.textContent="",I.style.cursor="pointer",I.addEventListener("click",()=>{Me(u,S);const R=document.getElementById("category-selection-container");R&&R.scrollIntoView({behavior:"smooth",block:"center"})})}),b.insertCell().textContent=u.statusCounters.totalSelections||0,b.insertCell().textContent=p(u),b.insertCell().textContent=u.statusCounters.outOfClassCount||0,b.insertCell().textContent=u.statusCounters.missedChances||0;const g=Object.values(u.categoryIssues||{}).reduce((S,I)=>S+I,0);b.insertCell().textContent=g;const C=u.getOverallAverageScore();b.insertCell().textContent=C!==null?C:"-";const E=N.calculateFinalStudentScore(u);b.insertCell().textContent=E!==null?E:"-"}),Ie(N.students),es.setAttribute("data-student-count",d.length),s.appendChild(t);const y=s.querySelector(".student-stats-table"),m=y==null?void 0:y.querySelector("thead th:first-child");m&&m.addEventListener("click",()=>{y.classList.toggle("name-column-expanded")})}function Me(s=null,o=null){const e=document.getElementById("selected-student-result");e.innerHTML="",e.classList.remove("absent");let c,r;if(s&&o)c=s,r=o,Mn({student:s,categoryName:o}),gt(-1);else{if(Mn(null),!K||Ue<0||!K.winnerHistory[Ue])return;const F=K.winnerHistory[Ue];c=F.winner,r=F.categoryName}const t=document.querySelector(".current-winner-highlight");if(t&&t.classList.remove("current-winner-highlight"),c){const F=document.querySelector(`.student-stats-table tr[data-student-id="${c.identity.studentId}"]`);F&&F.classList.add("current-winner-highlight")}const i=N.categories.find(F=>F.name===r);if(i){On(i),Rs(i);const F=document.querySelectorAll("#category-selection-container .pill");F.forEach(A=>A.classList.remove("active"));const ne=Array.from(F).find(A=>A.textContent===r);ne&&ne.classList.add("active"),ls(i),ds(i.name)}const a=K.studentRecords[c.identity.studentId],n=(a==null?void 0:a.attendance)==="absent",d=document.createElement("div");d.className="winner-name-container";const p=document.createElement("button");p.className="btn-icon",p.innerHTML="˅",p.title="برنده قبلی";const y=!s;p.classList.toggle("is-disabled",!y||Ue<=0),p.addEventListener("click",()=>{p.classList.contains("is-disabled")?(p.classList.add("shake-animation"),setTimeout(()=>p.classList.remove("shake-animation"),200)):(gt(Ue-1),Me())});const m=document.createElement("div");m.className="winner-name",m.innerHTML=`✨ <strong>${c.identity.name}</strong>✨`,m.classList.add("heartbeat-animation"),n&&(m.style.textDecoration="line-through",m.style.opacity="0.6",m.style.color="var(--color-secondary)"),(a==null?void 0:a.hadIssue)&&!n&&(m.style.color="var(--color-warning)",m.title="این دانش‌آموز در انتخاب قبلی با مشکل مواجه شده بود"),(a==null?void 0:a.wasOutOfClass)&&!n&&(m.style.color="var(--color-strong-warning)",m.title="این دانش‌آموز در زمان انتخاب خارج از کلاس بود");const h=1e3,v=F=>{Wt=setTimeout(()=>{yr(c,r),Wt=null},h)},g=()=>{Wt&&(clearTimeout(Wt),Wt=null)};m.addEventListener("mousedown",v),m.addEventListener("mouseup",g),m.addEventListener("mouseout",g),m.addEventListener("touchstart",v),m.addEventListener("touchmove",g),m.addEventListener("touchend",g),m.addEventListener("touchcancel",g);const C=document.createElement("button");if(C.className="btn-icon",C.innerHTML="˄",C.title="برنده بعدی",C.classList.toggle("is-disabled",!y||Ue>=K.winnerHistory.length-1),C.addEventListener("click",()=>{C.classList.contains("is-disabled")?(C.classList.add("shake-animation"),setTimeout(()=>C.classList.remove("shake-animation"),200)):(gt(Ue+1),Me())}),d.appendChild(C),d.appendChild(m),c.onboardingSession===K.sessionNumber){const F=document.createElement("div");F.className="new-student-badge",F.textContent="دانش آموز جدید",d.appendChild(F)}d.appendChild(p),e.appendChild(d),nt.disabled=y&&!C.classList.contains("is-disabled");const E=document.createElement("div");E.className="status-button-container";const S=document.createElement("button");S.textContent="غایب",S.classList.add("status-button","absent-btn"),n&&S.classList.add("active");const I=document.createElement("button");I.textContent="مشکل",I.classList.add("status-button","issue-btn"),a!=null&&a.hadIssue&&I.classList.add("active");const x=document.createElement("button");x.textContent="خروج",x.classList.add("status-button","exit-btn"),a!=null&&a.wasOutOfClass&&x.classList.add("active");const L=document.createElement("button");L.textContent="پروفایل",L.className="status-button profile-btn",K.isFinished?S.disabled=!0:S.addEventListener("click",()=>{const F=S.classList.contains("active");x.classList.contains("active")&&(x.classList.remove("active"),a.wasOutOfClass=!1,c.statusCounters.outOfClassCount=Math.max(0,(c.statusCounters.outOfClassCount||0)-1),c.statusCounters.missedChances=Math.max(0,c.statusCounters.missedChances-1)),F?(S.classList.remove("active"),K.setAttendance(c.identity.studentId,"present"),c.statusCounters.missedChances=Math.max(0,c.statusCounters.missedChances-1),m.style.textDecoration="",m.style.opacity="",m.style.color=""):(I.classList.contains("active")&&(I.classList.remove("active"),a.hadIssue=!1,c.statusCounters.otherIssues=Math.max(0,c.statusCounters.otherIssues-1),c.statusCounters.missedChances=Math.max(0,c.statusCounters.missedChances-1)),S.classList.add("active"),K.setAttendance(c.identity.studentId,"absent"),c.statusCounters.missedChances++,m.style.textDecoration="line-through",m.style.opacity="0.6",m.style.color="var(--color-secondary)",m.title=""),Re(),setTimeout(()=>{Ue!==-1?Me():Me(c,r)},0),ce()}),K.isFinished?I.disabled=!0:I.addEventListener("click",()=>{const F=I.classList.contains("active");if(x.classList.contains("active")&&(x.classList.remove("active"),a.wasOutOfClass=!1,c.statusCounters.outOfClassCount=Math.max(0,(c.statusCounters.outOfClassCount||0)-1),c.statusCounters.missedChances=Math.max(0,c.statusCounters.missedChances-1)),F){I.classList.remove("active"),a.hadIssue=!1;const ne=Ve.name;c.categoryIssues[ne]&&(c.categoryIssues[ne]=Math.max(0,c.categoryIssues[ne]-1)),c.statusCounters.missedChances=Math.max(0,c.statusCounters.missedChances-1),m.style.color="",m.title=""}else{S.classList.contains("active")&&(S.classList.remove("active"),K.setAttendance(c.identity.studentId,"present"),c.statusCounters.missedChances=Math.max(0,c.statusCounters.missedChances-1)),I.classList.add("active"),a.hadIssue=!0;const ne=Ve.name;c.categoryIssues[ne]=(c.categoryIssues[ne]||0)+1,c.statusCounters.missedChances++,m.style.textDecoration="",m.style.opacity="",m.style.color="var(--color-warning)",m.title="این دانش‌آموز در انتخاب قبلی با مشکل مواجه شده بود"}Re(),setTimeout(()=>{Ue!==-1?Me():Me(c,r)},0),ce()}),K.isFinished?x.disabled=!0:x.addEventListener("click",()=>{if(x.classList.contains("active"))x.classList.remove("active"),a.wasOutOfClass=!1,c.statusCounters.outOfClassCount=Math.max(0,(c.statusCounters.outOfClassCount||0)-1),c.statusCounters.missedChances=Math.max(0,c.statusCounters.missedChances-1),m.style.color="",m.title="";else{if(S.classList.contains("active")&&(S.classList.remove("active"),K.setAttendance(c.identity.studentId,"present"),c.statusCounters.missedChances=Math.max(0,c.statusCounters.missedChances-1)),I.classList.contains("active")){I.classList.remove("active"),a.hadIssue=!1;const ne=Ve.name;c.categoryIssues[ne]&&(c.categoryIssues[ne]=Math.max(0,c.categoryIssues[ne]-1)),c.statusCounters.missedChances=Math.max(0,c.statusCounters.missedChances-1)}x.classList.add("active"),a.wasOutOfClass=!0,c.statusCounters.outOfClassCount=(c.statusCounters.outOfClassCount||0)+1,c.statusCounters.missedChances++,m.style.textDecoration="",m.style.opacity="",m.style.color="var(--color-strong-warning)",m.title="این دانش‌آموز در زمان انتخاب خارج از کلاس بود"}Re(),setTimeout(()=>{Ue!==-1?Me():Me(c,r)},0),ce()}),K.isFinished?L.disabled=!0:L.addEventListener("click",()=>{ze(c)}),E.appendChild(S),E.appendChild(x),E.appendChild(I),E.appendChild(L),e.appendChild(E);const D=document.createElement("div");D.className="student-details-container";const R=document.createElement("div");R.className="student-details-scores",R.innerHTML="<h4>آخرین نمرات</h4>";const P=document.createElement("ul");P.className="scores-list";const Q=N.categories.filter(F=>F.isGradedCategory&&!F.isDeleted);let k=!1;const z=c.logs.scores||{};Q.forEach(F=>{var Te;const ne=F.name,A=ne.toLowerCase(),M=document.createElement("li"),re=document.createElement("span");re.className="skill-name",re.textContent=`${ne}:`;const te=document.createElement("span");te.className="skill-scores";const Y=(Te=z[A])==null?void 0:Te.filter(Ne=>!Ne.isDeleted);Y&&Y.length>0?(k=!0,te.textContent=Y.slice(-3).map(Ne=>Ne.value+(Ne.comment?"'":"")).join(" , ")):te.textContent="none",M.appendChild(re),M.appendChild(te),P.appendChild(M)}),k||(P.innerHTML='<div class="no-content-message">هنوز نمره‌ای ثبت نشده است.</div>'),R.appendChild(P),D.appendChild(R);const f=document.createElement("div");f.className="student-details-notes";const W=document.createElement("div");W.className="history-section-header";const ue=document.createElement("h4");ue.textContent="یادداشت‌ها";const Z=document.createElement("button");Z.className="btn-icon",Z.innerHTML="📝",Z.title="افزودن یادداشت جدید",K.isFinished?Z.disabled=!0:Z.addEventListener("click",()=>{we.value="",we.dispatchEvent(new Event("input",{bubbles:!0})),it(F=>{F&&(c.addNote(F),ce(),Me(),ee("✅ یادداشت با موفقیت ثبت شد."))}),$e("add-note-modal"),we.focus()}),W.appendChild(ue),W.appendChild(Z),f.appendChild(W);const fe=document.createElement("ul");fe.className="notes-list",c.profile.notes&&c.profile.notes.length>0?[...c.profile.notes].sort((ne,A)=>new Date(A.timestamp)-new Date(ne.timestamp)).forEach(ne=>{const A=document.createElement("li");A.dir=Is(ne.content),A.textContent=ne.content,fe.appendChild(A)}):fe.innerHTML='<div class="no-content-message">یادداشتی وجود ندارد.</div>',f.appendChild(fe),D.appendChild(f),e.appendChild(D)}function Di(s){s.addEventListener("input",()=>{const o=s.value,e=Is(o);s.setAttribute("dir",e)})}function tr(){Rs(null),Kt.innerHTML="",ss.innerHTML="",Bt.classList.add("tooltip-container"),ct.disabled=!0,tt.disabled=!0,Ct.disabled=!0,ct.value="",tt.value="",Ot.classList.add("disabled-wrapper"),nt.disabled=!0}function _n(){Kt.innerHTML="",N.categories.filter(e=>!e.isDeleted).forEach(e=>{const c=document.createElement("span");c.className="pill",c.textContent=e.name,c.dataset.categoryId=e.id,e.description&&(c.dataset.tooltip=e.description),K.isFinished?c.classList.add("disabled"):c.addEventListener("click",()=>{document.querySelectorAll("#category-selection-container .pill").forEach(t=>t.classList.remove("active")),c.classList.add("active"),On(e),Rs(e),ls(e),ds(e.name),Ot.classList.remove("disabled-wrapper"),nt.disabled=K.isFinished;const r=K.lastWinnerByCategory[e.name];if(r){const t=N.students.find(i=>i.identity.studentId===r);t&&Me(t,e.name)}else{ss.innerHTML="",Mn(null),gt(-1),nt.disabled=!1;const t=document.querySelector(".current-winner-highlight");t&&t.classList.remove("current-winner-highlight")}}),K.isFinished||c.addEventListener("contextmenu",r=>{on(r,[{label:"تغییر نام",icon:"✏️",action:()=>{rs((i,a)=>{const n=Xs(N,e,i);n.success?(e.isGradedCategory=a,ce(),Se(N.info.name,`نام دسته‌بندی «${e.name}» به «${i}» تغییر یافت.`),_n(),Re(),ee(`✅ نام دسته‌بندی به «${i}» تغییر یافت.`)):ee(`⚠️ ${n.message}`)},{title:"ویرایش دسته‌بندی",initialName:e.name,initialIsGraded:e.isGradedCategory,saveButtonText:"ذخیره تغییرات"})}},{label:"حذف دسته‌بندی",icon:"🗑️",className:"danger",action:()=>{Ce(`آیا از انتقال دسته‌بندی «${e.name}» به سطل زباله مطمئن هستید؟`,()=>{const i={id:`trash_${Date.now()}_${Math.random()}`,timestamp:new Date().toISOString(),type:"category",description:`دسته‌بندی «${e.name}» از کلاس «${N.info.name}»`,restoreData:{categoryId:e.id,classId:N.info.scheduleCode}};pe.unshift(i),pe.length>50&&pe.pop();const a=e.name.toLowerCase();if(N.students.forEach(n=>{n.logs.scores&&n.logs.scores[a]&&n.logs.scores[a].forEach(d=>{d.isDeleted=!0})}),Ve&&Ve.id===e.id){On(null),ss.innerHTML="",ls(null),ds(null),Ot.classList.add("disabled-wrapper"),nt.disabled=!0;const n=document.querySelector(".current-winner-highlight");n&&n.classList.remove("current-winner-highlight")}e.isDeleted=!0,Se(N.info.name,`دسته‌بندی «${e.name}» به سطل زباله منتقل شد.`,{type:"VIEW_TRASH"}),ce(),_n(),Re(),ee(`✅ دسته‌بندی «${e.name}» به سطل زباله منتقل شد.`)},{confirmText:"بله",confirmClass:"btn-warning"})}}])}),Kt.appendChild(c)});const o=document.createElement("span");o.className="pill add-category-pill",o.textContent="+",o.title="افزودن دسته‌بندی جدید",K.isFinished?o.classList.add("disabled"):o.addEventListener("click",()=>{rs((e,c)=>{if(N.categories.find(i=>i.name.toLowerCase()===e.toLowerCase()&&!i.isDeleted)){ee("⚠️ این دسته‌بندی از قبل وجود دارد.");return}const t=new ut(e,"",c);N.categories.push(t),ce(),Se(N.info.name,`دسته‌بندی جدید «${e}» اضافه شد.`,{type:"VIEW_CLASS_SETTINGS"}),_n(),ee(`✅ دسته‌بندی «${e}» اضافه شد.`)})}),Kt.appendChild(o)}function nr(){if(K.lastUsedCategoryId){if(K.isFinished)return;const s=Kt.querySelector(`.pill[data-category-id="${K.lastUsedCategoryId}"]`);s&&s.click()}K.winnerHistory&&K.winnerHistory.length>0&&(gt(K.winnerHistory.length-1),Me())}function Rs(s){s?nt.textContent=`نفر بعدی در ${s.name}`:nt.textContent="نفر بعدی"}function ls(s){if(K.isFinished){ct.disabled=!0,tt.disabled=!0,Ct.disabled=!0,Bt.setAttribute("title","جلسه خاتمه یافته است");return}s&&s.isGradedCategory?(ct.disabled=!1,tt.disabled=!1,Ct.disabled=!1,Bt.removeAttribute("title")):(ct.disabled=!0,tt.disabled=!0,Ct.disabled=!0,s?Bt.setAttribute("title","برای این دسته‌بندی قابلیت نمره دهی تعریف نشده است"):Bt.setAttribute("title","ابتدا یک دسته‌بندی را انتخاب کنید"))}function ds(s){const o=document.querySelector(".student-stats-table");if(!o||(o.querySelectorAll(".current-category-highlight").forEach(i=>{i.classList.remove("current-category-highlight")}),!s))return;let c=-1;const r=o.querySelectorAll("thead th");if(r.forEach((i,a)=>{i.textContent.trim()===s&&(c=a)}),c===-1)return;r[c].classList.add("current-category-highlight"),o.querySelectorAll("tbody tr").forEach(i=>{const a=i.cells[c];a&&a.classList.add("current-category-highlight")})}function ze(s){Ke(s);const o=document.getElementById("student-profile-modal"),e=document.getElementById("modal-profile-student-name"),c=document.getElementById("modal-profile-content-container"),r=document.getElementById("modal-profile-close-btn");if(!o||!e||!c||!r)return;e.textContent=`پروفایل: ${s.identity.name}`,e.style.cursor="pointer",e.onclick=()=>{const d=Ee,p=N;ke(()=>{Ds(d,p)})},c.innerHTML="";const t=document.createElement("div");t.className="profile-header-actions";const i=document.createElement("button");i.className="btn-icon btn-icon-label",i.title="انتقال دانش‌آموز",i.innerHTML="<span>➡️</span><span>انتقال</span>",i.addEventListener("click",()=>{const d=Ee,p=N;ke(()=>{Ns(d,p)})});const a=document.createElement("button");a.className="btn-icon btn-icon-label",a.title="حذف دانش‌آموز",a.innerHTML="<span>🗑️</span><span>حذف</span>",a.style.color="var(--color-strong-warning)",a.addEventListener("click",()=>{const d=Ee,p=N;ke(()=>{Ce(`آیا از انتقال دانش‌آموز «${d.identity.name}» به سطل زباله مطمئن هستید؟`,()=>{const y={id:`trash_${Date.now()}_${Math.random()}`,timestamp:new Date().toISOString(),type:"student",description:`دانش‌آموز «${d.identity.name}» از کلاس «${p.info.name}»`,restoreData:{studentId:d.identity.studentId,classId:p.info.scheduleCode}};pe.unshift(y),pe.length>50&&pe.pop(),d.isDeleted=!0,Se(p.info.name,`دانش‌آموز «${d.identity.name}» به سطل زباله منتقل شد.`,{type:"VIEW_TRASH"}),ce(),lt(),Re(),st(),ee(`✅ دانش‌آموز «${d.identity.name}» به سطل زباله منتقل شد.`)},{confirmText:"بله",confirmClass:"btn-warning",isDelete:!0,onCancel:()=>{ze(d)}})})});const n=document.createElement("button");n.className="btn-icon btn-icon-label",n.title="افزودن یادداشت جدید",n.innerHTML="<span>📝</span><span>یادداشت</span>",n.addEventListener("click",()=>{const d=Ee;we.value="",we.dispatchEvent(new Event("input",{bubbles:!0})),it(p=>{p&&(d.addNote(p),ce(),Se(N.info.name,`یادداشت جدیدی برای دانش‌آموز «${d.identity.name}» ثبت شد.`,{type:"VIEW_STUDENT_PROFILE",studentId:d.identity.studentId}),Me(),ee("✅ یادداشت با موفقیت ثبت شد.")),ze(d)}),ke(()=>{$e("add-note-modal"),we.focus()})}),t.appendChild(i),t.appendChild(a),t.appendChild(n),c.appendChild(t),sr(c),Ai(c),r.onclick=()=>ke(),$e("student-profile-modal")}function sr(s){if(!Ee||!N)return;const o=document.createElement("div");o.className="scoring-section",o.innerHTML=`
        <h3>ثبت نمره جدید</h3>
        <div id="modal-graded-pills" class="category-pills"></div>
        <div class="input-group centered-input-group" style="margin-top: 15px;">
            <input type="number" id="modal-new-score-value" placeholder="نمره (مثلا: 85)">
        </div>
        <textarea id="modal-new-score-comment" placeholder="توضیحات این نمره (اختیاری)..." style="margin-top: 10px;"></textarea>
        <button id="modal-add-score-btn" class="btn-success" style="width: 100%; margin-top: 10px;">ثبت نمره</button>
    `;const e=o.querySelector("#modal-graded-pills");Ie(N.categories).filter(t=>t.isGradedCategory).forEach(t=>{const i=document.createElement("span");i.className="pill",i.textContent=t.name,i.dataset.skillName=t.name,i.addEventListener("click",()=>{e.querySelectorAll(".pill").forEach(a=>a.classList.remove("active")),i.classList.add("active")}),e.appendChild(i)}),o.querySelector("#modal-add-score-btn").addEventListener("click",()=>{const t=e.querySelector(".pill.active");if(!t){ee("⚠️لطفاً یک مهارت را برای نمره‌دهی انتخاب کنید.");return}const i=t.dataset.skillName,a=o.querySelector("#modal-new-score-value"),n=o.querySelector("#modal-new-score-comment"),d=a.value,p=n.value.trim();if(!d){ee("لطفاً مقدار نمره را وارد کنید.");return}Ee.addScore(i,parseFloat(d),p),ce(),Se(N.info.name,`نمره ${d} در ${i} برای «${Ee.identity.name}» ثبت شد.`,{type:"VIEW_STUDENT_PROFILE",studentId:Ee.identity.studentId}),Re(),Me(),a.value="",n.value="";const y=document.getElementById("modal-profile-content-container"),m=y.querySelector(".history-section");m&&m.remove(),Ai(y),ee(`✅ نمره برای مهارت ${i} با موفقیت ثبت شد.`)}),s.appendChild(o)}function Ai(s){if(!Ee)return;const o=document.createElement("div");o.className="history-section";const e=document.createElement("div");e.className="history-section-header";const c=document.createElement("h3");c.textContent="سوابق دانش‌آموز",e.appendChild(c),o.appendChild(e),ir(o),Oi(o),Mi(o),s.appendChild(o)}function ir(s){if(!Ee)return;const o=Ee,e=N.sessions.reduce((u,b)=>{const h=b.studentRecords[o.identity.studentId];return u+(h&&h.attendance==="absent"?1:0)},0),c=Object.values(o.categoryIssues||{}).reduce((u,b)=>u+b,0),r=document.createElement("div");r.className="stats-summary-box",r.innerHTML=`
        <p><strong>کل انتخاب:</strong> ${o.statusCounters.totalSelections}</p>
        <p><strong>غیبت:</strong> ${e}</p>
        <p><strong>فرصت از دست رفته:</strong> ${o.statusCounters.missedChances||0}</p>
        <p><strong>مشکل:</strong> ${c}</p>
    `,s.appendChild(r),r.querySelector("p:nth-child(1)");const t=r.querySelector("p:nth-child(4)"),i=Ie(N.categories),a=document.createElement("div");if(a.className="stats-breakdown",i.length>0){i.forEach(b=>{var C;const h=b.name,v=((C=o.categoryCounts)==null?void 0:C[h])||0,g=document.createElement("p");g.className="stats-breakdown-item",g.innerHTML=`<strong>${h}:</strong> ${v}`,a.appendChild(g)});const u=r.querySelector("p:first-child");u&&(u.classList.add("collapsible-toggle"),u.onclick=()=>{a.classList.toggle("open"),u.classList.toggle("open")},u.after(a))}const n=document.createElement("div");n.className="stats-breakdown",i.length>0&&(i.forEach(u=>{var g;const b=u.name,h=((g=o.categoryIssues)==null?void 0:g[b])||0,v=document.createElement("p");v.className="stats-breakdown-item",v.innerHTML=`<strong>${b}:</strong> ${h}`,n.appendChild(v)}),t&&(t.classList.add("collapsible-toggle"),t.onclick=()=>{n.classList.toggle("open"),t.classList.toggle("open")},r.appendChild(n)));const d=document.createElement("p"),p=document.createElement("strong");p.textContent="تکالیف ناقص:";const y=document.createElement("span");y.style.marginRight="5px";const m=Qe(N);wn(o,m,y,{includePrefix:!1}),d.appendChild(p),d.appendChild(y),r.appendChild(d)}function Oi(s){if(!Ee)return;const o=Ee,e=document.createElement("h4");e.textContent="تاریخچه نمرات:",e.style.marginTop="20px";const c=document.createElement("ul");c.className="list-container";const r=Object.values(o.logs.scores||{}).flat().filter(t=>!t.isDeleted).sort((t,i)=>new Date(i.timestamp)-new Date(t.timestamp));r.length===0?c.innerHTML='<div class="no-content-message">هنوز نمره‌ای ثبت نشده است.</div>':r.forEach(t=>{const i=document.createElement("li");i.className="score-history-item";const a=document.createElement("div");a.className="item-content";const n=document.createElement("div");n.className="score-info";const d=document.createElement("span");d.className="score-skill-badge",d.textContent=t.skill;const p=document.createElement("span");p.className="score-value",p.textContent=`نمره: ${t.value}`;const y=document.createElement("span");if(y.className="score-date",y.textContent=new Date(t.timestamp).toLocaleDateString("fa-IR"),n.appendChild(d),n.appendChild(p),n.appendChild(y),a.appendChild(n),t.comment){const u=document.createElement("p");u.className="score-comment",u.innerHTML=mi(t.comment),u.addEventListener("click",()=>{we.value=t.comment,we.dispatchEvent(new Event("input",{bubbles:!0})),it(b=>{t.comment=b,ce(),Se(N.info.name,`توضیحات نمره ${t.value} (${t.skill}) برای دانش‌آموز «${o.identity.name}» به‌روزرسانی شد.`,{type:"VIEW_STUDENT_PROFILE",studentId:o.identity.studentId}),ze(o),ee("✅ توضیحات نمره با موفقیت ویرایش شد.")}),ke(()=>{$e("add-note-modal"),we.focus()})}),a.appendChild(u)}const m=document.createElement("button");m.className="btn-icon delete-item-btn",m.innerHTML="🗑️",m.title="حذف این نمره",m.addEventListener("click",()=>{ke(()=>{Ce(`آیا از انتقال نمره ${t.value} در مهارت «${t.skill}» به سطل زباله مطمئن هستید؟`,()=>{const u={id:`trash_${Date.now()}_${Math.random()}`,timestamp:new Date().toISOString(),type:"score",description:`نمره ${t.value} (${t.skill}) برای «${o.identity.name}»`,restoreData:{scoreId:t.id,skill:t.skill,studentId:o.identity.studentId,classId:N.info.scheduleCode}};pe.unshift(u),pe.length>50&&pe.pop(),t.isDeleted=!0,ce(),Se(N.info.name,`نمره ${t.value} (${t.skill}) دانش‌آموز «${o.identity.name}» به سطل زباله منتقل شد.`,{type:"VIEW_TRASH"}),ze(o),ee("✅ نمره به سطل زباله منتقل شد.")},{confirmText:"تایید انتقال",confirmClass:"btn-warning",onCancel:()=>{ze(o)}})})}),i.appendChild(a),i.appendChild(m),c.appendChild(i)}),s.appendChild(e),s.appendChild(c)}function Mi(s){if(!Ee)return;const o=document.createElement("h4");o.textContent="تاریخچه یادداشت‌ها:",o.style.marginTop="20px";const e=document.createElement("ul");e.className="list-container",!Ee.profile.notes||Ee.profile.notes.length===0?e.innerHTML='<div class="no-content-message">هنوز یادداشتی ثبت نشده است.</div>':[...Ee.profile.notes].filter(r=>!r.isDeleted).sort((r,t)=>new Date(t.timestamp)-new Date(r.timestamp)).forEach(r=>{const t=document.createElement("li");t.className="note-history-item";const i=document.createElement("div");i.className="item-content";const a=document.createElement("div");a.className="note-info";const n=document.createElement("span");n.className="note-date",n.textContent=new Date(r.timestamp).toLocaleDateString("fa-IR");const d=document.createElement("button");d.className="btn-icon delete-item-btn",d.innerHTML="🗑️",d.title="حذف این یادداشت",d.addEventListener("click",()=>{const y=Ee;ke(()=>{Ce("آیا از انتقال این یادداشت به سطل زباله مطمئن هستید؟",()=>{const m={id:`trash_${Date.now()}_${Math.random()}`,timestamp:new Date().toISOString(),type:"note",description:`یادداشت برای دانش‌آموز «${y.identity.name}»`,restoreData:{noteId:r.id,studentId:y.identity.studentId,classId:N.info.scheduleCode}};pe.unshift(m),pe.length>50&&pe.pop(),r.isDeleted=!0,Se(N.info.name,`یادداشت دانش‌آموز «${y.identity.name}» به سطل زباله منتقل شد.`,{type:"VIEW_TRASH"}),ce(),ze(y),ee("✅ یادداشت به سطل زباله منتقل شد.")},{confirmText:"تایید انتقال",confirmClass:"btn-warning",onCancel:()=>{ze(y)}})})}),a.appendChild(n),a.appendChild(d);const p=document.createElement("p");p.className="note-content",p.innerHTML=mi(r.content),p.addEventListener("click",()=>{const y=Ee;we.value=r.content,we.dispatchEvent(new Event("input",{bubbles:!0})),it(m=>{r.content=m,ce(),Se(N.info.name,`یادداشت دانش‌آموز «${y.identity.name}» به‌روزرسانی شد.`,{type:"VIEW_STUDENT_PROFILE",studentId:y.identity.studentId}),ze(y),ee("✅یادداشت با موفقیت ویرایش شد.")}),ke(()=>{$e("add-note-modal"),we.focus()})}),i.appendChild(a),i.appendChild(p),t.appendChild(i),e.appendChild(t)}),s.appendChild(o),s.appendChild(e)}function Ri(s){Xn.innerHTML="",s.forEach((o,e)=>{const c=document.createElement("option");c.value=e,c.textContent=o.trim(),Xn.appendChild(c)})}function us(){Yn.innerHTML="",hs.forEach(s=>{const o=document.createElement("li");o.className="preview-item";const e=document.createElement("input");e.type="checkbox",e.checked=!0,e.dataset.name=s;const c=document.createElement("label");c.textContent=s,o.appendChild(e),o.appendChild(c),Yn.appendChild(o)})}function ar(s){const o=document.createElement("div");o.className="list-item-buttons";const e=document.createElement("button");return e.className="btn-icon",e.innerHTML="📝",e.title="ویرایش یادداشت کلاس",s.note||(e.style.display="none"),e.addEventListener("click",c=>{c.stopPropagation(),Pn(s)}),o.appendChild(e),o}function rr(s){const o=document.createElement("div");o.style.flexGrow="1",o.style.display="flex",o.style.flexDirection="column",o.style.alignItems="flex-start";const e=document.createElement("span");e.textContent=s.info.name,e.classList.add("class-name-display"),o.appendChild(e);const c=Ie(s.students).length,r=Ie(s.sessions).filter(d=>d.isFinished).length,t=hr(s.info.scheduleDays),i=document.createElement("div");i.classList.add("class-stats-row");const a=document.createElement("span");a.textContent=`${c} نفر`,a.classList.add("student-count-badge"),i.appendChild(a);const n=document.createElement("span");if(n.textContent=`${r} جلسه`,n.classList.add("session-count-badge"),i.appendChild(n),t){const d=document.createElement("span");d.textContent=t,d.classList.add("schedule-days-badge"),i.appendChild(d)}return o.appendChild(i),o.addEventListener("click",()=>{Pe(s),je(null),en(N.liveSession),He(),ge("session-page")}),o}function or(s){const o=document.createElement("li"),e=document.createElement("input");e.type="checkbox",e.className="mass-selection-checkbox",e.checked=rt.includes(s.info.name),e.addEventListener("click",d=>{d.stopPropagation()}),e.addEventListener("change",()=>{const d=s.info.name;if(e.checked)rt.includes(d)||rt.push(d);else{const p=rt.indexOf(d);p>-1&&rt.splice(p,1)}}),o.appendChild(e);const c=rr(s);o.appendChild(c);const r=document.createElement("div");r.style.display="flex",r.style.flexDirection="column",r.style.gap="5px",r.style.alignItems="flex-end",r.style.marginLeft="10px";const t=document.createElement("div");if(t.className="list-item-badges",s.liveSession&&!s.liveSession.isCancelled&&!s.liveSession.isDeleted){const d=document.createElement("span");d.className="warning-badge",d.textContent="جلسه باز",t.appendChild(d),o.classList.add("has-unfinished-session")}const i=document.createElement("span");if(i.className=`type-badge ${s.info.type}`,i.textContent=s.info.type==="online"?"آنلاین":"حضوری",i.title="نوع کلاس",t.appendChild(i),fs(s).type==="incomplete"){const d=document.createElement("span");d.className="type-badge cancelled-badge",d.textContent="زمان‌بندی ناقص",d.style.cursor="pointer",d.title="برای تکمیل زمان‌بندی کلیک کنید",d.addEventListener("click",p=>{p.stopPropagation(),Ce("زمان‌بندی این کلاس کامل نیست. برای نمایش صحیح در لیست، لطفاً روزها و ساعت برگزاری را مشخص کنید.",()=>{At(s)},{confirmText:"تنظیمات",confirmClass:"btn-primary"})}),t.appendChild(d)}else{const d=mr(s,oe);if(d){const p=document.createElement("span");p.className="type-badge conflict-badge",p.textContent="تداخل زمانی",p.style.cursor="pointer",p.title=`تداخل با کلاس: ${d}`,p.addEventListener("click",y=>{y.stopPropagation(),Ce(`زمان برگزاری این کلاس با کلاس «${d}» تداخل دارد. لطفاً زمان‌بندی را بررسی کنید.`,()=>{At(s)},{confirmText:"تنظیمات",confirmClass:"btn-primary"})}),t.appendChild(p)}}r.appendChild(t);const n=ar(s);return r.appendChild(n),o.appendChild(r),o.addEventListener("contextmenu",d=>{const p={label:"پشتیبان‌گیری از این کلاس",icon:"📤",action:()=>{an([s.info.name])}},y=rt.length;y>1&&rt.includes(s.info.name)&&(p.label=`پشتیبان‌گیری از ${y} کلاس`,p.action=()=>{an(rt),Vn([]),We()});const m=[{label:Nt.classList.contains("selection-mode-active")?"لغو انتخاب":"انتخاب چند کلاس",icon:"✔️",action:()=>{const u=Nt.classList.contains("selection-mode-active");Nt.classList.toggle("selection-mode-active"),u&&(Vn([]),We())}},p,{label:"یادداشت کلاس",icon:"📝",action:()=>{Pn(s)}},{label:"تنظیمات کلاس",icon:"⚙️",action:()=>{At(s)}},{label:"گزارش فعالیت‌ها",icon:"📋",action:()=>{Bi(s.info.name)}},{label:"تغییر نام",icon:"✏️",action:()=>{const u=s.info.name,b=document.getElementById("add-note-modal-title");b.textContent="تغییر نام کلاس",we.value=u,we.rows=1,it(h=>{const v=h.trim();if(v&&v!==u){const g=Ys(u,v);g.success?(Yi(u,v),Se(v,`نام کلاس از «${u}» به «${v}» تغییر یافت.`,{type:"VIEW_SESSIONS"}),ce(),We(),ee(`✅نام کلاس به «${v}» تغییر یافت.`)):ee(g.message)}b.textContent="ثبت یادداشت جدید",we.rows=4}),$e("add-note-modal"),we.focus(),we.select()}},{label:"حذف کلاس",icon:"🗑️",className:"danger",action:()=>{Ce(`آیا از انتقال کلاس «${s.info.name}» به سطل زباله مطمئن هستید؟`,()=>{const u={id:`trash_${Date.now()}_${Math.random()}`,timestamp:new Date().toISOString(),type:"classroom",description:`کلاس «${s.info.name}»`,restoreData:{name:s.info.name}};pe.unshift(u),pe.length>50&&pe.pop(),s.isDeleted=!0,ce(),We(),ee(`✅ کلاس «${s.info.name}» به سطل زباله منتقل شد.`)},{confirmText:"بله",confirmClass:"btn-warning",isDelete:!0})}}];on(d,m)}),o}function Wn(){const s=document.getElementById("class-management-stats");if(!s)return;const o=Object.values(oe).filter(t=>!t.isDeleted),e=o.length,c=o.reduce((t,i)=>t+Ie(i.students).length,0);let r="";Ze.lastBackupTimestamp&&(r=`
            <div class="stats-row backup-stat">
                <span>آخرین پشتیبان: <strong>${new Date(Ze.lastBackupTimestamp).toLocaleString("fa-IR",{year:"numeric",month:"numeric",day:"numeric",weekday:"long",hour:"2-digit",minute:"2-digit"})}</strong></span>
            </div>
        `),s.innerHTML=`
        <div class="stats-row main-stats">
            <span>کل کلاس‌ها: <strong>${e}</strong></span>
            <span>|</span>
            <span>کل دانش‌آموزان: <strong>${c}</strong></span>
        </div>
        ${r} 
    `}function We(){Wn(),Nt.innerHTML="",Object.values(oe).sort((o,e)=>{const c=fs(o),r=fs(e);return c.sortIndex!==r.sortIndex?c.sortIndex-r.sortIndex:c.type==="upcoming"?c.nextTimestamp-r.nextTimestamp:new Date(o.info.creationDate)-new Date(e.info.creationDate)}).forEach(o=>{if(o.isDeleted)return;const e=or(o);Nt.appendChild(e)})}function lt(){Kn.innerHTML="",N&&Ie(N.students).forEach(s=>{const o=document.createElement("li"),e=document.createElement("span");e.textContent=s.identity.name,e.style.flexGrow="1",e.className="student-name-link",e.addEventListener("click",()=>{ze(s)}),o.appendChild(e),o.addEventListener("contextmenu",c=>{on(c,[{label:"تغییر نام",icon:"✏️",action:()=>{Ds(s,N)}},{label:"انتقال دانش‌آموز",icon:"➡️",action:()=>{Ns(s,N)}},{label:"حذف دانش‌آموز",icon:"🗑️",className:"danger",action:()=>{Ce(`آیا از انتقال دانش‌آموز «${s.identity.name}» به سطل زباله مطمئن هستید؟`,()=>{const t={id:`trash_${Date.now()}_${Math.random()}`,timestamp:new Date().toISOString(),type:"student",description:`دانش‌آموز «${s.identity.name}» از کلاس «${N.info.name}»`,restoreData:{studentId:s.identity.studentId,classId:N.info.scheduleCode}};pe.unshift(t),pe.length>50&&pe.pop(),s.isDeleted=!0,Se(N.info.name,`دانش‌آموز «${s.identity.name}» به سطل زباله منتقل شد.`,{type:"VIEW_TRASH"}),ce(),lt(),ee(`✅ دانش‌آموز «${s.identity.name}» به سطل زباله منتقل شد.`)},{confirmText:"بله",confirmClass:"btn-warning",isDelete:!0})}}])}),Kn.appendChild(o)})}function zt(){if(Jn.innerHTML="",!N)return;N.categories.filter(o=>!o.isDeleted).forEach(o=>{const e=document.createElement("li"),c=document.createElement("div");c.className="name-and-badge-container";const r=document.createElement("span");if(r.textContent=o.name,c.appendChild(r),o.isGradedCategory){const i=document.createElement("span");i.className="category-badge",i.textContent="نمره‌دار",c.appendChild(i)}const t=document.createElement("button");t.className="btn-icon",t.innerHTML="🗑️",t.style.color="var(--color-warning)",t.addEventListener("click",()=>{Ce(`آیا از انتقال دسته‌بندی «${o.name}» به سطل زباله مطمئن هستید؟`,()=>{const i={id:`trash_${Date.now()}_${Math.random()}`,timestamp:new Date().toISOString(),type:"category",description:`دسته‌بندی «${o.name}» از کلاس «${N.info.name}»`,restoreData:{categoryId:o.id,classId:N.info.scheduleCode}};pe.unshift(i),pe.length>50&&pe.pop(),o.isDeleted=!0,Se(N.info.name,`دسته‌بندی «${o.name}» به سطل زباله منتقل شد.`,{type:"VIEW_TRASH"}),ce(),zt(),ee(`✅ دسته‌بندی «${o.name}» به سطل زباله منتقل شد.`)},{confirmText:"بله",confirmClass:"btn-warning"})}),e.appendChild(c),e.appendChild(t),Jn.appendChild(e)})}function zi(){if(!N)return;const s=N.info.type||"in-person",o=document.querySelector(`#settings-page input[name="class-type-setting"][value="${s}"]`);o&&(o.checked=!0);const e=N.info.scheduleDays||[];document.querySelectorAll('input[name="schedule-day"]').forEach(c=>{c.checked=e.includes(parseInt(c.value))}),document.getElementById("settings-schedule-start").value=N.info.scheduleStartTime||"",document.getElementById("settings-schedule-end").value=N.info.scheduleEndTime||""}function Xt(s){document.querySelectorAll(".page").forEach(e=>{e.classList.remove("active")});const o=document.getElementById(s);o&&o.classList.add("active"),s==="class-management-page"?(Pe(null),je(null),Ke(null),We(),Qn.style.display="flex"):Qn.style.display="none",Ni()}function ge(s,o={}){const{tab:e}=o,c={pageId:s,currentClassName:N?N.info.name:null,selectedSessionNumber:K?K.sessionNumber:null,selectedStudentId:Ee?Ee.identity.studentId:null};let r=`#${s}`;const t=new URLSearchParams(window.location.hash.split("?")[1]||"");N?t.set("class",N.info.name):t.delete("class"),K?t.set("session",K.sessionNumber):t.delete("session"),Ee?t.set("student",Ee.identity.studentId):t.delete("student"),s==="session-dashboard-page"&&e?t.set("tab",e):s!=="session-dashboard-page"&&t.delete("tab");const i=t.toString();i&&(r+=`?${i}`),window.location.hash!==r&&history.pushState(c,"",r),Xt(s)}function cr(s,o){const e=document.createElement("div");e.className="list-item-buttons",e.style.gap="10px";const c=document.createElement("button");if(c.className="btn-icon",c.innerHTML="📝",c.title="ویرایش یادداشت جلسه",s.note||(c.style.display="none"),c.addEventListener("click",r=>{r.stopPropagation(),Ms(s,o)}),!s.isFinished&&!s.isCancelled){const r=document.createElement("button");r.className="btn-success",r.textContent="پایان جلسه",r.style.fontSize="12px",r.style.padding="4px 10px",r.style.whiteSpace="nowrap",r.addEventListener("click",t=>{t.stopPropagation(),Ce(`جلسه شماره ${o} خاتمه پیدا خواهد کرد!`,()=>{N.endSpecificSession(s.sessionNumber),ce(),Se(N.info.name,`جلسه ${o} خاتمه یافت.`,{type:"VIEW_SESSIONS"}),He(),Ce("جلسه با موفقیت خاتمه یافت. آیا مایل به ایجاد فایل پشتیبان هستید؟",()=>{if(ot){ee("⚠️ پشتیبان‌گیری در حالت نمایش (Demo) غیرفعال است.");return}an(),ee("✅فایل پشتیبان با موفقیت ایجاد شد.")},{confirmText:"بله",cancelText:"خیر",confirmClass:"btn-success"})})}),e.appendChild(r)}return e.appendChild(c),e}function lr(s,o){const e=document.createElement("div");e.style.display="flex",e.style.flexDirection="column",e.style.alignItems="flex-start",e.style.flexGrow="1";const c=new Date(s.startTime).toLocaleDateString("fa-IR"),r=document.createElement("span");r.className="session-list-title";const t=document.createElement("div");t.style.display="flex",t.style.gap="5px",t.style.marginTop="5px";const i=new Date(s.startTime).toLocaleDateString("fa-IR",{weekday:"long"}),a=document.createElement("span");if(a.className="type-badge day-badge",a.textContent=i,t.appendChild(a),s.isCancelled){r.textContent=`لغو شده - تاریخ: ${c}`,e.style.cursor="default";const n=document.createElement("span");n.className="type-badge cancelled-badge",n.textContent="لغو شده",t.appendChild(n)}else r.textContent=`جلسه ${o} - تاریخ: ${c}`,e.style.cursor="pointer",e.addEventListener("click",()=>{je(s),Rt()});if(e.appendChild(r),s.isFinished){const n=document.createElement("span");n.className="type-badge finished-badge",n.textContent="خاتمه یافته",t.appendChild(n)}if(s.isMakeup){const n=document.createElement("span");n.className="type-badge makeup-badge",n.textContent="جبرانی",t.appendChild(n)}return e.appendChild(t),e}function dr(s,o){const e=document.createElement("li"),c=o.get(s.sessionNumber),r=lr(s,c);e.appendChild(r);const t=cr(s,c);return e.appendChild(t),e.addEventListener("contextmenu",i=>{const a=[{label:"یادداشت جلسه",icon:"📝",action:()=>{Ms(s,c)}},{label:s.isCancelled?"بازگردانی جلسه":"لغو جلسه",icon:"❌",action:()=>{const n=s.isCancelled?"بازگردانی جلسه":"لغو جلسه",d=s.isCancelled?"آیا از بازگردانی این جلسه مطمئن هستید؟":"آیا از لغو این جلسه مطمئن هستید؟ جلسه لغو شده در آمار تاثیری ندارد اما قابل بازگردانی است.";Ce(d,()=>{s.isCancelled=!s.isCancelled;const p=s.isCancelled?`جلسه ${c} لغو شد.`:`جلسه لغو شده (تاریخ: ${new Date(s.startTime).toLocaleDateString("fa-IR")}) بازگردانی شد.`;Se(N.info.name,p,{type:"VIEW_SESSIONS"}),ce(),He(),ee(s.isCancelled?"✅جلسه لغو شد.":"✅جلسه بازگردانی شد.")},{confirmText:n,confirmClass:"btn-warning"})}},{label:"تغییر وضعیت جبرانی",icon:"🔄",action:()=>{N.markAsMakeup(s.sessionNumber),ce();const n=s.isMakeup?`جلسه ${c} به عنوان جبرانی علامت‌گذاری شد.`:`جلسه ${c} از حالت جبرانی خارج شد.`;Se(N.info.name,n,{type:"VIEW_SESSIONS"}),He()}},{label:"حذف جلسه",icon:"🗑️",className:"danger",action:()=>{const n=s.isCancelled?"لغو شده":c;Ce(`آیا از انتقال جلسه ${n} به سطل زباله مطمئن هستید؟`,()=>{const d={id:`trash_${Date.now()}_${Math.random()}`,timestamp:new Date().toISOString(),type:"session",description:`جلسه ${n} از کلاس «${N.info.name}»`,restoreData:{sessionNumber:s.sessionNumber,classId:N.info.scheduleCode}};pe.unshift(d),pe.length>50&&pe.pop(),s.isDeleted=!0,Se(N.info.name,`جلسه ${n} به سطل زباله منتقل شد.`,{type:"VIEW_TRASH"}),ce(),He(),ee(`✅ جلسه ${n} به سطل زباله منتقل شد.`)},{confirmText:"بله",confirmClass:"btn-warning",isDelete:!0})}}];on(i,a)}),e}function He(){const s=document.getElementById("session-list");if(!N)return;if(s.innerHTML="",N.sessions.length===0){s.innerHTML="<li>هنوز جلسه‌ای شروع نشده است.</li>";return}const o=Qe(N);[...Ie(N.sessions)].reverse().forEach(c=>{const r=dr(c,o);s.appendChild(r)})}function qt(s){if(ht.innerHTML="",s.length>0)s.forEach(o=>{const e=document.createElement("div");e.textContent=o.identity.name,e.addEventListener("click",()=>{ze(o),ht.style.display="none",ns.value=""}),ht.appendChild(e)}),ht.style.display="block";else if(ns.value.trim()!==""){const o=document.createElement("div");o.className="no-results",o.textContent="پیدا نشد",ht.appendChild(o),ht.style.display="block"}else ht.style.display="none"}function En(s){if(at.innerHTML="",s.length>0)s.forEach(o=>{const e=document.createElement("div");if(e.className="global-search-result",o.type==="student"){const c=document.createElement("span");c.className="student-name",c.textContent=o.student.identity.name;const r=document.createElement("span");r.className="class-name",r.textContent=`کلاس: ${o.classroom.info.name}`,e.addEventListener("click",()=>{Pe(o.classroom),ze(o.student),at.style.display="none",jt.value=""}),r.addEventListener("click",t=>{t.stopPropagation(),Pe(o.classroom),je(null),en(o.classroom.liveSession),He(),ge("session-page"),at.style.display="none",jt.value=""}),e.appendChild(c),e.appendChild(r)}else if(o.type==="classroom"){const c=document.createElement("span");c.className="student-name",c.textContent=`[کلاس] ${o.classroom.info.name}`,e.addEventListener("click",()=>{Pe(o.classroom),je(null),en(o.classroom.liveSession),He(),ge("session-page"),at.style.display="none",jt.value=""}),e.appendChild(c)}at.appendChild(e)}),at.style.display="block";else if(jt.value.trim()!==""){const o=document.createElement("div");o.className="no-results",o.textContent="پیدا نشد",at.appendChild(o),at.style.display="block"}else at.style.display="none"}function rn(){const s=document.getElementById("trashed-items-list");if(s.innerHTML="",pe.length===0){s.innerHTML='<li style="text-align: center; padding: 20px;">سطل زباله خالی است.</li>';return}pe.forEach((o,e)=>{const c=document.createElement("li"),r=document.createElement("span");r.textContent=o.description,r.style.flexGrow="1";const t=document.createElement("div");t.className="list-item-buttons";const i=document.createElement("button");i.className="btn-icon",i.innerHTML="🔄",i.title="بازیابی",i.addEventListener("click",()=>{var y;let n=!1,d=null;const p=o.restoreData;switch(o.type){case"classroom":{const m=oe[p.name];m&&!m.isDeleted?d=`کلاسی با نام «${p.name}» از قبل فعال است.`:m&&m.isDeleted&&(m.isDeleted=!1,n=!0);break}case"student":{const m=Object.values(oe).find(b=>b.info.scheduleCode===p.classId),u=m==null?void 0:m.students.find(b=>b.identity.studentId===p.studentId);u&&(u.isDeleted=!1,n=!0);break}case"session":{const m=Object.values(oe).find(b=>b.info.scheduleCode===p.classId),u=m==null?void 0:m.sessions.find(b=>b.sessionNumber===p.sessionNumber);u&&(u.isDeleted=!1,n=!0);break}case"category":{const m=Object.values(oe).find(b=>b.info.scheduleCode===p.classId),u=m==null?void 0:m.categories.find(b=>b.id===p.categoryId);u&&(u.isDeleted=!1,n=!0);break}case"score":{const m=Object.values(oe).find(h=>h.info.scheduleCode===p.classId),u=m==null?void 0:m.students.find(h=>h.identity.studentId===p.studentId),b=(y=u==null?void 0:u.logs.scores[p.skill.toLowerCase()])==null?void 0:y.find(h=>h.id===p.scoreId);b&&(b.isDeleted=!1,n=!0);break}case"note":{const m=Object.values(oe).find(h=>h.info.scheduleCode===p.classId),u=m==null?void 0:m.students.find(h=>h.identity.studentId===p.studentId),b=u==null?void 0:u.profile.notes.find(h=>h.id===p.noteId);b&&(b.isDeleted=!1,n=!0);break}}n?(pe.splice(e,1),ce(),rn(),o.type==="classroom"&&We(),ee("✅ آیتم با موفقیت بازیابی شد.")):ee(d?`⚠️ ${d}`:"⚠️ آیتم اصلی برای بازیابی یافت نشد.")});const a=document.createElement("button");a.className="btn-icon",a.innerHTML="🔥",a.title="حذف دائمی",a.addEventListener("click",()=>{Ce("آیا از حذف دائمی این آیتم مطمئن هستید؟ این عمل غیرقابل بازgشت است.",()=>{const n=o.restoreData,d=y=>Object.values(oe).find(m=>m.info.scheduleCode===y);let p;switch(o.type){case"classroom":delete oe[n.name];break;case"student":p=d(n.classId),Dn({identity:{studentId:n.studentId}},p);break;case"session":p=d(n.classId),p&&ti(p.info.name,n.sessionNumber);break;case"category":p=d(n.classId),p&&ni(p.info.name,n.categoryId);break;case"score":p=d(n.classId),p&&si(p.info.name,n.studentId,n.skill,n.scoreId);break;case"note":p=d(n.classId),p&&ii(p.info.name,n.studentId,n.noteId);break}pe.splice(e,1),ce(),rn(),ee("✅ آیتم برای همیشه حذف شد.")},{confirmText:"حذف دائمی",confirmClass:"btn-warning"})}),t.appendChild(i),t.appendChild(a),c.appendChild(r),c.appendChild(t),s.appendChild(c)})}function ur(){const s=document.getElementById("absentees-summary-container");s&&(s.innerHTML=`
        <div id="absentees-summary-box" class="absentees-summary">
            <div class="absentees-summary-header">
                <h4>لیست غایبین جلسه شماره <span id="absentee-summary-session-number"></span></h4>
                <button id="copy-absentees-btn" class="btn-icon" title="کپی لیست غایبین">📋</button>
            </div>
            <div id="absentees-summary-list" class="summary-list"></div>
        </div>
    `)}function $i(){const s=document.getElementById("absentees-summary-box"),o=document.getElementById("absentees-summary-list"),e=document.getElementById("absentee-summary-session-number");if(!s||!o||!e){console.error("Could not find all absentee summary elements.");return}if(!N||!K){s.classList.remove("visible");return}const c=Ie(N.students).filter(t=>{const i=K.studentRecords[t.identity.studentId];return i&&i.attendance==="absent"}),r=Qe(N);e.textContent=r.get(K.sessionNumber),c.length>0?s.classList.add("visible"):s.classList.remove("visible"),o.innerHTML="",c.forEach(t=>{const a=(d=>N.sessions.reduce((p,y)=>{if(y.isDeleted||y.isCancelled)return p;const m=y.studentRecords[d.identity.studentId];return p+(m&&m.attendance==="absent"?1:0)},0))(t),n=document.createElement("span");n.className="summary-name",n.textContent=`${t.identity.name} (غیبت: ${a})`,n.addEventListener("click",()=>{n.classList.add("fading-out"),setTimeout(()=>{K.setAttendance(t.identity.studentId,"present"),ce(),st()},200)}),o.appendChild(n)})}function fr(){const s=document.getElementById("copy-absentees-btn");if(!s){console.error("Could not find the copy absentees button to attach listener.");return}s.addEventListener("click",()=>{if(!N||!K)return;const o=Ie(N.students).filter(r=>{const t=K.studentRecords[r.identity.studentId];return t&&t.attendance==="absent"});if(o.length===0){ee("⚠️لیست غایبین خالی است.");return}const e=r=>N.sessions.reduce((t,i)=>{if(i.isDeleted||i.isCancelled)return t;const a=i.studentRecords[r.identity.studentId];return t+(a&&a.attendance==="absent"?1:0)},0);let c=`لیست غایبین جلسه شماره ${er()}:

`;o.forEach(r=>{const t=e(r);c+=`- ${r.identity.name} (تعداد غیبت‌ها: ${t})
`}),navigator.clipboard.writeText(c).then(()=>{ee("✅لیست غایبین با موفقیت کپی شد.")}).catch(r=>{console.error("Failed to copy text: ",r),ee("❌خطا در کپی کردن لیست.")})})}function kn(){const s=document.getElementById("demo-mode-banner");s&&(ot?(s.classList.add("visible"),document.body.classList.add("demo-mode-active")):(s.classList.remove("visible"),document.body.classList.remove("demo-mode-active")))}function fs(s){const{scheduleDays:o,scheduleStartTime:e,scheduleEndTime:c}=s.info,r=o&&o.length>0,t=e&&c;if(!r&&!t)return{type:"unscheduled",sortIndex:3};if(!r||!t)return{type:"incomplete",sortIndex:2};const i=new Date,a=i.getDay(),n=i.getHours()*60+i.getMinutes(),[d,p]=e.split(":").map(Number),[y,m]=c.split(":").map(Number),u=d*60+p,b=y*60+m;if(o.includes(a)&&n>=u&&n<b)return{type:"active",sortIndex:0};for(let h=0;h<=7;h++){const v=(a+h)%7;if(o.includes(v)){if(h===0&&n>=u)continue;const g=new Date(i);return g.setDate(i.getDate()+h),g.setHours(d,p,0,0),{type:"upcoming",sortIndex:1,nextTimestamp:g.getTime()}}}return{type:"upcoming",sortIndex:1,nextTimestamp:9999999999999}}function mr(s,o){const{scheduleDays:e,scheduleStartTime:c,scheduleEndTime:r}=s.info;if(!e||!e.length||!c||!r)return null;const[t,i]=c.split(":").map(Number),[a,n]=r.split(":").map(Number),d=t*60+i,p=a*60+n;for(const y of Object.values(o)){if(y===s||y.isDeleted||y.info.name===s.info.name)continue;const m=y.info;if(!m.scheduleDays||!m.scheduleDays.length||!m.scheduleStartTime||!m.scheduleEndTime||!e.some(S=>m.scheduleDays.includes(S)))continue;const[b,h]=m.scheduleStartTime.split(":").map(Number),[v,g]=m.scheduleEndTime.split(":").map(Number),C=b*60+h,E=v*60+g;if(d<E&&p>C)return y.info.name}return null}function hr(s){if(!s||s.length===0)return"";const o={6:"شنبه",0:"۱شنبه",1:"۲شنبه",2:"۳شنبه",3:"۴شنبه",4:"۵شنبه",5:"جمعه"};return[...s].sort((c,r)=>{const t={6:0,0:1,1:2,2:3,3:4,4:5,5:6};return t[c]-t[r]}).map(c=>o[c]).join("، ")}const pr=Object.freeze(Object.defineProperty({__proto__:null,_internalShowPage:Xt,addCategoryBtn:pa,addClassBtn:Qi,addNoteModal:La,addScoreBtn:Oa,addStudentBtn:ia,appHeader:Qn,attendanceListUl:Vt,attendanceMassActionsContainer:Cn,attendancePage:ga,attendancePane:Mt,attendanceSearchInput:vt,backToSessionsBtn:na,backToStudentPageBtn:Na,backupDataBtn:Ea,breadcrumbContainer:Tt,cancelImportBtn:ma,cancelNoteBtn:Ba,categoryListUl:Jn,categoryModal:ja,categoryModalCancelBtn:Za,categoryModalSaveBtn:Si,categoryModalTitle:ki,classListHeader:va,classListUl:Nt,classManagementPage:gi,classSaveNoteBtn:Ta,closeActiveModal:ke,closeContextMenu:bt,closeNavBtn:wa,columnMappingPage:ua,columnSelectDropdown:Xn,confirmColumnBtn:fa,confirmModalCancelBtn:ts,confirmModalConfirmBtn:Ut,confirmModalMessage:Ci,contextMenu:wt,csvCancelBtn:ca,csvConfirmBtn:oa,csvFileInput:da,csvPreviewList:Yn,csvPreviewPage:ra,customConfirmModal:Sa,displayWinner:Me,finishAttendanceBtn:ya,globalStudentSearchInput:jt,globalStudentSearchResultsDiv:at,gradedCategoryPillsContainer:Da,hamburgerMenuBtn:ba,handleUndo:Li,importCsvBtn:la,initiateBackupProcess:an,isGradedCheckbox:za,massCommentAppendCheckbox:Bs,massCommentBtn:is,massCommentCancelBtn:Va,massCommentContent:Yt,massCommentModal:qa,massCommentModalTitle:Ga,massCommentSaveBtn:Ka,massCommentStudentCountMessage:Ii,newCategoryModalIsGradedCheckbox:Ts,newCategoryModalNameInput:Jt,newCategoryNameInput:ha,newClassNameInput:Xi,newNoteContent:we,newScoreCommentTextarea:Ei,newScoreValueInput:Aa,newStudentNameInput:sa,openContextMenu:on,openModal:$e,overlay:_a,pasteArea:vi,processMassHomeworkComment:os,processPasteBtn:aa,profileScoresListUl:Ra,profileStatsSummaryDiv:Ma,quickGradeFormWrapper:Bt,quickGradeSubmitBtn:Ct,quickNoteTextarea:tt,quickScoreInput:ct,renderAttendancePage:st,renderBreadcrumbs:Ni,renderClassList:We,renderClassManagementStats:Wn,renderColumnSelector:Ri,renderGlobalSearchResults:En,renderImportPreview:us,renderLogModal:Bi,renderMassCommentControls:As,renderScoresHistory:Oi,renderSearchResults:qt,renderSessionDashboard:Rt,renderSessions:He,renderSettingsCategories:zt,renderSettingsOther:zi,renderSettingsStudentList:lt,renderStudentNotes:Mi,renderStudentStatsList:Re,renderTrashPage:rn,restoreDataBtn:ka,restoreFileInput:bi,secureConfirmCancelBtn:xa,secureConfirmCode:_i,secureConfirmConfirmBtn:bn,secureConfirmInput:Lt,secureConfirmMessage:wi,secureConfirmModal:Ia,selectStudentBtn:nt,selectStudentBtnWrapper:Ot,sessionDashboardPage:Ja,setAutoDirectionOnInput:Di,settingsClassNameHeader:Ls,settingsPage:ta,settingsStudentListUl:Kn,setupDashboardTabs:xi,setupLongPress:Zt,showCategoryModal:rs,showClassNoteModal:Pn,showCustomConfirm:Ce,showMassCommentModal:Os,showMoveStudentModal:Ns,showNotification:ee,showPage:ge,showRenameStudentModal:Ds,showRestoreConfirmModal:as,showSecureConfirm:Ti,showSessionNoteModal:Ms,showSettingsPage:At,showStudentProfile:ze,showUndoToast:Ya,sideNavMenu:Ca,studentSearchInput:ns,studentSearchResultsDiv:ht,studentStatsHeader:es,switchDashboardTab:sn,trashedCategoriesList:Wa,trashedClassesList:$a,trashedNotesList:Ha,trashedScoresList:Ua,trashedSessionsList:Pa,trashedStudentsList:Fa,triggerFileDownload:cs,undoBtn:ea,undoMessage:yi,undoToast:zn,updateDemoModeBanner:kn},Symbol.toStringTag,{value:"Module"}));function gr(){const s=window.location.hash;if(!s||s==="#")return!1;const[o,e]=s.split("?"),c=o.substring(1),r=new URLSearchParams(e),t=r.get("class"),i=parseInt(r.get("session"),10),a=r.get("student"),n=r.get("tab")||"selector";if(t&&oe[t])Pe(oe[t]),i&&N.getSession(i)&&je(N.getSession(i)),a&&N.students.find(d=>d.identity.studentId===a)&&Ke(N.students.find(d=>d.identity.studentId===a));else return!1;switch(c){case"session-page":He(),ge("session-page");break;case"session-dashboard-page":Rt(c==="attendance-page"?"attendance":n);break;case"settings-page":Ls.textContent=`تنظیمات کلاس: ${N.info.name}`,lt(),zt(),ge("settings-page");break;case"student-profile-page":Rt(n),ze(Ee);break;default:return!1}return!0}document.addEventListener("DOMContentLoaded",()=>{const{globalStudentSearchInput:s,newClassNameInput:o,addClassBtn:e,undoBtn:c,newStudentNameInput:r,addStudentBtn:t,pasteArea:i,processPasteBtn:a,csvPreviewList:n,csvConfirmBtn:d,csvCancelBtn:p,importCsvBtn:y,csvFileInput:m,columnSelectDropdown:u,confirmColumnBtn:b,cancelImportBtn:h,newCategoryNameInput:v,addCategoryBtn:g,selectStudentBtn:C,attendancePage:E,finishAttendanceBtn:S,classListHeader:I,studentStatsHeader:x,hamburgerMenuBtn:L,sideNavMenu:D,closeNavBtn:R,overlay:P,backupDataBtn:Q,restoreDataBtn:k,restoreFileInput:z,confirmModalCancelBtn:f,confirmModalConfirmBtn:W,secureConfirmCancelBtn:ue,secureConfirmConfirmBtn:Z,newNoteContent:fe,classSaveNoteBtn:F,cancelNoteBtn:ne,studentSearchInput:A,studentSearchResultsDiv:M,isGradedCheckbox:re,categoryModalSaveBtn:te,categoryModalCancelBtn:Y,massCommentBtn:Te,massCommentCancelBtn:Ne,massCommentSaveBtn:ve,massCommentContent:_e,massCommentAppendCheckbox:Ae,attendanceSearchInput:Be}=pr,Je=document.getElementById("trash-nav-btn");document.querySelector(".global-search-container .search-icon"),Nn(),kn(),gr()||(We(),ge("class-management-page"));function l(B,G){const U=document.querySelector(B);if(!U)return;const X=U.querySelector(".search-icon"),ae=U.querySelector(".animated-search-input");!X||!ae||(X.addEventListener("mousedown",de=>{de.preventDefault()}),X.addEventListener("click",()=>{U.classList.contains("search-active")||(U.classList.add("search-active"),ae.focus())}),ae.addEventListener("blur",()=>{setTimeout(()=>{U.classList.remove("search-active"),ae.value="",G&&G([])},150)}))}Be.addEventListener("input",()=>{const B=Be.value.toLowerCase().trim(),G=Zn(B);Vt.querySelectorAll(".attendance-list-item").forEach(X=>{const ae=X.querySelector(".student-name");if(ae){const de=ae.textContent,ie=Xe(de.toLowerCase()),me=ie.includes(Xe(B)),be=ie.includes(Xe(G));me||be?X.style.display="flex":X.style.display="none"}})}),Y.addEventListener("click",()=>{ke(),Fn(null)}),te.addEventListener("click",()=>{const B=Jt.value.trim(),G=Ts.checked;typeof Tn=="function"&&Tn(B,G)}),window.addEventListener("scroll",bt),document.addEventListener("click",B=>{wt.classList.contains("visible")&&!wt.contains(B.target)&&bt(),A.contains(B.target)||(M.style.display="none");const G=B.target.closest(".log-action-link");if(G&&G.dataset.action)try{const U=JSON.parse(G.dataset.action);cn(U)}catch(U){console.error("Could not parse log action:",U)}}),Ot.addEventListener("click",()=>{(Ot.classList.contains("disabled-wrapper")||nt.disabled)&&(nt.classList.add("shake-animation"),setTimeout(()=>{nt.classList.remove("shake-animation")},200))}),x.addEventListener("click",()=>{const B=new Date().getTime();B-ys>500?vn(1):vn(xn+1),di(B),xn===5&&(vn(0),Ce("آیا از صفر کردن تمام شمارنده‌های دانش‌آموزان مطمئن هستید؟ این عمل غیرقابل بازگشت است.",()=>{ei(),Re(),ee("تمام آمارها صفر شدند ✅.")},{confirmText:"بله",confirmClass:"btn-warning"}))}),I.addEventListener("click",()=>{const B=new Date().getTime();B-gs>500?yn(1):yn(In+1),li(B),In===5&&(yn(0),Ce("آیا از ساخت یک کلاس تستی تصادفی مطمئن هستید؟",()=>{function G(){const U=`کلاس تستی ${Object.keys(oe).length+1}`,X=new Gn({name:U,type:"online"});["علی رضایی","مریم حسینی","زهرا احمدی","رضا محمدی","فاطمه کریمی"].forEach(de=>X.addStudent(new pn({name:de}))),oe[U]=X,ce(),We()}G(),ee("کلاس تستی با موفقیت ساخته شد ✅!")},{confirmText:"بساز",confirmClass:"btn-success"}))}),ue.addEventListener("click",()=>{ke(),tn(null)}),Z.addEventListener("click",()=>{typeof Ln=="function"&&Ln(),ke(),tn(null)}),f.addEventListener("click",()=>{ke(bs)}),W.addEventListener("click",()=>{ke(vs)}),C.addEventListener("click",()=>{if(ct.value.trim()!==""||tt.value.trim()!==""){ee("⚠️لطفاً ابتدا با دکمه «ثبت»، تغییرات را ذخیره کنید و یا نمره و یادداشت را پاک کنید.");return}if(!N||!K||!Ve)return;const B=N.selectNextWinner(Ve.name,K);if(B){const G=K.studentRecords[B.identity.studentId];if(G&&G.attendance==="absent"&&B.statusCounters.missedChances++,G&&G.hadIssue){B.statusCounters.missedChances++;const X=Ve.name;B.categoryIssues[X]=(B.categoryIssues[X]||0)+1}G&&G.wasOutOfClass&&(B.statusCounters.outOfClassCount=(B.statusCounters.outOfClassCount||0)+1,B.statusCounters.missedChances++);const U={winner:B,categoryName:Ve.name};K.winnerHistory.push(U),K.winnerHistory.length>10&&K.winnerHistory.shift(),gt(K.winnerHistory.length-1),K.lastUsedCategoryId=Ve.id,K.lastSelectedWinnerId=B.identity.studentId,Re(),setTimeout(()=>Me(),0),ce()}else ee("❌دانش‌آموز واجد شرایطی برای انتخاب یافت نشد.")}),g.addEventListener("click",()=>{if(!N)return;const B=v.value.trim(),G=re.checked;if(!B){alert("⚠️لطفاً نام دسته‌بندی را وارد کنید.");return}const U=N.categories.find(ae=>ae.name.toLowerCase()===B.toLowerCase());if(U)if(U.isDeleted){const ae=N.categories.findIndex(de=>de===U);ae>-1&&N.categories.splice(ae,1)}else{alert("⚠️این دسته‌بندی از قبل وجود دارد.");return}const X=new ut(B,"",G);N.categories.push(X),ce(),Se(N.info.name,`دسته‌بندی جدید «${B}» اضافه شد.`,{type:"VIEW_CLASS_SETTINGS"}),zt(),v.value="",re.checked=!1}),document.querySelectorAll('#settings-page input[name="class-type-setting"]').forEach(B=>{B.addEventListener("change",()=>{if(!N)return;const G=B.value,U=N.info.type||"in-person";if(G===U)return;const X=ie=>ie==="online"?"آنلاین":"حضوری",ae=X(U),de=X(G);Ce(`آیا از تغییر نوع کلاس از «${ae}» به «${de}» مطمئن هستید؟`,()=>{N.info.type=G,ce(),Se(N.info.name,`نوع کلاس به «${de}» تغییر یافت.`,{type:"VIEW_CLASS_SETTINGS"}),We(),ee(`✅ نوع کلاس به «${de}» تغییر یافت.`)},{confirmText:"بله",confirmClass:"btn-warning",onCancel:()=>{const ie=document.querySelector(`#settings-page input[name="class-type-setting"][value="${U}"]`);ie&&(ie.checked=!0)}})})});const $=document.querySelectorAll('input[name="schedule-day"]'),_=document.getElementById("settings-schedule-start"),w=document.getElementById("settings-schedule-end");$.forEach(B=>{B.addEventListener("change",()=>{if(!N)return;const G=Array.from($).filter(U=>U.checked).map(U=>parseInt(U.value));N.info.scheduleDays=G,ce()})});const T=()=>{N&&(N.info.scheduleStartTime=_.value,N.info.scheduleEndTime=w.value,ce())};_.addEventListener("change",T),w.addEventListener("change",T),v.addEventListener("keyup",B=>{B.key==="Enter"&&g.click()}),b.addEventListener("click",()=>{if(!Sn){alert("❌خطایی رخ داده است. لطفاً فایل را دوباره انتخاب کنید."),ge("settings-page");return}const B=parseInt(u.value,10),X=Sn.split(`
`).slice(1).map(ae=>{var ie;return(ie=ae.split(",")[B])==null?void 0:ie.trim()}).filter(ae=>ae&&ae.length>0);X.length>0?(Ht(X),us(),ge("csv-preview-page")):alert("هیچ نامی در ستون انتخاب شده پیدا نشد. لطفاً ستون دیگری را امتحان کنید یا فایل خود را بررسی کنید."),gn(null)}),y.addEventListener("click",()=>{m.click()}),m.addEventListener("change",B=>{const G=B.target.files[0];if(!G)return;const U=new FileReader;U.onload=X=>{const ae=X.target.result;gn(ae);const ie=ae.split(`
`)[0].split(",");Ri(ie),ge("column-mapping-page")},U.readAsText(G),B.target.value=null}),h.addEventListener("click",()=>{gn(null),ge("settings-page")}),d.addEventListener("click",()=>{const B=n.querySelectorAll('input[type="checkbox"]:checked');let G=!1;B.forEach(U=>{const X=U.dataset.name,ae=N.students.find(ie=>ie.identity.name.toLowerCase()===X.toLowerCase());if(ae)if(ae.isDeleted)Dn(ae,N);else{console.log(`دانش‌آموز «${X}» به دلیل تکراری بودن اضافه نشد.`);return}const de=new pn({name:X});N.addStudent(de),N.sessions.length>0&&(Ie(N.sessions).filter(ie=>ie.isFinished&&!ie.isCancelled).forEach(ie=>{ie.setAttendance(de.identity.studentId,"absent")}),ft(de,N),G=!0)}),ce(),Se(N.info.name,`${B.length} دانش‌آموز جدید از لیست ورودی به کلاس اضافه شدند.`,{type:"VIEW_SESSIONS"}),lt(),G&&Ge(B.length),ge("settings-page"),i.value="",Ht([])}),p.addEventListener("click",()=>{Ht([]),ge("settings-page")}),a.addEventListener("click",()=>{const B=i.value.trim();if(!B){alert("کادر متنی خالی است. لطفاً اسامی را وارد کنید.");return}const G=B.split(`
`).map(U=>U.trim()).filter(U=>U.length>0);G.length>0?(Ht(G),us(),ge("csv-preview-page")):alert("هیچ نام معتبری برای ورود پیدا نشد.")}),r.addEventListener("keyup",B=>{B.key==="Enter"&&t.click()}),t.addEventListener("click",()=>{if(!N)return;const B=r.value.trim();if(!B){alert("لطفاً نام دانش‌آموز را وارد کنید.");return}const G=N.students.find(X=>X.identity.name.toLowerCase()===B.toLowerCase());if(G)if(G.isDeleted)Dn(G,N);else{alert("❌دانش‌آموزی با این نام از قبل در این کلاس وجود دارد.");return}const U=new pn({name:B});N.addStudent(U),N.sessions.length>0&&(Ie(N.sessions).filter(X=>X.isFinished&&!X.isCancelled).forEach(X=>{X.setAttendance(U.identity.studentId,"absent")}),ft(U,N),Ge(1)),ce(),Se(N.info.name,`دانش‌آموز «${B}» به کلاس اضافه شد.`,{type:"VIEW_STUDENT_PROFILE",studentId:U.identity.studentId}),lt(),Re(),r.value="",r.focus()}),document.getElementById("new-session-btn").addEventListener("click",()=>{if(N){const B=N.sessions.find(U=>!U.isFinished&&!U.isCancelled&&!U.isDeleted);if(B){ee(`⚠️ جلسه ${B.sessionNumber} هنوز تمام نشده است. لطفاً ابتدا با دکمه ✅ آن را خاتمه دهید.`);return}const G=()=>{const U=X=>{const ae=N.startNewSession();en(ae),je(ae),N.students.forEach(me=>{ms.setAttendance(me.identity.studentId,"present")}),ce();const ie=Qe(N).get(ae.sessionNumber);Se(N.info.name,`جلسه ${ie} شروع شد.`,{type:"VIEW_SESSIONS"}),Rt(X?"attendance":"selector")};Ce("آیا تمایل به انجام فرآیند حضور و غیاب دارید؟",()=>U(!0),{confirmText:"بله",cancelText:"خیر",confirmClass:"btn-success",onCancel:()=>U(!1)})};N.hasSessionToday()?Ce("شما امروز یک جلسه برای این کلاس ثبت کرده‌اید. آیا از شروع یک جلسه جدید دیگر مطمئن هستید؟",G,{confirmText:"بله",confirmClass:"btn-warning"}):G()}}),e.addEventListener("click",()=>{const B=o.value.trim(),G=document.querySelector('input[name="class-type"]:checked');if(!B&&!G){ee("⚠️لطفاً نام و نوع کلاس را مشخص کنید.");return}if(!B){ee("⚠️لطفاً نام کلاس را وارد کنید.");return}if(!G){ee("⚠️لطفاً نوع کلاس را انتخاب کنید.");return}if(oe[B]){oe[B].isDeleted?ee("⚠️ کلاسی با این نام در سطل زباله است. ابتدا آن را بازیابی کنید و یا آن را پاک کنید."):ee("⚠️کلاسی با این نام از قبل وجود دارد.");return}const U=G.value,X=new Gn({name:B,type:U});oe[B]=X,ce(),Se(B,`کلاس «${B}» ایجاد شد.`,{type:"VIEW_SESSIONS"}),We(),ee(`✅ کلاس «${B}» با موفقیت ایجاد شد.`),o.value="",G.checked=!1}),s.addEventListener("input",B=>{const G=B.target.value;if(G.length<2){En([]);return}const U=G.toLowerCase(),X=Zn(U),ae=[];for(const de in oe){const ie=oe[de];if(ie.isDeleted)continue;const me=Xe(de.toLowerCase()),be=me.includes(Xe(U)),xe=me.includes(Xe(X));(be||xe)&&ae.push({type:"classroom",classroom:ie})}for(const de in oe){const ie=oe[de];if(ie.isDeleted)continue;Ie(ie.students).filter(be=>{const xe=Xe(be.identity.name.toLowerCase()),Oe=xe.includes(Xe(U)),Pt=xe.includes(Xe(X));return Oe||Pt}).forEach(be=>{ae.push({type:"student",student:be,classroom:ie})})}En(ae)}),o.addEventListener("keyup",B=>{B.key==="Enter"&&e.click()}),c.addEventListener("click",Li),S.addEventListener("click",()=>{sn("selector")}),A.addEventListener("input",B=>{const G=B.target.value;if(!G){qt([]);return}const U=G.toLowerCase(),X=Zn(U),de=Ie(N.students).filter(ie=>{const me=Xe(ie.identity.name.toLowerCase()),be=me.includes(Xe(U)),xe=me.includes(Xe(X));return be||xe});qt(de)}),A.addEventListener("focus",()=>{A.value&&qt(A.value)}),Ct.addEventListener("click",()=>{const B=ct.value,G=tt.value.trim();let U;if(Bn)U=Bn.student;else{const ae=K==null?void 0:K.winnerHistory[Ue];U=ae==null?void 0:ae.winner}if(!U){ee("❌خطا: دانش‌آموز معتبری برای ثبت نمره یافت نشد.");return}const X=Ve;if(!U||!X){ee("⚠️لطفاً ابتدا یک دانش‌آموز و یک دسته‌بندی را انتخاب کنید.");return}if(!B){ee("⚠️لطفاً مقدار نمره را وارد کنید.");return}if(B>100||B<0){ee("❌نمره نباید از ۱۰۰ بیشتر و از صفر کمتر باشد");return}U&&(U.addScore(X.name,parseFloat(B),G),Se(N.info.name,`نمره ${B} در ${X.name} برای «${U.identity.name}» ثبت شد.`,{type:"VIEW_STUDENT_PROFILE",studentId:U.identity.studentId}),ce(),Re(),ee(`✅نمره برای ${U.identity.name} در مهارت ${X.name} ثبت شد.`),ct.value="",tt.value="",Me())});const j=B=>{B.key==="Enter"&&B.ctrlKey&&(B.preventDefault(),Ct.click())};ct.addEventListener("keydown",j),tt.addEventListener("keydown",j),ne.addEventListener("click",()=>{ke()}),F.addEventListener("click",()=>{const B=fe.value.trim(),G=Cs;ke(()=>{typeof G=="function"&&G(B)})});const q=document.getElementById("move-student-confirm-btn"),O=document.getElementById("move-student-cancel-btn"),V=document.getElementById("move-student-class-select");O.addEventListener("click",()=>{ke()}),q.addEventListener("click",()=>{const B=V.value,G=oe[B],{studentToMove:U,sourceClassForMove:X}=Vi;if(!U||!X||!G){ee("خطایی رخ داد. لطفاً دوباره امتحان کنید⚠️.","error"),ke();return}const ae=Qs(U,X,G);ae.success?(Se(X.info.name,`دانش‌آموز «${U.identity.name}» به کلاس «${B}» منتقل شد.`,{type:"VIEW_SESSIONS"}),Se(B,`دانش‌آموز «${U.identity.name}» از کلاس «${X.info.name}» به این کلاس منتقل شد.`,{type:"VIEW_SESSIONS"}),ce(),lt(),Re(),st(),ee(`دانش‌آموز «${U.identity.name}» با موفقیت به کلاس «${B}» منتقل شد✅.`)):ee(ae.message,"error"),ke()}),L.addEventListener("click",()=>{D.style.width="300px",P.classList.add("modal-visible")}),L.addEventListener("click",()=>{D.style.width="300px",P.classList.add("modal-visible")});const se=document.getElementById("header-settings-btn");se&&se.addEventListener("click",()=>{N&&At(N)}),R.addEventListener("click",he),R.addEventListener("click",he),P.addEventListener("click",he),Je.addEventListener("click",()=>{rn(),ge("trash-page"),he()}),document.getElementById("demo-mode-btn").addEventListener("click",()=>{ot?ye():(he(),Ce("شما در حال ورود به حالت نمایش (Demo) هستید. در این حالت، هیچ‌کدام از تغییرات شما ذخیره نخواهد شد. آیا ادامه می‌دهید؟",()=>{ai(),kn(),he()},{confirmText:"تایید",confirmClass:"btn-warning",onCancel:he}))});const le=document.getElementById("exit-demo-btn");le&&le.addEventListener("click",()=>{ot&&ye()}),Q.addEventListener("click",()=>{if(ot){ee("⚠️ پشتیبان‌گیری در حالت نمایش (Demo) غیرفعال است."),he();return}he(),an()}),k.addEventListener("click",()=>{if(ot){ee("⚠️ بازیابی اطلاعات در حالت نمایش (Demo) غیرفعال است."),he();return}z.click(),he()}),z.addEventListener("change",B=>{const G=B.target.files[0];if(!G)return;const U=new FileReader;U.onload=async X=>{const ae=X.target.result;try{const de=JSON.parse(ae);if(de.metadata&&de.data)as(de);else{const ie=de.classrooms||de,me=de.trashBin||[];Ce("آیا از بازیابی اطلاعات مطمئن هستید؟ تمام داده‌های فعلی شما بازنویسی خواهد شد.",()=>{Et(ie),Rn(me),Gt({lastRestoreTimestamp:new Date().toISOString()}),ce(),We(),ge("class-management-page"),ee("✅اطلاعات با موفقیت بازیابی شد.")},{confirmText:"بازیابی کن",confirmClass:"btn-warning"})}}catch{try{const be=(await new Us().loadAsync(ae,{base64:!0})).file("backup.json");if(!be)throw new Error("فایل backup.json در فایل پشتیبان یافت نشد.");const xe=await be.async("string"),Oe=JSON.parse(xe);if(Oe.metadata&&Oe.metadata.version==="2.0-b64")as(Oe);else throw new Error("فایل پشتیبان معتبر نیست (نسخه نامشخص).")}catch(ie){ee("❌خطا در خواندن فایل. لطفاً فایل پشتیبان معتبر انتخاب کنید."),console.error("Restore error (zip/base64):",ie)}}},U.readAsText(G),B.target.value=null}),window.addEventListener("popstate",B=>{if(pt){ke(null,!0);return}if(bt(),B.state){const{pageId:G,currentClassName:U,selectedSessionNumber:X,selectedStudentId:ae}=B.state;U&&(Pe(oe[U]),X&&je(N.getSession(X)),ae&&Ke(N.students.find(de=>de.identity.studentId===ae))),G==="session-page"?(He(),Xt(G)):G==="student-profile-page"?(He(),ge("session-page"),ze(Ee)):Xt(G)}else Pe(null),je(null),Ke(null),Xt("class-management-page")}),document.addEventListener("keydown",B=>{var X;const G=document.activeElement;if(!["INPUT","TEXTAREA","SELECT"].includes(G.tagName)){if(B.key.toLowerCase()==="o"&&B.shiftKey&&gi.classList.contains("active")&&(B.preventDefault(),bi.click()),B.key==="Escape"){if(wt.classList.contains("visible")){bt();return}if(pt){ke();return}switch((X=document.querySelector(".page.active"))==null?void 0:X.id){case"csv-preview-page":case"column-mapping-page":ge("settings-page");break;case"student-profile-page":Ke(null),ge(K?"student-page":"session-page");break;case"attendance-page":ge("student-page");break;case"student-page":je(null),He(),ge("session-page");break;case"settings-page":case"session-page":Pe(null),ge("class-management-page");break}return}if(K){const ae=B.key.toLowerCase();switch(" ascfg".includes(ae)&&B.preventDefault(),ae){case" ":C.click();break;case"a":E.classList.contains("active")?history.back():(st(),ge("attendance-page"));break;case"s":document.getElementById("session-page").classList.contains("active")&&history.back();break;case"c":document.querySelector(".back-to-classes-btn").click();break;case"f":const de=document.querySelector(".action-column .search-icon");de&&de.click();break;case"g":if(studentProfilePage.classList.contains("active"))history.back();else{const ie=K.lastSelectedWinnerId;if(ie){const me=N.students.find(be=>be.identity.studentId===ie);me&&(Ke(me),(void 0)(),ge("student-profile-page"))}else ee("⚠️ابتدا یک نفر را انتخاب کنید تا پروفایل او نمایش داده شود.")}break;case"arrowleft":{const ie=document.querySelector('button[title="برنده قبلی"]');ie&&!ie.disabled&&(B.preventDefault(),ie.click());break}case"arrowright":{const ie=document.querySelector('button[title="برنده بعدی"]');ie&&!ie.disabled&&(B.preventDefault(),ie.click());break}}}}});function he(){D.style.width="0",P.classList.add("modal-closing"),setTimeout(()=>{P.classList.remove("modal-visible","modal-closing")},300)}function ye(){Ce("آیا از خروج از حالت نمایش (Demo) مطمئن هستید؟ با خروج، تمام تغییرات آزمایشی شما حذف شده و داده‌های اصلی شما بازیابی خواهند شد.",()=>{ri(),Pe(null),je(null),Ke(null),We(),ge("class-management-page"),kn(),he()},{confirmText:"خروج",confirmClass:"btn-success"})}l(".global-search-container .animated-search-container",En),l(".action-column-header .animated-search-container",qt),vr(),[we,Ei,tt,vi].forEach(B=>{B&&Di(B)});function ft(B,G){const U=Ie(G.students).filter(Le=>Le.identity.studentId!==B.identity.studentId);if(U.length===0)return;const X=U.reduce((Le,Fe)=>Fe.statusCounters.totalSelections>Le.statusCounters.totalSelections?Fe:Le,U[0]);if(!X||X.statusCounters.totalSelections===0)return;B.categoryCounts=JSON.parse(JSON.stringify(X.categoryCounts)),B.statusCounters.totalSelections=X.statusCounters.totalSelections;const ae=U.reduce((Le,Fe)=>Le+Fe.statusCounters.totalSelections,0),de=U.reduce((Le,Fe)=>Le+(Fe.statusCounters.missedChances||0),0),ie=ae>0?de/ae:0;B.statusCounters.missedChances=Math.round(B.statusCounters.totalSelections*ie);const me=Ie(G.categories),be={};me.forEach(Le=>{const Fe=U.reduce((Un,jn)=>Un+(jn.categoryCounts[Le.name]||0),0),Hn=U.reduce((Un,jn)=>Un+(jn.categoryIssues[Le.name]||0),0);be[Le.name]=Fe>0?Hn/Fe:0}),me.forEach(Le=>{const Fe=B.categoryCounts[Le.name]||0,Hn=be[Le.name]||0;B.categoryIssues[Le.name]=Math.round(Fe*Hn)});const xe=G.liveSession;xe?B.onboardingSession=xe.sessionNumber:B.onboardingSession=G.sessions.length+1;const Oe=Ie(G.sessions).filter(Le=>Le.isFinished&&!Le.isCancelled),Pt="📝 یادداشت خودکار سیستم",Pi=`این دانش‌آموز  از جلسه شماره ${Oe.length} به کلاس اضافه شد. آمار مشارکت او بر اساس فعال‌ترین دانش‌آموز و آمار «فرصت از دست رفته» او بر اساس میانگین کلاس ثبت گردید:`,It=[];B.statusCounters.totalSelections>0&&It.push(`کل انتخاب‌ها: ${B.statusCounters.totalSelections}`),B.statusCounters.missedChances>0&&It.push(`فرصت‌های از دست رفته: ${B.statusCounters.missedChances}`);for(const Le in B.categoryCounts){const Fe=B.categoryCounts[Le];Fe>0&&It.push(`انتخاب در «${Le}»: ${Fe}`)}for(const Le in B.categoryIssues){const Fe=B.categoryIssues[Le];Fe>0&&It.push(`مشکل در «${Le}»: ${Fe}`)}if(It.length>0){const Le=`${Pt}
${Pi}

- ${It.join(`
- `)}`;B.addNote(Le)}}function Ge(B){const U=`چون این کلاس جلسات برگزار شده دارد، برای ${B>1?"دانش‌آموزان جدید":"دانش‌آموز جدید"} آمار پایه‌ای (متناسب با سایر دانش‌آموزان) ثبت شد تا در فرایند انتخاب اختلالی ایجاد نشود.`;Ce(U,()=>{},{confirmText:"متوجه شدم",confirmClass:"btn-success",onCancel:null})}const yt="12.0.1",De="737";{const B=` (ساخت ${De})`;document.getElementById("app-version").textContent=`نسخه ${yt}${B}`}function kt(){console.log("Starting universal backfill for writing scores...");let B=0;for(const G in oe){const U=oe[G];if(U.isDeleted)continue;let X=0;Ie(U.students).forEach(de=>{const ie=de.logs.scores;if(!(ie&&ie.writing&&ie.writing.length>0)){let be=-1;for(const xe in ie)xe!=="writing"&&ie[xe].forEach(Oe=>{Oe.value>be&&(be=Oe.value)});if(be>-1){const xe=`Automatically assigned based on the highest score (${be}) from other skills.`;de.addScore("Writing",be,xe),X++}}}),X>0&&(console.log(`Updated ${X} student(s) in class: ${U.info.name}.`),B+=X)}B>0?(ce(),console.log(`Update complete. A total of ${B} student(s) were updated across all classes. Data saved.`),document.getElementById("student-page").classList.contains("active")&&Re()):console.log("No students needed updating in any class.")}window.backfillWritingScoresForAll=kt;function $t(){console.log("Starting backfill for 'outOfClassCount' and 'wasOutOfClass' properties...");let B=0,G=0;const U=localStorage.getItem("teacherAssistantData_v2");if(!U){console.log("No data found in localStorage. Nothing to do.");return}const X=JSON.parse(U);for(const ae in X){const de=X[ae];de.students&&de.students.forEach(ie=>{ie.statusCounters&&typeof ie.statusCounters.outOfClassCount>"u"&&(ie.statusCounters.outOfClassCount=0,B++)}),de.sessions&&de.sessions.forEach(ie=>{if(ie.studentRecords)for(const me in ie.studentRecords){const be=ie.studentRecords[me];typeof be.wasOutOfClass>"u"&&(be.wasOutOfClass=!1,G++)}})}localStorage.setItem("teacherAssistantData_v2",JSON.stringify(X)),console.log(`Backfill complete. Updated ${B} students and ${G} session records. Data saved.`),Nn(),N&&Re()}window.backfillExitCounters=$t;function et(){console.log("🧹 Starting orphaned data cleanup...");let B=0;for(const G in oe){const U=oe[G];if(U.isDeleted)continue;let X=!1;const ae=new Set(U.students.filter(me=>!me.isDeleted).map(me=>me.identity.studentId)),de=new Map(U.students.map(me=>[me.identity.studentId,me.identity.name])),ie=[];U.sessions.forEach(me=>{if(me.isDeleted)return;const be=[];for(const xe in me.studentRecords)if(!ae.has(xe)){const Oe=de.get(xe)||"Unknown/Deleted";be.push(`  - Removed student record for: ${Oe} (ID: ${xe})`),delete me.studentRecords[xe],B++,X=!0}for(const xe in me.lastWinnerByCategory){const Oe=me.lastWinnerByCategory[xe];if(!ae.has(Oe)){const Pt=de.get(Oe)||"Unknown/Deleted";be.push(`  - Removed '${xe}' last winner: ${Pt} (ID: ${Oe})`),delete me.lastWinnerByCategory[xe],B++,X=!0}}if(me.lastSelectedWinnerId&&!ae.has(me.lastSelectedWinnerId)){const xe=me.lastSelectedWinnerId,Oe=de.get(xe)||"Unknown/Deleted";be.push(`  - Cleared 'lastSelectedWinnerId': ${Oe} (ID: ${xe})`),me.lastSelectedWinnerId=null,B++,X=!0}if(be.length>0){const Oe=Qe(U).get(me.sessionNumber)||`(#${me.sessionNumber})`;ie.push({sessionDisplayNumber:Oe,logs:be})}}),X&&(console.group(`➡️ Class: ${G}`),ie.forEach(me=>{console.groupCollapsed(`  Session ${me.sessionDisplayNumber}`),me.logs.forEach(be=>console.warn(be)),console.groupEnd()}),console.groupEnd())}B>0?(ce(),console.log(`✅ Cleanup complete! Found and removed ${B} orphaned references. Data saved.`)):console.log("✅ No orphaned data found. Your data is clean!")}window.cleanupOrphanedData=et;function cn(B){if(!B||!B.classroomName)return;const G=oe[B.classroomName];if(!G){ee("⚠️ کلاس مربوط به این گزارش یافت نشد.");return}Pe(G),ke(),setTimeout(()=>{switch(B.type){case"VIEW_STUDENT_PROFILE":{const U=G.students.find(X=>X.identity.studentId===B.studentId);U?ze(U):ee("⚠️ دانش‌آموز مورد نظر یافت نشد.");break}case"VIEW_TRASH":rn(),ge("trash-page");break;case"VIEW_SESSIONS":He(),ge("session-page");break;case"VIEW_CLASS_NOTE":Pn(G);break;case"VIEW_CLASS_SETTINGS":At(G);break}},300)}Te.addEventListener("click",()=>{Os()}),Ne.addEventListener("click",()=>{ke()}),ve.addEventListener("click",()=>{const B=_e.value.trim(),G=Ae.checked;if(!B){Bs.style.display==="flex"?Ce("کادر یادداشت خالی است. آیا مطمئنید که می‌خواهید یادداشت‌های قبلی دانش‌آموزان انتخاب‌شده را پاک کنید؟",()=>{ke(),os("",!1)},{confirmText:"پاک کردن",confirmClass:"btn-warning"}):ee("⚠️ لطفاً متن یادداشت را وارد کنید.");return}ke(()=>{os(B,G)})});const dt=document.getElementById("screen-saver-overlay"),ln=document.getElementById("screen-saver-toggle");let Ft;const dn=2*60*1e3,mt=["mousemove","keypress","scroll","click","touchstart"];function St(){dt.classList.add("visible")}function zs(){dt.classList.contains("visible")&&dt.classList.remove("visible")}function un(){zs(),clearTimeout(Ft),Ft=setTimeout(St,dn)}function fn(B){B.preventDefault(),B.stopPropagation(),setTimeout(un,0)}function $s(){un(),mt.forEach(G=>window.addEventListener(G,un)),dt.addEventListener("click",fn),dt.addEventListener("touchstart",fn);const B="12.0.1";{const G=document.getElementById("screen-saver-version");G&&(G.textContent=`v${B}`)}}function Fi(){clearTimeout(Ft),zs(),mt.forEach(B=>window.removeEventListener(B,un)),dt.removeEventListener("click",fn),dt.removeEventListener("touchstart",fn)}ln.checked=Ze.isScreenSaverEnabled,Ze.isScreenSaverEnabled&&$s(),ln.addEventListener("change",B=>{B.target.checked?(Gt({isScreenSaverEnabled:!0}),$s()):(he(),B.preventDefault(),Ce(`نکته:
محافظ صفحه در تلفن های همراه جدید کمک می کند که دستگاه باطری کمتری مصرف کند و به دلیل ثابت ماندن صفحه نمایش در گوشی های قدیمی تر، صفحه نمایش دچار ماندگی رد پیکسل نگردد. آیا مطمئن هستید که می خواهید این ویژگی را غیر فعال کنید؟`,()=>{B.target.checked=!1,Gt({isScreenSaverEnabled:!1}),Fi(),ee("توصیه می شود زمان خاموش شدن صفحه نمایش گوشی خود را به حداقل دو دقیقه تغییر دهید تا در استفاده های طولانی مدت صفحه نمایش گوشی اصطحلاک کمتری را تجربه کند",7e3)},{confirmText:"بله، غیرفعال کن",cancelText:"لغو",onCancel:()=>{B.target.checked=!0}}))})});function yr(s,o){if(!K||K.isFinished){ee("⚠️ امکان لغو انتخاب در جلسه خاتمه یافته وجود ندارد.");return}const e=K.winnerHistory;if(!(Ue===e.length-1)||e.length===0){ee("⚠️ فقط آخرین انتخاب قابل لغو است.");return}if(e[e.length-1].winner.identity.studentId!==s.identity.studentId){console.error("Undo mismatch!");return}Ce(`آیا از حذف انتخاب «${s.identity.name}» برای «${o}» مطمئن هستید؟ آمار این انتخاب بازگردانی خواهد شد.`,()=>{const r=K.winnerHistory,t=r.pop();if(!t)return;const i=t.winner,a=t.categoryName,n=i.identity.studentId;i.statusCounters.totalSelections=Math.max(0,i.statusCounters.totalSelections-1),i.categoryCounts[a]&&(i.categoryCounts[a]=Math.max(0,i.categoryCounts[a]-1));const d=K.studentRecords[n];d&&d.selections[a]&&(d.selections[a]=Math.max(0,d.selections[a]-1));let p=null;for(let y=r.length-1;y>=0;y--)if(r[y].categoryName===a){p=r[y].winner.identity.studentId;break}p?K.lastWinnerByCategory[a]=p:delete K.lastWinnerByCategory[a],gt(r.length-1),Re(),Me(),ce(),ee(`✅ انتخاب «${i.identity.name}» لغو شد.`)},{confirmText:"بله",confirmClass:"btn-warning"})}function vr(){const s=document.getElementById("session-dashboard-page"),o=document.getElementById("student-stats-table-container");if(!s)return;let e=0,c=0;s.addEventListener("touchstart",t=>{if(o&&o.contains(t.target)){const i=t.target.closest("td, th");i&&i.parentElement.firstElementChild===i?e=t.changedTouches[0].screenX:e=0}else e=t.changedTouches[0].screenX},{passive:!0}),s.addEventListener("touchend",t=>{e!==0&&(c=t.changedTouches[0].screenX,r())});function r(){const i=e-c;Math.abs(i)>150&&(document.getElementById("selector-tab-btn").classList.contains("active")?(ge("session-dashboard-page",{tab:"attendance"}),sn("attendance")):(ge("session-dashboard-page",{tab:"selector"}),sn("selector"))),e=0,c=0}}
