const Er=Object.freeze(Object.defineProperty({__proto__:null,get closeSideNav(){return qe},get handleUndoLastSelection(){return br},get navigateUpHierarchy(){return ji},get pickAssessmentWinner(){return Cr},get syncAssessmentModeUI(){return ws},get toggleSelectionModes(){return qi}},Symbol.toStringTag,{value:"Module"}));(function(){const s=document.createElement("link").relList;if(s&&s.supports&&s.supports("modulepreload"))return;for(const a of document.querySelectorAll('link[rel="modulepreload"]'))c(a);new MutationObserver(a=>{for(const n of a)if(n.type==="childList")for(const r of n.addedNodes)r.tagName==="LINK"&&r.rel==="modulepreload"&&c(r)}).observe(document,{childList:!0,subtree:!0});function t(a){const n={};return a.integrity&&(n.integrity=a.integrity),a.referrerPolicy&&(n.referrerPolicy=a.referrerPolicy),a.crossOrigin==="use-credentials"?n.credentials="include":a.crossOrigin==="anonymous"?n.credentials="omit":n.credentials="same-origin",n}function c(a){if(a.ep)return;a.ep=!0;const n=t(a);fetch(a.href,n)}})();const Sr="modulepreload",_r=function(e){return"/"+e},Gi={},kr=function(s,t,c){let a=Promise.resolve();if(t&&t.length>0){document.getElementsByTagName("link");const r=document.querySelector("meta[property=csp-nonce]"),i=(r==null?void 0:r.nonce)||(r==null?void 0:r.getAttribute("nonce"));a=Promise.allSettled(t.map(o=>{if(o=_r(o),o in Gi)return;Gi[o]=!0;const l=o.endsWith(".css"),f=l?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${o}"]${f}`))return;const m=document.createElement("link");if(m.rel=l?"stylesheet":Sr,l||(m.as="script"),m.crossOrigin="",m.href=o,i&&m.setAttribute("nonce",i),document.head.appendChild(m),l)return new Promise((h,u)=>{m.addEventListener("load",h),m.addEventListener("error",()=>u(new Error(`Unable to preload CSS for ${o}`)))})}))}function n(r){const i=new Event("vite:preloadError",{cancelable:!0});if(i.payload=r,window.dispatchEvent(i),!i.defaultPrevented)throw r}return a.then(r=>{for(const i of r||[])i.status==="rejected"&&n(i.reason);return s().catch(n)})},Nt={ili:{id:"ili",label:"Ú©Ø§Ù†ÙˆÙ† Ø²Ø¨Ø§Ù† Ø§ÛŒØ±Ø§Ù†",ageGroups:{kids:["Primer 1","Primer 2","Step Up 1","Step Up 2","Step Up 3","Step Up 4","Move Up 1","Move Up 2","Move Up 3","Move Up 4","Jump Up 1","Jump Up 2","Jump Up 3","Jump Up 4"],youngAdults:["Start 1","Run 1","Run 2","Run 3","Run 4","Race 1","Race 2","Race 3","Reach 1","Reach 2","Reach 3","Reach 4"],adults:["Basic 1","Basic 2","Basic 3","Elementary 1","Elementary 2","Elementary 3","Pre-intermediate 1","Pre-intermediate 2","Pre-intermediate 3","Intermediate 1","Intermediate 2","Intermediate 3","High-intermediate 1","High-intermediate 2","High-intermediate 3","Advanced 1","Advanced 2","Advanced 3"]},levels:[]},school:{id:"school",label:"Ø¢Ù…ÙˆØ²Ø´ Ùˆ Ù¾Ø±ÙˆØ±Ø´",levels:["Ú©Ù„Ø§Ø³ Ø§ÙˆÙ„","Ú©Ù„Ø§Ø³ Ø¯ÙˆÙ…","Ú©Ù„Ø§Ø³ Ø³ÙˆÙ…","Ú©Ù„Ø§Ø³ Ú†Ù‡Ø§Ø±Ù…","Ú©Ù„Ø§Ø³ Ù¾Ù†Ø¬Ù…","Ú©Ù„Ø§Ø³ Ø´Ø´Ù…","Ú©Ù„Ø§Ø³ Ù‡ÙØªÙ…","Ú©Ù„Ø§Ø³ Ù‡Ø´ØªÙ…","Ú©Ù„Ø§Ø³ Ù†Ù‡Ù…","Ú©Ù„Ø§Ø³ Ø¯Ù‡Ù…","Ú©Ù„Ø§Ø³ ÛŒØ§Ø²Ø¯Ù‡Ù…","Ú©Ù„Ø§Ø³ Ø¯ÙˆØ§Ø²Ø¯Ù‡Ù…"]},custom:{id:"custom",label:"Ø³Ø§ÛŒØ± / Ø¢Ø²Ø§Ø¯",levels:[]}};Nt.ili.levels=[...Nt.ili.ageGroups.kids,...Nt.ili.ageGroups.youngAdults,...Nt.ili.ageGroups.adults];const Qi={ili:{default:[{name:"Ø¹Ù…ÙˆÙ…ÛŒ",description:"Ø¯Ø³ØªÙ‡â€ŒØ¨Ù†Ø¯ÛŒ Ù¾ÛŒØ´â€ŒÙØ±Ø¶",isGraded:!0,weight:1}],levels:{}}};Nt.ili.ageGroups.adults.forEach(e=>{Qi.ili.levels[e]=[{name:"Listen-Speak",description:"Listening and Speaking",isGraded:!0,weight:3},{name:"Reading",description:"",isGraded:!0,weight:2},{name:"Writing",description:"",isGraded:!0,weight:1}]});function Ir(e,s){const t=Qi[e];if(!t)return[new pn("Ø¹Ù…ÙˆÙ…ÛŒ","Ø¯Ø³ØªÙ‡â€ŒØ¨Ù†Ø¯ÛŒ Ù¾ÛŒØ´â€ŒÙØ±Ø¶",!0,1)];let c=t.levels[s];return c||(c=t.default),c.map(a=>new pn(a.name,a.description||"",a.isGraded||!1,a.weight||1))}class jn{constructor(s){this.identity={name:s.name,firstName:s.firstName||null,lastName:s.lastName||null,studentId:s.studentId||`id_${new Date().getTime()}_${Math.random()}`,branchName:s.branchName||null,ageGroup:s.ageGroup||"adult",level:s.level||null,contact:{social:s.socialContact||null,parent:s.parentContact||null}},this.isDeleted=!1,this.statusCounters={totalSelections:0,missedChances:0,earlyLeaves:0,outOfClassCount:0},this.categoryCounts={},this.categoryIssues={},this.qualitativeStats={},this.logs={parentContacts:[],scores:{},discipline:{},sessionHistory:{}},this.profile={notes:[],tags:[]},this.finalClassActivityScore=null,this.onboardingSession=null}addScore(s,t,c){if(t>100||t<0){console.log("Ù†Ù…Ø±Ù‡ Ù†Ø¨Ø§ÛŒØ¯ Ø§Ø² Û±Û°Û° Ø¨ÛŒØ´ØªØ± Ùˆ Ø§Ø² ØµÙØ± Ú©Ù…ØªØ± Ø¨Ø§Ø´Ø¯");return}const a=s.toLowerCase();this.logs.scores[a]||(this.logs.scores[a]=[]);const n=new xr(s,t,c);this.logs.scores[a].push(n)}addNote(s,t=null){const c=new Lr(s,t);this.profile.notes.push(c)}getOverallAverageScore(s=[]){let t=0,c=0,a=!1;for(const r in this.logs.scores){const i=this.logs.scores[r].filter(m=>!m.isDeleted);if(i.length===0)continue;a=!0;const o=s.find(m=>m.name.toLowerCase()===r),l=o&&o.isGradedCategory?o.weight||1:0;if(l===0)continue;const f=i.reduce((m,h)=>m+h.value,0)/i.length;t+=f*l,c+=l}if(!a||c===0)return null;const n=t/c;return Math.trunc(n*10)/10}}class xr{constructor(s,t,c=""){this.id=`score_${new Date().getTime()}`,this.skill=s,this.value=t,this.timestamp=new Date,this.comment=c,this.isDeleted=!1}}class Lr{constructor(s,t=null){this.id=`note_${new Date().getTime()}`,this.timestamp=new Date,this.content=s,this.isDeleted=!1,this.source=t}}class Ls{constructor(s="complete",t=""){this.status=s,this.comment=t,this.timestamp=new Date}}class ea{constructor(s){this.sessionNumber=s,this.startTime=new Date,this.createdAt=new Date,this.note="",this.isDeleted=!1,this.endTime=null,this.isFinished=!1,this.isMakeup=!1,this.isCancelled=!1,this.studentRecords={},this.lastWinnerByCategory={},this.lastUsedCategoryId=null,this.lastSelectedWinnerId=null,this.winnerHistory=[]}end(){this.isFinished=!0,this.endTime=new Date}markAsMakeup(){this.isMakeup=!this.isMakeup}initializeStudentRecord(s){this.studentRecords[s]||(this.studentRecords[s]={attendance:"present",homework:new Ls,selections:{},hadIssue:!1,wasOutOfClass:!1,performanceRatings:{}})}setAttendance(s,t){this.initializeStudentRecord(s),this.studentRecords[s].attendance=t}setHomeworkStatus(s,t){this.initializeStudentRecord(s),this.studentRecords[s].homework.status=t}selectNextWinner(s,t,c){if(!t||t.length===0)return console.log("Ù‡ÛŒÚ† Ø¯Ø§Ù†Ø´â€ŒØ¢Ù…ÙˆØ²ÛŒ Ø¯Ø± Ú©Ù„Ø§Ø³ Ø¨Ø±Ø§ÛŒ Ø§Ù†ØªØ®Ø§Ø¨ ÙˆØ¬ÙˆØ¯ Ù†Ø¯Ø§Ø±Ø¯."),null;const a=this.lastWinnerByCategory[s];let n=t.filter(h=>h.identity.studentId!==a&&!h.isDeleted);if(n.length===0&&(n=t),n.length===0)return null;const r=(h,u)=>h.categoryCounts[u]||0,i=Math.min(...n.map(h=>r(h,s))),o=n.filter(h=>r(h,s)===i);let l;if(o.length===1)l=o[0];else if(o.length>1){const h=c.filter(b=>!b.isDeleted&&b.name!==s).map(b=>b.name),u=o.map(b=>{const v=h.reduce((C,S)=>C+r(b,S),0);return{student:b,otherCategoriesTotal:v}}),y=Math.min(...u.map(b=>b.otherCategoriesTotal)),p=u.filter(b=>b.otherCategoriesTotal===y).map(b=>b.student);p.length===1?l=p[0]:l=p[Math.floor(Math.random()*p.length)]}else l=n[Math.floor(Math.random()*n.length)];const f=l.identity.studentId;this.initializeStudentRecord(f);const m=(this.studentRecords[f].selections[s]||0)+1;return this.studentRecords[f].selections[s]=m,l.statusCounters.totalSelections++,l.categoryCounts[s]=(l.categoryCounts[s]||0)+1,this.lastWinnerByCategory[s]=f,l}}class Xs{constructor(s){this.info={name:s.name||"NotNamed",teacherName:s.teacherName||null,type:s.type||"in-person",educationalSystem:s.educationalSystem||"custom",term:s.term||null,scheduleText:s.scheduleText||null,level:s.level||null,creationDate:s.creationDate?new Date(s.creationDate):new Date,scheduleCode:s.scheduleCode||`code_${new Date().getTime()}`,scheduleDays:s.scheduleDays||[],scheduleStartTime:s.scheduleStartTime||null,scheduleEndTime:s.scheduleEndTime||null},this.students=[],this.sessions=[],this.note="",this.isDeleted=!1,this.categories=Ir(this.info.educationalSystem,this.info.level),this.futurePlans={}}addStudent(s){this.students.push(s)}startNewSession(){const t=this.sessions.reduce((a,n)=>Math.max(a,n.sessionNumber),0)+1,c=new ea(t);return this.sessions.push(c),c}endSpecificSession(s){const t=this.getSession(s);return t&&!t.isFinished?(t.end(),!0):!1}getSession(s){return this.sessions.find(t=>t.sessionNumber===s)}markAsMakeup(s){const t=this.getSession(s);t&&t.markAsMakeup()}planForSession(s,t){this.futurePlans[s]=t}hasSessionToday(){const s=new Date().toDateString();return this.sessions.some(t=>!t.isDeleted&&t.startTime.toDateString()===s)}selectNextWinner(s,t){return t?t.selectNextWinner(s,this.students,this.categories):null}get liveSession(){for(let s=this.sessions.length-1;s>=0;s--)if(!this.sessions[s].isFinished)return this.sessions[s];return null}calculateFinalStudentScore(s){var r;const t=this.categories.filter(i=>i.isGradedCategory&&!i.isDeleted);if(t.length===0)return null;let c=0,a=0;for(const i of t){const o=i.name.toLowerCase(),l=((r=s.logs.scores[o])==null?void 0:r.filter(m=>!m.isDeleted))||[];if(l.length===0)return null;const f=l.reduce((m,h)=>m+h.value,0)/l.length;c+=f*(i.weight||1),a+=i.weight||1}if(a===0)return null;const n=c/a;return Math.trunc(n*10)/10}}class pn{constructor(s,t="",c=!1,a=1){this.id=`cat_${new Date().getTime()}_${Math.random()}`,this.name=s,this.description=t,this.isDeleted=!1,this.isGradedCategory=c,this.weight=a,this.isDeleted=!1}}var Bn=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function ta(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}var na={exports:{}};(function(e){var s=function(){var t=String.fromCharCode,c="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",a="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+-$",n={};function r(o,l){if(!n[o]){n[o]={};for(var f=0;f<o.length;f++)n[o][o.charAt(f)]=f}return n[o][l]}var i={compressToBase64:function(o){if(o==null)return"";var l=i._compress(o,6,function(f){return c.charAt(f)});switch(l.length%4){default:case 0:return l;case 1:return l+"===";case 2:return l+"==";case 3:return l+"="}},decompressFromBase64:function(o){return o==null?"":o==""?null:i._decompress(o.length,32,function(l){return r(c,o.charAt(l))})},compressToUTF16:function(o){return o==null?"":i._compress(o,15,function(l){return t(l+32)})+" "},decompressFromUTF16:function(o){return o==null?"":o==""?null:i._decompress(o.length,16384,function(l){return o.charCodeAt(l)-32})},compressToUint8Array:function(o){for(var l=i.compress(o),f=new Uint8Array(l.length*2),m=0,h=l.length;m<h;m++){var u=l.charCodeAt(m);f[m*2]=u>>>8,f[m*2+1]=u%256}return f},decompressFromUint8Array:function(o){if(o==null)return i.decompress(o);for(var l=new Array(o.length/2),f=0,m=l.length;f<m;f++)l[f]=o[f*2]*256+o[f*2+1];var h=[];return l.forEach(function(u){h.push(t(u))}),i.decompress(h.join(""))},compressToEncodedURIComponent:function(o){return o==null?"":i._compress(o,6,function(l){return a.charAt(l)})},decompressFromEncodedURIComponent:function(o){return o==null?"":o==""?null:(o=o.replace(/ /g,"+"),i._decompress(o.length,32,function(l){return r(a,o.charAt(l))}))},compress:function(o){return i._compress(o,16,function(l){return t(l)})},_compress:function(o,l,f){if(o==null)return"";var m,h,u={},y={},p="",b="",v="",C=2,S=3,_=2,k=[],x=0,L=0,B;for(B=0;B<o.length;B+=1)if(p=o.charAt(B),Object.prototype.hasOwnProperty.call(u,p)||(u[p]=S++,y[p]=!0),b=v+p,Object.prototype.hasOwnProperty.call(u,b))v=b;else{if(Object.prototype.hasOwnProperty.call(y,v)){if(v.charCodeAt(0)<256){for(m=0;m<_;m++)x=x<<1,L==l-1?(L=0,k.push(f(x)),x=0):L++;for(h=v.charCodeAt(0),m=0;m<8;m++)x=x<<1|h&1,L==l-1?(L=0,k.push(f(x)),x=0):L++,h=h>>1}else{for(h=1,m=0;m<_;m++)x=x<<1|h,L==l-1?(L=0,k.push(f(x)),x=0):L++,h=0;for(h=v.charCodeAt(0),m=0;m<16;m++)x=x<<1|h&1,L==l-1?(L=0,k.push(f(x)),x=0):L++,h=h>>1}C--,C==0&&(C=Math.pow(2,_),_++),delete y[v]}else for(h=u[v],m=0;m<_;m++)x=x<<1|h&1,L==l-1?(L=0,k.push(f(x)),x=0):L++,h=h>>1;C--,C==0&&(C=Math.pow(2,_),_++),u[b]=S++,v=String(p)}if(v!==""){if(Object.prototype.hasOwnProperty.call(y,v)){if(v.charCodeAt(0)<256){for(m=0;m<_;m++)x=x<<1,L==l-1?(L=0,k.push(f(x)),x=0):L++;for(h=v.charCodeAt(0),m=0;m<8;m++)x=x<<1|h&1,L==l-1?(L=0,k.push(f(x)),x=0):L++,h=h>>1}else{for(h=1,m=0;m<_;m++)x=x<<1|h,L==l-1?(L=0,k.push(f(x)),x=0):L++,h=0;for(h=v.charCodeAt(0),m=0;m<16;m++)x=x<<1|h&1,L==l-1?(L=0,k.push(f(x)),x=0):L++,h=h>>1}C--,C==0&&(C=Math.pow(2,_),_++),delete y[v]}else for(h=u[v],m=0;m<_;m++)x=x<<1|h&1,L==l-1?(L=0,k.push(f(x)),x=0):L++,h=h>>1;C--,C==0&&(C=Math.pow(2,_),_++)}for(h=2,m=0;m<_;m++)x=x<<1|h&1,L==l-1?(L=0,k.push(f(x)),x=0):L++,h=h>>1;for(;;)if(x=x<<1,L==l-1){k.push(f(x));break}else L++;return k.join("")},decompress:function(o){return o==null?"":o==""?null:i._decompress(o.length,32768,function(l){return o.charCodeAt(l)})},_decompress:function(o,l,f){var m=[],h=4,u=4,y=3,p="",b=[],v,C,S,_,k,x,L,B={val:f(0),position:l,index:1};for(v=0;v<3;v+=1)m[v]=v;for(S=0,k=Math.pow(2,2),x=1;x!=k;)_=B.val&B.position,B.position>>=1,B.position==0&&(B.position=l,B.val=f(B.index++)),S|=(_>0?1:0)*x,x<<=1;switch(S){case 0:for(S=0,k=Math.pow(2,8),x=1;x!=k;)_=B.val&B.position,B.position>>=1,B.position==0&&(B.position=l,B.val=f(B.index++)),S|=(_>0?1:0)*x,x<<=1;L=t(S);break;case 1:for(S=0,k=Math.pow(2,16),x=1;x!=k;)_=B.val&B.position,B.position>>=1,B.position==0&&(B.position=l,B.val=f(B.index++)),S|=(_>0?1:0)*x,x<<=1;L=t(S);break;case 2:return""}for(m[3]=L,C=L,b.push(L);;){if(B.index>o)return"";for(S=0,k=Math.pow(2,y),x=1;x!=k;)_=B.val&B.position,B.position>>=1,B.position==0&&(B.position=l,B.val=f(B.index++)),S|=(_>0?1:0)*x,x<<=1;switch(L=S){case 0:for(S=0,k=Math.pow(2,8),x=1;x!=k;)_=B.val&B.position,B.position>>=1,B.position==0&&(B.position=l,B.val=f(B.index++)),S|=(_>0?1:0)*x,x<<=1;m[u++]=t(S),L=u-1,h--;break;case 1:for(S=0,k=Math.pow(2,16),x=1;x!=k;)_=B.val&B.position,B.position>>=1,B.position==0&&(B.position=l,B.val=f(B.index++)),S|=(_>0?1:0)*x,x<<=1;m[u++]=t(S),L=u-1,h--;break;case 2:return b.join("")}if(h==0&&(h=Math.pow(2,y),y++),m[L])p=m[L];else if(L===u)p=C+C.charAt(0);else return null;b.push(p),m[u++]=C+p.charAt(0),h--,C=p,h==0&&(h=Math.pow(2,y),y++)}}};return i}();e!=null?e.exports=s:typeof angular<"u"&&angular!=null&&angular.module("LZString",[]).factory("LZString",function(){return s})})(na);var Tr=na.exports;const sa=ta(Tr);function Br(e){return new Worker("/assets/compression.worker-B3kqe_bR.js",{name:e==null?void 0:e.name})}let ia=null;function hs(e){ia=e}let ie={},D=null,Qs=null,K=null,Se=null,qn=null,ei=null,ti=[],Gn=null,ni=null,Le=null,at={},Zn=0,si=0,Vn=0,ii=0,ai=null,ri=null,Jn=null,yt=null,et=-1,oi=null,Kn=null,Yn=null,Xn=null,aa=null,ra=null,bt=!1;function ci(e){bt=e}let oa=null;function li(e){oa=e}let He=[],st=[],zt=[],Be={isScreenSaverEnabled:!0,isSoundEnabled:!0,isVibrationEnabled:!0,isDeveloperMode:!1,lastRestoreTimestamp:null,lastBackupTimestamp:null},ht=!1;function di(e){ht=e,se()}let ui=!1;function fi(e){ui=e}let Ut=null;const mi=new Br;mi.onmessage=e=>{const s=e.data;try{localStorage.setItem("teacherAssistantData_v2",s),console.log("Background save complete.")}catch(t){console.error("Background storage failed:",t)}};mi.onerror=e=>{console.error("âŒ Worker Communication Error:",e.message,e)};function se(e=!1){if(bt)return;const t=JSON.stringify({classrooms:ie,trashBin:He,userSettings:Be,isAssessmentModeActive:ht});if(e){Ut&&clearTimeout(Ut);try{const c=sa.compressToUTF16(t);localStorage.setItem("teacherAssistantData_v2",c),console.log("Immediate save complete.")}catch(c){console.error("Immediate save failed:",c)}return}Ut&&clearTimeout(Ut),Ut=setTimeout(()=>{mi.postMessage(t),Ut=null},500)}function hi(){const e=localStorage.getItem("teacherAssistantData_v2");if(!e)return;let s;try{const t=sa.decompressFromUTF16(e);t?s=JSON.parse(t):s=JSON.parse(e)}catch{console.log("Migration: Parsing legacy uncompressed data..."),s=JSON.parse(e)}s.classrooms!==void 0&&s.trashBin!==void 0?($t(s.classrooms),He=s.trashBin||[],Be={...Be,...s.userSettings},ht=s.isAssessmentModeActive||!1):($t(s),Dr())}function Dr(){const e=[];Object.values(ie).forEach(s=>{s.isDeleted?e.push({id:`trash_${Date.now()}_${Math.random()}`,timestamp:s.info.creationDate,type:"classroom",description:`Ú©Ù„Ø§Ø³ Â«${s.info.name}Â»`,restoreData:{name:s.info.name}}):s.students.forEach(t=>{t.isDeleted&&e.push({id:`trash_${Date.now()}_${Math.random()}`,timestamp:t.identity.studentId.split("_")[1],type:"student",description:`Ø¯Ø§Ù†Ø´â€ŒØ¢Ù…ÙˆØ² Â«${t.identity.name}Â»`,restoreData:{studentId:t.identity.studentId,classroomName:s.info.name}})})}),He.length===0&&e.length>0&&(He=e,console.log(`Migrated ${e.length} previously deleted item(s) to the new trash bin.`),se())}function ca(e){const s=new jn(e.identity);return s.isDeleted=e.isDeleted,s.statusCounters=e.statusCounters,s.logs=e.logs,s.logs.scores||(s.logs.scores={}),s.profile=e.profile,s.finalClassActivityScore=e.finalClassActivityScore,s.categoryCounts=e.categoryCounts||{},s.categoryIssues=e.categoryIssues||{},s.qualitativeStats=e.qualitativeStats||{},s.onboardingSession=e.onboardingSession||null,s}function $t(e){ie={};for(const s in e){const t=e[s];let c;t.info?c=t.info:c={...t,name:s};const a=new Xs(c);a.isDeleted=t.isDeleted,a.note=t.note||"",a.students=(t.students||[]).map(ca),a.sessions=(t.sessions||[]).map(n=>{const r=new ea(n.sessionNumber);r.isDeleted=n.isDeleted,r.note=n.note||"",r.startTime=new Date(n.startTime),r.createdAt=n.createdAt?new Date(n.createdAt):new Date(n.startTime),r.endTime=n.endTime?new Date(n.endTime):null,r.isFinished=n.isFinished,r.isMakeup=n.isMakeup,r.isCancelled=n.isCancelled||!1,r.studentRecords=n.studentRecords;for(const o in r.studentRecords){const l=r.studentRecords[o];l.homework&&!(l.homework instanceof Ls)&&(r.studentRecords[o].homework=new Ls(l.homework.status,l.homework.comment))}r.lastWinnerByCategory=n.lastWinnerByCategory,r.lastUsedCategoryId=n.lastUsedCategoryId,r.lastSelectedWinnerId=n.lastSelectedWinnerId;const i=n.winnerHistory||[];return r.winnerHistory=i.filter(o=>o&&o.winner).map(o=>({winner:a.students.find(f=>f.identity.studentId===o.winner.identity.studentId),categoryName:o.categoryName,rating:o.rating||null})).filter(o=>o.winner),r}),a.categories=(t.categories||[]).map(n=>{const r=new pn(n.name,n.description,n.isGradedCategory,n.weight||1);return r.id=n.id,r.isDeleted=n.isDeleted,r}),a.futurePlans=t.futurePlans,ie[s]=a}}function la(e,s){if(ie[s])return{success:!1,message:"Ú©Ù„Ø§Ø³ÛŒ Ø¨Ø§ Ø§ÛŒÙ† Ù†Ø§Ù… Ø§Ø² Ù‚Ø¨Ù„ ÙˆØ¬ÙˆØ¯ Ø¯Ø§Ø±Ø¯."};const t=ie[e];return t?(t.info.name=s,ie[s]=t,delete ie[e],D===t&&Ze(t),{success:!0}):{success:!1,message:"Ú©Ù„Ø§Ø³ Ù…ÙˆØ±Ø¯ Ù†Ø¸Ø± ÛŒØ§ÙØª Ù†Ø´Ø¯."}}function da(e,s,t){const c=t.trim();if(!c)return{success:!1,message:"Ù†Ø§Ù… Ø¯Ø³ØªÙ‡â€ŒØ¨Ù†Ø¯ÛŒ Ù†Ù…ÛŒâ€ŒØªÙˆØ§Ù†Ø¯ Ø®Ø§Ù„ÛŒ Ø¨Ø§Ø´Ø¯."};if(e.categories.some(o=>o.id!==s.id&&!o.isDeleted&&o.name.toLowerCase()===c.toLowerCase()))return{success:!1,message:"Ø¯Ø³ØªÙ‡â€ŒØ¨Ù†Ø¯ÛŒ Ø¯ÛŒÚ¯Ø±ÛŒ Ø¨Ø§ Ø§ÛŒÙ† Ù†Ø§Ù… ÙˆØ¬ÙˆØ¯ Ø¯Ø§Ø±Ø¯."};const n=s.name,r=n.toLowerCase(),i=c.toLowerCase();return s.name=c,e.students.forEach(o=>{o.categoryCounts&&o.categoryCounts[n]!==void 0&&(o.categoryCounts[c]=o.categoryCounts[n],delete o.categoryCounts[n]),o.categoryIssues&&o.categoryIssues[n]!==void 0&&(o.categoryIssues[c]=o.categoryIssues[n],delete o.categoryIssues[n]),o.logs.scores&&o.logs.scores[r]&&(o.logs.scores[r].forEach(l=>l.skill=c),r!==i&&(o.logs.scores[i]=o.logs.scores[r],delete o.logs.scores[r]))}),e.sessions.forEach(o=>{o.lastWinnerByCategory&&o.lastWinnerByCategory[n]&&(o.lastWinnerByCategory[c]=o.lastWinnerByCategory[n],delete o.lastWinnerByCategory[n]),o.winnerHistory&&o.winnerHistory.forEach(l=>{l.categoryName===n&&(l.categoryName=c)})}),{success:!0}}function ua(e,s,t){if(ge(t.students).some(l=>l.identity.name.toLowerCase()===e.identity.name.toLowerCase()))return{success:!1,message:`Ø¯Ø§Ù†Ø´â€ŒØ¢Ù…ÙˆØ²ÛŒ Ø¨Ø§ Ù†Ø§Ù… Â«${e.identity.name}Â» Ø§Ø² Ù‚Ø¨Ù„ Ø¯Ø± Ú©Ù„Ø§Ø³ Â«${t.info.name}Â» ÙˆØ¬ÙˆØ¯ Ø¯Ø§Ø±Ø¯.`};const a=JSON.parse(JSON.stringify(e)),n=ca(a),r=new Map;s.sessions.forEach(l=>{const f=l.studentRecords[e.identity.studentId];f&&r.set(l.sessionNumber,JSON.parse(JSON.stringify(f)))}),t.addStudent(n);try{const l=ge(t.sessions).filter(b=>!b.isCancelled).sort((b,v)=>v.sessionNumber-b.sessionNumber),f=l.length>0?l[0]:null;let m="ØŸ",h={type:"system",description:"Student Move"};f&&(m=lt(t).get(f.sessionNumber)||f.sessionNumber,h={type:"fromSession",sessionNumber:f.sessionNumber});const u=new Date().toLocaleDateString("fa-IR"),y=s.info.name,p=`Ø§ÛŒÙ† Ø¯Ø§Ù†Ø´ Ø¢Ù…ÙˆØ² Ø¯Ø± Ø¬Ù„Ø³Ù‡ ${m} Ùˆ Ø¯Ø± ØªØ§Ø±ÛŒØ® ${u} Ø§Ø² Ú©Ù„Ø§Ø³ Â«${y}Â» Ø¨Ù‡ Ø§ÛŒÙ† Ú©Ù„Ø§Ø³ Ø§Ù†ØªÙ‚Ø§Ù„ Ù¾ÛŒØ¯Ø§ Ú©Ø±Ø¯`;n.addNote(p,h)}catch(l){console.error("Failed to add automated move note:",l)}r.size>0&&t.sessions.forEach(l=>{const f=r.get(l.sessionNumber);f&&!l.isDeleted&&!l.isCancelled&&(l.studentRecords[n.identity.studentId]=f)});const i={id:`trash_${Date.now()}_${Math.random()}`,timestamp:new Date().toISOString(),type:"student",description:`(Ø§Ù†ØªÙ‚Ø§Ù„) Ø¯Ø§Ù†Ø´â€ŒØ¢Ù…ÙˆØ² Â«${e.identity.name}Â» Ø§Ø² Ú©Ù„Ø§Ø³ Â«${s.info.name}Â»`,restoreData:{studentId:e.identity.studentId,classId:s.info.scheduleCode}};ct(i);const o=s.students.find(l=>l.identity.studentId===e.identity.studentId);return o&&(o.isDeleted=!0),{success:!0}}function fa(){for(const e in ie){const s=ie[e];s.students.forEach(t=>{t.statusCounters={totalSelections:0,missedChances:0,earlyLeaves:0},t.categoryCounts={},t.categoryIssues={},s.sessions.forEach(c=>{const a=t.identity.studentId;c.studentRecords[a]&&(c.studentRecords[a].attendance="present")})})}se()}function ge(e){return Array.isArray(e)?e.filter(s=>!s.isDeleted):[]}function lt(e){const s=new Map;return e&&ge(e.sessions).filter(c=>!c.isCancelled).sort((c,a)=>c.sessionNumber-a.sessionNumber).forEach((c,a)=>{s.set(c.sessionNumber,a+1)}),s}function Ct(e){et=e}function dt(e){oi=e}function ps(e,s){if(!e||!s)return;const t=e.identity.studentId,c=s.students.findIndex(a=>a.identity.studentId===t);c>-1&&s.students.splice(c,1),s.sessions.forEach(a=>{a.studentRecords[t]&&delete a.studentRecords[t];for(const n in a.lastWinnerByCategory)a.lastWinnerByCategory[n]===t&&delete a.lastWinnerByCategory[n];a.lastSelectedWinnerId===t&&(a.lastSelectedWinnerId=null),a.winnerHistory=a.winnerHistory.filter(n=>n.winner&&n.winner.identity.studentId!==t)})}function pi(e,s){const t=ie[e];if(!t)return;const c=t.sessions.findIndex(a=>a.sessionNumber===s);c>-1&&(t.students.forEach(a=>{a.profile.notes&&a.profile.notes.length>0&&(a.profile.notes=a.profile.notes.filter(n=>!n.source||n.source.type!=="fromAttendance"||n.source.sessionNumber!==s)),a.onboardingSession===s&&(a.onboardingSession=null)}),t.sessions.splice(c,1))}function gi(e,s){const t=ie[e];if(!t)return;const c=t.categories.findIndex(i=>i.id===s);if(c===-1)return;const n=t.categories[c].name,r=n.toLowerCase();t.students.forEach(i=>{i.categoryCounts&&delete i.categoryCounts[n],i.categoryIssues&&delete i.categoryIssues[n],i.logs.scores&&delete i.logs.scores[r]}),t.sessions.forEach(i=>{i.lastWinnerByCategory[n]&&delete i.lastWinnerByCategory[n],i.winnerHistory=i.winnerHistory.filter(o=>o.categoryName!==n)}),t.categories.splice(c,1)}function yi(e,s,t,c){const a=ie[e];if(!a)return;const n=a.students.find(o=>o.identity.studentId===s);if(!n||!n.logs.scores[t.toLowerCase()])return;const r=n.logs.scores[t.toLowerCase()],i=r.findIndex(o=>o.id===c);i>-1&&r.splice(i,1)}function vi(e,s,t){const c=ie[e];if(!c)return;const a=c.students.find(r=>r.identity.studentId===s);if(!a||!a.profile.notes)return;const n=a.profile.notes.findIndex(r=>r.id===t);n>-1&&a.profile.notes.splice(n,1)}function ct(e){for(He.unshift(e);He.length>50;){const s=He.pop();ma(s)}se()}function ma(e){var s;if(!(!e||!e.restoreData))switch(console.log(`ðŸ—‘ï¸ Auto-cleaning overflow item: ${e.description}`),e.type){case"classroom":e.restoreData.name&&ie[e.restoreData.name]&&delete ie[e.restoreData.name];break;case"student":(s=e.restoreData.identity)!=null&&s.studentId&&ps(e.restoreData.identity.studentId);break;case"session":e.restoreData.id&&pi(e.restoreData.id);break;case"category":e.restoreData.id&&gi(e.restoreData.id);break;case"score":yi(e.restoreData);break;case"note":e.restoreData.id&&vi(e.restoreData.id);break}}function Ze(e){D=e}function gn(e){Qs=e}function rt(e){K=e}function kt(e){Se=e}function ha(e){qn=e}function Nr(e){ei=e}function sn(e){ti=e}function Nn(e){Gn=e}function pa(e){ni=e}function Qn(e){Le=e}function An(e){Zn=e}function ga(e){si=e}function Mn(e){Vn=e}function ya(e){ii=e}function bi(e){ai=e}function Ci(e){ri=e}function yn(e){Jn=e}function wi(e){yt=e}function Kt(e){Yn=e}function va(e){aa=e}function ba(e){ra=e}function Ei(e){He=e}function vn(e){Kn=e}function bn(e){zt=e}function wt(e){Be={...Be,...e},se()}function On(e){st=e}function Si(){Be.lastBackupTimestamp=new Date().toISOString(),se()}function es(e){Xn=e}function Ar(e){at=e}function Mr(){at={}}function _i(e,s){at[e]||(at[e]={assessmentCandidates:[],pickedCandidatesThisSession:[]}),at[e].pickedCandidatesThisSession.includes(s)||at[e].pickedCandidatesThisSession.push(s)}const Ca=Object.freeze(Object.defineProperty({__proto__:null,get activeModal(){return yt},addToTrashBin:ct,get assessmentPools(){return at},get cancelCallback(){return ri},get classrooms(){return ie},get confirmCallback(){return ai},get currentClassroom(){return D},get datePickerCallback(){return Xn},get displayedWinnerID(){return ia},get easterEggClickCount(){return Zn},get easterEggLastClickTime(){return si},getActiveItems:ge,getSessionDisplayMap:lt,get importedFileContent(){return Gn},get isAssessmentModeActive(){return ht},get isDemoMode(){return bt},get isModalTransitioning(){return ui},get liveSession(){return Qs},loadData:hi,get manualSelection(){return Yn},markStudentAsPickedForAssessmentInSession:_i,moveStudent:ua,get namesToImport(){return ti},get notificationTimeout(){return ni},get originalStateBackup(){return oa},permanentlyDeleteCategory:gi,permanentlyDeleteFromTrash:ma,permanentlyDeleteNote:vi,permanentlyDeleteScore:yi,permanentlyDeleteSession:pi,permanentlyDeleteStudent:ps,get previousState(){return qn},rehydrateData:$t,renameCategory:da,renameClassroom:la,resetAllStudentCounters:fa,resetAssessmentPools:Mr,get resetEasterEggClickCount(){return Vn},get resetEasterEggLastClickTime(){return ii},get saveCategoryCallback(){return Kn},saveData:se,get saveNoteCallback(){return oi},get secureConfirmCallback(){return Jn},get selectedCategory(){return Le},get selectedClassIds(){return st},get selectedSession(){return K},get selectedStudentForProfile(){return Se},get selectedStudentsForMassComment(){return zt},setActiveModal:wi,setAssessmentPools:Ar,setCancelCallback:Ci,setConfirmCallback:bi,setCurrentClassroom:Ze,setDatePickerCallback:es,setDisplayedWinnerID:hs,setEasterEggClickCount:An,setEasterEggLastClickTime:ga,setImportedFileContent:Nn,setIsAssessmentModeActive:di,setIsDemoMode:ci,setIsModalTransitioning:fi,setLastBackupTimestamp:Si,setLiveSession:gn,setManualSelection:Kt,setNamesToImport:sn,setNotificationTimeout:pa,setOriginalStateBackup:li,setPreviousState:ha,setResetEasterEggClickCount:Mn,setResetEasterEggLastClickTime:ya,setSaveCategoryCallback:vn,setSaveNoteCallback:dt,setSecureConfirmCallback:yn,setSelectedCategory:Qn,setSelectedClassIds:On,setSelectedSession:rt,setSelectedStudentForProfile:kt,setSelectedStudentsForMassComment:bn,setSourceClassForMove:ba,setStudentToMove:va,setTrashBin:Ei,setUndoTimeout:Nr,setUserSettings:wt,setWinnerHistoryIndex:Ct,get sourceClassForMove(){return ra},get studentToMove(){return aa},get trashBin(){return He},get undoTimeout(){return ei},get userSettings(){return Be},get winnerHistoryIndex(){return et}},Symbol.toStringTag,{value:"Module"})),Or="TeacherAssistantDB",Rr=1,mt="backups";function ki(){return new Promise((e,s)=>{const t=indexedDB.open(Or,Rr);t.onupgradeneeded=c=>{const a=c.target.result;a.objectStoreNames.contains(mt)||a.createObjectStore(mt,{keyPath:"id"})},t.onsuccess=c=>e(c.target.result),t.onerror=c=>s(c.target.error)})}async function wa(e,s){const t=await ki(),c=t.transaction(mt,"readwrite"),a=c.objectStore(mt),n={id:Date.now(),file:e,metadata:s,timestamp:new Date().toISOString()};a.add(n),c.oncomplete=()=>{const i=t.transaction(mt,"readwrite").objectStore(mt),o=i.count();o.onsuccess=()=>{if(o.result>10){const l=i.getAllKeys();l.onsuccess=()=>{const f=l.result;for(;f.length>10;){const m=f.shift();i.delete(m),console.log(`â™»ï¸ Auto-deleted old backup snapshot: ${m}`)}}}}}}async function Ea(){const e=await ki();return new Promise((s,t)=>{const n=e.transaction(mt,"readonly").objectStore(mt).getAll();n.onsuccess=()=>{const r=n.result.sort((i,o)=>o.id-i.id);s(r)},n.onerror=()=>t(n.error)})}async function zr(e){(await ki()).transaction(mt,"readwrite").objectStore(mt).delete(e)}const $r=Object.freeze(Object.defineProperty({__proto__:null,addBackupSnapshot:wa,deleteBackupSnapshot:zr,getBackupSnapshots:Ea},Symbol.toStringTag,{value:"Module"}));function Dn(e){throw new Error('Could not dynamically require "'+e+'". Please configure the dynamicRequireTargets or/and ignoreDynamicRequires option of @rollup/plugin-commonjs appropriately for this require call to work.')}var Sa={exports:{}};/*!

JSZip v3.10.1 - A JavaScript class for generating and reading zip files
<http://stuartk.com/jszip>

(c) 2009-2016 Stuart Knightley <stuart [at] stuartk.com>
Dual licenced under the MIT license or GPLv3. See https://raw.github.com/Stuk/jszip/main/LICENSE.markdown.

JSZip uses the library pako released under the MIT license :
https://github.com/nodeca/pako/blob/main/LICENSE
*/(function(e,s){(function(t){e.exports=t()})(function(){return function t(c,a,n){function r(l,f){if(!a[l]){if(!c[l]){var m=typeof Dn=="function"&&Dn;if(!f&&m)return m(l,!0);if(i)return i(l,!0);var h=new Error("Cannot find module '"+l+"'");throw h.code="MODULE_NOT_FOUND",h}var u=a[l]={exports:{}};c[l][0].call(u.exports,function(y){var p=c[l][1][y];return r(p||y)},u,u.exports,t,c,a,n)}return a[l].exports}for(var i=typeof Dn=="function"&&Dn,o=0;o<n.length;o++)r(n[o]);return r}({1:[function(t,c,a){var n=t("./utils"),r=t("./support"),i="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";a.encode=function(o){for(var l,f,m,h,u,y,p,b=[],v=0,C=o.length,S=C,_=n.getTypeOf(o)!=="string";v<o.length;)S=C-v,m=_?(l=o[v++],f=v<C?o[v++]:0,v<C?o[v++]:0):(l=o.charCodeAt(v++),f=v<C?o.charCodeAt(v++):0,v<C?o.charCodeAt(v++):0),h=l>>2,u=(3&l)<<4|f>>4,y=1<S?(15&f)<<2|m>>6:64,p=2<S?63&m:64,b.push(i.charAt(h)+i.charAt(u)+i.charAt(y)+i.charAt(p));return b.join("")},a.decode=function(o){var l,f,m,h,u,y,p=0,b=0,v="data:";if(o.substr(0,v.length)===v)throw new Error("Invalid base64 input, it looks like a data url.");var C,S=3*(o=o.replace(/[^A-Za-z0-9+/=]/g,"")).length/4;if(o.charAt(o.length-1)===i.charAt(64)&&S--,o.charAt(o.length-2)===i.charAt(64)&&S--,S%1!=0)throw new Error("Invalid base64 input, bad content length.");for(C=r.uint8array?new Uint8Array(0|S):new Array(0|S);p<o.length;)l=i.indexOf(o.charAt(p++))<<2|(h=i.indexOf(o.charAt(p++)))>>4,f=(15&h)<<4|(u=i.indexOf(o.charAt(p++)))>>2,m=(3&u)<<6|(y=i.indexOf(o.charAt(p++))),C[b++]=l,u!==64&&(C[b++]=f),y!==64&&(C[b++]=m);return C}},{"./support":30,"./utils":32}],2:[function(t,c,a){var n=t("./external"),r=t("./stream/DataWorker"),i=t("./stream/Crc32Probe"),o=t("./stream/DataLengthProbe");function l(f,m,h,u,y){this.compressedSize=f,this.uncompressedSize=m,this.crc32=h,this.compression=u,this.compressedContent=y}l.prototype={getContentWorker:function(){var f=new r(n.Promise.resolve(this.compressedContent)).pipe(this.compression.uncompressWorker()).pipe(new o("data_length")),m=this;return f.on("end",function(){if(this.streamInfo.data_length!==m.uncompressedSize)throw new Error("Bug : uncompressed data size mismatch")}),f},getCompressedWorker:function(){return new r(n.Promise.resolve(this.compressedContent)).withStreamInfo("compressedSize",this.compressedSize).withStreamInfo("uncompressedSize",this.uncompressedSize).withStreamInfo("crc32",this.crc32).withStreamInfo("compression",this.compression)}},l.createWorkerFrom=function(f,m,h){return f.pipe(new i).pipe(new o("uncompressedSize")).pipe(m.compressWorker(h)).pipe(new o("compressedSize")).withStreamInfo("compression",m)},c.exports=l},{"./external":6,"./stream/Crc32Probe":25,"./stream/DataLengthProbe":26,"./stream/DataWorker":27}],3:[function(t,c,a){var n=t("./stream/GenericWorker");a.STORE={magic:"\0\0",compressWorker:function(){return new n("STORE compression")},uncompressWorker:function(){return new n("STORE decompression")}},a.DEFLATE=t("./flate")},{"./flate":7,"./stream/GenericWorker":28}],4:[function(t,c,a){var n=t("./utils"),r=function(){for(var i,o=[],l=0;l<256;l++){i=l;for(var f=0;f<8;f++)i=1&i?3988292384^i>>>1:i>>>1;o[l]=i}return o}();c.exports=function(i,o){return i!==void 0&&i.length?n.getTypeOf(i)!=="string"?function(l,f,m,h){var u=r,y=h+m;l^=-1;for(var p=h;p<y;p++)l=l>>>8^u[255&(l^f[p])];return-1^l}(0|o,i,i.length,0):function(l,f,m,h){var u=r,y=h+m;l^=-1;for(var p=h;p<y;p++)l=l>>>8^u[255&(l^f.charCodeAt(p))];return-1^l}(0|o,i,i.length,0):0}},{"./utils":32}],5:[function(t,c,a){a.base64=!1,a.binary=!1,a.dir=!1,a.createFolders=!0,a.date=null,a.compression=null,a.compressionOptions=null,a.comment=null,a.unixPermissions=null,a.dosPermissions=null},{}],6:[function(t,c,a){var n=null;n=typeof Promise<"u"?Promise:t("lie"),c.exports={Promise:n}},{lie:37}],7:[function(t,c,a){var n=typeof Uint8Array<"u"&&typeof Uint16Array<"u"&&typeof Uint32Array<"u",r=t("pako"),i=t("./utils"),o=t("./stream/GenericWorker"),l=n?"uint8array":"array";function f(m,h){o.call(this,"FlateWorker/"+m),this._pako=null,this._pakoAction=m,this._pakoOptions=h,this.meta={}}a.magic="\b\0",i.inherits(f,o),f.prototype.processChunk=function(m){this.meta=m.meta,this._pako===null&&this._createPako(),this._pako.push(i.transformTo(l,m.data),!1)},f.prototype.flush=function(){o.prototype.flush.call(this),this._pako===null&&this._createPako(),this._pako.push([],!0)},f.prototype.cleanUp=function(){o.prototype.cleanUp.call(this),this._pako=null},f.prototype._createPako=function(){this._pako=new r[this._pakoAction]({raw:!0,level:this._pakoOptions.level||-1});var m=this;this._pako.onData=function(h){m.push({data:h,meta:m.meta})}},a.compressWorker=function(m){return new f("Deflate",m)},a.uncompressWorker=function(){return new f("Inflate",{})}},{"./stream/GenericWorker":28,"./utils":32,pako:38}],8:[function(t,c,a){function n(u,y){var p,b="";for(p=0;p<y;p++)b+=String.fromCharCode(255&u),u>>>=8;return b}function r(u,y,p,b,v,C){var S,_,k=u.file,x=u.compression,L=C!==l.utf8encode,B=i.transformTo("string",C(k.name)),M=i.transformTo("string",l.utf8encode(k.name)),W=k.comment,Q=i.transformTo("string",C(W)),I=i.transformTo("string",l.utf8encode(W)),z=M.length!==k.name.length,g=I.length!==W.length,F="",re="",G="",de=k.dir,V=k.date,le={crc32:0,compressedSize:0,uncompressedSize:0};y&&!p||(le.crc32=u.crc32,le.compressedSize=u.compressedSize,le.uncompressedSize=u.uncompressedSize);var O=0;y&&(O|=8),L||!z&&!g||(O|=2048);var A=0,oe=0;de&&(A|=16),v==="UNIX"?(oe=798,A|=function(X,xe){var Me=X;return X||(Me=xe?16893:33204),(65535&Me)<<16}(k.unixPermissions,de)):(oe=20,A|=function(X){return 63&(X||0)}(k.dosPermissions)),S=V.getUTCHours(),S<<=6,S|=V.getUTCMinutes(),S<<=5,S|=V.getUTCSeconds()/2,_=V.getUTCFullYear()-1980,_<<=4,_|=V.getUTCMonth()+1,_<<=5,_|=V.getUTCDate(),z&&(re=n(1,1)+n(f(B),4)+M,F+="up"+n(re.length,2)+re),g&&(G=n(1,1)+n(f(Q),4)+I,F+="uc"+n(G.length,2)+G);var ee="";return ee+=`
\0`,ee+=n(O,2),ee+=x.magic,ee+=n(S,2),ee+=n(_,2),ee+=n(le.crc32,4),ee+=n(le.compressedSize,4),ee+=n(le.uncompressedSize,4),ee+=n(B.length,2),ee+=n(F.length,2),{fileRecord:m.LOCAL_FILE_HEADER+ee+B+F,dirRecord:m.CENTRAL_FILE_HEADER+n(oe,2)+ee+n(Q.length,2)+"\0\0\0\0"+n(A,4)+n(b,4)+B+F+Q}}var i=t("../utils"),o=t("../stream/GenericWorker"),l=t("../utf8"),f=t("../crc32"),m=t("../signature");function h(u,y,p,b){o.call(this,"ZipFileWorker"),this.bytesWritten=0,this.zipComment=y,this.zipPlatform=p,this.encodeFileName=b,this.streamFiles=u,this.accumulate=!1,this.contentBuffer=[],this.dirRecords=[],this.currentSourceOffset=0,this.entriesCount=0,this.currentFile=null,this._sources=[]}i.inherits(h,o),h.prototype.push=function(u){var y=u.meta.percent||0,p=this.entriesCount,b=this._sources.length;this.accumulate?this.contentBuffer.push(u):(this.bytesWritten+=u.data.length,o.prototype.push.call(this,{data:u.data,meta:{currentFile:this.currentFile,percent:p?(y+100*(p-b-1))/p:100}}))},h.prototype.openedSource=function(u){this.currentSourceOffset=this.bytesWritten,this.currentFile=u.file.name;var y=this.streamFiles&&!u.file.dir;if(y){var p=r(u,y,!1,this.currentSourceOffset,this.zipPlatform,this.encodeFileName);this.push({data:p.fileRecord,meta:{percent:0}})}else this.accumulate=!0},h.prototype.closedSource=function(u){this.accumulate=!1;var y=this.streamFiles&&!u.file.dir,p=r(u,y,!0,this.currentSourceOffset,this.zipPlatform,this.encodeFileName);if(this.dirRecords.push(p.dirRecord),y)this.push({data:function(b){return m.DATA_DESCRIPTOR+n(b.crc32,4)+n(b.compressedSize,4)+n(b.uncompressedSize,4)}(u),meta:{percent:100}});else for(this.push({data:p.fileRecord,meta:{percent:0}});this.contentBuffer.length;)this.push(this.contentBuffer.shift());this.currentFile=null},h.prototype.flush=function(){for(var u=this.bytesWritten,y=0;y<this.dirRecords.length;y++)this.push({data:this.dirRecords[y],meta:{percent:100}});var p=this.bytesWritten-u,b=function(v,C,S,_,k){var x=i.transformTo("string",k(_));return m.CENTRAL_DIRECTORY_END+"\0\0\0\0"+n(v,2)+n(v,2)+n(C,4)+n(S,4)+n(x.length,2)+x}(this.dirRecords.length,p,u,this.zipComment,this.encodeFileName);this.push({data:b,meta:{percent:100}})},h.prototype.prepareNextSource=function(){this.previous=this._sources.shift(),this.openedSource(this.previous.streamInfo),this.isPaused?this.previous.pause():this.previous.resume()},h.prototype.registerPrevious=function(u){this._sources.push(u);var y=this;return u.on("data",function(p){y.processChunk(p)}),u.on("end",function(){y.closedSource(y.previous.streamInfo),y._sources.length?y.prepareNextSource():y.end()}),u.on("error",function(p){y.error(p)}),this},h.prototype.resume=function(){return!!o.prototype.resume.call(this)&&(!this.previous&&this._sources.length?(this.prepareNextSource(),!0):this.previous||this._sources.length||this.generatedError?void 0:(this.end(),!0))},h.prototype.error=function(u){var y=this._sources;if(!o.prototype.error.call(this,u))return!1;for(var p=0;p<y.length;p++)try{y[p].error(u)}catch{}return!0},h.prototype.lock=function(){o.prototype.lock.call(this);for(var u=this._sources,y=0;y<u.length;y++)u[y].lock()},c.exports=h},{"../crc32":4,"../signature":23,"../stream/GenericWorker":28,"../utf8":31,"../utils":32}],9:[function(t,c,a){var n=t("../compressions"),r=t("./ZipFileWorker");a.generateWorker=function(i,o,l){var f=new r(o.streamFiles,l,o.platform,o.encodeFileName),m=0;try{i.forEach(function(h,u){m++;var y=function(C,S){var _=C||S,k=n[_];if(!k)throw new Error(_+" is not a valid compression method !");return k}(u.options.compression,o.compression),p=u.options.compressionOptions||o.compressionOptions||{},b=u.dir,v=u.date;u._compressWorker(y,p).withStreamInfo("file",{name:h,dir:b,date:v,comment:u.comment||"",unixPermissions:u.unixPermissions,dosPermissions:u.dosPermissions}).pipe(f)}),f.entriesCount=m}catch(h){f.error(h)}return f}},{"../compressions":3,"./ZipFileWorker":8}],10:[function(t,c,a){function n(){if(!(this instanceof n))return new n;if(arguments.length)throw new Error("The constructor with parameters has been removed in JSZip 3.0, please check the upgrade guide.");this.files=Object.create(null),this.comment=null,this.root="",this.clone=function(){var r=new n;for(var i in this)typeof this[i]!="function"&&(r[i]=this[i]);return r}}(n.prototype=t("./object")).loadAsync=t("./load"),n.support=t("./support"),n.defaults=t("./defaults"),n.version="3.10.1",n.loadAsync=function(r,i){return new n().loadAsync(r,i)},n.external=t("./external"),c.exports=n},{"./defaults":5,"./external":6,"./load":11,"./object":15,"./support":30}],11:[function(t,c,a){var n=t("./utils"),r=t("./external"),i=t("./utf8"),o=t("./zipEntries"),l=t("./stream/Crc32Probe"),f=t("./nodejsUtils");function m(h){return new r.Promise(function(u,y){var p=h.decompressed.getContentWorker().pipe(new l);p.on("error",function(b){y(b)}).on("end",function(){p.streamInfo.crc32!==h.decompressed.crc32?y(new Error("Corrupted zip : CRC32 mismatch")):u()}).resume()})}c.exports=function(h,u){var y=this;return u=n.extend(u||{},{base64:!1,checkCRC32:!1,optimizedBinaryString:!1,createFolders:!1,decodeFileName:i.utf8decode}),f.isNode&&f.isStream(h)?r.Promise.reject(new Error("JSZip can't accept a stream when loading a zip file.")):n.prepareContent("the loaded zip file",h,!0,u.optimizedBinaryString,u.base64).then(function(p){var b=new o(u);return b.load(p),b}).then(function(p){var b=[r.Promise.resolve(p)],v=p.files;if(u.checkCRC32)for(var C=0;C<v.length;C++)b.push(m(v[C]));return r.Promise.all(b)}).then(function(p){for(var b=p.shift(),v=b.files,C=0;C<v.length;C++){var S=v[C],_=S.fileNameStr,k=n.resolve(S.fileNameStr);y.file(k,S.decompressed,{binary:!0,optimizedBinaryString:!0,date:S.date,dir:S.dir,comment:S.fileCommentStr.length?S.fileCommentStr:null,unixPermissions:S.unixPermissions,dosPermissions:S.dosPermissions,createFolders:u.createFolders}),S.dir||(y.file(k).unsafeOriginalName=_)}return b.zipComment.length&&(y.comment=b.zipComment),y})}},{"./external":6,"./nodejsUtils":14,"./stream/Crc32Probe":25,"./utf8":31,"./utils":32,"./zipEntries":33}],12:[function(t,c,a){var n=t("../utils"),r=t("../stream/GenericWorker");function i(o,l){r.call(this,"Nodejs stream input adapter for "+o),this._upstreamEnded=!1,this._bindStream(l)}n.inherits(i,r),i.prototype._bindStream=function(o){var l=this;(this._stream=o).pause(),o.on("data",function(f){l.push({data:f,meta:{percent:0}})}).on("error",function(f){l.isPaused?this.generatedError=f:l.error(f)}).on("end",function(){l.isPaused?l._upstreamEnded=!0:l.end()})},i.prototype.pause=function(){return!!r.prototype.pause.call(this)&&(this._stream.pause(),!0)},i.prototype.resume=function(){return!!r.prototype.resume.call(this)&&(this._upstreamEnded?this.end():this._stream.resume(),!0)},c.exports=i},{"../stream/GenericWorker":28,"../utils":32}],13:[function(t,c,a){var n=t("readable-stream").Readable;function r(i,o,l){n.call(this,o),this._helper=i;var f=this;i.on("data",function(m,h){f.push(m)||f._helper.pause(),l&&l(h)}).on("error",function(m){f.emit("error",m)}).on("end",function(){f.push(null)})}t("../utils").inherits(r,n),r.prototype._read=function(){this._helper.resume()},c.exports=r},{"../utils":32,"readable-stream":16}],14:[function(t,c,a){c.exports={isNode:typeof Buffer<"u",newBufferFrom:function(n,r){if(Buffer.from&&Buffer.from!==Uint8Array.from)return Buffer.from(n,r);if(typeof n=="number")throw new Error('The "data" argument must not be a number');return new Buffer(n,r)},allocBuffer:function(n){if(Buffer.alloc)return Buffer.alloc(n);var r=new Buffer(n);return r.fill(0),r},isBuffer:function(n){return Buffer.isBuffer(n)},isStream:function(n){return n&&typeof n.on=="function"&&typeof n.pause=="function"&&typeof n.resume=="function"}}},{}],15:[function(t,c,a){function n(k,x,L){var B,M=i.getTypeOf(x),W=i.extend(L||{},f);W.date=W.date||new Date,W.compression!==null&&(W.compression=W.compression.toUpperCase()),typeof W.unixPermissions=="string"&&(W.unixPermissions=parseInt(W.unixPermissions,8)),W.unixPermissions&&16384&W.unixPermissions&&(W.dir=!0),W.dosPermissions&&16&W.dosPermissions&&(W.dir=!0),W.dir&&(k=v(k)),W.createFolders&&(B=b(k))&&C.call(this,B,!0);var Q=M==="string"&&W.binary===!1&&W.base64===!1;L&&L.binary!==void 0||(W.binary=!Q),(x instanceof m&&x.uncompressedSize===0||W.dir||!x||x.length===0)&&(W.base64=!1,W.binary=!0,x="",W.compression="STORE",M="string");var I=null;I=x instanceof m||x instanceof o?x:y.isNode&&y.isStream(x)?new p(k,x):i.prepareContent(k,x,W.binary,W.optimizedBinaryString,W.base64);var z=new h(k,I,W);this.files[k]=z}var r=t("./utf8"),i=t("./utils"),o=t("./stream/GenericWorker"),l=t("./stream/StreamHelper"),f=t("./defaults"),m=t("./compressedObject"),h=t("./zipObject"),u=t("./generate"),y=t("./nodejsUtils"),p=t("./nodejs/NodejsStreamInputAdapter"),b=function(k){k.slice(-1)==="/"&&(k=k.substring(0,k.length-1));var x=k.lastIndexOf("/");return 0<x?k.substring(0,x):""},v=function(k){return k.slice(-1)!=="/"&&(k+="/"),k},C=function(k,x){return x=x!==void 0?x:f.createFolders,k=v(k),this.files[k]||n.call(this,k,null,{dir:!0,createFolders:x}),this.files[k]};function S(k){return Object.prototype.toString.call(k)==="[object RegExp]"}var _={load:function(){throw new Error("This method has been removed in JSZip 3.0, please check the upgrade guide.")},forEach:function(k){var x,L,B;for(x in this.files)B=this.files[x],(L=x.slice(this.root.length,x.length))&&x.slice(0,this.root.length)===this.root&&k(L,B)},filter:function(k){var x=[];return this.forEach(function(L,B){k(L,B)&&x.push(B)}),x},file:function(k,x,L){if(arguments.length!==1)return k=this.root+k,n.call(this,k,x,L),this;if(S(k)){var B=k;return this.filter(function(W,Q){return!Q.dir&&B.test(W)})}var M=this.files[this.root+k];return M&&!M.dir?M:null},folder:function(k){if(!k)return this;if(S(k))return this.filter(function(M,W){return W.dir&&k.test(M)});var x=this.root+k,L=C.call(this,x),B=this.clone();return B.root=L.name,B},remove:function(k){k=this.root+k;var x=this.files[k];if(x||(k.slice(-1)!=="/"&&(k+="/"),x=this.files[k]),x&&!x.dir)delete this.files[k];else for(var L=this.filter(function(M,W){return W.name.slice(0,k.length)===k}),B=0;B<L.length;B++)delete this.files[L[B].name];return this},generate:function(){throw new Error("This method has been removed in JSZip 3.0, please check the upgrade guide.")},generateInternalStream:function(k){var x,L={};try{if((L=i.extend(k||{},{streamFiles:!1,compression:"STORE",compressionOptions:null,type:"",platform:"DOS",comment:null,mimeType:"application/zip",encodeFileName:r.utf8encode})).type=L.type.toLowerCase(),L.compression=L.compression.toUpperCase(),L.type==="binarystring"&&(L.type="string"),!L.type)throw new Error("No output type specified.");i.checkSupport(L.type),L.platform!=="darwin"&&L.platform!=="freebsd"&&L.platform!=="linux"&&L.platform!=="sunos"||(L.platform="UNIX"),L.platform==="win32"&&(L.platform="DOS");var B=L.comment||this.comment||"";x=u.generateWorker(this,L,B)}catch(M){(x=new o("error")).error(M)}return new l(x,L.type||"string",L.mimeType)},generateAsync:function(k,x){return this.generateInternalStream(k).accumulate(x)},generateNodeStream:function(k,x){return(k=k||{}).type||(k.type="nodebuffer"),this.generateInternalStream(k).toNodejsStream(x)}};c.exports=_},{"./compressedObject":2,"./defaults":5,"./generate":9,"./nodejs/NodejsStreamInputAdapter":12,"./nodejsUtils":14,"./stream/GenericWorker":28,"./stream/StreamHelper":29,"./utf8":31,"./utils":32,"./zipObject":35}],16:[function(t,c,a){c.exports=t("stream")},{stream:void 0}],17:[function(t,c,a){var n=t("./DataReader");function r(i){n.call(this,i);for(var o=0;o<this.data.length;o++)i[o]=255&i[o]}t("../utils").inherits(r,n),r.prototype.byteAt=function(i){return this.data[this.zero+i]},r.prototype.lastIndexOfSignature=function(i){for(var o=i.charCodeAt(0),l=i.charCodeAt(1),f=i.charCodeAt(2),m=i.charCodeAt(3),h=this.length-4;0<=h;--h)if(this.data[h]===o&&this.data[h+1]===l&&this.data[h+2]===f&&this.data[h+3]===m)return h-this.zero;return-1},r.prototype.readAndCheckSignature=function(i){var o=i.charCodeAt(0),l=i.charCodeAt(1),f=i.charCodeAt(2),m=i.charCodeAt(3),h=this.readData(4);return o===h[0]&&l===h[1]&&f===h[2]&&m===h[3]},r.prototype.readData=function(i){if(this.checkOffset(i),i===0)return[];var o=this.data.slice(this.zero+this.index,this.zero+this.index+i);return this.index+=i,o},c.exports=r},{"../utils":32,"./DataReader":18}],18:[function(t,c,a){var n=t("../utils");function r(i){this.data=i,this.length=i.length,this.index=0,this.zero=0}r.prototype={checkOffset:function(i){this.checkIndex(this.index+i)},checkIndex:function(i){if(this.length<this.zero+i||i<0)throw new Error("End of data reached (data length = "+this.length+", asked index = "+i+"). Corrupted zip ?")},setIndex:function(i){this.checkIndex(i),this.index=i},skip:function(i){this.setIndex(this.index+i)},byteAt:function(){},readInt:function(i){var o,l=0;for(this.checkOffset(i),o=this.index+i-1;o>=this.index;o--)l=(l<<8)+this.byteAt(o);return this.index+=i,l},readString:function(i){return n.transformTo("string",this.readData(i))},readData:function(){},lastIndexOfSignature:function(){},readAndCheckSignature:function(){},readDate:function(){var i=this.readInt(4);return new Date(Date.UTC(1980+(i>>25&127),(i>>21&15)-1,i>>16&31,i>>11&31,i>>5&63,(31&i)<<1))}},c.exports=r},{"../utils":32}],19:[function(t,c,a){var n=t("./Uint8ArrayReader");function r(i){n.call(this,i)}t("../utils").inherits(r,n),r.prototype.readData=function(i){this.checkOffset(i);var o=this.data.slice(this.zero+this.index,this.zero+this.index+i);return this.index+=i,o},c.exports=r},{"../utils":32,"./Uint8ArrayReader":21}],20:[function(t,c,a){var n=t("./DataReader");function r(i){n.call(this,i)}t("../utils").inherits(r,n),r.prototype.byteAt=function(i){return this.data.charCodeAt(this.zero+i)},r.prototype.lastIndexOfSignature=function(i){return this.data.lastIndexOf(i)-this.zero},r.prototype.readAndCheckSignature=function(i){return i===this.readData(4)},r.prototype.readData=function(i){this.checkOffset(i);var o=this.data.slice(this.zero+this.index,this.zero+this.index+i);return this.index+=i,o},c.exports=r},{"../utils":32,"./DataReader":18}],21:[function(t,c,a){var n=t("./ArrayReader");function r(i){n.call(this,i)}t("../utils").inherits(r,n),r.prototype.readData=function(i){if(this.checkOffset(i),i===0)return new Uint8Array(0);var o=this.data.subarray(this.zero+this.index,this.zero+this.index+i);return this.index+=i,o},c.exports=r},{"../utils":32,"./ArrayReader":17}],22:[function(t,c,a){var n=t("../utils"),r=t("../support"),i=t("./ArrayReader"),o=t("./StringReader"),l=t("./NodeBufferReader"),f=t("./Uint8ArrayReader");c.exports=function(m){var h=n.getTypeOf(m);return n.checkSupport(h),h!=="string"||r.uint8array?h==="nodebuffer"?new l(m):r.uint8array?new f(n.transformTo("uint8array",m)):new i(n.transformTo("array",m)):new o(m)}},{"../support":30,"../utils":32,"./ArrayReader":17,"./NodeBufferReader":19,"./StringReader":20,"./Uint8ArrayReader":21}],23:[function(t,c,a){a.LOCAL_FILE_HEADER="PK",a.CENTRAL_FILE_HEADER="PK",a.CENTRAL_DIRECTORY_END="PK",a.ZIP64_CENTRAL_DIRECTORY_LOCATOR="PK\x07",a.ZIP64_CENTRAL_DIRECTORY_END="PK",a.DATA_DESCRIPTOR="PK\x07\b"},{}],24:[function(t,c,a){var n=t("./GenericWorker"),r=t("../utils");function i(o){n.call(this,"ConvertWorker to "+o),this.destType=o}r.inherits(i,n),i.prototype.processChunk=function(o){this.push({data:r.transformTo(this.destType,o.data),meta:o.meta})},c.exports=i},{"../utils":32,"./GenericWorker":28}],25:[function(t,c,a){var n=t("./GenericWorker"),r=t("../crc32");function i(){n.call(this,"Crc32Probe"),this.withStreamInfo("crc32",0)}t("../utils").inherits(i,n),i.prototype.processChunk=function(o){this.streamInfo.crc32=r(o.data,this.streamInfo.crc32||0),this.push(o)},c.exports=i},{"../crc32":4,"../utils":32,"./GenericWorker":28}],26:[function(t,c,a){var n=t("../utils"),r=t("./GenericWorker");function i(o){r.call(this,"DataLengthProbe for "+o),this.propName=o,this.withStreamInfo(o,0)}n.inherits(i,r),i.prototype.processChunk=function(o){if(o){var l=this.streamInfo[this.propName]||0;this.streamInfo[this.propName]=l+o.data.length}r.prototype.processChunk.call(this,o)},c.exports=i},{"../utils":32,"./GenericWorker":28}],27:[function(t,c,a){var n=t("../utils"),r=t("./GenericWorker");function i(o){r.call(this,"DataWorker");var l=this;this.dataIsReady=!1,this.index=0,this.max=0,this.data=null,this.type="",this._tickScheduled=!1,o.then(function(f){l.dataIsReady=!0,l.data=f,l.max=f&&f.length||0,l.type=n.getTypeOf(f),l.isPaused||l._tickAndRepeat()},function(f){l.error(f)})}n.inherits(i,r),i.prototype.cleanUp=function(){r.prototype.cleanUp.call(this),this.data=null},i.prototype.resume=function(){return!!r.prototype.resume.call(this)&&(!this._tickScheduled&&this.dataIsReady&&(this._tickScheduled=!0,n.delay(this._tickAndRepeat,[],this)),!0)},i.prototype._tickAndRepeat=function(){this._tickScheduled=!1,this.isPaused||this.isFinished||(this._tick(),this.isFinished||(n.delay(this._tickAndRepeat,[],this),this._tickScheduled=!0))},i.prototype._tick=function(){if(this.isPaused||this.isFinished)return!1;var o=null,l=Math.min(this.max,this.index+16384);if(this.index>=this.max)return this.end();switch(this.type){case"string":o=this.data.substring(this.index,l);break;case"uint8array":o=this.data.subarray(this.index,l);break;case"array":case"nodebuffer":o=this.data.slice(this.index,l)}return this.index=l,this.push({data:o,meta:{percent:this.max?this.index/this.max*100:0}})},c.exports=i},{"../utils":32,"./GenericWorker":28}],28:[function(t,c,a){function n(r){this.name=r||"default",this.streamInfo={},this.generatedError=null,this.extraStreamInfo={},this.isPaused=!0,this.isFinished=!1,this.isLocked=!1,this._listeners={data:[],end:[],error:[]},this.previous=null}n.prototype={push:function(r){this.emit("data",r)},end:function(){if(this.isFinished)return!1;this.flush();try{this.emit("end"),this.cleanUp(),this.isFinished=!0}catch(r){this.emit("error",r)}return!0},error:function(r){return!this.isFinished&&(this.isPaused?this.generatedError=r:(this.isFinished=!0,this.emit("error",r),this.previous&&this.previous.error(r),this.cleanUp()),!0)},on:function(r,i){return this._listeners[r].push(i),this},cleanUp:function(){this.streamInfo=this.generatedError=this.extraStreamInfo=null,this._listeners=[]},emit:function(r,i){if(this._listeners[r])for(var o=0;o<this._listeners[r].length;o++)this._listeners[r][o].call(this,i)},pipe:function(r){return r.registerPrevious(this)},registerPrevious:function(r){if(this.isLocked)throw new Error("The stream '"+this+"' has already been used.");this.streamInfo=r.streamInfo,this.mergeStreamInfo(),this.previous=r;var i=this;return r.on("data",function(o){i.processChunk(o)}),r.on("end",function(){i.end()}),r.on("error",function(o){i.error(o)}),this},pause:function(){return!this.isPaused&&!this.isFinished&&(this.isPaused=!0,this.previous&&this.previous.pause(),!0)},resume:function(){if(!this.isPaused||this.isFinished)return!1;var r=this.isPaused=!1;return this.generatedError&&(this.error(this.generatedError),r=!0),this.previous&&this.previous.resume(),!r},flush:function(){},processChunk:function(r){this.push(r)},withStreamInfo:function(r,i){return this.extraStreamInfo[r]=i,this.mergeStreamInfo(),this},mergeStreamInfo:function(){for(var r in this.extraStreamInfo)Object.prototype.hasOwnProperty.call(this.extraStreamInfo,r)&&(this.streamInfo[r]=this.extraStreamInfo[r])},lock:function(){if(this.isLocked)throw new Error("The stream '"+this+"' has already been used.");this.isLocked=!0,this.previous&&this.previous.lock()},toString:function(){var r="Worker "+this.name;return this.previous?this.previous+" -> "+r:r}},c.exports=n},{}],29:[function(t,c,a){var n=t("../utils"),r=t("./ConvertWorker"),i=t("./GenericWorker"),o=t("../base64"),l=t("../support"),f=t("../external"),m=null;if(l.nodestream)try{m=t("../nodejs/NodejsStreamOutputAdapter")}catch{}function h(y,p){return new f.Promise(function(b,v){var C=[],S=y._internalType,_=y._outputType,k=y._mimeType;y.on("data",function(x,L){C.push(x),p&&p(L)}).on("error",function(x){C=[],v(x)}).on("end",function(){try{var x=function(L,B,M){switch(L){case"blob":return n.newBlob(n.transformTo("arraybuffer",B),M);case"base64":return o.encode(B);default:return n.transformTo(L,B)}}(_,function(L,B){var M,W=0,Q=null,I=0;for(M=0;M<B.length;M++)I+=B[M].length;switch(L){case"string":return B.join("");case"array":return Array.prototype.concat.apply([],B);case"uint8array":for(Q=new Uint8Array(I),M=0;M<B.length;M++)Q.set(B[M],W),W+=B[M].length;return Q;case"nodebuffer":return Buffer.concat(B);default:throw new Error("concat : unsupported type '"+L+"'")}}(S,C),k);b(x)}catch(L){v(L)}C=[]}).resume()})}function u(y,p,b){var v=p;switch(p){case"blob":case"arraybuffer":v="uint8array";break;case"base64":v="string"}try{this._internalType=v,this._outputType=p,this._mimeType=b,n.checkSupport(v),this._worker=y.pipe(new r(v)),y.lock()}catch(C){this._worker=new i("error"),this._worker.error(C)}}u.prototype={accumulate:function(y){return h(this,y)},on:function(y,p){var b=this;return y==="data"?this._worker.on(y,function(v){p.call(b,v.data,v.meta)}):this._worker.on(y,function(){n.delay(p,arguments,b)}),this},resume:function(){return n.delay(this._worker.resume,[],this._worker),this},pause:function(){return this._worker.pause(),this},toNodejsStream:function(y){if(n.checkSupport("nodestream"),this._outputType!=="nodebuffer")throw new Error(this._outputType+" is not supported by this method");return new m(this,{objectMode:this._outputType!=="nodebuffer"},y)}},c.exports=u},{"../base64":1,"../external":6,"../nodejs/NodejsStreamOutputAdapter":13,"../support":30,"../utils":32,"./ConvertWorker":24,"./GenericWorker":28}],30:[function(t,c,a){if(a.base64=!0,a.array=!0,a.string=!0,a.arraybuffer=typeof ArrayBuffer<"u"&&typeof Uint8Array<"u",a.nodebuffer=typeof Buffer<"u",a.uint8array=typeof Uint8Array<"u",typeof ArrayBuffer>"u")a.blob=!1;else{var n=new ArrayBuffer(0);try{a.blob=new Blob([n],{type:"application/zip"}).size===0}catch{try{var r=new(self.BlobBuilder||self.WebKitBlobBuilder||self.MozBlobBuilder||self.MSBlobBuilder);r.append(n),a.blob=r.getBlob("application/zip").size===0}catch{a.blob=!1}}}try{a.nodestream=!!t("readable-stream").Readable}catch{a.nodestream=!1}},{"readable-stream":16}],31:[function(t,c,a){for(var n=t("./utils"),r=t("./support"),i=t("./nodejsUtils"),o=t("./stream/GenericWorker"),l=new Array(256),f=0;f<256;f++)l[f]=252<=f?6:248<=f?5:240<=f?4:224<=f?3:192<=f?2:1;l[254]=l[254]=1;function m(){o.call(this,"utf-8 decode"),this.leftOver=null}function h(){o.call(this,"utf-8 encode")}a.utf8encode=function(u){return r.nodebuffer?i.newBufferFrom(u,"utf-8"):function(y){var p,b,v,C,S,_=y.length,k=0;for(C=0;C<_;C++)(64512&(b=y.charCodeAt(C)))==55296&&C+1<_&&(64512&(v=y.charCodeAt(C+1)))==56320&&(b=65536+(b-55296<<10)+(v-56320),C++),k+=b<128?1:b<2048?2:b<65536?3:4;for(p=r.uint8array?new Uint8Array(k):new Array(k),C=S=0;S<k;C++)(64512&(b=y.charCodeAt(C)))==55296&&C+1<_&&(64512&(v=y.charCodeAt(C+1)))==56320&&(b=65536+(b-55296<<10)+(v-56320),C++),b<128?p[S++]=b:(b<2048?p[S++]=192|b>>>6:(b<65536?p[S++]=224|b>>>12:(p[S++]=240|b>>>18,p[S++]=128|b>>>12&63),p[S++]=128|b>>>6&63),p[S++]=128|63&b);return p}(u)},a.utf8decode=function(u){return r.nodebuffer?n.transformTo("nodebuffer",u).toString("utf-8"):function(y){var p,b,v,C,S=y.length,_=new Array(2*S);for(p=b=0;p<S;)if((v=y[p++])<128)_[b++]=v;else if(4<(C=l[v]))_[b++]=65533,p+=C-1;else{for(v&=C===2?31:C===3?15:7;1<C&&p<S;)v=v<<6|63&y[p++],C--;1<C?_[b++]=65533:v<65536?_[b++]=v:(v-=65536,_[b++]=55296|v>>10&1023,_[b++]=56320|1023&v)}return _.length!==b&&(_.subarray?_=_.subarray(0,b):_.length=b),n.applyFromCharCode(_)}(u=n.transformTo(r.uint8array?"uint8array":"array",u))},n.inherits(m,o),m.prototype.processChunk=function(u){var y=n.transformTo(r.uint8array?"uint8array":"array",u.data);if(this.leftOver&&this.leftOver.length){if(r.uint8array){var p=y;(y=new Uint8Array(p.length+this.leftOver.length)).set(this.leftOver,0),y.set(p,this.leftOver.length)}else y=this.leftOver.concat(y);this.leftOver=null}var b=function(C,S){var _;for((S=S||C.length)>C.length&&(S=C.length),_=S-1;0<=_&&(192&C[_])==128;)_--;return _<0||_===0?S:_+l[C[_]]>S?_:S}(y),v=y;b!==y.length&&(r.uint8array?(v=y.subarray(0,b),this.leftOver=y.subarray(b,y.length)):(v=y.slice(0,b),this.leftOver=y.slice(b,y.length))),this.push({data:a.utf8decode(v),meta:u.meta})},m.prototype.flush=function(){this.leftOver&&this.leftOver.length&&(this.push({data:a.utf8decode(this.leftOver),meta:{}}),this.leftOver=null)},a.Utf8DecodeWorker=m,n.inherits(h,o),h.prototype.processChunk=function(u){this.push({data:a.utf8encode(u.data),meta:u.meta})},a.Utf8EncodeWorker=h},{"./nodejsUtils":14,"./stream/GenericWorker":28,"./support":30,"./utils":32}],32:[function(t,c,a){var n=t("./support"),r=t("./base64"),i=t("./nodejsUtils"),o=t("./external");function l(p){return p}function f(p,b){for(var v=0;v<p.length;++v)b[v]=255&p.charCodeAt(v);return b}t("setimmediate"),a.newBlob=function(p,b){a.checkSupport("blob");try{return new Blob([p],{type:b})}catch{try{var v=new(self.BlobBuilder||self.WebKitBlobBuilder||self.MozBlobBuilder||self.MSBlobBuilder);return v.append(p),v.getBlob(b)}catch{throw new Error("Bug : can't construct the Blob.")}}};var m={stringifyByChunk:function(p,b,v){var C=[],S=0,_=p.length;if(_<=v)return String.fromCharCode.apply(null,p);for(;S<_;)b==="array"||b==="nodebuffer"?C.push(String.fromCharCode.apply(null,p.slice(S,Math.min(S+v,_)))):C.push(String.fromCharCode.apply(null,p.subarray(S,Math.min(S+v,_)))),S+=v;return C.join("")},stringifyByChar:function(p){for(var b="",v=0;v<p.length;v++)b+=String.fromCharCode(p[v]);return b},applyCanBeUsed:{uint8array:function(){try{return n.uint8array&&String.fromCharCode.apply(null,new Uint8Array(1)).length===1}catch{return!1}}(),nodebuffer:function(){try{return n.nodebuffer&&String.fromCharCode.apply(null,i.allocBuffer(1)).length===1}catch{return!1}}()}};function h(p){var b=65536,v=a.getTypeOf(p),C=!0;if(v==="uint8array"?C=m.applyCanBeUsed.uint8array:v==="nodebuffer"&&(C=m.applyCanBeUsed.nodebuffer),C)for(;1<b;)try{return m.stringifyByChunk(p,v,b)}catch{b=Math.floor(b/2)}return m.stringifyByChar(p)}function u(p,b){for(var v=0;v<p.length;v++)b[v]=p[v];return b}a.applyFromCharCode=h;var y={};y.string={string:l,array:function(p){return f(p,new Array(p.length))},arraybuffer:function(p){return y.string.uint8array(p).buffer},uint8array:function(p){return f(p,new Uint8Array(p.length))},nodebuffer:function(p){return f(p,i.allocBuffer(p.length))}},y.array={string:h,array:l,arraybuffer:function(p){return new Uint8Array(p).buffer},uint8array:function(p){return new Uint8Array(p)},nodebuffer:function(p){return i.newBufferFrom(p)}},y.arraybuffer={string:function(p){return h(new Uint8Array(p))},array:function(p){return u(new Uint8Array(p),new Array(p.byteLength))},arraybuffer:l,uint8array:function(p){return new Uint8Array(p)},nodebuffer:function(p){return i.newBufferFrom(new Uint8Array(p))}},y.uint8array={string:h,array:function(p){return u(p,new Array(p.length))},arraybuffer:function(p){return p.buffer},uint8array:l,nodebuffer:function(p){return i.newBufferFrom(p)}},y.nodebuffer={string:h,array:function(p){return u(p,new Array(p.length))},arraybuffer:function(p){return y.nodebuffer.uint8array(p).buffer},uint8array:function(p){return u(p,new Uint8Array(p.length))},nodebuffer:l},a.transformTo=function(p,b){if(b=b||"",!p)return b;a.checkSupport(p);var v=a.getTypeOf(b);return y[v][p](b)},a.resolve=function(p){for(var b=p.split("/"),v=[],C=0;C<b.length;C++){var S=b[C];S==="."||S===""&&C!==0&&C!==b.length-1||(S===".."?v.pop():v.push(S))}return v.join("/")},a.getTypeOf=function(p){return typeof p=="string"?"string":Object.prototype.toString.call(p)==="[object Array]"?"array":n.nodebuffer&&i.isBuffer(p)?"nodebuffer":n.uint8array&&p instanceof Uint8Array?"uint8array":n.arraybuffer&&p instanceof ArrayBuffer?"arraybuffer":void 0},a.checkSupport=function(p){if(!n[p.toLowerCase()])throw new Error(p+" is not supported by this platform")},a.MAX_VALUE_16BITS=65535,a.MAX_VALUE_32BITS=-1,a.pretty=function(p){var b,v,C="";for(v=0;v<(p||"").length;v++)C+="\\x"+((b=p.charCodeAt(v))<16?"0":"")+b.toString(16).toUpperCase();return C},a.delay=function(p,b,v){setImmediate(function(){p.apply(v||null,b||[])})},a.inherits=function(p,b){function v(){}v.prototype=b.prototype,p.prototype=new v},a.extend=function(){var p,b,v={};for(p=0;p<arguments.length;p++)for(b in arguments[p])Object.prototype.hasOwnProperty.call(arguments[p],b)&&v[b]===void 0&&(v[b]=arguments[p][b]);return v},a.prepareContent=function(p,b,v,C,S){return o.Promise.resolve(b).then(function(_){return n.blob&&(_ instanceof Blob||["[object File]","[object Blob]"].indexOf(Object.prototype.toString.call(_))!==-1)&&typeof FileReader<"u"?new o.Promise(function(k,x){var L=new FileReader;L.onload=function(B){k(B.target.result)},L.onerror=function(B){x(B.target.error)},L.readAsArrayBuffer(_)}):_}).then(function(_){var k=a.getTypeOf(_);return k?(k==="arraybuffer"?_=a.transformTo("uint8array",_):k==="string"&&(S?_=r.decode(_):v&&C!==!0&&(_=function(x){return f(x,n.uint8array?new Uint8Array(x.length):new Array(x.length))}(_))),_):o.Promise.reject(new Error("Can't read the data of '"+p+"'. Is it in a supported JavaScript type (String, Blob, ArrayBuffer, etc) ?"))})}},{"./base64":1,"./external":6,"./nodejsUtils":14,"./support":30,setimmediate:54}],33:[function(t,c,a){var n=t("./reader/readerFor"),r=t("./utils"),i=t("./signature"),o=t("./zipEntry"),l=t("./support");function f(m){this.files=[],this.loadOptions=m}f.prototype={checkSignature:function(m){if(!this.reader.readAndCheckSignature(m)){this.reader.index-=4;var h=this.reader.readString(4);throw new Error("Corrupted zip or bug: unexpected signature ("+r.pretty(h)+", expected "+r.pretty(m)+")")}},isSignature:function(m,h){var u=this.reader.index;this.reader.setIndex(m);var y=this.reader.readString(4)===h;return this.reader.setIndex(u),y},readBlockEndOfCentral:function(){this.diskNumber=this.reader.readInt(2),this.diskWithCentralDirStart=this.reader.readInt(2),this.centralDirRecordsOnThisDisk=this.reader.readInt(2),this.centralDirRecords=this.reader.readInt(2),this.centralDirSize=this.reader.readInt(4),this.centralDirOffset=this.reader.readInt(4),this.zipCommentLength=this.reader.readInt(2);var m=this.reader.readData(this.zipCommentLength),h=l.uint8array?"uint8array":"array",u=r.transformTo(h,m);this.zipComment=this.loadOptions.decodeFileName(u)},readBlockZip64EndOfCentral:function(){this.zip64EndOfCentralSize=this.reader.readInt(8),this.reader.skip(4),this.diskNumber=this.reader.readInt(4),this.diskWithCentralDirStart=this.reader.readInt(4),this.centralDirRecordsOnThisDisk=this.reader.readInt(8),this.centralDirRecords=this.reader.readInt(8),this.centralDirSize=this.reader.readInt(8),this.centralDirOffset=this.reader.readInt(8),this.zip64ExtensibleData={};for(var m,h,u,y=this.zip64EndOfCentralSize-44;0<y;)m=this.reader.readInt(2),h=this.reader.readInt(4),u=this.reader.readData(h),this.zip64ExtensibleData[m]={id:m,length:h,value:u}},readBlockZip64EndOfCentralLocator:function(){if(this.diskWithZip64CentralDirStart=this.reader.readInt(4),this.relativeOffsetEndOfZip64CentralDir=this.reader.readInt(8),this.disksCount=this.reader.readInt(4),1<this.disksCount)throw new Error("Multi-volumes zip are not supported")},readLocalFiles:function(){var m,h;for(m=0;m<this.files.length;m++)h=this.files[m],this.reader.setIndex(h.localHeaderOffset),this.checkSignature(i.LOCAL_FILE_HEADER),h.readLocalPart(this.reader),h.handleUTF8(),h.processAttributes()},readCentralDir:function(){var m;for(this.reader.setIndex(this.centralDirOffset);this.reader.readAndCheckSignature(i.CENTRAL_FILE_HEADER);)(m=new o({zip64:this.zip64},this.loadOptions)).readCentralPart(this.reader),this.files.push(m);if(this.centralDirRecords!==this.files.length&&this.centralDirRecords!==0&&this.files.length===0)throw new Error("Corrupted zip or bug: expected "+this.centralDirRecords+" records in central dir, got "+this.files.length)},readEndOfCentral:function(){var m=this.reader.lastIndexOfSignature(i.CENTRAL_DIRECTORY_END);if(m<0)throw this.isSignature(0,i.LOCAL_FILE_HEADER)?new Error("Corrupted zip: can't find end of central directory"):new Error("Can't find end of central directory : is this a zip file ? If it is, see https://stuk.github.io/jszip/documentation/howto/read_zip.html");this.reader.setIndex(m);var h=m;if(this.checkSignature(i.CENTRAL_DIRECTORY_END),this.readBlockEndOfCentral(),this.diskNumber===r.MAX_VALUE_16BITS||this.diskWithCentralDirStart===r.MAX_VALUE_16BITS||this.centralDirRecordsOnThisDisk===r.MAX_VALUE_16BITS||this.centralDirRecords===r.MAX_VALUE_16BITS||this.centralDirSize===r.MAX_VALUE_32BITS||this.centralDirOffset===r.MAX_VALUE_32BITS){if(this.zip64=!0,(m=this.reader.lastIndexOfSignature(i.ZIP64_CENTRAL_DIRECTORY_LOCATOR))<0)throw new Error("Corrupted zip: can't find the ZIP64 end of central directory locator");if(this.reader.setIndex(m),this.checkSignature(i.ZIP64_CENTRAL_DIRECTORY_LOCATOR),this.readBlockZip64EndOfCentralLocator(),!this.isSignature(this.relativeOffsetEndOfZip64CentralDir,i.ZIP64_CENTRAL_DIRECTORY_END)&&(this.relativeOffsetEndOfZip64CentralDir=this.reader.lastIndexOfSignature(i.ZIP64_CENTRAL_DIRECTORY_END),this.relativeOffsetEndOfZip64CentralDir<0))throw new Error("Corrupted zip: can't find the ZIP64 end of central directory");this.reader.setIndex(this.relativeOffsetEndOfZip64CentralDir),this.checkSignature(i.ZIP64_CENTRAL_DIRECTORY_END),this.readBlockZip64EndOfCentral()}var u=this.centralDirOffset+this.centralDirSize;this.zip64&&(u+=20,u+=12+this.zip64EndOfCentralSize);var y=h-u;if(0<y)this.isSignature(h,i.CENTRAL_FILE_HEADER)||(this.reader.zero=y);else if(y<0)throw new Error("Corrupted zip: missing "+Math.abs(y)+" bytes.")},prepareReader:function(m){this.reader=n(m)},load:function(m){this.prepareReader(m),this.readEndOfCentral(),this.readCentralDir(),this.readLocalFiles()}},c.exports=f},{"./reader/readerFor":22,"./signature":23,"./support":30,"./utils":32,"./zipEntry":34}],34:[function(t,c,a){var n=t("./reader/readerFor"),r=t("./utils"),i=t("./compressedObject"),o=t("./crc32"),l=t("./utf8"),f=t("./compressions"),m=t("./support");function h(u,y){this.options=u,this.loadOptions=y}h.prototype={isEncrypted:function(){return(1&this.bitFlag)==1},useUTF8:function(){return(2048&this.bitFlag)==2048},readLocalPart:function(u){var y,p;if(u.skip(22),this.fileNameLength=u.readInt(2),p=u.readInt(2),this.fileName=u.readData(this.fileNameLength),u.skip(p),this.compressedSize===-1||this.uncompressedSize===-1)throw new Error("Bug or corrupted zip : didn't get enough information from the central directory (compressedSize === -1 || uncompressedSize === -1)");if((y=function(b){for(var v in f)if(Object.prototype.hasOwnProperty.call(f,v)&&f[v].magic===b)return f[v];return null}(this.compressionMethod))===null)throw new Error("Corrupted zip : compression "+r.pretty(this.compressionMethod)+" unknown (inner file : "+r.transformTo("string",this.fileName)+")");this.decompressed=new i(this.compressedSize,this.uncompressedSize,this.crc32,y,u.readData(this.compressedSize))},readCentralPart:function(u){this.versionMadeBy=u.readInt(2),u.skip(2),this.bitFlag=u.readInt(2),this.compressionMethod=u.readString(2),this.date=u.readDate(),this.crc32=u.readInt(4),this.compressedSize=u.readInt(4),this.uncompressedSize=u.readInt(4);var y=u.readInt(2);if(this.extraFieldsLength=u.readInt(2),this.fileCommentLength=u.readInt(2),this.diskNumberStart=u.readInt(2),this.internalFileAttributes=u.readInt(2),this.externalFileAttributes=u.readInt(4),this.localHeaderOffset=u.readInt(4),this.isEncrypted())throw new Error("Encrypted zip are not supported");u.skip(y),this.readExtraFields(u),this.parseZIP64ExtraField(u),this.fileComment=u.readData(this.fileCommentLength)},processAttributes:function(){this.unixPermissions=null,this.dosPermissions=null;var u=this.versionMadeBy>>8;this.dir=!!(16&this.externalFileAttributes),u==0&&(this.dosPermissions=63&this.externalFileAttributes),u==3&&(this.unixPermissions=this.externalFileAttributes>>16&65535),this.dir||this.fileNameStr.slice(-1)!=="/"||(this.dir=!0)},parseZIP64ExtraField:function(){if(this.extraFields[1]){var u=n(this.extraFields[1].value);this.uncompressedSize===r.MAX_VALUE_32BITS&&(this.uncompressedSize=u.readInt(8)),this.compressedSize===r.MAX_VALUE_32BITS&&(this.compressedSize=u.readInt(8)),this.localHeaderOffset===r.MAX_VALUE_32BITS&&(this.localHeaderOffset=u.readInt(8)),this.diskNumberStart===r.MAX_VALUE_32BITS&&(this.diskNumberStart=u.readInt(4))}},readExtraFields:function(u){var y,p,b,v=u.index+this.extraFieldsLength;for(this.extraFields||(this.extraFields={});u.index+4<v;)y=u.readInt(2),p=u.readInt(2),b=u.readData(p),this.extraFields[y]={id:y,length:p,value:b};u.setIndex(v)},handleUTF8:function(){var u=m.uint8array?"uint8array":"array";if(this.useUTF8())this.fileNameStr=l.utf8decode(this.fileName),this.fileCommentStr=l.utf8decode(this.fileComment);else{var y=this.findExtraFieldUnicodePath();if(y!==null)this.fileNameStr=y;else{var p=r.transformTo(u,this.fileName);this.fileNameStr=this.loadOptions.decodeFileName(p)}var b=this.findExtraFieldUnicodeComment();if(b!==null)this.fileCommentStr=b;else{var v=r.transformTo(u,this.fileComment);this.fileCommentStr=this.loadOptions.decodeFileName(v)}}},findExtraFieldUnicodePath:function(){var u=this.extraFields[28789];if(u){var y=n(u.value);return y.readInt(1)!==1||o(this.fileName)!==y.readInt(4)?null:l.utf8decode(y.readData(u.length-5))}return null},findExtraFieldUnicodeComment:function(){var u=this.extraFields[25461];if(u){var y=n(u.value);return y.readInt(1)!==1||o(this.fileComment)!==y.readInt(4)?null:l.utf8decode(y.readData(u.length-5))}return null}},c.exports=h},{"./compressedObject":2,"./compressions":3,"./crc32":4,"./reader/readerFor":22,"./support":30,"./utf8":31,"./utils":32}],35:[function(t,c,a){function n(y,p,b){this.name=y,this.dir=b.dir,this.date=b.date,this.comment=b.comment,this.unixPermissions=b.unixPermissions,this.dosPermissions=b.dosPermissions,this._data=p,this._dataBinary=b.binary,this.options={compression:b.compression,compressionOptions:b.compressionOptions}}var r=t("./stream/StreamHelper"),i=t("./stream/DataWorker"),o=t("./utf8"),l=t("./compressedObject"),f=t("./stream/GenericWorker");n.prototype={internalStream:function(y){var p=null,b="string";try{if(!y)throw new Error("No output type specified.");var v=(b=y.toLowerCase())==="string"||b==="text";b!=="binarystring"&&b!=="text"||(b="string"),p=this._decompressWorker();var C=!this._dataBinary;C&&!v&&(p=p.pipe(new o.Utf8EncodeWorker)),!C&&v&&(p=p.pipe(new o.Utf8DecodeWorker))}catch(S){(p=new f("error")).error(S)}return new r(p,b,"")},async:function(y,p){return this.internalStream(y).accumulate(p)},nodeStream:function(y,p){return this.internalStream(y||"nodebuffer").toNodejsStream(p)},_compressWorker:function(y,p){if(this._data instanceof l&&this._data.compression.magic===y.magic)return this._data.getCompressedWorker();var b=this._decompressWorker();return this._dataBinary||(b=b.pipe(new o.Utf8EncodeWorker)),l.createWorkerFrom(b,y,p)},_decompressWorker:function(){return this._data instanceof l?this._data.getContentWorker():this._data instanceof f?this._data:new i(this._data)}};for(var m=["asText","asBinary","asNodeBuffer","asUint8Array","asArrayBuffer"],h=function(){throw new Error("This method has been removed in JSZip 3.0, please check the upgrade guide.")},u=0;u<m.length;u++)n.prototype[m[u]]=h;c.exports=n},{"./compressedObject":2,"./stream/DataWorker":27,"./stream/GenericWorker":28,"./stream/StreamHelper":29,"./utf8":31}],36:[function(t,c,a){(function(n){var r,i,o=n.MutationObserver||n.WebKitMutationObserver;if(o){var l=0,f=new o(y),m=n.document.createTextNode("");f.observe(m,{characterData:!0}),r=function(){m.data=l=++l%2}}else if(n.setImmediate||n.MessageChannel===void 0)r="document"in n&&"onreadystatechange"in n.document.createElement("script")?function(){var p=n.document.createElement("script");p.onreadystatechange=function(){y(),p.onreadystatechange=null,p.parentNode.removeChild(p),p=null},n.document.documentElement.appendChild(p)}:function(){setTimeout(y,0)};else{var h=new n.MessageChannel;h.port1.onmessage=y,r=function(){h.port2.postMessage(0)}}var u=[];function y(){var p,b;i=!0;for(var v=u.length;v;){for(b=u,u=[],p=-1;++p<v;)b[p]();v=u.length}i=!1}c.exports=function(p){u.push(p)!==1||i||r()}}).call(this,typeof Bn<"u"?Bn:typeof self<"u"?self:typeof window<"u"?window:{})},{}],37:[function(t,c,a){var n=t("immediate");function r(){}var i={},o=["REJECTED"],l=["FULFILLED"],f=["PENDING"];function m(v){if(typeof v!="function")throw new TypeError("resolver must be a function");this.state=f,this.queue=[],this.outcome=void 0,v!==r&&p(this,v)}function h(v,C,S){this.promise=v,typeof C=="function"&&(this.onFulfilled=C,this.callFulfilled=this.otherCallFulfilled),typeof S=="function"&&(this.onRejected=S,this.callRejected=this.otherCallRejected)}function u(v,C,S){n(function(){var _;try{_=C(S)}catch(k){return i.reject(v,k)}_===v?i.reject(v,new TypeError("Cannot resolve promise with itself")):i.resolve(v,_)})}function y(v){var C=v&&v.then;if(v&&(typeof v=="object"||typeof v=="function")&&typeof C=="function")return function(){C.apply(v,arguments)}}function p(v,C){var S=!1;function _(L){S||(S=!0,i.reject(v,L))}function k(L){S||(S=!0,i.resolve(v,L))}var x=b(function(){C(k,_)});x.status==="error"&&_(x.value)}function b(v,C){var S={};try{S.value=v(C),S.status="success"}catch(_){S.status="error",S.value=_}return S}(c.exports=m).prototype.finally=function(v){if(typeof v!="function")return this;var C=this.constructor;return this.then(function(S){return C.resolve(v()).then(function(){return S})},function(S){return C.resolve(v()).then(function(){throw S})})},m.prototype.catch=function(v){return this.then(null,v)},m.prototype.then=function(v,C){if(typeof v!="function"&&this.state===l||typeof C!="function"&&this.state===o)return this;var S=new this.constructor(r);return this.state!==f?u(S,this.state===l?v:C,this.outcome):this.queue.push(new h(S,v,C)),S},h.prototype.callFulfilled=function(v){i.resolve(this.promise,v)},h.prototype.otherCallFulfilled=function(v){u(this.promise,this.onFulfilled,v)},h.prototype.callRejected=function(v){i.reject(this.promise,v)},h.prototype.otherCallRejected=function(v){u(this.promise,this.onRejected,v)},i.resolve=function(v,C){var S=b(y,C);if(S.status==="error")return i.reject(v,S.value);var _=S.value;if(_)p(v,_);else{v.state=l,v.outcome=C;for(var k=-1,x=v.queue.length;++k<x;)v.queue[k].callFulfilled(C)}return v},i.reject=function(v,C){v.state=o,v.outcome=C;for(var S=-1,_=v.queue.length;++S<_;)v.queue[S].callRejected(C);return v},m.resolve=function(v){return v instanceof this?v:i.resolve(new this(r),v)},m.reject=function(v){var C=new this(r);return i.reject(C,v)},m.all=function(v){var C=this;if(Object.prototype.toString.call(v)!=="[object Array]")return this.reject(new TypeError("must be an array"));var S=v.length,_=!1;if(!S)return this.resolve([]);for(var k=new Array(S),x=0,L=-1,B=new this(r);++L<S;)M(v[L],L);return B;function M(W,Q){C.resolve(W).then(function(I){k[Q]=I,++x!==S||_||(_=!0,i.resolve(B,k))},function(I){_||(_=!0,i.reject(B,I))})}},m.race=function(v){var C=this;if(Object.prototype.toString.call(v)!=="[object Array]")return this.reject(new TypeError("must be an array"));var S=v.length,_=!1;if(!S)return this.resolve([]);for(var k=-1,x=new this(r);++k<S;)L=v[k],C.resolve(L).then(function(B){_||(_=!0,i.resolve(x,B))},function(B){_||(_=!0,i.reject(x,B))});var L;return x}},{immediate:36}],38:[function(t,c,a){var n={};(0,t("./lib/utils/common").assign)(n,t("./lib/deflate"),t("./lib/inflate"),t("./lib/zlib/constants")),c.exports=n},{"./lib/deflate":39,"./lib/inflate":40,"./lib/utils/common":41,"./lib/zlib/constants":44}],39:[function(t,c,a){var n=t("./zlib/deflate"),r=t("./utils/common"),i=t("./utils/strings"),o=t("./zlib/messages"),l=t("./zlib/zstream"),f=Object.prototype.toString,m=0,h=-1,u=0,y=8;function p(v){if(!(this instanceof p))return new p(v);this.options=r.assign({level:h,method:y,chunkSize:16384,windowBits:15,memLevel:8,strategy:u,to:""},v||{});var C=this.options;C.raw&&0<C.windowBits?C.windowBits=-C.windowBits:C.gzip&&0<C.windowBits&&C.windowBits<16&&(C.windowBits+=16),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new l,this.strm.avail_out=0;var S=n.deflateInit2(this.strm,C.level,C.method,C.windowBits,C.memLevel,C.strategy);if(S!==m)throw new Error(o[S]);if(C.header&&n.deflateSetHeader(this.strm,C.header),C.dictionary){var _;if(_=typeof C.dictionary=="string"?i.string2buf(C.dictionary):f.call(C.dictionary)==="[object ArrayBuffer]"?new Uint8Array(C.dictionary):C.dictionary,(S=n.deflateSetDictionary(this.strm,_))!==m)throw new Error(o[S]);this._dict_set=!0}}function b(v,C){var S=new p(C);if(S.push(v,!0),S.err)throw S.msg||o[S.err];return S.result}p.prototype.push=function(v,C){var S,_,k=this.strm,x=this.options.chunkSize;if(this.ended)return!1;_=C===~~C?C:C===!0?4:0,typeof v=="string"?k.input=i.string2buf(v):f.call(v)==="[object ArrayBuffer]"?k.input=new Uint8Array(v):k.input=v,k.next_in=0,k.avail_in=k.input.length;do{if(k.avail_out===0&&(k.output=new r.Buf8(x),k.next_out=0,k.avail_out=x),(S=n.deflate(k,_))!==1&&S!==m)return this.onEnd(S),!(this.ended=!0);k.avail_out!==0&&(k.avail_in!==0||_!==4&&_!==2)||(this.options.to==="string"?this.onData(i.buf2binstring(r.shrinkBuf(k.output,k.next_out))):this.onData(r.shrinkBuf(k.output,k.next_out)))}while((0<k.avail_in||k.avail_out===0)&&S!==1);return _===4?(S=n.deflateEnd(this.strm),this.onEnd(S),this.ended=!0,S===m):_!==2||(this.onEnd(m),!(k.avail_out=0))},p.prototype.onData=function(v){this.chunks.push(v)},p.prototype.onEnd=function(v){v===m&&(this.options.to==="string"?this.result=this.chunks.join(""):this.result=r.flattenChunks(this.chunks)),this.chunks=[],this.err=v,this.msg=this.strm.msg},a.Deflate=p,a.deflate=b,a.deflateRaw=function(v,C){return(C=C||{}).raw=!0,b(v,C)},a.gzip=function(v,C){return(C=C||{}).gzip=!0,b(v,C)}},{"./utils/common":41,"./utils/strings":42,"./zlib/deflate":46,"./zlib/messages":51,"./zlib/zstream":53}],40:[function(t,c,a){var n=t("./zlib/inflate"),r=t("./utils/common"),i=t("./utils/strings"),o=t("./zlib/constants"),l=t("./zlib/messages"),f=t("./zlib/zstream"),m=t("./zlib/gzheader"),h=Object.prototype.toString;function u(p){if(!(this instanceof u))return new u(p);this.options=r.assign({chunkSize:16384,windowBits:0,to:""},p||{});var b=this.options;b.raw&&0<=b.windowBits&&b.windowBits<16&&(b.windowBits=-b.windowBits,b.windowBits===0&&(b.windowBits=-15)),!(0<=b.windowBits&&b.windowBits<16)||p&&p.windowBits||(b.windowBits+=32),15<b.windowBits&&b.windowBits<48&&!(15&b.windowBits)&&(b.windowBits|=15),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new f,this.strm.avail_out=0;var v=n.inflateInit2(this.strm,b.windowBits);if(v!==o.Z_OK)throw new Error(l[v]);this.header=new m,n.inflateGetHeader(this.strm,this.header)}function y(p,b){var v=new u(b);if(v.push(p,!0),v.err)throw v.msg||l[v.err];return v.result}u.prototype.push=function(p,b){var v,C,S,_,k,x,L=this.strm,B=this.options.chunkSize,M=this.options.dictionary,W=!1;if(this.ended)return!1;C=b===~~b?b:b===!0?o.Z_FINISH:o.Z_NO_FLUSH,typeof p=="string"?L.input=i.binstring2buf(p):h.call(p)==="[object ArrayBuffer]"?L.input=new Uint8Array(p):L.input=p,L.next_in=0,L.avail_in=L.input.length;do{if(L.avail_out===0&&(L.output=new r.Buf8(B),L.next_out=0,L.avail_out=B),(v=n.inflate(L,o.Z_NO_FLUSH))===o.Z_NEED_DICT&&M&&(x=typeof M=="string"?i.string2buf(M):h.call(M)==="[object ArrayBuffer]"?new Uint8Array(M):M,v=n.inflateSetDictionary(this.strm,x)),v===o.Z_BUF_ERROR&&W===!0&&(v=o.Z_OK,W=!1),v!==o.Z_STREAM_END&&v!==o.Z_OK)return this.onEnd(v),!(this.ended=!0);L.next_out&&(L.avail_out!==0&&v!==o.Z_STREAM_END&&(L.avail_in!==0||C!==o.Z_FINISH&&C!==o.Z_SYNC_FLUSH)||(this.options.to==="string"?(S=i.utf8border(L.output,L.next_out),_=L.next_out-S,k=i.buf2string(L.output,S),L.next_out=_,L.avail_out=B-_,_&&r.arraySet(L.output,L.output,S,_,0),this.onData(k)):this.onData(r.shrinkBuf(L.output,L.next_out)))),L.avail_in===0&&L.avail_out===0&&(W=!0)}while((0<L.avail_in||L.avail_out===0)&&v!==o.Z_STREAM_END);return v===o.Z_STREAM_END&&(C=o.Z_FINISH),C===o.Z_FINISH?(v=n.inflateEnd(this.strm),this.onEnd(v),this.ended=!0,v===o.Z_OK):C!==o.Z_SYNC_FLUSH||(this.onEnd(o.Z_OK),!(L.avail_out=0))},u.prototype.onData=function(p){this.chunks.push(p)},u.prototype.onEnd=function(p){p===o.Z_OK&&(this.options.to==="string"?this.result=this.chunks.join(""):this.result=r.flattenChunks(this.chunks)),this.chunks=[],this.err=p,this.msg=this.strm.msg},a.Inflate=u,a.inflate=y,a.inflateRaw=function(p,b){return(b=b||{}).raw=!0,y(p,b)},a.ungzip=y},{"./utils/common":41,"./utils/strings":42,"./zlib/constants":44,"./zlib/gzheader":47,"./zlib/inflate":49,"./zlib/messages":51,"./zlib/zstream":53}],41:[function(t,c,a){var n=typeof Uint8Array<"u"&&typeof Uint16Array<"u"&&typeof Int32Array<"u";a.assign=function(o){for(var l=Array.prototype.slice.call(arguments,1);l.length;){var f=l.shift();if(f){if(typeof f!="object")throw new TypeError(f+"must be non-object");for(var m in f)f.hasOwnProperty(m)&&(o[m]=f[m])}}return o},a.shrinkBuf=function(o,l){return o.length===l?o:o.subarray?o.subarray(0,l):(o.length=l,o)};var r={arraySet:function(o,l,f,m,h){if(l.subarray&&o.subarray)o.set(l.subarray(f,f+m),h);else for(var u=0;u<m;u++)o[h+u]=l[f+u]},flattenChunks:function(o){var l,f,m,h,u,y;for(l=m=0,f=o.length;l<f;l++)m+=o[l].length;for(y=new Uint8Array(m),l=h=0,f=o.length;l<f;l++)u=o[l],y.set(u,h),h+=u.length;return y}},i={arraySet:function(o,l,f,m,h){for(var u=0;u<m;u++)o[h+u]=l[f+u]},flattenChunks:function(o){return[].concat.apply([],o)}};a.setTyped=function(o){o?(a.Buf8=Uint8Array,a.Buf16=Uint16Array,a.Buf32=Int32Array,a.assign(a,r)):(a.Buf8=Array,a.Buf16=Array,a.Buf32=Array,a.assign(a,i))},a.setTyped(n)},{}],42:[function(t,c,a){var n=t("./common"),r=!0,i=!0;try{String.fromCharCode.apply(null,[0])}catch{r=!1}try{String.fromCharCode.apply(null,new Uint8Array(1))}catch{i=!1}for(var o=new n.Buf8(256),l=0;l<256;l++)o[l]=252<=l?6:248<=l?5:240<=l?4:224<=l?3:192<=l?2:1;function f(m,h){if(h<65537&&(m.subarray&&i||!m.subarray&&r))return String.fromCharCode.apply(null,n.shrinkBuf(m,h));for(var u="",y=0;y<h;y++)u+=String.fromCharCode(m[y]);return u}o[254]=o[254]=1,a.string2buf=function(m){var h,u,y,p,b,v=m.length,C=0;for(p=0;p<v;p++)(64512&(u=m.charCodeAt(p)))==55296&&p+1<v&&(64512&(y=m.charCodeAt(p+1)))==56320&&(u=65536+(u-55296<<10)+(y-56320),p++),C+=u<128?1:u<2048?2:u<65536?3:4;for(h=new n.Buf8(C),p=b=0;b<C;p++)(64512&(u=m.charCodeAt(p)))==55296&&p+1<v&&(64512&(y=m.charCodeAt(p+1)))==56320&&(u=65536+(u-55296<<10)+(y-56320),p++),u<128?h[b++]=u:(u<2048?h[b++]=192|u>>>6:(u<65536?h[b++]=224|u>>>12:(h[b++]=240|u>>>18,h[b++]=128|u>>>12&63),h[b++]=128|u>>>6&63),h[b++]=128|63&u);return h},a.buf2binstring=function(m){return f(m,m.length)},a.binstring2buf=function(m){for(var h=new n.Buf8(m.length),u=0,y=h.length;u<y;u++)h[u]=m.charCodeAt(u);return h},a.buf2string=function(m,h){var u,y,p,b,v=h||m.length,C=new Array(2*v);for(u=y=0;u<v;)if((p=m[u++])<128)C[y++]=p;else if(4<(b=o[p]))C[y++]=65533,u+=b-1;else{for(p&=b===2?31:b===3?15:7;1<b&&u<v;)p=p<<6|63&m[u++],b--;1<b?C[y++]=65533:p<65536?C[y++]=p:(p-=65536,C[y++]=55296|p>>10&1023,C[y++]=56320|1023&p)}return f(C,y)},a.utf8border=function(m,h){var u;for((h=h||m.length)>m.length&&(h=m.length),u=h-1;0<=u&&(192&m[u])==128;)u--;return u<0||u===0?h:u+o[m[u]]>h?u:h}},{"./common":41}],43:[function(t,c,a){c.exports=function(n,r,i,o){for(var l=65535&n|0,f=n>>>16&65535|0,m=0;i!==0;){for(i-=m=2e3<i?2e3:i;f=f+(l=l+r[o++]|0)|0,--m;);l%=65521,f%=65521}return l|f<<16|0}},{}],44:[function(t,c,a){c.exports={Z_NO_FLUSH:0,Z_PARTIAL_FLUSH:1,Z_SYNC_FLUSH:2,Z_FULL_FLUSH:3,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_ERRNO:-1,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_BUF_ERROR:-5,Z_NO_COMPRESSION:0,Z_BEST_SPEED:1,Z_BEST_COMPRESSION:9,Z_DEFAULT_COMPRESSION:-1,Z_FILTERED:1,Z_HUFFMAN_ONLY:2,Z_RLE:3,Z_FIXED:4,Z_DEFAULT_STRATEGY:0,Z_BINARY:0,Z_TEXT:1,Z_UNKNOWN:2,Z_DEFLATED:8}},{}],45:[function(t,c,a){var n=function(){for(var r,i=[],o=0;o<256;o++){r=o;for(var l=0;l<8;l++)r=1&r?3988292384^r>>>1:r>>>1;i[o]=r}return i}();c.exports=function(r,i,o,l){var f=n,m=l+o;r^=-1;for(var h=l;h<m;h++)r=r>>>8^f[255&(r^i[h])];return-1^r}},{}],46:[function(t,c,a){var n,r=t("../utils/common"),i=t("./trees"),o=t("./adler32"),l=t("./crc32"),f=t("./messages"),m=0,h=4,u=0,y=-2,p=-1,b=4,v=2,C=8,S=9,_=286,k=30,x=19,L=2*_+1,B=15,M=3,W=258,Q=W+M+1,I=42,z=113,g=1,F=2,re=3,G=4;function de(d,P){return d.msg=f[P],P}function V(d){return(d<<1)-(4<d?9:0)}function le(d){for(var P=d.length;0<=--P;)d[P]=0}function O(d){var P=d.state,$=P.pending;$>d.avail_out&&($=d.avail_out),$!==0&&(r.arraySet(d.output,P.pending_buf,P.pending_out,$,d.next_out),d.next_out+=$,P.pending_out+=$,d.total_out+=$,d.avail_out-=$,P.pending-=$,P.pending===0&&(P.pending_out=0))}function A(d,P){i._tr_flush_block(d,0<=d.block_start?d.block_start:-1,d.strstart-d.block_start,P),d.block_start=d.strstart,O(d.strm)}function oe(d,P){d.pending_buf[d.pending++]=P}function ee(d,P){d.pending_buf[d.pending++]=P>>>8&255,d.pending_buf[d.pending++]=255&P}function X(d,P){var $,E,w=d.max_chain_length,T=d.strstart,U=d.prev_length,q=d.nice_match,N=d.strstart>d.w_size-Q?d.strstart-(d.w_size-Q):0,J=d.window,te=d.w_mask,Y=d.prev,ae=d.strstart+W,we=J[T+U-1],fe=J[T+U];d.prev_length>=d.good_match&&(w>>=2),q>d.lookahead&&(q=d.lookahead);do if(J[($=P)+U]===fe&&J[$+U-1]===we&&J[$]===J[T]&&J[++$]===J[T+1]){T+=2,$++;do;while(J[++T]===J[++$]&&J[++T]===J[++$]&&J[++T]===J[++$]&&J[++T]===J[++$]&&J[++T]===J[++$]&&J[++T]===J[++$]&&J[++T]===J[++$]&&J[++T]===J[++$]&&T<ae);if(E=W-(ae-T),T=ae-W,U<E){if(d.match_start=P,q<=(U=E))break;we=J[T+U-1],fe=J[T+U]}}while((P=Y[P&te])>N&&--w!=0);return U<=d.lookahead?U:d.lookahead}function xe(d){var P,$,E,w,T,U,q,N,J,te,Y=d.w_size;do{if(w=d.window_size-d.lookahead-d.strstart,d.strstart>=Y+(Y-Q)){for(r.arraySet(d.window,d.window,Y,Y,0),d.match_start-=Y,d.strstart-=Y,d.block_start-=Y,P=$=d.hash_size;E=d.head[--P],d.head[P]=Y<=E?E-Y:0,--$;);for(P=$=Y;E=d.prev[--P],d.prev[P]=Y<=E?E-Y:0,--$;);w+=Y}if(d.strm.avail_in===0)break;if(U=d.strm,q=d.window,N=d.strstart+d.lookahead,J=w,te=void 0,te=U.avail_in,J<te&&(te=J),$=te===0?0:(U.avail_in-=te,r.arraySet(q,U.input,U.next_in,te,N),U.state.wrap===1?U.adler=o(U.adler,q,te,N):U.state.wrap===2&&(U.adler=l(U.adler,q,te,N)),U.next_in+=te,U.total_in+=te,te),d.lookahead+=$,d.lookahead+d.insert>=M)for(T=d.strstart-d.insert,d.ins_h=d.window[T],d.ins_h=(d.ins_h<<d.hash_shift^d.window[T+1])&d.hash_mask;d.insert&&(d.ins_h=(d.ins_h<<d.hash_shift^d.window[T+M-1])&d.hash_mask,d.prev[T&d.w_mask]=d.head[d.ins_h],d.head[d.ins_h]=T,T++,d.insert--,!(d.lookahead+d.insert<M)););}while(d.lookahead<Q&&d.strm.avail_in!==0)}function Me(d,P){for(var $,E;;){if(d.lookahead<Q){if(xe(d),d.lookahead<Q&&P===m)return g;if(d.lookahead===0)break}if($=0,d.lookahead>=M&&(d.ins_h=(d.ins_h<<d.hash_shift^d.window[d.strstart+M-1])&d.hash_mask,$=d.prev[d.strstart&d.w_mask]=d.head[d.ins_h],d.head[d.ins_h]=d.strstart),$!==0&&d.strstart-$<=d.w_size-Q&&(d.match_length=X(d,$)),d.match_length>=M)if(E=i._tr_tally(d,d.strstart-d.match_start,d.match_length-M),d.lookahead-=d.match_length,d.match_length<=d.max_lazy_match&&d.lookahead>=M){for(d.match_length--;d.strstart++,d.ins_h=(d.ins_h<<d.hash_shift^d.window[d.strstart+M-1])&d.hash_mask,$=d.prev[d.strstart&d.w_mask]=d.head[d.ins_h],d.head[d.ins_h]=d.strstart,--d.match_length!=0;);d.strstart++}else d.strstart+=d.match_length,d.match_length=0,d.ins_h=d.window[d.strstart],d.ins_h=(d.ins_h<<d.hash_shift^d.window[d.strstart+1])&d.hash_mask;else E=i._tr_tally(d,0,d.window[d.strstart]),d.lookahead--,d.strstart++;if(E&&(A(d,!1),d.strm.avail_out===0))return g}return d.insert=d.strstart<M-1?d.strstart:M-1,P===h?(A(d,!0),d.strm.avail_out===0?re:G):d.last_lit&&(A(d,!1),d.strm.avail_out===0)?g:F}function me(d,P){for(var $,E,w;;){if(d.lookahead<Q){if(xe(d),d.lookahead<Q&&P===m)return g;if(d.lookahead===0)break}if($=0,d.lookahead>=M&&(d.ins_h=(d.ins_h<<d.hash_shift^d.window[d.strstart+M-1])&d.hash_mask,$=d.prev[d.strstart&d.w_mask]=d.head[d.ins_h],d.head[d.ins_h]=d.strstart),d.prev_length=d.match_length,d.prev_match=d.match_start,d.match_length=M-1,$!==0&&d.prev_length<d.max_lazy_match&&d.strstart-$<=d.w_size-Q&&(d.match_length=X(d,$),d.match_length<=5&&(d.strategy===1||d.match_length===M&&4096<d.strstart-d.match_start)&&(d.match_length=M-1)),d.prev_length>=M&&d.match_length<=d.prev_length){for(w=d.strstart+d.lookahead-M,E=i._tr_tally(d,d.strstart-1-d.prev_match,d.prev_length-M),d.lookahead-=d.prev_length-1,d.prev_length-=2;++d.strstart<=w&&(d.ins_h=(d.ins_h<<d.hash_shift^d.window[d.strstart+M-1])&d.hash_mask,$=d.prev[d.strstart&d.w_mask]=d.head[d.ins_h],d.head[d.ins_h]=d.strstart),--d.prev_length!=0;);if(d.match_available=0,d.match_length=M-1,d.strstart++,E&&(A(d,!1),d.strm.avail_out===0))return g}else if(d.match_available){if((E=i._tr_tally(d,0,d.window[d.strstart-1]))&&A(d,!1),d.strstart++,d.lookahead--,d.strm.avail_out===0)return g}else d.match_available=1,d.strstart++,d.lookahead--}return d.match_available&&(E=i._tr_tally(d,0,d.window[d.strstart-1]),d.match_available=0),d.insert=d.strstart<M-1?d.strstart:M-1,P===h?(A(d,!0),d.strm.avail_out===0?re:G):d.last_lit&&(A(d,!1),d.strm.avail_out===0)?g:F}function ve(d,P,$,E,w){this.good_length=d,this.max_lazy=P,this.nice_length=$,this.max_chain=E,this.func=w}function Oe(){this.strm=null,this.status=0,this.pending_buf=null,this.pending_buf_size=0,this.pending_out=0,this.pending=0,this.wrap=0,this.gzhead=null,this.gzindex=0,this.method=C,this.last_flush=-1,this.w_size=0,this.w_bits=0,this.w_mask=0,this.window=null,this.window_size=0,this.prev=null,this.head=null,this.ins_h=0,this.hash_size=0,this.hash_bits=0,this.hash_mask=0,this.hash_shift=0,this.block_start=0,this.match_length=0,this.prev_match=0,this.match_available=0,this.strstart=0,this.match_start=0,this.lookahead=0,this.prev_length=0,this.max_chain_length=0,this.max_lazy_match=0,this.level=0,this.strategy=0,this.good_match=0,this.nice_match=0,this.dyn_ltree=new r.Buf16(2*L),this.dyn_dtree=new r.Buf16(2*(2*k+1)),this.bl_tree=new r.Buf16(2*(2*x+1)),le(this.dyn_ltree),le(this.dyn_dtree),le(this.bl_tree),this.l_desc=null,this.d_desc=null,this.bl_desc=null,this.bl_count=new r.Buf16(B+1),this.heap=new r.Buf16(2*_+1),le(this.heap),this.heap_len=0,this.heap_max=0,this.depth=new r.Buf16(2*_+1),le(this.depth),this.l_buf=0,this.lit_bufsize=0,this.last_lit=0,this.d_buf=0,this.opt_len=0,this.static_len=0,this.matches=0,this.insert=0,this.bi_buf=0,this.bi_valid=0}function Ne(d){var P;return d&&d.state?(d.total_in=d.total_out=0,d.data_type=v,(P=d.state).pending=0,P.pending_out=0,P.wrap<0&&(P.wrap=-P.wrap),P.status=P.wrap?I:z,d.adler=P.wrap===2?0:1,P.last_flush=m,i._tr_init(P),u):de(d,y)}function Ve(d){var P=Ne(d);return P===u&&function($){$.window_size=2*$.w_size,le($.head),$.max_lazy_match=n[$.level].max_lazy,$.good_match=n[$.level].good_length,$.nice_match=n[$.level].nice_length,$.max_chain_length=n[$.level].max_chain,$.strstart=0,$.block_start=0,$.lookahead=0,$.insert=0,$.match_length=$.prev_length=M-1,$.match_available=0,$.ins_h=0}(d.state),P}function Je(d,P,$,E,w,T){if(!d)return y;var U=1;if(P===p&&(P=6),E<0?(U=0,E=-E):15<E&&(U=2,E-=16),w<1||S<w||$!==C||E<8||15<E||P<0||9<P||T<0||b<T)return de(d,y);E===8&&(E=9);var q=new Oe;return(d.state=q).strm=d,q.wrap=U,q.gzhead=null,q.w_bits=E,q.w_size=1<<q.w_bits,q.w_mask=q.w_size-1,q.hash_bits=w+7,q.hash_size=1<<q.hash_bits,q.hash_mask=q.hash_size-1,q.hash_shift=~~((q.hash_bits+M-1)/M),q.window=new r.Buf8(2*q.w_size),q.head=new r.Buf16(q.hash_size),q.prev=new r.Buf16(q.w_size),q.lit_bufsize=1<<w+6,q.pending_buf_size=4*q.lit_bufsize,q.pending_buf=new r.Buf8(q.pending_buf_size),q.d_buf=1*q.lit_bufsize,q.l_buf=3*q.lit_bufsize,q.level=P,q.strategy=T,q.method=$,Ve(d)}n=[new ve(0,0,0,0,function(d,P){var $=65535;for($>d.pending_buf_size-5&&($=d.pending_buf_size-5);;){if(d.lookahead<=1){if(xe(d),d.lookahead===0&&P===m)return g;if(d.lookahead===0)break}d.strstart+=d.lookahead,d.lookahead=0;var E=d.block_start+$;if((d.strstart===0||d.strstart>=E)&&(d.lookahead=d.strstart-E,d.strstart=E,A(d,!1),d.strm.avail_out===0)||d.strstart-d.block_start>=d.w_size-Q&&(A(d,!1),d.strm.avail_out===0))return g}return d.insert=0,P===h?(A(d,!0),d.strm.avail_out===0?re:G):(d.strstart>d.block_start&&(A(d,!1),d.strm.avail_out),g)}),new ve(4,4,8,4,Me),new ve(4,5,16,8,Me),new ve(4,6,32,32,Me),new ve(4,4,16,16,me),new ve(8,16,32,32,me),new ve(8,16,128,128,me),new ve(8,32,128,256,me),new ve(32,128,258,1024,me),new ve(32,258,258,4096,me)],a.deflateInit=function(d,P){return Je(d,P,C,15,8,0)},a.deflateInit2=Je,a.deflateReset=Ve,a.deflateResetKeep=Ne,a.deflateSetHeader=function(d,P){return d&&d.state?d.state.wrap!==2?y:(d.state.gzhead=P,u):y},a.deflate=function(d,P){var $,E,w,T;if(!d||!d.state||5<P||P<0)return d?de(d,y):y;if(E=d.state,!d.output||!d.input&&d.avail_in!==0||E.status===666&&P!==h)return de(d,d.avail_out===0?-5:y);if(E.strm=d,$=E.last_flush,E.last_flush=P,E.status===I)if(E.wrap===2)d.adler=0,oe(E,31),oe(E,139),oe(E,8),E.gzhead?(oe(E,(E.gzhead.text?1:0)+(E.gzhead.hcrc?2:0)+(E.gzhead.extra?4:0)+(E.gzhead.name?8:0)+(E.gzhead.comment?16:0)),oe(E,255&E.gzhead.time),oe(E,E.gzhead.time>>8&255),oe(E,E.gzhead.time>>16&255),oe(E,E.gzhead.time>>24&255),oe(E,E.level===9?2:2<=E.strategy||E.level<2?4:0),oe(E,255&E.gzhead.os),E.gzhead.extra&&E.gzhead.extra.length&&(oe(E,255&E.gzhead.extra.length),oe(E,E.gzhead.extra.length>>8&255)),E.gzhead.hcrc&&(d.adler=l(d.adler,E.pending_buf,E.pending,0)),E.gzindex=0,E.status=69):(oe(E,0),oe(E,0),oe(E,0),oe(E,0),oe(E,0),oe(E,E.level===9?2:2<=E.strategy||E.level<2?4:0),oe(E,3),E.status=z);else{var U=C+(E.w_bits-8<<4)<<8;U|=(2<=E.strategy||E.level<2?0:E.level<6?1:E.level===6?2:3)<<6,E.strstart!==0&&(U|=32),U+=31-U%31,E.status=z,ee(E,U),E.strstart!==0&&(ee(E,d.adler>>>16),ee(E,65535&d.adler)),d.adler=1}if(E.status===69)if(E.gzhead.extra){for(w=E.pending;E.gzindex<(65535&E.gzhead.extra.length)&&(E.pending!==E.pending_buf_size||(E.gzhead.hcrc&&E.pending>w&&(d.adler=l(d.adler,E.pending_buf,E.pending-w,w)),O(d),w=E.pending,E.pending!==E.pending_buf_size));)oe(E,255&E.gzhead.extra[E.gzindex]),E.gzindex++;E.gzhead.hcrc&&E.pending>w&&(d.adler=l(d.adler,E.pending_buf,E.pending-w,w)),E.gzindex===E.gzhead.extra.length&&(E.gzindex=0,E.status=73)}else E.status=73;if(E.status===73)if(E.gzhead.name){w=E.pending;do{if(E.pending===E.pending_buf_size&&(E.gzhead.hcrc&&E.pending>w&&(d.adler=l(d.adler,E.pending_buf,E.pending-w,w)),O(d),w=E.pending,E.pending===E.pending_buf_size)){T=1;break}T=E.gzindex<E.gzhead.name.length?255&E.gzhead.name.charCodeAt(E.gzindex++):0,oe(E,T)}while(T!==0);E.gzhead.hcrc&&E.pending>w&&(d.adler=l(d.adler,E.pending_buf,E.pending-w,w)),T===0&&(E.gzindex=0,E.status=91)}else E.status=91;if(E.status===91)if(E.gzhead.comment){w=E.pending;do{if(E.pending===E.pending_buf_size&&(E.gzhead.hcrc&&E.pending>w&&(d.adler=l(d.adler,E.pending_buf,E.pending-w,w)),O(d),w=E.pending,E.pending===E.pending_buf_size)){T=1;break}T=E.gzindex<E.gzhead.comment.length?255&E.gzhead.comment.charCodeAt(E.gzindex++):0,oe(E,T)}while(T!==0);E.gzhead.hcrc&&E.pending>w&&(d.adler=l(d.adler,E.pending_buf,E.pending-w,w)),T===0&&(E.status=103)}else E.status=103;if(E.status===103&&(E.gzhead.hcrc?(E.pending+2>E.pending_buf_size&&O(d),E.pending+2<=E.pending_buf_size&&(oe(E,255&d.adler),oe(E,d.adler>>8&255),d.adler=0,E.status=z)):E.status=z),E.pending!==0){if(O(d),d.avail_out===0)return E.last_flush=-1,u}else if(d.avail_in===0&&V(P)<=V($)&&P!==h)return de(d,-5);if(E.status===666&&d.avail_in!==0)return de(d,-5);if(d.avail_in!==0||E.lookahead!==0||P!==m&&E.status!==666){var q=E.strategy===2?function(N,J){for(var te;;){if(N.lookahead===0&&(xe(N),N.lookahead===0)){if(J===m)return g;break}if(N.match_length=0,te=i._tr_tally(N,0,N.window[N.strstart]),N.lookahead--,N.strstart++,te&&(A(N,!1),N.strm.avail_out===0))return g}return N.insert=0,J===h?(A(N,!0),N.strm.avail_out===0?re:G):N.last_lit&&(A(N,!1),N.strm.avail_out===0)?g:F}(E,P):E.strategy===3?function(N,J){for(var te,Y,ae,we,fe=N.window;;){if(N.lookahead<=W){if(xe(N),N.lookahead<=W&&J===m)return g;if(N.lookahead===0)break}if(N.match_length=0,N.lookahead>=M&&0<N.strstart&&(Y=fe[ae=N.strstart-1])===fe[++ae]&&Y===fe[++ae]&&Y===fe[++ae]){we=N.strstart+W;do;while(Y===fe[++ae]&&Y===fe[++ae]&&Y===fe[++ae]&&Y===fe[++ae]&&Y===fe[++ae]&&Y===fe[++ae]&&Y===fe[++ae]&&Y===fe[++ae]&&ae<we);N.match_length=W-(we-ae),N.match_length>N.lookahead&&(N.match_length=N.lookahead)}if(N.match_length>=M?(te=i._tr_tally(N,1,N.match_length-M),N.lookahead-=N.match_length,N.strstart+=N.match_length,N.match_length=0):(te=i._tr_tally(N,0,N.window[N.strstart]),N.lookahead--,N.strstart++),te&&(A(N,!1),N.strm.avail_out===0))return g}return N.insert=0,J===h?(A(N,!0),N.strm.avail_out===0?re:G):N.last_lit&&(A(N,!1),N.strm.avail_out===0)?g:F}(E,P):n[E.level].func(E,P);if(q!==re&&q!==G||(E.status=666),q===g||q===re)return d.avail_out===0&&(E.last_flush=-1),u;if(q===F&&(P===1?i._tr_align(E):P!==5&&(i._tr_stored_block(E,0,0,!1),P===3&&(le(E.head),E.lookahead===0&&(E.strstart=0,E.block_start=0,E.insert=0))),O(d),d.avail_out===0))return E.last_flush=-1,u}return P!==h?u:E.wrap<=0?1:(E.wrap===2?(oe(E,255&d.adler),oe(E,d.adler>>8&255),oe(E,d.adler>>16&255),oe(E,d.adler>>24&255),oe(E,255&d.total_in),oe(E,d.total_in>>8&255),oe(E,d.total_in>>16&255),oe(E,d.total_in>>24&255)):(ee(E,d.adler>>>16),ee(E,65535&d.adler)),O(d),0<E.wrap&&(E.wrap=-E.wrap),E.pending!==0?u:1)},a.deflateEnd=function(d){var P;return d&&d.state?(P=d.state.status)!==I&&P!==69&&P!==73&&P!==91&&P!==103&&P!==z&&P!==666?de(d,y):(d.state=null,P===z?de(d,-3):u):y},a.deflateSetDictionary=function(d,P){var $,E,w,T,U,q,N,J,te=P.length;if(!d||!d.state||(T=($=d.state).wrap)===2||T===1&&$.status!==I||$.lookahead)return y;for(T===1&&(d.adler=o(d.adler,P,te,0)),$.wrap=0,te>=$.w_size&&(T===0&&(le($.head),$.strstart=0,$.block_start=0,$.insert=0),J=new r.Buf8($.w_size),r.arraySet(J,P,te-$.w_size,$.w_size,0),P=J,te=$.w_size),U=d.avail_in,q=d.next_in,N=d.input,d.avail_in=te,d.next_in=0,d.input=P,xe($);$.lookahead>=M;){for(E=$.strstart,w=$.lookahead-(M-1);$.ins_h=($.ins_h<<$.hash_shift^$.window[E+M-1])&$.hash_mask,$.prev[E&$.w_mask]=$.head[$.ins_h],$.head[$.ins_h]=E,E++,--w;);$.strstart=E,$.lookahead=M-1,xe($)}return $.strstart+=$.lookahead,$.block_start=$.strstart,$.insert=$.lookahead,$.lookahead=0,$.match_length=$.prev_length=M-1,$.match_available=0,d.next_in=q,d.input=N,d.avail_in=U,$.wrap=T,u},a.deflateInfo="pako deflate (from Nodeca project)"},{"../utils/common":41,"./adler32":43,"./crc32":45,"./messages":51,"./trees":52}],47:[function(t,c,a){c.exports=function(){this.text=0,this.time=0,this.xflags=0,this.os=0,this.extra=null,this.extra_len=0,this.name="",this.comment="",this.hcrc=0,this.done=!1}},{}],48:[function(t,c,a){c.exports=function(n,r){var i,o,l,f,m,h,u,y,p,b,v,C,S,_,k,x,L,B,M,W,Q,I,z,g,F;i=n.state,o=n.next_in,g=n.input,l=o+(n.avail_in-5),f=n.next_out,F=n.output,m=f-(r-n.avail_out),h=f+(n.avail_out-257),u=i.dmax,y=i.wsize,p=i.whave,b=i.wnext,v=i.window,C=i.hold,S=i.bits,_=i.lencode,k=i.distcode,x=(1<<i.lenbits)-1,L=(1<<i.distbits)-1;e:do{S<15&&(C+=g[o++]<<S,S+=8,C+=g[o++]<<S,S+=8),B=_[C&x];t:for(;;){if(C>>>=M=B>>>24,S-=M,(M=B>>>16&255)===0)F[f++]=65535&B;else{if(!(16&M)){if(!(64&M)){B=_[(65535&B)+(C&(1<<M)-1)];continue t}if(32&M){i.mode=12;break e}n.msg="invalid literal/length code",i.mode=30;break e}W=65535&B,(M&=15)&&(S<M&&(C+=g[o++]<<S,S+=8),W+=C&(1<<M)-1,C>>>=M,S-=M),S<15&&(C+=g[o++]<<S,S+=8,C+=g[o++]<<S,S+=8),B=k[C&L];n:for(;;){if(C>>>=M=B>>>24,S-=M,!(16&(M=B>>>16&255))){if(!(64&M)){B=k[(65535&B)+(C&(1<<M)-1)];continue n}n.msg="invalid distance code",i.mode=30;break e}if(Q=65535&B,S<(M&=15)&&(C+=g[o++]<<S,(S+=8)<M&&(C+=g[o++]<<S,S+=8)),u<(Q+=C&(1<<M)-1)){n.msg="invalid distance too far back",i.mode=30;break e}if(C>>>=M,S-=M,(M=f-m)<Q){if(p<(M=Q-M)&&i.sane){n.msg="invalid distance too far back",i.mode=30;break e}if(z=v,(I=0)===b){if(I+=y-M,M<W){for(W-=M;F[f++]=v[I++],--M;);I=f-Q,z=F}}else if(b<M){if(I+=y+b-M,(M-=b)<W){for(W-=M;F[f++]=v[I++],--M;);if(I=0,b<W){for(W-=M=b;F[f++]=v[I++],--M;);I=f-Q,z=F}}}else if(I+=b-M,M<W){for(W-=M;F[f++]=v[I++],--M;);I=f-Q,z=F}for(;2<W;)F[f++]=z[I++],F[f++]=z[I++],F[f++]=z[I++],W-=3;W&&(F[f++]=z[I++],1<W&&(F[f++]=z[I++]))}else{for(I=f-Q;F[f++]=F[I++],F[f++]=F[I++],F[f++]=F[I++],2<(W-=3););W&&(F[f++]=F[I++],1<W&&(F[f++]=F[I++]))}break}}break}}while(o<l&&f<h);o-=W=S>>3,C&=(1<<(S-=W<<3))-1,n.next_in=o,n.next_out=f,n.avail_in=o<l?l-o+5:5-(o-l),n.avail_out=f<h?h-f+257:257-(f-h),i.hold=C,i.bits=S}},{}],49:[function(t,c,a){var n=t("../utils/common"),r=t("./adler32"),i=t("./crc32"),o=t("./inffast"),l=t("./inftrees"),f=1,m=2,h=0,u=-2,y=1,p=852,b=592;function v(I){return(I>>>24&255)+(I>>>8&65280)+((65280&I)<<8)+((255&I)<<24)}function C(){this.mode=0,this.last=!1,this.wrap=0,this.havedict=!1,this.flags=0,this.dmax=0,this.check=0,this.total=0,this.head=null,this.wbits=0,this.wsize=0,this.whave=0,this.wnext=0,this.window=null,this.hold=0,this.bits=0,this.length=0,this.offset=0,this.extra=0,this.lencode=null,this.distcode=null,this.lenbits=0,this.distbits=0,this.ncode=0,this.nlen=0,this.ndist=0,this.have=0,this.next=null,this.lens=new n.Buf16(320),this.work=new n.Buf16(288),this.lendyn=null,this.distdyn=null,this.sane=0,this.back=0,this.was=0}function S(I){var z;return I&&I.state?(z=I.state,I.total_in=I.total_out=z.total=0,I.msg="",z.wrap&&(I.adler=1&z.wrap),z.mode=y,z.last=0,z.havedict=0,z.dmax=32768,z.head=null,z.hold=0,z.bits=0,z.lencode=z.lendyn=new n.Buf32(p),z.distcode=z.distdyn=new n.Buf32(b),z.sane=1,z.back=-1,h):u}function _(I){var z;return I&&I.state?((z=I.state).wsize=0,z.whave=0,z.wnext=0,S(I)):u}function k(I,z){var g,F;return I&&I.state?(F=I.state,z<0?(g=0,z=-z):(g=1+(z>>4),z<48&&(z&=15)),z&&(z<8||15<z)?u:(F.window!==null&&F.wbits!==z&&(F.window=null),F.wrap=g,F.wbits=z,_(I))):u}function x(I,z){var g,F;return I?(F=new C,(I.state=F).window=null,(g=k(I,z))!==h&&(I.state=null),g):u}var L,B,M=!0;function W(I){if(M){var z;for(L=new n.Buf32(512),B=new n.Buf32(32),z=0;z<144;)I.lens[z++]=8;for(;z<256;)I.lens[z++]=9;for(;z<280;)I.lens[z++]=7;for(;z<288;)I.lens[z++]=8;for(l(f,I.lens,0,288,L,0,I.work,{bits:9}),z=0;z<32;)I.lens[z++]=5;l(m,I.lens,0,32,B,0,I.work,{bits:5}),M=!1}I.lencode=L,I.lenbits=9,I.distcode=B,I.distbits=5}function Q(I,z,g,F){var re,G=I.state;return G.window===null&&(G.wsize=1<<G.wbits,G.wnext=0,G.whave=0,G.window=new n.Buf8(G.wsize)),F>=G.wsize?(n.arraySet(G.window,z,g-G.wsize,G.wsize,0),G.wnext=0,G.whave=G.wsize):(F<(re=G.wsize-G.wnext)&&(re=F),n.arraySet(G.window,z,g-F,re,G.wnext),(F-=re)?(n.arraySet(G.window,z,g-F,F,0),G.wnext=F,G.whave=G.wsize):(G.wnext+=re,G.wnext===G.wsize&&(G.wnext=0),G.whave<G.wsize&&(G.whave+=re))),0}a.inflateReset=_,a.inflateReset2=k,a.inflateResetKeep=S,a.inflateInit=function(I){return x(I,15)},a.inflateInit2=x,a.inflate=function(I,z){var g,F,re,G,de,V,le,O,A,oe,ee,X,xe,Me,me,ve,Oe,Ne,Ve,Je,d,P,$,E,w=0,T=new n.Buf8(4),U=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15];if(!I||!I.state||!I.output||!I.input&&I.avail_in!==0)return u;(g=I.state).mode===12&&(g.mode=13),de=I.next_out,re=I.output,le=I.avail_out,G=I.next_in,F=I.input,V=I.avail_in,O=g.hold,A=g.bits,oe=V,ee=le,P=h;e:for(;;)switch(g.mode){case y:if(g.wrap===0){g.mode=13;break}for(;A<16;){if(V===0)break e;V--,O+=F[G++]<<A,A+=8}if(2&g.wrap&&O===35615){T[g.check=0]=255&O,T[1]=O>>>8&255,g.check=i(g.check,T,2,0),A=O=0,g.mode=2;break}if(g.flags=0,g.head&&(g.head.done=!1),!(1&g.wrap)||(((255&O)<<8)+(O>>8))%31){I.msg="incorrect header check",g.mode=30;break}if((15&O)!=8){I.msg="unknown compression method",g.mode=30;break}if(A-=4,d=8+(15&(O>>>=4)),g.wbits===0)g.wbits=d;else if(d>g.wbits){I.msg="invalid window size",g.mode=30;break}g.dmax=1<<d,I.adler=g.check=1,g.mode=512&O?10:12,A=O=0;break;case 2:for(;A<16;){if(V===0)break e;V--,O+=F[G++]<<A,A+=8}if(g.flags=O,(255&g.flags)!=8){I.msg="unknown compression method",g.mode=30;break}if(57344&g.flags){I.msg="unknown header flags set",g.mode=30;break}g.head&&(g.head.text=O>>8&1),512&g.flags&&(T[0]=255&O,T[1]=O>>>8&255,g.check=i(g.check,T,2,0)),A=O=0,g.mode=3;case 3:for(;A<32;){if(V===0)break e;V--,O+=F[G++]<<A,A+=8}g.head&&(g.head.time=O),512&g.flags&&(T[0]=255&O,T[1]=O>>>8&255,T[2]=O>>>16&255,T[3]=O>>>24&255,g.check=i(g.check,T,4,0)),A=O=0,g.mode=4;case 4:for(;A<16;){if(V===0)break e;V--,O+=F[G++]<<A,A+=8}g.head&&(g.head.xflags=255&O,g.head.os=O>>8),512&g.flags&&(T[0]=255&O,T[1]=O>>>8&255,g.check=i(g.check,T,2,0)),A=O=0,g.mode=5;case 5:if(1024&g.flags){for(;A<16;){if(V===0)break e;V--,O+=F[G++]<<A,A+=8}g.length=O,g.head&&(g.head.extra_len=O),512&g.flags&&(T[0]=255&O,T[1]=O>>>8&255,g.check=i(g.check,T,2,0)),A=O=0}else g.head&&(g.head.extra=null);g.mode=6;case 6:if(1024&g.flags&&(V<(X=g.length)&&(X=V),X&&(g.head&&(d=g.head.extra_len-g.length,g.head.extra||(g.head.extra=new Array(g.head.extra_len)),n.arraySet(g.head.extra,F,G,X,d)),512&g.flags&&(g.check=i(g.check,F,X,G)),V-=X,G+=X,g.length-=X),g.length))break e;g.length=0,g.mode=7;case 7:if(2048&g.flags){if(V===0)break e;for(X=0;d=F[G+X++],g.head&&d&&g.length<65536&&(g.head.name+=String.fromCharCode(d)),d&&X<V;);if(512&g.flags&&(g.check=i(g.check,F,X,G)),V-=X,G+=X,d)break e}else g.head&&(g.head.name=null);g.length=0,g.mode=8;case 8:if(4096&g.flags){if(V===0)break e;for(X=0;d=F[G+X++],g.head&&d&&g.length<65536&&(g.head.comment+=String.fromCharCode(d)),d&&X<V;);if(512&g.flags&&(g.check=i(g.check,F,X,G)),V-=X,G+=X,d)break e}else g.head&&(g.head.comment=null);g.mode=9;case 9:if(512&g.flags){for(;A<16;){if(V===0)break e;V--,O+=F[G++]<<A,A+=8}if(O!==(65535&g.check)){I.msg="header crc mismatch",g.mode=30;break}A=O=0}g.head&&(g.head.hcrc=g.flags>>9&1,g.head.done=!0),I.adler=g.check=0,g.mode=12;break;case 10:for(;A<32;){if(V===0)break e;V--,O+=F[G++]<<A,A+=8}I.adler=g.check=v(O),A=O=0,g.mode=11;case 11:if(g.havedict===0)return I.next_out=de,I.avail_out=le,I.next_in=G,I.avail_in=V,g.hold=O,g.bits=A,2;I.adler=g.check=1,g.mode=12;case 12:if(z===5||z===6)break e;case 13:if(g.last){O>>>=7&A,A-=7&A,g.mode=27;break}for(;A<3;){if(V===0)break e;V--,O+=F[G++]<<A,A+=8}switch(g.last=1&O,A-=1,3&(O>>>=1)){case 0:g.mode=14;break;case 1:if(W(g),g.mode=20,z!==6)break;O>>>=2,A-=2;break e;case 2:g.mode=17;break;case 3:I.msg="invalid block type",g.mode=30}O>>>=2,A-=2;break;case 14:for(O>>>=7&A,A-=7&A;A<32;){if(V===0)break e;V--,O+=F[G++]<<A,A+=8}if((65535&O)!=(O>>>16^65535)){I.msg="invalid stored block lengths",g.mode=30;break}if(g.length=65535&O,A=O=0,g.mode=15,z===6)break e;case 15:g.mode=16;case 16:if(X=g.length){if(V<X&&(X=V),le<X&&(X=le),X===0)break e;n.arraySet(re,F,G,X,de),V-=X,G+=X,le-=X,de+=X,g.length-=X;break}g.mode=12;break;case 17:for(;A<14;){if(V===0)break e;V--,O+=F[G++]<<A,A+=8}if(g.nlen=257+(31&O),O>>>=5,A-=5,g.ndist=1+(31&O),O>>>=5,A-=5,g.ncode=4+(15&O),O>>>=4,A-=4,286<g.nlen||30<g.ndist){I.msg="too many length or distance symbols",g.mode=30;break}g.have=0,g.mode=18;case 18:for(;g.have<g.ncode;){for(;A<3;){if(V===0)break e;V--,O+=F[G++]<<A,A+=8}g.lens[U[g.have++]]=7&O,O>>>=3,A-=3}for(;g.have<19;)g.lens[U[g.have++]]=0;if(g.lencode=g.lendyn,g.lenbits=7,$={bits:g.lenbits},P=l(0,g.lens,0,19,g.lencode,0,g.work,$),g.lenbits=$.bits,P){I.msg="invalid code lengths set",g.mode=30;break}g.have=0,g.mode=19;case 19:for(;g.have<g.nlen+g.ndist;){for(;ve=(w=g.lencode[O&(1<<g.lenbits)-1])>>>16&255,Oe=65535&w,!((me=w>>>24)<=A);){if(V===0)break e;V--,O+=F[G++]<<A,A+=8}if(Oe<16)O>>>=me,A-=me,g.lens[g.have++]=Oe;else{if(Oe===16){for(E=me+2;A<E;){if(V===0)break e;V--,O+=F[G++]<<A,A+=8}if(O>>>=me,A-=me,g.have===0){I.msg="invalid bit length repeat",g.mode=30;break}d=g.lens[g.have-1],X=3+(3&O),O>>>=2,A-=2}else if(Oe===17){for(E=me+3;A<E;){if(V===0)break e;V--,O+=F[G++]<<A,A+=8}A-=me,d=0,X=3+(7&(O>>>=me)),O>>>=3,A-=3}else{for(E=me+7;A<E;){if(V===0)break e;V--,O+=F[G++]<<A,A+=8}A-=me,d=0,X=11+(127&(O>>>=me)),O>>>=7,A-=7}if(g.have+X>g.nlen+g.ndist){I.msg="invalid bit length repeat",g.mode=30;break}for(;X--;)g.lens[g.have++]=d}}if(g.mode===30)break;if(g.lens[256]===0){I.msg="invalid code -- missing end-of-block",g.mode=30;break}if(g.lenbits=9,$={bits:g.lenbits},P=l(f,g.lens,0,g.nlen,g.lencode,0,g.work,$),g.lenbits=$.bits,P){I.msg="invalid literal/lengths set",g.mode=30;break}if(g.distbits=6,g.distcode=g.distdyn,$={bits:g.distbits},P=l(m,g.lens,g.nlen,g.ndist,g.distcode,0,g.work,$),g.distbits=$.bits,P){I.msg="invalid distances set",g.mode=30;break}if(g.mode=20,z===6)break e;case 20:g.mode=21;case 21:if(6<=V&&258<=le){I.next_out=de,I.avail_out=le,I.next_in=G,I.avail_in=V,g.hold=O,g.bits=A,o(I,ee),de=I.next_out,re=I.output,le=I.avail_out,G=I.next_in,F=I.input,V=I.avail_in,O=g.hold,A=g.bits,g.mode===12&&(g.back=-1);break}for(g.back=0;ve=(w=g.lencode[O&(1<<g.lenbits)-1])>>>16&255,Oe=65535&w,!((me=w>>>24)<=A);){if(V===0)break e;V--,O+=F[G++]<<A,A+=8}if(ve&&!(240&ve)){for(Ne=me,Ve=ve,Je=Oe;ve=(w=g.lencode[Je+((O&(1<<Ne+Ve)-1)>>Ne)])>>>16&255,Oe=65535&w,!(Ne+(me=w>>>24)<=A);){if(V===0)break e;V--,O+=F[G++]<<A,A+=8}O>>>=Ne,A-=Ne,g.back+=Ne}if(O>>>=me,A-=me,g.back+=me,g.length=Oe,ve===0){g.mode=26;break}if(32&ve){g.back=-1,g.mode=12;break}if(64&ve){I.msg="invalid literal/length code",g.mode=30;break}g.extra=15&ve,g.mode=22;case 22:if(g.extra){for(E=g.extra;A<E;){if(V===0)break e;V--,O+=F[G++]<<A,A+=8}g.length+=O&(1<<g.extra)-1,O>>>=g.extra,A-=g.extra,g.back+=g.extra}g.was=g.length,g.mode=23;case 23:for(;ve=(w=g.distcode[O&(1<<g.distbits)-1])>>>16&255,Oe=65535&w,!((me=w>>>24)<=A);){if(V===0)break e;V--,O+=F[G++]<<A,A+=8}if(!(240&ve)){for(Ne=me,Ve=ve,Je=Oe;ve=(w=g.distcode[Je+((O&(1<<Ne+Ve)-1)>>Ne)])>>>16&255,Oe=65535&w,!(Ne+(me=w>>>24)<=A);){if(V===0)break e;V--,O+=F[G++]<<A,A+=8}O>>>=Ne,A-=Ne,g.back+=Ne}if(O>>>=me,A-=me,g.back+=me,64&ve){I.msg="invalid distance code",g.mode=30;break}g.offset=Oe,g.extra=15&ve,g.mode=24;case 24:if(g.extra){for(E=g.extra;A<E;){if(V===0)break e;V--,O+=F[G++]<<A,A+=8}g.offset+=O&(1<<g.extra)-1,O>>>=g.extra,A-=g.extra,g.back+=g.extra}if(g.offset>g.dmax){I.msg="invalid distance too far back",g.mode=30;break}g.mode=25;case 25:if(le===0)break e;if(X=ee-le,g.offset>X){if((X=g.offset-X)>g.whave&&g.sane){I.msg="invalid distance too far back",g.mode=30;break}xe=X>g.wnext?(X-=g.wnext,g.wsize-X):g.wnext-X,X>g.length&&(X=g.length),Me=g.window}else Me=re,xe=de-g.offset,X=g.length;for(le<X&&(X=le),le-=X,g.length-=X;re[de++]=Me[xe++],--X;);g.length===0&&(g.mode=21);break;case 26:if(le===0)break e;re[de++]=g.length,le--,g.mode=21;break;case 27:if(g.wrap){for(;A<32;){if(V===0)break e;V--,O|=F[G++]<<A,A+=8}if(ee-=le,I.total_out+=ee,g.total+=ee,ee&&(I.adler=g.check=g.flags?i(g.check,re,ee,de-ee):r(g.check,re,ee,de-ee)),ee=le,(g.flags?O:v(O))!==g.check){I.msg="incorrect data check",g.mode=30;break}A=O=0}g.mode=28;case 28:if(g.wrap&&g.flags){for(;A<32;){if(V===0)break e;V--,O+=F[G++]<<A,A+=8}if(O!==(4294967295&g.total)){I.msg="incorrect length check",g.mode=30;break}A=O=0}g.mode=29;case 29:P=1;break e;case 30:P=-3;break e;case 31:return-4;case 32:default:return u}return I.next_out=de,I.avail_out=le,I.next_in=G,I.avail_in=V,g.hold=O,g.bits=A,(g.wsize||ee!==I.avail_out&&g.mode<30&&(g.mode<27||z!==4))&&Q(I,I.output,I.next_out,ee-I.avail_out)?(g.mode=31,-4):(oe-=I.avail_in,ee-=I.avail_out,I.total_in+=oe,I.total_out+=ee,g.total+=ee,g.wrap&&ee&&(I.adler=g.check=g.flags?i(g.check,re,ee,I.next_out-ee):r(g.check,re,ee,I.next_out-ee)),I.data_type=g.bits+(g.last?64:0)+(g.mode===12?128:0)+(g.mode===20||g.mode===15?256:0),(oe==0&&ee===0||z===4)&&P===h&&(P=-5),P)},a.inflateEnd=function(I){if(!I||!I.state)return u;var z=I.state;return z.window&&(z.window=null),I.state=null,h},a.inflateGetHeader=function(I,z){var g;return I&&I.state&&2&(g=I.state).wrap?((g.head=z).done=!1,h):u},a.inflateSetDictionary=function(I,z){var g,F=z.length;return I&&I.state?(g=I.state).wrap!==0&&g.mode!==11?u:g.mode===11&&r(1,z,F,0)!==g.check?-3:Q(I,z,F,F)?(g.mode=31,-4):(g.havedict=1,h):u},a.inflateInfo="pako inflate (from Nodeca project)"},{"../utils/common":41,"./adler32":43,"./crc32":45,"./inffast":48,"./inftrees":50}],50:[function(t,c,a){var n=t("../utils/common"),r=[3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0],i=[16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78],o=[1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0],l=[16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64];c.exports=function(f,m,h,u,y,p,b,v){var C,S,_,k,x,L,B,M,W,Q=v.bits,I=0,z=0,g=0,F=0,re=0,G=0,de=0,V=0,le=0,O=0,A=null,oe=0,ee=new n.Buf16(16),X=new n.Buf16(16),xe=null,Me=0;for(I=0;I<=15;I++)ee[I]=0;for(z=0;z<u;z++)ee[m[h+z]]++;for(re=Q,F=15;1<=F&&ee[F]===0;F--);if(F<re&&(re=F),F===0)return y[p++]=20971520,y[p++]=20971520,v.bits=1,0;for(g=1;g<F&&ee[g]===0;g++);for(re<g&&(re=g),I=V=1;I<=15;I++)if(V<<=1,(V-=ee[I])<0)return-1;if(0<V&&(f===0||F!==1))return-1;for(X[1]=0,I=1;I<15;I++)X[I+1]=X[I]+ee[I];for(z=0;z<u;z++)m[h+z]!==0&&(b[X[m[h+z]]++]=z);if(L=f===0?(A=xe=b,19):f===1?(A=r,oe-=257,xe=i,Me-=257,256):(A=o,xe=l,-1),I=g,x=p,de=z=O=0,_=-1,k=(le=1<<(G=re))-1,f===1&&852<le||f===2&&592<le)return 1;for(;;){for(B=I-de,W=b[z]<L?(M=0,b[z]):b[z]>L?(M=xe[Me+b[z]],A[oe+b[z]]):(M=96,0),C=1<<I-de,g=S=1<<G;y[x+(O>>de)+(S-=C)]=B<<24|M<<16|W|0,S!==0;);for(C=1<<I-1;O&C;)C>>=1;if(C!==0?(O&=C-1,O+=C):O=0,z++,--ee[I]==0){if(I===F)break;I=m[h+b[z]]}if(re<I&&(O&k)!==_){for(de===0&&(de=re),x+=g,V=1<<(G=I-de);G+de<F&&!((V-=ee[G+de])<=0);)G++,V<<=1;if(le+=1<<G,f===1&&852<le||f===2&&592<le)return 1;y[_=O&k]=re<<24|G<<16|x-p|0}}return O!==0&&(y[x+O]=I-de<<24|64<<16|0),v.bits=re,0}},{"../utils/common":41}],51:[function(t,c,a){c.exports={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"}},{}],52:[function(t,c,a){var n=t("../utils/common"),r=0,i=1;function o(w){for(var T=w.length;0<=--T;)w[T]=0}var l=0,f=29,m=256,h=m+1+f,u=30,y=19,p=2*h+1,b=15,v=16,C=7,S=256,_=16,k=17,x=18,L=[0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0],B=[0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13],M=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,3,7],W=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15],Q=new Array(2*(h+2));o(Q);var I=new Array(2*u);o(I);var z=new Array(512);o(z);var g=new Array(256);o(g);var F=new Array(f);o(F);var re,G,de,V=new Array(u);function le(w,T,U,q,N){this.static_tree=w,this.extra_bits=T,this.extra_base=U,this.elems=q,this.max_length=N,this.has_stree=w&&w.length}function O(w,T){this.dyn_tree=w,this.max_code=0,this.stat_desc=T}function A(w){return w<256?z[w]:z[256+(w>>>7)]}function oe(w,T){w.pending_buf[w.pending++]=255&T,w.pending_buf[w.pending++]=T>>>8&255}function ee(w,T,U){w.bi_valid>v-U?(w.bi_buf|=T<<w.bi_valid&65535,oe(w,w.bi_buf),w.bi_buf=T>>v-w.bi_valid,w.bi_valid+=U-v):(w.bi_buf|=T<<w.bi_valid&65535,w.bi_valid+=U)}function X(w,T,U){ee(w,U[2*T],U[2*T+1])}function xe(w,T){for(var U=0;U|=1&w,w>>>=1,U<<=1,0<--T;);return U>>>1}function Me(w,T,U){var q,N,J=new Array(b+1),te=0;for(q=1;q<=b;q++)J[q]=te=te+U[q-1]<<1;for(N=0;N<=T;N++){var Y=w[2*N+1];Y!==0&&(w[2*N]=xe(J[Y]++,Y))}}function me(w){var T;for(T=0;T<h;T++)w.dyn_ltree[2*T]=0;for(T=0;T<u;T++)w.dyn_dtree[2*T]=0;for(T=0;T<y;T++)w.bl_tree[2*T]=0;w.dyn_ltree[2*S]=1,w.opt_len=w.static_len=0,w.last_lit=w.matches=0}function ve(w){8<w.bi_valid?oe(w,w.bi_buf):0<w.bi_valid&&(w.pending_buf[w.pending++]=w.bi_buf),w.bi_buf=0,w.bi_valid=0}function Oe(w,T,U,q){var N=2*T,J=2*U;return w[N]<w[J]||w[N]===w[J]&&q[T]<=q[U]}function Ne(w,T,U){for(var q=w.heap[U],N=U<<1;N<=w.heap_len&&(N<w.heap_len&&Oe(T,w.heap[N+1],w.heap[N],w.depth)&&N++,!Oe(T,q,w.heap[N],w.depth));)w.heap[U]=w.heap[N],U=N,N<<=1;w.heap[U]=q}function Ve(w,T,U){var q,N,J,te,Y=0;if(w.last_lit!==0)for(;q=w.pending_buf[w.d_buf+2*Y]<<8|w.pending_buf[w.d_buf+2*Y+1],N=w.pending_buf[w.l_buf+Y],Y++,q===0?X(w,N,T):(X(w,(J=g[N])+m+1,T),(te=L[J])!==0&&ee(w,N-=F[J],te),X(w,J=A(--q),U),(te=B[J])!==0&&ee(w,q-=V[J],te)),Y<w.last_lit;);X(w,S,T)}function Je(w,T){var U,q,N,J=T.dyn_tree,te=T.stat_desc.static_tree,Y=T.stat_desc.has_stree,ae=T.stat_desc.elems,we=-1;for(w.heap_len=0,w.heap_max=p,U=0;U<ae;U++)J[2*U]!==0?(w.heap[++w.heap_len]=we=U,w.depth[U]=0):J[2*U+1]=0;for(;w.heap_len<2;)J[2*(N=w.heap[++w.heap_len]=we<2?++we:0)]=1,w.depth[N]=0,w.opt_len--,Y&&(w.static_len-=te[2*N+1]);for(T.max_code=we,U=w.heap_len>>1;1<=U;U--)Ne(w,J,U);for(N=ae;U=w.heap[1],w.heap[1]=w.heap[w.heap_len--],Ne(w,J,1),q=w.heap[1],w.heap[--w.heap_max]=U,w.heap[--w.heap_max]=q,J[2*N]=J[2*U]+J[2*q],w.depth[N]=(w.depth[U]>=w.depth[q]?w.depth[U]:w.depth[q])+1,J[2*U+1]=J[2*q+1]=N,w.heap[1]=N++,Ne(w,J,1),2<=w.heap_len;);w.heap[--w.heap_max]=w.heap[1],function(fe,Ke){var Et,Ye,Bt,Te,Ft,Ht,tt=Ke.dyn_tree,tn=Ke.max_code,Ln=Ke.stat_desc.static_tree,Tn=Ke.stat_desc.has_stree,R=Ke.stat_desc.extra_bits,Z=Ke.stat_desc.extra_base,H=Ke.stat_desc.max_length,ne=0;for(Te=0;Te<=b;Te++)fe.bl_count[Te]=0;for(tt[2*fe.heap[fe.heap_max]+1]=0,Et=fe.heap_max+1;Et<p;Et++)H<(Te=tt[2*tt[2*(Ye=fe.heap[Et])+1]+1]+1)&&(Te=H,ne++),tt[2*Ye+1]=Te,tn<Ye||(fe.bl_count[Te]++,Ft=0,Z<=Ye&&(Ft=R[Ye-Z]),Ht=tt[2*Ye],fe.opt_len+=Ht*(Te+Ft),Tn&&(fe.static_len+=Ht*(Ln[2*Ye+1]+Ft)));if(ne!==0){do{for(Te=H-1;fe.bl_count[Te]===0;)Te--;fe.bl_count[Te]--,fe.bl_count[Te+1]+=2,fe.bl_count[H]--,ne-=2}while(0<ne);for(Te=H;Te!==0;Te--)for(Ye=fe.bl_count[Te];Ye!==0;)tn<(Bt=fe.heap[--Et])||(tt[2*Bt+1]!==Te&&(fe.opt_len+=(Te-tt[2*Bt+1])*tt[2*Bt],tt[2*Bt+1]=Te),Ye--)}}(w,T),Me(J,we,w.bl_count)}function d(w,T,U){var q,N,J=-1,te=T[1],Y=0,ae=7,we=4;for(te===0&&(ae=138,we=3),T[2*(U+1)+1]=65535,q=0;q<=U;q++)N=te,te=T[2*(q+1)+1],++Y<ae&&N===te||(Y<we?w.bl_tree[2*N]+=Y:N!==0?(N!==J&&w.bl_tree[2*N]++,w.bl_tree[2*_]++):Y<=10?w.bl_tree[2*k]++:w.bl_tree[2*x]++,J=N,we=(Y=0)===te?(ae=138,3):N===te?(ae=6,3):(ae=7,4))}function P(w,T,U){var q,N,J=-1,te=T[1],Y=0,ae=7,we=4;for(te===0&&(ae=138,we=3),q=0;q<=U;q++)if(N=te,te=T[2*(q+1)+1],!(++Y<ae&&N===te)){if(Y<we)for(;X(w,N,w.bl_tree),--Y!=0;);else N!==0?(N!==J&&(X(w,N,w.bl_tree),Y--),X(w,_,w.bl_tree),ee(w,Y-3,2)):Y<=10?(X(w,k,w.bl_tree),ee(w,Y-3,3)):(X(w,x,w.bl_tree),ee(w,Y-11,7));J=N,we=(Y=0)===te?(ae=138,3):N===te?(ae=6,3):(ae=7,4)}}o(V);var $=!1;function E(w,T,U,q){ee(w,(l<<1)+(q?1:0),3),function(N,J,te,Y){ve(N),oe(N,te),oe(N,~te),n.arraySet(N.pending_buf,N.window,J,te,N.pending),N.pending+=te}(w,T,U)}a._tr_init=function(w){$||(function(){var T,U,q,N,J,te=new Array(b+1);for(N=q=0;N<f-1;N++)for(F[N]=q,T=0;T<1<<L[N];T++)g[q++]=N;for(g[q-1]=N,N=J=0;N<16;N++)for(V[N]=J,T=0;T<1<<B[N];T++)z[J++]=N;for(J>>=7;N<u;N++)for(V[N]=J<<7,T=0;T<1<<B[N]-7;T++)z[256+J++]=N;for(U=0;U<=b;U++)te[U]=0;for(T=0;T<=143;)Q[2*T+1]=8,T++,te[8]++;for(;T<=255;)Q[2*T+1]=9,T++,te[9]++;for(;T<=279;)Q[2*T+1]=7,T++,te[7]++;for(;T<=287;)Q[2*T+1]=8,T++,te[8]++;for(Me(Q,h+1,te),T=0;T<u;T++)I[2*T+1]=5,I[2*T]=xe(T,5);re=new le(Q,L,m+1,h,b),G=new le(I,B,0,u,b),de=new le(new Array(0),M,0,y,C)}(),$=!0),w.l_desc=new O(w.dyn_ltree,re),w.d_desc=new O(w.dyn_dtree,G),w.bl_desc=new O(w.bl_tree,de),w.bi_buf=0,w.bi_valid=0,me(w)},a._tr_stored_block=E,a._tr_flush_block=function(w,T,U,q){var N,J,te=0;0<w.level?(w.strm.data_type===2&&(w.strm.data_type=function(Y){var ae,we=4093624447;for(ae=0;ae<=31;ae++,we>>>=1)if(1&we&&Y.dyn_ltree[2*ae]!==0)return r;if(Y.dyn_ltree[18]!==0||Y.dyn_ltree[20]!==0||Y.dyn_ltree[26]!==0)return i;for(ae=32;ae<m;ae++)if(Y.dyn_ltree[2*ae]!==0)return i;return r}(w)),Je(w,w.l_desc),Je(w,w.d_desc),te=function(Y){var ae;for(d(Y,Y.dyn_ltree,Y.l_desc.max_code),d(Y,Y.dyn_dtree,Y.d_desc.max_code),Je(Y,Y.bl_desc),ae=y-1;3<=ae&&Y.bl_tree[2*W[ae]+1]===0;ae--);return Y.opt_len+=3*(ae+1)+5+5+4,ae}(w),N=w.opt_len+3+7>>>3,(J=w.static_len+3+7>>>3)<=N&&(N=J)):N=J=U+5,U+4<=N&&T!==-1?E(w,T,U,q):w.strategy===4||J===N?(ee(w,2+(q?1:0),3),Ve(w,Q,I)):(ee(w,4+(q?1:0),3),function(Y,ae,we,fe){var Ke;for(ee(Y,ae-257,5),ee(Y,we-1,5),ee(Y,fe-4,4),Ke=0;Ke<fe;Ke++)ee(Y,Y.bl_tree[2*W[Ke]+1],3);P(Y,Y.dyn_ltree,ae-1),P(Y,Y.dyn_dtree,we-1)}(w,w.l_desc.max_code+1,w.d_desc.max_code+1,te+1),Ve(w,w.dyn_ltree,w.dyn_dtree)),me(w),q&&ve(w)},a._tr_tally=function(w,T,U){return w.pending_buf[w.d_buf+2*w.last_lit]=T>>>8&255,w.pending_buf[w.d_buf+2*w.last_lit+1]=255&T,w.pending_buf[w.l_buf+w.last_lit]=255&U,w.last_lit++,T===0?w.dyn_ltree[2*U]++:(w.matches++,T--,w.dyn_ltree[2*(g[U]+m+1)]++,w.dyn_dtree[2*A(T)]++),w.last_lit===w.lit_bufsize-1},a._tr_align=function(w){ee(w,2,3),X(w,S,Q),function(T){T.bi_valid===16?(oe(T,T.bi_buf),T.bi_buf=0,T.bi_valid=0):8<=T.bi_valid&&(T.pending_buf[T.pending++]=255&T.bi_buf,T.bi_buf>>=8,T.bi_valid-=8)}(w)}},{"../utils/common":41}],53:[function(t,c,a){c.exports=function(){this.input=null,this.next_in=0,this.avail_in=0,this.total_in=0,this.output=null,this.next_out=0,this.avail_out=0,this.total_out=0,this.msg="",this.state=null,this.data_type=2,this.adler=0}},{}],54:[function(t,c,a){(function(n){(function(r,i){if(!r.setImmediate){var o,l,f,m,h=1,u={},y=!1,p=r.document,b=Object.getPrototypeOf&&Object.getPrototypeOf(r);b=b&&b.setTimeout?b:r,o={}.toString.call(r.process)==="[object process]"?function(_){process.nextTick(function(){C(_)})}:function(){if(r.postMessage&&!r.importScripts){var _=!0,k=r.onmessage;return r.onmessage=function(){_=!1},r.postMessage("","*"),r.onmessage=k,_}}()?(m="setImmediate$"+Math.random()+"$",r.addEventListener?r.addEventListener("message",S,!1):r.attachEvent("onmessage",S),function(_){r.postMessage(m+_,"*")}):r.MessageChannel?((f=new MessageChannel).port1.onmessage=function(_){C(_.data)},function(_){f.port2.postMessage(_)}):p&&"onreadystatechange"in p.createElement("script")?(l=p.documentElement,function(_){var k=p.createElement("script");k.onreadystatechange=function(){C(_),k.onreadystatechange=null,l.removeChild(k),k=null},l.appendChild(k)}):function(_){setTimeout(C,0,_)},b.setImmediate=function(_){typeof _!="function"&&(_=new Function(""+_));for(var k=new Array(arguments.length-1),x=0;x<k.length;x++)k[x]=arguments[x+1];var L={callback:_,args:k};return u[h]=L,o(h),h++},b.clearImmediate=v}function v(_){delete u[_]}function C(_){if(y)setTimeout(C,0,_);else{var k=u[_];if(k){y=!0;try{(function(x){var L=x.callback,B=x.args;switch(B.length){case 0:L();break;case 1:L(B[0]);break;case 2:L(B[0],B[1]);break;case 3:L(B[0],B[1],B[2]);break;default:L.apply(i,B)}})(k)}finally{v(_),y=!1}}}}function S(_){_.source===r&&typeof _.data=="string"&&_.data.indexOf(m)===0&&C(+_.data.slice(m.length))}})(typeof self>"u"?n===void 0?this:n:self)}).call(this,typeof Bn<"u"?Bn:typeof self<"u"?self:typeof window<"u"?window:{})},{}]},{},[10])(10)})})(Sa);var Pr=Sa.exports;const Ii=ta(Pr);function j(e,s=3e3){const t=document.getElementById("notification-toast");t&&(t.textContent=e,t.classList.add("show"),clearTimeout(ni),pa(setTimeout(()=>{t.classList.remove("show")},s)))}function he(e,s,t={}){const{confirmText:c="ØªØ§ÛŒÛŒØ¯",cancelText:a="Ù„ØºÙˆ",confirmClass:n="btn-success",onCancel:r=()=>{},isDelete:i=!1}=t,o=i?()=>Fr(e,s):s;Pa.innerHTML=e.replace(/\n/g,"<br>"),rn.textContent=c,Hs.textContent=a,rn.className="modal-action-btn",rn.classList.add(n),bi(o),Ci(r);const l=rn.parentElement;Hs.style.display=r===null?"none":"inline-block",l.style.justifyContent=r===null?"center":"space-between",De("custom-confirm-modal")}function Fr(e,s){const t=Math.floor(1e4+Math.random()*9e4).toString();Fa.textContent=e,Ha.textContent=t,jt.value="",$n.disabled=!0,yn(s),De("secure-confirm-modal"),jt.focus();const c=()=>{jt.value===t?$n.disabled=!1:$n.disabled=!0};return jt.addEventListener("input",c),()=>{jt.removeEventListener("input",c)}}async function Hr(e=[]){const s={};if(e.length>0)e.forEach(l=>{ie[l]&&(s[l]=ie[l])});else for(const l in ie)ie[l].isDeleted||(s[l]=ie[l]);const t={metadata:{version:"2.0-b64",createdAt:new Date().toISOString()},data:{classrooms:s,trashBin:He,userSettings:Be}},c=JSON.stringify(t),a=new Date,n=new Intl.DateTimeFormat("fa-IR-u-nu-latn",{year:"numeric",month:"numeric",day:"numeric",hour:"2-digit",minute:"2-digit",hour12:!1}).formatToParts(a).reduce((l,f)=>(l[f.type]=f.value,l),{}),i=`${n.year.slice(-2)}-${n.month}-${n.day}_${n.hour}-${n.minute}`;let o;e.length===0?o=`SP_Full_${i}.txt`:e.length===1?o=`SP_${e[0].replace(/[<>:"/\\|?*]/g,"").replace(/\s+/g,"_")}_${i}.txt`:o=`SP_Selected-${e.length}_${i}.txt`;try{const l=new Ii;l.file("backup.json",c);const f=await l.generateAsync({type:"blob",compression:"DEFLATE",compressionOptions:{level:9}}),m=await Wr(f);return new File([m],o,{type:"text/plain"})}catch(l){return console.error("Error creating base64 backup file:",l),null}}function Wr(e){return new Promise((s,t)=>{const c=new FileReader;c.onerror=t,c.onload=()=>{s(c.result.split(",")[1])},c.readAsDataURL(e)})}function Ur(e,s){if(s)$t(e.data.classrooms),Ei(e.data.trashBin||[]);else{const t=e.data.classrooms,c=e.data.trashBin||[],a=new Map;for(const r in ie){const i=ie[r];i.info&&i.info.scheduleCode&&a.set(i.info.scheduleCode,r)}for(const r in t){const i=t[r],o=i.info.scheduleCode;if(a.has(o)){const l=a.get(o);l!==i.info.name&&delete ie[l],ie[i.info.name]=i}else{let l=i.info.name;for(;ie[l];)l=`${l} (Imported)`;l!==i.info.name&&(i.info.name=l),ie[l]=i}}const n=new Set(He.map(r=>r.id));c.forEach(r=>{n.has(r.id)||He.push(r)}),$t(ie)}e.data.userSettings&&wt(e.data.userSettings),wt({lastRestoreTimestamp:new Date().toISOString()}),se()}async function ts(e=[]){const s=await Hr(e);if(!s){j("âŒ Ø®Ø·Ø§ Ø¯Ø± Ø§ÛŒØ¬Ø§Ø¯ ÙØ§ÛŒÙ„ Ù¾Ø´ØªÛŒØ¨Ø§Ù†.");return}let t="Ù¾Ø´ØªÛŒØ¨Ø§Ù† Ú©Ø§Ù…Ù„ Ø³ÛŒØ³ØªÙ…";if(e.length>0){const a=e.join("ØŒ ");t=`${e.length===1?"Ù¾Ø´ØªÛŒØ¨Ø§Ù† Ú©Ù„Ø§Ø³:":"Ù¾Ø´ØªÛŒØ¨Ø§Ù† Ú©Ù„Ø§Ø³â€ŒÙ‡Ø§ÛŒ:"} ${a}`}wa(s,{name:s.name,description:t,version:"2.0-b64"}).catch(a=>console.error("Failed to save local snapshot:",a)),("ontouchstart"in window||navigator.maxTouchPoints>0)&&navigator.share&&navigator.canShare&&navigator.canShare({files:[s]})?he("ÙØ§ÛŒÙ„ Ù¾Ø´ØªÛŒØ¨Ø§Ù† Ø´Ù…Ø§ Ø¢Ù…Ø§Ø¯Ù‡ Ø§Ø³Øª. Ø¢ÛŒØ§ Ù…Ø§ÛŒÙ„ Ø¨Ù‡ Ø§Ø´ØªØ±Ø§Ú©â€ŒÚ¯Ø°Ø§Ø±ÛŒ Ø¢Ù† Ù‡Ø³ØªÛŒØ¯ØŸ",()=>{try{navigator.share({title:s.name,text:"ÙØ§ÛŒÙ„ Ù¾Ø´ØªÛŒØ¨Ø§Ù† Ø¯Ø§Ø¯Ù‡â€ŒÙ‡Ø§ÛŒ Ø¨Ø±Ù†Ø§Ù…Ù‡",files:[s]}).then(()=>{he("Ø¢ÛŒØ§ ÙØ§ÛŒÙ„ Ù¾Ø´ØªÛŒØ¨Ø§Ù† Ø¨Ø§ Ù…ÙˆÙÙ‚ÛŒØª Ø§Ø±Ø³Ø§Ù„/Ø°Ø®ÛŒØ±Ù‡ Ø´Ø¯ØŸ",()=>{Si(),Cs(),j("âœ… ØªØ§Ø±ÛŒØ® Ù¾Ø´ØªÛŒØ¨Ø§Ù† Ø«Ø¨Øª Ø´Ø¯.")},{confirmText:"Ø¨Ù„Ù‡",cancelText:"Ø®ÛŒØ±",confirmClass:"btn-success"})})}catch(a){console.error("Error during sharing process:",a),Zi(s),j("âš ï¸Ø®Ø·Ø§ Ø¯Ø± ÙØ±Ø¢ÛŒÙ†Ø¯ Ø§Ø´ØªØ±Ø§Ú©â€ŒÚ¯Ø°Ø§Ø±ÛŒ. ÙØ§ÛŒÙ„ Ø¯Ø± Ø­Ø§Ù„ Ø¯Ø§Ù†Ù„ÙˆØ¯ Ø§Ø³Øª.")}},{confirmText:"Ø¨Ù„Ù‡",cancelText:"Ø®ÛŒØ±",confirmClass:"btn-success"}):(Zi(s),j("âœ…Ù¾Ø´ØªÛŒØ¨Ø§Ù†â€ŒÚ¯ÛŒØ±ÛŒ Ø¨Ø§ Ù…ÙˆÙÙ‚ÛŒØª Ø§Ù†Ø¬Ø§Ù… Ø´Ø¯."))}function jr(e){e.addEventListener("click",()=>{if(bt){j("âš ï¸ Ù¾Ø´ØªÛŒØ¨Ø§Ù†â€ŒÚ¯ÛŒØ±ÛŒ Ø¯Ø± Ø­Ø§Ù„Øª Ù†Ù…Ø§ÛŒØ´ (Demo) ØºÛŒØ±ÙØ¹Ø§Ù„ Ø§Ø³Øª."),qe();return}qe(),ts()})}function qr(e,s){e.addEventListener("click",()=>{if(bt){j("âš ï¸ Ø¨Ø§Ø²ÛŒØ§Ø¨ÛŒ Ø§Ø·Ù„Ø§Ø¹Ø§Øª Ø¯Ø± Ø­Ø§Ù„Øª Ù†Ù…Ø§ÛŒØ´ (Demo) ØºÛŒØ±ÙØ¹Ø§Ù„ Ø§Ø³Øª."),qe();return}s.click(),qe()})}function Gr(e){e.addEventListener("change",s=>{const t=s.target.files[0];if(!t)return;const c=new FileReader;c.onload=async a=>{const n=a.target.result;try{const r=JSON.parse(n);if(r.metadata&&r.data)cs(r);else{const i=r.classrooms||r,o=r.trashBin||[];he("Ø¢ÛŒØ§ Ø§Ø² Ø¨Ø§Ø²ÛŒØ§Ø¨ÛŒ Ø§Ø·Ù„Ø§Ø¹Ø§Øª Ù…Ø·Ù…Ø¦Ù† Ù‡Ø³ØªÛŒØ¯ØŸ ØªÙ…Ø§Ù… Ø¯Ø§Ø¯Ù‡â€ŒÙ‡Ø§ÛŒ ÙØ¹Ù„ÛŒ Ø´Ù…Ø§ Ø¨Ø§Ø²Ù†ÙˆÛŒØ³ÛŒ Ø®ÙˆØ§Ù‡Ø¯ Ø´Ø¯.",()=>{$t(i),Ei(o),wt({lastRestoreTimestamp:new Date().toISOString()}),se(),Fe(),Ee("class-management-page"),j("âœ…Ø§Ø·Ù„Ø§Ø¹Ø§Øª Ø¨Ø§ Ù…ÙˆÙÙ‚ÛŒØª Ø¨Ø§Ø²ÛŒØ§Ø¨ÛŒ Ø´Ø¯.")},{confirmText:"Ø¨Ø§Ø²ÛŒØ§Ø¨ÛŒ Ú©Ù†",confirmClass:"btn-warning"})}}catch{try{const l=(await new Ii().loadAsync(n,{base64:!0})).file("backup.json");if(!l)throw new Error("ÙØ§ÛŒÙ„ backup.json Ø¯Ø± ÙØ§ÛŒÙ„ Ù¾Ø´ØªÛŒØ¨Ø§Ù† ÛŒØ§ÙØª Ù†Ø´Ø¯.");const f=await l.async("string"),m=JSON.parse(f);if(m.metadata&&m.metadata.version==="2.0-b64")cs(m);else throw new Error("ÙØ§ÛŒÙ„ Ù¾Ø´ØªÛŒØ¨Ø§Ù† Ù…Ø¹ØªØ¨Ø± Ù†ÛŒØ³Øª (Ù†Ø³Ø®Ù‡ Ù†Ø§Ù…Ø´Ø®Øµ).")}catch(i){j("âŒØ®Ø·Ø§ Ø¯Ø± Ø®ÙˆØ§Ù†Ø¯Ù† ÙØ§ÛŒÙ„. Ù„Ø·ÙØ§Ù‹ ÙØ§ÛŒÙ„ Ù¾Ø´ØªÛŒØ¨Ø§Ù† Ù…Ø¹ØªØ¨Ø± Ø§Ù†ØªØ®Ø§Ø¨ Ú©Ù†ÛŒØ¯."),console.error("Restore error (zip/base64):",i)}}},c.readAsText(t),s.target.value=null})}function Zi(e){const s=URL.createObjectURL(e),t=document.createElement("a");t.href=s,t.download=e.name,document.body.appendChild(t),t.click(),document.body.removeChild(t),URL.revokeObjectURL(s),setTimeout(()=>{he("Ø¢ÛŒØ§ ÙØ§ÛŒÙ„ Ù¾Ø´ØªÛŒØ¨Ø§Ù† Ø¨Ø§ Ù…ÙˆÙÙ‚ÛŒØª Ø°Ø®ÛŒØ±Ù‡ Ø´Ø¯ØŸ",()=>{Si(),Cs(),j("âœ… ØªØ§Ø±ÛŒØ® Ù¾Ø´ØªÛŒØ¨Ø§Ù† Ø«Ø¨Øª Ø´Ø¯.")},{confirmText:"Ø¨Ù„Ù‡ØŒ Ø°Ø®ÛŒØ±Ù‡ Ø´Ø¯",cancelText:"Ø®ÛŒØ±",confirmClass:"btn-success"})},500)}function Pe(e){return typeof e!="string"?"":e.replace(/ÙŠ/g,"ÛŒ").replace(/Ùƒ/g,"Ú©").replace(/[\s\u200c]/g,"")}function Rn(e){if(typeof e!="string")return"";const s={q:"Ø¶",w:"Øµ",e:"Ø«",r:"Ù‚",t:"Ù",y:"Øº",u:"Ø¹",i:"Ù‡",o:"Ø®",p:"Ø­","[":"Ø¬","]":"Ú†",a:"Ø´",s:"Ø³",d:"ÛŒ",f:"Ø¨",g:"Ù„",h:"Ø§",j:"Øª",k:"Ù†",l:"Ù…",";":"Ú©","'":"Ú¯",z:"Ø¸",x:"Ø·",c:"Ø²",v:"Ø±",b:"Ø°",n:"Ø¯",m:"Ù¾",",":"Ùˆ"};let t="";for(let c=0;c<e.length;c++){const a=e[c].toLowerCase();t+=s[a]||e[c]}return t}function Zt(e){if(!e||typeof e!="string")return{name:"",firstName:"",lastName:""};const s=e.split(".").map(t=>t.trim());if(s.length>1){const t=s[0],c=s.slice(1).join(" ");return{firstName:t,lastName:c,name:`${t} ${c}`.trim()}}return{name:e.trim(),firstName:"",lastName:""}}let Is=null;function zn(){if(!Be.isSoundEnabled)return;const e=window.AudioContext||window.webkitAudioContext;if(!e)return;Is||(Is=new e);const s=Is,t=()=>{const c=s.createOscillator(),a=s.createGain();c.connect(a),a.connect(s.destination),c.type="sine";const n=s.currentTime;c.frequency.setValueAtTime(450,n),a.gain.setValueAtTime(0,n),a.gain.linearRampToValueAtTime(.3,n+.002),a.gain.exponentialRampToValueAtTime(.001,n+.025),a.gain.linearRampToValueAtTime(0,n+.03),c.start(n),c.stop(n+.04)};s.state==="suspended"?s.resume().then(()=>{t()}).catch(c=>console.error("Audio resume failed:",c)):t()}function kn(e){const s=e.filter(a=>a.identity.firstName&&a.identity.lastName),t=e.filter(a=>(!a.identity.firstName||!a.identity.lastName)&&typeof a.identity.name=="string"),c=e.filter(a=>(!a.identity.firstName||!a.identity.lastName)&&!a.identity.name);return s.sort((a,n)=>{const r=a.identity.lastName.localeCompare(n.identity.lastName,"fa");return r!==0?r:a.identity.firstName.localeCompare(n.identity.firstName,"fa")}),t.sort((a,n)=>a.identity.name.localeCompare(n.identity.name,"fa")),[...s,...t,...c]}function _a(e,s){let t=0;e.addEventListener("dblclick",s),e.addEventListener("touchend",c=>{const a=new Date().getTime(),n=a-t;n<400&&n>0&&(c.preventDefault(),s(c)),t=a})}function At(e){e&&e.addEventListener("focus",()=>{e.select()})}function gt(e,s=4e3,t=!0){t&&xi(e),e.classList.add("blink-error"),setTimeout(()=>{e.classList.remove("blink-error")},s)}function xi(e,s="center"){if(e)if(typeof s=="number"){const t=window.innerHeight,n=e.getBoundingClientRect().top+window.scrollY-t*s;window.scrollTo({top:n,behavior:"smooth"})}else e.scrollIntoView({behavior:"smooth",block:s})}function ka(){const e=document.getElementById("session-dashboard-page"),s=document.getElementById("student-stats-table-container");if(!e)return;let t=0,c=0;e.addEventListener("touchstart",n=>{if(s&&s.contains(n.target)){const r=n.target.closest("td, th");r&&r.parentElement.firstElementChild===r?t=n.changedTouches[0].screenX:t=0}else t=n.changedTouches[0].screenX},{passive:!0}),e.addEventListener("touchend",n=>{t!==0&&(c=n.changedTouches[0].screenX,a())});function a(){const r=t-c;Math.abs(r)>150&&(document.getElementById("selector-tab-btn").classList.contains("active")?(Ee("session-dashboard-page",{tab:"attendance"}),Xt("attendance")):(Ee("session-dashboard-page",{tab:"selector"}),Xt("selector"))),t=0,c=0}}function In(e,s){let t=null;const c=500;e.addEventListener("contextmenu",a=>{a.preventDefault(),Gs(a,s(e))}),e.addEventListener("touchstart",a=>{if(a.touches.length!==1)return;const n=a.touches[0];t=setTimeout(()=>{const r={preventDefault:()=>{},clientX:n.clientX,clientY:n.clientY,target:e};Gs(r,s(e))},c)}),["touchend","touchmove","touchcancel"].forEach(a=>{e.addEventListener(a,()=>clearTimeout(t))})}function Zr(e,s){for(const t of Object.values(s)){const c=t.students.find(a=>a.identity.studentId===e);if(c)return c.identity.name}return null}const Vr={"dashboard-attendance":"attendance-pane","dashboard-selector":"selector-pane","column-mapping-page":"column-mapping-page","csv-preview-page":"csv-preview-page","restore-points-page":"restore-points-page","session-page":"session-page","settings-page":"settings-page","trash-page":"trash-page","class-management-page":"class-management-page"};function Jr(){for(const[e,s]of Object.entries(Vr)){const t=document.getElementById(s);if(t&&t.classList.contains("active")&&t.offsetParent!==null)return e}return null}function Ts(e,s){const t=s.toLowerCase();return(e.logs.scores[t]||[]).filter(a=>!a.isDeleted).length}function Mt(e,s,t=800){let c,a=t;const n=i=>{c=setTimeout(()=>{Be.isVibrationEnabled&&navigator.vibrate&&navigator.vibrate(50),s(i)},a)},r=()=>{clearTimeout(c)};e.addEventListener("touchstart",n,{passive:!0}),e.addEventListener("touchend",r),e.addEventListener("touchmove",r),e.addEventListener("mousedown",n),e.addEventListener("mouseup",r),e.addEventListener("mouseleave",r)}function Li(e){e.addEventListener("input",()=>{const s=e.value,t=gs(s);e.setAttribute("dir",t)})}function gs(e){return typeof e!="string"||e.length===0?"ltr":/[\u0590-\u07FF]/.test(e)?"rtl":"ltr"}function Ti(e){return!e||!e.trim()?"":e.split(`
`).map(c=>`<div dir="${gs(c)}">${c||"&nbsp;"}</div>`).join("")}function Ia(e){e&&(e.scrollIntoView({behavior:"smooth",block:"center"}),e.focus(),typeof e.select=="function"&&e.select())}function Bs(e){if(!e)return;e.classList.add("btn-pressing-effect");let s=0;const t=100,c=n=>{n.type==="mousedown"&&"ontouchstart"in window||(s=Date.now(),e.classList.add("btn-is-pressed"))},a=()=>{const n=Date.now()-s,r=t-n;r>0?setTimeout(()=>{e.classList.remove("btn-is-pressed")},r):e.classList.remove("btn-is-pressed")};e.addEventListener("mousedown",c),e.addEventListener("touchstart",c,{passive:!0}),window.addEventListener("mouseup",a),window.addEventListener("touchend",a),window.addEventListener("touchcancel",a)}const Kr=Object.freeze(Object.defineProperty({__proto__:null,addClickEffect:Bs,attachUniversalContextMenu:In,detectTextDirection:gs,flashElement:gt,focusAndPrepareInput:Ia,getCurrentView:Jr,getStudentNameById:Zr,getTotalScoresForCategory:Ts,normalizeKeyboard:Rn,normalizeText:Pe,parseStudentName:Zt,playSuccessSound:zn,renderMultiLineText:Ti,scrollToElement:xi,setAutoDirectionOnInput:Li,setupAutoSelectOnFocus:At,setupDoubleAction:_a,setupLongPress:Mt,setupSwipeNavigation:ka,sortStudents:kn},Symbol.toStringTag,{value:"Module"}));function Yr(e,s){document.addEventListener("keydown",t=>{const c=document.activeElement;if(!["INPUT","TEXTAREA","SELECT"].includes(c.tagName)){if(t.key.toLowerCase()==="o"&&t.shiftKey&&Aa.classList.contains("active")&&(t.preventDefault(),$a.click()),t.key==="Escape"){if(Pt.classList.contains("visible")){Rt();return}if(yt){ue();return}ji(!1);return}if(K){const n=t.key.toLowerCase();switch(" ascfg".includes(n)&&t.preventDefault(),n){case" ":e.click();break;case"s":document.getElementById("session-page").classList.contains("active")&&history.back();break;case"f":const r=document.querySelector(".action-column .search-icon");r&&r.click();break;case"arrowleft":{const i=document.querySelector('button[title="Ø¨Ø±Ù†Ø¯Ù‡ Ù‚Ø¨Ù„ÛŒ"]');i&&!i.disabled&&(t.preventDefault(),i.click());break}case"arrowright":{const i=document.querySelector('button[title="Ø¨Ø±Ù†Ø¯Ù‡ Ø¨Ø¹Ø¯ÛŒ"]');i&&!i.disabled&&(t.preventDefault(),i.click());break}}}}})}function ns(e,s,t){e&&e.addEventListener("keydown",c=>{if(e.tagName==="TEXTAREA"&&s==="Enter"){(c.ctrlKey||c.metaKey)&&c.key==="Enter"&&t(c);return}c.shiftKey&&s==="Enter"||c.key===s&&t(c)})}function ss(e){e&&typeof e.blur=="function"&&(e==null?void 0:e.tagName)==="INPUT"&&e.blur()}const xa="teacherAssistantLogs_v2",Xr=100;function Bi(){try{const e=localStorage.getItem(xa);return e?JSON.parse(e):{}}catch(e){return console.error("Error reading logs from localStorage:",e),{}}}function La(e){try{localStorage.setItem(xa,JSON.stringify(e))}catch(s){console.error("Error saving logs to localStorage:",s)}}function be(e,s,t=null){if(!e)return;const c=Bi();c[e]||(c[e]=[]);const a={timestamp:new Date().toISOString(),message:s,action:t,classroomName:e};c[e].unshift(a),c[e].length>Xr&&c[e].pop(),La(c)}function Qr(e){return Bi()[e]||[]}function eo(e,s){const t=Bi();t[e]&&!t[s]&&(t[s]=t[e],delete t[e],La(t))}var Vi={toJalaali:to,toGregorian:Ta,isValidJalaaliDate:no,isLeapJalaaliYear:Ba,jalaaliMonthLength:Da,jalCal:Di,j2d:is,d2j:as,g2d:ys,d2g:Ni,jalaaliToDateObject:Na,jalaaliWeek:io},_t=[-61,9,38,199,426,686,756,818,1111,1181,1210,1635,2060,2097,2192,2262,2324,2394,2456,3178];function to(e,s,t){return Object.prototype.toString.call(e)==="[object Date]"&&(t=e.getDate(),s=e.getMonth()+1,e=e.getFullYear()),as(ys(e,s,t))}function Ta(e,s,t){return Ni(is(e,s,t))}function no(e,s,t){return e>=-61&&e<=3177&&s>=1&&s<=12&&t>=1&&t<=Da(e,s)}function Ba(e){return so(e)===0}function Da(e,s){return s<=6?31:s<=11||Ba(e)?30:29}function so(e){var s=_t.length,t=_t[0],c,a,n,r,i;if(e<t||e>=_t[s-1])throw new Error("Invalid Jalaali year "+e);for(i=1;i<s&&(c=_t[i],a=c-t,!(e<c));i+=1)t=c;return r=e-t,a-r<6&&(r=r-a+Ie(a+4,33)*33),n=Qe(Qe(r+1,33)-1,4),n===-1&&(n=4),n}function Di(e,s){var t=_t.length,c=e+621,a=-14,n=_t[0],r,i,o,l,f,m,h;if(e<n||e>=_t[t-1])throw new Error("Invalid Jalaali year "+e);for(h=1;h<t&&(r=_t[h],i=r-n,!(e<r));h+=1)a=a+Ie(i,33)*8+Ie(Qe(i,33),4),n=r;return m=e-n,a=a+Ie(m,33)*8+Ie(Qe(m,33)+3,4),Qe(i,33)===4&&i-m===4&&(a+=1),l=Ie(c,4)-Ie((Ie(c,100)+1)*3,4)-150,f=20+a-l,s?{gy:c,march:f}:(i-m<6&&(m=m-i+Ie(i+4,33)*33),o=Qe(Qe(m+1,33)-1,4),o===-1&&(o=4),{leap:o,gy:c,march:f})}function is(e,s,t){var c=Di(e,!0);return ys(c.gy,3,c.march)+(s-1)*31-Ie(s,7)*(s-7)+t-1}function as(e){var s=Ni(e).gy,t=s-621,c=Di(t,!1),a=ys(s,3,c.march),n,r,i;if(i=e-a,i>=0){if(i<=185)return r=1+Ie(i,31),n=Qe(i,31)+1,{jy:t,jm:r,jd:n};i-=186}else t-=1,i+=179,c.leap===1&&(i+=1);return r=7+Ie(i,30),n=Qe(i,30)+1,{jy:t,jm:r,jd:n}}function ys(e,s,t){var c=Ie((e+Ie(s-8,6)+100100)*1461,4)+Ie(153*Qe(s+9,12)+2,5)+t-34840408;return c=c-Ie(Ie(e+100100+Ie(s-8,6),100)*3,4)+752,c}function Ni(e){var s,t,c,a,n;return s=4*e+139361631,s=s+Ie(Ie(4*e+183187720,146097)*3,4)*4-3908,t=Ie(Qe(s,1461),4)*5+308,c=Ie(Qe(t,153),5)+1,a=Qe(Ie(t,153),12)+1,n=Ie(s,1461)-100100+Ie(8-a,6),{gy:n,gm:a,gd:c}}function io(e,s,t){var c=Na(e,s,t).getDay(),a=c==6?0:-(c+1),n=6+a;return{saturday:as(is(e,s,t+a)),friday:as(is(e,s,t+n))}}function Na(e,s,t,c,a,n,r){var i=Ta(e,s,t);return new Date(i.gy,i.gm-1,i.gd,c||0,a||0,n||0,r||0)}function Ie(e,s){return~~(e/s)}function Qe(e,s){return e-~~(e/s)*s}function ao(e,s,t="default",c=!1){let a=[...ge(e.students)];const n=new Date().toLocaleDateString("fa-IR",{year:"numeric",month:"long",day:"numeric",weekday:"long"});t==="alpha"&&(a=kn(a));let r="<tr>";s.forEach(h=>{r+=`<th>${h.label}</th>`}),r+="</tr>";let i="";a.forEach((h,u)=>{i+="<tr>",s.forEach(y=>{var C;let p="-";if(y.id==="row_num")p=u+1;else if(y.id==="name")h.identity.firstName&&h.identity.lastName?p=`${h.identity.lastName}ØŒ ${h.identity.firstName}`:p=h.identity.name;else if(y.id==="total_selections")p=h.statusCounters.totalSelections;else if(y.id==="absences")p=e.sessions.reduce((S,_)=>{if(_.isDeleted||_.isCancelled)return S;const k=_.studentRecords[h.identity.studentId];return S+(k&&k.attendance==="absent"?1:0)},0);else if(y.id==="exit_count")p=h.statusCounters.outOfClassCount||0;else if(y.id==="missed_chances")p=h.statusCounters.missedChances;else if(y.id==="issues")p=Object.values(h.categoryIssues||{}).reduce((S,_)=>S+_,0);else if(y.id==="avg_score")p=h.getOverallAverageScore()||"-";else if(y.id==="final_score")p=e.calculateFinalStudentScore(h)||"-";else if(y.type==="category")p=h.categoryCounts[y.id]||0;else if(y.type==="category_scores"){const S=y.id.toLowerCase(),_=((C=h.logs.scores[S])==null?void 0:C.filter(k=>!k.isDeleted))||[];p=_.length>0?_.map(k=>k.value).join("ØŒ "):"-"}let b="text-align: center;";y.id==="name"?b="text-align: right; white-space: nowrap;":y.type==="category_scores"&&(b="text-align: center; white-space: nowrap;");const v=`style="${b}"`;i+=`<td ${v}>${p}</td>`}),i+="</tr>"});let o="";c&&(o=`
            <div class="warning-footnote">
                âš ï¸ <strong>ØªÙˆØ¬Ù‡:</strong> ØªØ±ØªÛŒØ¨ Ø§Ù„ÙØ¨Ø§ÛŒÛŒ Ø§ÛŒÙ† Ù„ÛŒØ³Øª Ù…Ù…Ú©Ù† Ø§Ø³Øª Ø¯Ù‚ÛŒÙ‚ Ù†Ø¨Ø§Ø´Ø¯. (Ù†Ø§Ù… Ø®Ø§Ù†ÙˆØ§Ø¯Ú¯ÛŒ Ø¨Ø±Ø®ÛŒ Ø¯Ø§Ù†Ø´â€ŒØ¢Ù…ÙˆØ²Ø§Ù† Ø¯Ø± Ø³ÛŒØ³ØªÙ… ØªÙÚ©ÛŒÚ© Ù†Ø´Ø¯Ù‡ Ø§Ø³Øª)
            </div>
        `);const l=Array.from(document.querySelectorAll('link[rel="stylesheet"]')).map(h=>h.outerHTML).join(""),f=window.open("","_blank");if(!f){j("âš ï¸ Ù…Ø±ÙˆØ±Ú¯Ø± Ø´Ù…Ø§ Ù¾Ù†Ø¬Ø±Ù‡ Ø¬Ø¯ÛŒØ¯ Ø±Ø§ Ù…Ø³Ø¯ÙˆØ¯ Ú©Ø±Ø¯. Ù„Ø·ÙØ§Ù‹ Ø§Ø¬Ø§Ø²Ù‡ Ø¯Ù‡ÛŒØ¯.","error");return}const m=`
        <!DOCTYPE html>
        <html lang="fa" dir="rtl">
        <head>
            <title>Ú¯Ø²Ø§Ø±Ø´ Ú©Ù„Ø§Ø³ ${e.info.name}</title>
            ${l} <style>
                @media print {
                    @page { size: A4; margin: 10mm; }
                    /* Updated Font Family */
                    body { font-family: 'Vazirmatn', 'Vazir', Tahoma, sans-serif; color: #000; }
                }
                /* Updated Font Family */
                body { font-family: 'Vazirmatn', 'Vazir', Tahoma, sans-serif; padding: 20px; direction: rtl; }
                h1 { text-align: center; margin-bottom: 5px; font-size: 24px; }
                .meta { text-align: center; margin-bottom: 30px; font-size: 14px; color: #444; }
                table { width: 100%; border-collapse: collapse; font-size: 12px; }
                th, td { border: 1px solid #333; padding: 6px 8px; text-align: center; }
                th { background-color: #eee; font-weight: bold; }
                tr:nth-child(even) { background-color: #f9f9f9; }
                .signature { margin-top: 50px; display: flex; justify-content: space-between; padding: 0 50px; }
                
                .warning-footnote {
                    margin-top: 20px;
                    font-size: 11px;
                    color: #555;
                    font-style: italic;
                    border-top: 1px solid #ccc;
                    padding-top: 10px;
                }
            </style>
        </head>
        <body>
            <h1>Ú¯Ø²Ø§Ø±Ø´ ÙˆØ¶Ø¹ÛŒØª Ú©Ù„Ø§Ø³ ${e.info.name}</h1>
            <div class="meta">
                ØªØ§Ø±ÛŒØ® Ú¯Ø²Ø§Ø±Ø´: ${n} | ØªØ¹Ø¯Ø§Ø¯ Ø¯Ø§Ù†Ø´â€ŒØ¢Ù…ÙˆØ²Ø§Ù†: ${a.length}
            </div>
            <table>
                <thead>${r}</thead>
                <tbody>${i}</tbody>
            </table>
            ${o}
            <div class="signature">
                <div>Ø§Ù…Ø¶Ø§ÛŒ Ù…Ø¹Ù„Ù…</div>
                <div>Ù…Ù‡Ø± Ùˆ Ø§Ù…Ø¶Ø§ÛŒ Ù…Ø¯Ø±Ø³Ù‡</div>
            </div>
            <script>
                window.onload = function() { window.print(); }
            <\/script>
        </body>
        </html>
    `;f.document.write(m),f.document.close()}function ro(e){const s=Ua;s.innerHTML="";const c=ge(e.students).filter(h=>!h.identity.lastName).length,a=[{id:"row_num",label:"Ø±Ø¯ÛŒÙ",checked:!0},{id:"name",label:"Ù†Ø§Ù… Ø¯Ø§Ù†Ø´â€ŒØ¢Ù…ÙˆØ²",checked:!0},{id:"total_selections",label:"Ú©Ù„ Ø§Ù†ØªØ®Ø§Ø¨â€ŒÙ‡Ø§",checked:!0},{id:"absences",label:"ØªØ¹Ø¯Ø§Ø¯ ØºÛŒØ¨Øª",checked:!0},{id:"exit_count",label:"ØªØ¹Ø¯Ø§Ø¯ Ø®Ø±ÙˆØ¬",checked:!1},{id:"missed_chances",label:"ÙØ±ØµØª Ø³ÙˆØ®ØªÙ‡",checked:!1},{id:"issues",label:"Ù…Ø´Ú©Ù„â€ŒÙ¾Ø§Ø³Ø®Ú¯ÙˆÛŒÛŒ",checked:!1},{id:"avg_score",label:"Ù…ÛŒØ§Ù†Ú¯ÛŒÙ† Ù†Ù…Ø±Ø§Øª",checked:!0},{id:"final_score",label:"Ù†Ù…Ø±Ù‡ Ù†Ù‡Ø§ÛŒÛŒ (Ú©Ø§Ù†ÙˆÙ†)",checked:!0}];e.categories.forEach(h=>{h.isDeleted||(a.push({id:h.name,label:`ØªØ¹Ø¯Ø§Ø¯ ${h.name}`,type:"category",checked:!1}),h.isGradedCategory&&a.push({id:h.name,label:`Ù†Ù…Ø±Ø§Øª ${h.name}`,type:"category_scores",checked:!1}))}),a.forEach(h=>{const u=document.createElement("label");u.className="report-column-item";const y=document.createElement("input");y.type="checkbox",y.checked=h.checked,y.dataset.colId=h.id,y.dataset.colLabel=h.label,h.type&&(y.dataset.colType=h.type);const p=document.createElement("span");p.textContent=h.label,u.appendChild(y),u.appendChild(p),s.appendChild(u)});const n=s.parentElement,r=n.querySelector("#report-sort-options");r&&r.remove();const i=document.createElement("div");i.id="report-sort-options",i.style.marginTop="20px",i.style.padding="15px",i.style.backgroundColor="#f8f9fa",i.style.borderRadius="5px",i.style.border="1px solid #e9ecef",i.innerHTML=`
        <div style="margin-bottom: 10px; font-weight: bold; color: #333;">ØªØ±ØªÛŒØ¨ Ù†Ù…Ø§ÛŒØ´ Ù„ÛŒØ³Øª:</div>
        
        <div style="display: flex; flex-direction: column; gap: 10px;">
            <label style="cursor: pointer; display: flex; align-items: center; gap: 8px;">
                <input type="radio" name="report-sort" value="alpha" checked style="accent-color: var(--color-primary);">
                <span>Ø¨Ø± Ø§Ø³Ø§Ø³ Ù†Ø§Ù… Ø®Ø§Ù†ÙˆØ§Ø¯Ú¯ÛŒ</span>
            </label>

            <label style="cursor: pointer; display: flex; align-items: center; gap: 8px;">
                <input type="radio" name="report-sort" value="default" style="accent-color: var(--color-primary);">
                <span>Ø¨Ø± Ø§Ø³Ø§Ø³ Ø²Ù…Ø§Ù† ÙˆØ±ÙˆØ¯ Ø¨Ù‡ Ú©Ù„Ø§Ø³</span>
            </label>
        </div>

        <div id="sort-warning" style="
            display: none; 
            margin-top: 12px; 
            background-color: #fff3cd; 
            color: #856404; 
            padding: 10px; 
            border-radius: 4px; 
            font-size: 13px; 
            border: 1px solid #ffeeba;
            line-height: 1.5;
        ">
            âš ï¸ <strong>ØªÙˆØ¬Ù‡:</strong> Ù†Ø§Ù… Ø®Ø§Ù†ÙˆØ§Ø¯Ú¯ÛŒ ${c} Ø¯Ø§Ù†Ø´â€ŒØ¢Ù…ÙˆØ² Ù‡Ù†ÙˆØ² ØªÙÚ©ÛŒÚ© Ù†Ø´Ø¯Ù‡ Ø§Ø³Øª. Ù…Ø±ØªØ¨â€ŒØ³Ø§Ø²ÛŒ Ø§ÛŒÙ† Ù…ÙˆØ§Ø±Ø¯ Ù…Ù…Ú©Ù† Ø§Ø³Øª Ú©Ø§Ù…Ù„Ø§Ù‹ Ø¯Ù‚ÛŒÙ‚ Ù†Ø¨Ø§Ø´Ø¯.
        </div>
    `;const o=n.querySelector(".modal-actions");n.insertBefore(i,o);const l=i.querySelectorAll('input[name="report-sort"]'),f=i.querySelector("#sort-warning"),m=()=>{const h=i.querySelector('input[value="alpha"]').checked;f.style.display=h&&c>0?"block":"none"};l.forEach(h=>h.addEventListener("change",m)),m(),ja.onclick=()=>{const h=[];if(s.querySelectorAll('input[type="checkbox"]:checked').forEach(b=>{h.push({id:b.dataset.colId,label:b.dataset.colLabel,type:b.dataset.colType})}),h.length===0){j("âš ï¸ Ù„Ø·ÙØ§Ù‹ Ø­Ø¯Ø§Ù‚Ù„ ÛŒÚ© Ø³ØªÙˆÙ† Ø±Ø§ Ø§Ù†ØªØ®Ø§Ø¨ Ú©Ù†ÛŒØ¯.");return}const y=i.querySelector('input[name="report-sort"]:checked').value,p=y==="alpha"&&c>0;ue(),ao(e,h,y,p)},qa.onclick=()=>{ue()},De("report-config-modal")}const Aa=document.getElementById("class-management-page"),oo=document.getElementById("open-add-class-modal-btn"),co=document.getElementById("add-class-modal"),Cn=document.getElementById("modal-new-class-name"),Ai=document.getElementById("modal-add-class-system"),Mi=document.getElementById("modal-add-class-level"),Ds=document.getElementById("confirm-add-class-btn"),Ns=document.getElementById("cancel-add-class-btn"),Ot=document.getElementById("class-list"),Ma=document.getElementById("undo-toast"),lo=document.getElementById("undo-message"),uo=document.getElementById("undo-btn"),fo=document.getElementById("settings-page"),Oa=document.getElementById("settings-class-name-header"),As=document.getElementById("settings-student-list"),Ms=document.getElementById("category-list"),mo=document.getElementById("back-to-sessions-btn"),ho=document.getElementById("new-student-name"),po=document.getElementById("add-student-btn"),Ra=document.getElementById("paste-area"),go=document.getElementById("process-paste-btn"),yo=document.getElementById("csv-preview-page"),Os=document.getElementById("csv-preview-list"),vo=document.getElementById("csv-confirm-btn"),bo=document.getElementById("csv-cancel-btn"),Co=document.getElementById("import-csv-btn"),wo=document.getElementById("csv-file-input"),Eo=document.getElementById("column-mapping-page"),Rs=document.getElementById("column-select-dropdown"),So=document.getElementById("confirm-column-btn"),_o=document.getElementById("cancel-import-btn"),zs=document.querySelector(".app-header"),it=document.getElementById("select-student-btn"),$s=document.getElementById("new-session-btn"),Lt=document.getElementById("select-student-btn-wrapper"),ko=document.getElementById("assessment-mode-label"),an=document.getElementById("category-weight-label"),Io=document.getElementById("attendance-page"),un=document.getElementById("attendance-list"),xo=document.getElementById("finish-attendance-btn"),Lo=document.querySelector("#class-management-page h2"),Ps=document.getElementById("student-stats-header"),To=document.getElementById("hamburger-menu-btn"),za=document.getElementById("side-nav-menu"),Bo=document.getElementById("close-nav-btn"),Fs=document.getElementById("overlay"),Do=document.getElementById("backup-data-btn"),No=document.getElementById("restore-data-btn"),$a=document.getElementById("restore-file-input"),Ao=document.getElementById("custom-confirm-modal"),Pa=document.getElementById("confirm-modal-message"),Hs=document.getElementById("confirm-modal-cancel-btn"),rn=document.getElementById("confirm-modal-confirm-btn"),Mo=document.getElementById("secure-confirm-modal"),Fa=document.getElementById("secure-confirm-message"),Ha=document.getElementById("secure-confirm-code"),jt=document.getElementById("secure-confirm-input"),Oo=document.getElementById("secure-confirm-cancel-btn"),$n=document.getElementById("secure-confirm-confirm-btn"),Ro=document.getElementById("add-note-modal"),ye=document.getElementById("new-note-content"),zo=document.getElementById("class-save-note-btn"),$o=document.getElementById("cancel-note-btn"),Ws=document.getElementById("student-search-input"),St=document.getElementById("student-search-results"),Po=document.getElementById("back-to-student-page-btn"),Fo=document.getElementById("graded-category-pills-container"),Ho=document.getElementById("new-score-value"),Wa=document.getElementById("new-score-comment"),Wo=document.getElementById("add-score-btn"),Uo=document.getElementById("profile-stats-summary"),jo=document.getElementById("profile-scores-list"),on=document.getElementById("global-student-search-input"),ut=document.getElementById("global-student-search-results"),qo=document.getElementById("trashed-classes-list"),Go=document.getElementById("trashed-students-list"),Zo=document.getElementById("trashed-sessions-list"),Vo=document.getElementById("trashed-categories-list"),Jo=document.getElementById("trashed-notes-list"),Ko=document.getElementById("trashed-scores-list"),Gt=document.getElementById("quick-grade-form-wrapper"),Xe=document.getElementById("quick-score-input"),je=document.getElementById("quick-note-textarea"),It=document.getElementById("quick-grade-submit-btn"),fn=document.getElementById("category-selection-container"),Yo=document.getElementById("selected-student-result"),Pt=document.getElementById("custom-context-menu"),qt=document.getElementById("breadcrumb-container"),Xo=document.getElementById("report-config-modal"),Ua=document.getElementById("report-columns-container"),ja=document.getElementById("report-print-btn"),qa=document.getElementById("report-cancel-btn");let nn=null,Vt=null;const Qo=document.getElementById("category-modal"),Ga=document.getElementById("category-modal-title"),Jt=document.getElementById("new-category-modal-name"),wn=document.getElementById("new-category-modal-is-graded"),ec=document.getElementById("category-modal-cancel-btn"),Za=document.getElementById("category-modal-save-btn"),tc=document.getElementById("mass-comment-modal"),nc=document.getElementById("mass-comment-modal-title"),Va=document.getElementById("mass-comment-student-count-message"),mn=document.getElementById("mass-comment-content"),Oi=document.getElementById("mass-comment-append-checkbox"),sc=document.getElementById("mass-comment-cancel-btn"),ic=document.getElementById("mass-comment-save-btn"),Us=document.getElementById("mass-comment-btn"),Pn=document.getElementById("attendance-mass-actions-container"),Dt=document.createElement("input"),ac=document.getElementById("session-dashboard-page"),Yt=document.getElementById("attendance-pane"),Fn=document.getElementById("settings-edu-system"),cn=document.getElementById("settings-level"),Ja=document.getElementById("modal-schedule-text"),rs=document.getElementById("modal-schedule-days"),Ka=document.getElementById("modal-schedule-start-time"),Ya=document.getElementById("modal-schedule-end-time"),ln=document.getElementById("modal-schedule-toggle"),Xa=document.getElementById("modal-schedule-content"),os=document.getElementById("new-category-modal-weight"),rc=document.getElementById("category-modal"),hn=document.getElementById("new-category-modal-weight-group"),oc=document.getElementById("open-add-category-btn");let vs=!1;function Qa(e){vs=e}function xn(e="selector"){if(!D||!K){Ee("class-management-page");return}uc(),Wn(),Re(),ot(),Ee("session-dashboard-page",{tab:e}),er(),Xt(e),fc()}function Xt(e){const s=document.getElementById("selector-tab-btn"),t=document.getElementById("attendance-tab-btn"),c=document.getElementById("selector-pane"),a=e==="selector";s.classList.toggle("active",a),t.classList.toggle("active",!a),c.classList.toggle("active",a),Yt.classList.toggle("active",!a)}function er(){const e=document.getElementById("selector-tab-btn"),s=document.getElementById("attendance-tab-btn"),t=document.getElementById("selector-pane");e.addEventListener("click",()=>{Re(),Ae(),e.classList.add("active"),s.classList.remove("active"),t.classList.add("active"),Yt.classList.remove("active"),Ee("session-dashboard-page",{tab:"selector"})}),s.addEventListener("click",()=>{ot(),s.classList.add("active"),e.classList.remove("active"),Yt.classList.add("active"),t.classList.remove("active"),Ee("session-dashboard-page",{tab:"attendance"})}),_a(s,c=>{Xt("attendance"),ot(),setTimeout(()=>{const a=document.getElementById("attendance-search-input");a&&a.focus()},100)})}function tr(){if(qn){const e=D?D.info.name:null,s=JSON.parse(qn);$t(s),e&&ie[e]?Ze(ie[e]):Ze(null),D?(Tt(),en(),Ge()):Fe(),Ma.classList.remove("show"),clearTimeout(ei),ha(null)}}function cs(e){var b;const s=document.getElementById("restore-confirm-modal"),t=document.getElementById("restore-modal-message"),c=document.getElementById("restore-append-checkbox"),a=document.querySelector('label[for="restore-append-checkbox"]'),n=document.getElementById("restore-confirm-cancel-btn"),r=document.getElementById("restore-confirm-confirm-btn"),i=document.getElementById("restore-modal-warning");i.style.display="none";const o=((b=e.metadata)==null?void 0:b.createdAt)||0;if(Be.lastRestoreTimestamp&&o<Be.lastRestoreTimestamp){const v=new Date(o).toLocaleDateString("fa-IR"),C=new Date(Be.lastRestoreTimestamp).toLocaleDateString("fa-IR");i.textContent=`âš ï¸ Ù‡Ø´Ø¯Ø§Ø±: Ø§ÛŒÙ† ÙØ§ÛŒÙ„ Ù¾Ø´ØªÛŒØ¨Ø§Ù† (${v}) Ù‚Ø¯ÛŒÙ…ÛŒâ€ŒØªØ± Ø§Ø² Ø¢Ø®Ø±ÛŒÙ† Ø¨Ø§Ø²ÛŒØ§Ø¨ÛŒ Ø´Ù…Ø§ (${C}) Ø§Ø³Øª.`,i.style.display="block"}const l=e.data.classrooms||{},f=Object.values(l).map(v=>v.info.name),m=f.length,h="Ú©Ù„Ø§Ø³",u=f.map(v=>`<li style="margin-bottom: 4px;">ðŸ”¹ ${v}</li>`).join("");t.innerHTML=`
        <div style="margin-bottom: 10px;">
            ÙØ§ÛŒÙ„ Ù¾Ø´ØªÛŒØ¨Ø§Ù† Ø´Ø§Ù…Ù„ <strong>${m} ${h}</strong> Ø²ÛŒØ± Ø§Ø³Øª:
        </div>
        <ul style="
            margin: 0; 
            padding: 10px; 
            background-color: #f8f9fa; 
            border-radius: 5px; 
            border: 1px solid #e9ecef;
            list-style: none; 
            max-height: 150px; 
            overflow-y: auto;
            text-align: right;
        ">
            ${u}
        </ul>
        <div style="margin-top: 15px;">
            Ù„Ø·ÙØ§Ù‹ Ù†Ø­ÙˆÙ‡ Ø¨Ø§Ø²ÛŒØ§Ø¨ÛŒ Ø±Ø§ Ù…Ø´Ø®Øµ Ú©Ù†ÛŒØ¯.
        </div>
    `,c.checked=!1,a&&(a.textContent="Ø¬Ø§ÛŒÚ¯Ø²ÛŒÙ†ÛŒ Ú©Ø§Ù…Ù„ (Ø­Ø°Ù Ø¯Ø§Ø¯Ù‡â€ŒÙ‡Ø§ÛŒ ÙØ¹Ù„ÛŒ)");const y=()=>{const v=c.checked;Ur(e,v),r.onclick=null,n.onclick=null,s.removeEventListener("click",y),ue(),Fe(),Ee("class-management-page"),j(`âœ… Ø§Ø·Ù„Ø§Ø¹Ø§Øª Ø¨Ø§ Ù…ÙˆÙÙ‚ÛŒØª Ø¨Ø§Ø²ÛŒØ§Ø¨ÛŒ Ø´Ø¯ (${v?"Ù¾Ø§Ú©â€ŒØ³Ø§Ø²ÛŒ Ùˆ Ø¨Ø§Ø²ÛŒØ§Ø¨ÛŒ":"Ù‡Ù…Ú¯Ø§Ù…â€ŒØ³Ø§Ø²ÛŒ Ù‡ÙˆØ´Ù…Ù†Ø¯"}).`)},p=()=>{r.onclick=null,n.onclick=null,ue()};r.onclick=y,n.onclick=p,De("restore-confirm-modal")}function js(e,s={}){const{title:t="Ø§ÛŒØ¬Ø§Ø¯ Ø¯Ø³ØªÙ‡â€ŒØ¨Ù†Ø¯ÛŒ Ø¬Ø¯ÛŒØ¯",initialName:c="",initialIsGraded:a=!1,initialWeight:n=1,saveButtonText:r="Ø°Ø®ÛŒØ±Ù‡"}=s;Ga.textContent=t,Jt.value=c,wn.checked=a,_n(),os.value=n,Za.textContent=r,vn((i,o)=>{const l=parseFloat(os.value)||1;if(!i){j("âš ï¸ Ù„Ø·ÙØ§Ù‹ Ù†Ø§Ù… Ø¯Ø³ØªÙ‡â€ŒØ¨Ù†Ø¯ÛŒ Ø±Ø§ ÙˆØ§Ø±Ø¯ Ú©Ù†ÛŒØ¯.");return}e(i,o,l),ue()}),De("category-modal"),Jt.focus(),c&&Jt.select()}function Ri(e,s){const t=Object.values(ie).filter(r=>!r.isDeleted&&r.info.name!==s.info.name),c=document.getElementById("move-student-modal-title"),a=document.getElementById("move-student-class-select"),n=document.getElementById("move-student-confirm-btn");c.textContent=`Ø§Ù†ØªÙ‚Ø§Ù„ Ø¯Ø§Ù†Ø´â€ŒØ¢Ù…ÙˆØ²: ${e.identity.name}`,a.innerHTML="",t.length===0?(a.innerHTML='<option value="">Ú©Ù„Ø§Ø³ Ø¯ÛŒÚ¯Ø±ÛŒ Ø¨Ø±Ø§ÛŒ Ø§Ù†ØªÙ‚Ø§Ù„ ÙˆØ¬ÙˆØ¯ Ù†Ø¯Ø§Ø±Ø¯</option>',n.disabled=!0):(t.forEach(r=>{const i=document.createElement("option");i.value=r.info.name,i.textContent=r.info.name,a.appendChild(i)}),n.disabled=!1),va(e),ba(s),De("move-student-modal")}function zi(e,s){if(!e||!s)return;const t=e.identity.name,c=e.identity.firstName||"";e.identity.lastName;const a=document.getElementById("add-note-modal-title");a.textContent="ØªØºÛŒÛŒØ± Ù†Ø§Ù… Ø¯Ø§Ù†Ø´â€Œ Ø¢Ù…ÙˆØ²";const n=e.identity.firstName&&e.identity.lastName?`${e.identity.firstName} . ${e.identity.lastName}`:t;ye.value=n,ye.rows=1,ye.dispatchEvent(new Event("input",{bubbles:!0})),dt(r=>{const i=r.indexOf(".");if(i<=0||i>=r.length-1)return j("Ù„Ø·ÙØ§ Ù†Ø§Ù… Ùˆ Ù†Ø§Ù… Ø®Ø§Ù†ÙˆØ§Ø¯Ú¯ÛŒ Ø´Ø®Øµ Ø±Ø§ Ø¨Ø§ ÛŒÚ© Ù†Ù‚Ø·Ù‡ Ø§Ø² Ù‡Ù… Ø¬Ø¯Ø§ Ú©Ù†ÛŒØ¯. Ù…Ø«Ø§Ù„: Ø¹Ù„ÛŒ . Ø§Ø­Ù…Ø¯ÛŒ"),!1;const o=Zt(r),l=o.name,f=o.firstName||"";if(e.identity.firstName&&e.identity.lastName&&!o.firstName)return j("âš ï¸ Ø§ÛŒÙ† Ø¯Ø§Ù†Ø´â€ŒØ¢Ù…ÙˆØ² Ø¯Ø§Ø±Ø§ÛŒ Ù†Ø§Ù… Ùˆ Ù†Ø§Ù…â€ŒØ®Ø§Ù†ÙˆØ§Ø¯Ú¯ÛŒ ØªÙÚ©ÛŒÚ© Ø´Ø¯Ù‡ Ø§Ø³Øª. Ù„Ø·ÙØ§Ù‹ Ø­ØªÙ…Ø§Ù‹ Ø§Ø² Ù†Ù‚Ø·Ù‡ (.) Ø¨ÛŒÙ† Ù†Ø§Ù… Ùˆ Ù†Ø§Ù…â€ŒØ®Ø§Ù†ÙˆØ§Ø¯Ú¯ÛŒ Ø§Ø³ØªÙØ§Ø¯Ù‡ Ú©Ù†ÛŒØ¯."),!1;if(l&&(l!==t||f!==c)){if(ge(s.students).some(p=>p.identity.studentId!==e.identity.studentId&&p.identity.name.toLowerCase()===l.toLowerCase()))return j("Ø¯Ø§Ù†Ø´â€ŒØ¢Ù…ÙˆØ²ÛŒ Ø¨Ø§ Ø§ÛŒÙ† Ù†Ø§Ù… Ø§Ø² Ù‚Ø¨Ù„ Ø¯Ø± Ø§ÛŒÙ† Ú©Ù„Ø§Ø³ ÙˆØ¬ÙˆØ¯ Ø¯Ø§Ø±Ø¯."),!1;{e.identity.name=l,e.identity.firstName=o.firstName,e.identity.lastName=o.lastName,be(s.info.name,`Ù†Ø§Ù… Ø¯Ø§Ù†Ø´â€ŒØ¢Ù…ÙˆØ² Â«${t}Â» Ø¨Ù‡ Â«${l}Â» ØªØºÛŒÛŒØ± ÛŒØ§ÙØª.`,{type:"VIEW_STUDENT_PROFILE",studentId:e.identity.studentId}),se(),Tt(),Re(),ot(),Ae(),Se&&Se.identity.studentId===e.identity.studentId&&We(e);const p=document.querySelector(`#settings-student-list li[data-student-id="${e.identity.studentId}"]`);p&&(p.classList.add("recently-updated"),setTimeout(()=>{p&&p.classList.remove("recently-updated")},1e4),p.scrollIntoView({behavior:"smooth",block:"center"})),j(`âœ… Ù†Ø§Ù… Ø¯Ø§Ù†Ø´â€ŒØ¢Ù…ÙˆØ² Ø¨Ù‡ Â«${l}Â» ØªØºÛŒÛŒØ± ÛŒØ§ÙØª.`)}}else if(!l)return j("âš ï¸ Ù†Ø§Ù… Ù†Ù…ÛŒâ€ŒØªÙˆØ§Ù†Ø¯ Ø®Ø§Ù„ÛŒ Ø¨Ø§Ø´Ø¯."),!1;const u=document.getElementById("add-note-modal-title");u.textContent="Ø«Ø¨Øª ÛŒØ§Ø¯Ø¯Ø§Ø´Øª Ø¬Ø¯ÛŒØ¯",ye.rows=4}),De("add-note-modal"),ye.focus(),ye.select()}function De(e){const s=document.getElementById(e);if(s){if(yt)return;s.classList.add("modal-visible"),wi(e),document.body.style.overflow="hidden",history.pushState(null,"",location.href)}}function ue(e,s=!1){if(document.body.style.overflow="auto",!yt)return;fi(!0);const t=document.getElementById(yt),c=yt;wi(null),c==="student-profile-modal"&&kt(null),s||history.back(),t&&(t.classList.add("modal-closing"),setTimeout(()=>{t.classList.remove("modal-visible"),t.classList.remove("modal-closing"),c==="custom-confirm-modal"&&(bi(null),Ci(null)),c==="secure-confirm-modal"&&yn(null),c==="category-modal"&&vn(null),c==="mass-comment-modal"&&(mn.value=""),c==="add-note-modal"&&dt(null),typeof e=="function"&&e()},300))}function $i(){if(!Yt||!Yt.classList.contains("active")){Pn.style.display="none";return}const e=zt.length;e<1?Pn.style.display="none":Pn.style.display="block",Us.disabled=e<1,Us.textContent=`ðŸ“ Ø«Ø¨Øª ÛŒØ§Ø¯Ø¯Ø§Ø´Øª Ú¯Ø±ÙˆÙ‡ÛŒ (${e} Ù†ÙØ±)`}function Pi(){const e=zt,s=e.length;let t=!1;s>0&&(t=e.some(a=>{var n;return(n=K.studentRecords[a])==null?void 0:n.homework.comment})),Va.textContent=`ÛŒØ§Ø¯Ø¯Ø§Ø´Øª Ø¨Ø±Ø§ÛŒ ${s} Ø¯Ø§Ù†Ø´â€ŒØ¢Ù…ÙˆØ² Ø«Ø¨Øª Ø®ÙˆØ§Ù‡Ø¯ Ø´Ø¯.`,mn.value="",mn.dispatchEvent(new Event("input",{bubbles:!0})),Oi.checked=!0;const c=document.querySelector("#mass-comment-modal .modal-options");c.style.display=t?"flex":"none",De("mass-comment-modal"),mn.focus()}function qs(e,s){if(!D||!K)return;let t=0;const c=zt,a=K;c.forEach(n=>{const r=a.studentRecords[n];if(r&&r.homework){const i=r.homework.comment||"";let o=e;s&&i.length>0?o=i+`
---
`+e:o=e,r.homework.comment=o.trim();const l=D.students.find(f=>f.identity.studentId===n);l&&cc(l,a,o.trim()),t++}}),bn([]),se(),ot(),be(D.info.name,`${t} Ø¯Ø§Ù†Ø´â€ŒØ¢Ù…ÙˆØ² Ø¨Ù‡ ØµÙˆØ±Øª Ú¯Ø±ÙˆÙ‡ÛŒ ÛŒØ§Ø¯Ø¯Ø§Ø´Øª ØªÚ©Ù„ÛŒÙ Ú¯Ø±ÙØªÙ†Ø¯.`,{type:"VIEW_SESSIONS"}),j(`âœ… ÛŒØ§Ø¯Ø¯Ø§Ø´Øª Ø¨Ø±Ø§ÛŒ ${t} Ø¯Ø§Ù†Ø´â€ŒØ¢Ù…ÙˆØ² Ø«Ø¨Øª Ø´Ø¯.`)}function cc(e,s,t){const a=lt(D).get(s.sessionNumber),n={type:"fromAttendance",sessionNumber:s.sessionNumber},r=`ÛŒØ§Ø¯Ø¯Ø§Ø´Øª Ø¬Ù„Ø³Ù‡ ${a}:
`,i=e.profile.notes.find(o=>!o.isDeleted&&o.source&&o.source.type==="fromAttendance"&&o.source.sessionNumber===n.sessionNumber);i?t?(i.content=r+t,i.isDeleted=!1):i.isDeleted=!0:t&&e.addNote(r+t,n)}function bs(e){ye.value=e.note||"",dt(s=>{e.note=s,se(),be(e.info.name,"ÛŒØ§Ø¯Ø¯Ø§Ø´Øª Ú©Ù„Ø§Ø³ Ø°Ø®ÛŒØ±Ù‡ Ø´Ø¯.",{type:"VIEW_CLASS_NOTE"}),Fe(),j("âœ… ÛŒØ§Ø¯Ø¯Ø§Ø´Øª Ú©Ù„Ø§Ø³ Ø°Ø®ÛŒØ±Ù‡ Ø´Ø¯.")}),De("add-note-modal"),ye.focus()}function Fi(e,s){ye.value=e.note||"",ye.dispatchEvent(new Event("input",{bubbles:!0})),dt(t=>{e.note=t,se(),be(D.info.name,`ÛŒØ§Ø¯Ø¯Ø§Ø´Øª Ø¬Ù„Ø³Ù‡ ${s} Ø°Ø®ÛŒØ±Ù‡ Ø´Ø¯.`,{type:"VIEW_SESSIONS"}),Ge(),j("âœ…ÛŒØ§Ø¯Ø¯Ø§Ø´Øª Ø¬Ù„Ø³Ù‡ Ø°Ø®ÛŒØ±Ù‡ Ø´Ø¯.")}),De("add-note-modal"),ye.focus()}function xt(e){Ze(e),Oa.textContent=`ØªÙ†Ø¸ÛŒÙ…Ø§Øª Ú©Ù„Ø§Ø³: ${e.info.name}`,Tt(),en(),lr(),Ee("settings-page")}function nr(e){const s=document.getElementById("log-modal-title"),t=document.getElementById("log-list");s.textContent=`Ú¯Ø²Ø§Ø±Ø´ ÙØ¹Ø§Ù„ÛŒØªâ€ŒÙ‡Ø§ÛŒ Ú©Ù„Ø§Ø³: ${e}`,t.innerHTML="";const c=Qr(e);c.length===0?t.innerHTML='<li class="no-content-message">Ù‡Ù†ÙˆØ² ÙØ¹Ø§Ù„ÛŒØªÛŒ Ø¨Ø±Ø§ÛŒ Ø§ÛŒÙ† Ú©Ù„Ø§Ø³ Ø«Ø¨Øª Ù†Ø´Ø¯Ù‡ Ø§Ø³Øª.</li>':c.forEach(a=>{const n=document.createElement("li");n.className="log-entry";const r=new Date(a.timestamp),i=`${r.toLocaleDateString("fa-IR")} - ${r.toLocaleTimeString("fa-IR",{hour:"2-digit",minute:"2-digit"})}`,o=document.createElement("span");o.className="log-timestamp",o.textContent=i;const l=document.createElement("span");l.className="log-message",l.textContent=a.message,a.action&&(l.classList.add("log-action-link"),l.dataset.action=JSON.stringify({...a.action,classroomName:a.classroomName})),n.appendChild(o),n.appendChild(l),t.appendChild(n)}),De("log-modal")}document.getElementById("log-modal-close-btn").addEventListener("click",()=>{ue()});function Gs(e,s){e.preventDefault(),Rt(),Vt=e.target.closest("li"),Vt&&Vt.classList.add("context-menu-target"),setTimeout(()=>{const t=Pt,c=t.querySelector("ul");c.innerHTML="",s.forEach(l=>{const f=document.createElement("li");l.isSeparator?f.className="separator":(f.innerHTML=`
                    <span class="icon">${l.icon||""}</span>
                    <span class="label">${l.label}</span>
                `,l.className&&f.classList.add(l.className),f.addEventListener("click",()=>{l.action(),Rt()})),c.appendChild(f)}),t.classList.add("visible");const{offsetWidth:a,offsetHeight:n}=t,{innerHeight:r}=window,i=document.body.getBoundingClientRect();t.style.top=`${(r-n)/2}px`;const o=i.left+i.width/2;t.style.left=`${o-a/2}px`},50)}function Rt(){Pt.classList.contains("visible")&&Pt.classList.remove("visible"),Vt&&(Vt.classList.remove("context-menu-target"),Vt=null)}function sr(){var t;qt.innerHTML="";const e=document.getElementById("header-settings-btn");if(!e)return;const s=[];if(s.push({label:"Ú©Ù„Ø§Ø³â€ŒÙ‡Ø§",handler:()=>{Ze(null),rt(null),kt(null),Ee("class-management-page")}}),D){s.push({label:D.info.name,handler:()=>{rt(null),kt(null),Ge(),Ee("session-page")}});const c=(t=document.querySelector(".page.active"))==null?void 0:t.id;if(c==="session-page"?e.style.visibility="visible":e.style.visibility="hidden",c==="settings-page")s.push({label:"ØªÙ†Ø¸ÛŒÙ…Ø§Øª"});else if(K){const n=lt(D).get(K.sessionNumber)||` (#${K.sessionNumber})`;s.push({label:`Ø¬Ù„Ø³Ù‡ ${n}`,handler:()=>{kt(null),xn("selector")}}),Se&&s.push({label:`Ù¾Ø±ÙˆÙØ§ÛŒÙ„: ${Se.identity.name}`})}}else e.style.visibility="hidden";if(s.length<=1){qt.style.display="none";return}qt.style.display="flex",s.forEach((c,a)=>{const n=document.createElement("a");if(n.textContent=c.label,n.className="breadcrumb-item",a===s.length-1||!c.handler?n.classList.add("active"):n.addEventListener("click",c.handler),qt.appendChild(n),a<s.length-1){const r=document.createElement("span");r.className="breadcrumb-separator",r.textContent="/",qt.appendChild(r)}})}function Ji(e,s,t){t.innerHTML="";const c=D.sessions.filter(a=>{var n;return!a.isDeleted&&!a.isCancelled&&((n=a.studentRecords[e.identity.studentId])==null?void 0:n.attendance)==="absent"}).map(a=>({number:s.get(a.sessionNumber),isMakeup:a.isMakeup})).filter(a=>a.number!==void 0);c.length>0?(t.appendChild(document.createTextNode("Ø¬Ù„Ø³Ø§Øª ØºØ§ÛŒØ¨: ")),c.forEach((a,n)=>{const r=document.createElement("span");r.textContent=a.number,a.isMakeup&&r.classList.add("makeup-absence"),t.appendChild(r),n<c.length-1&&t.appendChild(document.createTextNode("ØŒ "))})):t.textContent="Ø¬Ù„Ø³Ø§Øª ØºØ§ÛŒØ¨: Ø¨Ø¯ÙˆÙ† ØºÛŒØ¨Øª"}function Hn(e,s,t,c={}){const{includePrefix:a=!0}=c;t.innerHTML="";const n=D.sessions.filter(r=>{if(r.isDeleted||r.isCancelled)return!1;const i=r.studentRecords[e.identity.studentId];return i&&i.homework&&(i.homework.status==="incomplete"||i.homework.status==="none")}).map(r=>({number:s.get(r.sessionNumber),status:r.studentRecords[e.identity.studentId].homework.status})).filter(r=>r.number!==void 0);n.length>0?(a&&t.appendChild(document.createTextNode("ØªÚ©Ø§Ù„ÛŒÙ Ù†Ø§Ù‚Øµ: ")),n.forEach((r,i)=>{const o=document.createElement("span");o.textContent=r.number,r.status==="incomplete"&&o.classList.add("incomplete-homework"),t.appendChild(o),i<n.length-1&&t.appendChild(document.createTextNode("ØŒ"))})):a?t.textContent="ØªÚ©Ø§Ù„ÛŒÙ Ù†Ø§Ù‚Øµ: Ù†Ø¯Ø§Ø±Ø¯":t.textContent="Ù†Ø¯Ø§Ø±Ø¯"}function lc(e,s){var L,B,M;const t=document.createElement("li");t.className="attendance-list-item";const c=document.createElement("span");c.className="absence-info";const a=document.createElement("span");a.className="homework-info";const n=document.createElement("div");n.className="att-row-1";let r=!1;n.addEventListener("mousedown",()=>r=!1),n.addEventListener("touchstart",()=>r=!1,{passive:!0});const i=document.createElement("input");i.type="checkbox",i.className="mass-comment-checkbox",i.checked=zt.includes(e.identity.studentId),i.addEventListener("change",()=>{const W=e.identity.studentId,Q=zt;if(i.checked)Q.includes(W)||Q.push(W);else{const z=Q.indexOf(W);z>-1&&Q.splice(z,1)}$i();const I=document.getElementById("attendance-list");Q.length===0&&I.classList.contains("selection-mode-active")&&I.classList.remove("selection-mode-active")});const o=document.createElement("span");o.className="student-name",o.textContent=e.identity.firstName&&e.identity.lastName?`${e.identity.lastName}ØŒ ${e.identity.firstName}`:e.identity.name,o.addEventListener("click",W=>{if(r){W.stopPropagation(),W.preventDefault(),r=!1;return}We(e)}),Mt(n,W=>{r=!0;const Q=document.getElementById("attendance-list");Q.classList.contains("selection-mode-active")||Q.classList.add("selection-mode-active"),i.checked||(i.checked=!0,i.dispatchEvent(new Event("change")))}),n.appendChild(i),n.appendChild(o);const l=document.createElement("div");l.className="att-row-2";const f=document.createElement("button");let m=!1;f.addEventListener("mousedown",()=>m=!1),f.addEventListener("touchstart",()=>m=!1,{passive:!0});const h=((L=K.studentRecords[e.identity.studentId])==null?void 0:L.attendance)||"present",u=W=>{W==="present"?(f.textContent="Ø­Ø§Ø¶Ø±",f.className="attendance-status-btn present active"):(f.textContent="ØºØ§ÛŒØ¨",f.className="attendance-status-btn absent active")};u(h),f.addEventListener("click",W=>{var z;if(m){W.stopPropagation();return}const I=(((z=K.studentRecords[e.identity.studentId])==null?void 0:z.attendance)||"present")==="present"?"absent":"present";K.setAttendance(e.identity.studentId,I),I==="absent"&&(K.studentRecords[e.identity.studentId].hadIssue=!1),se(),u(I),Ji(e,s,c),Re(),dr()}),Mt(f,()=>{m=!0;const W=h==="present"?"absent":"present",Q=W==="present"?"Ø­Ø§Ø¶Ø±":"ØºØ§ÛŒØ¨";he(`Ø¢ÛŒØ§ Ù…Ø·Ù…Ø¦Ù† Ù‡Ø³ØªÛŒØ¯ Ú©Ù‡ Ù…ÛŒâ€ŒØ®ÙˆØ§Ù‡ÛŒØ¯ ÙˆØ¶Ø¹ÛŒØª Ø­Ø¶ÙˆØ± ØªÙ…Ø§Ù… Ø¯Ø§Ù†Ø´â€ŒØ¢Ù…ÙˆØ²Ø§Ù† Ø±Ø§ Ø¨Ù‡ Â«${Q}Â» ØªØºÛŒÛŒØ± Ø¯Ù‡ÛŒØ¯ØŸ`,()=>{ge(D.students).forEach(I=>{K.setAttendance(I.identity.studentId,W),W==="absent"&&(K.studentRecords[I.identity.studentId].hadIssue=!1)}),se(),ot(),j(`âœ… ÙˆØ¶Ø¹ÛŒØª ØªÙ…Ø§Ù… Ø¯Ø§Ù†Ø´â€ŒØ¢Ù…ÙˆØ²Ø§Ù† Ø¨Ù‡ Â«${Q}Â» ØªØºÛŒÛŒØ± ÛŒØ§ÙØª.`)},{confirmText:"Ø¨Ù„Ù‡ØŒ Ø§Ø¹Ù…Ø§Ù„ Ú©Ù†",confirmClass:"btn-warning"})});const y=document.createElement("div");y.className="homework-controls";const p={none:"Ø¨Ø¯ÙˆÙ† ØªÚ©Ù„ÛŒÙ",complete:"ØªÚ©Ù„ÛŒÙ Ú©Ø§Ù…Ù„",incomplete:"ØªÚ©Ù„ÛŒÙ Ù†Ø§Ù‚Øµ"},b=document.createElement("button");let v=!1;b.addEventListener("mousedown",()=>v=!1),b.addEventListener("touchstart",()=>v=!1,{passive:!0});const C=((B=K.studentRecords[e.identity.studentId])==null?void 0:B.homework.status)||"none";b.className=`homework-status-btn ${C}`,b.title=p[C],b.addEventListener("click",W=>{if(v){W.stopPropagation();return}const Q=K.studentRecords[e.identity.studentId].homework,z={none:"incomplete",incomplete:"complete",complete:"none"}[Q.status];K.setHomeworkStatus(e.identity.studentId,z),se(),b.className=`homework-status-btn ${z}`,b.title=p[z],Hn(e,s,a)}),Mt(b,()=>{v=!0;const Q={none:"incomplete",incomplete:"complete",complete:"none"}[C],I=p[Q];he(`Ø¢ÛŒØ§ Ø§Ø² ØªØºÛŒÛŒØ± ÙˆØ¶Ø¹ÛŒØª ØªÚ©Ù„ÛŒÙ ØªÙ…Ø§Ù… Ø¯Ø§Ù†Ø´â€ŒØ¢Ù…ÙˆØ²Ø§Ù† Ø¨Ù‡ Â«${I}Â» Ù…Ø·Ù…Ø¦Ù† Ù‡Ø³ØªÛŒØ¯ØŸ`,()=>{ge(D.students).forEach(z=>{K.setHomeworkStatus(z.identity.studentId,Q)}),se(),ot(),j(`âœ… ÙˆØ¶Ø¹ÛŒØª ØªÚ©Ù„ÛŒÙ Ù‡Ù…Ù‡ Ø¨Ù‡ Â«${I}Â» ØªØºÛŒÛŒØ± ÛŒØ§ÙØª.`)},{confirmText:"Ø¨Ù„Ù‡",confirmClass:"btn-warning"})});const S=document.createElement("button");let _=!1;S.addEventListener("mousedown",()=>_=!1),S.addEventListener("touchstart",()=>_=!1,{passive:!0}),S.className="btn-icon",S.innerHTML="ðŸ“",S.title="Ø§ÙØ²ÙˆØ¯Ù† ÛŒØ§Ø¯Ø¯Ø§Ø´Øª Ø¨Ø±Ø§ÛŒ ØªÚ©Ù„ÛŒÙ",((M=K.studentRecords[e.identity.studentId])==null?void 0:M.homework.comment)||(S.style.opacity="0.3"),S.addEventListener("click",W=>{if(_){W.stopPropagation();return}const Q=K.studentRecords[e.identity.studentId].homework;ye.value=Q.comment||"",ye.dispatchEvent(new Event("input",{bubbles:!0})),dt(I=>{Q.comment=I;const z=lt(D),g=z.get(K.sessionNumber),F={type:"fromAttendance",sessionNumber:K.sessionNumber},re=`ÛŒØ§Ø¯Ø¯Ø§Ø´Øª Ø¬Ù„Ø³Ù‡ ${g}:
`,G=e.profile.notes.find(de=>!de.isDeleted&&de.source&&de.source.type==="fromAttendance"&&de.source.sessionNumber===F.sessionNumber);G?I?G.content=re+I:G.isDeleted=!0:I&&e.addNote(re+I,F),se(),j("âœ…ÛŒØ§Ø¯Ø¯Ø§Ø´Øª ØªÚ©Ù„ÛŒÙ Ø°Ø®ÛŒØ±Ù‡ Ø´Ø¯."),S.style.opacity=I?"1":"0.3",Hn(e,z,a)}),De("add-note-modal"),ye.focus()}),Mt(S,()=>{_=!0,he("Ø¢ÛŒØ§ Ù…ÛŒâ€ŒØ®ÙˆØ§Ù‡ÛŒØ¯ Ø¨Ø±Ø§ÛŒ **ØªÙ…Ø§Ù…** Ø¯Ø§Ù†Ø´â€ŒØ¢Ù…ÙˆØ²Ø§Ù† Ú©Ù„Ø§Ø³ ÛŒØ§Ø¯Ø¯Ø§Ø´Øª ØªÚ©Ù„ÛŒÙ Ø«Ø¨Øª Ú©Ù†ÛŒØ¯ØŸ",()=>{const W=ge(D.students).map(Q=>Q.identity.studentId);bn(W),Pi()},{confirmText:"Ø¨Ù„Ù‡",confirmClass:"btn-primary"})}),l.appendChild(f),y.appendChild(S),y.appendChild(b),l.appendChild(y);const x=document.createElement("div");return x.className="att-row-3",Ji(e,s,c),Hn(e,s,a),x.appendChild(c),x.appendChild(a),t.appendChild(n),t.appendChild(l),t.appendChild(x),t}function dc(){return lt(D).get(K.sessionNumber)}function ot(){const e=ge(D.students),s=kn(e);if(!D||!K)return;s.forEach(r=>{K.initializeStudentRecord(r.identity.studentId)}),bn([]);const t=lt(D);wc(),un.innerHTML="";const c=document.createElement("li");c.className="attendance-list-header",Dt.id="attendance-search-input",Dt.type="text",Dt.className="inline-search-input",Dt.placeholder="Ø¬Ø³ØªØ¬Ùˆ...",Dt.value="";const a=document.createElement("div");a.className="student-search-container",a.appendChild(Dt);const n=document.createElement("div");n.className="header-labels-container",n.innerHTML=`
    <span class="header-label">ØªÚ©Ù„ÛŒÙ</span>
    <span class="header-label">Ø­Ø¶ÙˆØ±</span>
`,c.appendChild(a),c.appendChild(n),un.appendChild(c),s.forEach(r=>{const i=lc(r,t);un.appendChild(i)}),bn([]),$i(),Ec(),dr()}function Re(){const e=document.getElementById("student-stats-table-container");if(!e||(e.innerHTML="",!D))return;ge(D.students).length,Ps.textContent="Ø¢Ù…Ø§Ø± Ø¹Ù…Ù„Ú©Ø±Ø¯";const s=["Ù†Ø§Ù…"],t=["Ú©Ù„ Ø§Ù†ØªØ®Ø§Ø¨ Ù‡Ø§","ØºÛŒØ¨Øª","Ø®Ø±ÙˆØ¬","ÙØ±ØµØª Ø§Ø²Ø¯Ø³Øªâ€ŒØ±ÙØªÙ‡","Ù…Ø´Ú©Ù„","Ù…ÛŒØ§Ù†Ú¯ÛŒÙ†","Ù†Ù…Ø±Ù‡ Ù†Ù‡Ø§ÛŒÛŒ"],c=D.categories.filter(u=>u.isGradedCategory&&!u.isDeleted).map(u=>u.name),a=[...s,...c,...t],n=document.createElement("table");n.className="student-stats-table";const i=n.createTHead().insertRow();a.forEach((u,y)=>{const p=document.createElement("th");y===0?(p.innerHTML=`${u} <span style="opacity: 0.6;">ðŸ”—</span>`,p.title="Ø±Ø¯ÛŒÙâ€ŒÙ‡Ø§ÛŒ Ø§ÛŒÙ† Ø³ØªÙˆÙ† Ù‚Ø§Ø¨Ù„ Ú©Ù„ÛŒÚ© Ù‡Ø³ØªÙ†Ø¯"):p.textContent=u,i.appendChild(p)});const o=n.createTBody(),l=kn(ge(D.students)),f=u=>{let y=0;return D.sessions.forEach(p=>{if(p.isDeleted||p.isCancelled)return;const b=p.studentRecords[u.identity.studentId];b&&b.attendance==="absent"&&y++}),y};l.forEach(u=>{const y=o.insertRow();if(y.dataset.studentId=u.identity.studentId,K){const _=K.studentRecords[u.identity.studentId];_&&_.attendance==="absent"&&y.classList.add("absent-row-highlight")}const p=y.insertCell(),b=document.createElement("span");b.textContent=`${u.identity.lastName}ØŒ ${u.identity.firstName}`,b.className="student-name-link",b.addEventListener("click",()=>{We(u)}),p.appendChild(b),c.forEach(_=>{var B;const k=y.insertCell();k.style.direction="ltr";const x=_.toLowerCase(),L=((B=u.logs.scores[x])==null?void 0:B.filter(M=>!M.isDeleted))||[];L.length>0?L.forEach((M,W)=>{const Q=document.createElement("span");Q.textContent=M.value+(M.comment?"'":""),Q.style.position="relative",M.comment&&(Q.dataset.tooltip=M.comment),k.appendChild(Q),W<L.length-1&&k.appendChild(document.createTextNode(","))}):k.textContent="",k.style.cursor="pointer",k.addEventListener("click",()=>{Ae(u,_);const M=document.getElementById("category-selection-container");M&&M.scrollIntoView({behavior:"smooth",block:"center"})})}),y.insertCell().textContent=u.statusCounters.totalSelections||0,y.insertCell().textContent=f(u),y.insertCell().textContent=u.statusCounters.outOfClassCount||0,y.insertCell().textContent=u.statusCounters.missedChances||0;const v=Object.values(u.categoryIssues||{}).reduce((_,k)=>_+k,0);y.insertCell().textContent=v;const C=u.getOverallAverageScore((D==null?void 0:D.categories)||[]);y.insertCell().textContent=C!==null?C:"-";const S=D.calculateFinalStudentScore(u);y.insertCell().textContent=S!==null?S:"-"}),ge(D.students),Ps.setAttribute("data-student-count",l.length.toString()),e.appendChild(n);const m=e.querySelector(".student-stats-table"),h=m==null?void 0:m.querySelector("thead th:first-child");h&&h.addEventListener("click",()=>{m.classList.toggle("name-column-expanded")})}function vt(){const e=document.getElementById("selected-student-result");e&&(e.innerHTML="",e.classList.remove("absent"),hs(null))}function Ae(e=null,s=null){vt();const t=kc(e,s);if(!t)return;const{winner:c,categoryName:a}=t;Ic(c,a);const n=document.getElementById("selected-student-result"),r=!e,i=K.studentRecords[c.identity.studentId],{nameContainer:o}=xc(c,a,r);n.appendChild(o);const l=Lc(c,i,a);if(n.appendChild(l),a&&typeof Ki=="function"){const m=Ki(c,a);m&&n.appendChild(m)}const f=Tc(c);n.appendChild(f)}function uc(){ws(),Hi(null),fn.innerHTML="",vt(),Gt.classList.add("tooltip-container"),Xe.disabled=!0,je.disabled=!0,It.disabled=!0,Xe.value="",je.value="",Lt.classList.add("disabled-wrapper"),it.disabled=!0}function Wn(){fn.innerHTML="",D.categories.filter(t=>!t.isDeleted).forEach(t=>{const c=document.createElement("span");c.className="pill",c.textContent=t.name,c.dataset.categoryId=t.id,t.description&&(c.dataset.tooltip=t.description),K.isFinished?c.classList.add("disabled"):c.addEventListener("click",()=>{if(di(!1),ws(),document.querySelectorAll("#category-selection-container .pill").forEach(n=>n.classList.remove("active")),c.classList.add("active"),!t.isGradedCategory&&ht){vs=!0,qi(),vt();return}ir(t,c),Qn(t),Hi(t),Zs(t),En(t),Qt(t.name),Lt.classList.remove("disabled-wrapper"),it.disabled=K.isFinished;const a=K.lastWinnerByCategory[t.name];if(a){const n=D.students.find(r=>r.identity.studentId===a);n&&Ae(n,t.name)}else{vt(),Kt(null),Ct(-1),it.disabled=!1;const n=document.querySelector(".current-winner-highlight");n&&n.classList.remove("current-winner-highlight")}}),K.isFinished||In(c,()=>[{label:"ÙˆÛŒØ±Ø§ÛŒØ´",icon:"âœï¸",action:()=>{_n(),js((a,n,r)=>{const i=da(D,t,a);i.success?(t.isGradedCategory=n,t.weight=r,se(),be(D.info.name,`Ù†Ø§Ù… Ø¯Ø³ØªÙ‡â€ŒØ¨Ù†Ø¯ÛŒ Â«${t.name}Â» Ø¨Ù‡ Â«${a}Â» ØªØºÛŒÛŒØ± ÛŒØ§ÙØª.`),Wn(),Re(),Zs(t),j(`âœ… Ù†Ø§Ù… Ø¯Ø³ØªÙ‡â€ŒØ¨Ù†Ø¯ÛŒ Ø¨Ù‡ Â«${a}Â» ØªØºÛŒÛŒØ± ÛŒØ§ÙØª.`)):j(`âš ï¸ ${i.message}`)},{title:"ÙˆÛŒØ±Ø§ÛŒØ´ Ø¯Ø³ØªÙ‡â€ŒØ¨Ù†Ø¯ÛŒ",initialName:t.name,initialIsGraded:t.isGradedCategory,initialWeight:t.weight||1,saveButtonText:"Ø°Ø®ÛŒØ±Ù‡ ØªØºÛŒÛŒØ±Ø§Øª"})}},{label:"Ø­Ø°Ù Ø¯Ø³ØªÙ‡â€ŒØ¨Ù†Ø¯ÛŒ",icon:"ðŸ—‘ï¸",className:"danger",action:()=>{he(`Ø¢ÛŒØ§ Ø§Ø² Ø§Ù†ØªÙ‚Ø§Ù„ Ø¯Ø³ØªÙ‡â€ŒØ¨Ù†Ø¯ÛŒ Â«${t.name}Â» Ø¨Ù‡ Ø³Ø·Ù„ Ø²Ø¨Ø§Ù„Ù‡ Ù…Ø·Ù…Ø¦Ù† Ù‡Ø³ØªÛŒØ¯ØŸ`,()=>{const a={id:`trash_${Date.now()}_${Math.random()}`,timestamp:new Date().toISOString(),type:"category",description:`Ø¯Ø³ØªÙ‡â€ŒØ¨Ù†Ø¯ÛŒ Â«${t.name}Â» Ø§Ø² Ú©Ù„Ø§Ø³ Â«${D.info.name}Â»`,restoreData:{categoryId:t.id,classId:D.info.scheduleCode}};ct(a);const n=t.name.toLowerCase();if(D.students.forEach(r=>{var i;(i=r.logs.scores)!=null&&i[n]&&r.logs.scores[n].forEach(o=>o.isDeleted=!0)}),(Le==null?void 0:Le.id)===t.id){Qn(null),vt(),En(null),Qt(null),Lt.classList.add("disabled-wrapper"),it.disabled=!0;const r=document.querySelector(".current-winner-highlight");r&&r.classList.remove("current-winner-highlight")}t.isDeleted=!0,be(D.info.name,`Ø¯Ø³ØªÙ‡â€ŒØ¨Ù†Ø¯ÛŒ Â«${t.name}Â» Ø¨Ù‡ Ø³Ø·Ù„ Ø²Ø¨Ø§Ù„Ù‡ Ù…Ù†ØªÙ‚Ù„ Ø´Ø¯.`,{type:"VIEW_TRASH"}),se(),Wn(),Re(),j(`âœ… Ø¯Ø³ØªÙ‡â€ŒØ¨Ù†Ø¯ÛŒ Â«${t.name}Â» Ø¨Ù‡ Ø³Ø·Ù„ Ø²Ø¨Ø§Ù„Ù‡ Ù…Ù†ØªÙ‚Ù„ Ø´Ø¯.`)},{confirmText:"Ø¨Ù„Ù‡",confirmClass:"btn-warning"})}}]),fn.appendChild(c)});const s=document.createElement("span");s.className="pill add-category-pill",s.textContent="+",s.title="Ø§ÙØ²ÙˆØ¯Ù† Ø¯Ø³ØªÙ‡â€ŒØ¨Ù†Ø¯ÛŒ Ø¬Ø¯ÛŒØ¯",K.isFinished?s.classList.add("disabled"):s.addEventListener("click",()=>{_n(),js((t,c,a)=>{if(D.categories.find(i=>i.name.toLowerCase()===t.toLowerCase()&&!i.isDeleted)){j("âš ï¸ Ø§ÛŒÙ† Ø¯Ø³ØªÙ‡â€ŒØ¨Ù†Ø¯ÛŒ Ø§Ø² Ù‚Ø¨Ù„ ÙˆØ¬ÙˆØ¯ Ø¯Ø§Ø±Ø¯.");return}const r=new pn(t,"",c,a);D.categories.push(r),se(),be(D.info.name,`Ø¯Ø³ØªÙ‡â€ŒØ¨Ù†Ø¯ÛŒ Ø¬Ø¯ÛŒØ¯ Â«${t}Â» Ø§Ø¶Ø§ÙÙ‡ Ø´Ø¯.`,{type:"VIEW_CLASS_SETTINGS"}),Wn(),j(`âœ… Ø¯Ø³ØªÙ‡â€ŒØ¨Ù†Ø¯ÛŒ Â«${t}Â» Ø§Ø¶Ø§ÙÙ‡ Ø´Ø¯.`)},{initialWeight:1})}),fn.appendChild(s)}function ir(e,s){e.isGradedCategory&&s.classList.add("graded-category-pill")}function fc(){if(K.lastUsedCategoryId){if(K.isFinished)return;const e=fn.querySelector(`.pill[data-category-id="${K.lastUsedCategoryId}"]`);e&&e.click()}K.winnerHistory&&K.winnerHistory.length>0&&(Ct(K.winnerHistory.length-1),Ae())}function Hi(e){e?it.textContent=`Ù†ÙØ± Ø¨Ø¹Ø¯ÛŒ Ø¯Ø± ${e.name}`:it.textContent="Ù†ÙØ± Ø¨Ø¹Ø¯ÛŒ"}function Zs(e){e&&e.isGradedCategory?(an.textContent=`Ø¶Ø±ÛŒØ¨: ${e.weight||1}`,an.style.display="inline-block",an.style.visibility="visible"):an.style.display="none"}function ls(e,s){const t=document.getElementById("qualitative-stats-label");if(!t)return;if(!e){t.textContent="...";return}const c=e.qualitativeStats[s.name]||{excellent:0,good:0,effort:0},a=Object.values(e.qualitativeStats).reduce((r,i)=>(r.excellent+=i.excellent||0,r.good+=i.good||0,r.effort+=i.effort||0,r),{excellent:0,good:0,effort:0}),n=r=>`
        <span class="stat-excellent">${r.excellent}</span>ØŒ 
        <span class="stat-good">${r.good}</span>ØŒ 
        <span class="stat-effort">${r.effort}</span>
    `;t.innerHTML=`Ø§ÛŒÙ† Ø¯Ø³ØªÙ‡â€ŒØ¨Ù†Ø¯ÛŒ: ${n(c)} | Ú©Ù„: ${n(a)}`}function En(e){if(K.isFinished){Xe.disabled=!0,je.disabled=!0,It.disabled=!0,Gt.setAttribute("title","Ø¬Ù„Ø³Ù‡ Ø®Ø§ØªÙ…Ù‡ ÛŒØ§ÙØªÙ‡ Ø§Ø³Øª");return}e&&e.isGradedCategory?(Xe.disabled=!1,je.disabled=!1,It.disabled=!1,Gt.removeAttribute("title")):(Xe.disabled=!0,je.disabled=!0,It.disabled=!0,e?Gt.setAttribute("title","Ø¨Ø±Ø§ÛŒ Ø§ÛŒÙ† Ø¯Ø³ØªÙ‡â€ŒØ¨Ù†Ø¯ÛŒ Ù‚Ø§Ø¨Ù„ÛŒØª Ù†Ù…Ø±Ù‡ Ø¯Ù‡ÛŒ ØªØ¹Ø±ÛŒÙ Ù†Ø´Ø¯Ù‡ Ø§Ø³Øª"):Gt.setAttribute("title","Ø§Ø¨ØªØ¯Ø§ ÛŒÚ© Ø¯Ø³ØªÙ‡â€ŒØ¨Ù†Ø¯ÛŒ Ø±Ø§ Ø§Ù†ØªØ®Ø§Ø¨ Ú©Ù†ÛŒØ¯"))}function Qt(e){const s=document.querySelector(".student-stats-table");if(!s||(s.querySelectorAll(".current-category-highlight").forEach(r=>{r.classList.remove("current-category-highlight")}),!e))return;let c=-1;const a=s.querySelectorAll("thead th");if(a.forEach((r,i)=>{r.textContent.trim()===e&&(c=i)}),c===-1)return;a[c].classList.add("current-category-highlight"),s.querySelectorAll("tbody tr").forEach(r=>{const i=r.cells[c];i&&i.classList.add("current-category-highlight")})}function We(e){kt(e);const s=document.getElementById("student-profile-modal"),t=document.getElementById("modal-profile-student-name"),c=document.getElementById("modal-profile-content-container"),a=document.getElementById("modal-profile-close-btn");if(!s||!t||!c||!a)return;t.textContent=`Ù¾Ø±ÙˆÙØ§ÛŒÙ„: ${e.identity.name}`,t.style.cursor="pointer",t.onclick=()=>{const f=Se,m=D;ue(()=>{zi(f,m)})},c.innerHTML="";const n=document.createElement("div");n.className="profile-header-actions";const r=document.createElement("button");r.className="btn-icon btn-icon-label",r.title="Ø§Ù†ØªÙ‚Ø§Ù„ Ø¯Ø§Ù†Ø´â€ŒØ¢Ù…ÙˆØ²",r.innerHTML="<span>âž¡ï¸</span><span>Ø§Ù†ØªÙ‚Ø§Ù„</span>",r.addEventListener("click",()=>{const f=Se,m=D;ue(()=>{Ri(f,m)})});const i=document.createElement("button");i.className="btn-icon btn-icon-label",i.title="Ø­Ø°Ù Ø¯Ø§Ù†Ø´â€ŒØ¢Ù…ÙˆØ²",i.innerHTML="<span>ðŸ—‘ï¸</span><span>Ø­Ø°Ù</span>",i.style.color="var(--color-strong-warning)",i.addEventListener("click",()=>{const f=Se,m=D;ue(()=>{he(`Ø¢ÛŒØ§ Ø§Ø² Ø§Ù†ØªÙ‚Ø§Ù„ Ø¯Ø§Ù†Ø´â€ŒØ¢Ù…ÙˆØ² Â«${f.identity.name}Â» Ø¨Ù‡ Ø³Ø·Ù„ Ø²Ø¨Ø§Ù„Ù‡ Ù…Ø·Ù…Ø¦Ù† Ù‡Ø³ØªÛŒØ¯ØŸ`,()=>{const h={id:`trash_${Date.now()}_${Math.random()}`,timestamp:new Date().toISOString(),type:"student",description:`Ø¯Ø§Ù†Ø´â€ŒØ¢Ù…ÙˆØ² Â«${f.identity.name}Â» Ø§Ø² Ú©Ù„Ø§Ø³ Â«${m.info.name}Â»`,restoreData:{studentId:f.identity.studentId,classId:m.info.scheduleCode}};ct(h),f.isDeleted=!0,be(m.info.name,`Ø¯Ø§Ù†Ø´â€ŒØ¢Ù…ÙˆØ² Â«${f.identity.name}Â» Ø¨Ù‡ Ø³Ø·Ù„ Ø²Ø¨Ø§Ù„Ù‡ Ù…Ù†ØªÙ‚Ù„ Ø´Ø¯.`,{type:"VIEW_TRASH"}),se(),Tt(),Re(),ot(),j(`âœ… Ø¯Ø§Ù†Ø´â€ŒØ¢Ù…ÙˆØ² Â«${f.identity.name}Â» Ø¨Ù‡ Ø³Ø·Ù„ Ø²Ø¨Ø§Ù„Ù‡ Ù…Ù†ØªÙ‚Ù„ Ø´Ø¯.`)},{confirmText:"Ø¨Ù„Ù‡",confirmClass:"btn-warning",isDelete:!0,onCancel:()=>{We(f)}})})});const o=document.createElement("button");o.className="btn-icon btn-icon-label",o.title="Ú¯Ø²Ø§Ø±Ø´ ÙˆØ¶Ø¹ÛŒØª Ø¯Ø§Ù†Ø´â€ŒØ¢Ù…ÙˆØ²",o.innerHTML="<span>ðŸ“Š</span><span>Ú¯Ø²Ø§Ø±Ø´</span>",o.addEventListener("click",()=>{j("ðŸ—ï¸ Ø§ÛŒÙ† Ù‚Ø§Ø¨Ù„ÛŒØª Ø¯Ø± Ù†Ø³Ø®Ù‡â€ŒÙ‡Ø§ÛŒ Ø¢ÛŒÙ†Ø¯Ù‡ ÙØ¹Ø§Ù„ Ø®ÙˆØ§Ù‡Ø¯ Ø´Ø¯.")}),n.appendChild(o);const l=document.createElement("button");l.className="btn-icon btn-icon-label",l.title="Ø§ÙØ²ÙˆØ¯Ù† ÛŒØ§Ø¯Ø¯Ø§Ø´Øª Ø¬Ø¯ÛŒØ¯",l.innerHTML="<span>ðŸ“</span><span>ÛŒØ§Ø¯Ø¯Ø§Ø´Øª</span>",l.addEventListener("click",()=>{const f=Se;ye.value="",ye.dispatchEvent(new Event("input",{bubbles:!0})),dt(m=>{if(m)return f.addNote(m),se(),be(D.info.name,`ÛŒØ§Ø¯Ø¯Ø§Ø´Øª Ø¬Ø¯ÛŒØ¯ÛŒ Ø¨Ø±Ø§ÛŒ Ø¯Ø§Ù†Ø´â€ŒØ¢Ù…ÙˆØ² Â«${f.identity.name}Â» Ø«Ø¨Øª Ø´Ø¯.`,{type:"VIEW_STUDENT_PROFILE",studentId:f.identity.studentId}),Ae(),j("âœ… ÛŒØ§Ø¯Ø¯Ø§Ø´Øª Ø¨Ø§ Ù…ÙˆÙÙ‚ÛŒØª Ø«Ø¨Øª Ø´Ø¯."),()=>We(f)}),ue(()=>{De("add-note-modal"),ye.focus()})}),n.appendChild(r),n.appendChild(i),n.appendChild(l),c.appendChild(n),mc(c),ar(c),a.onclick=()=>ue(),De("student-profile-modal")}function mc(e){if(!Se||!D)return;const s=document.createElement("div");s.className="scoring-section",s.innerHTML=`
    <h3>Ø«Ø¨Øª Ù†Ù…Ø±Ù‡ Ø¬Ø¯ÛŒØ¯</h3>
    <div id="modal-graded-pills" class="category-pills"></div>
    <div class="input-group" style="margin-top: 15px; display: flex; gap: 10px;">
        <input type="number" id="modal-new-score-value" placeholder="Ù†Ù…Ø±Ù‡" style="width: 70px; text-align: center;">
        <input type="text" id="modal-new-score-comment" placeholder="ØªÙˆØ¶ÛŒØ­Ø§Øª (Ø§Ø®ØªÛŒØ§Ø±ÛŒ)..." style="flex-grow: 1;">
    </div>
    <button id="modal-add-score-btn" class="btn-success" style="width: 100%; margin-top: 10px;">Ø«Ø¨Øª Ù†Ù…Ø±Ù‡</button>
`,Li(s.querySelector("#modal-new-score-comment")),At(s.querySelector("#modal-new-score-comment"));const t=s.querySelector("#modal-graded-pills"),c=ge(D.categories).filter(i=>i.isGradedCategory),a=s.querySelector("#modal-new-score-value");c.forEach(i=>{const o=document.createElement("span");o.className="pill",o.textContent=i.name,o.dataset.skillName=i.name,o.addEventListener("click",()=>{t.querySelectorAll(".pill").forEach(l=>l.classList.remove("active")),o.classList.add("active"),ir(i,o),Ia(a)}),t.appendChild(o)});const n=s.querySelector("#modal-add-score-btn"),r=s.querySelector("#modal-new-score-comment");ns(a,"Enter",()=>{n.click(),ss(a)}),At(a),ns(r,"Enter",()=>{n.click(),ss(r)}),n.addEventListener("click",()=>{const i=t.querySelector(".pill.active");if(!i){j("âš ï¸Ù„Ø·ÙØ§Ù‹ ÛŒÚ© Ù…Ù‡Ø§Ø±Øª Ø±Ø§ Ø¨Ø±Ø§ÛŒ Ù†Ù…Ø±Ù‡â€ŒØ¯Ù‡ÛŒ Ø§Ù†ØªØ®Ø§Ø¨ Ú©Ù†ÛŒØ¯.");return}const o=i.dataset.skillName,l=a.value,f=r.value.trim();if(!l){j("Ù„Ø·ÙØ§Ù‹ Ù…Ù‚Ø¯Ø§Ø± Ù†Ù…Ø±Ù‡ Ø±Ø§ ÙˆØ§Ø±Ø¯ Ú©Ù†ÛŒØ¯.");return}Se.addScore(o,parseFloat(l),f),se(),be(D.info.name,`Ù†Ù…Ø±Ù‡ ${l} Ø¯Ø± ${o} Ø¨Ø±Ø§ÛŒ Â«${Se.identity.name}Â» Ø«Ø¨Øª Ø´Ø¯.`,{type:"VIEW_STUDENT_PROFILE",studentId:Se.identity.studentId}),Re(),Ae(),a.value="",r.value="";const m=document.getElementById("modal-profile-content-container"),h=m.querySelector(".history-section");h&&h.remove(),ar(m),j(`âœ… Ù†Ù…Ø±Ù‡ Ø¨Ø±Ø§ÛŒ Ù…Ù‡Ø§Ø±Øª ${o} Ø¨Ø±Ø§ÛŒ Ø¯Ø§Ù†Ø´ Ø¢Ù…ÙˆØ² ${Se.identity.name} Ø¨Ø§ Ù…ÙˆÙÙ‚ÛŒØª Ø«Ø¨Øª Ø´Ø¯.`)}),e.appendChild(s)}function ar(e){if(!Se)return;const s=document.createElement("div");s.className="history-section";const t=document.createElement("div");t.className="history-section-header";const c=document.createElement("h3");c.textContent="Ø³ÙˆØ§Ø¨Ù‚ Ø¯Ø§Ù†Ø´â€ŒØ¢Ù…ÙˆØ²",t.appendChild(c),s.appendChild(t),hc(s),rr(s),or(s),e.appendChild(s)}function hc(e){if(!Se)return;const s=Se,t=D.sessions.reduce((_,k)=>{const x=k.studentRecords[s.identity.studentId];return _+(x&&x.attendance==="absent"?1:0)},0),c=Object.values(s.categoryIssues||{}).reduce((_,k)=>_+k,0);let a=0,n=0,r=0;const i=s.qualitativeStats||{};Object.values(i).forEach(_=>{a+=_.effort||0,n+=_.good||0,r+=_.excellent||0});const o=a+n+r,l=document.createElement("div");l.className="stats-summary-box",l.innerHTML=`
        <p><strong>Ú©Ù„ Ø§Ù†ØªØ®Ø§Ø¨:</strong> ${s.statusCounters.totalSelections}</p>
        <p><strong>ØºÛŒØ¨Øª:</strong> ${t}</p>
        <p><strong>ÙØ±ØµØª Ø§Ø² Ø¯Ø³Øª Ø±ÙØªÙ‡:</strong> ${s.statusCounters.missedChances||0}</p>
        <p><strong>Ù…Ø´Ú©Ù„:</strong> ${c}</p>
        <p><strong>Ø¹Ù…Ù„Ú©Ø±Ø¯ Ú©ÛŒÙÛŒ:</strong> ${o}</p>
    `,e.appendChild(l),l.querySelector("p:nth-child(1)");const f=l.querySelector("p:nth-child(4)"),m=l.querySelector("p:nth-child(5)");e.appendChild(l);const h=ge(D.categories),u=document.createElement("div");if(u.className="stats-breakdown",h.length>0){h.forEach(k=>{var M;const x=k.name,L=((M=s.categoryCounts)==null?void 0:M[x])||0,B=document.createElement("p");B.className="stats-breakdown-item",B.innerHTML=`<strong>${x}:</strong> ${L}`,u.appendChild(B)});const _=l.querySelector("p:first-child");_&&(_.classList.add("collapsible-toggle"),_.onclick=()=>{u.classList.toggle("open"),_.classList.toggle("open")},_.after(u))}const y=document.createElement("div");y.className="stats-breakdown",h.length>0&&(h.forEach(_=>{var B;const k=_.name,x=((B=s.categoryIssues)==null?void 0:B[k])||0,L=document.createElement("p");L.className="stats-breakdown-item",L.innerHTML=`<strong>${k}:</strong> ${x}`,y.appendChild(L)}),f&&c>0&&(f.classList.add("collapsible-toggle"),f.onclick=()=>{y.classList.toggle("open"),f.classList.toggle("open")},f.after(y)));const p=document.createElement("div");if(p.className="stats-breakdown",o>0){for(const _ in i){const k=i[_];if((k.effort||0)+(k.good||0)+(k.excellent||0)>0){const L=document.createElement("p");L.className="stats-breakdown-item",L.innerHTML=`<strong>${_}:</strong> <span style="color:var(--color-primary)">Ø¹Ø§Ù„ÛŒ:${k.excellent}</span> | <span style="color:var(--color-success)">Ø®ÙˆØ¨:${k.good}</span> | <span style="color:#fd7e14">ØªÙ„Ø§Ø´:${k.effort}</span>`,p.appendChild(L)}}m&&o>0&&(m.classList.add("collapsible-toggle"),m.onclick=()=>{p.classList.toggle("open"),m.classList.toggle("open")},m.after(p))}const b=document.createElement("p"),v=document.createElement("strong");v.textContent="ØªÚ©Ø§Ù„ÛŒÙ Ù†Ø§Ù‚Øµ:";const C=document.createElement("span");C.style.marginRight="5px";const S=lt(D);Hn(s,S,C,{includePrefix:!1}),b.appendChild(v),b.appendChild(C),l.appendChild(b)}function rr(e){if(!Se)return;const s=Se,t=document.createElement("h4");t.textContent="ØªØ§Ø±ÛŒØ®Ú†Ù‡ Ù†Ù…Ø±Ø§Øª:",t.style.marginTop="20px";const c=s.getOverallAverageScore((D==null?void 0:D.categories)||[]),a=document.createElement("span");a.className="profile-avg-badge",a.textContent=` (Ù…ÛŒØ§Ù†Ú¯ÛŒÙ†: ${c!==null?c:"-"})`,t.appendChild(a);const n=D.calculateFinalStudentScore(s),r=document.createElement("span");r.className="profile-avg-badge",r.textContent=` (Ù†Ù…Ø±Ù‡ Ù†Ù‡Ø§ÛŒÛŒ: ${n!==null?n:"-"})`,t.appendChild(r);const i=document.createElement("ul");i.className="list-container";const o=Object.values(s.logs.scores||{}).flat().filter(l=>!l.isDeleted).sort((l,f)=>new Date(f.timestamp)-new Date(l.timestamp));o.length===0?i.innerHTML='<div class="no-content-message">Ù‡Ù†ÙˆØ² Ù†Ù…Ø±Ù‡â€ŒØ§ÛŒ Ø«Ø¨Øª Ù†Ø´Ø¯Ù‡ Ø§Ø³Øª.</div>':o.forEach(l=>{const f=document.createElement("li");f.className="score-history-item";const m=document.createElement("div");m.className="item-content";const h=document.createElement("div");h.className="score-info";const u=document.createElement("span");u.className="score-skill-badge",u.textContent=l.skill;const y=document.createElement("span");y.className="score-value",y.textContent=`Ù†Ù…Ø±Ù‡: ${l.value}`;const p=document.createElement("span");if(p.className="score-date",p.textContent=new Date(l.timestamp).toLocaleDateString("fa-IR"),h.appendChild(u),h.appendChild(y),h.appendChild(p),m.appendChild(h),l.comment){const v=document.createElement("p");v.className="score-comment",v.innerHTML=Ti(l.comment),v.addEventListener("click",()=>{ye.value=l.comment,ye.dispatchEvent(new Event("input",{bubbles:!0})),dt(C=>{l.comment=C,se(),be(D.info.name,`ØªÙˆØ¶ÛŒØ­Ø§Øª Ù†Ù…Ø±Ù‡ ${l.value} (${l.skill}) Ø¨Ø±Ø§ÛŒ Ø¯Ø§Ù†Ø´â€ŒØ¢Ù…ÙˆØ² Â«${s.identity.name}Â» Ø¨Ù‡â€ŒØ±ÙˆØ²Ø±Ø³Ø§Ù†ÛŒ Ø´Ø¯.`,{type:"VIEW_STUDENT_PROFILE",studentId:s.identity.studentId}),We(s),j("âœ… ØªÙˆØ¶ÛŒØ­Ø§Øª Ù†Ù…Ø±Ù‡ Ø¨Ø§ Ù…ÙˆÙÙ‚ÛŒØª ÙˆÛŒØ±Ø§ÛŒØ´ Ø´Ø¯.")}),ue(()=>{De("add-note-modal"),ye.focus()})}),m.appendChild(v)}const b=document.createElement("button");b.className="btn-icon delete-item-btn",b.innerHTML="ðŸ—‘ï¸",b.title="Ø­Ø°Ù Ø§ÛŒÙ† Ù†Ù…Ø±Ù‡",b.addEventListener("click",()=>{ue(()=>{he(`Ø¢ÛŒØ§ Ø§Ø² Ø§Ù†ØªÙ‚Ø§Ù„ Ù†Ù…Ø±Ù‡ ${l.value} Ø¯Ø± Ù…Ù‡Ø§Ø±Øª Â«${l.skill}Â» Ø¨Ø±Ø§ÛŒ Ø¯Ø§Ù†Ø´ Ø¢Ù…ÙˆØ² Â«${s.identity.name}Â» Ø¨Ù‡ Ø³Ø·Ù„ Ø²Ø¨Ø§Ù„Ù‡ Ù…Ø·Ù…Ø¦Ù† Ù‡Ø³ØªÛŒØ¯ØŸ`,()=>{const v={id:`trash_${Date.now()}_${Math.random()}`,timestamp:new Date().toISOString(),type:"score",description:`Ù†Ù…Ø±Ù‡ ${l.value} (${l.skill}) Ø¨Ø±Ø§ÛŒ Â«${s.identity.name}Â»`,restoreData:{scoreId:l.id,skill:l.skill,studentId:s.identity.studentId,classId:D.info.scheduleCode}};ct(v),l.isDeleted=!0,se(),be(D.info.name,`Ù†Ù…Ø±Ù‡ ${l.value} (${l.skill}) Ø¯Ø§Ù†Ø´â€ŒØ¢Ù…ÙˆØ² Â«${s.identity.name}Â» Ø¨Ù‡ Ø³Ø·Ù„ Ø²Ø¨Ø§Ù„Ù‡ Ù…Ù†ØªÙ‚Ù„ Ø´Ø¯.`,{type:"VIEW_TRASH"}),We(s),j(`âœ… Ù†Ù…Ø±Ù‡ Ø¯Ø§Ù†Ø´ Ø¢Ù…ÙˆØ² ${s.identity.name} Ø¨Ù‡ Ø³Ø·Ù„ Ø²Ø¨Ø§Ù„Ù‡ Ù…Ù†ØªÙ‚Ù„ Ø´Ø¯.`)},{confirmText:"ØªØ§ÛŒÛŒØ¯ Ø§Ù†ØªÙ‚Ø§Ù„",confirmClass:"btn-warning",onCancel:()=>{We(s)}})})}),f.appendChild(m),f.appendChild(b),i.appendChild(f)}),e.appendChild(t),e.appendChild(i)}function or(e){if(!Se)return;const s=document.createElement("h4");s.textContent="ØªØ§Ø±ÛŒØ®Ú†Ù‡ ÛŒØ§Ø¯Ø¯Ø§Ø´Øªâ€ŒÙ‡Ø§:",s.style.marginTop="20px";const t=document.createElement("ul");t.className="list-container",!Se.profile.notes||Se.profile.notes.length===0?t.innerHTML='<div class="no-content-message">Ù‡Ù†ÙˆØ² ÛŒØ§Ø¯Ø¯Ø§Ø´ØªÛŒ Ø«Ø¨Øª Ù†Ø´Ø¯Ù‡ Ø§Ø³Øª.</div>':[...Se.profile.notes].filter(a=>!a.isDeleted).sort((a,n)=>new Date(n.timestamp)-new Date(a.timestamp)).forEach(a=>{const n=document.createElement("li");n.className="note-history-item";const r=document.createElement("div");r.className="item-content";const i=document.createElement("div");i.className="note-info";const o=document.createElement("span");o.className="note-date",o.textContent=new Date(a.timestamp).toLocaleDateString("fa-IR");const l=document.createElement("button");l.className="btn-icon delete-item-btn",l.innerHTML="ðŸ—‘ï¸",l.title="Ø­Ø°Ù Ø§ÛŒÙ† ÛŒØ§Ø¯Ø¯Ø§Ø´Øª",l.addEventListener("click",()=>{const m=Se;ue(()=>{he("Ø¢ÛŒØ§ Ø§Ø² Ø§Ù†ØªÙ‚Ø§Ù„ Ø§ÛŒÙ† ÛŒØ§Ø¯Ø¯Ø§Ø´Øª Ø¨Ù‡ Ø³Ø·Ù„ Ø²Ø¨Ø§Ù„Ù‡ Ù…Ø·Ù…Ø¦Ù† Ù‡Ø³ØªÛŒØ¯ØŸ",()=>{const h={id:`trash_${Date.now()}_${Math.random()}`,timestamp:new Date().toISOString(),type:"note",description:`ÛŒØ§Ø¯Ø¯Ø§Ø´Øª Ø¨Ø±Ø§ÛŒ Ø¯Ø§Ù†Ø´â€ŒØ¢Ù…ÙˆØ² Â«${m.identity.name}Â»`,restoreData:{noteId:a.id,studentId:m.identity.studentId,classId:D.info.scheduleCode}};ct(h),a.isDeleted=!0,be(D.info.name,`ÛŒØ§Ø¯Ø¯Ø§Ø´Øª Ø¯Ø§Ù†Ø´â€ŒØ¢Ù…ÙˆØ² Â«${m.identity.name}Â» Ø¨Ù‡ Ø³Ø·Ù„ Ø²Ø¨Ø§Ù„Ù‡ Ù…Ù†ØªÙ‚Ù„ Ø´Ø¯.`,{type:"VIEW_TRASH"}),se(),We(m),j("âœ… ÛŒØ§Ø¯Ø¯Ø§Ø´Øª Ø¨Ù‡ Ø³Ø·Ù„ Ø²Ø¨Ø§Ù„Ù‡ Ù…Ù†ØªÙ‚Ù„ Ø´Ø¯.")},{confirmText:"ØªØ§ÛŒÛŒØ¯ Ø§Ù†ØªÙ‚Ø§Ù„",confirmClass:"btn-warning",onCancel:()=>{We(m)}})})}),i.appendChild(o),i.appendChild(l);const f=document.createElement("p");f.className="note-content",f.innerHTML=Ti(a.content),f.addEventListener("click",()=>{const m=Se;ye.value=a.content,ye.dispatchEvent(new Event("input",{bubbles:!0})),dt(h=>{a.content=h,se(),be(D.info.name,`ÛŒØ§Ø¯Ø¯Ø§Ø´Øª Ø¯Ø§Ù†Ø´â€ŒØ¢Ù…ÙˆØ² Â«${m.identity.name}Â» Ø¨Ù‡â€ŒØ±ÙˆØ²Ø±Ø³Ø§Ù†ÛŒ Ø´Ø¯.`,{type:"VIEW_STUDENT_PROFILE",studentId:m.identity.studentId}),We(m),j("âœ…ÛŒØ§Ø¯Ø¯Ø§Ø´Øª Ø¨Ø§ Ù…ÙˆÙÙ‚ÛŒØª ÙˆÛŒØ±Ø§ÛŒØ´ Ø´Ø¯.")}),ue(()=>{De("add-note-modal"),ye.focus()})}),r.appendChild(i),r.appendChild(f),n.appendChild(r),t.appendChild(n)}),e.appendChild(s),e.appendChild(t)}function cr(e){Rs.innerHTML="",e.forEach((s,t)=>{const c=document.createElement("option");c.value=t,c.textContent=s.trim(),Rs.appendChild(c)})}function Vs(){Os.innerHTML="",ti.forEach(e=>{const s=document.createElement("li");s.className="preview-item";const t=document.createElement("input");t.type="checkbox",t.checked=!0,t.dataset.name=e;const c=document.createElement("label");c.textContent=e,s.appendChild(t),s.appendChild(c),Os.appendChild(s)})}function pc(e){const s=document.createElement("div");s.className="list-item-buttons";const t=document.createElement("button");return t.className="btn-icon",t.innerHTML="ðŸ“",t.title="ÙˆÛŒØ±Ø§ÛŒØ´ ÛŒØ§Ø¯Ø¯Ø§Ø´Øª Ú©Ù„Ø§Ø³",e.note||(t.style.display="none"),t.addEventListener("click",c=>{c.stopPropagation(),bs(e)}),s.appendChild(t),s}function gc(e){const s=document.createElement("div");s.style.flexGrow="1",s.style.display="flex",s.style.flexDirection="column",s.style.alignItems="flex-start";const t=document.createElement("span");t.textContent=e.info.name,t.classList.add("class-name-display"),s.appendChild(t);const c=ge(e.students).length,a=ge(e.sessions).filter(l=>l.isFinished).length,n=_c(e.info.scheduleDays),r=document.createElement("div");r.classList.add("class-stats-row");const i=document.createElement("span");i.textContent=`${c} Ù†ÙØ±`,i.classList.add("student-count-badge"),r.appendChild(i);const o=document.createElement("span");if(o.textContent=`${a} Ø¬Ù„Ø³Ù‡`,o.classList.add("session-count-badge"),r.appendChild(o),n){const l=document.createElement("span");l.textContent=n,l.classList.add("schedule-days-badge"),r.appendChild(l)}return s.appendChild(r),s.addEventListener("click",()=>{Ze(e),rt(null),gn(D.liveSession),Ge(),Ee("session-page")}),s}function yc(e){const s=document.createElement("li");us(e).type==="active"&&(s.classList.add("active-class-card"),s.title="Ø§ÛŒÙ† Ú©Ù„Ø§Ø³ Ù‡Ù…â€ŒØ§Ú©Ù†ÙˆÙ† Ø¯Ø± Ø­Ø§Ù„ Ø¨Ø±Ú¯Ø²Ø§Ø±ÛŒ Ø§Ø³Øª");const c=document.createElement("input");c.type="checkbox",c.className="mass-selection-checkbox",c.checked=st.includes(e.info.name),c.addEventListener("click",f=>{f.stopPropagation()}),c.addEventListener("change",()=>{const f=e.info.name;if(c.checked)st.includes(f)||st.push(f);else{const m=st.indexOf(f);m>-1&&st.splice(m,1)}}),s.appendChild(c);const a=gc(e);s.appendChild(a);const n=document.createElement("div");n.style.display="flex",n.style.flexDirection="column",n.style.gap="5px",n.style.alignItems="flex-end",n.style.marginLeft="10px";const r=document.createElement("div");if(r.className="list-item-badges",e.liveSession&&!e.liveSession.isCancelled&&!e.liveSession.isDeleted){const f=document.createElement("span");f.className="warning-badge",f.textContent="Ø¬Ù„Ø³Ù‡ Ø¨Ø§Ø²",r.appendChild(f),s.classList.add("has-unfinished-session")}const i=document.createElement("span");if(i.className=`type-badge ${e.info.type}`,i.textContent=e.info.type==="online"?"Ø¢Ù†Ù„Ø§ÛŒÙ†":"Ø­Ø¶ÙˆØ±ÛŒ",i.title="Ù†ÙˆØ¹ Ú©Ù„Ø§Ø³",r.appendChild(i),us(e).type==="incomplete"){const f=document.createElement("span");f.className="type-badge cancelled-badge",f.textContent="Ø²Ù…Ø§Ù†â€ŒØ¨Ù†Ø¯ÛŒ Ù†Ø§Ù‚Øµ",f.style.cursor="pointer",f.title="Ø¨Ø±Ø§ÛŒ ØªÚ©Ù…ÛŒÙ„ Ø²Ù…Ø§Ù†â€ŒØ¨Ù†Ø¯ÛŒ Ú©Ù„ÛŒÚ© Ú©Ù†ÛŒØ¯",f.addEventListener("click",m=>{m.stopPropagation(),he("Ø²Ù…Ø§Ù†â€ŒØ¨Ù†Ø¯ÛŒ Ø§ÛŒÙ† Ú©Ù„Ø§Ø³ Ú©Ø§Ù…Ù„ Ù†ÛŒØ³Øª. Ø¨Ø±Ø§ÛŒ Ù†Ù…Ø§ÛŒØ´ ØµØ­ÛŒØ­ Ø¯Ø± Ù„ÛŒØ³ØªØŒ Ù„Ø·ÙØ§Ù‹ Ø±ÙˆØ²Ù‡Ø§ Ùˆ Ø³Ø§Ø¹Øª Ø¨Ø±Ú¯Ø²Ø§Ø±ÛŒ Ø±Ø§ Ù…Ø´Ø®Øµ Ú©Ù†ÛŒØ¯.",()=>{xt(e)},{confirmText:"ØªÙ†Ø¸ÛŒÙ…Ø§Øª",confirmClass:"btn-primary"})}),r.appendChild(f)}else{const f=Sc(e,ie);if(f){const m=document.createElement("span");m.className="type-badge conflict-badge",m.textContent="ØªØ¯Ø§Ø®Ù„ Ø²Ù…Ø§Ù†ÛŒ",m.style.cursor="pointer",m.title=`ØªØ¯Ø§Ø®Ù„ Ø¨Ø§ Ú©Ù„Ø§Ø³: ${f}`,m.addEventListener("click",h=>{h.stopPropagation(),he(`Ø²Ù…Ø§Ù† Ø¨Ø±Ú¯Ø²Ø§Ø±ÛŒ Ø§ÛŒÙ† Ú©Ù„Ø§Ø³ Ø¨Ø§ Ú©Ù„Ø§Ø³ Â«${f}Â» ØªØ¯Ø§Ø®Ù„ Ø¯Ø§Ø±Ø¯. Ù„Ø·ÙØ§Ù‹ Ø²Ù…Ø§Ù†â€ŒØ¨Ù†Ø¯ÛŒ Ø±Ø§ Ø¨Ø±Ø±Ø³ÛŒ Ú©Ù†ÛŒØ¯.`,()=>{xt(e)},{confirmText:"ØªÙ†Ø¸ÛŒÙ…Ø§Øª",confirmClass:"btn-primary"})}),r.appendChild(m)}}n.appendChild(r);const l=pc(e);return n.appendChild(l),s.appendChild(n),In(s,()=>{const f={label:"Ù¾Ø´ØªÛŒØ¨Ø§Ù†â€ŒÚ¯ÛŒØ±ÛŒ Ø§Ø² Ø§ÛŒÙ† Ú©Ù„Ø§Ø³",icon:"ðŸ“¤",action:()=>{ts([e.info.name])}},m=st.length;m>1&&st.includes(e.info.name)&&(f.label=`Ù¾Ø´ØªÛŒØ¨Ø§Ù†â€ŒÚ¯ÛŒØ±ÛŒ Ø§Ø² ${m} Ú©Ù„Ø§Ø³`,f.action=()=>{ts(st),On([]),Fe()});const h={label:"Ø­Ø°Ù Ú©Ù„Ø§Ø³",icon:"ðŸ—‘ï¸",className:"danger",action:()=>{he(`Ø¢ÛŒØ§ Ø§Ø² Ø§Ù†ØªÙ‚Ø§Ù„ Ú©Ù„Ø§Ø³ Â«${e.info.name}Â» Ø¨Ù‡ Ø³Ø·Ù„ Ø²Ø¨Ø§Ù„Ù‡ Ù…Ø·Ù…Ø¦Ù† Ù‡Ø³ØªÛŒØ¯ØŸ`,()=>{const u={id:`trash_${Date.now()}_${Math.random()}`,timestamp:new Date().toISOString(),type:"classroom",description:`Ú©Ù„Ø§Ø³ Â«${e.info.name}Â»`,restoreData:{name:e.info.name}};ct(u),e.isDeleted=!0,be(e.info.name,`Ú©Ù„Ø§Ø³ Â«${e.info.name}Â» Ø¨Ù‡ Ø³Ø·Ù„ Ø²Ø¨Ø§Ù„Ù‡ Ù…Ù†ØªÙ‚Ù„ Ø´Ø¯.`,{type:"VIEW_TRASH"}),se(),Fe(),j(`âœ… Ú©Ù„Ø§Ø³ Â«${e.info.name}Â» Ø¨Ù‡ Ø³Ø·Ù„ Ø²Ø¨Ø§Ù„Ù‡ Ù…Ù†ØªÙ‚Ù„ Ø´Ø¯.`)},{confirmText:"Ø¨Ù„Ù‡",confirmClass:"btn-warning",isDelete:!0})}};return m>1&&st.includes(e.info.name)&&(h.label=`Ø­Ø°Ù ${m} Ú©Ù„Ø§Ø³`,h.action=()=>{he(`Ø¢ÛŒØ§ Ø§Ø² Ø§Ù†ØªÙ‚Ø§Ù„ ${m} Ú©Ù„Ø§Ø³ Ø§Ù†ØªØ®Ø§Ø¨ Ø´Ø¯Ù‡ Ø¨Ù‡ Ø³Ø·Ù„ Ø²Ø¨Ø§Ù„Ù‡ Ù…Ø·Ù…Ø¦Ù† Ù‡Ø³ØªÛŒØ¯ØŸ`,()=>{st.forEach(u=>{const y=ie[u];if(y&&!y.isDeleted){const p={id:`trash_${Date.now()}_${Math.random()}`,timestamp:new Date().toISOString(),type:"classroom",description:`Ú©Ù„Ø§Ø³ Â«${y.info.name}Â»`,restoreData:{name:y.info.name}};ct(p),y.isDeleted=!0,be(y.info.name,`Ú©Ù„Ø§Ø³ Â«${y.info.name}Â» Ø¨Ù‡ Ø³Ø·Ù„ Ø²Ø¨Ø§Ù„Ù‡ Ù…Ù†ØªÙ‚Ù„ Ø´Ø¯.`,{type:"VIEW_TRASH"})}}),On([]),se(),Fe(),j(`âœ… ${m} Ú©Ù„Ø§Ø³ Ø¨Ù‡ Ø³Ø·Ù„ Ø²Ø¨Ø§Ù„Ù‡ Ù…Ù†ØªÙ‚Ù„ Ø´Ø¯Ù†Ø¯.`)},{confirmText:"Ø¨Ù„Ù‡",confirmClass:"btn-warning",isDelete:!0})}),[{label:"Ú†Ø§Ù¾ Ú¯Ø²Ø§Ø±Ø´ Ú©Ù„Ø§Ø³",icon:"ðŸ–¨ï¸",action:()=>ro(e)},{label:Ot.classList.contains("selection-mode-active")?"Ù„ØºÙˆ Ø§Ù†ØªØ®Ø§Ø¨":"Ø§Ù†ØªØ®Ø§Ø¨ Ú†Ù†Ø¯ Ú©Ù„Ø§Ø³",icon:"âœ”ï¸",action:()=>{const u=Ot.classList.contains("selection-mode-active");Ot.classList.toggle("selection-mode-active"),u&&(On([]),Fe())}},f,{label:"ÛŒØ§Ø¯Ø¯Ø§Ø´Øª Ú©Ù„Ø§Ø³",icon:"ðŸ“",action:()=>bs(e)},{label:"ØªÙ†Ø¸ÛŒÙ…Ø§Øª Ú©Ù„Ø§Ø³",icon:"âš™ï¸",action:()=>xt(e)},{label:"Ú¯Ø²Ø§Ø±Ø´ ÙØ¹Ø§Ù„ÛŒØªâ€ŒÙ‡Ø§",icon:"ðŸ“‹",action:()=>nr(e.info.name)},{label:"ØªØºÛŒÛŒØ± Ù†Ø§Ù…",icon:"âœï¸",action:()=>{const u=e.info.name,y=document.getElementById("add-note-modal-title");y.textContent="ØªØºÛŒÛŒØ± Ù†Ø§Ù… Ú©Ù„Ø§Ø³",ye.value=u,ye.rows=1,dt(p=>{const b=p.trim();if(b&&b!==u){const v=la(u,b);v.success?(eo(u,b),be(b,`Ù†Ø§Ù… Ú©Ù„Ø§Ø³ Ø§Ø² Â«${u}Â» Ø¨Ù‡ Â«${b}Â» ØªØºÛŒÛŒØ± ÛŒØ§ÙØª.`,{type:"VIEW_SESSIONS"}),se(),Fe(),j(`âœ…Ù†Ø§Ù… Ú©Ù„Ø§Ø³ Ø¨Ù‡ Â«${b}Â» ØªØºÛŒÛŒØ± ÛŒØ§ÙØª.`)):j(v.message)}y.textContent="Ø«Ø¨Øª ÛŒØ§Ø¯Ø¯Ø§Ø´Øª Ø¬Ø¯ÛŒØ¯",ye.rows=4}),De("add-note-modal"),ye.focus(),ye.select()}},h]}),s}function Cs(){const e=document.getElementById("class-management-stats");if(!e)return;const s=Object.values(ie).filter(n=>!n.isDeleted),t=s.length,c=s.reduce((n,r)=>n+ge(r.students).length,0);let a="";Be.lastBackupTimestamp&&(a=`
            <div class="stats-row backup-stat">
                <span>Ø¢Ø®Ø±ÛŒÙ† Ù¾Ø´ØªÛŒØ¨Ø§Ù†: <strong>${new Date(Be.lastBackupTimestamp).toLocaleString("fa-IR",{year:"numeric",month:"numeric",day:"numeric",weekday:"long",hour:"2-digit",minute:"2-digit"})}</strong></span>
            </div>
        `),e.innerHTML=`
        <div class="stats-row main-stats">
            <span>Ú©Ù„ Ú©Ù„Ø§Ø³â€ŒÙ‡Ø§: <strong>${t}</strong></span>
            <span>|</span>
            <span>Ú©Ù„ Ø¯Ø§Ù†Ø´â€ŒØ¢Ù…ÙˆØ²Ø§Ù†: <strong>${c}</strong></span>
        </div>
        ${a} 
    `}function Fe(){Cs(),Ot.innerHTML="";const e=Object.values(ie).filter(a=>!a.isDeleted),s=document.querySelector(".fab-container"),t=document.querySelector(".global-search-container");if(e.length===0){s&&s.classList.add("center-empty-state"),t&&(t.style.display="none"),Ot.innerHTML='<li class="no-content-message" style="text-align:center; margin-top:20px;">Ù‡Ù†ÙˆØ² Ú©Ù„Ø§Ø³ÛŒ Ø§ÛŒØ¬Ø§Ø¯ Ù†Ø´Ø¯Ù‡ Ø§Ø³Øª.</li>';return}else s&&s.classList.remove("center-empty-state"),t&&(t.style.display="");e.sort((a,n)=>{const r=us(a),i=us(n);return r.sortIndex!==i.sortIndex?r.sortIndex-i.sortIndex:r.type==="upcoming"?r.nextTimestamp-i.nextTimestamp:new Date(a.info.creationDate)-new Date(n.info.creationDate)}).forEach(a=>{const n=yc(a);Ot.appendChild(n)})}function Tt(){if(!D)return;As.innerHTML="";const e=ge(D.students);kn(e).forEach(t=>{const c=document.createElement("li");c.dataset.studentId=t.identity.studentId;const a=document.createElement("span");a.className="student-name-link",a.style.flexGrow="1",t.identity.firstName&&t.identity.lastName?a.textContent=`${t.identity.lastName}ØŒ ${t.identity.firstName}`:a.textContent=t.identity.name,a.addEventListener("click",()=>{We(t)}),In(c,()=>[{label:"ØªØºÛŒÛŒØ± Ù†Ø§Ù…",icon:"âœï¸",action:()=>{zi(t,D)}},{label:"Ø§Ù†ØªÙ‚Ø§Ù„ Ø¯Ø§Ù†Ø´â€ŒØ¢Ù…ÙˆØ²",icon:"âž¡ï¸",action:()=>{Ri(t,D)}},{label:"Ø­Ø°Ù Ø¯Ø§Ù†Ø´â€ŒØ¢Ù…ÙˆØ²",icon:"ðŸ—‘ï¸",className:"danger",action:()=>{he(`Ø¢ÛŒØ§ Ø§Ø² Ø§Ù†ØªÙ‚Ø§Ù„ Ø¯Ø§Ù†Ø´â€ŒØ¢Ù…ÙˆØ² Â«${t.identity.name}Â» Ø¨Ù‡ Ø³Ø·Ù„ Ø²Ø¨Ø§Ù„Ù‡ Ù…Ø·Ù…Ø¦Ù† Ù‡Ø³ØªÛŒØ¯ØŸ`,()=>{const n={id:`trash_${Date.now()}_${Math.random()}`,timestamp:new Date().toISOString(),type:"student",description:`Ø¯Ø§Ù†Ø´â€ŒØ¢Ù…ÙˆØ² Â«${t.identity.name}Â» Ø§Ø² Ú©Ù„Ø§Ø³ Â«${D.info.name}Â»`,restoreData:{studentId:t.identity.studentId,classId:D.info.scheduleCode}};ct(n),t.isDeleted=!0,be(D.info.name,`Ø¯Ø§Ù†Ø´â€ŒØ¢Ù…ÙˆØ² Â«${t.identity.name}Â» Ø¨Ù‡ Ø³Ø·Ù„ Ø²Ø¨Ø§Ù„Ù‡ Ù…Ù†ØªÙ‚Ù„ Ø´Ø¯.`,{type:"VIEW_TRASH"}),se(),Tt(),Re(),ot(),j(`âœ… Ø¯Ø§Ù†Ø´â€ŒØ¢Ù…ÙˆØ² Â«${t.identity.name}Â» Ø¨Ù‡ Ø³Ø·Ù„ Ø²Ø¨Ø§Ù„Ù‡ Ù…Ù†ØªÙ‚Ù„ Ø´Ø¯.`)},{confirmText:"Ø¨Ù„Ù‡",confirmClass:"btn-warning"})}}]),c.appendChild(a),As.appendChild(c)})}function en(){if(Ms.innerHTML="",!D)return;D.categories.filter(s=>!s.isDeleted).forEach(s=>{const t=document.createElement("li"),c=document.createElement("div");c.className="name-and-badge-container";const a=document.createElement("span");if(a.textContent=s.name,c.appendChild(a),s.isGradedCategory){const r=document.createElement("span");r.className="category-badge",r.textContent="Ù†Ù…Ø±Ù‡â€ŒØ¯Ø§Ø±",c.appendChild(r)}if(s.isGradedCategory){const r=document.createElement("span");r.className="category-badge weight-badge",r.textContent=`Ø¶Ø±ÛŒØ¨: ${s.weight||1}`,c.appendChild(r)}const n=document.createElement("button");n.className="btn-icon",n.innerHTML="ðŸ—‘ï¸",n.style.color="var(--color-warning)",n.addEventListener("click",()=>{he(`Ø¢ÛŒØ§ Ø§Ø² Ø§Ù†ØªÙ‚Ø§Ù„ Ø¯Ø³ØªÙ‡â€ŒØ¨Ù†Ø¯ÛŒ Â«${s.name}Â» Ø¨Ù‡ Ø³Ø·Ù„ Ø²Ø¨Ø§Ù„Ù‡ Ù…Ø·Ù…Ø¦Ù† Ù‡Ø³ØªÛŒØ¯ØŸ`,()=>{const r={id:`trash_${Date.now()}_${Math.random()}`,timestamp:new Date().toISOString(),type:"category",description:`Ø¯Ø³ØªÙ‡â€ŒØ¨Ù†Ø¯ÛŒ Â«${s.name}Â» Ø§Ø² Ú©Ù„Ø§Ø³ Â«${D.info.name}Â»`,restoreData:{categoryId:s.id,classId:D.info.scheduleCode}};ct(r),s.isDeleted=!0,be(D.info.name,`Ø¯Ø³ØªÙ‡â€ŒØ¨Ù†Ø¯ÛŒ Â«${s.name}Â» Ø¨Ù‡ Ø³Ø·Ù„ Ø²Ø¨Ø§Ù„Ù‡ Ù…Ù†ØªÙ‚Ù„ Ø´Ø¯.`,{type:"VIEW_TRASH"}),se(),en(),j(`âœ… Ø¯Ø³ØªÙ‡â€ŒØ¨Ù†Ø¯ÛŒ Â«${s.name}Â» Ø¨Ù‡ Ø³Ø·Ù„ Ø²Ø¨Ø§Ù„Ù‡ Ù…Ù†ØªÙ‚Ù„ Ø´Ø¯.`)},{confirmText:"Ø¨Ù„Ù‡",confirmClass:"btn-warning"})}),t.appendChild(c),t.appendChild(n),Ms.appendChild(t)})}function lr(){if(!D)return;const e=D;Wi(Fn,cn,e.info.educationalSystem,e.info.level),Fn.addEventListener("change",()=>{e.info.educationalSystem=Fn.value,e.info.level=cn.value,se()}),cn.addEventListener("change",()=>{e.info.level=cn.value,se()});const s=e.info.type||"in-person",t=document.querySelector(`#settings-page input[name="class-type-setting"][value="${s}"]`);t&&(t.checked=!0);const c=e.info.scheduleDays||[];document.querySelectorAll('input[name="schedule-day"]').forEach(a=>{a.checked=c.includes(parseInt(a.value))}),document.getElementById("settings-schedule-start").value=e.info.scheduleStartTime||"",document.getElementById("settings-schedule-end").value=e.info.scheduleEndTime||""}function ds(e){hs(null),document.querySelectorAll(".page").forEach(t=>{t.classList.remove("active")});const s=document.getElementById(e);s&&s.classList.add("active"),e==="class-management-page"?(Fe(),zs.style.display="flex"):zs.style.display="none",sr()}function Ee(e,s={}){const{tab:t}=s;let c=`#${e}`;const a=new URLSearchParams;D&&a.set("class",D.info.name),K&&a.set("session",K.sessionNumber),Se&&a.set("student",Se.identity.studentId),e==="session-dashboard-page"&&t&&a.set("tab",t);const n=a.toString();n&&(c+=`?${n}`),window.location.hash!==c&&history.pushState({pageId:e},"",c),ds(e)}function vc(e,s){const t=document.createElement("div");t.className="list-item-buttons",t.style.gap="10px";const c=document.createElement("button");if(c.className="btn-icon",c.innerHTML="ðŸ“",c.title="ÙˆÛŒØ±Ø§ÛŒØ´ ÛŒØ§Ø¯Ø¯Ø§Ø´Øª Ø¬Ù„Ø³Ù‡",e.note||(c.style.display="none"),c.addEventListener("click",a=>{a.stopPropagation(),Fi(e,s)}),!e.isFinished&&!e.isCancelled){const a=document.createElement("button");a.className="btn-success",a.textContent="Ù¾Ø§ÛŒØ§Ù† Ø¬Ù„Ø³Ù‡",a.style.fontSize="12px",a.style.padding="4px 10px",a.style.whiteSpace="nowrap",a.addEventListener("click",n=>{n.stopPropagation(),he(`Ø¬Ù„Ø³Ù‡ Ø´Ù…Ø§Ø±Ù‡ ${s} Ø®Ø§ØªÙ…Ù‡ Ù¾ÛŒØ¯Ø§ Ø®ÙˆØ§Ù‡Ø¯ Ú©Ø±Ø¯!`,()=>{D.endSpecificSession(e.sessionNumber),se(),be(D.info.name,`Ø¬Ù„Ø³Ù‡ ${s} Ø®Ø§ØªÙ…Ù‡ ÛŒØ§ÙØª.`,{type:"VIEW_SESSIONS"}),Ge(),he("Ø¬Ù„Ø³Ù‡ Ø¨Ø§ Ù…ÙˆÙÙ‚ÛŒØª Ø®Ø§ØªÙ…Ù‡ ÛŒØ§ÙØª. Ø¢ÛŒØ§ Ù…Ø§ÛŒÙ„ Ø¨Ù‡ Ø§ÛŒØ¬Ø§Ø¯ ÙØ§ÛŒÙ„ Ù¾Ø´ØªÛŒØ¨Ø§Ù† Ù‡Ø³ØªÛŒØ¯ØŸ",()=>{if(bt){j("âš ï¸ Ù¾Ø´ØªÛŒØ¨Ø§Ù†â€ŒÚ¯ÛŒØ±ÛŒ Ø¯Ø± Ø­Ø§Ù„Øª Ù†Ù…Ø§ÛŒØ´ (Demo) ØºÛŒØ±ÙØ¹Ø§Ù„ Ø§Ø³Øª.");return}ts(),j("âœ…ÙØ§ÛŒÙ„ Ù¾Ø´ØªÛŒØ¨Ø§Ù† Ø¨Ø§ Ù…ÙˆÙÙ‚ÛŒØª Ø§ÛŒØ¬Ø§Ø¯ Ø´Ø¯.")},{confirmText:"Ø¨Ù„Ù‡",cancelText:"Ø®ÛŒØ±",confirmClass:"btn-success"})})}),t.appendChild(a)}return t.appendChild(c),t}function bc(e,s){const t=document.createElement("div");t.style.display="flex",t.style.flexDirection="column",t.style.alignItems="flex-start",t.style.flexGrow="1";const c=new Date(e.startTime).toLocaleDateString("fa-IR"),a=document.createElement("span");a.className="session-list-title";const n=document.createElement("div");n.style.display="flex",n.style.gap="5px",n.style.marginTop="5px";const r=new Date(e.startTime).toLocaleDateString("fa-IR",{weekday:"long"}),i=document.createElement("span");if(i.className="type-badge day-badge",i.textContent=r,n.appendChild(i),e.isCancelled){a.textContent=`Ù„ØºÙˆ Ø´Ø¯Ù‡ - ØªØ§Ø±ÛŒØ®: ${c}`,t.style.cursor="default";const o=document.createElement("span");o.className="type-badge cancelled-badge",o.textContent="Ù„ØºÙˆ Ø´Ø¯Ù‡",n.appendChild(o)}else a.textContent=`Ø¬Ù„Ø³Ù‡ ${s} - ØªØ§Ø±ÛŒØ®: ${c}`,t.style.cursor="pointer",t.addEventListener("click",()=>{rt(e),xn()});if(t.appendChild(a),e.isFinished){const o=document.createElement("span");o.className="type-badge finished-badge",o.textContent="Ø®Ø§ØªÙ…Ù‡ ÛŒØ§ÙØªÙ‡",n.appendChild(o)}if(e.isMakeup){const o=document.createElement("span");o.className="type-badge makeup-badge",o.textContent="Ø¬Ø¨Ø±Ø§Ù†ÛŒ",n.appendChild(o)}return t.appendChild(n),t}function Cc(e,s){const t=document.createElement("li"),c=s.get(e.sessionNumber),a=bc(e,c);t.appendChild(a);const n=vc(e,c);return t.appendChild(n),In(t,()=>[{label:"ÛŒØ§Ø¯Ø¯Ø§Ø´Øª Ø¬Ù„Ø³Ù‡",icon:"ðŸ“",action:()=>{Fi(e,c)}},{label:e.isCancelled?"Ø¨Ø§Ø²Ú¯Ø±Ø¯Ø§Ù†ÛŒ Ø¬Ù„Ø³Ù‡":"Ù„ØºÙˆ Ø¬Ù„Ø³Ù‡",icon:"âŒ",action:()=>{const r=e.isCancelled?"Ø¨Ø§Ø²Ú¯Ø±Ø¯Ø§Ù†ÛŒ Ø¬Ù„Ø³Ù‡":"Ù„ØºÙˆ Ø¬Ù„Ø³Ù‡",i=e.isCancelled?"Ø¢ÛŒØ§ Ø§Ø² Ø¨Ø§Ø²Ú¯Ø±Ø¯Ø§Ù†ÛŒ Ø§ÛŒÙ† Ø¬Ù„Ø³Ù‡ Ù…Ø·Ù…Ø¦Ù† Ù‡Ø³ØªÛŒØ¯ØŸ":"Ø¢ÛŒØ§ Ø§Ø² Ù„ØºÙˆ Ø§ÛŒÙ† Ø¬Ù„Ø³Ù‡ Ù…Ø·Ù…Ø¦Ù† Ù‡Ø³ØªÛŒØ¯ØŸ Ø¬Ù„Ø³Ù‡ Ù„ØºÙˆ Ø´Ø¯Ù‡ Ø¯Ø± Ø¢Ù…Ø§Ø± ØªØ§Ø«ÛŒØ±ÛŒ Ù†Ø¯Ø§Ø±Ø¯ Ø§Ù…Ø§ Ù‚Ø§Ø¨Ù„ Ø¨Ø§Ø²Ú¯Ø±Ø¯Ø§Ù†ÛŒ Ø§Ø³Øª.";he(i,()=>{e.isCancelled=!e.isCancelled;const o=e.isCancelled?`Ø¬Ù„Ø³Ù‡ ${c} Ù„ØºÙˆ Ø´Ø¯.`:`Ø¬Ù„Ø³Ù‡ Ù„ØºÙˆ Ø´Ø¯Ù‡ (ØªØ§Ø±ÛŒØ®: ${new Date(e.startTime).toLocaleDateString("fa-IR")}) Ø¨Ø§Ø²Ú¯Ø±Ø¯Ø§Ù†ÛŒ Ø´Ø¯.`;be(D.info.name,o,{type:"VIEW_SESSIONS"}),se(),Ge(),j(e.isCancelled?"âœ…Ø¬Ù„Ø³Ù‡ Ù„ØºÙˆ Ø´Ø¯.":"âœ…Ø¬Ù„Ø³Ù‡ Ø¨Ø§Ø²Ú¯Ø±Ø¯Ø§Ù†ÛŒ Ø´Ø¯.")},{confirmText:r,confirmClass:"btn-warning"})}},{label:"ØªØºÛŒÛŒØ± ÙˆØ¶Ø¹ÛŒØª Ø¬Ø¨Ø±Ø§Ù†ÛŒ",icon:"ðŸ”„",action:()=>{D.markAsMakeup(e.sessionNumber),se();const r=e.isMakeup?`Ø¬Ù„Ø³Ù‡ ${c} Ø¨Ù‡ Ø¹Ù†ÙˆØ§Ù† Ø¬Ø¨Ø±Ø§Ù†ÛŒ Ø¹Ù„Ø§Ù…Øªâ€ŒÚ¯Ø°Ø§Ø±ÛŒ Ø´Ø¯.`:`Ø¬Ù„Ø³Ù‡ ${c} Ø§Ø² Ø­Ø§Ù„Øª Ø¬Ø¨Ø±Ø§Ù†ÛŒ Ø®Ø§Ø±Ø¬ Ø´Ø¯.`;be(D.info.name,r,{type:"VIEW_SESSIONS"}),Ge()}},{label:"Ø­Ø°Ù Ø¬Ù„Ø³Ù‡",icon:"ðŸ—‘ï¸",className:"danger",action:()=>{const r=e.isCancelled?"Ù„ØºÙˆ Ø´Ø¯Ù‡":c;he(`Ø¢ÛŒØ§ Ø§Ø² Ø§Ù†ØªÙ‚Ø§Ù„ Ø¬Ù„Ø³Ù‡ ${r} Ø¨Ù‡ Ø³Ø·Ù„ Ø²Ø¨Ø§Ù„Ù‡ Ù…Ø·Ù…Ø¦Ù† Ù‡Ø³ØªÛŒØ¯ØŸ`,()=>{const i={id:`trash_${Date.now()}_${Math.random()}`,timestamp:new Date().toISOString(),type:"session",description:`Ø¬Ù„Ø³Ù‡ ${r} Ø§Ø² Ú©Ù„Ø§Ø³ Â«${D.info.name}Â»`,restoreData:{sessionNumber:e.sessionNumber,classId:D.info.scheduleCode}};ct(i),e.isDeleted=!0,be(D.info.name,`Ø¬Ù„Ø³Ù‡ ${r} Ø¨Ù‡ Ø³Ø·Ù„ Ø²Ø¨Ø§Ù„Ù‡ Ù…Ù†ØªÙ‚Ù„ Ø´Ø¯.`,{type:"VIEW_TRASH"}),se(),Ge(),j(`âœ… Ø¬Ù„Ø³Ù‡ ${r} Ø¨Ù‡ Ø³Ø·Ù„ Ø²Ø¨Ø§Ù„Ù‡ Ù…Ù†ØªÙ‚Ù„ Ø´Ø¯.`)},{confirmText:"Ø¨Ù„Ù‡",confirmClass:"btn-warning",isDelete:!0})}},{label:"ØªØºÛŒÛŒØ± ØªØ§Ø±ÛŒØ®",icon:"ðŸ“…",action:()=>{const r=document.getElementById("dp-day"),i=document.getElementById("dp-month"),o=document.getElementById("dp-year"),l=Vi.toJalaali(e.startTime);r.innerHTML="";for(let h=1;h<=31;h++){const u=document.createElement("option");u.value=h,u.textContent=h.toLocaleString("fa-IR"),h===l.jd&&(u.selected=!0),r.appendChild(u)}const f=["ÙØ±ÙˆØ±Ø¯ÛŒÙ†","Ø§Ø±Ø¯ÛŒØ¨Ù‡Ø´Øª","Ø®Ø±Ø¯Ø§Ø¯","ØªÛŒØ±","Ù…Ø±Ø¯Ø§Ø¯","Ø´Ù‡Ø±ÛŒÙˆØ±","Ù…Ù‡Ø±","Ø¢Ø¨Ø§Ù†","Ø¢Ø°Ø±","Ø¯ÛŒ","Ø¨Ù‡Ù…Ù†","Ø§Ø³ÙÙ†Ø¯"];i.innerHTML="",f.forEach((h,u)=>{const y=document.createElement("option");y.value=u+1,y.textContent=h,u+1===l.jm&&(y.selected=!0),i.appendChild(y)}),o.innerHTML="";const m=l.jy;for(let h=m-5;h<=m+5;h++){const u=document.createElement("option");u.value=h,u.textContent=h.toString().replace(/\d/g,y=>"Û°Û±Û²Û³Û´ÛµÛ¶Û·Û¸Û¹"[y]),h===l.jy&&(u.selected=!0),o.appendChild(u)}es(h=>{if(!h)return;const u=Vi.toGregorian(parseInt(h.jy),parseInt(h.jm),parseInt(h.jd)),y=new Date(u.gy,u.gm-1,u.gd);y.setHours(e.startTime.getHours()),y.setMinutes(e.startTime.getMinutes()),y.setSeconds(e.startTime.getSeconds());const p=e.startTime.toLocaleDateString("fa-IR");e.startTime=y;const b=e.startTime.toLocaleDateString("fa-IR");be(D.info.name,`ØªØ§Ø±ÛŒØ® Ø¬Ù„Ø³Ù‡ ${c} Ø§Ø² ${p} Ø¨Ù‡ ${b} ØªØºÛŒÛŒØ± ÛŒØ§ÙØª.`,{type:"VIEW_SESSIONS"}),se(),Ge(),j(`âœ… ØªØ§Ø±ÛŒØ® Ø¬Ù„Ø³Ù‡ Ø¨Ù‡ ${b} ØªØºÛŒÛŒØ± ÛŒØ§ÙØª.`)}),De("date-picker-modal")}}]),t}function Ge(){const e=document.getElementById("session-list");if(!D)return;if(e.innerHTML="",D.sessions.length===0){e.innerHTML="<li>Ù‡Ù†ÙˆØ² Ø¬Ù„Ø³Ù‡â€ŒØ§ÛŒ Ø´Ø±ÙˆØ¹ Ù†Ø´Ø¯Ù‡ Ø§Ø³Øª.</li>";return}const s=lt(D);[...ge(D.sessions)].reverse().forEach(c=>{const a=Cc(c,s);e.appendChild(a)})}function dn(e){if(St.innerHTML="",e.length>0)e.forEach(s=>{const t=document.createElement("div");t.textContent=s.identity.name,t.addEventListener("click",()=>{We(s),St.style.display="none",Ws.value=""}),St.appendChild(t)}),St.style.display="block";else if(Ws.value.trim()!==""){const s=document.createElement("div");s.className="no-results",s.textContent="Ù¾ÛŒØ¯Ø§ Ù†Ø´Ø¯",St.appendChild(s),St.style.display="block"}else St.style.display="none"}function Un(e){if(ut.innerHTML="",e.length>0)e.forEach(s=>{const t=document.createElement("div");if(t.className="global-search-result",s.type==="student"){const c=document.createElement("span");c.className="student-name",c.textContent=s.student.identity.name;const a=document.createElement("span");a.className="class-name",a.textContent=`Ú©Ù„Ø§Ø³: ${s.classroom.info.name}`,t.addEventListener("click",()=>{Ze(s.classroom),We(s.student),ut.style.display="none",on.value=""}),a.addEventListener("click",n=>{n.stopPropagation(),Ze(s.classroom),rt(null),gn(s.classroom.liveSession),Ge(),Ee("session-page"),ut.style.display="none",on.value=""}),t.appendChild(c),t.appendChild(a)}else if(s.type==="classroom"){const c=document.createElement("span");c.className="student-name",c.textContent=`[Ú©Ù„Ø§Ø³] ${s.classroom.info.name}`,t.addEventListener("click",()=>{Ze(s.classroom),rt(null),gn(s.classroom.liveSession),Ge(),Ee("session-page"),ut.style.display="none",on.value=""}),t.appendChild(c)}ut.appendChild(t)}),ut.style.display="block";else if(on.value.trim()!==""){const s=document.createElement("div");s.className="no-results",s.textContent="Ù¾ÛŒØ¯Ø§ Ù†Ø´Ø¯",ut.appendChild(s),ut.style.display="block"}else ut.style.display="none"}function Sn(){const e=document.getElementById("trashed-items-list");if(e.innerHTML="",He.length===0){e.innerHTML='<li style="text-align: center; padding: 20px;">Ø³Ø·Ù„ Ø²Ø¨Ø§Ù„Ù‡ Ø®Ø§Ù„ÛŒ Ø§Ø³Øª.</li>';return}He.forEach((s,t)=>{const c=document.createElement("li"),a=document.createElement("span");a.textContent=s.description,a.style.flexGrow="1";const n=document.createElement("div");n.className="list-item-buttons";const r=document.createElement("button");r.className="btn-icon",r.innerHTML="ðŸ”„",r.title="Ø¨Ø§Ø²ÛŒØ§Ø¨ÛŒ",r.addEventListener("click",()=>{var m;let o=!1,l=null;const f=s.restoreData;switch(s.type){case"classroom":{const h=ie[f.name];h&&!h.isDeleted?l=`Ú©Ù„Ø§Ø³ÛŒ Ø¨Ø§ Ù†Ø§Ù… Â«${f.name}Â» Ø§Ø² Ù‚Ø¨Ù„ ÙØ¹Ø§Ù„ Ø§Ø³Øª.`:h&&h.isDeleted&&(h.isDeleted=!1,o=!0);break}case"student":{const h=Object.values(ie).find(y=>y.info.scheduleCode===f.classId),u=h==null?void 0:h.students.find(y=>y.identity.studentId===f.studentId);u&&(u.isDeleted=!1,o=!0);break}case"session":{const h=Object.values(ie).find(y=>y.info.scheduleCode===f.classId),u=h==null?void 0:h.sessions.find(y=>y.sessionNumber===f.sessionNumber);u&&(u.isDeleted=!1,o=!0);break}case"category":{const h=Object.values(ie).find(y=>y.info.scheduleCode===f.classId),u=h==null?void 0:h.categories.find(y=>y.id===f.categoryId);u&&(u.isDeleted=!1,o=!0);break}case"score":{const h=Object.values(ie).find(p=>p.info.scheduleCode===f.classId),u=h==null?void 0:h.students.find(p=>p.identity.studentId===f.studentId),y=(m=u==null?void 0:u.logs.scores[f.skill.toLowerCase()])==null?void 0:m.find(p=>p.id===f.scoreId);y&&(y.isDeleted=!1,o=!0);break}case"note":{const h=Object.values(ie).find(p=>p.info.scheduleCode===f.classId),u=h==null?void 0:h.students.find(p=>p.identity.studentId===f.studentId),y=u==null?void 0:u.profile.notes.find(p=>p.id===f.noteId);y&&(y.isDeleted=!1,o=!0);break}}o?(He.splice(t,1),se(),Sn(),s.type==="classroom"&&Fe(),j("âœ… Ø¢ÛŒØªÙ… Ø¨Ø§ Ù…ÙˆÙÙ‚ÛŒØª Ø¨Ø§Ø²ÛŒØ§Ø¨ÛŒ Ø´Ø¯.")):j(l?`âš ï¸ ${l}`:"âš ï¸ Ø¢ÛŒØªÙ… Ø§ØµÙ„ÛŒ Ø¨Ø±Ø§ÛŒ Ø¨Ø§Ø²ÛŒØ§Ø¨ÛŒ ÛŒØ§ÙØª Ù†Ø´Ø¯.")});const i=document.createElement("button");i.className="btn-icon",i.innerHTML="ðŸ”¥",i.title="Ø­Ø°Ù Ø¯Ø§Ø¦Ù…ÛŒ",i.addEventListener("click",()=>{he("Ø¢ÛŒØ§ Ø§Ø² Ø­Ø°Ù Ø¯Ø§Ø¦Ù…ÛŒ Ø§ÛŒÙ† Ø¢ÛŒØªÙ… Ù…Ø·Ù…Ø¦Ù† Ù‡Ø³ØªÛŒØ¯ØŸ Ø§ÛŒÙ† Ø¹Ù…Ù„ ØºÛŒØ±Ù‚Ø§Ø¨Ù„ Ø¨Ø§Ø²gØ´Øª Ø§Ø³Øª.",()=>{const o=s.restoreData,l=m=>Object.values(ie).find(h=>h.info.scheduleCode===m);let f;switch(s.type){case"classroom":delete ie[o.name];break;case"student":f=l(o.classId),ps({identity:{studentId:o.studentId}},f);break;case"session":f=l(o.classId),f&&pi(f.info.name,o.sessionNumber);break;case"category":f=l(o.classId),f&&gi(f.info.name,o.categoryId);break;case"score":f=l(o.classId),f&&yi(f.info.name,o.studentId,o.skill,o.scoreId);break;case"note":f=l(o.classId),f&&vi(f.info.name,o.studentId,o.noteId);break}He.splice(t,1),se(),Sn(),j("âœ… Ø¢ÛŒØªÙ… Ø¨Ø±Ø§ÛŒ Ù‡Ù…ÛŒØ´Ù‡ Ø­Ø°Ù Ø´Ø¯.")},{confirmText:"Ø­Ø°Ù Ø¯Ø§Ø¦Ù…ÛŒ",confirmClass:"btn-warning"})}),n.appendChild(r),n.appendChild(i),c.appendChild(a),c.appendChild(n),e.appendChild(c)})}function wc(){const e=document.getElementById("absentees-summary-container");e&&(e.innerHTML=`
        <div id="absentees-summary-box" class="absentees-summary">
            <div class="absentees-summary-header">
                <h4>Ù„ÛŒØ³Øª ØºØ§ÛŒØ¨ÛŒÙ† Ø¬Ù„Ø³Ù‡ Ø´Ù…Ø§Ø±Ù‡ <span id="absentee-summary-session-number"></span></h4>
                <button id="copy-absentees-btn" class="btn-icon" title="Ú©Ù¾ÛŒ Ù„ÛŒØ³Øª ØºØ§ÛŒØ¨ÛŒÙ†">ðŸ“‹</button>
            </div>
            <div id="absentees-summary-list" class="summary-list"></div>
            <div class="attendance-counters">
                <span>ØªØ¹Ø¯Ø§Ø¯ Ø­Ø§Ø¶Ø±ÛŒÙ†: <strong id="present-count">0</strong></span>
                <span>ØªØ¹Ø¯Ø§Ø¯ ØºØ§ÛŒØ¨ÛŒÙ†: <strong id="absent-count">0</strong></span>
            </div>
        </div>
    `)}function dr(){const e=document.getElementById("absentees-summary-box"),s=document.getElementById("absentees-summary-list"),t=document.getElementById("absentee-summary-session-number");if(!e||!s||!t){console.error("Could not find all absentee summary elements.");return}if(!D||!K){e.classList.remove("visible");return}const c=ge(D.students).filter(f=>{const m=K.studentRecords[f.identity.studentId];return m&&m.attendance==="absent"}),a=ge(D.students),n=c.length,r=a.length-n,i=document.getElementById("present-count"),o=document.getElementById("absent-count");i&&(i.textContent=r.toLocaleString("fa-IR")),o&&(o.textContent=n.toLocaleString("fa-IR"));const l=lt(D);t.textContent=l.get(K.sessionNumber),c.length>0?e.classList.add("visible"):e.classList.remove("visible"),s.innerHTML="",c.forEach(f=>{const h=(y=>D.sessions.reduce((p,b)=>{if(b.isDeleted||b.isCancelled)return p;const v=b.studentRecords[y.identity.studentId];return p+(v&&v.attendance==="absent"?1:0)},0))(f),u=document.createElement("span");u.className="summary-name",u.textContent=`${f.identity.name} (ØºÛŒØ¨Øª: ${h})`,u.addEventListener("click",()=>{u.classList.add("fading-out"),setTimeout(()=>{K.setAttendance(f.identity.studentId,"present"),se(),ot()},200)}),s.appendChild(u)})}function Ec(){const e=document.getElementById("copy-absentees-btn");if(!e){console.error("Could not find the copy absentees button to attach listener.");return}e.addEventListener("click",()=>{if(!D||!K)return;const s=ge(D.students).filter(i=>{const o=K.studentRecords[i.identity.studentId];return o&&o.attendance==="absent"});if(s.length===0){j("âš ï¸Ù„ÛŒØ³Øª ØºØ§ÛŒØ¨ÛŒÙ† Ø®Ø§Ù„ÛŒ Ø§Ø³Øª.");return}const t=i=>D.sessions.reduce((o,l)=>{if(l.isDeleted||l.isCancelled)return o;const f=l.studentRecords[i.identity.studentId];return o+(f&&f.attendance==="absent"?1:0)},0),c=ge(D.students),a=s.length,n=c.length-a;let r=`Ú¯Ø²Ø§Ø±Ø´ Ø­Ø¶ÙˆØ± Ùˆ ØºÛŒØ§Ø¨ Ø¬Ù„Ø³Ù‡ Ø´Ù…Ø§Ø±Ù‡ ${dc()}:
`;r+=`âœ… Ø­Ø§Ø¶Ø±ÛŒÙ†: ${n.toLocaleString("fa-IR")}
`,r+=`âŒ ØºØ§ÛŒØ¨ÛŒÙ†: ${a.toLocaleString("fa-IR")}

`,r+=`Ù„ÛŒØ³Øª Ø§Ø³Ø§Ù…ÛŒ ØºØ§ÛŒØ¨ÛŒÙ†:
`,s.forEach(i=>{const o=t(i);r+=`- ${i.identity.name} (ØªØ¹Ø¯Ø§Ø¯ ØºÛŒØ¨Øªâ€ŒÙ‡Ø§: ${o})
`}),navigator.clipboard.writeText(r).then(()=>{j("âœ…Ù„ÛŒØ³Øª ØºØ§ÛŒØ¨ÛŒÙ† Ø¨Ø§ Ù…ÙˆÙÙ‚ÛŒØª Ú©Ù¾ÛŒ Ø´Ø¯.")}).catch(i=>{console.error("Failed to copy text: ",i),j("âŒØ®Ø·Ø§ Ø¯Ø± Ú©Ù¾ÛŒ Ú©Ø±Ø¯Ù† Ù„ÛŒØ³Øª.")})})}function us(e){const{scheduleDays:s,scheduleStartTime:t,scheduleEndTime:c}=e.info,a=s&&s.length>0,n=t&&c;if(!a&&!n)return{type:"unscheduled",sortIndex:3};if(!a||!n)return{type:"incomplete",sortIndex:2};const r=new Date,i=r.getDay(),o=r.getHours()*60+r.getMinutes(),[l,f]=t.split(":").map(Number),[m,h]=c.split(":").map(Number),u=l*60+f,y=m*60+h;if(s.includes(i)&&o>=u&&o<y)return{type:"active",sortIndex:0};for(let p=0;p<=7;p++){const b=(i+p)%7;if(s.includes(b)){if(p===0&&o>=u)continue;const v=new Date(r);return v.setDate(r.getDate()+p),v.setHours(l,f,0,0),{type:"upcoming",sortIndex:1,nextTimestamp:v.getTime()}}}return{type:"upcoming",sortIndex:1,nextTimestamp:9999999999999}}function Sc(e,s){const{scheduleDays:t,scheduleStartTime:c,scheduleEndTime:a}=e.info;if(!t||!t.length||!c||!a)return null;const[n,r]=c.split(":").map(Number),[i,o]=a.split(":").map(Number),l=n*60+r,f=i*60+o;for(const m of Object.values(s)){if(m===e||m.isDeleted||m.info.name===e.info.name)continue;const h=m.info;if(!h.scheduleDays||!h.scheduleDays.length||!h.scheduleStartTime||!h.scheduleEndTime||!t.some(_=>h.scheduleDays.includes(_)))continue;const[y,p]=h.scheduleStartTime.split(":").map(Number),[b,v]=h.scheduleEndTime.split(":").map(Number),C=y*60+p,S=b*60+v;if(l<S&&f>C)return m.info.name}return null}function _c(e){if(!e||e.length===0)return"";const s={6:"Ø´Ù†Ø¨Ù‡",0:"Û±Ø´Ù†Ø¨Ù‡",1:"Û²Ø´Ù†Ø¨Ù‡",2:"Û³Ø´Ù†Ø¨Ù‡",3:"Û´Ø´Ù†Ø¨Ù‡",4:"ÛµØ´Ù†Ø¨Ù‡",5:"Ø¬Ù…Ø¹Ù‡"};return[...e].sort((c,a)=>{const n={6:0,0:1,1:2,2:3,3:4,4:5,5:6};return n[c]-n[a]}).map(c=>s[c]).join("ØŒ ")}async function ur(){const e=document.getElementById("restore-points-list");e.innerHTML='<li style="text-align:center; padding:20px;">Ø¯Ø± Ø­Ø§Ù„ Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ...</li>';try{const s=await Ea();if(s.length===0){e.innerHTML='<li style="text-align:center; padding:20px;">Ù‡ÛŒÚ† ÙØ§ÛŒÙ„ Ù¾Ø´ØªÛŒØ¨Ø§Ù†ÛŒ ÛŒØ§ÙØª Ù†Ø´Ø¯.</li>';return}e.innerHTML="",s.forEach(t=>{const c=document.createElement("li");c.className="restore-point-card";const a=new Date(t.timestamp).toLocaleString("fa-IR",{weekday:"long",year:"numeric",month:"numeric",day:"numeric",hour:"2-digit",minute:"2-digit"}),n=(t.file.size/1024).toFixed(1)+" KB";c.innerHTML=`
                <div class="restore-card-header">
                    <span class="restore-date">${a}</span>
                    <span class="restore-size">${n}</span>
                </div>
                <div class="restore-desc">${t.metadata.description||"Ø¨Ø¯ÙˆÙ† ØªÙˆØ¶ÛŒØ­Ø§Øª"}</div>
                <div class="restore-actions">
                    <button class="btn-restore-action">Ø¨Ø§Ø²Ú¯Ø±Ø¯Ø§Ù†ÛŒ</button>
                </div>
            `,c.querySelector(".btn-restore-action").addEventListener("click",async()=>{try{const i=await t.file.text(),f=(await new Ii().loadAsync(i,{base64:!0})).file("backup.json");if(!f)throw new Error("ÙØ§ÛŒÙ„ backup.json ÛŒØ§ÙØª Ù†Ø´Ø¯.");const m=await f.async("string"),h=JSON.parse(m);cs(h)}catch(i){console.error("Restore failed:",i),j("âŒ ÙØ§ÛŒÙ„ Ù¾Ø´ØªÛŒØ¨Ø§Ù† Ù…Ø¹ØªØ¨Ø± Ù†ÛŒØ³Øª.")}}),e.appendChild(c)})}catch(s){console.error("Failed to load snapshots:",s),e.innerHTML='<li style="text-align:center; color:red;">Ø®Ø·Ø§ Ø¯Ø± Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ Ø§Ø·Ù„Ø§Ø¹Ø§Øª.</li>'}}function Ki(e,s){const t=document.createElement("div");t.className="qualitative-button-container";const c=et,a=c!==-1&&K.winnerHistory[c],n=a?K.winnerHistory[c]:null,r=K.studentRecords[e.identity.studentId];e.qualitativeStats||(e.qualitativeStats={}),e.qualitativeStats[s]||(e.qualitativeStats[s]={effort:0,good:0,excellent:0}),r.performanceRatings||(r.performanceRatings={});const i=a?n.rating:r.performanceRatings[s],o=K.isFinished||r.attendance==="absent"||r.hadIssue||r.wasOutOfClass;return[{key:"effort",label:"ØªÙ„Ø§Ø´",className:"effort-btn"},{key:"good",label:"Ø®ÙˆØ¨",className:"good-btn"},{key:"excellent",label:"Ø¹Ø§Ù„ÛŒ",className:"excellent-btn"}].forEach(f=>{const m=document.createElement("button");m.className=`qualitative-btn ${f.className}`,m.textContent=f.label,m.disabled=o,i===f.key&&m.classList.add("active"),m.addEventListener("click",()=>{const h=f.key;i&&e.qualitativeStats[s][i]>0&&e.qualitativeStats[s][i]--,i!==h&&(e.qualitativeStats[s][h]=(e.qualitativeStats[s][h]||0)+1);const u=i===h?null:h;a?n.rating=u:u?r.performanceRatings[s]=u:delete r.performanceRatings[s],se(),a?Ae():Ae(e,s)}),t.appendChild(m)}),t}function Wi(e,s,t="custom",c=null){e.innerHTML="",Object.values(Nt).forEach(n=>{const r=document.createElement("option");r.value=n.id,r.textContent=n.label,e.appendChild(r)}),e.value=t;const a=n=>{s.innerHTML="";const r=Nt[n];if(r&&r.levels.length>0)r.levels.forEach(i=>{const o=document.createElement("option");o.value=i,o.textContent=i,s.appendChild(o)}),s.disabled=!1;else{const i=document.createElement("option");i.value="",i.textContent="---",s.appendChild(i),s.disabled=!0}};a(t),c&&(s.value=c),e.onchange=()=>{a(e.value),s.dispatchEvent(new Event("change"))}}function fr(){Cn.value="",Wi(Ai,Mi,"custom"),De("add-class-modal");const e=[{label:"Ø´Ù†Ø¨Ù‡",value:6},{label:"ÛŒÚ©Ø´Ù†Ø¨Ù‡",value:0},{label:"Ø¯ÙˆØ´Ù†Ø¨Ù‡",value:1},{label:"Ø³Ù‡â€ŒØ´Ù†Ø¨Ù‡",value:2},{label:"Ú†Ù‡Ø§Ø±Ø´Ù†Ø¨Ù‡",value:3},{label:"Ù¾Ù†Ø¬â€ŒØ´Ù†Ø¨Ù‡",value:4},{label:"Ø¬Ù…Ø¹Ù‡",value:5}];rs.innerHTML="",e.forEach(s=>{const t=document.createElement("label"),c=document.createElement("input");c.type="checkbox",c.value=s.value,t.appendChild(c),t.appendChild(document.createTextNode(s.label)),rs.appendChild(t)}),ln.addEventListener("click",()=>{ln.classList.toggle("open"),Xa.classList.toggle("open");const s=ln.querySelector(".arrow");s.textContent=ln.classList.contains("open")?"â–¼":"â–¶"}),Cn.focus()}function mr(){Jt.value="",wn.checked=!1,os.value=1,hn.style.visibility="hidden",De("category-modal"),Jt.focus()}function Js(){ue()}function kc(e,s){let t,c;if(e&&s)t=e,c=s,Kt({student:e,categoryName:s}),Ct(-1);else{if(Kt(null),Qt(null),!K||et<0||!K.winnerHistory[et])return null;const a=K.winnerHistory[et];t=a.winner,c=a.categoryName}return{winner:t,categoryName:c}}function Ic(e,s){vt();const t=document.querySelector(".current-winner-highlight");if(t&&t.classList.remove("current-winner-highlight"),e){const a=document.querySelector(`.student-stats-table tr[data-student-id="${e.identity.studentId}"]`);a&&a.classList.add("current-winner-highlight")}const c=D.categories.find(a=>a.name===s);if(c){Qn(c),Hi(c),Zs(c),ls(e,Le),En(c),Qt(c.name);const a=document.querySelectorAll("#category-selection-container .pill");a.forEach(r=>r.classList.remove("active"));const n=Array.from(a).find(r=>r.textContent===s);n&&n.classList.add("active")}}function xc(e,s,t){var b;const c=document.createElement("div");c.className="winner-name-container";const a=document.createElement("button");a.className="btn-icon",a.innerHTML="Ë…",a.title="Ø¨Ø±Ù†Ø¯Ù‡ Ù‚Ø¨Ù„ÛŒ",a.classList.toggle("is-disabled",!t||et<=0),a.addEventListener("click",()=>{a.classList.contains("is-disabled")?(a.classList.add("shake-animation"),setTimeout(()=>a.classList.remove("shake-animation"),200)):(Ct(et-1),Ae())});const n=K.studentRecords[e.identity.studentId],r=(n==null?void 0:n.attendance)==="absent",i=document.createElement("div");i.className="winner-name",i.innerHTML=`âœ¨ <strong>${e.identity.name}</strong>âœ¨`,hs(e.identity.studentId),i.classList.add("heartbeat-animation"),r?(i.style.textDecoration="line-through",i.style.opacity="0.6",i.style.color="var(--color-secondary)"):n!=null&&n.hadIssue?(i.style.color="var(--color-warning)",i.title="Ø§ÛŒÙ† Ø¯Ø§Ù†Ø´â€ŒØ¢Ù…ÙˆØ² Ø¯Ø± Ø§Ù†ØªØ®Ø§Ø¨ Ù‚Ø¨Ù„ÛŒ Ø¨Ø§ Ù…Ø´Ú©Ù„ Ù…ÙˆØ§Ø¬Ù‡ Ø´Ø¯Ù‡ Ø¨ÙˆØ¯"):n!=null&&n.wasOutOfClass&&(i.style.color="var(--color-strong-warning)",i.title="Ø§ÛŒÙ† Ø¯Ø§Ù†Ø´â€ŒØ¢Ù…ÙˆØ² Ø¯Ø± Ø²Ù…Ø§Ù† Ø§Ù†ØªØ®Ø§Ø¨ Ø®Ø§Ø±Ø¬ Ø§Ø² Ú©Ù„Ø§Ø³ Ø¨ÙˆØ¯");const o=()=>{nn=setTimeout(()=>{br(e,s),nn=null},1e3)},l=()=>{nn&&(clearTimeout(nn),nn=null)};["mousedown","touchstart"].forEach(v=>i.addEventListener(v,o)),["mouseup","mouseout","touchend","touchcancel","touchmove"].forEach(v=>i.addEventListener(v,l));const f=document.createElement("button");if(f.className="btn-icon",f.innerHTML="Ë„",f.title="Ø¨Ø±Ù†Ø¯Ù‡ Ø¨Ø¹Ø¯ÛŒ",f.classList.toggle("is-disabled",!t||et>=K.winnerHistory.length-1),f.addEventListener("click",()=>{f.classList.contains("is-disabled")?(f.classList.add("shake-animation"),setTimeout(()=>f.classList.remove("shake-animation"),200)):(Ct(et+1),Ae())}),c.appendChild(f),c.appendChild(i),e.onboardingSession===K.sessionNumber){const v=document.createElement("div");v.className="new-student-badge",v.textContent="Ø¯Ø§Ù†Ø´ Ø¢Ù…ÙˆØ² Ø¬Ø¯ÛŒØ¯",c.appendChild(v)}const m=document.createElement("div");m.className="absent-warning",m.innerHTML="âš ï¸ ØºÛŒØ¨Øª Ø¯Ø± Ø¬Ù„Ø³Ù‡ Ù‚Ø¨Ù„";let h=!1;const u=K.sessionNumber,y=((b=D.sessions.filter(v=>v.sessionNumber<u&&!v.isDeleted&&!v.isCancelled).sort((v,C)=>C.sessionNumber-v.sessionNumber)[0])==null?void 0:b.sessionNumber)??-1;if(y>0&&D&&D.sessions){const v=D.sessions.find(C=>C.sessionNumber===y);if(v&&v.studentRecords){const C=v.studentRecords[e.identity.studentId];h=(C==null?void 0:C.attendance)==="absent"}}h&&m.classList.add("show"),c.appendChild(m),c.appendChild(a);const p=document.getElementById("select-student-btn");return p&&(p.disabled=t&&!f.classList.contains("is-disabled")),{nameContainer:c,winnerNameEl:i}}function Lc(e,s,t){const c=document.createElement("div");c.className="status-button-container";const a=document.createElement("button");a.textContent="ØºØ§ÛŒØ¨",a.classList.add("status-button","absent-btn"),(s==null?void 0:s.attendance)==="absent"&&a.classList.add("active");const n=document.createElement("button");n.textContent="Ù…Ø´Ú©Ù„",n.classList.add("status-button","issue-btn"),s!=null&&s.hadIssue&&n.classList.add("active");const r=document.createElement("button");r.textContent="Ø®Ø±ÙˆØ¬",r.classList.add("status-button","exit-btn"),s!=null&&s.wasOutOfClass&&r.classList.add("active");const i=document.createElement("button");i.textContent="Ù¾Ø±ÙˆÙØ§ÛŒÙ„",i.className="status-button profile-btn";const o=()=>{Re(),setTimeout(()=>{et!==-1?Ae():Ae(e,t)},0),se()};return K.isFinished?[a,n,r,i].forEach(l=>l.disabled=!0):(a.addEventListener("click",()=>{const l=a.classList.contains("active");r.classList.contains("active")&&(r.classList.remove("active"),s.wasOutOfClass=!1,e.statusCounters.outOfClassCount=Math.max(0,(e.statusCounters.outOfClassCount||0)-1),e.statusCounters.missedChances=Math.max(0,e.statusCounters.missedChances-1)),l?(a.classList.remove("active"),K.setAttendance(e.identity.studentId,"present"),e.statusCounters.missedChances=Math.max(0,e.statusCounters.missedChances-1)):(n.classList.contains("active")&&(n.classList.remove("active"),s.hadIssue=!1,e.statusCounters.otherIssues=Math.max(0,e.statusCounters.otherIssues-1),e.statusCounters.missedChances=Math.max(0,e.statusCounters.missedChances-1)),a.classList.add("active"),K.setAttendance(e.identity.studentId,"absent"),e.statusCounters.missedChances++),o()}),n.addEventListener("click",()=>{const l=n.classList.contains("active");r.classList.contains("active")&&(r.classList.remove("active"),s.wasOutOfClass=!1,e.statusCounters.outOfClassCount=Math.max(0,(e.statusCounters.outOfClassCount||0)-1),e.statusCounters.missedChances=Math.max(0,e.statusCounters.missedChances-1)),l?(n.classList.remove("active"),s.hadIssue=!1,e.categoryIssues[t]&&(e.categoryIssues[t]=Math.max(0,e.categoryIssues[t]-1)),e.statusCounters.missedChances=Math.max(0,e.statusCounters.missedChances-1)):(a.classList.contains("active")&&(a.classList.remove("active"),K.setAttendance(e.identity.studentId,"present"),e.statusCounters.missedChances=Math.max(0,e.statusCounters.missedChances-1)),n.classList.add("active"),s.hadIssue=!0,e.categoryIssues[t]=(e.categoryIssues[t]||0)+1,e.statusCounters.missedChances++),o()}),r.addEventListener("click",()=>{r.classList.contains("active")?(r.classList.remove("active"),s.wasOutOfClass=!1,e.statusCounters.outOfClassCount=Math.max(0,(e.statusCounters.outOfClassCount||0)-1),e.statusCounters.missedChances=Math.max(0,e.statusCounters.missedChances-1)):(a.classList.contains("active")&&(a.classList.remove("active"),K.setAttendance(e.identity.studentId,"present"),e.statusCounters.missedChances=Math.max(0,e.statusCounters.missedChances-1)),n.classList.contains("active")&&(n.classList.remove("active"),s.hadIssue=!1,e.categoryIssues[t]&&(e.categoryIssues[t]=Math.max(0,e.categoryIssues[t]-1)),e.statusCounters.missedChances=Math.max(0,e.statusCounters.missedChances-1)),r.classList.add("active"),s.wasOutOfClass=!0,e.statusCounters.outOfClassCount=(e.statusCounters.outOfClassCount||0)+1,e.statusCounters.missedChances++),o()}),i.addEventListener("click",()=>{We(e)})),c.appendChild(a),c.appendChild(r),c.appendChild(n),c.appendChild(i),c}function Tc(e,s){const t=document.createElement("div");t.className="student-details-container";const c=document.createElement("div");c.className="student-details-scores",c.innerHTML="<h4>Ø¢Ø®Ø±ÛŒÙ† Ù†Ù…Ø±Ø§Øª</h4>";const a=document.createElement("ul");a.className="scores-list";const n=D.categories.filter(u=>u.isGradedCategory&&!u.isDeleted);let r=!1;const i=e.logs.scores||{};n.forEach(u=>{var _;const y=u.name,p=y.toLowerCase(),b=(_=i[p])==null?void 0:_.filter(k=>!k.isDeleted),v=document.createElement("li"),C=document.createElement("span");C.className="skill-name",C.textContent=`${y}:`;const S=document.createElement("span");if(S.className="skill-scores",b&&b.length>0){r=!0;const k=b.slice(-3);k.forEach((x,L)=>{const B=document.createElement("span");B.textContent=x.value+(x.comment?"'":""),x.comment&&(B.dataset.tooltip=x.comment,B.style.position="relative",B.style.cursor="help",B.classList.add("tooltip-container")),S.appendChild(B),L<k.length-1&&S.appendChild(document.createTextNode(","))})}else S.textContent="none";v.appendChild(C),v.appendChild(S),a.appendChild(v)}),r||(a.innerHTML='<div class="no-content-message">Ù‡Ù†ÙˆØ² Ù†Ù…Ø±Ù‡â€ŒØ§ÛŒ Ø«Ø¨Øª Ù†Ø´Ø¯Ù‡ Ø§Ø³Øª.</div>'),c.appendChild(a),t.appendChild(c);const o=document.createElement("div");o.className="student-details-notes";const l=document.createElement("div");l.className="history-section-header";const f=document.createElement("h4");f.textContent="ÛŒØ§Ø¯Ø¯Ø§Ø´Øªâ€ŒÙ‡Ø§";const m=document.createElement("button");m.className="btn-icon",m.innerHTML="ðŸ“",m.title="Ø§ÙØ²ÙˆØ¯Ù† ÛŒØ§Ø¯Ø¯Ø§Ø´Øª Ø¬Ø¯ÛŒØ¯",K.isFinished?m.disabled=!0:m.addEventListener("click",()=>{ye.value="",ye.dispatchEvent(new Event("input",{bubbles:!0})),dt(u=>{u&&(e.addNote(u),se(),Ae(),j("âœ… ÛŒØ§Ø¯Ø¯Ø§Ø´Øª Ø¨Ø§ Ù…ÙˆÙÙ‚ÛŒØª Ø«Ø¨Øª Ø´Ø¯."))}),De("add-note-modal"),ye.focus()}),l.appendChild(f),l.appendChild(m),o.appendChild(l);const h=document.createElement("ul");return h.className="notes-list",e.profile.notes&&e.profile.notes.length>0?[...e.profile.notes].sort((y,p)=>new Date(p.timestamp)-new Date(y.timestamp)).forEach(y=>{const p=document.createElement("li");p.dir=gs(y.content),p.textContent=y.content,h.appendChild(p)}):h.innerHTML='<div class="no-content-message">ÛŒØ§Ø¯Ø¯Ø§Ø´ØªÛŒ ÙˆØ¬ÙˆØ¯ Ù†Ø¯Ø§Ø±Ø¯.</div>',o.appendChild(h),t.appendChild(o),t}function _n(){if(wn&&hn){hn.style.display="flex";const e=wn.checked;hn.style.visibility=e?"visible":"hidden"}}const hr=Object.freeze(Object.defineProperty({__proto__:null,_internalShowPage:ds,addClassModal:co,addNoteModal:Ro,addScoreBtn:Wo,addStudentBtn:po,appHeader:zs,assessmentModeLabel:ko,attendanceListUl:un,attendanceMassActionsContainer:Pn,attendancePage:Io,attendancePane:Yt,attendanceSearchInput:Dt,backToSessionsBtn:mo,backToStudentPageBtn:Po,backupDataBtn:Do,breadcrumbContainer:qt,cancelAddClassBtn:Ns,cancelImportBtn:_o,cancelNoteBtn:$o,categoryListUl:Ms,categoryModal:Qo,categoryModalCancelBtn:ec,categoryModalSaveBtn:Za,categoryModalTitle:Ga,categoryWeightLabel:an,classListHeader:Lo,classListUl:Ot,classManagementPage:Aa,classSaveNoteBtn:zo,clearWinnerDisplay:vt,closeActiveModal:ue,closeAddClassModal:Js,closeContextMenu:Rt,closeNavBtn:Bo,columnMappingPage:Eo,columnSelectDropdown:Rs,confirmAddClassBtn:Ds,confirmColumnBtn:So,confirmModalCancelBtn:Hs,confirmModalConfirmBtn:rn,confirmModalMessage:Pa,contextMenu:Pt,csvCancelBtn:bo,csvConfirmBtn:vo,csvFileInput:wo,csvPreviewList:Os,csvPreviewPage:yo,customConfirmModal:Ao,displayWinner:Ae,finishAttendanceBtn:xo,get fromAssessmentToNormalSelection(){return vs},globalStudentSearchInput:on,globalStudentSearchResultsDiv:ut,gradedCategoryPillsContainer:Fo,hamburgerMenuBtn:To,handleUndo:tr,importCsvBtn:Co,massCommentAppendCheckbox:Oi,massCommentBtn:Us,massCommentCancelBtn:sc,massCommentContent:mn,massCommentModal:tc,massCommentModalTitle:nc,massCommentSaveBtn:ic,massCommentStudentCountMessage:Va,modalAddClassLevelSelect:Mi,modalAddClassSystemSelect:Ai,modalNewClassNameInput:Cn,modalScheduleContent:Xa,modalScheduleDaysContainer:rs,modalScheduleEndTimeInput:Ya,modalScheduleStartTimeInput:Ka,modalScheduleTextInput:Ja,modalScheduleToggle:ln,newCategoryModal:rc,newCategoryModalIsGradedCheckbox:wn,newCategoryModalNameInput:Jt,newCategoryModalWeightGroup:hn,newCategoryModalWeightInput:os,newNoteContent:ye,newScoreCommentTextarea:Wa,newScoreValueInput:Ho,newSessionBtn:$s,newStudentNameInput:ho,openAddCategoryBtn:oc,openAddCategoryModal:mr,openAddClassModal:fr,openAddClassModalBtn:oo,openContextMenu:Gs,openModal:De,overlay:Fs,pasteArea:Ra,populateSystemLevelSelects:Wi,processMassHomeworkComment:qs,processPasteBtn:go,profileScoresListUl:jo,profileStatsSummaryDiv:Uo,quickGradeFormWrapper:Gt,quickGradeSubmitBtn:It,quickNoteTextarea:je,quickScoreInput:Xe,renderAttendancePage:ot,renderBreadcrumbs:sr,renderClassList:Fe,renderClassManagementStats:Cs,renderColumnSelector:cr,renderGlobalSearchResults:Un,renderImportPreview:Vs,renderLogModal:nr,renderMassCommentControls:$i,renderRestorePointsPage:ur,renderScoresHistory:rr,renderSearchResults:dn,renderSessionDashboard:xn,renderSessions:Ge,renderSettingsCategories:en,renderSettingsOther:lr,renderSettingsStudentList:Tt,renderStudentNotes:or,renderStudentStatsList:Re,renderTrashPage:Sn,reportCancelBtn:qa,reportColumnsContainer:Ua,reportConfigModal:Xo,reportPrintBtn:ja,restoreDataBtn:No,restoreFileInput:$a,resultDiv:Yo,secureConfirmCancelBtn:Oo,secureConfirmCode:Ha,secureConfirmConfirmBtn:$n,secureConfirmInput:jt,secureConfirmMessage:Fa,secureConfirmModal:Mo,selectStudentBtn:it,selectStudentBtnWrapper:Lt,sessionDashboardPage:ac,setFromAssessmentToNormalSelection:Qa,settingsClassNameHeader:Oa,settingsEduSystemSelect:Fn,settingsLevelSelect:cn,settingsPage:fo,settingsStudentListUl:As,setupDashboardTabs:er,showCategoryModal:js,showClassNoteModal:bs,showMassCommentModal:Pi,showMoveStudentModal:Ri,showPage:Ee,showRenameStudentModal:zi,showRestoreConfirmModal:cs,showSessionNoteModal:Fi,showSettingsPage:xt,showStudentProfile:We,sideNavMenu:za,studentSearchInput:Ws,studentSearchResultsDiv:St,studentStatsHeader:Ps,switchDashboardTab:Xt,syncWeightGroupVisibility:_n,trashedCategoriesList:Vo,trashedClassesList:qo,trashedNotesList:Jo,trashedScoresList:Ko,trashedSessionsList:Zo,trashedStudentsList:Go,undoBtn:uo,undoMessage:lo,undoToast:Ma,updateCategoryColumnHighlight:Qt,updateQualitativeStatsLabel:ls,updateQuickGradeUIForCategory:En},Symbol.toStringTag,{value:"Module"}));function Bc(){li(JSON.parse(JSON.stringify({classrooms:ie,trashBin:He}))),ci(!0)}function Dc(){ci(!1),hi(),li(null)}function Yi(){he("Ø¢ÛŒØ§ Ø§Ø² Ø®Ø±ÙˆØ¬ Ø§Ø² Ø­Ø§Ù„Øª Ù†Ù…Ø§ÛŒØ´ (Demo) Ù…Ø·Ù…Ø¦Ù† Ù‡Ø³ØªÛŒØ¯ØŸ Ø¨Ø§ Ø®Ø±ÙˆØ¬ØŒ ØªÙ…Ø§Ù… ØªØºÛŒÛŒØ±Ø§Øª Ø¢Ø²Ù…Ø§ÛŒØ´ÛŒ Ø´Ù…Ø§ Ø­Ø°Ù Ø´Ø¯Ù‡ Ùˆ Ø¯Ø§Ø¯Ù‡â€ŒÙ‡Ø§ÛŒ Ø§ØµÙ„ÛŒ Ø´Ù…Ø§ Ø¨Ø§Ø²ÛŒØ§Ø¨ÛŒ Ø®ÙˆØ§Ù‡Ù†Ø¯ Ø´Ø¯.",()=>{Dc(),Ze(null),rt(null),kt(null),Fe(),Ee("class-management-page"),Ui(),qe()},{confirmText:"Ø®Ø±ÙˆØ¬",confirmClass:"btn-success"})}function Nc(){document.getElementById("demo-mode-btn").addEventListener("click",()=>{bt?Yi():(qe(),he("Ø´Ù…Ø§ Ø¯Ø± Ø­Ø§Ù„ ÙˆØ±ÙˆØ¯ Ø¨Ù‡ Ø­Ø§Ù„Øª Ù†Ù…Ø§ÛŒØ´ (Demo) Ù‡Ø³ØªÛŒØ¯. Ø¯Ø± Ø§ÛŒÙ† Ø­Ø§Ù„ØªØŒ Ù‡ÛŒÚ†â€ŒÚ©Ø¯Ø§Ù… Ø§Ø² ØªØºÛŒÛŒØ±Ø§Øª Ø´Ù…Ø§ Ø°Ø®ÛŒØ±Ù‡ Ù†Ø®ÙˆØ§Ù‡Ø¯ Ø´Ø¯. Ø¢ÛŒØ§ Ø§Ø¯Ø§Ù…Ù‡ Ù…ÛŒâ€ŒØ¯Ù‡ÛŒØ¯ØŸ",()=>{Bc(),Ui(),qe()},{confirmText:"ØªØ§ÛŒÛŒØ¯",confirmClass:"btn-warning",onCancel:qe}))});const s=document.getElementById("exit-demo-btn");s&&s.addEventListener("click",()=>{bt&&Yi()})}function Ui(){const e=document.getElementById("demo-mode-banner");e&&(bt?(e.classList.add("visible"),document.body.classList.add("demo-mode-active")):(e.classList.remove("visible"),document.body.classList.remove("demo-mode-active")))}let xs=0,Xi=!1;function pr(){window.dev={state:Ca,ui:hr,utils:Kr,db:$r,main:Er},console.log("ðŸ› ï¸ Developer Mode Active! Modules exposed to 'window.dev'");const e=document.querySelector(".app-header h1");e&&(e.style.color="var(--color-primary)",e.classList.add("dev-mode-tilt"))}function gr(){if(Xi){console.warn("Developer access is already initialized. Remove the redundant call.");return}const e=document.querySelector(".app-header h1");e&&(e.addEventListener("click",()=>{Be.isDeveloperMode||(xs++,xs===10&&(wt({isDeveloperMode:!0}),pr(),j("ðŸ› ï¸ Ø­Ø§Ù„Øª ØªÙˆØ³Ø¹Ù‡â€ŒØ¯Ù‡Ù†Ø¯Ù‡ ÙØ¹Ø§Ù„ Ø´Ø¯."),xs=0))}),Mt(e,()=>{Be.isDeveloperMode&&he("Ø¢ÛŒØ§ Ø§Ø² Ø®Ø±ÙˆØ¬ Ø§Ø² Ø­Ø§Ù„Øª ØªÙˆØ³Ø¹Ù‡â€ŒØ¯Ù‡Ù†Ø¯Ù‡ Ù…Ø·Ù…Ø¦Ù† Ù‡Ø³ØªÛŒØ¯ØŸ",()=>{wt({isDeveloperMode:!1}),se(!0),window.location.reload()},{confirmText:"Ø¨Ù„Ù‡",confirmClass:"btn-warning"})}),Xi=!0)}const Ac=Object.freeze(Object.defineProperty({__proto__:null,activateDeveloperAccessOnConsole:gr,bootstrapDeveloperMode:pr},Symbol.toStringTag,{value:"Module"}));function Mc(e){e.addEventListener("click",()=>{const s=new Date().getTime();s-si>500?An(1):An(Zn+1),ga(s),Zn===5&&(An(0),he("Ø¢ÛŒØ§ Ø§Ø² Ø³Ø§Ø®Øª ÛŒÚ© Ú©Ù„Ø§Ø³ ØªØ³ØªÛŒ ØªØµØ§Ø¯ÙÛŒ Ù…Ø·Ù…Ø¦Ù† Ù‡Ø³ØªÛŒØ¯ØŸ",()=>{function t(){const c=`Ú©Ù„Ø§Ø³ ØªØ³ØªÛŒ ${Object.keys(ie).length+1}`,a=new Xs({name:c,type:"online"});["Ø¹Ù„ÛŒ . Ø±Ø¶Ø§ÛŒÛŒ","Ù…Ø±ÛŒÙ… . Ø­Ø³ÛŒÙ†ÛŒ","Ø²Ù‡Ø±Ø§ . Ø§Ø­Ù…Ø¯ÛŒ","Ø±Ø¶Ø§ . Ù…Ø­Ù…Ø¯ÛŒ","ÙØ§Ø·Ù…Ù‡ . Ú©Ø±ÛŒÙ…ÛŒ"].forEach(r=>a.addStudent(new jn(Zt(r)))),ie[c]=a,se(),Fe()}t(),j("Ú©Ù„Ø§Ø³ ØªØ³ØªÛŒ Ø¨Ø§ Ù…ÙˆÙÙ‚ÛŒØª Ø³Ø§Ø®ØªÙ‡ Ø´Ø¯ âœ…!")},{confirmText:"Ø¨Ø³Ø§Ø²",confirmClass:"btn-success"}))})}let Ks=null;const Oc=2*60*1e3,yr=["mousemove","keypress","scroll","click","touchstart"];let ft=null;function Rc(){ft.classList.add("visible")}function vr(){ft.classList.remove("visible")}function fs(){vr(),clearTimeout(Ks),Ks=setTimeout(Rc,Oc)}function ms(e){e.preventDefault(),e.stopPropagation(),setTimeout(fs,0)}function Ys(){if(!ft&&(ft=document.getElementById("screen-saver-overlay"),!ft))return;fs(),yr.forEach(s=>window.addEventListener(s,fs)),ft.addEventListener("click",ms),ft.addEventListener("touchstart",ms);const e="23.7.5";{const s=document.getElementById("screen-saver-version");s&&(s.textContent=`v${e}`)}}function zc(){clearTimeout(Ks),vr(),yr.forEach(e=>window.removeEventListener(e,fs)),ft&&(ft.removeEventListener("click",ms),ft.removeEventListener("touchstart",ms))}function $c(e){e&&e.addEventListener("change",s=>{const t=s.target.checked;wt({isScreenSaverEnabled:t}),t?Ys():zc()})}const Pc={"session-dashboard-page":"session-page","column-mapping-page":"settings-page","csv-preview-page":"settings-page","restore-points-page":"class-management-page","session-page":"class-management-page","settings-page":"class-management-page","trash-page":"class-management-page","class-management-page":null};function Fc(e){if(e==="class-management-page"){Ze(null),rt(null),history.replaceState({pageId:e},"","#class-management-page"),ds(e);return}else e==="session-page"&&(rt(null),D&&Ge());const s=new URLSearchParams;D&&s.set("class",D.info.name),K&&s.set("session",K.sessionNumber);const t=`#${e}${s.toString()?"?"+s.toString():""}`;history.replaceState({pageId:e},"",t),ds(e)}function ji(e=!1){if(yt){ue();return}const s=document.querySelector(".page.active");if(!s)return;const t=Pc[s.id];t&&(e?Fc(t):Ee(t))}function Hc(){const e=window.location.hash;if(!e||e==="#")return!1;const[s,t]=e.split("?"),c=s.substring(1),a=new URLSearchParams(t),n=a.get("class"),r=parseInt(a.get("session"),10),i=a.get("student"),o=a.get("tab")||"selector";if(n&&ie[n])Ze(ie[n]),r&&D.getSession(r)&&rt(D.getSession(r)),i&&D.students.find(l=>l.identity.studentId===i)&&kt(D.students.find(l=>l.identity.studentId===i));else return!1;switch(c){case"session-page":Ge(),Ee("session-page");break;case"session-dashboard-page":xn(o);break;case"settings-page":xt(D);break;default:return!1}return!0}document.addEventListener("DOMContentLoaded",()=>{const{globalStudentSearchInput:e,undoBtn:s,newStudentNameInput:t,addStudentBtn:c,pasteArea:a,processPasteBtn:n,csvPreviewList:r,csvConfirmBtn:i,csvCancelBtn:o,importCsvBtn:l,csvFileInput:f,columnSelectDropdown:m,confirmColumnBtn:h,cancelImportBtn:u,selectStudentBtn:y,finishAttendanceBtn:p,classListHeader:b,studentStatsHeader:v,hamburgerMenuBtn:C,sideNavMenu:S,closeNavBtn:_,overlay:k,backupDataBtn:x,restoreDataBtn:L,restoreFileInput:B,confirmModalCancelBtn:M,confirmModalConfirmBtn:W,secureConfirmCancelBtn:Q,secureConfirmConfirmBtn:I,newNoteContent:z,classSaveNoteBtn:g,cancelNoteBtn:F,studentSearchInput:re,studentSearchResultsDiv:G,categoryModalSaveBtn:de,categoryModalCancelBtn:V,massCommentBtn:le,massCommentCancelBtn:O,massCommentSaveBtn:A,massCommentContent:oe,massCommentAppendCheckbox:ee,attendanceSearchInput:X,newCategoryModalNameInput:xe,newCategoryModalIsGradedCheckbox:Me,newCategoryModalWeightInput:me,openAddCategoryBtn:ve}=hr,Oe=document.getElementById("trash-nav-btn");document.querySelector(".global-search-container .search-icon"),hi(),Bs(y),Bs($s),Be.isDeveloperMode&&kr(()=>Promise.resolve().then(()=>Ac),void 0).then(R=>{R.bootstrapDeveloperMode()}),Ui(),Hc()||(Fe(),Ee("class-management-page"));function Ve(R,Z){const H=document.querySelector(R);if(!H)return;const ne=H.querySelector(".search-icon"),ce=H.querySelector(".animated-search-input");!ne||!ce||(ne.addEventListener("mousedown",Ce=>{Ce.preventDefault()}),ne.addEventListener("click",()=>{H.classList.contains("search-active")||(H.classList.add("search-active"),ce.focus())}),ce.addEventListener("blur",()=>{setTimeout(()=>{H.classList.remove("search-active"),ce.value="",Z&&Z([])},150)}))}X.addEventListener("input",()=>{const R=X.value.toLowerCase().trim(),Z=Rn(R);un.querySelectorAll(".attendance-list-item").forEach(ne=>{const ce=ne.querySelector(".student-name");if(ce){const Ce=ce.textContent,pe=Pe(Ce.toLowerCase()),ke=pe.includes(Pe(R)),ze=pe.includes(Pe(Z));ke||ze?ne.style.display="flex":ne.style.display="none"}})}),At(X),At(je),V.addEventListener("click",()=>{ue(),vn(null)}),de.addEventListener("click",()=>{const R=xe.value.trim(),Z=Me.checked,H=parseInt(me.value,10)||1;if(!R){gt(xe,3e3),j("âš ï¸ Ù†Ø§Ù… Ø¯Ø³ØªÙ‡â€ŒØ¨Ù†Ø¯ÛŒ Ù†Ù…ÛŒâ€ŒØªÙˆØ§Ù†Ø¯ Ø®Ø§Ù„ÛŒ Ø¨Ø§Ø´Ø¯.");return}typeof Kn=="function"&&Kn(R,Z,H),ue(),j(`âœ… Ø¯Ø³ØªÙ‡â€ŒØ¨Ù†Ø¯ÛŒ Ø¬Ø¯ÛŒØ¯ ${R} Ø¨Ø§ Ù…ÙˆÙÙ‚ÛŒØª Ø§Ø¶Ø§ÙÙ‡ Ø´Ø¯.`),en(),Re()}),window.addEventListener("scroll",Rt),document.addEventListener("click",R=>{Pt.classList.contains("visible")&&!Pt.contains(R.target)&&Rt(),re.contains(R.target)||(G.style.display="none");const Z=R.target.closest(".log-action-link");if(Z&&Z.dataset.action)try{const H=JSON.parse(Z.dataset.action);Ft(H)}catch(H){console.error("Could not parse log action:",H)}}),Lt.addEventListener("click",()=>{(Lt.classList.contains("disabled-wrapper")||it.disabled)&&(it.classList.add("shake-animation"),setTimeout(()=>{it.classList.remove("shake-animation")},200))}),v.addEventListener("click",()=>{const R=new Date().getTime();R-ii>500?Mn(1):Mn(Vn+1),ya(R),Vn===10&&(Mn(0),he("Ø¢ÛŒØ§ Ø§Ø² ØµÙØ± Ú©Ø±Ø¯Ù† ØªÙ…Ø§Ù… Ø´Ù…Ø§Ø±Ù†Ø¯Ù‡â€ŒÙ‡Ø§ÛŒ Ø¯Ø§Ù†Ø´â€ŒØ¢Ù…ÙˆØ²Ø§Ù† Ù…Ø·Ù…Ø¦Ù† Ù‡Ø³ØªÛŒØ¯ØŸ Ø§ÛŒÙ† Ø¹Ù…Ù„ ØºÛŒØ±Ù‚Ø§Ø¨Ù„ Ø¨Ø§Ø²Ú¯Ø´Øª Ø§Ø³Øª.",()=>{fa(),Re(),j("ØªÙ…Ø§Ù… Ø¢Ù…Ø§Ø±Ù‡Ø§ ØµÙØ± Ø´Ø¯Ù†Ø¯ âœ….")},{confirmText:"Ø¨Ù„Ù‡",confirmClass:"btn-warning"}))}),Mc(b),gr(),Q.addEventListener("click",()=>{ue(),yn(null)});const Je=document.getElementById("date-picker-confirm-btn"),d=document.getElementById("date-picker-cancel-btn"),P=document.getElementById("dp-day"),$=document.getElementById("dp-month"),E=document.getElementById("dp-year");Je.addEventListener("click",()=>{const R=E.value,Z=$.value,H=P.value;R&&Z&&H&&typeof Xn=="function"?(Xn({jy:R,jm:Z,jd:H}),ue()):j("âš ï¸ Ø®Ø·Ø§ Ø¯Ø± Ø§Ù†ØªØ®Ø§Ø¨ ØªØ§Ø±ÛŒØ®."),es(null)}),d&&d.addEventListener("click",()=>{ue(),es(null)}),I.addEventListener("click",()=>{typeof Jn=="function"&&Jn(),ue(),yn(null)}),M.addEventListener("click",()=>{ue(ri)}),W.addEventListener("click",()=>{ue(ai)}),it.addEventListener("click",()=>{if(xi(je,.02),Xe.value.trim()!==""||je.value.trim()!==""){j("âš ï¸Ù„Ø·ÙØ§Ù‹ Ø§Ø¨ØªØ¯Ø§ Ø¨Ø§ Ø¯Ú©Ù…Ù‡ Â«Ø«Ø¨ØªÂ»ØŒ ØªØºÛŒÛŒØ±Ø§Øª Ø±Ø§ Ø°Ø®ÛŒØ±Ù‡ Ú©Ù†ÛŒØ¯ Ùˆ ÛŒØ§ Ù†Ù…Ø±Ù‡ Ùˆ ÛŒØ§Ø¯Ø¯Ø§Ø´Øª Ø±Ø§ Ù¾Ø§Ú© Ú©Ù†ÛŒØ¯.",4200),gt(Xe),gt(je);return}if(ht){const R=Cr(D,Le);R?(zn(),Re(),Ae(R,Le.name),ls(R,Le),Qt(Le.name),se()):he("Ø¨Ø±Ø§ÛŒ ØªÙ…Ø§Ù… Ø¯Ø§Ù†Ø´â€ŒØ¢Ù…ÙˆØ²Ø§Ù† Ø¯Ø± Ø§ÛŒÙ† Ø¬Ù„Ø³Ù‡ ÛŒÚ© Ø¨Ø§Ø± ÙØ±ØµØª Ù†Ù…Ø±Ù‡â€ŒÚ¯ÛŒØ±ÛŒ ÙØ±Ø§Ù‡Ù… Ø´Ø¯Ù‡Ø› Ø¢ÛŒØ§ Ù…ÛŒâ€ŒØ®ÙˆØ§Ù‡ÛŒØ¯ Ø¨Ø±Ø§ÛŒ Ø¨Ø§Ø± Ø¯ÙˆÙ… Ø§ÛŒÙ† Ú©Ø§Ø± Ø±Ø§ ØªÚ©Ø±Ø§Ø± Ú©Ù†ÛŒØ¯ØŸ",()=>{const Z=Le.id;at[Z].pickedCandidatesThisSession=[],it.click()},{confirmText:"Ø¨Ù„Ù‡",cancelText:"Ø®ÛŒØ±",confirmClass:"btn-success"})}else{if(!D||!K||!Le)return;const R=D.selectNextWinner(Le.name,K);if(R){zn();const Z=K.studentRecords[R.identity.studentId];(Z==null?void 0:Z.attendance)==="absent"&&R.statusCounters.missedChances++,Z!=null&&Z.hadIssue&&(R.statusCounters.missedChances++,R.categoryIssues[Le.name]=(R.categoryIssues[Le.name]||0)+1),Z!=null&&Z.wasOutOfClass&&(R.statusCounters.outOfClassCount=(R.statusCounters.outOfClassCount||0)+1,R.statusCounters.missedChances++);const H={winner:R,categoryName:Le.name};K.winnerHistory.push(H),K.winnerHistory.length>10&&K.winnerHistory.shift(),Ct(K.winnerHistory.length-1),K.lastUsedCategoryId=Le.id,K.lastSelectedWinnerId=R.identity.studentId,Re(),setTimeout(()=>{Ae(),ls(R,Le)},0),se()}else j("âŒØ¯Ø§Ù†Ø´â€ŒØ¢Ù…ÙˆØ² ÙˆØ§Ø¬Ø¯ Ø´Ø±Ø§ÛŒØ·ÛŒ Ø¨Ø±Ø§ÛŒ Ø§Ù†ØªØ®Ø§Ø¨ ÛŒØ§ÙØª Ù†Ø´Ø¯.")}}),document.querySelectorAll('#settings-page input[name="class-type-setting"]').forEach(R=>{R.addEventListener("change",()=>{if(!D)return;const Z=R.value,H=D.info.type||"in-person";if(Z===H)return;const ne=pe=>pe==="online"?"Ø¢Ù†Ù„Ø§ÛŒÙ†":"Ø­Ø¶ÙˆØ±ÛŒ",ce=ne(H),Ce=ne(Z);he(`Ø¢ÛŒØ§ Ø§Ø² ØªØºÛŒÛŒØ± Ù†ÙˆØ¹ Ú©Ù„Ø§Ø³ Ø§Ø² Â«${ce}Â» Ø¨Ù‡ Â«${Ce}Â» Ù…Ø·Ù…Ø¦Ù† Ù‡Ø³ØªÛŒØ¯ØŸ`,()=>{D.info.type=Z,se(),be(D.info.name,`Ù†ÙˆØ¹ Ú©Ù„Ø§Ø³ Ø¨Ù‡ Â«${Ce}Â» ØªØºÛŒÛŒØ± ÛŒØ§ÙØª.`,{type:"VIEW_CLASS_SETTINGS"}),Fe(),j(`âœ… Ù†ÙˆØ¹ Ú©Ù„Ø§Ø³ Ø¨Ù‡ Â«${Ce}Â» ØªØºÛŒÛŒØ± ÛŒØ§ÙØª.`)},{confirmText:"Ø¨Ù„Ù‡",confirmClass:"btn-warning",onCancel:()=>{const pe=document.querySelector(`#settings-page input[name="class-type-setting"][value="${H}"]`);pe&&(pe.checked=!0)}})})});const T=document.querySelectorAll('input[name="schedule-day"]'),U=document.getElementById("settings-schedule-start"),q=document.getElementById("settings-schedule-end");T.forEach(R=>{R.addEventListener("change",()=>{if(!D)return;const Z=Array.from(T).filter(H=>H.checked).map(H=>parseInt(H.value));D.info.scheduleDays=Z,se()})});const N=()=>{D&&(D.info.scheduleStartTime=U.value,D.info.scheduleEndTime=q.value,se())};U.addEventListener("change",N),q.addEventListener("change",N),h.addEventListener("click",()=>{if(!Gn){j("âŒØ®Ø·Ø§ÛŒÛŒ Ø±Ø® Ø¯Ø§Ø¯Ù‡ Ø§Ø³Øª. Ù„Ø·ÙØ§Ù‹ ÙØ§ÛŒÙ„ Ø±Ø§ Ø¯ÙˆØ¨Ø§Ø±Ù‡ Ø§Ù†ØªØ®Ø§Ø¨ Ú©Ù†ÛŒØ¯."),Ee("settings-page");return}const R=parseInt(m.value,10),ne=Gn.split(`
`).slice(1).map(ce=>{var pe;return(pe=ce.split(",")[R])==null?void 0:pe.trim()}).filter(ce=>ce&&ce.length>0);ne.length>0?(sn(ne),Vs(),Ee("csv-preview-page")):j("Ù‡ÛŒÚ† Ù†Ø§Ù…ÛŒ Ø¯Ø± Ø³ØªÙˆÙ† Ø§Ù†ØªØ®Ø§Ø¨ Ø´Ø¯Ù‡ Ù¾ÛŒØ¯Ø§ Ù†Ø´Ø¯. Ù„Ø·ÙØ§Ù‹ Ø³ØªÙˆÙ† Ø¯ÛŒÚ¯Ø±ÛŒ Ø±Ø§ Ø§Ù…ØªØ­Ø§Ù† Ú©Ù†ÛŒØ¯ ÛŒØ§ ÙØ§ÛŒÙ„ Ø®ÙˆØ¯ Ø±Ø§ Ø¨Ø±Ø±Ø³ÛŒ Ú©Ù†ÛŒØ¯."),Nn(null)}),l.addEventListener("click",()=>{f.click()}),f.addEventListener("change",R=>{const Z=R.target.files[0];if(!Z)return;const H=new FileReader;H.onload=ne=>{const ce=ne.target.result;Nn(ce);const pe=ce.split(`
`)[0].split(",");cr(pe),Ee("column-mapping-page")},H.readAsText(Z),R.target.value=null}),u.addEventListener("click",()=>{Nn(null),Ee("settings-page")}),i.addEventListener("click",()=>{const R=r.querySelectorAll('input[type="checkbox"]:checked');let Z=0,H=[],ne=!1;R.forEach(Ce=>{const pe=Ce.dataset.name,ke=Zt(pe),ze=Pe(ke.name),Ue=D.students.find(nt=>Pe(nt.identity.name)===ze&&ze!=="");if(Ue)if(Ue.isDeleted)ps(Ue,D);else{H.push(ke.name);return}const pt=new jn(ke);D.addStudent(pt),D.sessions.length>0&&(ge(D.sessions).filter(nt=>nt.isFinished&&!nt.isCancelled).forEach(nt=>{nt.setAttendance(pt.identity.studentId,"absent")}),Et(pt,D),ne=!0),Z++}),se(),Z>0&&be(D.info.name,`${Z} Ø¯Ø§Ù†Ø´â€ŒØ¢Ù…ÙˆØ² Ø¬Ø¯ÛŒØ¯ Ø§Ø² Ù„ÛŒØ³Øª ÙˆØ±ÙˆØ¯ÛŒ Ø¨Ù‡ Ú©Ù„Ø§Ø³ Ø§Ø¶Ø§ÙÙ‡ Ø´Ø¯Ù†Ø¯.`,{type:"VIEW_SESSIONS"}),xt(D);let ce=H.length>0?`âš ï¸ Ù…ÙˆØ§Ø±Ø¯ Ø²ÛŒØ± Ø¨Ù‡ Ø¯Ù„ÛŒÙ„ ØªÚ©Ø±Ø§Ø±ÛŒ Ø¨ÙˆØ¯Ù† Ù†Ø§Ø¯ÛŒØ¯Ù‡ Ú¯Ø±ÙØªÙ‡ Ø´Ø¯Ù†Ø¯:
- ${H.join(`
- `)}`:"";if(ne)Ye(Z,ce);else if(H.length>0||Z>0){const Ce=Z>0?`âœ… ${Z} Ø¯Ø§Ù†Ø´â€ŒØ¢Ù…ÙˆØ² Ø¨Ø§ Ù…ÙˆÙÙ‚ÛŒØª Ø§Ø¶Ø§ÙÙ‡ Ø´Ø¯Ù†Ø¯.
${ce}`:ce;he(Ce,()=>{},{confirmText:"Ù…ØªÙˆØ¬Ù‡ Ø´Ø¯Ù…",confirmClass:"btn-success",onCancel:null})}a.value="",sn([])}),o.addEventListener("click",()=>{sn([]),Ee("settings-page")}),a.addEventListener("keydown",R=>{if(R.key==="Enter"){const Z=a.value,H=a.selectionStart,ne=Z.lastIndexOf(`
`,H-1),ce=Z.substring(ne+1,H).trim(),Ce=ce.indexOf(".");ce&&(Ce<=0||Ce>=ce.length-1)&&(R.preventDefault(),j("Ù„Ø·ÙØ§ ÛŒÚ© Ù†Ù‚Ø·Ù‡ Ø¨ÛŒÙ† Ù†Ø§Ù… Ùˆ Ù†Ø§Ù… Ø®Ø§Ù†ÙˆØ§Ø¯Ú¯ÛŒ Ù‚Ø±Ø§Ø± Ø¯Ù‡ÛŒØ¯.âš ï¸ Ù…Ø«Ø§Ù„: Ø¹Ù„ÛŒ . Ø§Ø­Ù…Ø¯ÛŒ",5e3))}}),n.addEventListener("click",()=>{const R=a.value.trim();if(!R){gt(a,3e3),j("Ú©Ø§Ø¯Ø± Ù…ØªÙ†ÛŒ Ø®Ø§Ù„ÛŒ Ø§Ø³Øª. Ù„Ø·ÙØ§Ù‹ Ø§Ø³Ø§Ù…ÛŒ Ø±Ø§ ÙˆØ§Ø±Ø¯ Ú©Ù†ÛŒØ¯.");return}const Z=R.split(`
`).map(ne=>ne.trim()).filter(ne=>ne.length>0),H=Z.find(ne=>{const ce=ne.indexOf(".");return ce<=0||ce>=ne.length-1});if(H){j(`ÙØ±Ù…Øª Ù†Ø§Ù… Â«${H}Â» ØµØ­ÛŒØ­ Ù†ÛŒØ³Øª. Ù„Ø·ÙØ§ Ù†Ø§Ù… Ùˆ Ù†Ø§Ù… Ø®Ø§Ù†ÙˆØ§Ø¯Ú¯ÛŒ Ø±Ø§ Ø¨Ø§ Ù†Ù‚Ø·Ù‡ Ø¬Ø¯Ø§ Ú©Ù†ÛŒØ¯âš ï¸.`,5e3);return}Z.length>0?(sn(Z),Vs(),Ee("csv-preview-page")):j("Ù‡ÛŒÚ† Ù†Ø§Ù… Ù…Ø¹ØªØ¨Ø±ÛŒ Ø¨Ø±Ø§ÛŒ ÙˆØ±ÙˆØ¯ Ù¾ÛŒØ¯Ø§ Ù†Ø´Ø¯.")}),t.addEventListener("keyup",R=>{R.key==="Enter"&&c.click()}),At(t),c.addEventListener("click",()=>{if(!D)return;const R=t.value.trim();if(!R){gt(t,3e3),j("Ù„Ø·ÙØ§Ù‹ Ù†Ø§Ù… Ø¯Ø§Ù†Ø´â€ŒØ¢Ù…ÙˆØ² Ø±Ø§ ÙˆØ§Ø±Ø¯ Ú©Ù†ÛŒØ¯.");return}const Z=R.indexOf(".");if(Z<=0||Z>=R.length-1){j("Ù„Ø·ÙØ§ ÛŒÚ© Ù†Ù‚Ø·Ù‡ Ø¨ÛŒÙ† Ù†Ø§Ù… Ùˆ Ù†Ø§Ù… Ø®Ø§Ù†ÙˆØ§Ø¯Ú¯ÛŒ Ù‚Ø±Ø§Ø± Ø¯Ù‡ÛŒØ¯.âš ï¸ Ù…Ø«Ø§Ù„: Ø¹Ù„ÛŒ . Ø§Ø­Ù…Ø¯ÛŒ",5e3);return}const H=Zt(t.value),ne=Pe(H.name);if(ge(D.students).some(ke=>Pe(ke.identity.name)===ne)){j(`Ø¯Ø§Ù†Ø´â€ŒØ¢Ù…ÙˆØ² Â«${H.name}Â» Ù‚Ø¨Ù„Ø§Ù‹ Ø¯Ø± Ù„ÛŒØ³Øª ÙˆØ¬ÙˆØ¯ Ø¯Ø§Ø±Ø¯.`,4e3);return}const Ce=Zt(R),pe=new jn(Ce);D.addStudent(pe),D.sessions.length>0&&(ge(D.sessions).filter(ke=>ke.isFinished&&!ke.isCancelled).forEach(ke=>{ke.setAttendance(pe.identity.studentId,"absent")}),Et(pe,D),Ye(1)),se(),be(D.info.name,`Ø¯Ø§Ù†Ø´â€ŒØ¢Ù…ÙˆØ² Â«${R}Â» Ø¨Ù‡ Ú©Ù„Ø§Ø³ Ø§Ø¶Ø§ÙÙ‡ Ø´Ø¯.`,{type:"VIEW_STUDENT_PROFILE",studentId:pe.identity.studentId}),Tt(),Re(),t.value="",t.focus()}),$s.addEventListener("click",()=>{if(D){const R=D.sessions.find(H=>!H.isFinished&&!H.isCancelled&&!H.isDeleted);if(R){j(`âš ï¸ Ø¬Ù„Ø³Ù‡ ${R.sessionNumber} Ù‡Ù†ÙˆØ² ØªÙ…Ø§Ù… Ù†Ø´Ø¯Ù‡ Ø§Ø³Øª. Ù„Ø·ÙØ§Ù‹ Ø§Ø¨ØªØ¯Ø§ Ø¨Ø§ Ø¯Ú©Ù…Ù‡ Â«Ù¾Ø§ÛŒØ§Ù† Ø¬Ù„Ø³Ù‡Â» Ø¢Ù† Ø±Ø§ Ø®Ø§ØªÙ…Ù‡ Ø¯Ù‡ÛŒØ¯.`,4500);const H=document.querySelector("#session-list > li:nth-child(1) > div.list-item-buttons > button.btn-success");H&&gt(H);return}const Z=()=>{const H=ne=>{const ce=D.startNewSession();gn(ce),rt(ce),D.students.forEach(ke=>{Qs.setAttendance(ke.identity.studentId,"present")}),se();const pe=lt(D).get(ce.sessionNumber);be(D.info.name,`Ø¬Ù„Ø³Ù‡ ${pe} Ø´Ø±ÙˆØ¹ Ø´Ø¯.`,{type:"VIEW_SESSIONS"}),xn(ne?"attendance":"selector")};he("Ø¢ÛŒØ§ ØªÙ…Ø§ÛŒÙ„ Ø¨Ù‡ Ø§Ù†Ø¬Ø§Ù… ÙØ±Ø¢ÛŒÙ†Ø¯ Ø­Ø¶ÙˆØ± Ùˆ ØºÛŒØ§Ø¨ Ø¯Ø§Ø±ÛŒØ¯ØŸ",()=>H(!0),{confirmText:"Ø¨Ù„Ù‡",cancelText:"Ø®ÛŒØ±",confirmClass:"btn-success",onCancel:()=>H(!1)})};D.hasSessionToday()?he("Ø´Ù…Ø§ Ø§Ù…Ø±ÙˆØ² ÛŒÚ© Ø¬Ù„Ø³Ù‡ Ø¨Ø±Ø§ÛŒ Ø§ÛŒÙ† Ú©Ù„Ø§Ø³ Ø«Ø¨Øª Ú©Ø±Ø¯Ù‡â€ŒØ§ÛŒØ¯. Ø¢ÛŒØ§ Ø§Ø² Ø´Ø±ÙˆØ¹ ÛŒÚ© Ø¬Ù„Ø³Ù‡ Ø¬Ø¯ÛŒØ¯ Ø¯ÛŒÚ¯Ø± Ù…Ø·Ù…Ø¦Ù† Ù‡Ø³ØªÛŒØ¯ØŸ",Z,{confirmText:"Ø¨Ù„Ù‡",confirmClass:"btn-warning"}):Z()}});const J=document.getElementById("open-add-class-modal-btn");J&&J.addEventListener("click",()=>{fr()}),Ns&&Ns.addEventListener("click",()=>{Js()}),Ds?Ds.addEventListener("click",()=>{const R=Cn;if(!R){console.error("âŒ DEBUG: Name Input element is missing!");return}const Z=R.value.trim();if(!Z){gt(R,3e3),j("Ù„Ø·ÙØ§Ù‹ Ù†Ø§Ù… Ú©Ù„Ø§Ø³ Ø±Ø§ ÙˆØ§Ø±Ø¯ Ú©Ù†ÛŒØ¯.");return}if(ie[Z]){gt(R,3e3),j("Ú©Ù„Ø§Ø³ÛŒ Ø¨Ø§ Ø§ÛŒÙ† Ù†Ø§Ù… Ù‚Ø¨Ù„Ø§Ù‹ Ø§ÛŒØ¬Ø§Ø¯ Ø´Ø¯Ù‡ Ø§Ø³Øª.");return}try{const H=Cn.value.trim();if(!H){j("âš ï¸ Ù„Ø·ÙØ§Ù‹ Ù†Ø§Ù… Ú©Ù„Ø§Ø³ Ø±Ø§ ÙˆØ§Ø±Ø¯ Ú©Ù†ÛŒØ¯.");return}if(ie[H]){j("âš ï¸ Ú©Ù„Ø§Ø³ÛŒ Ø¨Ø§ Ø§ÛŒÙ† Ù†Ø§Ù… ÙˆØ¬ÙˆØ¯ Ø¯Ø§Ø±Ø¯.");return}const ne=document.querySelector('input[name="modal-class-type"]:checked');if(!ne){console.error("Class type radio not selected");return}const ce=ne.value,Ce=Ai.value,pe=Mi.value||null,ke=Ja.value.trim()||null,ze=Array.from(rs.querySelectorAll("input:checked")).map(Es=>parseInt(Es.value,10)),Ue=Ka.value||null,pt=Ya.value||null,nt=new Xs({name:H,type:ce,educationalSystem:Ce,level:pe,scheduleText:ke,scheduleDays:ze,scheduleStartTime:Ue,scheduleEndTime:pt});ie[H]=nt,se(),Fe(),Js(),j(`âœ… Ú©Ù„Ø§Ø³ Â«${H}Â» Ø§ÛŒØ¬Ø§Ø¯ Ø´Ø¯.`)}catch(H){console.error("CRASH ERROR:",H),j("Ø®Ø·Ø§ÛŒÛŒ Ø±Ø® Ø¯Ø§Ø¯: "+H.message)}}):console.error("âŒ DEBUG: Create Button (ui.confirmAddClassBtn) is NOT found!"),e.addEventListener("input",R=>{const Z=R.target.value;if(Z.length<2){Un([]);return}const H=Z.toLowerCase(),ne=Rn(H),ce=[];for(const Ce in ie){const pe=ie[Ce];if(pe.isDeleted)continue;const ke=Pe(Ce.toLowerCase()),ze=ke.includes(Pe(H)),Ue=ke.includes(Pe(ne));(ze||Ue)&&ce.push({type:"classroom",classroom:pe})}for(const Ce in ie){const pe=ie[Ce];if(pe.isDeleted)continue;ge(pe.students).filter(ze=>{const Ue=Pe(ze.identity.name.toLowerCase()),pt=Ue.includes(Pe(H)),nt=Ue.includes(Pe(ne));return pt||nt}).forEach(ze=>{ce.push({type:"student",student:ze,classroom:pe})})}Un(ce)}),s.addEventListener("click",tr),p.addEventListener("click",()=>{Xt("selector")}),re.addEventListener("input",R=>{const Z=R.target.value;if(!Z){dn([]);return}const H=Z.toLowerCase(),ne=Rn(H),Ce=ge(D.students).filter(pe=>{const ke=Pe(pe.identity.name.toLowerCase()),ze=ke.includes(Pe(H)),Ue=ke.includes(Pe(ne));return ze||Ue});dn(Ce)}),re.addEventListener("focus",()=>{re.value&&dn(re.value)}),It.addEventListener("click",()=>{const R=Xe.value,Z=je.value.trim();let H;if(Yn)H=Yn.student;else{const ce=K==null?void 0:K.winnerHistory[et];H=ce==null?void 0:ce.winner}if(!H){j("âŒØ®Ø·Ø§: Ø¯Ø§Ù†Ø´â€ŒØ¢Ù…ÙˆØ² Ù…Ø¹ØªØ¨Ø±ÛŒ Ø¨Ø±Ø§ÛŒ Ø«Ø¨Øª Ù†Ù…Ø±Ù‡ ÛŒØ§ÙØª Ù†Ø´Ø¯.");return}const ne=Le;if(!H||!ne){j("âš ï¸Ù„Ø·ÙØ§Ù‹ Ø§Ø¨ØªØ¯Ø§ ÛŒÚ© Ø¯Ø§Ù†Ø´â€ŒØ¢Ù…ÙˆØ² Ùˆ ÛŒÚ© Ø¯Ø³ØªÙ‡â€ŒØ¨Ù†Ø¯ÛŒ Ø±Ø§ Ø§Ù†ØªØ®Ø§Ø¨ Ú©Ù†ÛŒØ¯.");return}if(!R){j("âš ï¸Ù„Ø·ÙØ§Ù‹ Ù…Ù‚Ø¯Ø§Ø± Ù†Ù…Ø±Ù‡ Ø±Ø§ ÙˆØ§Ø±Ø¯ Ú©Ù†ÛŒØ¯.");return}if(R>100||R<0){j("âŒÙ†Ù…Ø±Ù‡ Ù†Ø¨Ø§ÛŒØ¯ Ø§Ø² Û±Û°Û° Ø¨ÛŒØ´ØªØ± Ùˆ Ø§Ø² ØµÙØ± Ú©Ù…ØªØ± Ø¨Ø§Ø´Ø¯");return}H&&(H.addScore(ne.name,parseFloat(R),Z),be(D.info.name,`Ù†Ù…Ø±Ù‡ ${R} Ø¯Ø± ${ne.name} Ø¨Ø±Ø§ÛŒ Â«${H.identity.name}Â» Ø«Ø¨Øª Ø´Ø¯.`,{type:"VIEW_STUDENT_PROFILE",studentId:H.identity.studentId}),se(),Re(),j(`âœ…Ù†Ù…Ø±Ù‡ Ø¨Ø±Ø§ÛŒ ${H.identity.name} Ø¯Ø± Ù…Ù‡Ø§Ø±Øª ${ne.name} Ø«Ø¨Øª Ø´Ø¯.`),_i(Le.id,H.identity.studentId),Xe.value="",je.value="",Ae())}),ns(Xe,"Enter",()=>{ss(Xe),It.click()}),At(Xe),ns(je,"Enter",()=>{ss(je),It.click()}),F.addEventListener("click",()=>{ue()}),g.addEventListener("click",()=>{const R=z.value.trim(),Z=oi;if(typeof Z=="function"){const H=Z(R);if(H===!1)return;ue(()=>{typeof H=="function"&&H()})}else ue()});const te=document.getElementById("move-student-confirm-btn"),Y=document.getElementById("move-student-cancel-btn"),ae=document.getElementById("move-student-class-select");Y.addEventListener("click",()=>{ue()}),te.addEventListener("click",()=>{const R=ae.value,Z=ie[R],{studentToMove:H,sourceClassForMove:ne}=Ca;if(!H||!ne||!Z){j("Ø®Ø·Ø§ÛŒÛŒ Ø±Ø® Ø¯Ø§Ø¯. Ù„Ø·ÙØ§Ù‹ Ø¯ÙˆØ¨Ø§Ø±Ù‡ Ø§Ù…ØªØ­Ø§Ù† Ú©Ù†ÛŒØ¯âš ï¸."),ue();return}const ce=ua(H,ne,Z);ce.success?(be(ne.info.name,`Ø¯Ø§Ù†Ø´â€ŒØ¢Ù…ÙˆØ² Â«${H.identity.name}Â» Ø¨Ù‡ Ú©Ù„Ø§Ø³ Â«${R}Â» Ù…Ù†ØªÙ‚Ù„ Ø´Ø¯.`,{type:"VIEW_SESSIONS"}),be(R,`Ø¯Ø§Ù†Ø´â€ŒØ¢Ù…ÙˆØ² Â«${H.identity.name}Â» Ø§Ø² Ú©Ù„Ø§Ø³ Â«${ne.info.name}Â» Ø¨Ù‡ Ø§ÛŒÙ† Ú©Ù„Ø§Ø³ Ù…Ù†ØªÙ‚Ù„ Ø´Ø¯.`,{type:"VIEW_SESSIONS"}),se(),Tt(),Re(),ot(),j(`Ø¯Ø§Ù†Ø´â€ŒØ¢Ù…ÙˆØ² Â«${H.identity.name}Â» Ø¨Ø§ Ù…ÙˆÙÙ‚ÛŒØª Ø¨Ù‡ Ú©Ù„Ø§Ø³ Â«${R}Â» Ù…Ù†ØªÙ‚Ù„ Ø´Ø¯âœ….`)):j(ce.message),ue()}),C.addEventListener("click",()=>{S.style.width="300px",k.classList.add("modal-visible")}),C.addEventListener("click",()=>{S.style.width="300px",k.classList.add("modal-visible")});const we=document.getElementById("header-settings-btn");we&&we.addEventListener("click",()=>{D&&xt(D)}),_.addEventListener("click",qe),_.addEventListener("click",qe),k.addEventListener("click",qe),Oe.addEventListener("click",()=>{Sn(),Ee("trash-page"),qe()});const fe=document.getElementById("restore-points-nav-btn");fe&&fe.addEventListener("click",()=>{ur(),Ee("restore-points-page"),qe()}),Nc(),jr(x),qr(L,B),Gr(B),window.addEventListener("popstate",R=>{if(yt||ui){ue(null,!0),fi(!1);return}Rt(),ji(!0)}),Yr(y),Ve(".global-search-container .animated-search-container",Un),Ve(".action-column-header .animated-search-container",dn),ka(),[ye,Wa,je,Ra].forEach(R=>{R&&Li(R)});function Et(R,Z){const H=ge(Z.students).filter(_e=>_e.identity.studentId!==R.identity.studentId);if(H.length===0)return;const ne=H.reduce((_e,$e)=>$e.statusCounters.totalSelections>_e.statusCounters.totalSelections?$e:_e,H[0]);if(!ne||ne.statusCounters.totalSelections===0)return;R.categoryCounts=JSON.parse(JSON.stringify(ne.categoryCounts)),R.statusCounters.totalSelections=ne.statusCounters.totalSelections;const ce=H.reduce((_e,$e)=>_e+$e.statusCounters.totalSelections,0),Ce=H.reduce((_e,$e)=>_e+($e.statusCounters.missedChances||0),0),pe=ce>0?Ce/ce:0;R.statusCounters.missedChances=Math.round(R.statusCounters.totalSelections*pe);const ke=ge(Z.categories),ze={};ke.forEach(_e=>{const $e=H.reduce((_s,ks)=>_s+(ks.categoryCounts[_e.name]||0),0),Ss=H.reduce((_s,ks)=>_s+(ks.categoryIssues[_e.name]||0),0);ze[_e.name]=$e>0?Ss/$e:0}),ke.forEach(_e=>{const $e=R.categoryCounts[_e.name]||0,Ss=ze[_e.name]||0;R.categoryIssues[_e.name]=Math.round($e*Ss)});const Ue=Z.liveSession;Ue?R.onboardingSession=Ue.sessionNumber:R.onboardingSession=Z.sessions.length+1;const pt=ge(Z.sessions).filter(_e=>_e.isFinished&&!_e.isCancelled),nt="ðŸ“ ÛŒØ§Ø¯Ø¯Ø§Ø´Øª Ø®ÙˆØ¯Ú©Ø§Ø± Ø³ÛŒØ³ØªÙ…",wr=`Ø§ÛŒÙ† Ø¯Ø§Ù†Ø´â€ŒØ¢Ù…ÙˆØ²  Ø§Ø² Ø¬Ù„Ø³Ù‡ Ø´Ù…Ø§Ø±Ù‡ ${pt.length} Ø¨Ù‡ Ú©Ù„Ø§Ø³ Ø§Ø¶Ø§ÙÙ‡ Ø´Ø¯. Ø¢Ù…Ø§Ø± Ù…Ø´Ø§Ø±Ú©Øª Ø§Ùˆ Ø¨Ø± Ø§Ø³Ø§Ø³ ÙØ¹Ø§Ù„â€ŒØªØ±ÛŒÙ† Ø¯Ø§Ù†Ø´â€ŒØ¢Ù…ÙˆØ² Ùˆ Ø¢Ù…Ø§Ø± Â«ÙØ±ØµØª Ø§Ø² Ø¯Ø³Øª Ø±ÙØªÙ‡Â» Ø§Ùˆ Ø¨Ø± Ø§Ø³Ø§Ø³ Ù…ÛŒØ§Ù†Ú¯ÛŒÙ† Ú©Ù„Ø§Ø³ Ø«Ø¨Øª Ú¯Ø±Ø¯ÛŒØ¯:`,Wt=[];R.statusCounters.totalSelections>0&&Wt.push(`Ú©Ù„ Ø§Ù†ØªØ®Ø§Ø¨â€ŒÙ‡Ø§: ${R.statusCounters.totalSelections}`),R.statusCounters.missedChances>0&&Wt.push(`ÙØ±ØµØªâ€ŒÙ‡Ø§ÛŒ Ø§Ø² Ø¯Ø³Øª Ø±ÙØªÙ‡: ${R.statusCounters.missedChances}`);for(const _e in R.categoryCounts){const $e=R.categoryCounts[_e];$e>0&&Wt.push(`Ø§Ù†ØªØ®Ø§Ø¨ Ø¯Ø± Â«${_e}Â»: ${$e}`)}for(const _e in R.categoryIssues){const $e=R.categoryIssues[_e];$e>0&&Wt.push(`Ù…Ø´Ú©Ù„ Ø¯Ø± Â«${_e}Â»: ${$e}`)}if(Wt.length>0){const _e=`${nt}
${wr}

- ${Wt.join(`
- `)}`;R.addNote(_e)}}function Ye(R,Z=""){const H=R>1?"Ø¯Ø§Ù†Ø´â€ŒØ¢Ù…ÙˆØ²Ø§Ù† Ø¬Ø¯ÛŒØ¯":"Ø¯Ø§Ù†Ø´â€ŒØ¢Ù…ÙˆØ² Ø¬Ø¯ÛŒØ¯";let ne=`âœ… ${R} ${H} Ø¨Ø§ Ù…ÙˆÙÙ‚ÛŒØª Ø§Ø¶Ø§ÙÙ‡ Ø´Ø¯Ù†Ø¯.
`;ne+="ðŸ’¡ Ú†ÙˆÙ† Ø§ÛŒÙ† Ú©Ù„Ø§Ø³ Ø¬Ù„Ø³Ø§Øª Ø¨Ø±Ú¯Ø²Ø§Ø± Ø´Ø¯Ù‡ Ø¯Ø§Ø±Ø¯ØŒ Ø¨Ø±Ø§ÛŒ Ø§ÛŒÙ† Ø§ÙØ±Ø§Ø¯ Ø¢Ù…Ø§Ø± Ù¾Ø§ÛŒÙ‡â€ŒØ§ÛŒ (Ù…ØªÙ†Ø§Ø³Ø¨ Ø¨Ø§ Ú©Ù„Ø§Ø³) Ø«Ø¨Øª Ø´Ø¯ ØªØ§ Ø¯Ø± ÙØ±Ø§ÛŒÙ†Ø¯ Ø§Ù†ØªØ®Ø§Ø¨ Ø§Ø®ØªÙ„Ø§Ù„ÛŒ Ø§ÛŒØ¬Ø§Ø¯ Ù†Ø´ÙˆØ¯.",Z&&(ne+=`
${Z}`),he(ne,()=>{},{confirmText:"Ù…ØªÙˆØ¬Ù‡ Ø´Ø¯Ù…",confirmClass:"btn-success",onCancel:null})}const Bt="23.7.5",Te="1093";{const R=` (Ø³Ø§Ø®Øª ${Te})`;document.getElementById("app-version").textContent=`Ù†Ø³Ø®Ù‡ ${Bt}${R}`}function Ft(R){if(!R||!R.classroomName)return;const Z=ie[R.classroomName];if(!Z){j("âš ï¸ Ú©Ù„Ø§Ø³ Ù…Ø±Ø¨ÙˆØ· Ø¨Ù‡ Ø§ÛŒÙ† Ú¯Ø²Ø§Ø±Ø´ ÛŒØ§ÙØª Ù†Ø´Ø¯.");return}Ze(Z),ue(),setTimeout(()=>{switch(R.type){case"VIEW_STUDENT_PROFILE":{const H=Z.students.find(ne=>ne.identity.studentId===R.studentId);H?We(H):j("âš ï¸ Ø¯Ø§Ù†Ø´â€ŒØ¢Ù…ÙˆØ² Ù…ÙˆØ±Ø¯ Ù†Ø¸Ø± ÛŒØ§ÙØª Ù†Ø´Ø¯.");break}case"VIEW_TRASH":Sn(),Ee("trash-page");break;case"VIEW_SESSIONS":Ge(),Ee("session-page");break;case"VIEW_CLASS_NOTE":bs(Z);break;case"VIEW_CLASS_SETTINGS":xt(Z);break}},300)}le.addEventListener("click",()=>{Pi()}),O.addEventListener("click",()=>{ue()}),A.addEventListener("click",()=>{const R=oe.value.trim(),Z=ee.checked;if(!R){Oi.style.display==="flex"?he("Ú©Ø§Ø¯Ø± ÛŒØ§Ø¯Ø¯Ø§Ø´Øª Ø®Ø§Ù„ÛŒ Ø§Ø³Øª. Ø¢ÛŒØ§ Ù…Ø·Ù…Ø¦Ù†ÛŒØ¯ Ú©Ù‡ Ù…ÛŒâ€ŒØ®ÙˆØ§Ù‡ÛŒØ¯ ÛŒØ§Ø¯Ø¯Ø§Ø´Øªâ€ŒÙ‡Ø§ÛŒ Ù‚Ø¨Ù„ÛŒ Ø¯Ø§Ù†Ø´â€ŒØ¢Ù…ÙˆØ²Ø§Ù† Ø§Ù†ØªØ®Ø§Ø¨â€ŒØ´Ø¯Ù‡ Ø±Ø§ Ù¾Ø§Ú© Ú©Ù†ÛŒØ¯ØŸ",()=>{ue(),qs("",!1)},{confirmText:"Ù¾Ø§Ú© Ú©Ø±Ø¯Ù†",confirmClass:"btn-warning"}):j("âš ï¸ Ù„Ø·ÙØ§Ù‹ Ù…ØªÙ† ÛŒØ§Ø¯Ø¯Ø§Ø´Øª Ø±Ø§ ÙˆØ§Ø±Ø¯ Ú©Ù†ÛŒØ¯.");return}ue(()=>{qs(R,Z)})}),document.getElementById("app-settings-modal");const Ht=document.getElementById("app-settings-nav-btn"),tt=document.getElementById("close-settings-btn"),tn=document.getElementById("setting-sound-toggle"),Ln=document.getElementById("setting-vibration-toggle"),Tn=document.getElementById("setting-screensaver-toggle");Be.isScreenSaverEnabled&&Ys(),$c(Tn),Ht&&Ht.addEventListener("click",()=>{qe(),tn.checked=Be.isSoundEnabled,Ln.checked=Be.isVibrationEnabled,Tn.checked=Be.isScreenSaverEnabled,De("app-settings-modal")}),tt&&tt.addEventListener("click",()=>{ue()}),tn.addEventListener("change",R=>{wt({isSoundEnabled:R.target.checked}),R.target.checked&&zn()}),Ln.addEventListener("change",R=>{wt({isVibrationEnabled:R.target.checked}),R.target.checked&&navigator.vibrate&&navigator.vibrate(50)}),Be.isScreenSaverEnabled&&Ys(),Mt(y,()=>{qi()}),ve.addEventListener("click",()=>{vn((R,Z,H)=>{if(R){if(D.categories.some(ne=>ne.name.toLowerCase()===R.toLowerCase())){j("âš ï¸ Ø§ÛŒÙ† Ø¯Ø³ØªÙ‡â€ŒØ¨Ù†Ø¯ÛŒ Ù‚Ø¨Ù„Ø§Ù‹ Ø§Ø¶Ø§ÙÙ‡ Ø´Ø¯Ù‡ Ø§Ø³Øª.");return}D.categories.push(new pn(R,"",Z,H)),se(),en()}}),mr()}),Me&&Me.addEventListener("change",_n)});function qe(){za.style.width="0",Fs.classList.add("modal-closing"),setTimeout(()=>{Fs.classList.remove("modal-visible","modal-closing")},300)}function br(e,s){if(!K||K.isFinished){j("âš ï¸ Ø§Ù…Ú©Ø§Ù† Ù„ØºÙˆ Ø§Ù†ØªØ®Ø§Ø¨ Ø¯Ø± Ø¬Ù„Ø³Ù‡ Ø®Ø§ØªÙ…Ù‡ ÛŒØ§ÙØªÙ‡ ÙˆØ¬ÙˆØ¯ Ù†Ø¯Ø§Ø±Ø¯.");return}if(ht){he(`Ø¢ÛŒØ§ Ø§Ø² Ù„ØºÙˆ ÙˆØ¶Ø¹ÛŒØª Ù†Ù…Ø±Ù‡â€ŒØ¯Ù‡ÛŒ Â«${e.identity.name}Â» Ù…Ø·Ù…Ø¦Ù† Ù‡Ø³ØªÛŒØ¯ØŸ Ø§ÛŒÙ† Ø¯Ø§Ù†Ø´â€ŒØ¢Ù…ÙˆØ² Ø¨Ù‡ Ù„ÛŒØ³Øª Ø§Ù†ØªØ¸Ø§Ø± Ø¨Ø§Ø²Ù…ÛŒâ€ŒÚ¯Ø±Ø¯Ø¯.`,()=>{const a=Le.id,n=at[a];n&&(n.pickedCandidatesThisSession=n.pickedCandidatesThisSession.filter(r=>r!==e.identity.studentId)),Kt(null),Re(),Ae(),se(),j(`âœ… Â«${e.identity.name}Â» Ø¨Ù‡ Ù„ÛŒØ³Øª Ø§Ù†ØªØ¸Ø§Ø± Ù†Ù…Ø±Ù‡ Ø¨Ø§Ø²Ú¯Ø´Øª.`)});return}const t=K.winnerHistory;if(!(et===t.length-1)||t.length===0){j("âš ï¸ ÙÙ‚Ø· Ø¢Ø®Ø±ÛŒÙ† Ø§Ù†ØªØ®Ø§Ø¨ Ù‚Ø§Ø¨Ù„ Ù„ØºÙˆ Ø§Ø³Øª.");return}if(t[t.length-1].winner.identity.studentId!==e.identity.studentId){console.error("Undo mismatch!");return}he(`Ø¢ÛŒØ§ Ø§Ø² Ø­Ø°Ù Ø§Ù†ØªØ®Ø§Ø¨ Â«${e.identity.name}Â» Ø¨Ø±Ø§ÛŒ Â«${s}Â» Ù…Ø·Ù…Ø¦Ù† Ù‡Ø³ØªÛŒØ¯ØŸ Ø¢Ù…Ø§Ø± Ø§ÛŒÙ† Ø§Ù†ØªØ®Ø§Ø¨ Ø¨Ø§Ø²Ú¯Ø±Ø¯Ø§Ù†ÛŒ Ø®ÙˆØ§Ù‡Ø¯ Ø´Ø¯.`,()=>{const a=K.winnerHistory,n=a.pop();if(!n)return;const r=n.winner,i=n.categoryName,o=r.identity.studentId;r.statusCounters.totalSelections=Math.max(0,r.statusCounters.totalSelections-1),r.categoryCounts[i]&&(r.categoryCounts[i]=Math.max(0,r.categoryCounts[i]-1));const l=K.studentRecords[o];if(l&&l.selections[i]&&(l.selections[i]=Math.max(0,l.selections[i]-1)),n.rating){const m=n.rating;r.qualitativeStats&&r.qualitativeStats[i]&&r.qualitativeStats[i][m]>0&&r.qualitativeStats[i][m]--}let f=null;for(let m=a.length-1;m>=0;m--)if(a[m].categoryName===i){f=a[m].winner.identity.studentId;break}f?K.lastWinnerByCategory[i]=f:delete K.lastWinnerByCategory[i],Ct(a.length-1),Re(),Ae(),se(),j(`âœ… Ø§Ù†ØªØ®Ø§Ø¨ Â«${r.identity.name}Â» Ù„ØºÙˆ Ø´Ø¯.`)},{confirmText:"Ø¨Ù„Ù‡",confirmClass:"btn-warning"})}function Wc(e,s){const t=s.id;at[t]||(at[t]={assessmentCandidates:[],pickedCandidatesThisSession:[]});const c=at[t],n=ge(e.students).filter(o=>!c.pickedCandidatesThisSession.includes(o.identity.studentId));if(n.length===0)return c.assessmentCandidates=[],[];const r=n.map(o=>Ts(o,s.name)),i=Math.min(...r);return c.assessmentCandidates=n.filter(o=>Ts(o,s.name)===i).map(o=>o.identity.studentId),c.assessmentCandidates}function Cr(e,s){const t=Wc(e,s);if(t.length===0)return null;const c=Math.floor(Math.random()*t.length),a=t[c];return _i(s.id,a),e.students.find(n=>n.identity.studentId===a)}function qi(){if(!Le){j("âš ï¸ Ø§Ø¨ØªØ¯Ø§ ÛŒÚ© Ø¯Ø³ØªÙ‡â€ŒØ¨Ù†Ø¯ÛŒ Ø§Ù†ØªØ®Ø§Ø¨ Ú©Ù†ÛŒØ¯.");return}if(!Le.isGradedCategory){j("âš ï¸ Ø§ÛŒÙ† Ø¯Ø³ØªÙ‡â€ŒØ¨Ù†Ø¯ÛŒ Ù†Ù…Ø±Ù‡â€ŒØ¯Ø§Ø± Ù†ÛŒØ³Øª.");return}di(!ht),Ct(-1),Kt(null),Ae(),En(Le),ws();const e=ht?"Ø­Ø§Ù„Øª Â«Ù†Ù…Ø±Ù‡â€ŒØ¯Ù‡ÛŒÂ» ÙØ¹Ø§Ù„ Ø´Ø¯ âœ…":"Ø­Ø§Ù„Øª Â«Ø§Ù†ØªØ®Ø§Ø¨Â» ÙØ¹Ø§Ù„ Ø´Ø¯ âœ…";vs?(vt(),j("Ø­Ø§Ù„Øª Ø§Ù†ØªØ®Ø§Ø¨ Ø¨Ø±Ø§ÛŒ Ù†Ù…Ø±Ù‡â€ŒØ¯Ù‡ÛŒ ØºÛŒØ±ÙØ¹Ø§Ù„ Ø´Ø¯. Ø¯Ø³ØªÙ‡â€ŒØ¨Ù†Ø¯ÛŒ Ø§Ù†ØªØ®Ø§Ø¨ Ø´Ø¯Ù‡ Ù‚Ø§Ø¨Ù„ Ù†Ù…Ø±Ù‡ Ø¯Ù‡ÛŒ Ù†ÛŒØ³Øª.âš ï¸",4500),Qa(!1)):(vt(),j(e))}function ws(){Lt&&Lt.classList.toggle("assessment-mode-active",ht)}
