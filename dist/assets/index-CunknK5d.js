const yr=Object.freeze(Object.defineProperty({__proto__:null,get devModeClicks(){return Zs},get exposeToConsole(){return zi}},Symbol.toStringTag,{value:"Module"})),vr=Object.freeze(Object.defineProperty({__proto__:null,get closeSideNav(){return je},get handleUndoLastSelection(){return mr},get navigateUpHierarchy(){return $i},get pickAssessmentWinner(){return hr}},Symbol.toStringTag,{value:"Module"}));(function(){const s=document.createElement("link").relList;if(s&&s.supports&&s.supports("modulepreload"))return;for(const a of document.querySelectorAll('link[rel="modulepreload"]'))c(a);new MutationObserver(a=>{for(const n of a)if(n.type==="childList")for(const r of n.addedNodes)r.tagName==="LINK"&&r.rel==="modulepreload"&&c(r)}).observe(document,{childList:!0,subtree:!0});function t(a){const n={};return a.integrity&&(n.integrity=a.integrity),a.referrerPolicy&&(n.referrerPolicy=a.referrerPolicy),a.crossOrigin==="use-credentials"?n.credentials="include":a.crossOrigin==="anonymous"?n.credentials="omit":n.credentials="same-origin",n}function c(a){if(a.ep)return;a.ep=!0;const n=t(a);fetch(a.href,n)}})();const Dt={ili:{id:"ili",label:"Ú©Ø§Ù†ÙˆÙ† Ø²Ø¨Ø§Ù† Ø§ÛŒØ±Ø§Ù†",ageGroups:{kids:["Primer 1","Primer 2","Step Up 1","Step Up 2","Step Up 3","Step Up 4","Move Up 1","Move Up 2","Move Up 3","Move Up 4","Jump Up 1","Jump Up 2","Jump Up 3","Jump Up 4"],youngAdults:["Start 1","Run 1","Run 2","Run 3","Run 4","Race 1","Race 2","Race 3","Reach 1","Reach 2","Reach 3","Reach 4"],adults:["Basic 1","Basic 2","Basic 3","Elementary 1","Elementary 2","Elementary 3","Pre-intermediate 1","Pre-intermediate 2","Pre-intermediate 3","Intermediate 1","Intermediate 2","Intermediate 3","High-intermediate 1","High-intermediate 2","High-intermediate 3","Advanced 1","Advanced 2","Advanced 3"]},levels:[]},school:{id:"school",label:"Ø¢Ù…ÙˆØ²Ø´ Ùˆ Ù¾Ø±ÙˆØ±Ø´",levels:["Ú©Ù„Ø§Ø³ Ø§ÙˆÙ„","Ú©Ù„Ø§Ø³ Ø¯ÙˆÙ…","Ú©Ù„Ø§Ø³ Ø³ÙˆÙ…","Ú©Ù„Ø§Ø³ Ú†Ù‡Ø§Ø±Ù…","Ú©Ù„Ø§Ø³ Ù¾Ù†Ø¬Ù…","Ú©Ù„Ø§Ø³ Ø´Ø´Ù…","Ú©Ù„Ø§Ø³ Ù‡ÙØªÙ…","Ú©Ù„Ø§Ø³ Ù‡Ø´ØªÙ…","Ú©Ù„Ø§Ø³ Ù†Ù‡Ù…","Ú©Ù„Ø§Ø³ Ø¯Ù‡Ù…","Ú©Ù„Ø§Ø³ ÛŒØ§Ø²Ø¯Ù‡Ù…","Ú©Ù„Ø§Ø³ Ø¯ÙˆØ§Ø²Ø¯Ù‡Ù…"]},custom:{id:"custom",label:"Ø³Ø§ÛŒØ± / Ø¢Ø²Ø§Ø¯",levels:[]}};Dt.ili.levels=[...Dt.ili.ageGroups.kids,...Dt.ili.ageGroups.youngAdults,...Dt.ili.ageGroups.adults];const Ki={ili:{default:[{name:"Ø¹Ù…ÙˆÙ…ÛŒ",description:"Ø¯Ø³ØªÙ‡â€ŒØ¨Ù†Ø¯ÛŒ Ù¾ÛŒØ´â€ŒÙØ±Ø¶",isGraded:!0,weight:1}],levels:{}}};Dt.ili.ageGroups.adults.forEach(e=>{Ki.ili.levels[e]=[{name:"Listen-Speak",description:"Listening and Speaking",isGraded:!0,weight:3},{name:"Reading",description:"",isGraded:!0,weight:2},{name:"Writing",description:"",isGraded:!0,weight:1}]});function br(e,s){const t=Ki[e];if(!t)return[new pn("Ø¹Ù…ÙˆÙ…ÛŒ","Ø¯Ø³ØªÙ‡â€ŒØ¨Ù†Ø¯ÛŒ Ù¾ÛŒØ´â€ŒÙØ±Ø¶",!0,1)];let c=t.levels[s];return c||(c=t.default),c.map(a=>new pn(a.name,a.description||"",a.isGraded||!1,a.weight||1))}class Zn{constructor(s){this.identity={name:s.name,firstName:s.firstName||null,lastName:s.lastName||null,studentId:s.studentId||`id_${new Date().getTime()}_${Math.random()}`,branchName:s.branchName||null,ageGroup:s.ageGroup||"adult",level:s.level||null,contact:{social:s.socialContact||null,parent:s.parentContact||null}},this.isDeleted=!1,this.statusCounters={totalSelections:0,missedChances:0,earlyLeaves:0,outOfClassCount:0},this.categoryCounts={},this.categoryIssues={},this.qualitativeStats={},this.logs={parentContacts:[],scores:{},discipline:{},sessionHistory:{}},this.profile={notes:[],tags:[]},this.finalClassActivityScore=null,this.onboardingSession=null}addScore(s,t,c){if(t>100||t<0){console.log("Ù†Ù…Ø±Ù‡ Ù†Ø¨Ø§ÛŒØ¯ Ø§Ø² Û±Û°Û° Ø¨ÛŒØ´ØªØ± Ùˆ Ø§Ø² ØµÙØ± Ú©Ù…ØªØ± Ø¨Ø§Ø´Ø¯");return}const a=s.toLowerCase();this.logs.scores[a]||(this.logs.scores[a]=[]);const n=new Cr(s,t,c);this.logs.scores[a].push(n)}addNote(s,t=null){const c=new wr(s,t);this.profile.notes.push(c)}getOverallAverageScore(){let s=0,t=0;for(const a in this.logs.scores)this.logs.scores[a].forEach(n=>{n.isDeleted||(s+=n.value,t++)});if(t===0)return null;const c=s/t;return Math.trunc(c*10)/10}}class Cr{constructor(s,t,c=""){this.id=`score_${new Date().getTime()}`,this.skill=s,this.value=t,this.timestamp=new Date,this.comment=c,this.isDeleted=!1}}class wr{constructor(s,t=null){this.id=`note_${new Date().getTime()}`,this.timestamp=new Date,this.content=s,this.isDeleted=!1,this.source=t}}class xs{constructor(s="complete",t=""){this.status=s,this.comment=t,this.timestamp=new Date}}class Yi{constructor(s){this.sessionNumber=s,this.startTime=new Date,this.createdAt=new Date,this.note="",this.isDeleted=!1,this.endTime=null,this.isFinished=!1,this.isMakeup=!1,this.isCancelled=!1,this.studentRecords={},this.lastWinnerByCategory={},this.lastUsedCategoryId=null,this.lastSelectedWinnerId=null,this.winnerHistory=[]}end(){this.isFinished=!0,this.endTime=new Date}markAsMakeup(){this.isMakeup=!this.isMakeup}initializeStudentRecord(s){this.studentRecords[s]||(this.studentRecords[s]={attendance:"present",homework:new xs,selections:{},hadIssue:!1,wasOutOfClass:!1,performanceRatings:{}})}setAttendance(s,t){this.initializeStudentRecord(s),this.studentRecords[s].attendance=t}setHomeworkStatus(s,t){this.initializeStudentRecord(s),this.studentRecords[s].homework.status=t}selectNextWinner(s,t,c){if(!t||t.length===0)return console.log("Ù‡ÛŒÚ† Ø¯Ø§Ù†Ø´â€ŒØ¢Ù…ÙˆØ²ÛŒ Ø¯Ø± Ú©Ù„Ø§Ø³ Ø¨Ø±Ø§ÛŒ Ø§Ù†ØªØ®Ø§Ø¨ ÙˆØ¬ÙˆØ¯ Ù†Ø¯Ø§Ø±Ø¯."),null;const a=this.lastWinnerByCategory[s];let n=t.filter(m=>m.identity.studentId!==a&&!m.isDeleted);if(n.length===0&&(n=t),n.length===0)return null;const r=(m,h)=>m.categoryCounts[h]||0,i=Math.min(...n.map(m=>r(m,s))),o=n.filter(m=>r(m,s)===i);let l;if(o.length===1)l=o[0];else if(o.length>1){const m=c.filter(v=>!v.isDeleted&&v.name!==s).map(v=>v.name),h=o.map(v=>{const b=m.reduce((C,S)=>C+r(v,S),0);return{student:v,otherCategoriesTotal:b}}),y=Math.min(...h.map(v=>v.otherCategoriesTotal)),u=h.filter(v=>v.otherCategoriesTotal===y).map(v=>v.student);u.length===1?l=u[0]:l=u[Math.floor(Math.random()*u.length)]}else l=n[Math.floor(Math.random()*n.length)];const f=l.identity.studentId;this.initializeStudentRecord(f);const p=(this.studentRecords[f].selections[s]||0)+1;return this.studentRecords[f].selections[s]=p,l.statusCounters.totalSelections++,l.categoryCounts[s]=(l.categoryCounts[s]||0)+1,this.lastWinnerByCategory[s]=f,l}}class Vs{constructor(s){this.info={name:s.name||"NotNamed",teacherName:s.teacherName||null,type:s.type||"in-person",educationalSystem:s.educationalSystem||"custom",term:s.term||null,scheduleText:s.scheduleText||null,level:s.level||null,creationDate:s.creationDate?new Date(s.creationDate):new Date,scheduleCode:s.scheduleCode||`code_${new Date().getTime()}`,scheduleDays:s.scheduleDays||[],scheduleStartTime:s.scheduleStartTime||null,scheduleEndTime:s.scheduleEndTime||null},this.students=[],this.sessions=[],this.note="",this.isDeleted=!1,this.categories=br(this.info.educationalSystem,this.info.level),this.futurePlans={}}addStudent(s){this.students.push(s)}startNewSession(){const t=this.sessions.reduce((a,n)=>Math.max(a,n.sessionNumber),0)+1,c=new Yi(t);return this.sessions.push(c),c}endSpecificSession(s){const t=this.getSession(s);return t&&!t.isFinished?(t.end(),!0):!1}getSession(s){return this.sessions.find(t=>t.sessionNumber===s)}markAsMakeup(s){const t=this.getSession(s);t&&t.markAsMakeup()}planForSession(s,t){this.futurePlans[s]=t}hasSessionToday(){const s=new Date().toDateString();return this.sessions.some(t=>!t.isDeleted&&t.startTime.toDateString()===s)}selectNextWinner(s,t){return t?t.selectNextWinner(s,this.students,this.categories):null}get liveSession(){for(let s=this.sessions.length-1;s>=0;s--)if(!this.sessions[s].isFinished)return this.sessions[s];return null}calculateFinalStudentScore(s){var r;const t=this.categories.filter(i=>i.isGradedCategory&&!i.isDeleted);if(t.length===0)return null;let c=0,a=0;for(const i of t){const o=i.name.toLowerCase(),l=((r=s.logs.scores[o])==null?void 0:r.filter(p=>!p.isDeleted))||[];if(l.length===0)return null;const f=l.reduce((p,m)=>p+m.value,0)/l.length;c+=f*(i.weight||1),a+=i.weight||1}if(a===0)return null;const n=c/a;return Math.trunc(n*10)/10}}class pn{constructor(s,t="",c=!1,a=1){this.id=`cat_${new Date().getTime()}_${Math.random()}`,this.name=s,this.description=t,this.isDeleted=!1,this.isGradedCategory=c,this.weight=a,this.isDeleted=!1}}var Mn=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function Xi(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}var Qi={exports:{}};(function(e){var s=function(){var t=String.fromCharCode,c="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",a="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+-$",n={};function r(o,l){if(!n[o]){n[o]={};for(var f=0;f<o.length;f++)n[o][o.charAt(f)]=f}return n[o][l]}var i={compressToBase64:function(o){if(o==null)return"";var l=i._compress(o,6,function(f){return c.charAt(f)});switch(l.length%4){default:case 0:return l;case 1:return l+"===";case 2:return l+"==";case 3:return l+"="}},decompressFromBase64:function(o){return o==null?"":o==""?null:i._decompress(o.length,32,function(l){return r(c,o.charAt(l))})},compressToUTF16:function(o){return o==null?"":i._compress(o,15,function(l){return t(l+32)})+" "},decompressFromUTF16:function(o){return o==null?"":o==""?null:i._decompress(o.length,16384,function(l){return o.charCodeAt(l)-32})},compressToUint8Array:function(o){for(var l=i.compress(o),f=new Uint8Array(l.length*2),p=0,m=l.length;p<m;p++){var h=l.charCodeAt(p);f[p*2]=h>>>8,f[p*2+1]=h%256}return f},decompressFromUint8Array:function(o){if(o==null)return i.decompress(o);for(var l=new Array(o.length/2),f=0,p=l.length;f<p;f++)l[f]=o[f*2]*256+o[f*2+1];var m=[];return l.forEach(function(h){m.push(t(h))}),i.decompress(m.join(""))},compressToEncodedURIComponent:function(o){return o==null?"":i._compress(o,6,function(l){return a.charAt(l)})},decompressFromEncodedURIComponent:function(o){return o==null?"":o==""?null:(o=o.replace(/ /g,"+"),i._decompress(o.length,32,function(l){return r(a,o.charAt(l))}))},compress:function(o){return i._compress(o,16,function(l){return t(l)})},_compress:function(o,l,f){if(o==null)return"";var p,m,h={},y={},u="",v="",b="",C=2,S=3,_=2,k=[],x=0,L=0,B;for(B=0;B<o.length;B+=1)if(u=o.charAt(B),Object.prototype.hasOwnProperty.call(h,u)||(h[u]=S++,y[u]=!0),v=b+u,Object.prototype.hasOwnProperty.call(h,v))b=v;else{if(Object.prototype.hasOwnProperty.call(y,b)){if(b.charCodeAt(0)<256){for(p=0;p<_;p++)x=x<<1,L==l-1?(L=0,k.push(f(x)),x=0):L++;for(m=b.charCodeAt(0),p=0;p<8;p++)x=x<<1|m&1,L==l-1?(L=0,k.push(f(x)),x=0):L++,m=m>>1}else{for(m=1,p=0;p<_;p++)x=x<<1|m,L==l-1?(L=0,k.push(f(x)),x=0):L++,m=0;for(m=b.charCodeAt(0),p=0;p<16;p++)x=x<<1|m&1,L==l-1?(L=0,k.push(f(x)),x=0):L++,m=m>>1}C--,C==0&&(C=Math.pow(2,_),_++),delete y[b]}else for(m=h[b],p=0;p<_;p++)x=x<<1|m&1,L==l-1?(L=0,k.push(f(x)),x=0):L++,m=m>>1;C--,C==0&&(C=Math.pow(2,_),_++),h[v]=S++,b=String(u)}if(b!==""){if(Object.prototype.hasOwnProperty.call(y,b)){if(b.charCodeAt(0)<256){for(p=0;p<_;p++)x=x<<1,L==l-1?(L=0,k.push(f(x)),x=0):L++;for(m=b.charCodeAt(0),p=0;p<8;p++)x=x<<1|m&1,L==l-1?(L=0,k.push(f(x)),x=0):L++,m=m>>1}else{for(m=1,p=0;p<_;p++)x=x<<1|m,L==l-1?(L=0,k.push(f(x)),x=0):L++,m=0;for(m=b.charCodeAt(0),p=0;p<16;p++)x=x<<1|m&1,L==l-1?(L=0,k.push(f(x)),x=0):L++,m=m>>1}C--,C==0&&(C=Math.pow(2,_),_++),delete y[b]}else for(m=h[b],p=0;p<_;p++)x=x<<1|m&1,L==l-1?(L=0,k.push(f(x)),x=0):L++,m=m>>1;C--,C==0&&(C=Math.pow(2,_),_++)}for(m=2,p=0;p<_;p++)x=x<<1|m&1,L==l-1?(L=0,k.push(f(x)),x=0):L++,m=m>>1;for(;;)if(x=x<<1,L==l-1){k.push(f(x));break}else L++;return k.join("")},decompress:function(o){return o==null?"":o==""?null:i._decompress(o.length,32768,function(l){return o.charCodeAt(l)})},_decompress:function(o,l,f){var p=[],m=4,h=4,y=3,u="",v=[],b,C,S,_,k,x,L,B={val:f(0),position:l,index:1};for(b=0;b<3;b+=1)p[b]=b;for(S=0,k=Math.pow(2,2),x=1;x!=k;)_=B.val&B.position,B.position>>=1,B.position==0&&(B.position=l,B.val=f(B.index++)),S|=(_>0?1:0)*x,x<<=1;switch(S){case 0:for(S=0,k=Math.pow(2,8),x=1;x!=k;)_=B.val&B.position,B.position>>=1,B.position==0&&(B.position=l,B.val=f(B.index++)),S|=(_>0?1:0)*x,x<<=1;L=t(S);break;case 1:for(S=0,k=Math.pow(2,16),x=1;x!=k;)_=B.val&B.position,B.position>>=1,B.position==0&&(B.position=l,B.val=f(B.index++)),S|=(_>0?1:0)*x,x<<=1;L=t(S);break;case 2:return""}for(p[3]=L,C=L,v.push(L);;){if(B.index>o)return"";for(S=0,k=Math.pow(2,y),x=1;x!=k;)_=B.val&B.position,B.position>>=1,B.position==0&&(B.position=l,B.val=f(B.index++)),S|=(_>0?1:0)*x,x<<=1;switch(L=S){case 0:for(S=0,k=Math.pow(2,8),x=1;x!=k;)_=B.val&B.position,B.position>>=1,B.position==0&&(B.position=l,B.val=f(B.index++)),S|=(_>0?1:0)*x,x<<=1;p[h++]=t(S),L=h-1,m--;break;case 1:for(S=0,k=Math.pow(2,16),x=1;x!=k;)_=B.val&B.position,B.position>>=1,B.position==0&&(B.position=l,B.val=f(B.index++)),S|=(_>0?1:0)*x,x<<=1;p[h++]=t(S),L=h-1,m--;break;case 2:return v.join("")}if(m==0&&(m=Math.pow(2,y),y++),p[L])u=p[L];else if(L===h)u=C+C.charAt(0);else return null;v.push(u),p[h++]=C+u.charAt(0),m--,C=u,m==0&&(m=Math.pow(2,y),y++)}}};return i}();e!=null?e.exports=s:typeof angular<"u"&&angular!=null&&angular.module("LZString",[]).factory("LZString",function(){return s})})(Qi);var Er=Qi.exports;const ea=Xi(Er);function Sr(e){return new Worker("/assets/compression.worker-B3kqe_bR.js",{name:e==null?void 0:e.name})}let ie={},N=null,Js=null,K=null,_e=null,gn=null,hs=null,Ks=[],Vn=null,Ys=null,Me=null,it={},Jn=0,Xs=0,Kn=0,Qs=0,ei=null,ti=null,Yn=null,vt=null,tt=-1,ni=null,Xn=null,Qn=null,es=null,ta=null,na=null,yt=!1;function si(e){yt=e}let sa=null;function ii(e){sa=e}let Ue=[],st=[],Rt=[],ze={isScreenSaverEnabled:!0,isSoundEnabled:!0,isVibrationEnabled:!0,lastRestoreTimestamp:null,lastBackupTimestamp:null},ia=new Set,Nt=!1;function aa(e){Nt=e}let ai=!1;function ri(e){ai=e}let Ht=null;const oi=new Sr;oi.onmessage=e=>{const s=e.data;try{localStorage.setItem("teacherAssistantData_v2",s),console.log("Background save complete.")}catch(t){console.error("Background storage failed:",t)}};oi.onerror=e=>{console.error("âŒ Worker Communication Error:",e.message,e)};function se(e=!1){if(yt)return;const t=JSON.stringify({classrooms:ie,trashBin:Ue,userSettings:ze});if(e){Ht&&clearTimeout(Ht);try{const c=ea.compressToUTF16(t);localStorage.setItem("teacherAssistantData_v2",c),console.log("Immediate save complete.")}catch(c){console.error("Immediate save failed:",c)}return}Ht&&clearTimeout(Ht),Ht=setTimeout(()=>{oi.postMessage(t),Ht=null},500)}function ci(){const e=localStorage.getItem("teacherAssistantData_v2");if(!e)return;let s;try{const t=ea.decompressFromUTF16(e);t?s=JSON.parse(t):s=JSON.parse(e)}catch{console.log("Migration: Parsing legacy uncompressed data..."),s=JSON.parse(e)}s.classrooms!==void 0&&s.trashBin!==void 0?(zt(s.classrooms),Ue=s.trashBin||[],ze={...ze,...s.userSettings}):(zt(s),_r())}function _r(){const e=[];Object.values(ie).forEach(s=>{s.isDeleted?e.push({id:`trash_${Date.now()}_${Math.random()}`,timestamp:s.info.creationDate,type:"classroom",description:`Ú©Ù„Ø§Ø³ Â«${s.info.name}Â»`,restoreData:{name:s.info.name}}):s.students.forEach(t=>{t.isDeleted&&e.push({id:`trash_${Date.now()}_${Math.random()}`,timestamp:t.identity.studentId.split("_")[1],type:"student",description:`Ø¯Ø§Ù†Ø´â€ŒØ¢Ù…ÙˆØ² Â«${t.identity.name}Â»`,restoreData:{studentId:t.identity.studentId,classroomName:s.info.name}})})}),Ue.length===0&&e.length>0&&(Ue=e,console.log(`Migrated ${e.length} previously deleted item(s) to the new trash bin.`),se())}function ra(e){const s=new Zn(e.identity);return s.isDeleted=e.isDeleted,s.statusCounters=e.statusCounters,s.logs=e.logs,s.logs.scores||(s.logs.scores={}),s.profile=e.profile,s.finalClassActivityScore=e.finalClassActivityScore,s.categoryCounts=e.categoryCounts||{},s.categoryIssues=e.categoryIssues||{},s.qualitativeStats=e.qualitativeStats||{},s.onboardingSession=e.onboardingSession||null,s}function zt(e){ie={};for(const s in e){const t=e[s];let c;t.info?c=t.info:c={...t,name:s};const a=new Vs(c);a.isDeleted=t.isDeleted,a.note=t.note||"",a.students=(t.students||[]).map(ra),a.sessions=(t.sessions||[]).map(n=>{const r=new Yi(n.sessionNumber);r.isDeleted=n.isDeleted,r.note=n.note||"",r.startTime=new Date(n.startTime),r.createdAt=n.createdAt?new Date(n.createdAt):new Date(n.startTime),r.endTime=n.endTime?new Date(n.endTime):null,r.isFinished=n.isFinished,r.isMakeup=n.isMakeup,r.isCancelled=n.isCancelled||!1,r.studentRecords=n.studentRecords;for(const o in r.studentRecords){const l=r.studentRecords[o];l.homework&&!(l.homework instanceof xs)&&(r.studentRecords[o].homework=new xs(l.homework.status,l.homework.comment))}r.lastWinnerByCategory=n.lastWinnerByCategory,r.lastUsedCategoryId=n.lastUsedCategoryId,r.lastSelectedWinnerId=n.lastSelectedWinnerId;const i=n.winnerHistory||[];return r.winnerHistory=i.filter(o=>o&&o.winner).map(o=>({winner:a.students.find(f=>f.identity.studentId===o.winner.identity.studentId),categoryName:o.categoryName,rating:o.rating||null})).filter(o=>o.winner),r}),a.categories=(t.categories||[]).map(n=>{const r=new pn(n.name,n.description,n.isGradedCategory,n.weight||1);return r.id=n.id,r.isDeleted=n.isDeleted,r}),a.futurePlans=t.futurePlans,ie[s]=a}}function oa(e,s){if(ie[s])return{success:!1,message:"Ú©Ù„Ø§Ø³ÛŒ Ø¨Ø§ Ø§ÛŒÙ† Ù†Ø§Ù… Ø§Ø² Ù‚Ø¨Ù„ ÙˆØ¬ÙˆØ¯ Ø¯Ø§Ø±Ø¯."};const t=ie[e];return t?(t.info.name=s,ie[s]=t,delete ie[e],N===t&&Ge(t),{success:!0}):{success:!1,message:"Ú©Ù„Ø§Ø³ Ù…ÙˆØ±Ø¯ Ù†Ø¸Ø± ÛŒØ§ÙØª Ù†Ø´Ø¯."}}function ca(e,s,t){const c=t.trim();if(!c)return{success:!1,message:"Ù†Ø§Ù… Ø¯Ø³ØªÙ‡â€ŒØ¨Ù†Ø¯ÛŒ Ù†Ù…ÛŒâ€ŒØªÙˆØ§Ù†Ø¯ Ø®Ø§Ù„ÛŒ Ø¨Ø§Ø´Ø¯."};if(e.categories.some(o=>o.id!==s.id&&!o.isDeleted&&o.name.toLowerCase()===c.toLowerCase()))return{success:!1,message:"Ø¯Ø³ØªÙ‡â€ŒØ¨Ù†Ø¯ÛŒ Ø¯ÛŒÚ¯Ø±ÛŒ Ø¨Ø§ Ø§ÛŒÙ† Ù†Ø§Ù… ÙˆØ¬ÙˆØ¯ Ø¯Ø§Ø±Ø¯."};const n=s.name,r=n.toLowerCase(),i=c.toLowerCase();return s.name=c,e.students.forEach(o=>{o.categoryCounts&&o.categoryCounts[n]!==void 0&&(o.categoryCounts[c]=o.categoryCounts[n],delete o.categoryCounts[n]),o.categoryIssues&&o.categoryIssues[n]!==void 0&&(o.categoryIssues[c]=o.categoryIssues[n],delete o.categoryIssues[n]),o.logs.scores&&o.logs.scores[r]&&(o.logs.scores[r].forEach(l=>l.skill=c),r!==i&&(o.logs.scores[i]=o.logs.scores[r],delete o.logs.scores[r]))}),e.sessions.forEach(o=>{o.lastWinnerByCategory&&o.lastWinnerByCategory[n]&&(o.lastWinnerByCategory[c]=o.lastWinnerByCategory[n],delete o.lastWinnerByCategory[n]),o.winnerHistory&&o.winnerHistory.forEach(l=>{l.categoryName===n&&(l.categoryName=c)})}),{success:!0}}function la(e,s,t){if(ye(t.students).some(l=>l.identity.name.toLowerCase()===e.identity.name.toLowerCase()))return{success:!1,message:`Ø¯Ø§Ù†Ø´â€ŒØ¢Ù…ÙˆØ²ÛŒ Ø¨Ø§ Ù†Ø§Ù… Â«${e.identity.name}Â» Ø§Ø² Ù‚Ø¨Ù„ Ø¯Ø± Ú©Ù„Ø§Ø³ Â«${t.info.name}Â» ÙˆØ¬ÙˆØ¯ Ø¯Ø§Ø±Ø¯.`};const a=JSON.parse(JSON.stringify(e)),n=ra(a),r=new Map;s.sessions.forEach(l=>{const f=l.studentRecords[e.identity.studentId];f&&r.set(l.sessionNumber,JSON.parse(JSON.stringify(f)))}),t.addStudent(n);try{const l=ye(t.sessions).filter(v=>!v.isCancelled).sort((v,b)=>b.sessionNumber-v.sessionNumber),f=l.length>0?l[0]:null;let p="ØŸ",m={type:"system",description:"Student Move"};f&&(p=dt(t).get(f.sessionNumber)||f.sessionNumber,m={type:"fromSession",sessionNumber:f.sessionNumber});const h=new Date().toLocaleDateString("fa-IR"),y=s.info.name,u=`Ø§ÛŒÙ† Ø¯Ø§Ù†Ø´ Ø¢Ù…ÙˆØ² Ø¯Ø± Ø¬Ù„Ø³Ù‡ ${p} Ùˆ Ø¯Ø± ØªØ§Ø±ÛŒØ® ${h} Ø§Ø² Ú©Ù„Ø§Ø³ Â«${y}Â» Ø¨Ù‡ Ø§ÛŒÙ† Ú©Ù„Ø§Ø³ Ø§Ù†ØªÙ‚Ø§Ù„ Ù¾ÛŒØ¯Ø§ Ú©Ø±Ø¯`;n.addNote(u,m)}catch(l){console.error("Failed to add automated move note:",l)}r.size>0&&t.sessions.forEach(l=>{const f=r.get(l.sessionNumber);f&&!l.isDeleted&&!l.isCancelled&&(l.studentRecords[n.identity.studentId]=f)});const i={id:`trash_${Date.now()}_${Math.random()}`,timestamp:new Date().toISOString(),type:"student",description:`(Ø§Ù†ØªÙ‚Ø§Ù„) Ø¯Ø§Ù†Ø´â€ŒØ¢Ù…ÙˆØ² Â«${e.identity.name}Â» Ø§Ø² Ú©Ù„Ø§Ø³ Â«${s.info.name}Â»`,restoreData:{studentId:e.identity.studentId,classId:s.info.scheduleCode}};lt(i);const o=s.students.find(l=>l.identity.studentId===e.identity.studentId);return o&&(o.isDeleted=!0),{success:!0}}function da(){for(const e in ie){const s=ie[e];s.students.forEach(t=>{t.statusCounters={totalSelections:0,missedChances:0,earlyLeaves:0},t.categoryCounts={},t.categoryIssues={},s.sessions.forEach(c=>{const a=t.identity.studentId;c.studentRecords[a]&&(c.studentRecords[a].attendance="present")})})}se()}function ye(e){return Array.isArray(e)?e.filter(s=>!s.isDeleted):[]}function dt(e){const s=new Map;return e&&ye(e.sessions).filter(c=>!c.isCancelled).sort((c,a)=>c.sessionNumber-a.sessionNumber).forEach((c,a)=>{s.set(c.sessionNumber,a+1)}),s}function bt(e){tt=e}function ut(e){ni=e}function ps(e,s){if(!e||!s)return;const t=e.identity.studentId,c=s.students.findIndex(a=>a.identity.studentId===t);c>-1&&s.students.splice(c,1),s.sessions.forEach(a=>{a.studentRecords[t]&&delete a.studentRecords[t];for(const n in a.lastWinnerByCategory)a.lastWinnerByCategory[n]===t&&delete a.lastWinnerByCategory[n];a.lastSelectedWinnerId===t&&(a.lastSelectedWinnerId=null),a.winnerHistory=a.winnerHistory.filter(n=>n.winner&&n.winner.identity.studentId!==t)})}function li(e,s){const t=ie[e];if(!t)return;const c=t.sessions.findIndex(a=>a.sessionNumber===s);c>-1&&(t.students.forEach(a=>{a.profile.notes&&a.profile.notes.length>0&&(a.profile.notes=a.profile.notes.filter(n=>!n.source||n.source.type!=="fromAttendance"||n.source.sessionNumber!==s)),a.onboardingSession===s&&(a.onboardingSession=null)}),t.sessions.splice(c,1))}function di(e,s){const t=ie[e];if(!t)return;const c=t.categories.findIndex(i=>i.id===s);if(c===-1)return;const n=t.categories[c].name,r=n.toLowerCase();t.students.forEach(i=>{i.categoryCounts&&delete i.categoryCounts[n],i.categoryIssues&&delete i.categoryIssues[n],i.logs.scores&&delete i.logs.scores[r]}),t.sessions.forEach(i=>{i.lastWinnerByCategory[n]&&delete i.lastWinnerByCategory[n],i.winnerHistory=i.winnerHistory.filter(o=>o.categoryName!==n)}),t.categories.splice(c,1)}function ui(e,s,t,c){const a=ie[e];if(!a)return;const n=a.students.find(o=>o.identity.studentId===s);if(!n||!n.logs.scores[t.toLowerCase()])return;const r=n.logs.scores[t.toLowerCase()],i=r.findIndex(o=>o.id===c);i>-1&&r.splice(i,1)}function fi(e,s,t){const c=ie[e];if(!c)return;const a=c.students.find(r=>r.identity.studentId===s);if(!a||!a.profile.notes)return;const n=a.profile.notes.findIndex(r=>r.id===t);n>-1&&a.profile.notes.splice(n,1)}function lt(e){for(Ue.unshift(e);Ue.length>50;){const s=Ue.pop();ua(s)}se()}function ua(e){var s;if(!(!e||!e.restoreData))switch(console.log(`ðŸ—‘ï¸ Auto-cleaning overflow item: ${e.description}`),e.type){case"classroom":e.restoreData.name&&ie[e.restoreData.name]&&delete ie[e.restoreData.name];break;case"student":(s=e.restoreData.identity)!=null&&s.studentId&&ps(e.restoreData.identity.studentId);break;case"session":e.restoreData.id&&li(e.restoreData.id);break;case"category":e.restoreData.id&&di(e.restoreData.id);break;case"score":ui(e.restoreData);break;case"note":e.restoreData.id&&fi(e.restoreData.id);break}}function Ge(e){N=e}function yn(e){Js=e}function at(e){K=e}function It(e){_e=e}function ts(e){gn=e}function fa(e){hs=e}function sn(e){Ks=e}function Rn(e){Vn=e}function ma(e){Ys=e}function ns(e){Me=e}function zn(e){Jn=e}function ha(e){Xs=e}function $n(e){Kn=e}function pa(e){Qs=e}function mi(e){ei=e}function hi(e){ti=e}function vn(e){Yn=e}function pi(e){vt=e}function Jt(e){Qn=e}function ga(e){ta=e}function ya(e){na=e}function gi(e){Ue=e}function bn(e){Xn=e}function Cn(e){Rt=e}function _t(e){ze={...ze,...e},se()}function Pn(e){st=e}function yi(){ze.lastBackupTimestamp=new Date().toISOString(),se()}function ss(e){es=e}function kr(){ia.clear()}function Ir(e){it=e}function xr(){it={}}function vi(e,s){it[e]||(it[e]={toBeScored:[],scoredThisSession:[]}),it[e].scoredThisSession.includes(s)||it[e].scoredThisSession.push(s)}const va=Object.freeze(Object.defineProperty({__proto__:null,get activeModal(){return vt},addToTrashBin:lt,get assessmentPools(){return it},assessmentSessionExclusions:ia,get cancelCallback(){return ti},get classrooms(){return ie},get confirmCallback(){return ei},get currentClassroom(){return N},get datePickerCallback(){return es},get easterEggClickCount(){return Jn},get easterEggLastClickTime(){return Xs},getActiveItems:ye,getSessionDisplayMap:dt,get importedFileContent(){return Vn},get isAssessmentModeActive(){return Nt},get isDemoMode(){return yt},get isModalTransitioning(){return ai},get liveSession(){return Js},loadData:ci,get manualSelection(){return Qn},markStudentAsScoredInSession:vi,moveStudent:la,get namesToImport(){return Ks},get notificationTimeout(){return Ys},get originalStateBackup(){return sa},permanentlyDeleteCategory:di,permanentlyDeleteFromTrash:ua,permanentlyDeleteNote:fi,permanentlyDeleteScore:ui,permanentlyDeleteSession:li,permanentlyDeleteStudent:ps,get previousState(){return gn},rehydrateData:zt,renameCategory:ca,renameClassroom:oa,resetAllStudentCounters:da,resetAssessmentExclusions:kr,resetAssessmentPools:xr,get resetEasterEggClickCount(){return Kn},get resetEasterEggLastClickTime(){return Qs},get saveCategoryCallback(){return Xn},saveData:se,get saveNoteCallback(){return ni},get secureConfirmCallback(){return Yn},get selectedCategory(){return Me},get selectedClassIds(){return st},get selectedSession(){return K},get selectedStudentForProfile(){return _e},get selectedStudentsForMassComment(){return Rt},setActiveModal:pi,setAssessmentPools:Ir,setCancelCallback:hi,setConfirmCallback:mi,setCurrentClassroom:Ge,setDatePickerCallback:ss,setEasterEggClickCount:zn,setEasterEggLastClickTime:ha,setImportedFileContent:Rn,setIsAssessmentModeActive:aa,setIsDemoMode:si,setIsModalTransitioning:ri,setLastBackupTimestamp:yi,setLiveSession:yn,setManualSelection:Jt,setNamesToImport:sn,setNotificationTimeout:ma,setOriginalStateBackup:ii,setPreviousState:ts,setResetEasterEggClickCount:$n,setResetEasterEggLastClickTime:pa,setSaveCategoryCallback:bn,setSaveNoteCallback:ut,setSecureConfirmCallback:vn,setSelectedCategory:ns,setSelectedClassIds:Pn,setSelectedSession:at,setSelectedStudentForProfile:It,setSelectedStudentsForMassComment:Cn,setSourceClassForMove:ya,setStudentToMove:ga,setTrashBin:gi,setUndoTimeout:fa,setUserSettings:_t,setWinnerHistoryIndex:bt,get sourceClassForMove(){return na},get studentToMove(){return ta},get trashBin(){return Ue},get undoTimeout(){return hs},get userSettings(){return ze},get winnerHistoryIndex(){return tt}},Symbol.toStringTag,{value:"Module"})),Lr="TeacherAssistantDB",Tr=1,ht="backups";function bi(){return new Promise((e,s)=>{const t=indexedDB.open(Lr,Tr);t.onupgradeneeded=c=>{const a=c.target.result;a.objectStoreNames.contains(ht)||a.createObjectStore(ht,{keyPath:"id"})},t.onsuccess=c=>e(c.target.result),t.onerror=c=>s(c.target.error)})}async function ba(e,s){const t=await bi(),c=t.transaction(ht,"readwrite"),a=c.objectStore(ht),n={id:Date.now(),file:e,metadata:s,timestamp:new Date().toISOString()};a.add(n),c.oncomplete=()=>{const i=t.transaction(ht,"readwrite").objectStore(ht),o=i.count();o.onsuccess=()=>{if(o.result>10){const l=i.getAllKeys();l.onsuccess=()=>{const f=l.result;for(;f.length>10;){const p=f.shift();i.delete(p),console.log(`â™»ï¸ Auto-deleted old backup snapshot: ${p}`)}}}}}}async function Ca(){const e=await bi();return new Promise((s,t)=>{const n=e.transaction(ht,"readonly").objectStore(ht).getAll();n.onsuccess=()=>{const r=n.result.sort((i,o)=>o.id-i.id);s(r)},n.onerror=()=>t(n.error)})}async function Br(e){(await bi()).transaction(ht,"readwrite").objectStore(ht).delete(e)}const Dr=Object.freeze(Object.defineProperty({__proto__:null,addBackupSnapshot:ba,deleteBackupSnapshot:Br,getBackupSnapshots:Ca},Symbol.toStringTag,{value:"Module"}));function On(e){throw new Error('Could not dynamically require "'+e+'". Please configure the dynamicRequireTargets or/and ignoreDynamicRequires option of @rollup/plugin-commonjs appropriately for this require call to work.')}var wa={exports:{}};/*!

JSZip v3.10.1 - A JavaScript class for generating and reading zip files
<http://stuartk.com/jszip>

(c) 2009-2016 Stuart Knightley <stuart [at] stuartk.com>
Dual licenced under the MIT license or GPLv3. See https://raw.github.com/Stuk/jszip/main/LICENSE.markdown.

JSZip uses the library pako released under the MIT license :
https://github.com/nodeca/pako/blob/main/LICENSE
*/(function(e,s){(function(t){e.exports=t()})(function(){return function t(c,a,n){function r(l,f){if(!a[l]){if(!c[l]){var p=typeof On=="function"&&On;if(!f&&p)return p(l,!0);if(i)return i(l,!0);var m=new Error("Cannot find module '"+l+"'");throw m.code="MODULE_NOT_FOUND",m}var h=a[l]={exports:{}};c[l][0].call(h.exports,function(y){var u=c[l][1][y];return r(u||y)},h,h.exports,t,c,a,n)}return a[l].exports}for(var i=typeof On=="function"&&On,o=0;o<n.length;o++)r(n[o]);return r}({1:[function(t,c,a){var n=t("./utils"),r=t("./support"),i="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";a.encode=function(o){for(var l,f,p,m,h,y,u,v=[],b=0,C=o.length,S=C,_=n.getTypeOf(o)!=="string";b<o.length;)S=C-b,p=_?(l=o[b++],f=b<C?o[b++]:0,b<C?o[b++]:0):(l=o.charCodeAt(b++),f=b<C?o.charCodeAt(b++):0,b<C?o.charCodeAt(b++):0),m=l>>2,h=(3&l)<<4|f>>4,y=1<S?(15&f)<<2|p>>6:64,u=2<S?63&p:64,v.push(i.charAt(m)+i.charAt(h)+i.charAt(y)+i.charAt(u));return v.join("")},a.decode=function(o){var l,f,p,m,h,y,u=0,v=0,b="data:";if(o.substr(0,b.length)===b)throw new Error("Invalid base64 input, it looks like a data url.");var C,S=3*(o=o.replace(/[^A-Za-z0-9+/=]/g,"")).length/4;if(o.charAt(o.length-1)===i.charAt(64)&&S--,o.charAt(o.length-2)===i.charAt(64)&&S--,S%1!=0)throw new Error("Invalid base64 input, bad content length.");for(C=r.uint8array?new Uint8Array(0|S):new Array(0|S);u<o.length;)l=i.indexOf(o.charAt(u++))<<2|(m=i.indexOf(o.charAt(u++)))>>4,f=(15&m)<<4|(h=i.indexOf(o.charAt(u++)))>>2,p=(3&h)<<6|(y=i.indexOf(o.charAt(u++))),C[v++]=l,h!==64&&(C[v++]=f),y!==64&&(C[v++]=p);return C}},{"./support":30,"./utils":32}],2:[function(t,c,a){var n=t("./external"),r=t("./stream/DataWorker"),i=t("./stream/Crc32Probe"),o=t("./stream/DataLengthProbe");function l(f,p,m,h,y){this.compressedSize=f,this.uncompressedSize=p,this.crc32=m,this.compression=h,this.compressedContent=y}l.prototype={getContentWorker:function(){var f=new r(n.Promise.resolve(this.compressedContent)).pipe(this.compression.uncompressWorker()).pipe(new o("data_length")),p=this;return f.on("end",function(){if(this.streamInfo.data_length!==p.uncompressedSize)throw new Error("Bug : uncompressed data size mismatch")}),f},getCompressedWorker:function(){return new r(n.Promise.resolve(this.compressedContent)).withStreamInfo("compressedSize",this.compressedSize).withStreamInfo("uncompressedSize",this.uncompressedSize).withStreamInfo("crc32",this.crc32).withStreamInfo("compression",this.compression)}},l.createWorkerFrom=function(f,p,m){return f.pipe(new i).pipe(new o("uncompressedSize")).pipe(p.compressWorker(m)).pipe(new o("compressedSize")).withStreamInfo("compression",p)},c.exports=l},{"./external":6,"./stream/Crc32Probe":25,"./stream/DataLengthProbe":26,"./stream/DataWorker":27}],3:[function(t,c,a){var n=t("./stream/GenericWorker");a.STORE={magic:"\0\0",compressWorker:function(){return new n("STORE compression")},uncompressWorker:function(){return new n("STORE decompression")}},a.DEFLATE=t("./flate")},{"./flate":7,"./stream/GenericWorker":28}],4:[function(t,c,a){var n=t("./utils"),r=function(){for(var i,o=[],l=0;l<256;l++){i=l;for(var f=0;f<8;f++)i=1&i?3988292384^i>>>1:i>>>1;o[l]=i}return o}();c.exports=function(i,o){return i!==void 0&&i.length?n.getTypeOf(i)!=="string"?function(l,f,p,m){var h=r,y=m+p;l^=-1;for(var u=m;u<y;u++)l=l>>>8^h[255&(l^f[u])];return-1^l}(0|o,i,i.length,0):function(l,f,p,m){var h=r,y=m+p;l^=-1;for(var u=m;u<y;u++)l=l>>>8^h[255&(l^f.charCodeAt(u))];return-1^l}(0|o,i,i.length,0):0}},{"./utils":32}],5:[function(t,c,a){a.base64=!1,a.binary=!1,a.dir=!1,a.createFolders=!0,a.date=null,a.compression=null,a.compressionOptions=null,a.comment=null,a.unixPermissions=null,a.dosPermissions=null},{}],6:[function(t,c,a){var n=null;n=typeof Promise<"u"?Promise:t("lie"),c.exports={Promise:n}},{lie:37}],7:[function(t,c,a){var n=typeof Uint8Array<"u"&&typeof Uint16Array<"u"&&typeof Uint32Array<"u",r=t("pako"),i=t("./utils"),o=t("./stream/GenericWorker"),l=n?"uint8array":"array";function f(p,m){o.call(this,"FlateWorker/"+p),this._pako=null,this._pakoAction=p,this._pakoOptions=m,this.meta={}}a.magic="\b\0",i.inherits(f,o),f.prototype.processChunk=function(p){this.meta=p.meta,this._pako===null&&this._createPako(),this._pako.push(i.transformTo(l,p.data),!1)},f.prototype.flush=function(){o.prototype.flush.call(this),this._pako===null&&this._createPako(),this._pako.push([],!0)},f.prototype.cleanUp=function(){o.prototype.cleanUp.call(this),this._pako=null},f.prototype._createPako=function(){this._pako=new r[this._pakoAction]({raw:!0,level:this._pakoOptions.level||-1});var p=this;this._pako.onData=function(m){p.push({data:m,meta:p.meta})}},a.compressWorker=function(p){return new f("Deflate",p)},a.uncompressWorker=function(){return new f("Inflate",{})}},{"./stream/GenericWorker":28,"./utils":32,pako:38}],8:[function(t,c,a){function n(h,y){var u,v="";for(u=0;u<y;u++)v+=String.fromCharCode(255&h),h>>>=8;return v}function r(h,y,u,v,b,C){var S,_,k=h.file,x=h.compression,L=C!==l.utf8encode,B=i.transformTo("string",C(k.name)),O=i.transformTo("string",l.utf8encode(k.name)),H=k.comment,Q=i.transformTo("string",C(H)),I=i.transformTo("string",l.utf8encode(H)),z=O.length!==k.name.length,g=I.length!==H.length,F="",oe="",Z="",de=k.dir,V=k.date,le={crc32:0,compressedSize:0,uncompressedSize:0};y&&!u||(le.crc32=h.crc32,le.compressedSize=h.compressedSize,le.uncompressedSize=h.uncompressedSize);var R=0;y&&(R|=8),L||!z&&!g||(R|=2048);var A=0,ce=0;de&&(A|=16),b==="UNIX"?(ce=798,A|=function(X,xe){var De=X;return X||(De=xe?16893:33204),(65535&De)<<16}(k.unixPermissions,de)):(ce=20,A|=function(X){return 63&(X||0)}(k.dosPermissions)),S=V.getUTCHours(),S<<=6,S|=V.getUTCMinutes(),S<<=5,S|=V.getUTCSeconds()/2,_=V.getUTCFullYear()-1980,_<<=4,_|=V.getUTCMonth()+1,_<<=5,_|=V.getUTCDate(),z&&(oe=n(1,1)+n(f(B),4)+O,F+="up"+n(oe.length,2)+oe),g&&(Z=n(1,1)+n(f(Q),4)+I,F+="uc"+n(Z.length,2)+Z);var ee="";return ee+=`
\0`,ee+=n(R,2),ee+=x.magic,ee+=n(S,2),ee+=n(_,2),ee+=n(le.crc32,4),ee+=n(le.compressedSize,4),ee+=n(le.uncompressedSize,4),ee+=n(B.length,2),ee+=n(F.length,2),{fileRecord:p.LOCAL_FILE_HEADER+ee+B+F,dirRecord:p.CENTRAL_FILE_HEADER+n(ce,2)+ee+n(Q.length,2)+"\0\0\0\0"+n(A,4)+n(v,4)+B+F+Q}}var i=t("../utils"),o=t("../stream/GenericWorker"),l=t("../utf8"),f=t("../crc32"),p=t("../signature");function m(h,y,u,v){o.call(this,"ZipFileWorker"),this.bytesWritten=0,this.zipComment=y,this.zipPlatform=u,this.encodeFileName=v,this.streamFiles=h,this.accumulate=!1,this.contentBuffer=[],this.dirRecords=[],this.currentSourceOffset=0,this.entriesCount=0,this.currentFile=null,this._sources=[]}i.inherits(m,o),m.prototype.push=function(h){var y=h.meta.percent||0,u=this.entriesCount,v=this._sources.length;this.accumulate?this.contentBuffer.push(h):(this.bytesWritten+=h.data.length,o.prototype.push.call(this,{data:h.data,meta:{currentFile:this.currentFile,percent:u?(y+100*(u-v-1))/u:100}}))},m.prototype.openedSource=function(h){this.currentSourceOffset=this.bytesWritten,this.currentFile=h.file.name;var y=this.streamFiles&&!h.file.dir;if(y){var u=r(h,y,!1,this.currentSourceOffset,this.zipPlatform,this.encodeFileName);this.push({data:u.fileRecord,meta:{percent:0}})}else this.accumulate=!0},m.prototype.closedSource=function(h){this.accumulate=!1;var y=this.streamFiles&&!h.file.dir,u=r(h,y,!0,this.currentSourceOffset,this.zipPlatform,this.encodeFileName);if(this.dirRecords.push(u.dirRecord),y)this.push({data:function(v){return p.DATA_DESCRIPTOR+n(v.crc32,4)+n(v.compressedSize,4)+n(v.uncompressedSize,4)}(h),meta:{percent:100}});else for(this.push({data:u.fileRecord,meta:{percent:0}});this.contentBuffer.length;)this.push(this.contentBuffer.shift());this.currentFile=null},m.prototype.flush=function(){for(var h=this.bytesWritten,y=0;y<this.dirRecords.length;y++)this.push({data:this.dirRecords[y],meta:{percent:100}});var u=this.bytesWritten-h,v=function(b,C,S,_,k){var x=i.transformTo("string",k(_));return p.CENTRAL_DIRECTORY_END+"\0\0\0\0"+n(b,2)+n(b,2)+n(C,4)+n(S,4)+n(x.length,2)+x}(this.dirRecords.length,u,h,this.zipComment,this.encodeFileName);this.push({data:v,meta:{percent:100}})},m.prototype.prepareNextSource=function(){this.previous=this._sources.shift(),this.openedSource(this.previous.streamInfo),this.isPaused?this.previous.pause():this.previous.resume()},m.prototype.registerPrevious=function(h){this._sources.push(h);var y=this;return h.on("data",function(u){y.processChunk(u)}),h.on("end",function(){y.closedSource(y.previous.streamInfo),y._sources.length?y.prepareNextSource():y.end()}),h.on("error",function(u){y.error(u)}),this},m.prototype.resume=function(){return!!o.prototype.resume.call(this)&&(!this.previous&&this._sources.length?(this.prepareNextSource(),!0):this.previous||this._sources.length||this.generatedError?void 0:(this.end(),!0))},m.prototype.error=function(h){var y=this._sources;if(!o.prototype.error.call(this,h))return!1;for(var u=0;u<y.length;u++)try{y[u].error(h)}catch{}return!0},m.prototype.lock=function(){o.prototype.lock.call(this);for(var h=this._sources,y=0;y<h.length;y++)h[y].lock()},c.exports=m},{"../crc32":4,"../signature":23,"../stream/GenericWorker":28,"../utf8":31,"../utils":32}],9:[function(t,c,a){var n=t("../compressions"),r=t("./ZipFileWorker");a.generateWorker=function(i,o,l){var f=new r(o.streamFiles,l,o.platform,o.encodeFileName),p=0;try{i.forEach(function(m,h){p++;var y=function(C,S){var _=C||S,k=n[_];if(!k)throw new Error(_+" is not a valid compression method !");return k}(h.options.compression,o.compression),u=h.options.compressionOptions||o.compressionOptions||{},v=h.dir,b=h.date;h._compressWorker(y,u).withStreamInfo("file",{name:m,dir:v,date:b,comment:h.comment||"",unixPermissions:h.unixPermissions,dosPermissions:h.dosPermissions}).pipe(f)}),f.entriesCount=p}catch(m){f.error(m)}return f}},{"../compressions":3,"./ZipFileWorker":8}],10:[function(t,c,a){function n(){if(!(this instanceof n))return new n;if(arguments.length)throw new Error("The constructor with parameters has been removed in JSZip 3.0, please check the upgrade guide.");this.files=Object.create(null),this.comment=null,this.root="",this.clone=function(){var r=new n;for(var i in this)typeof this[i]!="function"&&(r[i]=this[i]);return r}}(n.prototype=t("./object")).loadAsync=t("./load"),n.support=t("./support"),n.defaults=t("./defaults"),n.version="3.10.1",n.loadAsync=function(r,i){return new n().loadAsync(r,i)},n.external=t("./external"),c.exports=n},{"./defaults":5,"./external":6,"./load":11,"./object":15,"./support":30}],11:[function(t,c,a){var n=t("./utils"),r=t("./external"),i=t("./utf8"),o=t("./zipEntries"),l=t("./stream/Crc32Probe"),f=t("./nodejsUtils");function p(m){return new r.Promise(function(h,y){var u=m.decompressed.getContentWorker().pipe(new l);u.on("error",function(v){y(v)}).on("end",function(){u.streamInfo.crc32!==m.decompressed.crc32?y(new Error("Corrupted zip : CRC32 mismatch")):h()}).resume()})}c.exports=function(m,h){var y=this;return h=n.extend(h||{},{base64:!1,checkCRC32:!1,optimizedBinaryString:!1,createFolders:!1,decodeFileName:i.utf8decode}),f.isNode&&f.isStream(m)?r.Promise.reject(new Error("JSZip can't accept a stream when loading a zip file.")):n.prepareContent("the loaded zip file",m,!0,h.optimizedBinaryString,h.base64).then(function(u){var v=new o(h);return v.load(u),v}).then(function(u){var v=[r.Promise.resolve(u)],b=u.files;if(h.checkCRC32)for(var C=0;C<b.length;C++)v.push(p(b[C]));return r.Promise.all(v)}).then(function(u){for(var v=u.shift(),b=v.files,C=0;C<b.length;C++){var S=b[C],_=S.fileNameStr,k=n.resolve(S.fileNameStr);y.file(k,S.decompressed,{binary:!0,optimizedBinaryString:!0,date:S.date,dir:S.dir,comment:S.fileCommentStr.length?S.fileCommentStr:null,unixPermissions:S.unixPermissions,dosPermissions:S.dosPermissions,createFolders:h.createFolders}),S.dir||(y.file(k).unsafeOriginalName=_)}return v.zipComment.length&&(y.comment=v.zipComment),y})}},{"./external":6,"./nodejsUtils":14,"./stream/Crc32Probe":25,"./utf8":31,"./utils":32,"./zipEntries":33}],12:[function(t,c,a){var n=t("../utils"),r=t("../stream/GenericWorker");function i(o,l){r.call(this,"Nodejs stream input adapter for "+o),this._upstreamEnded=!1,this._bindStream(l)}n.inherits(i,r),i.prototype._bindStream=function(o){var l=this;(this._stream=o).pause(),o.on("data",function(f){l.push({data:f,meta:{percent:0}})}).on("error",function(f){l.isPaused?this.generatedError=f:l.error(f)}).on("end",function(){l.isPaused?l._upstreamEnded=!0:l.end()})},i.prototype.pause=function(){return!!r.prototype.pause.call(this)&&(this._stream.pause(),!0)},i.prototype.resume=function(){return!!r.prototype.resume.call(this)&&(this._upstreamEnded?this.end():this._stream.resume(),!0)},c.exports=i},{"../stream/GenericWorker":28,"../utils":32}],13:[function(t,c,a){var n=t("readable-stream").Readable;function r(i,o,l){n.call(this,o),this._helper=i;var f=this;i.on("data",function(p,m){f.push(p)||f._helper.pause(),l&&l(m)}).on("error",function(p){f.emit("error",p)}).on("end",function(){f.push(null)})}t("../utils").inherits(r,n),r.prototype._read=function(){this._helper.resume()},c.exports=r},{"../utils":32,"readable-stream":16}],14:[function(t,c,a){c.exports={isNode:typeof Buffer<"u",newBufferFrom:function(n,r){if(Buffer.from&&Buffer.from!==Uint8Array.from)return Buffer.from(n,r);if(typeof n=="number")throw new Error('The "data" argument must not be a number');return new Buffer(n,r)},allocBuffer:function(n){if(Buffer.alloc)return Buffer.alloc(n);var r=new Buffer(n);return r.fill(0),r},isBuffer:function(n){return Buffer.isBuffer(n)},isStream:function(n){return n&&typeof n.on=="function"&&typeof n.pause=="function"&&typeof n.resume=="function"}}},{}],15:[function(t,c,a){function n(k,x,L){var B,O=i.getTypeOf(x),H=i.extend(L||{},f);H.date=H.date||new Date,H.compression!==null&&(H.compression=H.compression.toUpperCase()),typeof H.unixPermissions=="string"&&(H.unixPermissions=parseInt(H.unixPermissions,8)),H.unixPermissions&&16384&H.unixPermissions&&(H.dir=!0),H.dosPermissions&&16&H.dosPermissions&&(H.dir=!0),H.dir&&(k=b(k)),H.createFolders&&(B=v(k))&&C.call(this,B,!0);var Q=O==="string"&&H.binary===!1&&H.base64===!1;L&&L.binary!==void 0||(H.binary=!Q),(x instanceof p&&x.uncompressedSize===0||H.dir||!x||x.length===0)&&(H.base64=!1,H.binary=!0,x="",H.compression="STORE",O="string");var I=null;I=x instanceof p||x instanceof o?x:y.isNode&&y.isStream(x)?new u(k,x):i.prepareContent(k,x,H.binary,H.optimizedBinaryString,H.base64);var z=new m(k,I,H);this.files[k]=z}var r=t("./utf8"),i=t("./utils"),o=t("./stream/GenericWorker"),l=t("./stream/StreamHelper"),f=t("./defaults"),p=t("./compressedObject"),m=t("./zipObject"),h=t("./generate"),y=t("./nodejsUtils"),u=t("./nodejs/NodejsStreamInputAdapter"),v=function(k){k.slice(-1)==="/"&&(k=k.substring(0,k.length-1));var x=k.lastIndexOf("/");return 0<x?k.substring(0,x):""},b=function(k){return k.slice(-1)!=="/"&&(k+="/"),k},C=function(k,x){return x=x!==void 0?x:f.createFolders,k=b(k),this.files[k]||n.call(this,k,null,{dir:!0,createFolders:x}),this.files[k]};function S(k){return Object.prototype.toString.call(k)==="[object RegExp]"}var _={load:function(){throw new Error("This method has been removed in JSZip 3.0, please check the upgrade guide.")},forEach:function(k){var x,L,B;for(x in this.files)B=this.files[x],(L=x.slice(this.root.length,x.length))&&x.slice(0,this.root.length)===this.root&&k(L,B)},filter:function(k){var x=[];return this.forEach(function(L,B){k(L,B)&&x.push(B)}),x},file:function(k,x,L){if(arguments.length!==1)return k=this.root+k,n.call(this,k,x,L),this;if(S(k)){var B=k;return this.filter(function(H,Q){return!Q.dir&&B.test(H)})}var O=this.files[this.root+k];return O&&!O.dir?O:null},folder:function(k){if(!k)return this;if(S(k))return this.filter(function(O,H){return H.dir&&k.test(O)});var x=this.root+k,L=C.call(this,x),B=this.clone();return B.root=L.name,B},remove:function(k){k=this.root+k;var x=this.files[k];if(x||(k.slice(-1)!=="/"&&(k+="/"),x=this.files[k]),x&&!x.dir)delete this.files[k];else for(var L=this.filter(function(O,H){return H.name.slice(0,k.length)===k}),B=0;B<L.length;B++)delete this.files[L[B].name];return this},generate:function(){throw new Error("This method has been removed in JSZip 3.0, please check the upgrade guide.")},generateInternalStream:function(k){var x,L={};try{if((L=i.extend(k||{},{streamFiles:!1,compression:"STORE",compressionOptions:null,type:"",platform:"DOS",comment:null,mimeType:"application/zip",encodeFileName:r.utf8encode})).type=L.type.toLowerCase(),L.compression=L.compression.toUpperCase(),L.type==="binarystring"&&(L.type="string"),!L.type)throw new Error("No output type specified.");i.checkSupport(L.type),L.platform!=="darwin"&&L.platform!=="freebsd"&&L.platform!=="linux"&&L.platform!=="sunos"||(L.platform="UNIX"),L.platform==="win32"&&(L.platform="DOS");var B=L.comment||this.comment||"";x=h.generateWorker(this,L,B)}catch(O){(x=new o("error")).error(O)}return new l(x,L.type||"string",L.mimeType)},generateAsync:function(k,x){return this.generateInternalStream(k).accumulate(x)},generateNodeStream:function(k,x){return(k=k||{}).type||(k.type="nodebuffer"),this.generateInternalStream(k).toNodejsStream(x)}};c.exports=_},{"./compressedObject":2,"./defaults":5,"./generate":9,"./nodejs/NodejsStreamInputAdapter":12,"./nodejsUtils":14,"./stream/GenericWorker":28,"./stream/StreamHelper":29,"./utf8":31,"./utils":32,"./zipObject":35}],16:[function(t,c,a){c.exports=t("stream")},{stream:void 0}],17:[function(t,c,a){var n=t("./DataReader");function r(i){n.call(this,i);for(var o=0;o<this.data.length;o++)i[o]=255&i[o]}t("../utils").inherits(r,n),r.prototype.byteAt=function(i){return this.data[this.zero+i]},r.prototype.lastIndexOfSignature=function(i){for(var o=i.charCodeAt(0),l=i.charCodeAt(1),f=i.charCodeAt(2),p=i.charCodeAt(3),m=this.length-4;0<=m;--m)if(this.data[m]===o&&this.data[m+1]===l&&this.data[m+2]===f&&this.data[m+3]===p)return m-this.zero;return-1},r.prototype.readAndCheckSignature=function(i){var o=i.charCodeAt(0),l=i.charCodeAt(1),f=i.charCodeAt(2),p=i.charCodeAt(3),m=this.readData(4);return o===m[0]&&l===m[1]&&f===m[2]&&p===m[3]},r.prototype.readData=function(i){if(this.checkOffset(i),i===0)return[];var o=this.data.slice(this.zero+this.index,this.zero+this.index+i);return this.index+=i,o},c.exports=r},{"../utils":32,"./DataReader":18}],18:[function(t,c,a){var n=t("../utils");function r(i){this.data=i,this.length=i.length,this.index=0,this.zero=0}r.prototype={checkOffset:function(i){this.checkIndex(this.index+i)},checkIndex:function(i){if(this.length<this.zero+i||i<0)throw new Error("End of data reached (data length = "+this.length+", asked index = "+i+"). Corrupted zip ?")},setIndex:function(i){this.checkIndex(i),this.index=i},skip:function(i){this.setIndex(this.index+i)},byteAt:function(){},readInt:function(i){var o,l=0;for(this.checkOffset(i),o=this.index+i-1;o>=this.index;o--)l=(l<<8)+this.byteAt(o);return this.index+=i,l},readString:function(i){return n.transformTo("string",this.readData(i))},readData:function(){},lastIndexOfSignature:function(){},readAndCheckSignature:function(){},readDate:function(){var i=this.readInt(4);return new Date(Date.UTC(1980+(i>>25&127),(i>>21&15)-1,i>>16&31,i>>11&31,i>>5&63,(31&i)<<1))}},c.exports=r},{"../utils":32}],19:[function(t,c,a){var n=t("./Uint8ArrayReader");function r(i){n.call(this,i)}t("../utils").inherits(r,n),r.prototype.readData=function(i){this.checkOffset(i);var o=this.data.slice(this.zero+this.index,this.zero+this.index+i);return this.index+=i,o},c.exports=r},{"../utils":32,"./Uint8ArrayReader":21}],20:[function(t,c,a){var n=t("./DataReader");function r(i){n.call(this,i)}t("../utils").inherits(r,n),r.prototype.byteAt=function(i){return this.data.charCodeAt(this.zero+i)},r.prototype.lastIndexOfSignature=function(i){return this.data.lastIndexOf(i)-this.zero},r.prototype.readAndCheckSignature=function(i){return i===this.readData(4)},r.prototype.readData=function(i){this.checkOffset(i);var o=this.data.slice(this.zero+this.index,this.zero+this.index+i);return this.index+=i,o},c.exports=r},{"../utils":32,"./DataReader":18}],21:[function(t,c,a){var n=t("./ArrayReader");function r(i){n.call(this,i)}t("../utils").inherits(r,n),r.prototype.readData=function(i){if(this.checkOffset(i),i===0)return new Uint8Array(0);var o=this.data.subarray(this.zero+this.index,this.zero+this.index+i);return this.index+=i,o},c.exports=r},{"../utils":32,"./ArrayReader":17}],22:[function(t,c,a){var n=t("../utils"),r=t("../support"),i=t("./ArrayReader"),o=t("./StringReader"),l=t("./NodeBufferReader"),f=t("./Uint8ArrayReader");c.exports=function(p){var m=n.getTypeOf(p);return n.checkSupport(m),m!=="string"||r.uint8array?m==="nodebuffer"?new l(p):r.uint8array?new f(n.transformTo("uint8array",p)):new i(n.transformTo("array",p)):new o(p)}},{"../support":30,"../utils":32,"./ArrayReader":17,"./NodeBufferReader":19,"./StringReader":20,"./Uint8ArrayReader":21}],23:[function(t,c,a){a.LOCAL_FILE_HEADER="PK",a.CENTRAL_FILE_HEADER="PK",a.CENTRAL_DIRECTORY_END="PK",a.ZIP64_CENTRAL_DIRECTORY_LOCATOR="PK\x07",a.ZIP64_CENTRAL_DIRECTORY_END="PK",a.DATA_DESCRIPTOR="PK\x07\b"},{}],24:[function(t,c,a){var n=t("./GenericWorker"),r=t("../utils");function i(o){n.call(this,"ConvertWorker to "+o),this.destType=o}r.inherits(i,n),i.prototype.processChunk=function(o){this.push({data:r.transformTo(this.destType,o.data),meta:o.meta})},c.exports=i},{"../utils":32,"./GenericWorker":28}],25:[function(t,c,a){var n=t("./GenericWorker"),r=t("../crc32");function i(){n.call(this,"Crc32Probe"),this.withStreamInfo("crc32",0)}t("../utils").inherits(i,n),i.prototype.processChunk=function(o){this.streamInfo.crc32=r(o.data,this.streamInfo.crc32||0),this.push(o)},c.exports=i},{"../crc32":4,"../utils":32,"./GenericWorker":28}],26:[function(t,c,a){var n=t("../utils"),r=t("./GenericWorker");function i(o){r.call(this,"DataLengthProbe for "+o),this.propName=o,this.withStreamInfo(o,0)}n.inherits(i,r),i.prototype.processChunk=function(o){if(o){var l=this.streamInfo[this.propName]||0;this.streamInfo[this.propName]=l+o.data.length}r.prototype.processChunk.call(this,o)},c.exports=i},{"../utils":32,"./GenericWorker":28}],27:[function(t,c,a){var n=t("../utils"),r=t("./GenericWorker");function i(o){r.call(this,"DataWorker");var l=this;this.dataIsReady=!1,this.index=0,this.max=0,this.data=null,this.type="",this._tickScheduled=!1,o.then(function(f){l.dataIsReady=!0,l.data=f,l.max=f&&f.length||0,l.type=n.getTypeOf(f),l.isPaused||l._tickAndRepeat()},function(f){l.error(f)})}n.inherits(i,r),i.prototype.cleanUp=function(){r.prototype.cleanUp.call(this),this.data=null},i.prototype.resume=function(){return!!r.prototype.resume.call(this)&&(!this._tickScheduled&&this.dataIsReady&&(this._tickScheduled=!0,n.delay(this._tickAndRepeat,[],this)),!0)},i.prototype._tickAndRepeat=function(){this._tickScheduled=!1,this.isPaused||this.isFinished||(this._tick(),this.isFinished||(n.delay(this._tickAndRepeat,[],this),this._tickScheduled=!0))},i.prototype._tick=function(){if(this.isPaused||this.isFinished)return!1;var o=null,l=Math.min(this.max,this.index+16384);if(this.index>=this.max)return this.end();switch(this.type){case"string":o=this.data.substring(this.index,l);break;case"uint8array":o=this.data.subarray(this.index,l);break;case"array":case"nodebuffer":o=this.data.slice(this.index,l)}return this.index=l,this.push({data:o,meta:{percent:this.max?this.index/this.max*100:0}})},c.exports=i},{"../utils":32,"./GenericWorker":28}],28:[function(t,c,a){function n(r){this.name=r||"default",this.streamInfo={},this.generatedError=null,this.extraStreamInfo={},this.isPaused=!0,this.isFinished=!1,this.isLocked=!1,this._listeners={data:[],end:[],error:[]},this.previous=null}n.prototype={push:function(r){this.emit("data",r)},end:function(){if(this.isFinished)return!1;this.flush();try{this.emit("end"),this.cleanUp(),this.isFinished=!0}catch(r){this.emit("error",r)}return!0},error:function(r){return!this.isFinished&&(this.isPaused?this.generatedError=r:(this.isFinished=!0,this.emit("error",r),this.previous&&this.previous.error(r),this.cleanUp()),!0)},on:function(r,i){return this._listeners[r].push(i),this},cleanUp:function(){this.streamInfo=this.generatedError=this.extraStreamInfo=null,this._listeners=[]},emit:function(r,i){if(this._listeners[r])for(var o=0;o<this._listeners[r].length;o++)this._listeners[r][o].call(this,i)},pipe:function(r){return r.registerPrevious(this)},registerPrevious:function(r){if(this.isLocked)throw new Error("The stream '"+this+"' has already been used.");this.streamInfo=r.streamInfo,this.mergeStreamInfo(),this.previous=r;var i=this;return r.on("data",function(o){i.processChunk(o)}),r.on("end",function(){i.end()}),r.on("error",function(o){i.error(o)}),this},pause:function(){return!this.isPaused&&!this.isFinished&&(this.isPaused=!0,this.previous&&this.previous.pause(),!0)},resume:function(){if(!this.isPaused||this.isFinished)return!1;var r=this.isPaused=!1;return this.generatedError&&(this.error(this.generatedError),r=!0),this.previous&&this.previous.resume(),!r},flush:function(){},processChunk:function(r){this.push(r)},withStreamInfo:function(r,i){return this.extraStreamInfo[r]=i,this.mergeStreamInfo(),this},mergeStreamInfo:function(){for(var r in this.extraStreamInfo)Object.prototype.hasOwnProperty.call(this.extraStreamInfo,r)&&(this.streamInfo[r]=this.extraStreamInfo[r])},lock:function(){if(this.isLocked)throw new Error("The stream '"+this+"' has already been used.");this.isLocked=!0,this.previous&&this.previous.lock()},toString:function(){var r="Worker "+this.name;return this.previous?this.previous+" -> "+r:r}},c.exports=n},{}],29:[function(t,c,a){var n=t("../utils"),r=t("./ConvertWorker"),i=t("./GenericWorker"),o=t("../base64"),l=t("../support"),f=t("../external"),p=null;if(l.nodestream)try{p=t("../nodejs/NodejsStreamOutputAdapter")}catch{}function m(y,u){return new f.Promise(function(v,b){var C=[],S=y._internalType,_=y._outputType,k=y._mimeType;y.on("data",function(x,L){C.push(x),u&&u(L)}).on("error",function(x){C=[],b(x)}).on("end",function(){try{var x=function(L,B,O){switch(L){case"blob":return n.newBlob(n.transformTo("arraybuffer",B),O);case"base64":return o.encode(B);default:return n.transformTo(L,B)}}(_,function(L,B){var O,H=0,Q=null,I=0;for(O=0;O<B.length;O++)I+=B[O].length;switch(L){case"string":return B.join("");case"array":return Array.prototype.concat.apply([],B);case"uint8array":for(Q=new Uint8Array(I),O=0;O<B.length;O++)Q.set(B[O],H),H+=B[O].length;return Q;case"nodebuffer":return Buffer.concat(B);default:throw new Error("concat : unsupported type '"+L+"'")}}(S,C),k);v(x)}catch(L){b(L)}C=[]}).resume()})}function h(y,u,v){var b=u;switch(u){case"blob":case"arraybuffer":b="uint8array";break;case"base64":b="string"}try{this._internalType=b,this._outputType=u,this._mimeType=v,n.checkSupport(b),this._worker=y.pipe(new r(b)),y.lock()}catch(C){this._worker=new i("error"),this._worker.error(C)}}h.prototype={accumulate:function(y){return m(this,y)},on:function(y,u){var v=this;return y==="data"?this._worker.on(y,function(b){u.call(v,b.data,b.meta)}):this._worker.on(y,function(){n.delay(u,arguments,v)}),this},resume:function(){return n.delay(this._worker.resume,[],this._worker),this},pause:function(){return this._worker.pause(),this},toNodejsStream:function(y){if(n.checkSupport("nodestream"),this._outputType!=="nodebuffer")throw new Error(this._outputType+" is not supported by this method");return new p(this,{objectMode:this._outputType!=="nodebuffer"},y)}},c.exports=h},{"../base64":1,"../external":6,"../nodejs/NodejsStreamOutputAdapter":13,"../support":30,"../utils":32,"./ConvertWorker":24,"./GenericWorker":28}],30:[function(t,c,a){if(a.base64=!0,a.array=!0,a.string=!0,a.arraybuffer=typeof ArrayBuffer<"u"&&typeof Uint8Array<"u",a.nodebuffer=typeof Buffer<"u",a.uint8array=typeof Uint8Array<"u",typeof ArrayBuffer>"u")a.blob=!1;else{var n=new ArrayBuffer(0);try{a.blob=new Blob([n],{type:"application/zip"}).size===0}catch{try{var r=new(self.BlobBuilder||self.WebKitBlobBuilder||self.MozBlobBuilder||self.MSBlobBuilder);r.append(n),a.blob=r.getBlob("application/zip").size===0}catch{a.blob=!1}}}try{a.nodestream=!!t("readable-stream").Readable}catch{a.nodestream=!1}},{"readable-stream":16}],31:[function(t,c,a){for(var n=t("./utils"),r=t("./support"),i=t("./nodejsUtils"),o=t("./stream/GenericWorker"),l=new Array(256),f=0;f<256;f++)l[f]=252<=f?6:248<=f?5:240<=f?4:224<=f?3:192<=f?2:1;l[254]=l[254]=1;function p(){o.call(this,"utf-8 decode"),this.leftOver=null}function m(){o.call(this,"utf-8 encode")}a.utf8encode=function(h){return r.nodebuffer?i.newBufferFrom(h,"utf-8"):function(y){var u,v,b,C,S,_=y.length,k=0;for(C=0;C<_;C++)(64512&(v=y.charCodeAt(C)))==55296&&C+1<_&&(64512&(b=y.charCodeAt(C+1)))==56320&&(v=65536+(v-55296<<10)+(b-56320),C++),k+=v<128?1:v<2048?2:v<65536?3:4;for(u=r.uint8array?new Uint8Array(k):new Array(k),C=S=0;S<k;C++)(64512&(v=y.charCodeAt(C)))==55296&&C+1<_&&(64512&(b=y.charCodeAt(C+1)))==56320&&(v=65536+(v-55296<<10)+(b-56320),C++),v<128?u[S++]=v:(v<2048?u[S++]=192|v>>>6:(v<65536?u[S++]=224|v>>>12:(u[S++]=240|v>>>18,u[S++]=128|v>>>12&63),u[S++]=128|v>>>6&63),u[S++]=128|63&v);return u}(h)},a.utf8decode=function(h){return r.nodebuffer?n.transformTo("nodebuffer",h).toString("utf-8"):function(y){var u,v,b,C,S=y.length,_=new Array(2*S);for(u=v=0;u<S;)if((b=y[u++])<128)_[v++]=b;else if(4<(C=l[b]))_[v++]=65533,u+=C-1;else{for(b&=C===2?31:C===3?15:7;1<C&&u<S;)b=b<<6|63&y[u++],C--;1<C?_[v++]=65533:b<65536?_[v++]=b:(b-=65536,_[v++]=55296|b>>10&1023,_[v++]=56320|1023&b)}return _.length!==v&&(_.subarray?_=_.subarray(0,v):_.length=v),n.applyFromCharCode(_)}(h=n.transformTo(r.uint8array?"uint8array":"array",h))},n.inherits(p,o),p.prototype.processChunk=function(h){var y=n.transformTo(r.uint8array?"uint8array":"array",h.data);if(this.leftOver&&this.leftOver.length){if(r.uint8array){var u=y;(y=new Uint8Array(u.length+this.leftOver.length)).set(this.leftOver,0),y.set(u,this.leftOver.length)}else y=this.leftOver.concat(y);this.leftOver=null}var v=function(C,S){var _;for((S=S||C.length)>C.length&&(S=C.length),_=S-1;0<=_&&(192&C[_])==128;)_--;return _<0||_===0?S:_+l[C[_]]>S?_:S}(y),b=y;v!==y.length&&(r.uint8array?(b=y.subarray(0,v),this.leftOver=y.subarray(v,y.length)):(b=y.slice(0,v),this.leftOver=y.slice(v,y.length))),this.push({data:a.utf8decode(b),meta:h.meta})},p.prototype.flush=function(){this.leftOver&&this.leftOver.length&&(this.push({data:a.utf8decode(this.leftOver),meta:{}}),this.leftOver=null)},a.Utf8DecodeWorker=p,n.inherits(m,o),m.prototype.processChunk=function(h){this.push({data:a.utf8encode(h.data),meta:h.meta})},a.Utf8EncodeWorker=m},{"./nodejsUtils":14,"./stream/GenericWorker":28,"./support":30,"./utils":32}],32:[function(t,c,a){var n=t("./support"),r=t("./base64"),i=t("./nodejsUtils"),o=t("./external");function l(u){return u}function f(u,v){for(var b=0;b<u.length;++b)v[b]=255&u.charCodeAt(b);return v}t("setimmediate"),a.newBlob=function(u,v){a.checkSupport("blob");try{return new Blob([u],{type:v})}catch{try{var b=new(self.BlobBuilder||self.WebKitBlobBuilder||self.MozBlobBuilder||self.MSBlobBuilder);return b.append(u),b.getBlob(v)}catch{throw new Error("Bug : can't construct the Blob.")}}};var p={stringifyByChunk:function(u,v,b){var C=[],S=0,_=u.length;if(_<=b)return String.fromCharCode.apply(null,u);for(;S<_;)v==="array"||v==="nodebuffer"?C.push(String.fromCharCode.apply(null,u.slice(S,Math.min(S+b,_)))):C.push(String.fromCharCode.apply(null,u.subarray(S,Math.min(S+b,_)))),S+=b;return C.join("")},stringifyByChar:function(u){for(var v="",b=0;b<u.length;b++)v+=String.fromCharCode(u[b]);return v},applyCanBeUsed:{uint8array:function(){try{return n.uint8array&&String.fromCharCode.apply(null,new Uint8Array(1)).length===1}catch{return!1}}(),nodebuffer:function(){try{return n.nodebuffer&&String.fromCharCode.apply(null,i.allocBuffer(1)).length===1}catch{return!1}}()}};function m(u){var v=65536,b=a.getTypeOf(u),C=!0;if(b==="uint8array"?C=p.applyCanBeUsed.uint8array:b==="nodebuffer"&&(C=p.applyCanBeUsed.nodebuffer),C)for(;1<v;)try{return p.stringifyByChunk(u,b,v)}catch{v=Math.floor(v/2)}return p.stringifyByChar(u)}function h(u,v){for(var b=0;b<u.length;b++)v[b]=u[b];return v}a.applyFromCharCode=m;var y={};y.string={string:l,array:function(u){return f(u,new Array(u.length))},arraybuffer:function(u){return y.string.uint8array(u).buffer},uint8array:function(u){return f(u,new Uint8Array(u.length))},nodebuffer:function(u){return f(u,i.allocBuffer(u.length))}},y.array={string:m,array:l,arraybuffer:function(u){return new Uint8Array(u).buffer},uint8array:function(u){return new Uint8Array(u)},nodebuffer:function(u){return i.newBufferFrom(u)}},y.arraybuffer={string:function(u){return m(new Uint8Array(u))},array:function(u){return h(new Uint8Array(u),new Array(u.byteLength))},arraybuffer:l,uint8array:function(u){return new Uint8Array(u)},nodebuffer:function(u){return i.newBufferFrom(new Uint8Array(u))}},y.uint8array={string:m,array:function(u){return h(u,new Array(u.length))},arraybuffer:function(u){return u.buffer},uint8array:l,nodebuffer:function(u){return i.newBufferFrom(u)}},y.nodebuffer={string:m,array:function(u){return h(u,new Array(u.length))},arraybuffer:function(u){return y.nodebuffer.uint8array(u).buffer},uint8array:function(u){return h(u,new Uint8Array(u.length))},nodebuffer:l},a.transformTo=function(u,v){if(v=v||"",!u)return v;a.checkSupport(u);var b=a.getTypeOf(v);return y[b][u](v)},a.resolve=function(u){for(var v=u.split("/"),b=[],C=0;C<v.length;C++){var S=v[C];S==="."||S===""&&C!==0&&C!==v.length-1||(S===".."?b.pop():b.push(S))}return b.join("/")},a.getTypeOf=function(u){return typeof u=="string"?"string":Object.prototype.toString.call(u)==="[object Array]"?"array":n.nodebuffer&&i.isBuffer(u)?"nodebuffer":n.uint8array&&u instanceof Uint8Array?"uint8array":n.arraybuffer&&u instanceof ArrayBuffer?"arraybuffer":void 0},a.checkSupport=function(u){if(!n[u.toLowerCase()])throw new Error(u+" is not supported by this platform")},a.MAX_VALUE_16BITS=65535,a.MAX_VALUE_32BITS=-1,a.pretty=function(u){var v,b,C="";for(b=0;b<(u||"").length;b++)C+="\\x"+((v=u.charCodeAt(b))<16?"0":"")+v.toString(16).toUpperCase();return C},a.delay=function(u,v,b){setImmediate(function(){u.apply(b||null,v||[])})},a.inherits=function(u,v){function b(){}b.prototype=v.prototype,u.prototype=new b},a.extend=function(){var u,v,b={};for(u=0;u<arguments.length;u++)for(v in arguments[u])Object.prototype.hasOwnProperty.call(arguments[u],v)&&b[v]===void 0&&(b[v]=arguments[u][v]);return b},a.prepareContent=function(u,v,b,C,S){return o.Promise.resolve(v).then(function(_){return n.blob&&(_ instanceof Blob||["[object File]","[object Blob]"].indexOf(Object.prototype.toString.call(_))!==-1)&&typeof FileReader<"u"?new o.Promise(function(k,x){var L=new FileReader;L.onload=function(B){k(B.target.result)},L.onerror=function(B){x(B.target.error)},L.readAsArrayBuffer(_)}):_}).then(function(_){var k=a.getTypeOf(_);return k?(k==="arraybuffer"?_=a.transformTo("uint8array",_):k==="string"&&(S?_=r.decode(_):b&&C!==!0&&(_=function(x){return f(x,n.uint8array?new Uint8Array(x.length):new Array(x.length))}(_))),_):o.Promise.reject(new Error("Can't read the data of '"+u+"'. Is it in a supported JavaScript type (String, Blob, ArrayBuffer, etc) ?"))})}},{"./base64":1,"./external":6,"./nodejsUtils":14,"./support":30,setimmediate:54}],33:[function(t,c,a){var n=t("./reader/readerFor"),r=t("./utils"),i=t("./signature"),o=t("./zipEntry"),l=t("./support");function f(p){this.files=[],this.loadOptions=p}f.prototype={checkSignature:function(p){if(!this.reader.readAndCheckSignature(p)){this.reader.index-=4;var m=this.reader.readString(4);throw new Error("Corrupted zip or bug: unexpected signature ("+r.pretty(m)+", expected "+r.pretty(p)+")")}},isSignature:function(p,m){var h=this.reader.index;this.reader.setIndex(p);var y=this.reader.readString(4)===m;return this.reader.setIndex(h),y},readBlockEndOfCentral:function(){this.diskNumber=this.reader.readInt(2),this.diskWithCentralDirStart=this.reader.readInt(2),this.centralDirRecordsOnThisDisk=this.reader.readInt(2),this.centralDirRecords=this.reader.readInt(2),this.centralDirSize=this.reader.readInt(4),this.centralDirOffset=this.reader.readInt(4),this.zipCommentLength=this.reader.readInt(2);var p=this.reader.readData(this.zipCommentLength),m=l.uint8array?"uint8array":"array",h=r.transformTo(m,p);this.zipComment=this.loadOptions.decodeFileName(h)},readBlockZip64EndOfCentral:function(){this.zip64EndOfCentralSize=this.reader.readInt(8),this.reader.skip(4),this.diskNumber=this.reader.readInt(4),this.diskWithCentralDirStart=this.reader.readInt(4),this.centralDirRecordsOnThisDisk=this.reader.readInt(8),this.centralDirRecords=this.reader.readInt(8),this.centralDirSize=this.reader.readInt(8),this.centralDirOffset=this.reader.readInt(8),this.zip64ExtensibleData={};for(var p,m,h,y=this.zip64EndOfCentralSize-44;0<y;)p=this.reader.readInt(2),m=this.reader.readInt(4),h=this.reader.readData(m),this.zip64ExtensibleData[p]={id:p,length:m,value:h}},readBlockZip64EndOfCentralLocator:function(){if(this.diskWithZip64CentralDirStart=this.reader.readInt(4),this.relativeOffsetEndOfZip64CentralDir=this.reader.readInt(8),this.disksCount=this.reader.readInt(4),1<this.disksCount)throw new Error("Multi-volumes zip are not supported")},readLocalFiles:function(){var p,m;for(p=0;p<this.files.length;p++)m=this.files[p],this.reader.setIndex(m.localHeaderOffset),this.checkSignature(i.LOCAL_FILE_HEADER),m.readLocalPart(this.reader),m.handleUTF8(),m.processAttributes()},readCentralDir:function(){var p;for(this.reader.setIndex(this.centralDirOffset);this.reader.readAndCheckSignature(i.CENTRAL_FILE_HEADER);)(p=new o({zip64:this.zip64},this.loadOptions)).readCentralPart(this.reader),this.files.push(p);if(this.centralDirRecords!==this.files.length&&this.centralDirRecords!==0&&this.files.length===0)throw new Error("Corrupted zip or bug: expected "+this.centralDirRecords+" records in central dir, got "+this.files.length)},readEndOfCentral:function(){var p=this.reader.lastIndexOfSignature(i.CENTRAL_DIRECTORY_END);if(p<0)throw this.isSignature(0,i.LOCAL_FILE_HEADER)?new Error("Corrupted zip: can't find end of central directory"):new Error("Can't find end of central directory : is this a zip file ? If it is, see https://stuk.github.io/jszip/documentation/howto/read_zip.html");this.reader.setIndex(p);var m=p;if(this.checkSignature(i.CENTRAL_DIRECTORY_END),this.readBlockEndOfCentral(),this.diskNumber===r.MAX_VALUE_16BITS||this.diskWithCentralDirStart===r.MAX_VALUE_16BITS||this.centralDirRecordsOnThisDisk===r.MAX_VALUE_16BITS||this.centralDirRecords===r.MAX_VALUE_16BITS||this.centralDirSize===r.MAX_VALUE_32BITS||this.centralDirOffset===r.MAX_VALUE_32BITS){if(this.zip64=!0,(p=this.reader.lastIndexOfSignature(i.ZIP64_CENTRAL_DIRECTORY_LOCATOR))<0)throw new Error("Corrupted zip: can't find the ZIP64 end of central directory locator");if(this.reader.setIndex(p),this.checkSignature(i.ZIP64_CENTRAL_DIRECTORY_LOCATOR),this.readBlockZip64EndOfCentralLocator(),!this.isSignature(this.relativeOffsetEndOfZip64CentralDir,i.ZIP64_CENTRAL_DIRECTORY_END)&&(this.relativeOffsetEndOfZip64CentralDir=this.reader.lastIndexOfSignature(i.ZIP64_CENTRAL_DIRECTORY_END),this.relativeOffsetEndOfZip64CentralDir<0))throw new Error("Corrupted zip: can't find the ZIP64 end of central directory");this.reader.setIndex(this.relativeOffsetEndOfZip64CentralDir),this.checkSignature(i.ZIP64_CENTRAL_DIRECTORY_END),this.readBlockZip64EndOfCentral()}var h=this.centralDirOffset+this.centralDirSize;this.zip64&&(h+=20,h+=12+this.zip64EndOfCentralSize);var y=m-h;if(0<y)this.isSignature(m,i.CENTRAL_FILE_HEADER)||(this.reader.zero=y);else if(y<0)throw new Error("Corrupted zip: missing "+Math.abs(y)+" bytes.")},prepareReader:function(p){this.reader=n(p)},load:function(p){this.prepareReader(p),this.readEndOfCentral(),this.readCentralDir(),this.readLocalFiles()}},c.exports=f},{"./reader/readerFor":22,"./signature":23,"./support":30,"./utils":32,"./zipEntry":34}],34:[function(t,c,a){var n=t("./reader/readerFor"),r=t("./utils"),i=t("./compressedObject"),o=t("./crc32"),l=t("./utf8"),f=t("./compressions"),p=t("./support");function m(h,y){this.options=h,this.loadOptions=y}m.prototype={isEncrypted:function(){return(1&this.bitFlag)==1},useUTF8:function(){return(2048&this.bitFlag)==2048},readLocalPart:function(h){var y,u;if(h.skip(22),this.fileNameLength=h.readInt(2),u=h.readInt(2),this.fileName=h.readData(this.fileNameLength),h.skip(u),this.compressedSize===-1||this.uncompressedSize===-1)throw new Error("Bug or corrupted zip : didn't get enough information from the central directory (compressedSize === -1 || uncompressedSize === -1)");if((y=function(v){for(var b in f)if(Object.prototype.hasOwnProperty.call(f,b)&&f[b].magic===v)return f[b];return null}(this.compressionMethod))===null)throw new Error("Corrupted zip : compression "+r.pretty(this.compressionMethod)+" unknown (inner file : "+r.transformTo("string",this.fileName)+")");this.decompressed=new i(this.compressedSize,this.uncompressedSize,this.crc32,y,h.readData(this.compressedSize))},readCentralPart:function(h){this.versionMadeBy=h.readInt(2),h.skip(2),this.bitFlag=h.readInt(2),this.compressionMethod=h.readString(2),this.date=h.readDate(),this.crc32=h.readInt(4),this.compressedSize=h.readInt(4),this.uncompressedSize=h.readInt(4);var y=h.readInt(2);if(this.extraFieldsLength=h.readInt(2),this.fileCommentLength=h.readInt(2),this.diskNumberStart=h.readInt(2),this.internalFileAttributes=h.readInt(2),this.externalFileAttributes=h.readInt(4),this.localHeaderOffset=h.readInt(4),this.isEncrypted())throw new Error("Encrypted zip are not supported");h.skip(y),this.readExtraFields(h),this.parseZIP64ExtraField(h),this.fileComment=h.readData(this.fileCommentLength)},processAttributes:function(){this.unixPermissions=null,this.dosPermissions=null;var h=this.versionMadeBy>>8;this.dir=!!(16&this.externalFileAttributes),h==0&&(this.dosPermissions=63&this.externalFileAttributes),h==3&&(this.unixPermissions=this.externalFileAttributes>>16&65535),this.dir||this.fileNameStr.slice(-1)!=="/"||(this.dir=!0)},parseZIP64ExtraField:function(){if(this.extraFields[1]){var h=n(this.extraFields[1].value);this.uncompressedSize===r.MAX_VALUE_32BITS&&(this.uncompressedSize=h.readInt(8)),this.compressedSize===r.MAX_VALUE_32BITS&&(this.compressedSize=h.readInt(8)),this.localHeaderOffset===r.MAX_VALUE_32BITS&&(this.localHeaderOffset=h.readInt(8)),this.diskNumberStart===r.MAX_VALUE_32BITS&&(this.diskNumberStart=h.readInt(4))}},readExtraFields:function(h){var y,u,v,b=h.index+this.extraFieldsLength;for(this.extraFields||(this.extraFields={});h.index+4<b;)y=h.readInt(2),u=h.readInt(2),v=h.readData(u),this.extraFields[y]={id:y,length:u,value:v};h.setIndex(b)},handleUTF8:function(){var h=p.uint8array?"uint8array":"array";if(this.useUTF8())this.fileNameStr=l.utf8decode(this.fileName),this.fileCommentStr=l.utf8decode(this.fileComment);else{var y=this.findExtraFieldUnicodePath();if(y!==null)this.fileNameStr=y;else{var u=r.transformTo(h,this.fileName);this.fileNameStr=this.loadOptions.decodeFileName(u)}var v=this.findExtraFieldUnicodeComment();if(v!==null)this.fileCommentStr=v;else{var b=r.transformTo(h,this.fileComment);this.fileCommentStr=this.loadOptions.decodeFileName(b)}}},findExtraFieldUnicodePath:function(){var h=this.extraFields[28789];if(h){var y=n(h.value);return y.readInt(1)!==1||o(this.fileName)!==y.readInt(4)?null:l.utf8decode(y.readData(h.length-5))}return null},findExtraFieldUnicodeComment:function(){var h=this.extraFields[25461];if(h){var y=n(h.value);return y.readInt(1)!==1||o(this.fileComment)!==y.readInt(4)?null:l.utf8decode(y.readData(h.length-5))}return null}},c.exports=m},{"./compressedObject":2,"./compressions":3,"./crc32":4,"./reader/readerFor":22,"./support":30,"./utf8":31,"./utils":32}],35:[function(t,c,a){function n(y,u,v){this.name=y,this.dir=v.dir,this.date=v.date,this.comment=v.comment,this.unixPermissions=v.unixPermissions,this.dosPermissions=v.dosPermissions,this._data=u,this._dataBinary=v.binary,this.options={compression:v.compression,compressionOptions:v.compressionOptions}}var r=t("./stream/StreamHelper"),i=t("./stream/DataWorker"),o=t("./utf8"),l=t("./compressedObject"),f=t("./stream/GenericWorker");n.prototype={internalStream:function(y){var u=null,v="string";try{if(!y)throw new Error("No output type specified.");var b=(v=y.toLowerCase())==="string"||v==="text";v!=="binarystring"&&v!=="text"||(v="string"),u=this._decompressWorker();var C=!this._dataBinary;C&&!b&&(u=u.pipe(new o.Utf8EncodeWorker)),!C&&b&&(u=u.pipe(new o.Utf8DecodeWorker))}catch(S){(u=new f("error")).error(S)}return new r(u,v,"")},async:function(y,u){return this.internalStream(y).accumulate(u)},nodeStream:function(y,u){return this.internalStream(y||"nodebuffer").toNodejsStream(u)},_compressWorker:function(y,u){if(this._data instanceof l&&this._data.compression.magic===y.magic)return this._data.getCompressedWorker();var v=this._decompressWorker();return this._dataBinary||(v=v.pipe(new o.Utf8EncodeWorker)),l.createWorkerFrom(v,y,u)},_decompressWorker:function(){return this._data instanceof l?this._data.getContentWorker():this._data instanceof f?this._data:new i(this._data)}};for(var p=["asText","asBinary","asNodeBuffer","asUint8Array","asArrayBuffer"],m=function(){throw new Error("This method has been removed in JSZip 3.0, please check the upgrade guide.")},h=0;h<p.length;h++)n.prototype[p[h]]=m;c.exports=n},{"./compressedObject":2,"./stream/DataWorker":27,"./stream/GenericWorker":28,"./stream/StreamHelper":29,"./utf8":31}],36:[function(t,c,a){(function(n){var r,i,o=n.MutationObserver||n.WebKitMutationObserver;if(o){var l=0,f=new o(y),p=n.document.createTextNode("");f.observe(p,{characterData:!0}),r=function(){p.data=l=++l%2}}else if(n.setImmediate||n.MessageChannel===void 0)r="document"in n&&"onreadystatechange"in n.document.createElement("script")?function(){var u=n.document.createElement("script");u.onreadystatechange=function(){y(),u.onreadystatechange=null,u.parentNode.removeChild(u),u=null},n.document.documentElement.appendChild(u)}:function(){setTimeout(y,0)};else{var m=new n.MessageChannel;m.port1.onmessage=y,r=function(){m.port2.postMessage(0)}}var h=[];function y(){var u,v;i=!0;for(var b=h.length;b;){for(v=h,h=[],u=-1;++u<b;)v[u]();b=h.length}i=!1}c.exports=function(u){h.push(u)!==1||i||r()}}).call(this,typeof Mn<"u"?Mn:typeof self<"u"?self:typeof window<"u"?window:{})},{}],37:[function(t,c,a){var n=t("immediate");function r(){}var i={},o=["REJECTED"],l=["FULFILLED"],f=["PENDING"];function p(b){if(typeof b!="function")throw new TypeError("resolver must be a function");this.state=f,this.queue=[],this.outcome=void 0,b!==r&&u(this,b)}function m(b,C,S){this.promise=b,typeof C=="function"&&(this.onFulfilled=C,this.callFulfilled=this.otherCallFulfilled),typeof S=="function"&&(this.onRejected=S,this.callRejected=this.otherCallRejected)}function h(b,C,S){n(function(){var _;try{_=C(S)}catch(k){return i.reject(b,k)}_===b?i.reject(b,new TypeError("Cannot resolve promise with itself")):i.resolve(b,_)})}function y(b){var C=b&&b.then;if(b&&(typeof b=="object"||typeof b=="function")&&typeof C=="function")return function(){C.apply(b,arguments)}}function u(b,C){var S=!1;function _(L){S||(S=!0,i.reject(b,L))}function k(L){S||(S=!0,i.resolve(b,L))}var x=v(function(){C(k,_)});x.status==="error"&&_(x.value)}function v(b,C){var S={};try{S.value=b(C),S.status="success"}catch(_){S.status="error",S.value=_}return S}(c.exports=p).prototype.finally=function(b){if(typeof b!="function")return this;var C=this.constructor;return this.then(function(S){return C.resolve(b()).then(function(){return S})},function(S){return C.resolve(b()).then(function(){throw S})})},p.prototype.catch=function(b){return this.then(null,b)},p.prototype.then=function(b,C){if(typeof b!="function"&&this.state===l||typeof C!="function"&&this.state===o)return this;var S=new this.constructor(r);return this.state!==f?h(S,this.state===l?b:C,this.outcome):this.queue.push(new m(S,b,C)),S},m.prototype.callFulfilled=function(b){i.resolve(this.promise,b)},m.prototype.otherCallFulfilled=function(b){h(this.promise,this.onFulfilled,b)},m.prototype.callRejected=function(b){i.reject(this.promise,b)},m.prototype.otherCallRejected=function(b){h(this.promise,this.onRejected,b)},i.resolve=function(b,C){var S=v(y,C);if(S.status==="error")return i.reject(b,S.value);var _=S.value;if(_)u(b,_);else{b.state=l,b.outcome=C;for(var k=-1,x=b.queue.length;++k<x;)b.queue[k].callFulfilled(C)}return b},i.reject=function(b,C){b.state=o,b.outcome=C;for(var S=-1,_=b.queue.length;++S<_;)b.queue[S].callRejected(C);return b},p.resolve=function(b){return b instanceof this?b:i.resolve(new this(r),b)},p.reject=function(b){var C=new this(r);return i.reject(C,b)},p.all=function(b){var C=this;if(Object.prototype.toString.call(b)!=="[object Array]")return this.reject(new TypeError("must be an array"));var S=b.length,_=!1;if(!S)return this.resolve([]);for(var k=new Array(S),x=0,L=-1,B=new this(r);++L<S;)O(b[L],L);return B;function O(H,Q){C.resolve(H).then(function(I){k[Q]=I,++x!==S||_||(_=!0,i.resolve(B,k))},function(I){_||(_=!0,i.reject(B,I))})}},p.race=function(b){var C=this;if(Object.prototype.toString.call(b)!=="[object Array]")return this.reject(new TypeError("must be an array"));var S=b.length,_=!1;if(!S)return this.resolve([]);for(var k=-1,x=new this(r);++k<S;)L=b[k],C.resolve(L).then(function(B){_||(_=!0,i.resolve(x,B))},function(B){_||(_=!0,i.reject(x,B))});var L;return x}},{immediate:36}],38:[function(t,c,a){var n={};(0,t("./lib/utils/common").assign)(n,t("./lib/deflate"),t("./lib/inflate"),t("./lib/zlib/constants")),c.exports=n},{"./lib/deflate":39,"./lib/inflate":40,"./lib/utils/common":41,"./lib/zlib/constants":44}],39:[function(t,c,a){var n=t("./zlib/deflate"),r=t("./utils/common"),i=t("./utils/strings"),o=t("./zlib/messages"),l=t("./zlib/zstream"),f=Object.prototype.toString,p=0,m=-1,h=0,y=8;function u(b){if(!(this instanceof u))return new u(b);this.options=r.assign({level:m,method:y,chunkSize:16384,windowBits:15,memLevel:8,strategy:h,to:""},b||{});var C=this.options;C.raw&&0<C.windowBits?C.windowBits=-C.windowBits:C.gzip&&0<C.windowBits&&C.windowBits<16&&(C.windowBits+=16),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new l,this.strm.avail_out=0;var S=n.deflateInit2(this.strm,C.level,C.method,C.windowBits,C.memLevel,C.strategy);if(S!==p)throw new Error(o[S]);if(C.header&&n.deflateSetHeader(this.strm,C.header),C.dictionary){var _;if(_=typeof C.dictionary=="string"?i.string2buf(C.dictionary):f.call(C.dictionary)==="[object ArrayBuffer]"?new Uint8Array(C.dictionary):C.dictionary,(S=n.deflateSetDictionary(this.strm,_))!==p)throw new Error(o[S]);this._dict_set=!0}}function v(b,C){var S=new u(C);if(S.push(b,!0),S.err)throw S.msg||o[S.err];return S.result}u.prototype.push=function(b,C){var S,_,k=this.strm,x=this.options.chunkSize;if(this.ended)return!1;_=C===~~C?C:C===!0?4:0,typeof b=="string"?k.input=i.string2buf(b):f.call(b)==="[object ArrayBuffer]"?k.input=new Uint8Array(b):k.input=b,k.next_in=0,k.avail_in=k.input.length;do{if(k.avail_out===0&&(k.output=new r.Buf8(x),k.next_out=0,k.avail_out=x),(S=n.deflate(k,_))!==1&&S!==p)return this.onEnd(S),!(this.ended=!0);k.avail_out!==0&&(k.avail_in!==0||_!==4&&_!==2)||(this.options.to==="string"?this.onData(i.buf2binstring(r.shrinkBuf(k.output,k.next_out))):this.onData(r.shrinkBuf(k.output,k.next_out)))}while((0<k.avail_in||k.avail_out===0)&&S!==1);return _===4?(S=n.deflateEnd(this.strm),this.onEnd(S),this.ended=!0,S===p):_!==2||(this.onEnd(p),!(k.avail_out=0))},u.prototype.onData=function(b){this.chunks.push(b)},u.prototype.onEnd=function(b){b===p&&(this.options.to==="string"?this.result=this.chunks.join(""):this.result=r.flattenChunks(this.chunks)),this.chunks=[],this.err=b,this.msg=this.strm.msg},a.Deflate=u,a.deflate=v,a.deflateRaw=function(b,C){return(C=C||{}).raw=!0,v(b,C)},a.gzip=function(b,C){return(C=C||{}).gzip=!0,v(b,C)}},{"./utils/common":41,"./utils/strings":42,"./zlib/deflate":46,"./zlib/messages":51,"./zlib/zstream":53}],40:[function(t,c,a){var n=t("./zlib/inflate"),r=t("./utils/common"),i=t("./utils/strings"),o=t("./zlib/constants"),l=t("./zlib/messages"),f=t("./zlib/zstream"),p=t("./zlib/gzheader"),m=Object.prototype.toString;function h(u){if(!(this instanceof h))return new h(u);this.options=r.assign({chunkSize:16384,windowBits:0,to:""},u||{});var v=this.options;v.raw&&0<=v.windowBits&&v.windowBits<16&&(v.windowBits=-v.windowBits,v.windowBits===0&&(v.windowBits=-15)),!(0<=v.windowBits&&v.windowBits<16)||u&&u.windowBits||(v.windowBits+=32),15<v.windowBits&&v.windowBits<48&&!(15&v.windowBits)&&(v.windowBits|=15),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new f,this.strm.avail_out=0;var b=n.inflateInit2(this.strm,v.windowBits);if(b!==o.Z_OK)throw new Error(l[b]);this.header=new p,n.inflateGetHeader(this.strm,this.header)}function y(u,v){var b=new h(v);if(b.push(u,!0),b.err)throw b.msg||l[b.err];return b.result}h.prototype.push=function(u,v){var b,C,S,_,k,x,L=this.strm,B=this.options.chunkSize,O=this.options.dictionary,H=!1;if(this.ended)return!1;C=v===~~v?v:v===!0?o.Z_FINISH:o.Z_NO_FLUSH,typeof u=="string"?L.input=i.binstring2buf(u):m.call(u)==="[object ArrayBuffer]"?L.input=new Uint8Array(u):L.input=u,L.next_in=0,L.avail_in=L.input.length;do{if(L.avail_out===0&&(L.output=new r.Buf8(B),L.next_out=0,L.avail_out=B),(b=n.inflate(L,o.Z_NO_FLUSH))===o.Z_NEED_DICT&&O&&(x=typeof O=="string"?i.string2buf(O):m.call(O)==="[object ArrayBuffer]"?new Uint8Array(O):O,b=n.inflateSetDictionary(this.strm,x)),b===o.Z_BUF_ERROR&&H===!0&&(b=o.Z_OK,H=!1),b!==o.Z_STREAM_END&&b!==o.Z_OK)return this.onEnd(b),!(this.ended=!0);L.next_out&&(L.avail_out!==0&&b!==o.Z_STREAM_END&&(L.avail_in!==0||C!==o.Z_FINISH&&C!==o.Z_SYNC_FLUSH)||(this.options.to==="string"?(S=i.utf8border(L.output,L.next_out),_=L.next_out-S,k=i.buf2string(L.output,S),L.next_out=_,L.avail_out=B-_,_&&r.arraySet(L.output,L.output,S,_,0),this.onData(k)):this.onData(r.shrinkBuf(L.output,L.next_out)))),L.avail_in===0&&L.avail_out===0&&(H=!0)}while((0<L.avail_in||L.avail_out===0)&&b!==o.Z_STREAM_END);return b===o.Z_STREAM_END&&(C=o.Z_FINISH),C===o.Z_FINISH?(b=n.inflateEnd(this.strm),this.onEnd(b),this.ended=!0,b===o.Z_OK):C!==o.Z_SYNC_FLUSH||(this.onEnd(o.Z_OK),!(L.avail_out=0))},h.prototype.onData=function(u){this.chunks.push(u)},h.prototype.onEnd=function(u){u===o.Z_OK&&(this.options.to==="string"?this.result=this.chunks.join(""):this.result=r.flattenChunks(this.chunks)),this.chunks=[],this.err=u,this.msg=this.strm.msg},a.Inflate=h,a.inflate=y,a.inflateRaw=function(u,v){return(v=v||{}).raw=!0,y(u,v)},a.ungzip=y},{"./utils/common":41,"./utils/strings":42,"./zlib/constants":44,"./zlib/gzheader":47,"./zlib/inflate":49,"./zlib/messages":51,"./zlib/zstream":53}],41:[function(t,c,a){var n=typeof Uint8Array<"u"&&typeof Uint16Array<"u"&&typeof Int32Array<"u";a.assign=function(o){for(var l=Array.prototype.slice.call(arguments,1);l.length;){var f=l.shift();if(f){if(typeof f!="object")throw new TypeError(f+"must be non-object");for(var p in f)f.hasOwnProperty(p)&&(o[p]=f[p])}}return o},a.shrinkBuf=function(o,l){return o.length===l?o:o.subarray?o.subarray(0,l):(o.length=l,o)};var r={arraySet:function(o,l,f,p,m){if(l.subarray&&o.subarray)o.set(l.subarray(f,f+p),m);else for(var h=0;h<p;h++)o[m+h]=l[f+h]},flattenChunks:function(o){var l,f,p,m,h,y;for(l=p=0,f=o.length;l<f;l++)p+=o[l].length;for(y=new Uint8Array(p),l=m=0,f=o.length;l<f;l++)h=o[l],y.set(h,m),m+=h.length;return y}},i={arraySet:function(o,l,f,p,m){for(var h=0;h<p;h++)o[m+h]=l[f+h]},flattenChunks:function(o){return[].concat.apply([],o)}};a.setTyped=function(o){o?(a.Buf8=Uint8Array,a.Buf16=Uint16Array,a.Buf32=Int32Array,a.assign(a,r)):(a.Buf8=Array,a.Buf16=Array,a.Buf32=Array,a.assign(a,i))},a.setTyped(n)},{}],42:[function(t,c,a){var n=t("./common"),r=!0,i=!0;try{String.fromCharCode.apply(null,[0])}catch{r=!1}try{String.fromCharCode.apply(null,new Uint8Array(1))}catch{i=!1}for(var o=new n.Buf8(256),l=0;l<256;l++)o[l]=252<=l?6:248<=l?5:240<=l?4:224<=l?3:192<=l?2:1;function f(p,m){if(m<65537&&(p.subarray&&i||!p.subarray&&r))return String.fromCharCode.apply(null,n.shrinkBuf(p,m));for(var h="",y=0;y<m;y++)h+=String.fromCharCode(p[y]);return h}o[254]=o[254]=1,a.string2buf=function(p){var m,h,y,u,v,b=p.length,C=0;for(u=0;u<b;u++)(64512&(h=p.charCodeAt(u)))==55296&&u+1<b&&(64512&(y=p.charCodeAt(u+1)))==56320&&(h=65536+(h-55296<<10)+(y-56320),u++),C+=h<128?1:h<2048?2:h<65536?3:4;for(m=new n.Buf8(C),u=v=0;v<C;u++)(64512&(h=p.charCodeAt(u)))==55296&&u+1<b&&(64512&(y=p.charCodeAt(u+1)))==56320&&(h=65536+(h-55296<<10)+(y-56320),u++),h<128?m[v++]=h:(h<2048?m[v++]=192|h>>>6:(h<65536?m[v++]=224|h>>>12:(m[v++]=240|h>>>18,m[v++]=128|h>>>12&63),m[v++]=128|h>>>6&63),m[v++]=128|63&h);return m},a.buf2binstring=function(p){return f(p,p.length)},a.binstring2buf=function(p){for(var m=new n.Buf8(p.length),h=0,y=m.length;h<y;h++)m[h]=p.charCodeAt(h);return m},a.buf2string=function(p,m){var h,y,u,v,b=m||p.length,C=new Array(2*b);for(h=y=0;h<b;)if((u=p[h++])<128)C[y++]=u;else if(4<(v=o[u]))C[y++]=65533,h+=v-1;else{for(u&=v===2?31:v===3?15:7;1<v&&h<b;)u=u<<6|63&p[h++],v--;1<v?C[y++]=65533:u<65536?C[y++]=u:(u-=65536,C[y++]=55296|u>>10&1023,C[y++]=56320|1023&u)}return f(C,y)},a.utf8border=function(p,m){var h;for((m=m||p.length)>p.length&&(m=p.length),h=m-1;0<=h&&(192&p[h])==128;)h--;return h<0||h===0?m:h+o[p[h]]>m?h:m}},{"./common":41}],43:[function(t,c,a){c.exports=function(n,r,i,o){for(var l=65535&n|0,f=n>>>16&65535|0,p=0;i!==0;){for(i-=p=2e3<i?2e3:i;f=f+(l=l+r[o++]|0)|0,--p;);l%=65521,f%=65521}return l|f<<16|0}},{}],44:[function(t,c,a){c.exports={Z_NO_FLUSH:0,Z_PARTIAL_FLUSH:1,Z_SYNC_FLUSH:2,Z_FULL_FLUSH:3,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_ERRNO:-1,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_BUF_ERROR:-5,Z_NO_COMPRESSION:0,Z_BEST_SPEED:1,Z_BEST_COMPRESSION:9,Z_DEFAULT_COMPRESSION:-1,Z_FILTERED:1,Z_HUFFMAN_ONLY:2,Z_RLE:3,Z_FIXED:4,Z_DEFAULT_STRATEGY:0,Z_BINARY:0,Z_TEXT:1,Z_UNKNOWN:2,Z_DEFLATED:8}},{}],45:[function(t,c,a){var n=function(){for(var r,i=[],o=0;o<256;o++){r=o;for(var l=0;l<8;l++)r=1&r?3988292384^r>>>1:r>>>1;i[o]=r}return i}();c.exports=function(r,i,o,l){var f=n,p=l+o;r^=-1;for(var m=l;m<p;m++)r=r>>>8^f[255&(r^i[m])];return-1^r}},{}],46:[function(t,c,a){var n,r=t("../utils/common"),i=t("./trees"),o=t("./adler32"),l=t("./crc32"),f=t("./messages"),p=0,m=4,h=0,y=-2,u=-1,v=4,b=2,C=8,S=9,_=286,k=30,x=19,L=2*_+1,B=15,O=3,H=258,Q=H+O+1,I=42,z=113,g=1,F=2,oe=3,Z=4;function de(d,P){return d.msg=f[P],P}function V(d){return(d<<1)-(4<d?9:0)}function le(d){for(var P=d.length;0<=--P;)d[P]=0}function R(d){var P=d.state,$=P.pending;$>d.avail_out&&($=d.avail_out),$!==0&&(r.arraySet(d.output,P.pending_buf,P.pending_out,$,d.next_out),d.next_out+=$,P.pending_out+=$,d.total_out+=$,d.avail_out-=$,P.pending-=$,P.pending===0&&(P.pending_out=0))}function A(d,P){i._tr_flush_block(d,0<=d.block_start?d.block_start:-1,d.strstart-d.block_start,P),d.block_start=d.strstart,R(d.strm)}function ce(d,P){d.pending_buf[d.pending++]=P}function ee(d,P){d.pending_buf[d.pending++]=P>>>8&255,d.pending_buf[d.pending++]=255&P}function X(d,P){var $,E,w=d.max_chain_length,T=d.strstart,W=d.prev_length,q=d.nice_match,D=d.strstart>d.w_size-Q?d.strstart-(d.w_size-Q):0,J=d.window,te=d.w_mask,Y=d.prev,ae=d.strstart+H,we=J[T+W-1],he=J[T+W];d.prev_length>=d.good_match&&(w>>=2),q>d.lookahead&&(q=d.lookahead);do if(J[($=P)+W]===he&&J[$+W-1]===we&&J[$]===J[T]&&J[++$]===J[T+1]){T+=2,$++;do;while(J[++T]===J[++$]&&J[++T]===J[++$]&&J[++T]===J[++$]&&J[++T]===J[++$]&&J[++T]===J[++$]&&J[++T]===J[++$]&&J[++T]===J[++$]&&J[++T]===J[++$]&&T<ae);if(E=H-(ae-T),T=ae-H,W<E){if(d.match_start=P,q<=(W=E))break;we=J[T+W-1],he=J[T+W]}}while((P=Y[P&te])>D&&--w!=0);return W<=d.lookahead?W:d.lookahead}function xe(d){var P,$,E,w,T,W,q,D,J,te,Y=d.w_size;do{if(w=d.window_size-d.lookahead-d.strstart,d.strstart>=Y+(Y-Q)){for(r.arraySet(d.window,d.window,Y,Y,0),d.match_start-=Y,d.strstart-=Y,d.block_start-=Y,P=$=d.hash_size;E=d.head[--P],d.head[P]=Y<=E?E-Y:0,--$;);for(P=$=Y;E=d.prev[--P],d.prev[P]=Y<=E?E-Y:0,--$;);w+=Y}if(d.strm.avail_in===0)break;if(W=d.strm,q=d.window,D=d.strstart+d.lookahead,J=w,te=void 0,te=W.avail_in,J<te&&(te=J),$=te===0?0:(W.avail_in-=te,r.arraySet(q,W.input,W.next_in,te,D),W.state.wrap===1?W.adler=o(W.adler,q,te,D):W.state.wrap===2&&(W.adler=l(W.adler,q,te,D)),W.next_in+=te,W.total_in+=te,te),d.lookahead+=$,d.lookahead+d.insert>=O)for(T=d.strstart-d.insert,d.ins_h=d.window[T],d.ins_h=(d.ins_h<<d.hash_shift^d.window[T+1])&d.hash_mask;d.insert&&(d.ins_h=(d.ins_h<<d.hash_shift^d.window[T+O-1])&d.hash_mask,d.prev[T&d.w_mask]=d.head[d.ins_h],d.head[d.ins_h]=T,T++,d.insert--,!(d.lookahead+d.insert<O)););}while(d.lookahead<Q&&d.strm.avail_in!==0)}function De(d,P){for(var $,E;;){if(d.lookahead<Q){if(xe(d),d.lookahead<Q&&P===p)return g;if(d.lookahead===0)break}if($=0,d.lookahead>=O&&(d.ins_h=(d.ins_h<<d.hash_shift^d.window[d.strstart+O-1])&d.hash_mask,$=d.prev[d.strstart&d.w_mask]=d.head[d.ins_h],d.head[d.ins_h]=d.strstart),$!==0&&d.strstart-$<=d.w_size-Q&&(d.match_length=X(d,$)),d.match_length>=O)if(E=i._tr_tally(d,d.strstart-d.match_start,d.match_length-O),d.lookahead-=d.match_length,d.match_length<=d.max_lazy_match&&d.lookahead>=O){for(d.match_length--;d.strstart++,d.ins_h=(d.ins_h<<d.hash_shift^d.window[d.strstart+O-1])&d.hash_mask,$=d.prev[d.strstart&d.w_mask]=d.head[d.ins_h],d.head[d.ins_h]=d.strstart,--d.match_length!=0;);d.strstart++}else d.strstart+=d.match_length,d.match_length=0,d.ins_h=d.window[d.strstart],d.ins_h=(d.ins_h<<d.hash_shift^d.window[d.strstart+1])&d.hash_mask;else E=i._tr_tally(d,0,d.window[d.strstart]),d.lookahead--,d.strstart++;if(E&&(A(d,!1),d.strm.avail_out===0))return g}return d.insert=d.strstart<O-1?d.strstart:O-1,P===m?(A(d,!0),d.strm.avail_out===0?oe:Z):d.last_lit&&(A(d,!1),d.strm.avail_out===0)?g:F}function pe(d,P){for(var $,E,w;;){if(d.lookahead<Q){if(xe(d),d.lookahead<Q&&P===p)return g;if(d.lookahead===0)break}if($=0,d.lookahead>=O&&(d.ins_h=(d.ins_h<<d.hash_shift^d.window[d.strstart+O-1])&d.hash_mask,$=d.prev[d.strstart&d.w_mask]=d.head[d.ins_h],d.head[d.ins_h]=d.strstart),d.prev_length=d.match_length,d.prev_match=d.match_start,d.match_length=O-1,$!==0&&d.prev_length<d.max_lazy_match&&d.strstart-$<=d.w_size-Q&&(d.match_length=X(d,$),d.match_length<=5&&(d.strategy===1||d.match_length===O&&4096<d.strstart-d.match_start)&&(d.match_length=O-1)),d.prev_length>=O&&d.match_length<=d.prev_length){for(w=d.strstart+d.lookahead-O,E=i._tr_tally(d,d.strstart-1-d.prev_match,d.prev_length-O),d.lookahead-=d.prev_length-1,d.prev_length-=2;++d.strstart<=w&&(d.ins_h=(d.ins_h<<d.hash_shift^d.window[d.strstart+O-1])&d.hash_mask,$=d.prev[d.strstart&d.w_mask]=d.head[d.ins_h],d.head[d.ins_h]=d.strstart),--d.prev_length!=0;);if(d.match_available=0,d.match_length=O-1,d.strstart++,E&&(A(d,!1),d.strm.avail_out===0))return g}else if(d.match_available){if((E=i._tr_tally(d,0,d.window[d.strstart-1]))&&A(d,!1),d.strstart++,d.lookahead--,d.strm.avail_out===0)return g}else d.match_available=1,d.strstart++,d.lookahead--}return d.match_available&&(E=i._tr_tally(d,0,d.window[d.strstart-1]),d.match_available=0),d.insert=d.strstart<O-1?d.strstart:O-1,P===m?(A(d,!0),d.strm.avail_out===0?oe:Z):d.last_lit&&(A(d,!1),d.strm.avail_out===0)?g:F}function be(d,P,$,E,w){this.good_length=d,this.max_lazy=P,this.nice_length=$,this.max_chain=E,this.func=w}function Ne(){this.strm=null,this.status=0,this.pending_buf=null,this.pending_buf_size=0,this.pending_out=0,this.pending=0,this.wrap=0,this.gzhead=null,this.gzindex=0,this.method=C,this.last_flush=-1,this.w_size=0,this.w_bits=0,this.w_mask=0,this.window=null,this.window_size=0,this.prev=null,this.head=null,this.ins_h=0,this.hash_size=0,this.hash_bits=0,this.hash_mask=0,this.hash_shift=0,this.block_start=0,this.match_length=0,this.prev_match=0,this.match_available=0,this.strstart=0,this.match_start=0,this.lookahead=0,this.prev_length=0,this.max_chain_length=0,this.max_lazy_match=0,this.level=0,this.strategy=0,this.good_match=0,this.nice_match=0,this.dyn_ltree=new r.Buf16(2*L),this.dyn_dtree=new r.Buf16(2*(2*k+1)),this.bl_tree=new r.Buf16(2*(2*x+1)),le(this.dyn_ltree),le(this.dyn_dtree),le(this.bl_tree),this.l_desc=null,this.d_desc=null,this.bl_desc=null,this.bl_count=new r.Buf16(B+1),this.heap=new r.Buf16(2*_+1),le(this.heap),this.heap_len=0,this.heap_max=0,this.depth=new r.Buf16(2*_+1),le(this.depth),this.l_buf=0,this.lit_bufsize=0,this.last_lit=0,this.d_buf=0,this.opt_len=0,this.static_len=0,this.matches=0,this.insert=0,this.bi_buf=0,this.bi_valid=0}function Be(d){var P;return d&&d.state?(d.total_in=d.total_out=0,d.data_type=b,(P=d.state).pending=0,P.pending_out=0,P.wrap<0&&(P.wrap=-P.wrap),P.status=P.wrap?I:z,d.adler=P.wrap===2?0:1,P.last_flush=p,i._tr_init(P),h):de(d,y)}function Ze(d){var P=Be(d);return P===h&&function($){$.window_size=2*$.w_size,le($.head),$.max_lazy_match=n[$.level].max_lazy,$.good_match=n[$.level].good_length,$.nice_match=n[$.level].nice_length,$.max_chain_length=n[$.level].max_chain,$.strstart=0,$.block_start=0,$.lookahead=0,$.insert=0,$.match_length=$.prev_length=O-1,$.match_available=0,$.ins_h=0}(d.state),P}function Ve(d,P,$,E,w,T){if(!d)return y;var W=1;if(P===u&&(P=6),E<0?(W=0,E=-E):15<E&&(W=2,E-=16),w<1||S<w||$!==C||E<8||15<E||P<0||9<P||T<0||v<T)return de(d,y);E===8&&(E=9);var q=new Ne;return(d.state=q).strm=d,q.wrap=W,q.gzhead=null,q.w_bits=E,q.w_size=1<<q.w_bits,q.w_mask=q.w_size-1,q.hash_bits=w+7,q.hash_size=1<<q.hash_bits,q.hash_mask=q.hash_size-1,q.hash_shift=~~((q.hash_bits+O-1)/O),q.window=new r.Buf8(2*q.w_size),q.head=new r.Buf16(q.hash_size),q.prev=new r.Buf16(q.w_size),q.lit_bufsize=1<<w+6,q.pending_buf_size=4*q.lit_bufsize,q.pending_buf=new r.Buf8(q.pending_buf_size),q.d_buf=1*q.lit_bufsize,q.l_buf=3*q.lit_bufsize,q.level=P,q.strategy=T,q.method=$,Ze(d)}n=[new be(0,0,0,0,function(d,P){var $=65535;for($>d.pending_buf_size-5&&($=d.pending_buf_size-5);;){if(d.lookahead<=1){if(xe(d),d.lookahead===0&&P===p)return g;if(d.lookahead===0)break}d.strstart+=d.lookahead,d.lookahead=0;var E=d.block_start+$;if((d.strstart===0||d.strstart>=E)&&(d.lookahead=d.strstart-E,d.strstart=E,A(d,!1),d.strm.avail_out===0)||d.strstart-d.block_start>=d.w_size-Q&&(A(d,!1),d.strm.avail_out===0))return g}return d.insert=0,P===m?(A(d,!0),d.strm.avail_out===0?oe:Z):(d.strstart>d.block_start&&(A(d,!1),d.strm.avail_out),g)}),new be(4,4,8,4,De),new be(4,5,16,8,De),new be(4,6,32,32,De),new be(4,4,16,16,pe),new be(8,16,32,32,pe),new be(8,16,128,128,pe),new be(8,32,128,256,pe),new be(32,128,258,1024,pe),new be(32,258,258,4096,pe)],a.deflateInit=function(d,P){return Ve(d,P,C,15,8,0)},a.deflateInit2=Ve,a.deflateReset=Ze,a.deflateResetKeep=Be,a.deflateSetHeader=function(d,P){return d&&d.state?d.state.wrap!==2?y:(d.state.gzhead=P,h):y},a.deflate=function(d,P){var $,E,w,T;if(!d||!d.state||5<P||P<0)return d?de(d,y):y;if(E=d.state,!d.output||!d.input&&d.avail_in!==0||E.status===666&&P!==m)return de(d,d.avail_out===0?-5:y);if(E.strm=d,$=E.last_flush,E.last_flush=P,E.status===I)if(E.wrap===2)d.adler=0,ce(E,31),ce(E,139),ce(E,8),E.gzhead?(ce(E,(E.gzhead.text?1:0)+(E.gzhead.hcrc?2:0)+(E.gzhead.extra?4:0)+(E.gzhead.name?8:0)+(E.gzhead.comment?16:0)),ce(E,255&E.gzhead.time),ce(E,E.gzhead.time>>8&255),ce(E,E.gzhead.time>>16&255),ce(E,E.gzhead.time>>24&255),ce(E,E.level===9?2:2<=E.strategy||E.level<2?4:0),ce(E,255&E.gzhead.os),E.gzhead.extra&&E.gzhead.extra.length&&(ce(E,255&E.gzhead.extra.length),ce(E,E.gzhead.extra.length>>8&255)),E.gzhead.hcrc&&(d.adler=l(d.adler,E.pending_buf,E.pending,0)),E.gzindex=0,E.status=69):(ce(E,0),ce(E,0),ce(E,0),ce(E,0),ce(E,0),ce(E,E.level===9?2:2<=E.strategy||E.level<2?4:0),ce(E,3),E.status=z);else{var W=C+(E.w_bits-8<<4)<<8;W|=(2<=E.strategy||E.level<2?0:E.level<6?1:E.level===6?2:3)<<6,E.strstart!==0&&(W|=32),W+=31-W%31,E.status=z,ee(E,W),E.strstart!==0&&(ee(E,d.adler>>>16),ee(E,65535&d.adler)),d.adler=1}if(E.status===69)if(E.gzhead.extra){for(w=E.pending;E.gzindex<(65535&E.gzhead.extra.length)&&(E.pending!==E.pending_buf_size||(E.gzhead.hcrc&&E.pending>w&&(d.adler=l(d.adler,E.pending_buf,E.pending-w,w)),R(d),w=E.pending,E.pending!==E.pending_buf_size));)ce(E,255&E.gzhead.extra[E.gzindex]),E.gzindex++;E.gzhead.hcrc&&E.pending>w&&(d.adler=l(d.adler,E.pending_buf,E.pending-w,w)),E.gzindex===E.gzhead.extra.length&&(E.gzindex=0,E.status=73)}else E.status=73;if(E.status===73)if(E.gzhead.name){w=E.pending;do{if(E.pending===E.pending_buf_size&&(E.gzhead.hcrc&&E.pending>w&&(d.adler=l(d.adler,E.pending_buf,E.pending-w,w)),R(d),w=E.pending,E.pending===E.pending_buf_size)){T=1;break}T=E.gzindex<E.gzhead.name.length?255&E.gzhead.name.charCodeAt(E.gzindex++):0,ce(E,T)}while(T!==0);E.gzhead.hcrc&&E.pending>w&&(d.adler=l(d.adler,E.pending_buf,E.pending-w,w)),T===0&&(E.gzindex=0,E.status=91)}else E.status=91;if(E.status===91)if(E.gzhead.comment){w=E.pending;do{if(E.pending===E.pending_buf_size&&(E.gzhead.hcrc&&E.pending>w&&(d.adler=l(d.adler,E.pending_buf,E.pending-w,w)),R(d),w=E.pending,E.pending===E.pending_buf_size)){T=1;break}T=E.gzindex<E.gzhead.comment.length?255&E.gzhead.comment.charCodeAt(E.gzindex++):0,ce(E,T)}while(T!==0);E.gzhead.hcrc&&E.pending>w&&(d.adler=l(d.adler,E.pending_buf,E.pending-w,w)),T===0&&(E.status=103)}else E.status=103;if(E.status===103&&(E.gzhead.hcrc?(E.pending+2>E.pending_buf_size&&R(d),E.pending+2<=E.pending_buf_size&&(ce(E,255&d.adler),ce(E,d.adler>>8&255),d.adler=0,E.status=z)):E.status=z),E.pending!==0){if(R(d),d.avail_out===0)return E.last_flush=-1,h}else if(d.avail_in===0&&V(P)<=V($)&&P!==m)return de(d,-5);if(E.status===666&&d.avail_in!==0)return de(d,-5);if(d.avail_in!==0||E.lookahead!==0||P!==p&&E.status!==666){var q=E.strategy===2?function(D,J){for(var te;;){if(D.lookahead===0&&(xe(D),D.lookahead===0)){if(J===p)return g;break}if(D.match_length=0,te=i._tr_tally(D,0,D.window[D.strstart]),D.lookahead--,D.strstart++,te&&(A(D,!1),D.strm.avail_out===0))return g}return D.insert=0,J===m?(A(D,!0),D.strm.avail_out===0?oe:Z):D.last_lit&&(A(D,!1),D.strm.avail_out===0)?g:F}(E,P):E.strategy===3?function(D,J){for(var te,Y,ae,we,he=D.window;;){if(D.lookahead<=H){if(xe(D),D.lookahead<=H&&J===p)return g;if(D.lookahead===0)break}if(D.match_length=0,D.lookahead>=O&&0<D.strstart&&(Y=he[ae=D.strstart-1])===he[++ae]&&Y===he[++ae]&&Y===he[++ae]){we=D.strstart+H;do;while(Y===he[++ae]&&Y===he[++ae]&&Y===he[++ae]&&Y===he[++ae]&&Y===he[++ae]&&Y===he[++ae]&&Y===he[++ae]&&Y===he[++ae]&&ae<we);D.match_length=H-(we-ae),D.match_length>D.lookahead&&(D.match_length=D.lookahead)}if(D.match_length>=O?(te=i._tr_tally(D,1,D.match_length-O),D.lookahead-=D.match_length,D.strstart+=D.match_length,D.match_length=0):(te=i._tr_tally(D,0,D.window[D.strstart]),D.lookahead--,D.strstart++),te&&(A(D,!1),D.strm.avail_out===0))return g}return D.insert=0,J===m?(A(D,!0),D.strm.avail_out===0?oe:Z):D.last_lit&&(A(D,!1),D.strm.avail_out===0)?g:F}(E,P):n[E.level].func(E,P);if(q!==oe&&q!==Z||(E.status=666),q===g||q===oe)return d.avail_out===0&&(E.last_flush=-1),h;if(q===F&&(P===1?i._tr_align(E):P!==5&&(i._tr_stored_block(E,0,0,!1),P===3&&(le(E.head),E.lookahead===0&&(E.strstart=0,E.block_start=0,E.insert=0))),R(d),d.avail_out===0))return E.last_flush=-1,h}return P!==m?h:E.wrap<=0?1:(E.wrap===2?(ce(E,255&d.adler),ce(E,d.adler>>8&255),ce(E,d.adler>>16&255),ce(E,d.adler>>24&255),ce(E,255&d.total_in),ce(E,d.total_in>>8&255),ce(E,d.total_in>>16&255),ce(E,d.total_in>>24&255)):(ee(E,d.adler>>>16),ee(E,65535&d.adler)),R(d),0<E.wrap&&(E.wrap=-E.wrap),E.pending!==0?h:1)},a.deflateEnd=function(d){var P;return d&&d.state?(P=d.state.status)!==I&&P!==69&&P!==73&&P!==91&&P!==103&&P!==z&&P!==666?de(d,y):(d.state=null,P===z?de(d,-3):h):y},a.deflateSetDictionary=function(d,P){var $,E,w,T,W,q,D,J,te=P.length;if(!d||!d.state||(T=($=d.state).wrap)===2||T===1&&$.status!==I||$.lookahead)return y;for(T===1&&(d.adler=o(d.adler,P,te,0)),$.wrap=0,te>=$.w_size&&(T===0&&(le($.head),$.strstart=0,$.block_start=0,$.insert=0),J=new r.Buf8($.w_size),r.arraySet(J,P,te-$.w_size,$.w_size,0),P=J,te=$.w_size),W=d.avail_in,q=d.next_in,D=d.input,d.avail_in=te,d.next_in=0,d.input=P,xe($);$.lookahead>=O;){for(E=$.strstart,w=$.lookahead-(O-1);$.ins_h=($.ins_h<<$.hash_shift^$.window[E+O-1])&$.hash_mask,$.prev[E&$.w_mask]=$.head[$.ins_h],$.head[$.ins_h]=E,E++,--w;);$.strstart=E,$.lookahead=O-1,xe($)}return $.strstart+=$.lookahead,$.block_start=$.strstart,$.insert=$.lookahead,$.lookahead=0,$.match_length=$.prev_length=O-1,$.match_available=0,d.next_in=q,d.input=D,d.avail_in=W,$.wrap=T,h},a.deflateInfo="pako deflate (from Nodeca project)"},{"../utils/common":41,"./adler32":43,"./crc32":45,"./messages":51,"./trees":52}],47:[function(t,c,a){c.exports=function(){this.text=0,this.time=0,this.xflags=0,this.os=0,this.extra=null,this.extra_len=0,this.name="",this.comment="",this.hcrc=0,this.done=!1}},{}],48:[function(t,c,a){c.exports=function(n,r){var i,o,l,f,p,m,h,y,u,v,b,C,S,_,k,x,L,B,O,H,Q,I,z,g,F;i=n.state,o=n.next_in,g=n.input,l=o+(n.avail_in-5),f=n.next_out,F=n.output,p=f-(r-n.avail_out),m=f+(n.avail_out-257),h=i.dmax,y=i.wsize,u=i.whave,v=i.wnext,b=i.window,C=i.hold,S=i.bits,_=i.lencode,k=i.distcode,x=(1<<i.lenbits)-1,L=(1<<i.distbits)-1;e:do{S<15&&(C+=g[o++]<<S,S+=8,C+=g[o++]<<S,S+=8),B=_[C&x];t:for(;;){if(C>>>=O=B>>>24,S-=O,(O=B>>>16&255)===0)F[f++]=65535&B;else{if(!(16&O)){if(!(64&O)){B=_[(65535&B)+(C&(1<<O)-1)];continue t}if(32&O){i.mode=12;break e}n.msg="invalid literal/length code",i.mode=30;break e}H=65535&B,(O&=15)&&(S<O&&(C+=g[o++]<<S,S+=8),H+=C&(1<<O)-1,C>>>=O,S-=O),S<15&&(C+=g[o++]<<S,S+=8,C+=g[o++]<<S,S+=8),B=k[C&L];n:for(;;){if(C>>>=O=B>>>24,S-=O,!(16&(O=B>>>16&255))){if(!(64&O)){B=k[(65535&B)+(C&(1<<O)-1)];continue n}n.msg="invalid distance code",i.mode=30;break e}if(Q=65535&B,S<(O&=15)&&(C+=g[o++]<<S,(S+=8)<O&&(C+=g[o++]<<S,S+=8)),h<(Q+=C&(1<<O)-1)){n.msg="invalid distance too far back",i.mode=30;break e}if(C>>>=O,S-=O,(O=f-p)<Q){if(u<(O=Q-O)&&i.sane){n.msg="invalid distance too far back",i.mode=30;break e}if(z=b,(I=0)===v){if(I+=y-O,O<H){for(H-=O;F[f++]=b[I++],--O;);I=f-Q,z=F}}else if(v<O){if(I+=y+v-O,(O-=v)<H){for(H-=O;F[f++]=b[I++],--O;);if(I=0,v<H){for(H-=O=v;F[f++]=b[I++],--O;);I=f-Q,z=F}}}else if(I+=v-O,O<H){for(H-=O;F[f++]=b[I++],--O;);I=f-Q,z=F}for(;2<H;)F[f++]=z[I++],F[f++]=z[I++],F[f++]=z[I++],H-=3;H&&(F[f++]=z[I++],1<H&&(F[f++]=z[I++]))}else{for(I=f-Q;F[f++]=F[I++],F[f++]=F[I++],F[f++]=F[I++],2<(H-=3););H&&(F[f++]=F[I++],1<H&&(F[f++]=F[I++]))}break}}break}}while(o<l&&f<m);o-=H=S>>3,C&=(1<<(S-=H<<3))-1,n.next_in=o,n.next_out=f,n.avail_in=o<l?l-o+5:5-(o-l),n.avail_out=f<m?m-f+257:257-(f-m),i.hold=C,i.bits=S}},{}],49:[function(t,c,a){var n=t("../utils/common"),r=t("./adler32"),i=t("./crc32"),o=t("./inffast"),l=t("./inftrees"),f=1,p=2,m=0,h=-2,y=1,u=852,v=592;function b(I){return(I>>>24&255)+(I>>>8&65280)+((65280&I)<<8)+((255&I)<<24)}function C(){this.mode=0,this.last=!1,this.wrap=0,this.havedict=!1,this.flags=0,this.dmax=0,this.check=0,this.total=0,this.head=null,this.wbits=0,this.wsize=0,this.whave=0,this.wnext=0,this.window=null,this.hold=0,this.bits=0,this.length=0,this.offset=0,this.extra=0,this.lencode=null,this.distcode=null,this.lenbits=0,this.distbits=0,this.ncode=0,this.nlen=0,this.ndist=0,this.have=0,this.next=null,this.lens=new n.Buf16(320),this.work=new n.Buf16(288),this.lendyn=null,this.distdyn=null,this.sane=0,this.back=0,this.was=0}function S(I){var z;return I&&I.state?(z=I.state,I.total_in=I.total_out=z.total=0,I.msg="",z.wrap&&(I.adler=1&z.wrap),z.mode=y,z.last=0,z.havedict=0,z.dmax=32768,z.head=null,z.hold=0,z.bits=0,z.lencode=z.lendyn=new n.Buf32(u),z.distcode=z.distdyn=new n.Buf32(v),z.sane=1,z.back=-1,m):h}function _(I){var z;return I&&I.state?((z=I.state).wsize=0,z.whave=0,z.wnext=0,S(I)):h}function k(I,z){var g,F;return I&&I.state?(F=I.state,z<0?(g=0,z=-z):(g=1+(z>>4),z<48&&(z&=15)),z&&(z<8||15<z)?h:(F.window!==null&&F.wbits!==z&&(F.window=null),F.wrap=g,F.wbits=z,_(I))):h}function x(I,z){var g,F;return I?(F=new C,(I.state=F).window=null,(g=k(I,z))!==m&&(I.state=null),g):h}var L,B,O=!0;function H(I){if(O){var z;for(L=new n.Buf32(512),B=new n.Buf32(32),z=0;z<144;)I.lens[z++]=8;for(;z<256;)I.lens[z++]=9;for(;z<280;)I.lens[z++]=7;for(;z<288;)I.lens[z++]=8;for(l(f,I.lens,0,288,L,0,I.work,{bits:9}),z=0;z<32;)I.lens[z++]=5;l(p,I.lens,0,32,B,0,I.work,{bits:5}),O=!1}I.lencode=L,I.lenbits=9,I.distcode=B,I.distbits=5}function Q(I,z,g,F){var oe,Z=I.state;return Z.window===null&&(Z.wsize=1<<Z.wbits,Z.wnext=0,Z.whave=0,Z.window=new n.Buf8(Z.wsize)),F>=Z.wsize?(n.arraySet(Z.window,z,g-Z.wsize,Z.wsize,0),Z.wnext=0,Z.whave=Z.wsize):(F<(oe=Z.wsize-Z.wnext)&&(oe=F),n.arraySet(Z.window,z,g-F,oe,Z.wnext),(F-=oe)?(n.arraySet(Z.window,z,g-F,F,0),Z.wnext=F,Z.whave=Z.wsize):(Z.wnext+=oe,Z.wnext===Z.wsize&&(Z.wnext=0),Z.whave<Z.wsize&&(Z.whave+=oe))),0}a.inflateReset=_,a.inflateReset2=k,a.inflateResetKeep=S,a.inflateInit=function(I){return x(I,15)},a.inflateInit2=x,a.inflate=function(I,z){var g,F,oe,Z,de,V,le,R,A,ce,ee,X,xe,De,pe,be,Ne,Be,Ze,Ve,d,P,$,E,w=0,T=new n.Buf8(4),W=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15];if(!I||!I.state||!I.output||!I.input&&I.avail_in!==0)return h;(g=I.state).mode===12&&(g.mode=13),de=I.next_out,oe=I.output,le=I.avail_out,Z=I.next_in,F=I.input,V=I.avail_in,R=g.hold,A=g.bits,ce=V,ee=le,P=m;e:for(;;)switch(g.mode){case y:if(g.wrap===0){g.mode=13;break}for(;A<16;){if(V===0)break e;V--,R+=F[Z++]<<A,A+=8}if(2&g.wrap&&R===35615){T[g.check=0]=255&R,T[1]=R>>>8&255,g.check=i(g.check,T,2,0),A=R=0,g.mode=2;break}if(g.flags=0,g.head&&(g.head.done=!1),!(1&g.wrap)||(((255&R)<<8)+(R>>8))%31){I.msg="incorrect header check",g.mode=30;break}if((15&R)!=8){I.msg="unknown compression method",g.mode=30;break}if(A-=4,d=8+(15&(R>>>=4)),g.wbits===0)g.wbits=d;else if(d>g.wbits){I.msg="invalid window size",g.mode=30;break}g.dmax=1<<d,I.adler=g.check=1,g.mode=512&R?10:12,A=R=0;break;case 2:for(;A<16;){if(V===0)break e;V--,R+=F[Z++]<<A,A+=8}if(g.flags=R,(255&g.flags)!=8){I.msg="unknown compression method",g.mode=30;break}if(57344&g.flags){I.msg="unknown header flags set",g.mode=30;break}g.head&&(g.head.text=R>>8&1),512&g.flags&&(T[0]=255&R,T[1]=R>>>8&255,g.check=i(g.check,T,2,0)),A=R=0,g.mode=3;case 3:for(;A<32;){if(V===0)break e;V--,R+=F[Z++]<<A,A+=8}g.head&&(g.head.time=R),512&g.flags&&(T[0]=255&R,T[1]=R>>>8&255,T[2]=R>>>16&255,T[3]=R>>>24&255,g.check=i(g.check,T,4,0)),A=R=0,g.mode=4;case 4:for(;A<16;){if(V===0)break e;V--,R+=F[Z++]<<A,A+=8}g.head&&(g.head.xflags=255&R,g.head.os=R>>8),512&g.flags&&(T[0]=255&R,T[1]=R>>>8&255,g.check=i(g.check,T,2,0)),A=R=0,g.mode=5;case 5:if(1024&g.flags){for(;A<16;){if(V===0)break e;V--,R+=F[Z++]<<A,A+=8}g.length=R,g.head&&(g.head.extra_len=R),512&g.flags&&(T[0]=255&R,T[1]=R>>>8&255,g.check=i(g.check,T,2,0)),A=R=0}else g.head&&(g.head.extra=null);g.mode=6;case 6:if(1024&g.flags&&(V<(X=g.length)&&(X=V),X&&(g.head&&(d=g.head.extra_len-g.length,g.head.extra||(g.head.extra=new Array(g.head.extra_len)),n.arraySet(g.head.extra,F,Z,X,d)),512&g.flags&&(g.check=i(g.check,F,X,Z)),V-=X,Z+=X,g.length-=X),g.length))break e;g.length=0,g.mode=7;case 7:if(2048&g.flags){if(V===0)break e;for(X=0;d=F[Z+X++],g.head&&d&&g.length<65536&&(g.head.name+=String.fromCharCode(d)),d&&X<V;);if(512&g.flags&&(g.check=i(g.check,F,X,Z)),V-=X,Z+=X,d)break e}else g.head&&(g.head.name=null);g.length=0,g.mode=8;case 8:if(4096&g.flags){if(V===0)break e;for(X=0;d=F[Z+X++],g.head&&d&&g.length<65536&&(g.head.comment+=String.fromCharCode(d)),d&&X<V;);if(512&g.flags&&(g.check=i(g.check,F,X,Z)),V-=X,Z+=X,d)break e}else g.head&&(g.head.comment=null);g.mode=9;case 9:if(512&g.flags){for(;A<16;){if(V===0)break e;V--,R+=F[Z++]<<A,A+=8}if(R!==(65535&g.check)){I.msg="header crc mismatch",g.mode=30;break}A=R=0}g.head&&(g.head.hcrc=g.flags>>9&1,g.head.done=!0),I.adler=g.check=0,g.mode=12;break;case 10:for(;A<32;){if(V===0)break e;V--,R+=F[Z++]<<A,A+=8}I.adler=g.check=b(R),A=R=0,g.mode=11;case 11:if(g.havedict===0)return I.next_out=de,I.avail_out=le,I.next_in=Z,I.avail_in=V,g.hold=R,g.bits=A,2;I.adler=g.check=1,g.mode=12;case 12:if(z===5||z===6)break e;case 13:if(g.last){R>>>=7&A,A-=7&A,g.mode=27;break}for(;A<3;){if(V===0)break e;V--,R+=F[Z++]<<A,A+=8}switch(g.last=1&R,A-=1,3&(R>>>=1)){case 0:g.mode=14;break;case 1:if(H(g),g.mode=20,z!==6)break;R>>>=2,A-=2;break e;case 2:g.mode=17;break;case 3:I.msg="invalid block type",g.mode=30}R>>>=2,A-=2;break;case 14:for(R>>>=7&A,A-=7&A;A<32;){if(V===0)break e;V--,R+=F[Z++]<<A,A+=8}if((65535&R)!=(R>>>16^65535)){I.msg="invalid stored block lengths",g.mode=30;break}if(g.length=65535&R,A=R=0,g.mode=15,z===6)break e;case 15:g.mode=16;case 16:if(X=g.length){if(V<X&&(X=V),le<X&&(X=le),X===0)break e;n.arraySet(oe,F,Z,X,de),V-=X,Z+=X,le-=X,de+=X,g.length-=X;break}g.mode=12;break;case 17:for(;A<14;){if(V===0)break e;V--,R+=F[Z++]<<A,A+=8}if(g.nlen=257+(31&R),R>>>=5,A-=5,g.ndist=1+(31&R),R>>>=5,A-=5,g.ncode=4+(15&R),R>>>=4,A-=4,286<g.nlen||30<g.ndist){I.msg="too many length or distance symbols",g.mode=30;break}g.have=0,g.mode=18;case 18:for(;g.have<g.ncode;){for(;A<3;){if(V===0)break e;V--,R+=F[Z++]<<A,A+=8}g.lens[W[g.have++]]=7&R,R>>>=3,A-=3}for(;g.have<19;)g.lens[W[g.have++]]=0;if(g.lencode=g.lendyn,g.lenbits=7,$={bits:g.lenbits},P=l(0,g.lens,0,19,g.lencode,0,g.work,$),g.lenbits=$.bits,P){I.msg="invalid code lengths set",g.mode=30;break}g.have=0,g.mode=19;case 19:for(;g.have<g.nlen+g.ndist;){for(;be=(w=g.lencode[R&(1<<g.lenbits)-1])>>>16&255,Ne=65535&w,!((pe=w>>>24)<=A);){if(V===0)break e;V--,R+=F[Z++]<<A,A+=8}if(Ne<16)R>>>=pe,A-=pe,g.lens[g.have++]=Ne;else{if(Ne===16){for(E=pe+2;A<E;){if(V===0)break e;V--,R+=F[Z++]<<A,A+=8}if(R>>>=pe,A-=pe,g.have===0){I.msg="invalid bit length repeat",g.mode=30;break}d=g.lens[g.have-1],X=3+(3&R),R>>>=2,A-=2}else if(Ne===17){for(E=pe+3;A<E;){if(V===0)break e;V--,R+=F[Z++]<<A,A+=8}A-=pe,d=0,X=3+(7&(R>>>=pe)),R>>>=3,A-=3}else{for(E=pe+7;A<E;){if(V===0)break e;V--,R+=F[Z++]<<A,A+=8}A-=pe,d=0,X=11+(127&(R>>>=pe)),R>>>=7,A-=7}if(g.have+X>g.nlen+g.ndist){I.msg="invalid bit length repeat",g.mode=30;break}for(;X--;)g.lens[g.have++]=d}}if(g.mode===30)break;if(g.lens[256]===0){I.msg="invalid code -- missing end-of-block",g.mode=30;break}if(g.lenbits=9,$={bits:g.lenbits},P=l(f,g.lens,0,g.nlen,g.lencode,0,g.work,$),g.lenbits=$.bits,P){I.msg="invalid literal/lengths set",g.mode=30;break}if(g.distbits=6,g.distcode=g.distdyn,$={bits:g.distbits},P=l(p,g.lens,g.nlen,g.ndist,g.distcode,0,g.work,$),g.distbits=$.bits,P){I.msg="invalid distances set",g.mode=30;break}if(g.mode=20,z===6)break e;case 20:g.mode=21;case 21:if(6<=V&&258<=le){I.next_out=de,I.avail_out=le,I.next_in=Z,I.avail_in=V,g.hold=R,g.bits=A,o(I,ee),de=I.next_out,oe=I.output,le=I.avail_out,Z=I.next_in,F=I.input,V=I.avail_in,R=g.hold,A=g.bits,g.mode===12&&(g.back=-1);break}for(g.back=0;be=(w=g.lencode[R&(1<<g.lenbits)-1])>>>16&255,Ne=65535&w,!((pe=w>>>24)<=A);){if(V===0)break e;V--,R+=F[Z++]<<A,A+=8}if(be&&!(240&be)){for(Be=pe,Ze=be,Ve=Ne;be=(w=g.lencode[Ve+((R&(1<<Be+Ze)-1)>>Be)])>>>16&255,Ne=65535&w,!(Be+(pe=w>>>24)<=A);){if(V===0)break e;V--,R+=F[Z++]<<A,A+=8}R>>>=Be,A-=Be,g.back+=Be}if(R>>>=pe,A-=pe,g.back+=pe,g.length=Ne,be===0){g.mode=26;break}if(32&be){g.back=-1,g.mode=12;break}if(64&be){I.msg="invalid literal/length code",g.mode=30;break}g.extra=15&be,g.mode=22;case 22:if(g.extra){for(E=g.extra;A<E;){if(V===0)break e;V--,R+=F[Z++]<<A,A+=8}g.length+=R&(1<<g.extra)-1,R>>>=g.extra,A-=g.extra,g.back+=g.extra}g.was=g.length,g.mode=23;case 23:for(;be=(w=g.distcode[R&(1<<g.distbits)-1])>>>16&255,Ne=65535&w,!((pe=w>>>24)<=A);){if(V===0)break e;V--,R+=F[Z++]<<A,A+=8}if(!(240&be)){for(Be=pe,Ze=be,Ve=Ne;be=(w=g.distcode[Ve+((R&(1<<Be+Ze)-1)>>Be)])>>>16&255,Ne=65535&w,!(Be+(pe=w>>>24)<=A);){if(V===0)break e;V--,R+=F[Z++]<<A,A+=8}R>>>=Be,A-=Be,g.back+=Be}if(R>>>=pe,A-=pe,g.back+=pe,64&be){I.msg="invalid distance code",g.mode=30;break}g.offset=Ne,g.extra=15&be,g.mode=24;case 24:if(g.extra){for(E=g.extra;A<E;){if(V===0)break e;V--,R+=F[Z++]<<A,A+=8}g.offset+=R&(1<<g.extra)-1,R>>>=g.extra,A-=g.extra,g.back+=g.extra}if(g.offset>g.dmax){I.msg="invalid distance too far back",g.mode=30;break}g.mode=25;case 25:if(le===0)break e;if(X=ee-le,g.offset>X){if((X=g.offset-X)>g.whave&&g.sane){I.msg="invalid distance too far back",g.mode=30;break}xe=X>g.wnext?(X-=g.wnext,g.wsize-X):g.wnext-X,X>g.length&&(X=g.length),De=g.window}else De=oe,xe=de-g.offset,X=g.length;for(le<X&&(X=le),le-=X,g.length-=X;oe[de++]=De[xe++],--X;);g.length===0&&(g.mode=21);break;case 26:if(le===0)break e;oe[de++]=g.length,le--,g.mode=21;break;case 27:if(g.wrap){for(;A<32;){if(V===0)break e;V--,R|=F[Z++]<<A,A+=8}if(ee-=le,I.total_out+=ee,g.total+=ee,ee&&(I.adler=g.check=g.flags?i(g.check,oe,ee,de-ee):r(g.check,oe,ee,de-ee)),ee=le,(g.flags?R:b(R))!==g.check){I.msg="incorrect data check",g.mode=30;break}A=R=0}g.mode=28;case 28:if(g.wrap&&g.flags){for(;A<32;){if(V===0)break e;V--,R+=F[Z++]<<A,A+=8}if(R!==(4294967295&g.total)){I.msg="incorrect length check",g.mode=30;break}A=R=0}g.mode=29;case 29:P=1;break e;case 30:P=-3;break e;case 31:return-4;case 32:default:return h}return I.next_out=de,I.avail_out=le,I.next_in=Z,I.avail_in=V,g.hold=R,g.bits=A,(g.wsize||ee!==I.avail_out&&g.mode<30&&(g.mode<27||z!==4))&&Q(I,I.output,I.next_out,ee-I.avail_out)?(g.mode=31,-4):(ce-=I.avail_in,ee-=I.avail_out,I.total_in+=ce,I.total_out+=ee,g.total+=ee,g.wrap&&ee&&(I.adler=g.check=g.flags?i(g.check,oe,ee,I.next_out-ee):r(g.check,oe,ee,I.next_out-ee)),I.data_type=g.bits+(g.last?64:0)+(g.mode===12?128:0)+(g.mode===20||g.mode===15?256:0),(ce==0&&ee===0||z===4)&&P===m&&(P=-5),P)},a.inflateEnd=function(I){if(!I||!I.state)return h;var z=I.state;return z.window&&(z.window=null),I.state=null,m},a.inflateGetHeader=function(I,z){var g;return I&&I.state&&2&(g=I.state).wrap?((g.head=z).done=!1,m):h},a.inflateSetDictionary=function(I,z){var g,F=z.length;return I&&I.state?(g=I.state).wrap!==0&&g.mode!==11?h:g.mode===11&&r(1,z,F,0)!==g.check?-3:Q(I,z,F,F)?(g.mode=31,-4):(g.havedict=1,m):h},a.inflateInfo="pako inflate (from Nodeca project)"},{"../utils/common":41,"./adler32":43,"./crc32":45,"./inffast":48,"./inftrees":50}],50:[function(t,c,a){var n=t("../utils/common"),r=[3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0],i=[16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78],o=[1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0],l=[16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64];c.exports=function(f,p,m,h,y,u,v,b){var C,S,_,k,x,L,B,O,H,Q=b.bits,I=0,z=0,g=0,F=0,oe=0,Z=0,de=0,V=0,le=0,R=0,A=null,ce=0,ee=new n.Buf16(16),X=new n.Buf16(16),xe=null,De=0;for(I=0;I<=15;I++)ee[I]=0;for(z=0;z<h;z++)ee[p[m+z]]++;for(oe=Q,F=15;1<=F&&ee[F]===0;F--);if(F<oe&&(oe=F),F===0)return y[u++]=20971520,y[u++]=20971520,b.bits=1,0;for(g=1;g<F&&ee[g]===0;g++);for(oe<g&&(oe=g),I=V=1;I<=15;I++)if(V<<=1,(V-=ee[I])<0)return-1;if(0<V&&(f===0||F!==1))return-1;for(X[1]=0,I=1;I<15;I++)X[I+1]=X[I]+ee[I];for(z=0;z<h;z++)p[m+z]!==0&&(v[X[p[m+z]]++]=z);if(L=f===0?(A=xe=v,19):f===1?(A=r,ce-=257,xe=i,De-=257,256):(A=o,xe=l,-1),I=g,x=u,de=z=R=0,_=-1,k=(le=1<<(Z=oe))-1,f===1&&852<le||f===2&&592<le)return 1;for(;;){for(B=I-de,H=v[z]<L?(O=0,v[z]):v[z]>L?(O=xe[De+v[z]],A[ce+v[z]]):(O=96,0),C=1<<I-de,g=S=1<<Z;y[x+(R>>de)+(S-=C)]=B<<24|O<<16|H|0,S!==0;);for(C=1<<I-1;R&C;)C>>=1;if(C!==0?(R&=C-1,R+=C):R=0,z++,--ee[I]==0){if(I===F)break;I=p[m+v[z]]}if(oe<I&&(R&k)!==_){for(de===0&&(de=oe),x+=g,V=1<<(Z=I-de);Z+de<F&&!((V-=ee[Z+de])<=0);)Z++,V<<=1;if(le+=1<<Z,f===1&&852<le||f===2&&592<le)return 1;y[_=R&k]=oe<<24|Z<<16|x-u|0}}return R!==0&&(y[x+R]=I-de<<24|64<<16|0),b.bits=oe,0}},{"../utils/common":41}],51:[function(t,c,a){c.exports={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"}},{}],52:[function(t,c,a){var n=t("../utils/common"),r=0,i=1;function o(w){for(var T=w.length;0<=--T;)w[T]=0}var l=0,f=29,p=256,m=p+1+f,h=30,y=19,u=2*m+1,v=15,b=16,C=7,S=256,_=16,k=17,x=18,L=[0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0],B=[0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13],O=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,3,7],H=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15],Q=new Array(2*(m+2));o(Q);var I=new Array(2*h);o(I);var z=new Array(512);o(z);var g=new Array(256);o(g);var F=new Array(f);o(F);var oe,Z,de,V=new Array(h);function le(w,T,W,q,D){this.static_tree=w,this.extra_bits=T,this.extra_base=W,this.elems=q,this.max_length=D,this.has_stree=w&&w.length}function R(w,T){this.dyn_tree=w,this.max_code=0,this.stat_desc=T}function A(w){return w<256?z[w]:z[256+(w>>>7)]}function ce(w,T){w.pending_buf[w.pending++]=255&T,w.pending_buf[w.pending++]=T>>>8&255}function ee(w,T,W){w.bi_valid>b-W?(w.bi_buf|=T<<w.bi_valid&65535,ce(w,w.bi_buf),w.bi_buf=T>>b-w.bi_valid,w.bi_valid+=W-b):(w.bi_buf|=T<<w.bi_valid&65535,w.bi_valid+=W)}function X(w,T,W){ee(w,W[2*T],W[2*T+1])}function xe(w,T){for(var W=0;W|=1&w,w>>>=1,W<<=1,0<--T;);return W>>>1}function De(w,T,W){var q,D,J=new Array(v+1),te=0;for(q=1;q<=v;q++)J[q]=te=te+W[q-1]<<1;for(D=0;D<=T;D++){var Y=w[2*D+1];Y!==0&&(w[2*D]=xe(J[Y]++,Y))}}function pe(w){var T;for(T=0;T<m;T++)w.dyn_ltree[2*T]=0;for(T=0;T<h;T++)w.dyn_dtree[2*T]=0;for(T=0;T<y;T++)w.bl_tree[2*T]=0;w.dyn_ltree[2*S]=1,w.opt_len=w.static_len=0,w.last_lit=w.matches=0}function be(w){8<w.bi_valid?ce(w,w.bi_buf):0<w.bi_valid&&(w.pending_buf[w.pending++]=w.bi_buf),w.bi_buf=0,w.bi_valid=0}function Ne(w,T,W,q){var D=2*T,J=2*W;return w[D]<w[J]||w[D]===w[J]&&q[T]<=q[W]}function Be(w,T,W){for(var q=w.heap[W],D=W<<1;D<=w.heap_len&&(D<w.heap_len&&Ne(T,w.heap[D+1],w.heap[D],w.depth)&&D++,!Ne(T,q,w.heap[D],w.depth));)w.heap[W]=w.heap[D],W=D,D<<=1;w.heap[W]=q}function Ze(w,T,W){var q,D,J,te,Y=0;if(w.last_lit!==0)for(;q=w.pending_buf[w.d_buf+2*Y]<<8|w.pending_buf[w.d_buf+2*Y+1],D=w.pending_buf[w.l_buf+Y],Y++,q===0?X(w,D,T):(X(w,(J=g[D])+p+1,T),(te=L[J])!==0&&ee(w,D-=F[J],te),X(w,J=A(--q),W),(te=B[J])!==0&&ee(w,q-=V[J],te)),Y<w.last_lit;);X(w,S,T)}function Ve(w,T){var W,q,D,J=T.dyn_tree,te=T.stat_desc.static_tree,Y=T.stat_desc.has_stree,ae=T.stat_desc.elems,we=-1;for(w.heap_len=0,w.heap_max=u,W=0;W<ae;W++)J[2*W]!==0?(w.heap[++w.heap_len]=we=W,w.depth[W]=0):J[2*W+1]=0;for(;w.heap_len<2;)J[2*(D=w.heap[++w.heap_len]=we<2?++we:0)]=1,w.depth[D]=0,w.opt_len--,Y&&(w.static_len-=te[2*D+1]);for(T.max_code=we,W=w.heap_len>>1;1<=W;W--)Be(w,J,W);for(D=ae;W=w.heap[1],w.heap[1]=w.heap[w.heap_len--],Be(w,J,1),q=w.heap[1],w.heap[--w.heap_max]=W,w.heap[--w.heap_max]=q,J[2*D]=J[2*W]+J[2*q],w.depth[D]=(w.depth[W]>=w.depth[q]?w.depth[W]:w.depth[q])+1,J[2*W+1]=J[2*q+1]=D,w.heap[1]=D++,Be(w,J,1),2<=w.heap_len;);w.heap[--w.heap_max]=w.heap[1],function(he,Je){var Ct,ot,wt,Le,Pt,en,ct=Je.dyn_tree,ft=Je.max_code,tn=Je.stat_desc.static_tree,Cs=Je.stat_desc.has_stree,Dn=Je.stat_desc.extra_bits,Nn=Je.stat_desc.extra_base,Et=Je.stat_desc.max_length,pt=0;for(Le=0;Le<=v;Le++)he.bl_count[Le]=0;for(ct[2*he.heap[he.heap_max]+1]=0,Ct=he.heap_max+1;Ct<u;Ct++)Et<(Le=ct[2*ct[2*(ot=he.heap[Ct])+1]+1]+1)&&(Le=Et,pt++),ct[2*ot+1]=Le,ft<ot||(he.bl_count[Le]++,Pt=0,Nn<=ot&&(Pt=Dn[ot-Nn]),en=ct[2*ot],he.opt_len+=en*(Le+Pt),Cs&&(he.static_len+=en*(tn[2*ot+1]+Pt)));if(pt!==0){do{for(Le=Et-1;he.bl_count[Le]===0;)Le--;he.bl_count[Le]--,he.bl_count[Le+1]+=2,he.bl_count[Et]--,pt-=2}while(0<pt);for(Le=Et;Le!==0;Le--)for(ot=he.bl_count[Le];ot!==0;)ft<(wt=he.heap[--Ct])||(ct[2*wt+1]!==Le&&(he.opt_len+=(Le-ct[2*wt+1])*ct[2*wt],ct[2*wt+1]=Le),ot--)}}(w,T),De(J,we,w.bl_count)}function d(w,T,W){var q,D,J=-1,te=T[1],Y=0,ae=7,we=4;for(te===0&&(ae=138,we=3),T[2*(W+1)+1]=65535,q=0;q<=W;q++)D=te,te=T[2*(q+1)+1],++Y<ae&&D===te||(Y<we?w.bl_tree[2*D]+=Y:D!==0?(D!==J&&w.bl_tree[2*D]++,w.bl_tree[2*_]++):Y<=10?w.bl_tree[2*k]++:w.bl_tree[2*x]++,J=D,we=(Y=0)===te?(ae=138,3):D===te?(ae=6,3):(ae=7,4))}function P(w,T,W){var q,D,J=-1,te=T[1],Y=0,ae=7,we=4;for(te===0&&(ae=138,we=3),q=0;q<=W;q++)if(D=te,te=T[2*(q+1)+1],!(++Y<ae&&D===te)){if(Y<we)for(;X(w,D,w.bl_tree),--Y!=0;);else D!==0?(D!==J&&(X(w,D,w.bl_tree),Y--),X(w,_,w.bl_tree),ee(w,Y-3,2)):Y<=10?(X(w,k,w.bl_tree),ee(w,Y-3,3)):(X(w,x,w.bl_tree),ee(w,Y-11,7));J=D,we=(Y=0)===te?(ae=138,3):D===te?(ae=6,3):(ae=7,4)}}o(V);var $=!1;function E(w,T,W,q){ee(w,(l<<1)+(q?1:0),3),function(D,J,te,Y){be(D),ce(D,te),ce(D,~te),n.arraySet(D.pending_buf,D.window,J,te,D.pending),D.pending+=te}(w,T,W)}a._tr_init=function(w){$||(function(){var T,W,q,D,J,te=new Array(v+1);for(D=q=0;D<f-1;D++)for(F[D]=q,T=0;T<1<<L[D];T++)g[q++]=D;for(g[q-1]=D,D=J=0;D<16;D++)for(V[D]=J,T=0;T<1<<B[D];T++)z[J++]=D;for(J>>=7;D<h;D++)for(V[D]=J<<7,T=0;T<1<<B[D]-7;T++)z[256+J++]=D;for(W=0;W<=v;W++)te[W]=0;for(T=0;T<=143;)Q[2*T+1]=8,T++,te[8]++;for(;T<=255;)Q[2*T+1]=9,T++,te[9]++;for(;T<=279;)Q[2*T+1]=7,T++,te[7]++;for(;T<=287;)Q[2*T+1]=8,T++,te[8]++;for(De(Q,m+1,te),T=0;T<h;T++)I[2*T+1]=5,I[2*T]=xe(T,5);oe=new le(Q,L,p+1,m,v),Z=new le(I,B,0,h,v),de=new le(new Array(0),O,0,y,C)}(),$=!0),w.l_desc=new R(w.dyn_ltree,oe),w.d_desc=new R(w.dyn_dtree,Z),w.bl_desc=new R(w.bl_tree,de),w.bi_buf=0,w.bi_valid=0,pe(w)},a._tr_stored_block=E,a._tr_flush_block=function(w,T,W,q){var D,J,te=0;0<w.level?(w.strm.data_type===2&&(w.strm.data_type=function(Y){var ae,we=4093624447;for(ae=0;ae<=31;ae++,we>>>=1)if(1&we&&Y.dyn_ltree[2*ae]!==0)return r;if(Y.dyn_ltree[18]!==0||Y.dyn_ltree[20]!==0||Y.dyn_ltree[26]!==0)return i;for(ae=32;ae<p;ae++)if(Y.dyn_ltree[2*ae]!==0)return i;return r}(w)),Ve(w,w.l_desc),Ve(w,w.d_desc),te=function(Y){var ae;for(d(Y,Y.dyn_ltree,Y.l_desc.max_code),d(Y,Y.dyn_dtree,Y.d_desc.max_code),Ve(Y,Y.bl_desc),ae=y-1;3<=ae&&Y.bl_tree[2*H[ae]+1]===0;ae--);return Y.opt_len+=3*(ae+1)+5+5+4,ae}(w),D=w.opt_len+3+7>>>3,(J=w.static_len+3+7>>>3)<=D&&(D=J)):D=J=W+5,W+4<=D&&T!==-1?E(w,T,W,q):w.strategy===4||J===D?(ee(w,2+(q?1:0),3),Ze(w,Q,I)):(ee(w,4+(q?1:0),3),function(Y,ae,we,he){var Je;for(ee(Y,ae-257,5),ee(Y,we-1,5),ee(Y,he-4,4),Je=0;Je<he;Je++)ee(Y,Y.bl_tree[2*H[Je]+1],3);P(Y,Y.dyn_ltree,ae-1),P(Y,Y.dyn_dtree,we-1)}(w,w.l_desc.max_code+1,w.d_desc.max_code+1,te+1),Ze(w,w.dyn_ltree,w.dyn_dtree)),pe(w),q&&be(w)},a._tr_tally=function(w,T,W){return w.pending_buf[w.d_buf+2*w.last_lit]=T>>>8&255,w.pending_buf[w.d_buf+2*w.last_lit+1]=255&T,w.pending_buf[w.l_buf+w.last_lit]=255&W,w.last_lit++,T===0?w.dyn_ltree[2*W]++:(w.matches++,T--,w.dyn_ltree[2*(g[W]+p+1)]++,w.dyn_dtree[2*A(T)]++),w.last_lit===w.lit_bufsize-1},a._tr_align=function(w){ee(w,2,3),X(w,S,Q),function(T){T.bi_valid===16?(ce(T,T.bi_buf),T.bi_buf=0,T.bi_valid=0):8<=T.bi_valid&&(T.pending_buf[T.pending++]=255&T.bi_buf,T.bi_buf>>=8,T.bi_valid-=8)}(w)}},{"../utils/common":41}],53:[function(t,c,a){c.exports=function(){this.input=null,this.next_in=0,this.avail_in=0,this.total_in=0,this.output=null,this.next_out=0,this.avail_out=0,this.total_out=0,this.msg="",this.state=null,this.data_type=2,this.adler=0}},{}],54:[function(t,c,a){(function(n){(function(r,i){if(!r.setImmediate){var o,l,f,p,m=1,h={},y=!1,u=r.document,v=Object.getPrototypeOf&&Object.getPrototypeOf(r);v=v&&v.setTimeout?v:r,o={}.toString.call(r.process)==="[object process]"?function(_){process.nextTick(function(){C(_)})}:function(){if(r.postMessage&&!r.importScripts){var _=!0,k=r.onmessage;return r.onmessage=function(){_=!1},r.postMessage("","*"),r.onmessage=k,_}}()?(p="setImmediate$"+Math.random()+"$",r.addEventListener?r.addEventListener("message",S,!1):r.attachEvent("onmessage",S),function(_){r.postMessage(p+_,"*")}):r.MessageChannel?((f=new MessageChannel).port1.onmessage=function(_){C(_.data)},function(_){f.port2.postMessage(_)}):u&&"onreadystatechange"in u.createElement("script")?(l=u.documentElement,function(_){var k=u.createElement("script");k.onreadystatechange=function(){C(_),k.onreadystatechange=null,l.removeChild(k),k=null},l.appendChild(k)}):function(_){setTimeout(C,0,_)},v.setImmediate=function(_){typeof _!="function"&&(_=new Function(""+_));for(var k=new Array(arguments.length-1),x=0;x<k.length;x++)k[x]=arguments[x+1];var L={callback:_,args:k};return h[m]=L,o(m),m++},v.clearImmediate=b}function b(_){delete h[_]}function C(_){if(y)setTimeout(C,0,_);else{var k=h[_];if(k){y=!0;try{(function(x){var L=x.callback,B=x.args;switch(B.length){case 0:L();break;case 1:L(B[0]);break;case 2:L(B[0],B[1]);break;case 3:L(B[0],B[1],B[2]);break;default:L.apply(i,B)}})(k)}finally{b(_),y=!1}}}}function S(_){_.source===r&&typeof _.data=="string"&&_.data.indexOf(p)===0&&C(+_.data.slice(p.length))}})(typeof self>"u"?n===void 0?this:n:self)}).call(this,typeof Mn<"u"?Mn:typeof self<"u"?self:typeof window<"u"?window:{})},{}]},{},[10])(10)})})(wa);var Nr=wa.exports;const Ci=Xi(Nr);async function Ar(e=[]){const s={};if(e.length>0)e.forEach(l=>{ie[l]&&(s[l]=ie[l])});else for(const l in ie)ie[l].isDeleted||(s[l]=ie[l]);const t={metadata:{version:"2.0-b64",createdAt:new Date().toISOString()},data:{classrooms:s,trashBin:Ue,userSettings:ze}},c=JSON.stringify(t),a=new Date,n=new Intl.DateTimeFormat("fa-IR-u-nu-latn",{year:"numeric",month:"numeric",day:"numeric",hour:"2-digit",minute:"2-digit",hour12:!1}).formatToParts(a).reduce((l,f)=>(l[f.type]=f.value,l),{}),i=`${n.year.slice(-2)}-${n.month}-${n.day}_${n.hour}-${n.minute}`;let o;e.length===0?o=`SP_Full_${i}.txt`:e.length===1?o=`SP_${e[0].replace(/[<>:"/\\|?*]/g,"").replace(/\s+/g,"_")}_${i}.txt`:o=`SP_Selected-${e.length}_${i}.txt`;try{const l=new Ci;l.file("backup.json",c);const f=await l.generateAsync({type:"blob",compression:"DEFLATE",compressionOptions:{level:9}}),p=await Mr(f);return new File([p],o,{type:"text/plain"})}catch(l){return console.error("Error creating base64 backup file:",l),null}}function Mr(e){return new Promise((s,t)=>{const c=new FileReader;c.onerror=t,c.onload=()=>{s(c.result.split(",")[1])},c.readAsDataURL(e)})}function Or(e,s){if(s)zt(e.data.classrooms),gi(e.data.trashBin||[]);else{const t=e.data.classrooms,c=e.data.trashBin||[],a=new Map;for(const r in ie){const i=ie[r];i.info&&i.info.scheduleCode&&a.set(i.info.scheduleCode,r)}for(const r in t){const i=t[r],o=i.info.scheduleCode;if(a.has(o)){const l=a.get(o);l!==i.info.name&&delete ie[l],ie[i.info.name]=i}else{let l=i.info.name;for(;ie[l];)l=`${l} (Imported)`;l!==i.info.name&&(i.info.name=l),ie[l]=i}}const n=new Set(Ue.map(r=>r.id));c.forEach(r=>{n.has(r.id)||Ue.push(r)}),zt(ie)}e.data.userSettings&&_t(e.data.userSettings),_t({lastRestoreTimestamp:new Date().toISOString()}),se()}async function is(e=[]){const s=await Ar(e);if(!s){j("âŒ Ø®Ø·Ø§ Ø¯Ø± Ø§ÛŒØ¬Ø§Ø¯ ÙØ§ÛŒÙ„ Ù¾Ø´ØªÛŒØ¨Ø§Ù†.");return}let t="Ù¾Ø´ØªÛŒØ¨Ø§Ù† Ú©Ø§Ù…Ù„ Ø³ÛŒØ³ØªÙ…";if(e.length>0){const a=e.join("ØŒ ");t=`${e.length===1?"Ù¾Ø´ØªÛŒØ¨Ø§Ù† Ú©Ù„Ø§Ø³:":"Ù¾Ø´ØªÛŒØ¨Ø§Ù† Ú©Ù„Ø§Ø³â€ŒÙ‡Ø§ÛŒ:"} ${a}`}ba(s,{name:s.name,description:t,version:"2.0-b64"}).catch(a=>console.error("Failed to save local snapshot:",a)),("ontouchstart"in window||navigator.maxTouchPoints>0)&&navigator.share&&navigator.canShare&&navigator.canShare({files:[s]})?ge("ÙØ§ÛŒÙ„ Ù¾Ø´ØªÛŒØ¨Ø§Ù† Ø´Ù…Ø§ Ø¢Ù…Ø§Ø¯Ù‡ Ø§Ø³Øª. Ø¢ÛŒØ§ Ù…Ø§ÛŒÙ„ Ø¨Ù‡ Ø§Ø´ØªØ±Ø§Ú©â€ŒÚ¯Ø°Ø§Ø±ÛŒ Ø¢Ù† Ù‡Ø³ØªÛŒØ¯ØŸ",()=>{try{navigator.share({title:s.name,text:"ÙØ§ÛŒÙ„ Ù¾Ø´ØªÛŒØ¨Ø§Ù† Ø¯Ø§Ø¯Ù‡â€ŒÙ‡Ø§ÛŒ Ø¨Ø±Ù†Ø§Ù…Ù‡",files:[s]}).then(()=>{ge("Ø¢ÛŒØ§ ÙØ§ÛŒÙ„ Ù¾Ø´ØªÛŒØ¨Ø§Ù† Ø¨Ø§ Ù…ÙˆÙÙ‚ÛŒØª Ø§Ø±Ø³Ø§Ù„/Ø°Ø®ÛŒØ±Ù‡ Ø´Ø¯ØŸ",()=>{yi(),bs(),j("âœ… ØªØ§Ø±ÛŒØ® Ù¾Ø´ØªÛŒØ¨Ø§Ù† Ø«Ø¨Øª Ø´Ø¯.")},{confirmText:"Ø¨Ù„Ù‡",cancelText:"Ø®ÛŒØ±",confirmClass:"btn-success"})})}catch(a){console.error("Error during sharing process:",a),Ws(s),j("âš ï¸Ø®Ø·Ø§ Ø¯Ø± ÙØ±Ø¢ÛŒÙ†Ø¯ Ø§Ø´ØªØ±Ø§Ú©â€ŒÚ¯Ø°Ø§Ø±ÛŒ. ÙØ§ÛŒÙ„ Ø¯Ø± Ø­Ø§Ù„ Ø¯Ø§Ù†Ù„ÙˆØ¯ Ø§Ø³Øª.")}},{confirmText:"Ø¨Ù„Ù‡",cancelText:"Ø®ÛŒØ±",confirmClass:"btn-success"}):(Ws(s),j("âœ…Ù¾Ø´ØªÛŒØ¨Ø§Ù†â€ŒÚ¯ÛŒØ±ÛŒ Ø¨Ø§ Ù…ÙˆÙÙ‚ÛŒØª Ø§Ù†Ø¬Ø§Ù… Ø´Ø¯."))}function Fe(e){return typeof e!="string"?"":e.replace(/ÙŠ/g,"ÛŒ").replace(/Ùƒ/g,"Ú©").replace(/[\s\u200c]/g,"")}function gs(e){return typeof e!="string"||e.length===0?"ltr":/[\u0590-\u07FF]/.test(e)?"rtl":"ltr"}function wi(e){return!e||!e.trim()?"":e.split(`
`).map(c=>`<div dir="${gs(c)}">${c||"&nbsp;"}</div>`).join("")}function Fn(e){if(typeof e!="string")return"";const s={q:"Ø¶",w:"Øµ",e:"Ø«",r:"Ù‚",t:"Ù",y:"Øº",u:"Ø¹",i:"Ù‡",o:"Ø®",p:"Ø­","[":"Ø¬","]":"Ú†",a:"Ø´",s:"Ø³",d:"ÛŒ",f:"Ø¨",g:"Ù„",h:"Ø§",j:"Øª",k:"Ù†",l:"Ù…",";":"Ú©","'":"Ú¯",z:"Ø¸",x:"Ø·",c:"Ø²",v:"Ø±",b:"Ø°",n:"Ø¯",m:"Ù¾",",":"Ùˆ"};let t="";for(let c=0;c<e.length;c++){const a=e[c].toLowerCase();t+=s[a]||e[c]}return t}function Gt(e){if(!e||typeof e!="string")return{name:"",firstName:"",lastName:""};const s=e.split(".").map(t=>t.trim());if(s.length>1){const t=s[0],c=s.slice(1).join(" ");return{firstName:t,lastName:c,name:`${t} ${c}`.trim()}}return{name:e.trim(),firstName:"",lastName:""}}let ks=null;function Ls(){if(!ze.isSoundEnabled)return;const e=window.AudioContext||window.webkitAudioContext;if(!e)return;ks||(ks=new e);const s=ks,t=()=>{const c=s.createOscillator(),a=s.createGain();c.connect(a),a.connect(s.destination),c.type="sine";const n=s.currentTime;c.frequency.setValueAtTime(450,n),a.gain.setValueAtTime(0,n),a.gain.linearRampToValueAtTime(.3,n+.002),a.gain.exponentialRampToValueAtTime(.001,n+.025),a.gain.linearRampToValueAtTime(0,n+.03),c.start(n),c.stop(n+.04)};s.state==="suspended"?s.resume().then(()=>{t()}).catch(c=>console.error("Audio resume failed:",c)):t()}function Ln(e){const s=e.filter(a=>a.identity.firstName&&a.identity.lastName),t=e.filter(a=>(!a.identity.firstName||!a.identity.lastName)&&typeof a.identity.name=="string"),c=e.filter(a=>(!a.identity.firstName||!a.identity.lastName)&&!a.identity.name);return s.sort((a,n)=>{const r=a.identity.lastName.localeCompare(n.identity.lastName,"fa");return r!==0?r:a.identity.firstName.localeCompare(n.identity.firstName,"fa")}),t.sort((a,n)=>a.identity.name.localeCompare(n.identity.name,"fa")),[...s,...t,...c]}function Ea(e,s){let t=0;e.addEventListener("dblclick",s),e.addEventListener("touchend",c=>{const a=new Date().getTime(),n=a-t;n<400&&n>0&&(c.preventDefault(),s(c)),t=a})}function wn(e,s,t){e&&e.addEventListener("keydown",c=>{if(e.tagName==="TEXTAREA"&&s==="Enter"){(c.ctrlKey||c.metaKey)&&c.key==="Enter"&&t(c);return}c.shiftKey&&s==="Enter"||c.key===s&&t(c)})}function En(e){e&&typeof e.blur=="function"&&(e==null?void 0:e.tagName)==="INPUT"&&e.blur()}function Ei(e){e&&e.addEventListener("focus",()=>{e.select()})}function gt(e,s=4e3,t=!0){t&&Sa(e),e.classList.add("blink-error"),setTimeout(()=>{e.classList.remove("blink-error")},s)}function Sa(e){e&&e.scrollIntoView({behavior:"smooth",block:"center"})}const Rr=Object.freeze(Object.defineProperty({__proto__:null,detectTextDirection:gs,flashElement:gt,hideKeyboard:En,normalizeKeyboard:Fn,normalizeText:Fe,parseStudentName:Gt,playSuccessSound:Ls,renderMultiLineText:wi,scrollToElement:Sa,setupAutoSelectOnFocus:Ei,setupDoubleAction:Ea,setupKeyboardShortcut:wn,sortStudents:Ln},Symbol.toStringTag,{value:"Module"})),_a="teacherAssistantLogs_v2",zr=100;function Si(){try{const e=localStorage.getItem(_a);return e?JSON.parse(e):{}}catch(e){return console.error("Error reading logs from localStorage:",e),{}}}function ka(e){try{localStorage.setItem(_a,JSON.stringify(e))}catch(s){console.error("Error saving logs to localStorage:",s)}}function Ce(e,s,t=null){if(!e)return;const c=Si();c[e]||(c[e]=[]);const a={timestamp:new Date().toISOString(),message:s,action:t,classroomName:e};c[e].unshift(a),c[e].length>zr&&c[e].pop(),ka(c)}function $r(e){return Si()[e]||[]}function Pr(e,s){const t=Si();t[e]&&!t[s]&&(t[s]=t[e],delete t[e],ka(t))}var qi={toJalaali:Fr,toGregorian:Ia,isValidJalaaliDate:Hr,isLeapJalaaliYear:xa,jalaaliMonthLength:La,jalCal:_i,j2d:as,d2j:rs,g2d:ys,d2g:ki,jalaaliToDateObject:Ta,jalaaliWeek:Wr},kt=[-61,9,38,199,426,686,756,818,1111,1181,1210,1635,2060,2097,2192,2262,2324,2394,2456,3178];function Fr(e,s,t){return Object.prototype.toString.call(e)==="[object Date]"&&(t=e.getDate(),s=e.getMonth()+1,e=e.getFullYear()),rs(ys(e,s,t))}function Ia(e,s,t){return ki(as(e,s,t))}function Hr(e,s,t){return e>=-61&&e<=3177&&s>=1&&s<=12&&t>=1&&t<=La(e,s)}function xa(e){return Ur(e)===0}function La(e,s){return s<=6?31:s<=11||xa(e)?30:29}function Ur(e){var s=kt.length,t=kt[0],c,a,n,r,i;if(e<t||e>=kt[s-1])throw new Error("Invalid Jalaali year "+e);for(i=1;i<s&&(c=kt[i],a=c-t,!(e<c));i+=1)t=c;return r=e-t,a-r<6&&(r=r-a+Ie(a+4,33)*33),n=et(et(r+1,33)-1,4),n===-1&&(n=4),n}function _i(e,s){var t=kt.length,c=e+621,a=-14,n=kt[0],r,i,o,l,f,p,m;if(e<n||e>=kt[t-1])throw new Error("Invalid Jalaali year "+e);for(m=1;m<t&&(r=kt[m],i=r-n,!(e<r));m+=1)a=a+Ie(i,33)*8+Ie(et(i,33),4),n=r;return p=e-n,a=a+Ie(p,33)*8+Ie(et(p,33)+3,4),et(i,33)===4&&i-p===4&&(a+=1),l=Ie(c,4)-Ie((Ie(c,100)+1)*3,4)-150,f=20+a-l,s?{gy:c,march:f}:(i-p<6&&(p=p-i+Ie(i+4,33)*33),o=et(et(p+1,33)-1,4),o===-1&&(o=4),{leap:o,gy:c,march:f})}function as(e,s,t){var c=_i(e,!0);return ys(c.gy,3,c.march)+(s-1)*31-Ie(s,7)*(s-7)+t-1}function rs(e){var s=ki(e).gy,t=s-621,c=_i(t,!1),a=ys(s,3,c.march),n,r,i;if(i=e-a,i>=0){if(i<=185)return r=1+Ie(i,31),n=et(i,31)+1,{jy:t,jm:r,jd:n};i-=186}else t-=1,i+=179,c.leap===1&&(i+=1);return r=7+Ie(i,30),n=et(i,30)+1,{jy:t,jm:r,jd:n}}function ys(e,s,t){var c=Ie((e+Ie(s-8,6)+100100)*1461,4)+Ie(153*et(s+9,12)+2,5)+t-34840408;return c=c-Ie(Ie(e+100100+Ie(s-8,6),100)*3,4)+752,c}function ki(e){var s,t,c,a,n;return s=4*e+139361631,s=s+Ie(Ie(4*e+183187720,146097)*3,4)*4-3908,t=Ie(et(s,1461),4)*5+308,c=Ie(et(t,153),5)+1,a=et(Ie(t,153),12)+1,n=Ie(s,1461)-100100+Ie(8-a,6),{gy:n,gm:a,gd:c}}function Wr(e,s,t){var c=Ta(e,s,t).getDay(),a=c==6?0:-(c+1),n=6+a;return{saturday:rs(as(e,s,t+a)),friday:rs(as(e,s,t+n))}}function Ta(e,s,t,c,a,n,r){var i=Ia(e,s,t);return new Date(i.gy,i.gm-1,i.gd,c||0,a||0,n||0,r||0)}function Ie(e,s){return~~(e/s)}function et(e,s){return e-~~(e/s)*s}function jr(e,s,t="default",c=!1){let a=[...ye(e.students)];const n=new Date().toLocaleDateString("fa-IR",{year:"numeric",month:"long",day:"numeric",weekday:"long"});t==="alpha"&&(a=Ln(a));let r="<tr>";s.forEach(m=>{r+=`<th>${m.label}</th>`}),r+="</tr>";let i="";a.forEach((m,h)=>{i+="<tr>",s.forEach(y=>{var C;let u="-";if(y.id==="row_num")u=h+1;else if(y.id==="name")m.identity.firstName&&m.identity.lastName?u=`${m.identity.lastName}ØŒ ${m.identity.firstName}`:u=m.identity.name;else if(y.id==="total_selections")u=m.statusCounters.totalSelections;else if(y.id==="absences")u=e.sessions.reduce((S,_)=>{if(_.isDeleted||_.isCancelled)return S;const k=_.studentRecords[m.identity.studentId];return S+(k&&k.attendance==="absent"?1:0)},0);else if(y.id==="exit_count")u=m.statusCounters.outOfClassCount||0;else if(y.id==="missed_chances")u=m.statusCounters.missedChances;else if(y.id==="issues")u=Object.values(m.categoryIssues||{}).reduce((S,_)=>S+_,0);else if(y.id==="avg_score")u=m.getOverallAverageScore()||"-";else if(y.id==="final_score")u=e.calculateFinalStudentScore(m)||"-";else if(y.type==="category")u=m.categoryCounts[y.id]||0;else if(y.type==="category_scores"){const S=y.id.toLowerCase(),_=((C=m.logs.scores[S])==null?void 0:C.filter(k=>!k.isDeleted))||[];u=_.length>0?_.map(k=>k.value).join("ØŒ "):"-"}let v="text-align: center;";y.id==="name"?v="text-align: right; white-space: nowrap;":y.type==="category_scores"&&(v="text-align: center; white-space: nowrap;");const b=`style="${v}"`;i+=`<td ${b}>${u}</td>`}),i+="</tr>"});let o="";c&&(o=`
            <div class="warning-footnote">
                âš ï¸ <strong>ØªÙˆØ¬Ù‡:</strong> ØªØ±ØªÛŒØ¨ Ø§Ù„ÙØ¨Ø§ÛŒÛŒ Ø§ÛŒÙ† Ù„ÛŒØ³Øª Ù…Ù…Ú©Ù† Ø§Ø³Øª Ø¯Ù‚ÛŒÙ‚ Ù†Ø¨Ø§Ø´Ø¯. (Ù†Ø§Ù… Ø®Ø§Ù†ÙˆØ§Ø¯Ú¯ÛŒ Ø¨Ø±Ø®ÛŒ Ø¯Ø§Ù†Ø´â€ŒØ¢Ù…ÙˆØ²Ø§Ù† Ø¯Ø± Ø³ÛŒØ³ØªÙ… ØªÙÚ©ÛŒÚ© Ù†Ø´Ø¯Ù‡ Ø§Ø³Øª)
            </div>
        `);const l=Array.from(document.querySelectorAll('link[rel="stylesheet"]')).map(m=>m.outerHTML).join(""),f=window.open("","_blank");if(!f){j("âš ï¸ Ù…Ø±ÙˆØ±Ú¯Ø± Ø´Ù…Ø§ Ù¾Ù†Ø¬Ø±Ù‡ Ø¬Ø¯ÛŒØ¯ Ø±Ø§ Ù…Ø³Ø¯ÙˆØ¯ Ú©Ø±Ø¯. Ù„Ø·ÙØ§Ù‹ Ø§Ø¬Ø§Ø²Ù‡ Ø¯Ù‡ÛŒØ¯.","error");return}const p=`
        <!DOCTYPE html>
        <html lang="fa" dir="rtl">
        <head>
            <title>Ú¯Ø²Ø§Ø±Ø´ Ú©Ù„Ø§Ø³ ${e.info.name}</title>
            ${l} <style>
                @media print {
                    @page { size: A4; margin: 10mm; }
                    /* Updated Font Family */
                    body { font-family: 'Vazirmatn', 'Vazir', Tahoma, sans-serif; color: #000; }
                }
                /* Updated Font Family */
                body { font-family: 'Vazirmatn', 'Vazir', Tahoma, sans-serif; padding: 20px; direction: rtl; }
                h1 { text-align: center; margin-bottom: 5px; font-size: 24px; }
                .meta { text-align: center; margin-bottom: 30px; font-size: 14px; color: #444; }
                table { width: 100%; border-collapse: collapse; font-size: 12px; }
                th, td { border: 1px solid #333; padding: 6px 8px; text-align: center; }
                th { background-color: #eee; font-weight: bold; }
                tr:nth-child(even) { background-color: #f9f9f9; }
                .signature { margin-top: 50px; display: flex; justify-content: space-between; padding: 0 50px; }
                
                .warning-footnote {
                    margin-top: 20px;
                    font-size: 11px;
                    color: #555;
                    font-style: italic;
                    border-top: 1px solid #ccc;
                    padding-top: 10px;
                }
            </style>
        </head>
        <body>
            <h1>Ú¯Ø²Ø§Ø±Ø´ ÙˆØ¶Ø¹ÛŒØª Ú©Ù„Ø§Ø³ ${e.info.name}</h1>
            <div class="meta">
                ØªØ§Ø±ÛŒØ® Ú¯Ø²Ø§Ø±Ø´: ${n} | ØªØ¹Ø¯Ø§Ø¯ Ø¯Ø§Ù†Ø´â€ŒØ¢Ù…ÙˆØ²Ø§Ù†: ${a.length}
            </div>
            <table>
                <thead>${r}</thead>
                <tbody>${i}</tbody>
            </table>
            ${o}
            <div class="signature">
                <div>Ø§Ù…Ø¶Ø§ÛŒ Ù…Ø¹Ù„Ù…</div>
                <div>Ù…Ù‡Ø± Ùˆ Ø§Ù…Ø¶Ø§ÛŒ Ù…Ø¯Ø±Ø³Ù‡</div>
            </div>
            <script>
                window.onload = function() { window.print(); }
            <\/script>
        </body>
        </html>
    `;f.document.write(p),f.document.close()}function qr(e){const s=Ha;s.innerHTML="";const c=ye(e.students).filter(m=>!m.identity.lastName).length,a=[{id:"row_num",label:"Ø±Ø¯ÛŒÙ",checked:!0},{id:"name",label:"Ù†Ø§Ù… Ø¯Ø§Ù†Ø´â€ŒØ¢Ù…ÙˆØ²",checked:!0},{id:"total_selections",label:"Ú©Ù„ Ø§Ù†ØªØ®Ø§Ø¨â€ŒÙ‡Ø§",checked:!0},{id:"absences",label:"ØªØ¹Ø¯Ø§Ø¯ ØºÛŒØ¨Øª",checked:!0},{id:"exit_count",label:"ØªØ¹Ø¯Ø§Ø¯ Ø®Ø±ÙˆØ¬",checked:!1},{id:"missed_chances",label:"ÙØ±ØµØª Ø³ÙˆØ®ØªÙ‡",checked:!1},{id:"issues",label:"Ù…Ø´Ú©Ù„â€ŒÙ¾Ø§Ø³Ø®Ú¯ÙˆÛŒÛŒ",checked:!1},{id:"avg_score",label:"Ù…ÛŒØ§Ù†Ú¯ÛŒÙ† Ù†Ù…Ø±Ø§Øª",checked:!0},{id:"final_score",label:"Ù†Ù…Ø±Ù‡ Ù†Ù‡Ø§ÛŒÛŒ (Ú©Ø§Ù†ÙˆÙ†)",checked:!0}];e.categories.forEach(m=>{m.isDeleted||(a.push({id:m.name,label:`ØªØ¹Ø¯Ø§Ø¯ ${m.name}`,type:"category",checked:!1}),m.isGradedCategory&&a.push({id:m.name,label:`Ù†Ù…Ø±Ø§Øª ${m.name}`,type:"category_scores",checked:!1}))}),a.forEach(m=>{const h=document.createElement("label");h.className="report-column-item";const y=document.createElement("input");y.type="checkbox",y.checked=m.checked,y.dataset.colId=m.id,y.dataset.colLabel=m.label,m.type&&(y.dataset.colType=m.type);const u=document.createElement("span");u.textContent=m.label,h.appendChild(y),h.appendChild(u),s.appendChild(h)});const n=s.parentElement,r=n.querySelector("#report-sort-options");r&&r.remove();const i=document.createElement("div");i.id="report-sort-options",i.style.marginTop="20px",i.style.padding="15px",i.style.backgroundColor="#f8f9fa",i.style.borderRadius="5px",i.style.border="1px solid #e9ecef",i.innerHTML=`
        <div style="margin-bottom: 10px; font-weight: bold; color: #333;">ØªØ±ØªÛŒØ¨ Ù†Ù…Ø§ÛŒØ´ Ù„ÛŒØ³Øª:</div>
        
        <div style="display: flex; flex-direction: column; gap: 10px;">
            <label style="cursor: pointer; display: flex; align-items: center; gap: 8px;">
                <input type="radio" name="report-sort" value="alpha" checked style="accent-color: var(--color-primary);">
                <span>Ø¨Ø± Ø§Ø³Ø§Ø³ Ù†Ø§Ù… Ø®Ø§Ù†ÙˆØ§Ø¯Ú¯ÛŒ</span>
            </label>

            <label style="cursor: pointer; display: flex; align-items: center; gap: 8px;">
                <input type="radio" name="report-sort" value="default" style="accent-color: var(--color-primary);">
                <span>Ø¨Ø± Ø§Ø³Ø§Ø³ Ø²Ù…Ø§Ù† ÙˆØ±ÙˆØ¯ Ø¨Ù‡ Ú©Ù„Ø§Ø³</span>
            </label>
        </div>

        <div id="sort-warning" style="
            display: none; 
            margin-top: 12px; 
            background-color: #fff3cd; 
            color: #856404; 
            padding: 10px; 
            border-radius: 4px; 
            font-size: 13px; 
            border: 1px solid #ffeeba;
            line-height: 1.5;
        ">
            âš ï¸ <strong>ØªÙˆØ¬Ù‡:</strong> Ù†Ø§Ù… Ø®Ø§Ù†ÙˆØ§Ø¯Ú¯ÛŒ ${c} Ø¯Ø§Ù†Ø´â€ŒØ¢Ù…ÙˆØ² Ù‡Ù†ÙˆØ² ØªÙÚ©ÛŒÚ© Ù†Ø´Ø¯Ù‡ Ø§Ø³Øª. Ù…Ø±ØªØ¨â€ŒØ³Ø§Ø²ÛŒ Ø§ÛŒÙ† Ù…ÙˆØ§Ø±Ø¯ Ù…Ù…Ú©Ù† Ø§Ø³Øª Ú©Ø§Ù…Ù„Ø§Ù‹ Ø¯Ù‚ÛŒÙ‚ Ù†Ø¨Ø§Ø´Ø¯.
        </div>
    `;const o=n.querySelector(".modal-actions");n.insertBefore(i,o);const l=i.querySelectorAll('input[name="report-sort"]'),f=i.querySelector("#sort-warning"),p=()=>{const m=i.querySelector('input[value="alpha"]').checked;f.style.display=m&&c>0?"block":"none"};l.forEach(m=>m.addEventListener("change",p)),p(),Ua.onclick=()=>{const m=[];if(s.querySelectorAll('input[type="checkbox"]:checked').forEach(v=>{m.push({id:v.dataset.colId,label:v.dataset.colLabel,type:v.dataset.colType})}),m.length===0){j("âš ï¸ Ù„Ø·ÙØ§Ù‹ Ø­Ø¯Ø§Ù‚Ù„ ÛŒÚ© Ø³ØªÙˆÙ† Ø±Ø§ Ø§Ù†ØªØ®Ø§Ø¨ Ú©Ù†ÛŒØ¯.");return}const y=i.querySelector('input[name="report-sort"]:checked').value,u=y==="alpha"&&c>0;fe(),jr(e,m,y,u)},Wa.onclick=()=>{fe()},Te("report-config-modal")}const Ba=document.getElementById("class-management-page"),Gr=document.getElementById("open-add-class-modal-btn"),Zr=document.getElementById("add-class-modal"),Sn=document.getElementById("modal-new-class-name"),Ii=document.getElementById("modal-add-class-system"),xi=document.getElementById("modal-add-class-level"),Ts=document.getElementById("confirm-add-class-btn"),Bs=document.getElementById("cancel-add-class-btn"),At=document.getElementById("class-list"),os=document.getElementById("undo-toast"),Da=document.getElementById("undo-message"),Vr=document.getElementById("undo-btn"),Jr=document.getElementById("settings-page"),Na=document.getElementById("settings-class-name-header"),Ds=document.getElementById("settings-student-list"),Ns=document.getElementById("category-list"),Kr=document.getElementById("back-to-sessions-btn"),Yr=document.getElementById("new-student-name"),Xr=document.getElementById("add-student-btn"),Aa=document.getElementById("paste-area"),Qr=document.getElementById("process-paste-btn"),eo=document.getElementById("csv-preview-page"),As=document.getElementById("csv-preview-list"),to=document.getElementById("csv-confirm-btn"),no=document.getElementById("csv-cancel-btn"),so=document.getElementById("import-csv-btn"),io=document.getElementById("csv-file-input"),ao=document.getElementById("column-mapping-page"),Ms=document.getElementById("column-select-dropdown"),ro=document.getElementById("confirm-column-btn"),oo=document.getElementById("cancel-import-btn"),Os=document.querySelector(".app-header"),Qe=document.getElementById("select-student-btn"),Mt=document.getElementById("select-student-btn-wrapper"),co=document.getElementById("assessment-mode-label"),an=document.getElementById("category-weight-label"),lo=document.getElementById("attendance-page"),un=document.getElementById("attendance-list"),uo=document.getElementById("finish-attendance-btn"),fo=document.querySelector("#class-management-page h2"),Rs=document.getElementById("student-stats-header"),mo=document.getElementById("hamburger-menu-btn"),Ma=document.getElementById("side-nav-menu"),ho=document.getElementById("close-nav-btn"),Oa=document.getElementById("overlay"),po=document.getElementById("backup-data-btn"),go=document.getElementById("restore-data-btn"),Ra=document.getElementById("restore-file-input"),yo=document.getElementById("custom-confirm-modal"),za=document.getElementById("confirm-modal-message"),zs=document.getElementById("confirm-modal-cancel-btn"),rn=document.getElementById("confirm-modal-confirm-btn"),vo=document.getElementById("secure-confirm-modal"),$a=document.getElementById("secure-confirm-message"),Pa=document.getElementById("secure-confirm-code"),Ut=document.getElementById("secure-confirm-input"),bo=document.getElementById("secure-confirm-cancel-btn"),Hn=document.getElementById("secure-confirm-confirm-btn"),Co=document.getElementById("add-note-modal"),ve=document.getElementById("new-note-content"),wo=document.getElementById("class-save-note-btn"),Eo=document.getElementById("cancel-note-btn"),$s=document.getElementById("student-search-input"),St=document.getElementById("student-search-results"),So=document.getElementById("back-to-student-page-btn"),_o=document.getElementById("graded-category-pills-container"),ko=document.getElementById("new-score-value"),Fa=document.getElementById("new-score-comment"),Io=document.getElementById("add-score-btn"),xo=document.getElementById("profile-stats-summary"),Lo=document.getElementById("profile-scores-list"),on=document.getElementById("global-student-search-input"),mt=document.getElementById("global-student-search-results"),To=document.getElementById("trashed-classes-list"),Bo=document.getElementById("trashed-students-list"),Do=document.getElementById("trashed-sessions-list"),No=document.getElementById("trashed-categories-list"),Ao=document.getElementById("trashed-notes-list"),Mo=document.getElementById("trashed-scores-list"),jt=document.getElementById("quick-grade-form-wrapper"),Ye=document.getElementById("quick-score-input"),Xe=document.getElementById("quick-note-textarea"),xt=document.getElementById("quick-grade-submit-btn"),fn=document.getElementById("category-selection-container"),Ps=document.getElementById("selected-student-result"),$t=document.getElementById("custom-context-menu"),Wt=document.getElementById("breadcrumb-container"),Oo=document.getElementById("report-config-modal"),Ha=document.getElementById("report-columns-container"),Ua=document.getElementById("report-print-btn"),Wa=document.getElementById("report-cancel-btn");let nn=null,Zt=null;const Ro=document.getElementById("category-modal"),ja=document.getElementById("category-modal-title"),Vt=document.getElementById("new-category-modal-name"),_n=document.getElementById("new-category-modal-is-graded"),zo=document.getElementById("category-modal-cancel-btn"),qa=document.getElementById("category-modal-save-btn"),$o=document.getElementById("mass-comment-modal"),Po=document.getElementById("mass-comment-modal-title"),Ga=document.getElementById("mass-comment-student-count-message"),mn=document.getElementById("mass-comment-content"),Li=document.getElementById("mass-comment-append-checkbox"),Fo=document.getElementById("mass-comment-cancel-btn"),Ho=document.getElementById("mass-comment-save-btn"),Fs=document.getElementById("mass-comment-btn"),Un=document.getElementById("attendance-mass-actions-container"),Bt=document.createElement("input"),Uo=document.getElementById("session-dashboard-page"),Kt=document.getElementById("attendance-pane"),Wn=document.getElementById("settings-edu-system"),cn=document.getElementById("settings-level"),Za=document.getElementById("modal-schedule-text"),cs=document.getElementById("modal-schedule-days"),Va=document.getElementById("modal-schedule-start-time"),Ja=document.getElementById("modal-schedule-end-time"),ln=document.getElementById("modal-schedule-toggle"),Ka=document.getElementById("modal-schedule-content"),ls=document.getElementById("new-category-modal-weight"),Wo=document.getElementById("category-modal"),hn=document.getElementById("new-category-modal-weight-group"),jo=document.getElementById("open-add-category-btn");function qt(e,s,t=800){let c,a=t;const n=i=>{c=setTimeout(()=>{ze.isVibrationEnabled&&navigator.vibrate&&navigator.vibrate(50),s(i)},a)},r=()=>{clearTimeout(c)};e.addEventListener("touchstart",n,{passive:!0}),e.addEventListener("touchend",r),e.addEventListener("touchmove",r),e.addEventListener("mousedown",n),e.addEventListener("mouseup",r),e.addEventListener("mouseleave",r)}function Tn(e="selector"){if(!N||!K){Se("class-management-page");return}Jo(),qn(),Oe(),rt(),Se("session-dashboard-page",{tab:e}),Ya(),Yt(e),Ko()}function Yt(e){const s=document.getElementById("selector-tab-btn"),t=document.getElementById("attendance-tab-btn"),c=document.getElementById("selector-pane"),a=e==="selector";s.classList.toggle("active",a),t.classList.toggle("active",!a),c.classList.toggle("active",a),Kt.classList.toggle("active",!a)}function Ya(){const e=document.getElementById("selector-tab-btn"),s=document.getElementById("attendance-tab-btn"),t=document.getElementById("selector-pane");e.addEventListener("click",()=>{Oe(),Re(),e.classList.add("active"),s.classList.remove("active"),t.classList.add("active"),Kt.classList.remove("active"),Se("session-dashboard-page",{tab:"selector"})}),s.addEventListener("click",()=>{rt(),s.classList.add("active"),e.classList.remove("active"),Kt.classList.add("active"),t.classList.remove("active"),Se("session-dashboard-page",{tab:"attendance"})}),Ea(s,c=>{Yt("attendance"),rt(),setTimeout(()=>{const a=document.getElementById("attendance-search-input");a&&a.focus()},100)})}function qo(e){clearTimeout(hs),gn||ts(JSON.stringify(ie)),Da.textContent=e,os.classList.add("show"),fa(setTimeout(()=>{os.classList.remove("show"),ts(null)},5e3))}function Xa(){if(gn){const e=N?N.info.name:null,s=JSON.parse(gn);zt(s),e&&ie[e]?Ge(ie[e]):Ge(null),N?(Tt(),Qt(),qe()):He(),os.classList.remove("show"),clearTimeout(hs),ts(null)}}function j(e,s=3e3){const t=document.getElementById("notification-toast");t&&(t.textContent=e,t.classList.add("show"),clearTimeout(Ys),ma(setTimeout(()=>{t.classList.remove("show")},s)))}function ds(e){var v;const s=document.getElementById("restore-confirm-modal"),t=document.getElementById("restore-modal-message"),c=document.getElementById("restore-append-checkbox"),a=document.querySelector('label[for="restore-append-checkbox"]'),n=document.getElementById("restore-confirm-cancel-btn"),r=document.getElementById("restore-confirm-confirm-btn"),i=document.getElementById("restore-modal-warning");i.style.display="none";const o=((v=e.metadata)==null?void 0:v.createdAt)||0;if(ze.lastRestoreTimestamp&&o<ze.lastRestoreTimestamp){const b=new Date(o).toLocaleDateString("fa-IR"),C=new Date(ze.lastRestoreTimestamp).toLocaleDateString("fa-IR");i.textContent=`âš ï¸ Ù‡Ø´Ø¯Ø§Ø±: Ø§ÛŒÙ† ÙØ§ÛŒÙ„ Ù¾Ø´ØªÛŒØ¨Ø§Ù† (${b}) Ù‚Ø¯ÛŒÙ…ÛŒâ€ŒØªØ± Ø§Ø² Ø¢Ø®Ø±ÛŒÙ† Ø¨Ø§Ø²ÛŒØ§Ø¨ÛŒ Ø´Ù…Ø§ (${C}) Ø§Ø³Øª.`,i.style.display="block"}const l=e.data.classrooms||{},f=Object.values(l).map(b=>b.info.name),p=f.length,m="Ú©Ù„Ø§Ø³",h=f.map(b=>`<li style="margin-bottom: 4px;">ðŸ”¹ ${b}</li>`).join("");t.innerHTML=`
        <div style="margin-bottom: 10px;">
            ÙØ§ÛŒÙ„ Ù¾Ø´ØªÛŒØ¨Ø§Ù† Ø´Ø§Ù…Ù„ <strong>${p} ${m}</strong> Ø²ÛŒØ± Ø§Ø³Øª:
        </div>
        <ul style="
            margin: 0; 
            padding: 10px; 
            background-color: #f8f9fa; 
            border-radius: 5px; 
            border: 1px solid #e9ecef;
            list-style: none; 
            max-height: 150px; 
            overflow-y: auto;
            text-align: right;
        ">
            ${h}
        </ul>
        <div style="margin-top: 15px;">
            Ù„Ø·ÙØ§Ù‹ Ù†Ø­ÙˆÙ‡ Ø¨Ø§Ø²ÛŒØ§Ø¨ÛŒ Ø±Ø§ Ù…Ø´Ø®Øµ Ú©Ù†ÛŒØ¯.
        </div>
    `,c.checked=!1,a&&(a.textContent="Ø¬Ø§ÛŒÚ¯Ø²ÛŒÙ†ÛŒ Ú©Ø§Ù…Ù„ (Ø­Ø°Ù Ø¯Ø§Ø¯Ù‡â€ŒÙ‡Ø§ÛŒ ÙØ¹Ù„ÛŒ)");const y=()=>{const b=c.checked;Or(e,b),r.onclick=null,n.onclick=null,s.removeEventListener("click",y),fe(),He(),Se("class-management-page"),j(`âœ… Ø§Ø·Ù„Ø§Ø¹Ø§Øª Ø¨Ø§ Ù…ÙˆÙÙ‚ÛŒØª Ø¨Ø§Ø²ÛŒØ§Ø¨ÛŒ Ø´Ø¯ (${b?"Ù¾Ø§Ú©â€ŒØ³Ø§Ø²ÛŒ Ùˆ Ø¨Ø§Ø²ÛŒØ§Ø¨ÛŒ":"Ù‡Ù…Ú¯Ø§Ù…â€ŒØ³Ø§Ø²ÛŒ Ù‡ÙˆØ´Ù…Ù†Ø¯"}).`)},u=()=>{r.onclick=null,n.onclick=null,fe()};r.onclick=y,n.onclick=u,Te("restore-confirm-modal")}function ge(e,s,t={}){const{confirmText:c="ØªØ§ÛŒÛŒØ¯",cancelText:a="Ù„ØºÙˆ",confirmClass:n="btn-success",onCancel:r=()=>{},isDelete:i=!1}=t,o=i?()=>Qa(e,s):s;za.innerHTML=e.replace(/\n/g,"<br>"),rn.textContent=c,zs.textContent=a,rn.className="modal-action-btn",rn.classList.add(n),mi(o),hi(r);const l=rn.parentElement;zs.style.display=r===null?"none":"inline-block",l.style.justifyContent=r===null?"center":"space-between",Te("custom-confirm-modal")}function Qa(e,s){const t=Math.floor(1e4+Math.random()*9e4).toString();$a.textContent=e,Pa.textContent=t,Ut.value="",Hn.disabled=!0,vn(s),Te("secure-confirm-modal"),Ut.focus();const c=()=>{Ut.value===t?Hn.disabled=!1:Hn.disabled=!0};return Ut.addEventListener("input",c),()=>{Ut.removeEventListener("input",c)}}function Hs(e,s={}){const{title:t="Ø§ÛŒØ¬Ø§Ø¯ Ø¯Ø³ØªÙ‡â€ŒØ¨Ù†Ø¯ÛŒ Ø¬Ø¯ÛŒØ¯",initialName:c="",initialIsGraded:a=!1,initialWeight:n=1,saveButtonText:r="Ø°Ø®ÛŒØ±Ù‡"}=s;ja.textContent=t,Vt.value=c,_n.checked=a,xn(),ls.value=n,qa.textContent=r,bn((i,o)=>{const l=parseFloat(ls.value)||1;if(!i){j("âš ï¸ Ù„Ø·ÙØ§Ù‹ Ù†Ø§Ù… Ø¯Ø³ØªÙ‡â€ŒØ¨Ù†Ø¯ÛŒ Ø±Ø§ ÙˆØ§Ø±Ø¯ Ú©Ù†ÛŒØ¯.");return}e(i,o,l),fe()}),Te("category-modal"),Vt.focus(),c&&Vt.select()}function Ti(e,s){const t=Object.values(ie).filter(r=>!r.isDeleted&&r.info.name!==s.info.name),c=document.getElementById("move-student-modal-title"),a=document.getElementById("move-student-class-select"),n=document.getElementById("move-student-confirm-btn");c.textContent=`Ø§Ù†ØªÙ‚Ø§Ù„ Ø¯Ø§Ù†Ø´â€ŒØ¢Ù…ÙˆØ²: ${e.identity.name}`,a.innerHTML="",t.length===0?(a.innerHTML='<option value="">Ú©Ù„Ø§Ø³ Ø¯ÛŒÚ¯Ø±ÛŒ Ø¨Ø±Ø§ÛŒ Ø§Ù†ØªÙ‚Ø§Ù„ ÙˆØ¬ÙˆØ¯ Ù†Ø¯Ø§Ø±Ø¯</option>',n.disabled=!0):(t.forEach(r=>{const i=document.createElement("option");i.value=r.info.name,i.textContent=r.info.name,a.appendChild(i)}),n.disabled=!1),ga(e),ya(s),Te("move-student-modal")}function Bi(e,s){if(!e||!s)return;const t=e.identity.name,c=e.identity.firstName||"";e.identity.lastName;const a=document.getElementById("add-note-modal-title");a.textContent="ØªØºÛŒÛŒØ± Ù†Ø§Ù… Ø¯Ø§Ù†Ø´â€Œ Ø¢Ù…ÙˆØ²";const n=e.identity.firstName&&e.identity.lastName?`${e.identity.firstName} . ${e.identity.lastName}`:t;ve.value=n,ve.rows=1,ve.dispatchEvent(new Event("input",{bubbles:!0})),ut(r=>{const i=r.indexOf(".");if(i<=0||i>=r.length-1)return j("Ù„Ø·ÙØ§ Ù†Ø§Ù… Ùˆ Ù†Ø§Ù… Ø®Ø§Ù†ÙˆØ§Ø¯Ú¯ÛŒ Ø´Ø®Øµ Ø±Ø§ Ø¨Ø§ ÛŒÚ© Ù†Ù‚Ø·Ù‡ Ø§Ø² Ù‡Ù… Ø¬Ø¯Ø§ Ú©Ù†ÛŒØ¯. Ù…Ø«Ø§Ù„: Ø¹Ù„ÛŒ . Ø§Ø­Ù…Ø¯ÛŒ"),!1;const o=Gt(r),l=o.name,f=o.firstName||"";if(e.identity.firstName&&e.identity.lastName&&!o.firstName)return j("âš ï¸ Ø§ÛŒÙ† Ø¯Ø§Ù†Ø´â€ŒØ¢Ù…ÙˆØ² Ø¯Ø§Ø±Ø§ÛŒ Ù†Ø§Ù… Ùˆ Ù†Ø§Ù…â€ŒØ®Ø§Ù†ÙˆØ§Ø¯Ú¯ÛŒ ØªÙÚ©ÛŒÚ© Ø´Ø¯Ù‡ Ø§Ø³Øª. Ù„Ø·ÙØ§Ù‹ Ø­ØªÙ…Ø§Ù‹ Ø§Ø² Ù†Ù‚Ø·Ù‡ (.) Ø¨ÛŒÙ† Ù†Ø§Ù… Ùˆ Ù†Ø§Ù…â€ŒØ®Ø§Ù†ÙˆØ§Ø¯Ú¯ÛŒ Ø§Ø³ØªÙØ§Ø¯Ù‡ Ú©Ù†ÛŒØ¯."),!1;if(l&&(l!==t||f!==c)){if(ye(s.students).some(u=>u.identity.studentId!==e.identity.studentId&&u.identity.name.toLowerCase()===l.toLowerCase()))return j("Ø¯Ø§Ù†Ø´â€ŒØ¢Ù…ÙˆØ²ÛŒ Ø¨Ø§ Ø§ÛŒÙ† Ù†Ø§Ù… Ø§Ø² Ù‚Ø¨Ù„ Ø¯Ø± Ø§ÛŒÙ† Ú©Ù„Ø§Ø³ ÙˆØ¬ÙˆØ¯ Ø¯Ø§Ø±Ø¯."),!1;{e.identity.name=l,e.identity.firstName=o.firstName,e.identity.lastName=o.lastName,Ce(s.info.name,`Ù†Ø§Ù… Ø¯Ø§Ù†Ø´â€ŒØ¢Ù…ÙˆØ² Â«${t}Â» Ø¨Ù‡ Â«${l}Â» ØªØºÛŒÛŒØ± ÛŒØ§ÙØª.`,{type:"VIEW_STUDENT_PROFILE",studentId:e.identity.studentId}),se(),Tt(),Oe(),rt(),Re(),_e&&_e.identity.studentId===e.identity.studentId&&We(e);const u=document.querySelector(`#settings-student-list li[data-student-id="${e.identity.studentId}"]`);u&&(u.classList.add("recently-updated"),setTimeout(()=>{u&&u.classList.remove("recently-updated")},1e4),u.scrollIntoView({behavior:"smooth",block:"center"})),j(`âœ… Ù†Ø§Ù… Ø¯Ø§Ù†Ø´â€ŒØ¢Ù…ÙˆØ² Ø¨Ù‡ Â«${l}Â» ØªØºÛŒÛŒØ± ÛŒØ§ÙØª.`)}}else if(!l)return j("âš ï¸ Ù†Ø§Ù… Ù†Ù…ÛŒâ€ŒØªÙˆØ§Ù†Ø¯ Ø®Ø§Ù„ÛŒ Ø¨Ø§Ø´Ø¯."),!1;const h=document.getElementById("add-note-modal-title");h.textContent="Ø«Ø¨Øª ÛŒØ§Ø¯Ø¯Ø§Ø´Øª Ø¬Ø¯ÛŒØ¯",ve.rows=4}),Te("add-note-modal"),ve.focus(),ve.select()}function Te(e){const s=document.getElementById(e);if(s){if(vt)return;s.classList.add("modal-visible"),pi(e),document.body.style.overflow="hidden",history.pushState(null,"",location.href)}}function fe(e,s=!1){if(document.body.style.overflow="auto",!vt)return;ri(!0);const t=document.getElementById(vt),c=vt;pi(null),c==="student-profile-modal"&&It(null),s||history.back(),t&&(t.classList.add("modal-closing"),setTimeout(()=>{t.classList.remove("modal-visible"),t.classList.remove("modal-closing"),c==="custom-confirm-modal"&&(mi(null),hi(null)),c==="secure-confirm-modal"&&vn(null),c==="category-modal"&&bn(null),c==="mass-comment-modal"&&(mn.value=""),c==="add-note-modal"&&ut(null),typeof e=="function"&&e()},300))}function Di(){if(!Kt||!Kt.classList.contains("active")){Un.style.display="none";return}const e=Rt.length;e<1?Un.style.display="none":Un.style.display="block",Fs.disabled=e<1,Fs.textContent=`ðŸ“ Ø«Ø¨Øª ÛŒØ§Ø¯Ø¯Ø§Ø´Øª Ú¯Ø±ÙˆÙ‡ÛŒ (${e} Ù†ÙØ±)`}function Ni(){const e=Rt,s=e.length;let t=!1;s>0&&(t=e.some(a=>{var n;return(n=K.studentRecords[a])==null?void 0:n.homework.comment})),Ga.textContent=`ÛŒØ§Ø¯Ø¯Ø§Ø´Øª Ø¨Ø±Ø§ÛŒ ${s} Ø¯Ø§Ù†Ø´â€ŒØ¢Ù…ÙˆØ² Ø«Ø¨Øª Ø®ÙˆØ§Ù‡Ø¯ Ø´Ø¯.`,mn.value="",mn.dispatchEvent(new Event("input",{bubbles:!0})),Li.checked=!0;const c=document.querySelector("#mass-comment-modal .modal-options");c.style.display=t?"flex":"none",Te("mass-comment-modal"),mn.focus()}function Us(e,s){if(!N||!K)return;let t=0;const c=Rt,a=K;c.forEach(n=>{const r=a.studentRecords[n];if(r&&r.homework){const i=r.homework.comment||"";let o=e;s&&i.length>0?o=i+`
---
`+e:o=e,r.homework.comment=o.trim();const l=N.students.find(f=>f.identity.studentId===n);l&&Go(l,a,o.trim()),t++}}),Cn([]),se(),rt(),Ce(N.info.name,`${t} Ø¯Ø§Ù†Ø´â€ŒØ¢Ù…ÙˆØ² Ø¨Ù‡ ØµÙˆØ±Øª Ú¯Ø±ÙˆÙ‡ÛŒ ÛŒØ§Ø¯Ø¯Ø§Ø´Øª ØªÚ©Ù„ÛŒÙ Ú¯Ø±ÙØªÙ†Ø¯.`,{type:"VIEW_SESSIONS"}),j(`âœ… ÛŒØ§Ø¯Ø¯Ø§Ø´Øª Ø¨Ø±Ø§ÛŒ ${t} Ø¯Ø§Ù†Ø´â€ŒØ¢Ù…ÙˆØ² Ø«Ø¨Øª Ø´Ø¯.`)}function Go(e,s,t){const a=dt(N).get(s.sessionNumber),n={type:"fromAttendance",sessionNumber:s.sessionNumber},r=`ÛŒØ§Ø¯Ø¯Ø§Ø´Øª Ø¬Ù„Ø³Ù‡ ${a}:
`,i=e.profile.notes.find(o=>!o.isDeleted&&o.source&&o.source.type==="fromAttendance"&&o.source.sessionNumber===n.sessionNumber);i?t?(i.content=r+t,i.isDeleted=!1):i.isDeleted=!0:t&&e.addNote(r+t,n)}function vs(e){ve.value=e.note||"",ut(s=>{e.note=s,se(),Ce(e.info.name,"ÛŒØ§Ø¯Ø¯Ø§Ø´Øª Ú©Ù„Ø§Ø³ Ø°Ø®ÛŒØ±Ù‡ Ø´Ø¯.",{type:"VIEW_CLASS_NOTE"}),He(),j("âœ… ÛŒØ§Ø¯Ø¯Ø§Ø´Øª Ú©Ù„Ø§Ø³ Ø°Ø®ÛŒØ±Ù‡ Ø´Ø¯.")}),Te("add-note-modal"),ve.focus()}function Ai(e,s){ve.value=e.note||"",ve.dispatchEvent(new Event("input",{bubbles:!0})),ut(t=>{e.note=t,se(),Ce(N.info.name,`ÛŒØ§Ø¯Ø¯Ø§Ø´Øª Ø¬Ù„Ø³Ù‡ ${s} Ø°Ø®ÛŒØ±Ù‡ Ø´Ø¯.`,{type:"VIEW_SESSIONS"}),qe(),j("âœ…ÛŒØ§Ø¯Ø¯Ø§Ø´Øª Ø¬Ù„Ø³Ù‡ Ø°Ø®ÛŒØ±Ù‡ Ø´Ø¯.")}),Te("add-note-modal"),ve.focus()}function Lt(e){Ge(e),Na.textContent=`ØªÙ†Ø¸ÛŒÙ…Ø§Øª Ú©Ù„Ø§Ø³: ${e.info.name}`,Tt(),Qt(),or(),Se("settings-page")}function er(e){const s=document.getElementById("log-modal-title"),t=document.getElementById("log-list");s.textContent=`Ú¯Ø²Ø§Ø±Ø´ ÙØ¹Ø§Ù„ÛŒØªâ€ŒÙ‡Ø§ÛŒ Ú©Ù„Ø§Ø³: ${e}`,t.innerHTML="";const c=$r(e);c.length===0?t.innerHTML='<li class="no-content-message">Ù‡Ù†ÙˆØ² ÙØ¹Ø§Ù„ÛŒØªÛŒ Ø¨Ø±Ø§ÛŒ Ø§ÛŒÙ† Ú©Ù„Ø§Ø³ Ø«Ø¨Øª Ù†Ø´Ø¯Ù‡ Ø§Ø³Øª.</li>':c.forEach(a=>{const n=document.createElement("li");n.className="log-entry";const r=new Date(a.timestamp),i=`${r.toLocaleDateString("fa-IR")} - ${r.toLocaleTimeString("fa-IR",{hour:"2-digit",minute:"2-digit"})}`,o=document.createElement("span");o.className="log-timestamp",o.textContent=i;const l=document.createElement("span");l.className="log-message",l.textContent=a.message,a.action&&(l.classList.add("log-action-link"),l.dataset.action=JSON.stringify({...a.action,classroomName:a.classroomName})),n.appendChild(o),n.appendChild(l),t.appendChild(n)}),Te("log-modal")}document.getElementById("log-modal-close-btn").addEventListener("click",()=>{fe()});function Ws(e){const s=URL.createObjectURL(e),t=document.createElement("a");t.href=s,t.download=e.name,document.body.appendChild(t),t.click(),document.body.removeChild(t),URL.revokeObjectURL(s),setTimeout(()=>{ge("Ø¢ÛŒØ§ ÙØ§ÛŒÙ„ Ù¾Ø´ØªÛŒØ¨Ø§Ù† Ø¨Ø§ Ù…ÙˆÙÙ‚ÛŒØª Ø°Ø®ÛŒØ±Ù‡ Ø´Ø¯ØŸ",()=>{yi(),bs(),j("âœ… ØªØ§Ø±ÛŒØ® Ù¾Ø´ØªÛŒØ¨Ø§Ù† Ø«Ø¨Øª Ø´Ø¯.")},{confirmText:"Ø¨Ù„Ù‡ØŒ Ø°Ø®ÛŒØ±Ù‡ Ø´Ø¯",cancelText:"Ø®ÛŒØ±",confirmClass:"btn-success"})},500)}function Bn(e,s){e.preventDefault(),Ot(),Zt=e.target.closest("li"),Zt&&Zt.classList.add("context-menu-target"),setTimeout(()=>{const t=$t,c=t.querySelector("ul");c.innerHTML="",s.forEach(l=>{const f=document.createElement("li");l.isSeparator?f.className="separator":(f.innerHTML=`
                    <span class="icon">${l.icon||""}</span>
                    <span class="label">${l.label}</span>
                `,l.className&&f.classList.add(l.className),f.addEventListener("click",()=>{l.action(),Ot()})),c.appendChild(f)}),t.classList.add("visible");const{offsetWidth:a,offsetHeight:n}=t,{innerHeight:r}=window,i=document.body.getBoundingClientRect();t.style.top=`${(r-n)/2}px`;const o=i.left+i.width/2;t.style.left=`${o-a/2}px`},50)}function Ot(){$t.classList.contains("visible")&&$t.classList.remove("visible"),Zt&&(Zt.classList.remove("context-menu-target"),Zt=null)}function tr(){var t;Wt.innerHTML="";const e=document.getElementById("header-settings-btn");if(!e)return;const s=[];if(s.push({label:"Ú©Ù„Ø§Ø³â€ŒÙ‡Ø§",handler:()=>{Ge(null),at(null),It(null),Se("class-management-page")}}),N){s.push({label:N.info.name,handler:()=>{at(null),It(null),qe(),Se("session-page")}});const c=(t=document.querySelector(".page.active"))==null?void 0:t.id;if(c==="session-page"?e.style.visibility="visible":e.style.visibility="hidden",c==="settings-page")s.push({label:"ØªÙ†Ø¸ÛŒÙ…Ø§Øª"});else if(K){const n=dt(N).get(K.sessionNumber)||` (#${K.sessionNumber})`;s.push({label:`Ø¬Ù„Ø³Ù‡ ${n}`,handler:()=>{It(null),Tn("selector")}}),_e&&s.push({label:`Ù¾Ø±ÙˆÙØ§ÛŒÙ„: ${_e.identity.name}`})}}else e.style.visibility="hidden";if(s.length<=1){Wt.style.display="none";return}Wt.style.display="flex",s.forEach((c,a)=>{const n=document.createElement("a");if(n.textContent=c.label,n.className="breadcrumb-item",a===s.length-1||!c.handler?n.classList.add("active"):n.addEventListener("click",c.handler),Wt.appendChild(n),a<s.length-1){const r=document.createElement("span");r.className="breadcrumb-separator",r.textContent="/",Wt.appendChild(r)}})}function Gi(e,s,t){t.innerHTML="";const c=N.sessions.filter(a=>{var n;return!a.isDeleted&&!a.isCancelled&&((n=a.studentRecords[e.identity.studentId])==null?void 0:n.attendance)==="absent"}).map(a=>({number:s.get(a.sessionNumber),isMakeup:a.isMakeup})).filter(a=>a.number!==void 0);c.length>0?(t.appendChild(document.createTextNode("Ø¬Ù„Ø³Ø§Øª ØºØ§ÛŒØ¨: ")),c.forEach((a,n)=>{const r=document.createElement("span");r.textContent=a.number,a.isMakeup&&r.classList.add("makeup-absence"),t.appendChild(r),n<c.length-1&&t.appendChild(document.createTextNode("ØŒ "))})):t.textContent="Ø¬Ù„Ø³Ø§Øª ØºØ§ÛŒØ¨: Ø¨Ø¯ÙˆÙ† ØºÛŒØ¨Øª"}function jn(e,s,t,c={}){const{includePrefix:a=!0}=c;t.innerHTML="";const n=N.sessions.filter(r=>{if(r.isDeleted||r.isCancelled)return!1;const i=r.studentRecords[e.identity.studentId];return i&&i.homework&&(i.homework.status==="incomplete"||i.homework.status==="none")}).map(r=>({number:s.get(r.sessionNumber),status:r.studentRecords[e.identity.studentId].homework.status})).filter(r=>r.number!==void 0);n.length>0?(a&&t.appendChild(document.createTextNode("ØªÚ©Ø§Ù„ÛŒÙ Ù†Ø§Ù‚Øµ: ")),n.forEach((r,i)=>{const o=document.createElement("span");o.textContent=r.number,r.status==="incomplete"&&o.classList.add("incomplete-homework"),t.appendChild(o),i<n.length-1&&t.appendChild(document.createTextNode("ØŒ"))})):a?t.textContent="ØªÚ©Ø§Ù„ÛŒÙ Ù†Ø§Ù‚Øµ: Ù†Ø¯Ø§Ø±Ø¯":t.textContent="Ù†Ø¯Ø§Ø±Ø¯"}function Zo(e,s){var L,B,O;const t=document.createElement("li");t.className="attendance-list-item";const c=document.createElement("span");c.className="absence-info";const a=document.createElement("span");a.className="homework-info";const n=document.createElement("div");n.className="att-row-1";let r=!1;n.addEventListener("mousedown",()=>r=!1),n.addEventListener("touchstart",()=>r=!1,{passive:!0});const i=document.createElement("input");i.type="checkbox",i.className="mass-comment-checkbox",i.checked=Rt.includes(e.identity.studentId),i.addEventListener("change",()=>{const H=e.identity.studentId,Q=Rt;if(i.checked)Q.includes(H)||Q.push(H);else{const z=Q.indexOf(H);z>-1&&Q.splice(z,1)}Di();const I=document.getElementById("attendance-list");Q.length===0&&I.classList.contains("selection-mode-active")&&I.classList.remove("selection-mode-active")});const o=document.createElement("span");o.className="student-name",o.textContent=e.identity.firstName&&e.identity.lastName?`${e.identity.lastName}ØŒ ${e.identity.firstName}`:e.identity.name,o.addEventListener("click",H=>{if(r){H.stopPropagation(),H.preventDefault(),r=!1;return}We(e)}),qt(n,H=>{r=!0;const Q=document.getElementById("attendance-list");Q.classList.contains("selection-mode-active")||Q.classList.add("selection-mode-active"),i.checked||(i.checked=!0,i.dispatchEvent(new Event("change")))}),n.appendChild(i),n.appendChild(o);const l=document.createElement("div");l.className="att-row-2";const f=document.createElement("button");let p=!1;f.addEventListener("mousedown",()=>p=!1),f.addEventListener("touchstart",()=>p=!1,{passive:!0});const m=((L=K.studentRecords[e.identity.studentId])==null?void 0:L.attendance)||"present",h=H=>{H==="present"?(f.textContent="Ø­Ø§Ø¶Ø±",f.className="attendance-status-btn present active"):(f.textContent="ØºØ§ÛŒØ¨",f.className="attendance-status-btn absent active")};h(m),f.addEventListener("click",H=>{var z;if(p){H.stopPropagation();return}const I=(((z=K.studentRecords[e.identity.studentId])==null?void 0:z.attendance)||"present")==="present"?"absent":"present";K.setAttendance(e.identity.studentId,I),I==="absent"&&(K.studentRecords[e.identity.studentId].hadIssue=!1),se(),h(I),Gi(e,s,c),Oe(),cr()}),qt(f,()=>{p=!0;const H=m==="present"?"absent":"present",Q=H==="present"?"Ø­Ø§Ø¶Ø±":"ØºØ§ÛŒØ¨";ge(`Ø¢ÛŒØ§ Ù…Ø·Ù…Ø¦Ù† Ù‡Ø³ØªÛŒØ¯ Ú©Ù‡ Ù…ÛŒâ€ŒØ®ÙˆØ§Ù‡ÛŒØ¯ ÙˆØ¶Ø¹ÛŒØª Ø­Ø¶ÙˆØ± ØªÙ…Ø§Ù… Ø¯Ø§Ù†Ø´â€ŒØ¢Ù…ÙˆØ²Ø§Ù† Ø±Ø§ Ø¨Ù‡ Â«${Q}Â» ØªØºÛŒÛŒØ± Ø¯Ù‡ÛŒØ¯ØŸ`,()=>{ye(N.students).forEach(I=>{K.setAttendance(I.identity.studentId,H),H==="absent"&&(K.studentRecords[I.identity.studentId].hadIssue=!1)}),se(),rt(),j(`âœ… ÙˆØ¶Ø¹ÛŒØª ØªÙ…Ø§Ù… Ø¯Ø§Ù†Ø´â€ŒØ¢Ù…ÙˆØ²Ø§Ù† Ø¨Ù‡ Â«${Q}Â» ØªØºÛŒÛŒØ± ÛŒØ§ÙØª.`)},{confirmText:"Ø¨Ù„Ù‡ØŒ Ø§Ø¹Ù…Ø§Ù„ Ú©Ù†",confirmClass:"btn-warning"})});const y=document.createElement("div");y.className="homework-controls";const u={none:"Ø¨Ø¯ÙˆÙ† ØªÚ©Ù„ÛŒÙ",complete:"ØªÚ©Ù„ÛŒÙ Ú©Ø§Ù…Ù„",incomplete:"ØªÚ©Ù„ÛŒÙ Ù†Ø§Ù‚Øµ"},v=document.createElement("button");let b=!1;v.addEventListener("mousedown",()=>b=!1),v.addEventListener("touchstart",()=>b=!1,{passive:!0});const C=((B=K.studentRecords[e.identity.studentId])==null?void 0:B.homework.status)||"none";v.className=`homework-status-btn ${C}`,v.title=u[C],v.addEventListener("click",H=>{if(b){H.stopPropagation();return}const Q=K.studentRecords[e.identity.studentId].homework,z={none:"incomplete",incomplete:"complete",complete:"none"}[Q.status];K.setHomeworkStatus(e.identity.studentId,z),se(),v.className=`homework-status-btn ${z}`,v.title=u[z],jn(e,s,a)}),qt(v,()=>{b=!0;const Q={none:"incomplete",incomplete:"complete",complete:"none"}[C],I=u[Q];ge(`Ø¢ÛŒØ§ Ø§Ø² ØªØºÛŒÛŒØ± ÙˆØ¶Ø¹ÛŒØª ØªÚ©Ù„ÛŒÙ ØªÙ…Ø§Ù… Ø¯Ø§Ù†Ø´â€ŒØ¢Ù…ÙˆØ²Ø§Ù† Ø¨Ù‡ Â«${I}Â» Ù…Ø·Ù…Ø¦Ù† Ù‡Ø³ØªÛŒØ¯ØŸ`,()=>{ye(N.students).forEach(z=>{K.setHomeworkStatus(z.identity.studentId,Q)}),se(),rt(),j(`âœ… ÙˆØ¶Ø¹ÛŒØª ØªÚ©Ù„ÛŒÙ Ù‡Ù…Ù‡ Ø¨Ù‡ Â«${I}Â» ØªØºÛŒÛŒØ± ÛŒØ§ÙØª.`)},{confirmText:"Ø¨Ù„Ù‡",confirmClass:"btn-warning"})});const S=document.createElement("button");let _=!1;S.addEventListener("mousedown",()=>_=!1),S.addEventListener("touchstart",()=>_=!1,{passive:!0}),S.className="btn-icon",S.innerHTML="ðŸ“",S.title="Ø§ÙØ²ÙˆØ¯Ù† ÛŒØ§Ø¯Ø¯Ø§Ø´Øª Ø¨Ø±Ø§ÛŒ ØªÚ©Ù„ÛŒÙ",((O=K.studentRecords[e.identity.studentId])==null?void 0:O.homework.comment)||(S.style.opacity="0.3"),S.addEventListener("click",H=>{if(_){H.stopPropagation();return}const Q=K.studentRecords[e.identity.studentId].homework;ve.value=Q.comment||"",ve.dispatchEvent(new Event("input",{bubbles:!0})),ut(I=>{Q.comment=I;const z=dt(N),g=z.get(K.sessionNumber),F={type:"fromAttendance",sessionNumber:K.sessionNumber},oe=`ÛŒØ§Ø¯Ø¯Ø§Ø´Øª Ø¬Ù„Ø³Ù‡ ${g}:
`,Z=e.profile.notes.find(de=>!de.isDeleted&&de.source&&de.source.type==="fromAttendance"&&de.source.sessionNumber===F.sessionNumber);Z?I?Z.content=oe+I:Z.isDeleted=!0:I&&e.addNote(oe+I,F),se(),j("âœ…ÛŒØ§Ø¯Ø¯Ø§Ø´Øª ØªÚ©Ù„ÛŒÙ Ø°Ø®ÛŒØ±Ù‡ Ø´Ø¯."),S.style.opacity=I?"1":"0.3",jn(e,z,a)}),Te("add-note-modal"),ve.focus()}),qt(S,()=>{_=!0,ge("Ø¢ÛŒØ§ Ù…ÛŒâ€ŒØ®ÙˆØ§Ù‡ÛŒØ¯ Ø¨Ø±Ø§ÛŒ **ØªÙ…Ø§Ù…** Ø¯Ø§Ù†Ø´â€ŒØ¢Ù…ÙˆØ²Ø§Ù† Ú©Ù„Ø§Ø³ ÛŒØ§Ø¯Ø¯Ø§Ø´Øª ØªÚ©Ù„ÛŒÙ Ø«Ø¨Øª Ú©Ù†ÛŒØ¯ØŸ",()=>{const H=ye(N.students).map(Q=>Q.identity.studentId);Cn(H),Ni()},{confirmText:"Ø¨Ù„Ù‡",confirmClass:"btn-primary"})}),l.appendChild(f),y.appendChild(S),y.appendChild(v),l.appendChild(y);const x=document.createElement("div");return x.className="att-row-3",Gi(e,s,c),jn(e,s,a),x.appendChild(c),x.appendChild(a),t.appendChild(n),t.appendChild(l),t.appendChild(x),t}function Vo(){return dt(N).get(K.sessionNumber)}function rt(){const e=ye(N.students),s=Ln(e);if(!N||!K)return;s.forEach(r=>{K.initializeStudentRecord(r.identity.studentId)}),Cn([]);const t=dt(N);ac(),un.innerHTML="";const c=document.createElement("li");c.className="attendance-list-header",Bt.id="attendance-search-input",Bt.type="text",Bt.className="inline-search-input",Bt.placeholder="Ø¬Ø³ØªØ¬Ùˆ...",Bt.value="";const a=document.createElement("div");a.className="student-search-container",a.appendChild(Bt);const n=document.createElement("div");n.className="header-labels-container",n.innerHTML=`
    <span class="header-label">ØªÚ©Ù„ÛŒÙ</span>
    <span class="header-label">Ø­Ø¶ÙˆØ±</span>
`,c.appendChild(a),c.appendChild(n),un.appendChild(c),s.forEach(r=>{const i=Zo(r,t);un.appendChild(i)}),Cn([]),Di(),rc(),cr()}function Oe(){const e=document.getElementById("student-stats-table-container");if(!e||(e.innerHTML="",!N))return;ye(N.students).length,Rs.textContent="Ø¢Ù…Ø§Ø± Ø¹Ù…Ù„Ú©Ø±Ø¯";const s=["Ù†Ø§Ù…"],t=["Ú©Ù„ Ø§Ù†ØªØ®Ø§Ø¨ Ù‡Ø§","ØºÛŒØ¨Øª","Ø®Ø±ÙˆØ¬","ÙØ±ØµØª Ø§Ø²Ø¯Ø³Øªâ€ŒØ±ÙØªÙ‡","Ù…Ø´Ú©Ù„","Ù…ÛŒØ§Ù†Ú¯ÛŒÙ†","Ù†Ù…Ø±Ù‡ Ù†Ù‡Ø§ÛŒÛŒ"],c=N.categories.filter(h=>h.isGradedCategory&&!h.isDeleted).map(h=>h.name),a=[...s,...c,...t],n=document.createElement("table");n.className="student-stats-table";const i=n.createTHead().insertRow();a.forEach((h,y)=>{const u=document.createElement("th");y===0?(u.innerHTML=`${h} <span style="opacity: 0.6;">ðŸ”—</span>`,u.title="Ø±Ø¯ÛŒÙâ€ŒÙ‡Ø§ÛŒ Ø§ÛŒÙ† Ø³ØªÙˆÙ† Ù‚Ø§Ø¨Ù„ Ú©Ù„ÛŒÚ© Ù‡Ø³ØªÙ†Ø¯"):u.textContent=h,i.appendChild(u)});const o=n.createTBody(),l=Ln(ye(N.students)),f=h=>{let y=0;return N.sessions.forEach(u=>{if(u.isDeleted||u.isCancelled)return;const v=u.studentRecords[h.identity.studentId];v&&v.attendance==="absent"&&y++}),y};l.forEach(h=>{const y=o.insertRow();if(y.dataset.studentId=h.identity.studentId,K){const _=K.studentRecords[h.identity.studentId];_&&_.attendance==="absent"&&y.classList.add("absent-row-highlight")}const u=y.insertCell(),v=document.createElement("span");v.textContent=`${h.identity.lastName}ØŒ ${h.identity.firstName}`,v.className="student-name-link",v.addEventListener("click",()=>{We(h)}),u.appendChild(v),c.forEach(_=>{var B;const k=y.insertCell();k.style.direction="ltr";const x=_.toLowerCase(),L=((B=h.logs.scores[x])==null?void 0:B.filter(O=>!O.isDeleted))||[];L.length>0?L.forEach((O,H)=>{const Q=document.createElement("span");Q.textContent=O.value+(O.comment?"'":""),Q.style.position="relative",O.comment&&(Q.dataset.tooltip=O.comment),k.appendChild(Q),H<L.length-1&&k.appendChild(document.createTextNode(","))}):k.textContent="",k.style.cursor="pointer",k.addEventListener("click",()=>{Re(h,_);const O=document.getElementById("category-selection-container");O&&O.scrollIntoView({behavior:"smooth",block:"center"})})}),y.insertCell().textContent=h.statusCounters.totalSelections||0,y.insertCell().textContent=f(h),y.insertCell().textContent=h.statusCounters.outOfClassCount||0,y.insertCell().textContent=h.statusCounters.missedChances||0;const b=Object.values(h.categoryIssues||{}).reduce((_,k)=>_+k,0);y.insertCell().textContent=b;const C=h.getOverallAverageScore();y.insertCell().textContent=C!==null?C:"-";const S=N.calculateFinalStudentScore(h);y.insertCell().textContent=S!==null?S:"-"}),ye(N.students),Rs.setAttribute("data-student-count",l.length),e.appendChild(n);const p=e.querySelector(".student-stats-table"),m=p==null?void 0:p.querySelector("thead th:first-child");m&&m.addEventListener("click",()=>{p.classList.toggle("name-column-expanded")})}function Re(e=null,s=null){const t=lc(e,s);if(!t)return;const{winner:c,categoryName:a}=t;dc(c,a);const n=document.getElementById("selected-student-result"),r=!e,i=K.studentRecords[c.identity.studentId],{nameContainer:o}=uc(c,a,r);n.appendChild(o);const l=fc(c,i,a);if(n.appendChild(l),a&&typeof Zi=="function"){const p=Zi(c,a);p&&n.appendChild(p)}const f=mc(c);n.appendChild(f)}function Mi(e){e.addEventListener("input",()=>{const s=e.value,t=gs(s);e.setAttribute("dir",t)})}function Jo(){Oi(null),fn.innerHTML="",Ps.innerHTML="",jt.classList.add("tooltip-container"),Ye.disabled=!0,Xe.disabled=!0,xt.disabled=!0,Ye.value="",Xe.value="",Mt.classList.add("disabled-wrapper"),Qe.disabled=!0}function qn(){fn.innerHTML="",N.categories.filter(t=>!t.isDeleted).forEach(t=>{const c=document.createElement("span");c.className="pill",c.textContent=t.name,c.dataset.categoryId=t.id,t.description&&(c.dataset.tooltip=t.description),K.isFinished?c.classList.add("disabled"):c.addEventListener("click",()=>{document.querySelectorAll("#category-selection-container .pill").forEach(n=>n.classList.remove("active")),c.classList.add("active"),nr(t,c),ns(t),Oi(t),js(t),kn(t),Xt(t.name),Mt.classList.remove("disabled-wrapper"),Qe.disabled=K.isFinished;const a=K.lastWinnerByCategory[t.name];if(a){const n=N.students.find(r=>r.identity.studentId===a);n&&Re(n,t.name)}else{Ps.innerHTML="",Jt(null),bt(-1),Qe.disabled=!1;const n=document.querySelector(".current-winner-highlight");n&&n.classList.remove("current-winner-highlight")}}),K.isFinished||c.addEventListener("contextmenu",a=>{Bn(a,[{label:"ØªØºÛŒÛŒØ± Ù†Ø§Ù…",icon:"âœï¸",action:()=>{xn(),Hs((r,i,o)=>{const l=ca(N,t,r);l.success?(t.isGradedCategory=i,t.weight=o,se(),Ce(N.info.name,`Ù†Ø§Ù… Ø¯Ø³ØªÙ‡â€ŒØ¨Ù†Ø¯ÛŒ Â«${t.name}Â» Ø¨Ù‡ Â«${r}Â» ØªØºÛŒÛŒØ± ÛŒØ§ÙØª.`),qn(),Oe(),js(t),j(`âœ… Ù†Ø§Ù… Ø¯Ø³ØªÙ‡â€ŒØ¨Ù†Ø¯ÛŒ Ø¨Ù‡ Â«${r}Â» ØªØºÛŒÛŒØ± ÛŒØ§ÙØª.`)):j(`âš ï¸ ${l.message}`)},{title:"ÙˆÛŒØ±Ø§ÛŒØ´ Ø¯Ø³ØªÙ‡â€ŒØ¨Ù†Ø¯ÛŒ",initialName:t.name,initialIsGraded:t.isGradedCategory,initialWeight:t.weight||1,saveButtonText:"Ø°Ø®ÛŒØ±Ù‡ ØªØºÛŒÛŒØ±Ø§Øª"})}},{label:"Ø­Ø°Ù Ø¯Ø³ØªÙ‡â€ŒØ¨Ù†Ø¯ÛŒ",icon:"ðŸ—‘ï¸",className:"danger",action:()=>{ge(`Ø¢ÛŒØ§ Ø§Ø² Ø§Ù†ØªÙ‚Ø§Ù„ Ø¯Ø³ØªÙ‡â€ŒØ¨Ù†Ø¯ÛŒ Â«${t.name}Â» Ø¨Ù‡ Ø³Ø·Ù„ Ø²Ø¨Ø§Ù„Ù‡ Ù…Ø·Ù…Ø¦Ù† Ù‡Ø³ØªÛŒØ¯ØŸ`,()=>{const r={id:`trash_${Date.now()}_${Math.random()}`,timestamp:new Date().toISOString(),type:"category",description:`Ø¯Ø³ØªÙ‡â€ŒØ¨Ù†Ø¯ÛŒ Â«${t.name}Â» Ø§Ø² Ú©Ù„Ø§Ø³ Â«${N.info.name}Â»`,restoreData:{categoryId:t.id,classId:N.info.scheduleCode}};lt(r);const i=t.name.toLowerCase();if(N.students.forEach(o=>{o.logs.scores&&o.logs.scores[i]&&o.logs.scores[i].forEach(l=>{l.isDeleted=!0})}),Me&&Me.id===t.id){ns(null),Ps.innerHTML="",kn(null),Xt(null),Mt.classList.add("disabled-wrapper"),Qe.disabled=!0;const o=document.querySelector(".current-winner-highlight");o&&o.classList.remove("current-winner-highlight")}t.isDeleted=!0,Ce(N.info.name,`Ø¯Ø³ØªÙ‡â€ŒØ¨Ù†Ø¯ÛŒ Â«${t.name}Â» Ø¨Ù‡ Ø³Ø·Ù„ Ø²Ø¨Ø§Ù„Ù‡ Ù…Ù†ØªÙ‚Ù„ Ø´Ø¯.`,{type:"VIEW_TRASH"}),se(),qn(),Oe(),j(`âœ… Ø¯Ø³ØªÙ‡â€ŒØ¨Ù†Ø¯ÛŒ Â«${t.name}Â» Ø¨Ù‡ Ø³Ø·Ù„ Ø²Ø¨Ø§Ù„Ù‡ Ù…Ù†ØªÙ‚Ù„ Ø´Ø¯.`)},{confirmText:"Ø¨Ù„Ù‡",confirmClass:"btn-warning"})}}])}),fn.appendChild(c)});const s=document.createElement("span");s.className="pill add-category-pill",s.textContent="+",s.title="Ø§ÙØ²ÙˆØ¯Ù† Ø¯Ø³ØªÙ‡â€ŒØ¨Ù†Ø¯ÛŒ Ø¬Ø¯ÛŒØ¯",K.isFinished?s.classList.add("disabled"):s.addEventListener("click",()=>{xn(),Hs((t,c,a)=>{if(N.categories.find(i=>i.name.toLowerCase()===t.toLowerCase()&&!i.isDeleted)){j("âš ï¸ Ø§ÛŒÙ† Ø¯Ø³ØªÙ‡â€ŒØ¨Ù†Ø¯ÛŒ Ø§Ø² Ù‚Ø¨Ù„ ÙˆØ¬ÙˆØ¯ Ø¯Ø§Ø±Ø¯.");return}const r=new pn(t,"",c,a);N.categories.push(r),se(),Ce(N.info.name,`Ø¯Ø³ØªÙ‡â€ŒØ¨Ù†Ø¯ÛŒ Ø¬Ø¯ÛŒØ¯ Â«${t}Â» Ø§Ø¶Ø§ÙÙ‡ Ø´Ø¯.`,{type:"VIEW_CLASS_SETTINGS"}),qn(),j(`âœ… Ø¯Ø³ØªÙ‡â€ŒØ¨Ù†Ø¯ÛŒ Â«${t}Â» Ø§Ø¶Ø§ÙÙ‡ Ø´Ø¯.`)},{initialWeight:1})}),fn.appendChild(s)}function nr(e,s){e.isGradedCategory&&s.classList.add("graded-category-pill")}function Ko(){if(K.lastUsedCategoryId){if(K.isFinished)return;const e=fn.querySelector(`.pill[data-category-id="${K.lastUsedCategoryId}"]`);e&&e.click()}K.winnerHistory&&K.winnerHistory.length>0&&(bt(K.winnerHistory.length-1),Re())}function Oi(e){e?Qe.textContent=`Ù†ÙØ± Ø¨Ø¹Ø¯ÛŒ Ø¯Ø± ${e.name}`:Qe.textContent="Ù†ÙØ± Ø¨Ø¹Ø¯ÛŒ"}function js(e){e&&e.isGradedCategory?(an.textContent=`Ø¶Ø±ÛŒØ¨: ${e.weight||1}`,an.style.display="block",an.style.visibility="visible"):an.style.visibility="hidden"}function kn(e){if(K.isFinished){Ye.disabled=!0,Xe.disabled=!0,xt.disabled=!0,jt.setAttribute("title","Ø¬Ù„Ø³Ù‡ Ø®Ø§ØªÙ…Ù‡ ÛŒØ§ÙØªÙ‡ Ø§Ø³Øª");return}e&&e.isGradedCategory?(Ye.disabled=!1,Xe.disabled=!1,xt.disabled=!1,jt.removeAttribute("title")):(Ye.disabled=!0,Xe.disabled=!0,xt.disabled=!0,e?jt.setAttribute("title","Ø¨Ø±Ø§ÛŒ Ø§ÛŒÙ† Ø¯Ø³ØªÙ‡â€ŒØ¨Ù†Ø¯ÛŒ Ù‚Ø§Ø¨Ù„ÛŒØª Ù†Ù…Ø±Ù‡ Ø¯Ù‡ÛŒ ØªØ¹Ø±ÛŒÙ Ù†Ø´Ø¯Ù‡ Ø§Ø³Øª"):jt.setAttribute("title","Ø§Ø¨ØªØ¯Ø§ ÛŒÚ© Ø¯Ø³ØªÙ‡â€ŒØ¨Ù†Ø¯ÛŒ Ø±Ø§ Ø§Ù†ØªØ®Ø§Ø¨ Ú©Ù†ÛŒØ¯"))}function Xt(e){const s=document.querySelector(".student-stats-table");if(!s||(s.querySelectorAll(".current-category-highlight").forEach(r=>{r.classList.remove("current-category-highlight")}),!e))return;let c=-1;const a=s.querySelectorAll("thead th");if(a.forEach((r,i)=>{r.textContent.trim()===e&&(c=i)}),c===-1)return;a[c].classList.add("current-category-highlight"),s.querySelectorAll("tbody tr").forEach(r=>{const i=r.cells[c];i&&i.classList.add("current-category-highlight")})}function We(e){It(e);const s=document.getElementById("student-profile-modal"),t=document.getElementById("modal-profile-student-name"),c=document.getElementById("modal-profile-content-container"),a=document.getElementById("modal-profile-close-btn");if(!s||!t||!c||!a)return;t.textContent=`Ù¾Ø±ÙˆÙØ§ÛŒÙ„: ${e.identity.name}`,t.style.cursor="pointer",t.onclick=()=>{const f=_e,p=N;fe(()=>{Bi(f,p)})},c.innerHTML="";const n=document.createElement("div");n.className="profile-header-actions";const r=document.createElement("button");r.className="btn-icon btn-icon-label",r.title="Ø§Ù†ØªÙ‚Ø§Ù„ Ø¯Ø§Ù†Ø´â€ŒØ¢Ù…ÙˆØ²",r.innerHTML="<span>âž¡ï¸</span><span>Ø§Ù†ØªÙ‚Ø§Ù„</span>",r.addEventListener("click",()=>{const f=_e,p=N;fe(()=>{Ti(f,p)})});const i=document.createElement("button");i.className="btn-icon btn-icon-label",i.title="Ø­Ø°Ù Ø¯Ø§Ù†Ø´â€ŒØ¢Ù…ÙˆØ²",i.innerHTML="<span>ðŸ—‘ï¸</span><span>Ø­Ø°Ù</span>",i.style.color="var(--color-strong-warning)",i.addEventListener("click",()=>{const f=_e,p=N;fe(()=>{ge(`Ø¢ÛŒØ§ Ø§Ø² Ø§Ù†ØªÙ‚Ø§Ù„ Ø¯Ø§Ù†Ø´â€ŒØ¢Ù…ÙˆØ² Â«${f.identity.name}Â» Ø¨Ù‡ Ø³Ø·Ù„ Ø²Ø¨Ø§Ù„Ù‡ Ù…Ø·Ù…Ø¦Ù† Ù‡Ø³ØªÛŒØ¯ØŸ`,()=>{const m={id:`trash_${Date.now()}_${Math.random()}`,timestamp:new Date().toISOString(),type:"student",description:`Ø¯Ø§Ù†Ø´â€ŒØ¢Ù…ÙˆØ² Â«${f.identity.name}Â» Ø§Ø² Ú©Ù„Ø§Ø³ Â«${p.info.name}Â»`,restoreData:{studentId:f.identity.studentId,classId:p.info.scheduleCode}};lt(m),f.isDeleted=!0,Ce(p.info.name,`Ø¯Ø§Ù†Ø´â€ŒØ¢Ù…ÙˆØ² Â«${f.identity.name}Â» Ø¨Ù‡ Ø³Ø·Ù„ Ø²Ø¨Ø§Ù„Ù‡ Ù…Ù†ØªÙ‚Ù„ Ø´Ø¯.`,{type:"VIEW_TRASH"}),se(),Tt(),Oe(),rt(),j(`âœ… Ø¯Ø§Ù†Ø´â€ŒØ¢Ù…ÙˆØ² Â«${f.identity.name}Â» Ø¨Ù‡ Ø³Ø·Ù„ Ø²Ø¨Ø§Ù„Ù‡ Ù…Ù†ØªÙ‚Ù„ Ø´Ø¯.`)},{confirmText:"Ø¨Ù„Ù‡",confirmClass:"btn-warning",isDelete:!0,onCancel:()=>{We(f)}})})});const o=document.createElement("button");o.className="btn-icon btn-icon-label",o.title="Ú¯Ø²Ø§Ø±Ø´ ÙˆØ¶Ø¹ÛŒØª Ø¯Ø§Ù†Ø´â€ŒØ¢Ù…ÙˆØ²",o.innerHTML="<span>ðŸ“Š</span><span>Ú¯Ø²Ø§Ø±Ø´</span>",o.addEventListener("click",()=>{j("ðŸ—ï¸ Ø§ÛŒÙ† Ù‚Ø§Ø¨Ù„ÛŒØª Ø¯Ø± Ù†Ø³Ø®Ù‡â€ŒÙ‡Ø§ÛŒ Ø¢ÛŒÙ†Ø¯Ù‡ ÙØ¹Ø§Ù„ Ø®ÙˆØ§Ù‡Ø¯ Ø´Ø¯.")}),n.appendChild(o);const l=document.createElement("button");l.className="btn-icon btn-icon-label",l.title="Ø§ÙØ²ÙˆØ¯Ù† ÛŒØ§Ø¯Ø¯Ø§Ø´Øª Ø¬Ø¯ÛŒØ¯",l.innerHTML="<span>ðŸ“</span><span>ÛŒØ§Ø¯Ø¯Ø§Ø´Øª</span>",l.addEventListener("click",()=>{const f=_e;ve.value="",ve.dispatchEvent(new Event("input",{bubbles:!0})),ut(p=>{if(p)return f.addNote(p),se(),Ce(N.info.name,`ÛŒØ§Ø¯Ø¯Ø§Ø´Øª Ø¬Ø¯ÛŒØ¯ÛŒ Ø¨Ø±Ø§ÛŒ Ø¯Ø§Ù†Ø´â€ŒØ¢Ù…ÙˆØ² Â«${f.identity.name}Â» Ø«Ø¨Øª Ø´Ø¯.`,{type:"VIEW_STUDENT_PROFILE",studentId:f.identity.studentId}),Re(),j("âœ… ÛŒØ§Ø¯Ø¯Ø§Ø´Øª Ø¨Ø§ Ù…ÙˆÙÙ‚ÛŒØª Ø«Ø¨Øª Ø´Ø¯."),()=>We(f)}),fe(()=>{Te("add-note-modal"),ve.focus()})}),n.appendChild(r),n.appendChild(i),n.appendChild(l),c.appendChild(n),Yo(c),sr(c),a.onclick=()=>fe(),Te("student-profile-modal")}function Yo(e){if(!_e||!N)return;const s=document.createElement("div");s.className="scoring-section",s.innerHTML=`
    <h3>Ø«Ø¨Øª Ù†Ù…Ø±Ù‡ Ø¬Ø¯ÛŒØ¯</h3>
    <div id="modal-graded-pills" class="category-pills"></div>
    <div class="input-group" style="margin-top: 15px; display: flex; gap: 10px;">
        <input type="number" id="modal-new-score-value" placeholder="Ù†Ù…Ø±Ù‡" style="width: 70px; text-align: center;">
        <input type="text" id="modal-new-score-comment" placeholder="ØªÙˆØ¶ÛŒØ­Ø§Øª (Ø§Ø®ØªÛŒØ§Ø±ÛŒ)..." style="flex-grow: 1;">
    </div>
    <button id="modal-add-score-btn" class="btn-success" style="width: 100%; margin-top: 10px;">Ø«Ø¨Øª Ù†Ù…Ø±Ù‡</button>
`,Mi(s.querySelector("#modal-new-score-comment"));const t=s.querySelector("#modal-graded-pills");ye(N.categories).filter(i=>i.isGradedCategory).forEach(i=>{const o=document.createElement("span");o.className="pill",o.textContent=i.name,o.dataset.skillName=i.name,o.addEventListener("click",()=>{t.querySelectorAll(".pill").forEach(l=>l.classList.remove("active")),o.classList.add("active"),nr(i,o)}),t.appendChild(o)});const a=s.querySelector("#modal-add-score-btn"),n=s.querySelector("#modal-new-score-value"),r=s.querySelector("#modal-new-score-comment");wn(n,"Enter",()=>{a.click(),En(n)}),Ei(n),wn(r,"Enter",()=>{a.click(),En(r)}),a.addEventListener("click",()=>{const i=t.querySelector(".pill.active");if(!i){j("âš ï¸Ù„Ø·ÙØ§Ù‹ ÛŒÚ© Ù…Ù‡Ø§Ø±Øª Ø±Ø§ Ø¨Ø±Ø§ÛŒ Ù†Ù…Ø±Ù‡â€ŒØ¯Ù‡ÛŒ Ø§Ù†ØªØ®Ø§Ø¨ Ú©Ù†ÛŒØ¯.");return}const o=i.dataset.skillName,l=n.value,f=r.value.trim();if(!l){j("Ù„Ø·ÙØ§Ù‹ Ù…Ù‚Ø¯Ø§Ø± Ù†Ù…Ø±Ù‡ Ø±Ø§ ÙˆØ§Ø±Ø¯ Ú©Ù†ÛŒØ¯.");return}_e.addScore(o,parseFloat(l),f),se(),Ce(N.info.name,`Ù†Ù…Ø±Ù‡ ${l} Ø¯Ø± ${o} Ø¨Ø±Ø§ÛŒ Â«${_e.identity.name}Â» Ø«Ø¨Øª Ø´Ø¯.`,{type:"VIEW_STUDENT_PROFILE",studentId:_e.identity.studentId}),Oe(),Re(),n.value="",r.value="";const p=document.getElementById("modal-profile-content-container"),m=p.querySelector(".history-section");m&&m.remove(),sr(p),j(`âœ… Ù†Ù…Ø±Ù‡ Ø¨Ø±Ø§ÛŒ Ù…Ù‡Ø§Ø±Øª ${o} Ø¨Ø±Ø§ÛŒ Ø¯Ø§Ù†Ø´ Ø¢Ù…ÙˆØ² ${_e.identity.name} Ø¨Ø§ Ù…ÙˆÙÙ‚ÛŒØª Ø«Ø¨Øª Ø´Ø¯.`)}),e.appendChild(s)}function sr(e){if(!_e)return;const s=document.createElement("div");s.className="history-section";const t=document.createElement("div");t.className="history-section-header";const c=document.createElement("h3");c.textContent="Ø³ÙˆØ§Ø¨Ù‚ Ø¯Ø§Ù†Ø´â€ŒØ¢Ù…ÙˆØ²",t.appendChild(c),s.appendChild(t),Xo(s),ir(s),ar(s),e.appendChild(s)}function Xo(e){if(!_e)return;const s=_e,t=N.sessions.reduce((_,k)=>{const x=k.studentRecords[s.identity.studentId];return _+(x&&x.attendance==="absent"?1:0)},0),c=Object.values(s.categoryIssues||{}).reduce((_,k)=>_+k,0);let a=0,n=0,r=0;const i=s.qualitativeStats||{};Object.values(i).forEach(_=>{a+=_.effort||0,n+=_.good||0,r+=_.excellent||0});const o=a+n+r,l=document.createElement("div");l.className="stats-summary-box",l.innerHTML=`
        <p><strong>Ú©Ù„ Ø§Ù†ØªØ®Ø§Ø¨:</strong> ${s.statusCounters.totalSelections}</p>
        <p><strong>ØºÛŒØ¨Øª:</strong> ${t}</p>
        <p><strong>ÙØ±ØµØª Ø§Ø² Ø¯Ø³Øª Ø±ÙØªÙ‡:</strong> ${s.statusCounters.missedChances||0}</p>
        <p><strong>Ù…Ø´Ú©Ù„:</strong> ${c}</p>
        <p><strong>Ø¹Ù…Ù„Ú©Ø±Ø¯ Ú©ÛŒÙÛŒ:</strong> ${o}</p>
    `,e.appendChild(l),l.querySelector("p:nth-child(1)");const f=l.querySelector("p:nth-child(4)"),p=l.querySelector("p:nth-child(5)");e.appendChild(l);const m=ye(N.categories),h=document.createElement("div");if(h.className="stats-breakdown",m.length>0){m.forEach(k=>{var O;const x=k.name,L=((O=s.categoryCounts)==null?void 0:O[x])||0,B=document.createElement("p");B.className="stats-breakdown-item",B.innerHTML=`<strong>${x}:</strong> ${L}`,h.appendChild(B)});const _=l.querySelector("p:first-child");_&&(_.classList.add("collapsible-toggle"),_.onclick=()=>{h.classList.toggle("open"),_.classList.toggle("open")},_.after(h))}const y=document.createElement("div");y.className="stats-breakdown",m.length>0&&(m.forEach(_=>{var B;const k=_.name,x=((B=s.categoryIssues)==null?void 0:B[k])||0,L=document.createElement("p");L.className="stats-breakdown-item",L.innerHTML=`<strong>${k}:</strong> ${x}`,y.appendChild(L)}),f&&c>0&&(f.classList.add("collapsible-toggle"),f.onclick=()=>{y.classList.toggle("open"),f.classList.toggle("open")},f.after(y)));const u=document.createElement("div");if(u.className="stats-breakdown",o>0){for(const _ in i){const k=i[_];if((k.effort||0)+(k.good||0)+(k.excellent||0)>0){const L=document.createElement("p");L.className="stats-breakdown-item",L.innerHTML=`<strong>${_}:</strong> <span style="color:var(--color-primary)">Ø¹Ø§Ù„ÛŒ:${k.excellent}</span> | <span style="color:var(--color-success)">Ø®ÙˆØ¨:${k.good}</span> | <span style="color:#fd7e14">ØªÙ„Ø§Ø´:${k.effort}</span>`,u.appendChild(L)}}p&&o>0&&(p.classList.add("collapsible-toggle"),p.onclick=()=>{u.classList.toggle("open"),p.classList.toggle("open")},p.after(u))}const v=document.createElement("p"),b=document.createElement("strong");b.textContent="ØªÚ©Ø§Ù„ÛŒÙ Ù†Ø§Ù‚Øµ:";const C=document.createElement("span");C.style.marginRight="5px";const S=dt(N);jn(s,S,C,{includePrefix:!1}),v.appendChild(b),v.appendChild(C),l.appendChild(v)}function ir(e){if(!_e)return;const s=_e,t=document.createElement("h4");t.textContent="ØªØ§Ø±ÛŒØ®Ú†Ù‡ Ù†Ù…Ø±Ø§Øª:",t.style.marginTop="20px";const c=s.getOverallAverageScore(),a=document.createElement("span");a.className="profile-avg-badge",a.textContent=` (Ù…ÛŒØ§Ù†Ú¯ÛŒÙ†: ${c!==null?c:"-"})`,t.appendChild(a);const n=N.calculateFinalStudentScore(s),r=document.createElement("span");r.className="profile-avg-badge",r.textContent=` (Ù†Ù…Ø±Ù‡ Ù†Ù‡Ø§ÛŒÛŒ: ${n!==null?n:"-"})`,t.appendChild(r);const i=document.createElement("ul");i.className="list-container";const o=Object.values(s.logs.scores||{}).flat().filter(l=>!l.isDeleted).sort((l,f)=>new Date(f.timestamp)-new Date(l.timestamp));o.length===0?i.innerHTML='<div class="no-content-message">Ù‡Ù†ÙˆØ² Ù†Ù…Ø±Ù‡â€ŒØ§ÛŒ Ø«Ø¨Øª Ù†Ø´Ø¯Ù‡ Ø§Ø³Øª.</div>':o.forEach(l=>{const f=document.createElement("li");f.className="score-history-item";const p=document.createElement("div");p.className="item-content";const m=document.createElement("div");m.className="score-info";const h=document.createElement("span");h.className="score-skill-badge",h.textContent=l.skill;const y=document.createElement("span");y.className="score-value",y.textContent=`Ù†Ù…Ø±Ù‡: ${l.value}`;const u=document.createElement("span");if(u.className="score-date",u.textContent=new Date(l.timestamp).toLocaleDateString("fa-IR"),m.appendChild(h),m.appendChild(y),m.appendChild(u),p.appendChild(m),l.comment){const b=document.createElement("p");b.className="score-comment",b.innerHTML=wi(l.comment),b.addEventListener("click",()=>{ve.value=l.comment,ve.dispatchEvent(new Event("input",{bubbles:!0})),ut(C=>{l.comment=C,se(),Ce(N.info.name,`ØªÙˆØ¶ÛŒØ­Ø§Øª Ù†Ù…Ø±Ù‡ ${l.value} (${l.skill}) Ø¨Ø±Ø§ÛŒ Ø¯Ø§Ù†Ø´â€ŒØ¢Ù…ÙˆØ² Â«${s.identity.name}Â» Ø¨Ù‡â€ŒØ±ÙˆØ²Ø±Ø³Ø§Ù†ÛŒ Ø´Ø¯.`,{type:"VIEW_STUDENT_PROFILE",studentId:s.identity.studentId}),We(s),j("âœ… ØªÙˆØ¶ÛŒØ­Ø§Øª Ù†Ù…Ø±Ù‡ Ø¨Ø§ Ù…ÙˆÙÙ‚ÛŒØª ÙˆÛŒØ±Ø§ÛŒØ´ Ø´Ø¯.")}),fe(()=>{Te("add-note-modal"),ve.focus()})}),p.appendChild(b)}const v=document.createElement("button");v.className="btn-icon delete-item-btn",v.innerHTML="ðŸ—‘ï¸",v.title="Ø­Ø°Ù Ø§ÛŒÙ† Ù†Ù…Ø±Ù‡",v.addEventListener("click",()=>{fe(()=>{ge(`Ø¢ÛŒØ§ Ø§Ø² Ø§Ù†ØªÙ‚Ø§Ù„ Ù†Ù…Ø±Ù‡ ${l.value} Ø¯Ø± Ù…Ù‡Ø§Ø±Øª Â«${l.skill}Â» Ø¨Ø±Ø§ÛŒ Ø¯Ø§Ù†Ø´ Ø¢Ù…ÙˆØ² Â«${s.identity.name}Â» Ø¨Ù‡ Ø³Ø·Ù„ Ø²Ø¨Ø§Ù„Ù‡ Ù…Ø·Ù…Ø¦Ù† Ù‡Ø³ØªÛŒØ¯ØŸ`,()=>{const b={id:`trash_${Date.now()}_${Math.random()}`,timestamp:new Date().toISOString(),type:"score",description:`Ù†Ù…Ø±Ù‡ ${l.value} (${l.skill}) Ø¨Ø±Ø§ÛŒ Â«${s.identity.name}Â»`,restoreData:{scoreId:l.id,skill:l.skill,studentId:s.identity.studentId,classId:N.info.scheduleCode}};lt(b),l.isDeleted=!0,se(),Ce(N.info.name,`Ù†Ù…Ø±Ù‡ ${l.value} (${l.skill}) Ø¯Ø§Ù†Ø´â€ŒØ¢Ù…ÙˆØ² Â«${s.identity.name}Â» Ø¨Ù‡ Ø³Ø·Ù„ Ø²Ø¨Ø§Ù„Ù‡ Ù…Ù†ØªÙ‚Ù„ Ø´Ø¯.`,{type:"VIEW_TRASH"}),We(s),j(`âœ… Ù†Ù…Ø±Ù‡ Ø¯Ø§Ù†Ø´ Ø¢Ù…ÙˆØ² ${s.identity.name} Ø¨Ù‡ Ø³Ø·Ù„ Ø²Ø¨Ø§Ù„Ù‡ Ù…Ù†ØªÙ‚Ù„ Ø´Ø¯.`)},{confirmText:"ØªØ§ÛŒÛŒØ¯ Ø§Ù†ØªÙ‚Ø§Ù„",confirmClass:"btn-warning",onCancel:()=>{We(s)}})})}),f.appendChild(p),f.appendChild(v),i.appendChild(f)}),e.appendChild(t),e.appendChild(i)}function ar(e){if(!_e)return;const s=document.createElement("h4");s.textContent="ØªØ§Ø±ÛŒØ®Ú†Ù‡ ÛŒØ§Ø¯Ø¯Ø§Ø´Øªâ€ŒÙ‡Ø§:",s.style.marginTop="20px";const t=document.createElement("ul");t.className="list-container",!_e.profile.notes||_e.profile.notes.length===0?t.innerHTML='<div class="no-content-message">Ù‡Ù†ÙˆØ² ÛŒØ§Ø¯Ø¯Ø§Ø´ØªÛŒ Ø«Ø¨Øª Ù†Ø´Ø¯Ù‡ Ø§Ø³Øª.</div>':[..._e.profile.notes].filter(a=>!a.isDeleted).sort((a,n)=>new Date(n.timestamp)-new Date(a.timestamp)).forEach(a=>{const n=document.createElement("li");n.className="note-history-item";const r=document.createElement("div");r.className="item-content";const i=document.createElement("div");i.className="note-info";const o=document.createElement("span");o.className="note-date",o.textContent=new Date(a.timestamp).toLocaleDateString("fa-IR");const l=document.createElement("button");l.className="btn-icon delete-item-btn",l.innerHTML="ðŸ—‘ï¸",l.title="Ø­Ø°Ù Ø§ÛŒÙ† ÛŒØ§Ø¯Ø¯Ø§Ø´Øª",l.addEventListener("click",()=>{const p=_e;fe(()=>{ge("Ø¢ÛŒØ§ Ø§Ø² Ø§Ù†ØªÙ‚Ø§Ù„ Ø§ÛŒÙ† ÛŒØ§Ø¯Ø¯Ø§Ø´Øª Ø¨Ù‡ Ø³Ø·Ù„ Ø²Ø¨Ø§Ù„Ù‡ Ù…Ø·Ù…Ø¦Ù† Ù‡Ø³ØªÛŒØ¯ØŸ",()=>{const m={id:`trash_${Date.now()}_${Math.random()}`,timestamp:new Date().toISOString(),type:"note",description:`ÛŒØ§Ø¯Ø¯Ø§Ø´Øª Ø¨Ø±Ø§ÛŒ Ø¯Ø§Ù†Ø´â€ŒØ¢Ù…ÙˆØ² Â«${p.identity.name}Â»`,restoreData:{noteId:a.id,studentId:p.identity.studentId,classId:N.info.scheduleCode}};lt(m),a.isDeleted=!0,Ce(N.info.name,`ÛŒØ§Ø¯Ø¯Ø§Ø´Øª Ø¯Ø§Ù†Ø´â€ŒØ¢Ù…ÙˆØ² Â«${p.identity.name}Â» Ø¨Ù‡ Ø³Ø·Ù„ Ø²Ø¨Ø§Ù„Ù‡ Ù…Ù†ØªÙ‚Ù„ Ø´Ø¯.`,{type:"VIEW_TRASH"}),se(),We(p),j("âœ… ÛŒØ§Ø¯Ø¯Ø§Ø´Øª Ø¨Ù‡ Ø³Ø·Ù„ Ø²Ø¨Ø§Ù„Ù‡ Ù…Ù†ØªÙ‚Ù„ Ø´Ø¯.")},{confirmText:"ØªØ§ÛŒÛŒØ¯ Ø§Ù†ØªÙ‚Ø§Ù„",confirmClass:"btn-warning",onCancel:()=>{We(p)}})})}),i.appendChild(o),i.appendChild(l);const f=document.createElement("p");f.className="note-content",f.innerHTML=wi(a.content),f.addEventListener("click",()=>{const p=_e;ve.value=a.content,ve.dispatchEvent(new Event("input",{bubbles:!0})),ut(m=>{a.content=m,se(),Ce(N.info.name,`ÛŒØ§Ø¯Ø¯Ø§Ø´Øª Ø¯Ø§Ù†Ø´â€ŒØ¢Ù…ÙˆØ² Â«${p.identity.name}Â» Ø¨Ù‡â€ŒØ±ÙˆØ²Ø±Ø³Ø§Ù†ÛŒ Ø´Ø¯.`,{type:"VIEW_STUDENT_PROFILE",studentId:p.identity.studentId}),We(p),j("âœ…ÛŒØ§Ø¯Ø¯Ø§Ø´Øª Ø¨Ø§ Ù…ÙˆÙÙ‚ÛŒØª ÙˆÛŒØ±Ø§ÛŒØ´ Ø´Ø¯.")}),fe(()=>{Te("add-note-modal"),ve.focus()})}),r.appendChild(i),r.appendChild(f),n.appendChild(r),t.appendChild(n)}),e.appendChild(s),e.appendChild(t)}function rr(e){Ms.innerHTML="",e.forEach((s,t)=>{const c=document.createElement("option");c.value=t,c.textContent=s.trim(),Ms.appendChild(c)})}function qs(){As.innerHTML="",Ks.forEach(e=>{const s=document.createElement("li");s.className="preview-item";const t=document.createElement("input");t.type="checkbox",t.checked=!0,t.dataset.name=e;const c=document.createElement("label");c.textContent=e,s.appendChild(t),s.appendChild(c),As.appendChild(s)})}function Qo(e){const s=document.createElement("div");s.className="list-item-buttons";const t=document.createElement("button");return t.className="btn-icon",t.innerHTML="ðŸ“",t.title="ÙˆÛŒØ±Ø§ÛŒØ´ ÛŒØ§Ø¯Ø¯Ø§Ø´Øª Ú©Ù„Ø§Ø³",e.note||(t.style.display="none"),t.addEventListener("click",c=>{c.stopPropagation(),vs(e)}),s.appendChild(t),s}function ec(e){const s=document.createElement("div");s.style.flexGrow="1",s.style.display="flex",s.style.flexDirection="column",s.style.alignItems="flex-start";const t=document.createElement("span");t.textContent=e.info.name,t.classList.add("class-name-display"),s.appendChild(t);const c=ye(e.students).length,a=ye(e.sessions).filter(l=>l.isFinished).length,n=cc(e.info.scheduleDays),r=document.createElement("div");r.classList.add("class-stats-row");const i=document.createElement("span");i.textContent=`${c} Ù†ÙØ±`,i.classList.add("student-count-badge"),r.appendChild(i);const o=document.createElement("span");if(o.textContent=`${a} Ø¬Ù„Ø³Ù‡`,o.classList.add("session-count-badge"),r.appendChild(o),n){const l=document.createElement("span");l.textContent=n,l.classList.add("schedule-days-badge"),r.appendChild(l)}return s.appendChild(r),s.addEventListener("click",()=>{Ge(e),at(null),yn(N.liveSession),qe(),Se("session-page")}),s}function tc(e){const s=document.createElement("li");ms(e).type==="active"&&(s.classList.add("active-class-card"),s.title="Ø§ÛŒÙ† Ú©Ù„Ø§Ø³ Ù‡Ù…â€ŒØ§Ú©Ù†ÙˆÙ† Ø¯Ø± Ø­Ø§Ù„ Ø¨Ø±Ú¯Ø²Ø§Ø±ÛŒ Ø§Ø³Øª");const c=document.createElement("input");c.type="checkbox",c.className="mass-selection-checkbox",c.checked=st.includes(e.info.name),c.addEventListener("click",f=>{f.stopPropagation()}),c.addEventListener("change",()=>{const f=e.info.name;if(c.checked)st.includes(f)||st.push(f);else{const p=st.indexOf(f);p>-1&&st.splice(p,1)}}),s.appendChild(c);const a=ec(e);s.appendChild(a);const n=document.createElement("div");n.style.display="flex",n.style.flexDirection="column",n.style.gap="5px",n.style.alignItems="flex-end",n.style.marginLeft="10px";const r=document.createElement("div");if(r.className="list-item-badges",e.liveSession&&!e.liveSession.isCancelled&&!e.liveSession.isDeleted){const f=document.createElement("span");f.className="warning-badge",f.textContent="Ø¬Ù„Ø³Ù‡ Ø¨Ø§Ø²",r.appendChild(f),s.classList.add("has-unfinished-session")}const i=document.createElement("span");if(i.className=`type-badge ${e.info.type}`,i.textContent=e.info.type==="online"?"Ø¢Ù†Ù„Ø§ÛŒÙ†":"Ø­Ø¶ÙˆØ±ÛŒ",i.title="Ù†ÙˆØ¹ Ú©Ù„Ø§Ø³",r.appendChild(i),ms(e).type==="incomplete"){const f=document.createElement("span");f.className="type-badge cancelled-badge",f.textContent="Ø²Ù…Ø§Ù†â€ŒØ¨Ù†Ø¯ÛŒ Ù†Ø§Ù‚Øµ",f.style.cursor="pointer",f.title="Ø¨Ø±Ø§ÛŒ ØªÚ©Ù…ÛŒÙ„ Ø²Ù…Ø§Ù†â€ŒØ¨Ù†Ø¯ÛŒ Ú©Ù„ÛŒÚ© Ú©Ù†ÛŒØ¯",f.addEventListener("click",p=>{p.stopPropagation(),ge("Ø²Ù…Ø§Ù†â€ŒØ¨Ù†Ø¯ÛŒ Ø§ÛŒÙ† Ú©Ù„Ø§Ø³ Ú©Ø§Ù…Ù„ Ù†ÛŒØ³Øª. Ø¨Ø±Ø§ÛŒ Ù†Ù…Ø§ÛŒØ´ ØµØ­ÛŒØ­ Ø¯Ø± Ù„ÛŒØ³ØªØŒ Ù„Ø·ÙØ§Ù‹ Ø±ÙˆØ²Ù‡Ø§ Ùˆ Ø³Ø§Ø¹Øª Ø¨Ø±Ú¯Ø²Ø§Ø±ÛŒ Ø±Ø§ Ù…Ø´Ø®Øµ Ú©Ù†ÛŒØ¯.",()=>{Lt(e)},{confirmText:"ØªÙ†Ø¸ÛŒÙ…Ø§Øª",confirmClass:"btn-primary"})}),r.appendChild(f)}else{const f=oc(e,ie);if(f){const p=document.createElement("span");p.className="type-badge conflict-badge",p.textContent="ØªØ¯Ø§Ø®Ù„ Ø²Ù…Ø§Ù†ÛŒ",p.style.cursor="pointer",p.title=`ØªØ¯Ø§Ø®Ù„ Ø¨Ø§ Ú©Ù„Ø§Ø³: ${f}`,p.addEventListener("click",m=>{m.stopPropagation(),ge(`Ø²Ù…Ø§Ù† Ø¨Ø±Ú¯Ø²Ø§Ø±ÛŒ Ø§ÛŒÙ† Ú©Ù„Ø§Ø³ Ø¨Ø§ Ú©Ù„Ø§Ø³ Â«${f}Â» ØªØ¯Ø§Ø®Ù„ Ø¯Ø§Ø±Ø¯. Ù„Ø·ÙØ§Ù‹ Ø²Ù…Ø§Ù†â€ŒØ¨Ù†Ø¯ÛŒ Ø±Ø§ Ø¨Ø±Ø±Ø³ÛŒ Ú©Ù†ÛŒØ¯.`,()=>{Lt(e)},{confirmText:"ØªÙ†Ø¸ÛŒÙ…Ø§Øª",confirmClass:"btn-primary"})}),r.appendChild(p)}}n.appendChild(r);const l=Qo(e);return n.appendChild(l),s.appendChild(n),s.addEventListener("contextmenu",f=>{const p={label:"Ù¾Ø´ØªÛŒØ¨Ø§Ù†â€ŒÚ¯ÛŒØ±ÛŒ Ø§Ø² Ø§ÛŒÙ† Ú©Ù„Ø§Ø³",icon:"ðŸ“¤",action:()=>{is([e.info.name])}},m=st.length;m>1&&st.includes(e.info.name)&&(p.label=`Ù¾Ø´ØªÛŒØ¨Ø§Ù†â€ŒÚ¯ÛŒØ±ÛŒ Ø§Ø² ${m} Ú©Ù„Ø§Ø³`,p.action=()=>{is(st),Pn([]),He()});const h={label:"Ø­Ø°Ù Ú©Ù„Ø§Ø³",icon:"ðŸ—‘ï¸",className:"danger",action:()=>{ge(`Ø¢ÛŒØ§ Ø§Ø² Ø§Ù†ØªÙ‚Ø§Ù„ Ú©Ù„Ø§Ø³ Â«${e.info.name}Â» Ø¨Ù‡ Ø³Ø·Ù„ Ø²Ø¨Ø§Ù„Ù‡ Ù…Ø·Ù…Ø¦Ù† Ù‡Ø³ØªÛŒØ¯ØŸ`,()=>{const u={id:`trash_${Date.now()}_${Math.random()}`,timestamp:new Date().toISOString(),type:"classroom",description:`Ú©Ù„Ø§Ø³ Â«${e.info.name}Â»`,restoreData:{name:e.info.name}};lt(u),e.isDeleted=!0,Ce(e.info.name,`Ú©Ù„Ø§Ø³ Â«${e.info.name}Â» Ø¨Ù‡ Ø³Ø·Ù„ Ø²Ø¨Ø§Ù„Ù‡ Ù…Ù†ØªÙ‚Ù„ Ø´Ø¯.`,{type:"VIEW_TRASH"}),se(),He(),j(`âœ… Ú©Ù„Ø§Ø³ Â«${e.info.name}Â» Ø¨Ù‡ Ø³Ø·Ù„ Ø²Ø¨Ø§Ù„Ù‡ Ù…Ù†ØªÙ‚Ù„ Ø´Ø¯.`)},{confirmText:"Ø¨Ù„Ù‡",confirmClass:"btn-warning",isDelete:!0})}};m>1&&st.includes(e.info.name)&&(h.label=`Ø­Ø°Ù ${m} Ú©Ù„Ø§Ø³`,h.action=()=>{ge(`Ø¢ÛŒØ§ Ø§Ø² Ø§Ù†ØªÙ‚Ø§Ù„ ${m} Ú©Ù„Ø§Ø³ Ø§Ù†ØªØ®Ø§Ø¨ Ø´Ø¯Ù‡ Ø¨Ù‡ Ø³Ø·Ù„ Ø²Ø¨Ø§Ù„Ù‡ Ù…Ø·Ù…Ø¦Ù† Ù‡Ø³ØªÛŒØ¯ØŸ`,()=>{st.forEach(u=>{const v=ie[u];if(v&&!v.isDeleted){const b={id:`trash_${Date.now()}_${Math.random()}`,timestamp:new Date().toISOString(),type:"classroom",description:`Ú©Ù„Ø§Ø³ Â«${v.info.name}Â»`,restoreData:{name:v.info.name}};lt(b),v.isDeleted=!0,Ce(v.info.name,`Ú©Ù„Ø§Ø³ Â«${v.info.name}Â» Ø¨Ù‡ Ø³Ø·Ù„ Ø²Ø¨Ø§Ù„Ù‡ Ù…Ù†ØªÙ‚Ù„ Ø´Ø¯.`,{type:"VIEW_TRASH"})}}),Pn([]),se(),He(),j(`âœ… ${m} Ú©Ù„Ø§Ø³ Ø¨Ù‡ Ø³Ø·Ù„ Ø²Ø¨Ø§Ù„Ù‡ Ù…Ù†ØªÙ‚Ù„ Ø´Ø¯Ù†Ø¯.`)},{confirmText:"Ø¨Ù„Ù‡",confirmClass:"btn-warning",isDelete:!0})});const y=[{label:"Ú†Ø§Ù¾ Ú¯Ø²Ø§Ø±Ø´ Ú©Ù„Ø§Ø³",icon:"ðŸ–¨ï¸",action:()=>{qr(e)}},{label:At.classList.contains("selection-mode-active")?"Ù„ØºÙˆ Ø§Ù†ØªØ®Ø§Ø¨":"Ø§Ù†ØªØ®Ø§Ø¨ Ú†Ù†Ø¯ Ú©Ù„Ø§Ø³",icon:"âœ”ï¸",action:()=>{const u=At.classList.contains("selection-mode-active");At.classList.toggle("selection-mode-active"),u&&(Pn([]),He())}},p,{label:"ÛŒØ§Ø¯Ø¯Ø§Ø´Øª Ú©Ù„Ø§Ø³",icon:"ðŸ“",action:()=>{vs(e)}},{label:"ØªÙ†Ø¸ÛŒÙ…Ø§Øª Ú©Ù„Ø§Ø³",icon:"âš™ï¸",action:()=>{Lt(e)}},{label:"Ú¯Ø²Ø§Ø±Ø´ ÙØ¹Ø§Ù„ÛŒØªâ€ŒÙ‡Ø§",icon:"ðŸ“‹",action:()=>{er(e.info.name)}},{label:"ØªØºÛŒÛŒØ± Ù†Ø§Ù…",icon:"âœï¸",action:()=>{const u=e.info.name,v=document.getElementById("add-note-modal-title");v.textContent="ØªØºÛŒÛŒØ± Ù†Ø§Ù… Ú©Ù„Ø§Ø³",ve.value=u,ve.rows=1,ut(b=>{const C=b.trim();if(C&&C!==u){const S=oa(u,C);S.success?(Pr(u,C),Ce(C,`Ù†Ø§Ù… Ú©Ù„Ø§Ø³ Ø§Ø² Â«${u}Â» Ø¨Ù‡ Â«${C}Â» ØªØºÛŒÛŒØ± ÛŒØ§ÙØª.`,{type:"VIEW_SESSIONS"}),se(),He(),j(`âœ…Ù†Ø§Ù… Ú©Ù„Ø§Ø³ Ø¨Ù‡ Â«${C}Â» ØªØºÛŒÛŒØ± ÛŒØ§ÙØª.`)):j(S.message)}v.textContent="Ø«Ø¨Øª ÛŒØ§Ø¯Ø¯Ø§Ø´Øª Ø¬Ø¯ÛŒØ¯",ve.rows=4}),Te("add-note-modal"),ve.focus(),ve.select()}},h];Bn(f,y)}),s}function bs(){const e=document.getElementById("class-management-stats");if(!e)return;const s=Object.values(ie).filter(n=>!n.isDeleted),t=s.length,c=s.reduce((n,r)=>n+ye(r.students).length,0);let a="";ze.lastBackupTimestamp&&(a=`
            <div class="stats-row backup-stat">
                <span>Ø¢Ø®Ø±ÛŒÙ† Ù¾Ø´ØªÛŒØ¨Ø§Ù†: <strong>${new Date(ze.lastBackupTimestamp).toLocaleString("fa-IR",{year:"numeric",month:"numeric",day:"numeric",weekday:"long",hour:"2-digit",minute:"2-digit"})}</strong></span>
            </div>
        `),e.innerHTML=`
        <div class="stats-row main-stats">
            <span>Ú©Ù„ Ú©Ù„Ø§Ø³â€ŒÙ‡Ø§: <strong>${t}</strong></span>
            <span>|</span>
            <span>Ú©Ù„ Ø¯Ø§Ù†Ø´â€ŒØ¢Ù…ÙˆØ²Ø§Ù†: <strong>${c}</strong></span>
        </div>
        ${a} 
    `}function He(){bs(),At.innerHTML="";const e=Object.values(ie).filter(a=>!a.isDeleted),s=document.querySelector(".fab-container"),t=document.querySelector(".global-search-container");if(e.length===0){s&&s.classList.add("center-empty-state"),t&&(t.style.display="none"),At.innerHTML='<li class="no-content-message" style="text-align:center; margin-top:20px;">Ù‡Ù†ÙˆØ² Ú©Ù„Ø§Ø³ÛŒ Ø§ÛŒØ¬Ø§Ø¯ Ù†Ø´Ø¯Ù‡ Ø§Ø³Øª.</li>';return}else s&&s.classList.remove("center-empty-state"),t&&(t.style.display="");e.sort((a,n)=>{const r=ms(a),i=ms(n);return r.sortIndex!==i.sortIndex?r.sortIndex-i.sortIndex:r.type==="upcoming"?r.nextTimestamp-i.nextTimestamp:new Date(a.info.creationDate)-new Date(n.info.creationDate)}).forEach(a=>{const n=tc(a);At.appendChild(n)})}function Tt(){if(!N)return;Ds.innerHTML="";const e=ye(N.students);Ln(e).forEach(t=>{const c=document.createElement("li");c.dataset.studentId=t.identity.studentId;const a=document.createElement("span");a.className="student-name-link",a.style.flexGrow="1",t.identity.firstName&&t.identity.lastName?a.textContent=`${t.identity.lastName}ØŒ ${t.identity.firstName}`:a.textContent=t.identity.name,a.addEventListener("click",()=>{We(t)}),c.addEventListener("contextmenu",n=>{Bn(n,[{label:"ØªØºÛŒÛŒØ± Ù†Ø§Ù…",icon:"âœï¸",action:()=>{Bi(t,N)}},{label:"Ø§Ù†ØªÙ‚Ø§Ù„ Ø¯Ø§Ù†Ø´â€ŒØ¢Ù…ÙˆØ²",icon:"âž¡ï¸",action:()=>{Ti(t,N)}},{label:"Ø­Ø°Ù Ø¯Ø§Ù†Ø´â€ŒØ¢Ù…ÙˆØ²",icon:"ðŸ—‘ï¸",className:"danger",action:()=>{ge(`Ø¢ÛŒØ§ Ø§Ø² Ø§Ù†ØªÙ‚Ø§Ù„ Ø¯Ø§Ù†Ø´â€ŒØ¢Ù…ÙˆØ² Â«${t.identity.name}Â» Ø¨Ù‡ Ø³Ø·Ù„ Ø²Ø¨Ø§Ù„Ù‡ Ù…Ø·Ù…Ø¦Ù† Ù‡Ø³ØªÛŒØ¯ØŸ`,()=>{const i={id:`trash_${Date.now()}_${Math.random()}`,timestamp:new Date().toISOString(),type:"student",description:`Ø¯Ø§Ù†Ø´â€ŒØ¢Ù…ÙˆØ² Â«${t.identity.name}Â» Ø§Ø² Ú©Ù„Ø§Ø³ Â«${N.info.name}Â»`,restoreData:{studentId:t.identity.studentId,classId:N.info.scheduleCode}};lt(i),t.isDeleted=!0,Ce(N.info.name,`Ø¯Ø§Ù†Ø´â€ŒØ¢Ù…ÙˆØ² Â«${t.identity.name}Â» Ø¨Ù‡ Ø³Ø·Ù„ Ø²Ø¨Ø§Ù„Ù‡ Ù…Ù†ØªÙ‚Ù„ Ø´Ø¯.`,{type:"VIEW_TRASH"}),se(),Tt(),Oe(),rt(),j(`âœ… Ø¯Ø§Ù†Ø´â€ŒØ¢Ù…ÙˆØ² Â«${t.identity.name}Â» Ø¨Ù‡ Ø³Ø·Ù„ Ø²Ø¨Ø§Ù„Ù‡ Ù…Ù†ØªÙ‚Ù„ Ø´Ø¯.`)},{confirmText:"Ø¨Ù„Ù‡",confirmClass:"btn-warning"})}}])}),c.appendChild(a),Ds.appendChild(c)})}function Qt(){if(Ns.innerHTML="",!N)return;N.categories.filter(s=>!s.isDeleted).forEach(s=>{const t=document.createElement("li"),c=document.createElement("div");c.className="name-and-badge-container";const a=document.createElement("span");if(a.textContent=s.name,c.appendChild(a),s.isGradedCategory){const r=document.createElement("span");r.className="category-badge",r.textContent="Ù†Ù…Ø±Ù‡â€ŒØ¯Ø§Ø±",c.appendChild(r)}if(s.isGradedCategory){const r=document.createElement("span");r.className="category-badge weight-badge",r.textContent=`Ø¶Ø±ÛŒØ¨: ${s.weight||1}`,c.appendChild(r)}const n=document.createElement("button");n.className="btn-icon",n.innerHTML="ðŸ—‘ï¸",n.style.color="var(--color-warning)",n.addEventListener("click",()=>{ge(`Ø¢ÛŒØ§ Ø§Ø² Ø§Ù†ØªÙ‚Ø§Ù„ Ø¯Ø³ØªÙ‡â€ŒØ¨Ù†Ø¯ÛŒ Â«${s.name}Â» Ø¨Ù‡ Ø³Ø·Ù„ Ø²Ø¨Ø§Ù„Ù‡ Ù…Ø·Ù…Ø¦Ù† Ù‡Ø³ØªÛŒØ¯ØŸ`,()=>{const r={id:`trash_${Date.now()}_${Math.random()}`,timestamp:new Date().toISOString(),type:"category",description:`Ø¯Ø³ØªÙ‡â€ŒØ¨Ù†Ø¯ÛŒ Â«${s.name}Â» Ø§Ø² Ú©Ù„Ø§Ø³ Â«${N.info.name}Â»`,restoreData:{categoryId:s.id,classId:N.info.scheduleCode}};lt(r),s.isDeleted=!0,Ce(N.info.name,`Ø¯Ø³ØªÙ‡â€ŒØ¨Ù†Ø¯ÛŒ Â«${s.name}Â» Ø¨Ù‡ Ø³Ø·Ù„ Ø²Ø¨Ø§Ù„Ù‡ Ù…Ù†ØªÙ‚Ù„ Ø´Ø¯.`,{type:"VIEW_TRASH"}),se(),Qt(),j(`âœ… Ø¯Ø³ØªÙ‡â€ŒØ¨Ù†Ø¯ÛŒ Â«${s.name}Â» Ø¨Ù‡ Ø³Ø·Ù„ Ø²Ø¨Ø§Ù„Ù‡ Ù…Ù†ØªÙ‚Ù„ Ø´Ø¯.`)},{confirmText:"Ø¨Ù„Ù‡",confirmClass:"btn-warning"})}),t.appendChild(c),t.appendChild(n),Ns.appendChild(t)})}function or(){if(!N)return;const e=N;Ri(Wn,cn,e.info.educationalSystem,e.info.level),Wn.addEventListener("change",()=>{e.info.educationalSystem=Wn.value,e.info.level=cn.value,se()}),cn.addEventListener("change",()=>{e.info.level=cn.value,se()});const s=e.info.type||"in-person",t=document.querySelector(`#settings-page input[name="class-type-setting"][value="${s}"]`);t&&(t.checked=!0);const c=e.info.scheduleDays||[];document.querySelectorAll('input[name="schedule-day"]').forEach(a=>{a.checked=c.includes(parseInt(a.value))}),document.getElementById("settings-schedule-start").value=e.info.scheduleStartTime||"",document.getElementById("settings-schedule-end").value=e.info.scheduleEndTime||""}function us(e){document.querySelectorAll(".page").forEach(t=>{t.classList.remove("active")});const s=document.getElementById(e);s&&s.classList.add("active"),e==="class-management-page"?(He(),Os.style.display="flex"):Os.style.display="none",tr()}function Se(e,s={}){const{tab:t}=s;let c=`#${e}`;const a=new URLSearchParams;N&&a.set("class",N.info.name),K&&a.set("session",K.sessionNumber),_e&&a.set("student",_e.identity.studentId),e==="session-dashboard-page"&&t&&a.set("tab",t);const n=a.toString();n&&(c+=`?${n}`),window.location.hash!==c&&history.pushState({pageId:e},"",c),us(e)}function nc(e,s){const t=document.createElement("div");t.className="list-item-buttons",t.style.gap="10px";const c=document.createElement("button");if(c.className="btn-icon",c.innerHTML="ðŸ“",c.title="ÙˆÛŒØ±Ø§ÛŒØ´ ÛŒØ§Ø¯Ø¯Ø§Ø´Øª Ø¬Ù„Ø³Ù‡",e.note||(c.style.display="none"),c.addEventListener("click",a=>{a.stopPropagation(),Ai(e,s)}),!e.isFinished&&!e.isCancelled){const a=document.createElement("button");a.className="btn-success",a.textContent="Ù¾Ø§ÛŒØ§Ù† Ø¬Ù„Ø³Ù‡",a.style.fontSize="12px",a.style.padding="4px 10px",a.style.whiteSpace="nowrap",a.addEventListener("click",n=>{n.stopPropagation(),ge(`Ø¬Ù„Ø³Ù‡ Ø´Ù…Ø§Ø±Ù‡ ${s} Ø®Ø§ØªÙ…Ù‡ Ù¾ÛŒØ¯Ø§ Ø®ÙˆØ§Ù‡Ø¯ Ú©Ø±Ø¯!`,()=>{N.endSpecificSession(e.sessionNumber),se(),Ce(N.info.name,`Ø¬Ù„Ø³Ù‡ ${s} Ø®Ø§ØªÙ…Ù‡ ÛŒØ§ÙØª.`,{type:"VIEW_SESSIONS"}),qe(),ge("Ø¬Ù„Ø³Ù‡ Ø¨Ø§ Ù…ÙˆÙÙ‚ÛŒØª Ø®Ø§ØªÙ…Ù‡ ÛŒØ§ÙØª. Ø¢ÛŒØ§ Ù…Ø§ÛŒÙ„ Ø¨Ù‡ Ø§ÛŒØ¬Ø§Ø¯ ÙØ§ÛŒÙ„ Ù¾Ø´ØªÛŒØ¨Ø§Ù† Ù‡Ø³ØªÛŒØ¯ØŸ",()=>{if(yt){j("âš ï¸ Ù¾Ø´ØªÛŒØ¨Ø§Ù†â€ŒÚ¯ÛŒØ±ÛŒ Ø¯Ø± Ø­Ø§Ù„Øª Ù†Ù…Ø§ÛŒØ´ (Demo) ØºÛŒØ±ÙØ¹Ø§Ù„ Ø§Ø³Øª.");return}is(),j("âœ…ÙØ§ÛŒÙ„ Ù¾Ø´ØªÛŒØ¨Ø§Ù† Ø¨Ø§ Ù…ÙˆÙÙ‚ÛŒØª Ø§ÛŒØ¬Ø§Ø¯ Ø´Ø¯.")},{confirmText:"Ø¨Ù„Ù‡",cancelText:"Ø®ÛŒØ±",confirmClass:"btn-success"})})}),t.appendChild(a)}return t.appendChild(c),t}function sc(e,s){const t=document.createElement("div");t.style.display="flex",t.style.flexDirection="column",t.style.alignItems="flex-start",t.style.flexGrow="1";const c=new Date(e.startTime).toLocaleDateString("fa-IR"),a=document.createElement("span");a.className="session-list-title";const n=document.createElement("div");n.style.display="flex",n.style.gap="5px",n.style.marginTop="5px";const r=new Date(e.startTime).toLocaleDateString("fa-IR",{weekday:"long"}),i=document.createElement("span");if(i.className="type-badge day-badge",i.textContent=r,n.appendChild(i),e.isCancelled){a.textContent=`Ù„ØºÙˆ Ø´Ø¯Ù‡ - ØªØ§Ø±ÛŒØ®: ${c}`,t.style.cursor="default";const o=document.createElement("span");o.className="type-badge cancelled-badge",o.textContent="Ù„ØºÙˆ Ø´Ø¯Ù‡",n.appendChild(o)}else a.textContent=`Ø¬Ù„Ø³Ù‡ ${s} - ØªØ§Ø±ÛŒØ®: ${c}`,t.style.cursor="pointer",t.addEventListener("click",()=>{at(e),Tn()});if(t.appendChild(a),e.isFinished){const o=document.createElement("span");o.className="type-badge finished-badge",o.textContent="Ø®Ø§ØªÙ…Ù‡ ÛŒØ§ÙØªÙ‡",n.appendChild(o)}if(e.isMakeup){const o=document.createElement("span");o.className="type-badge makeup-badge",o.textContent="Ø¬Ø¨Ø±Ø§Ù†ÛŒ",n.appendChild(o)}return t.appendChild(n),t}function ic(e,s){const t=document.createElement("li"),c=s.get(e.sessionNumber),a=sc(e,c);t.appendChild(a);const n=nc(e,c);return t.appendChild(n),t.addEventListener("contextmenu",r=>{const i=[{label:"ÛŒØ§Ø¯Ø¯Ø§Ø´Øª Ø¬Ù„Ø³Ù‡",icon:"ðŸ“",action:()=>{Ai(e,c)}},{label:e.isCancelled?"Ø¨Ø§Ø²Ú¯Ø±Ø¯Ø§Ù†ÛŒ Ø¬Ù„Ø³Ù‡":"Ù„ØºÙˆ Ø¬Ù„Ø³Ù‡",icon:"âŒ",action:()=>{const o=e.isCancelled?"Ø¨Ø§Ø²Ú¯Ø±Ø¯Ø§Ù†ÛŒ Ø¬Ù„Ø³Ù‡":"Ù„ØºÙˆ Ø¬Ù„Ø³Ù‡",l=e.isCancelled?"Ø¢ÛŒØ§ Ø§Ø² Ø¨Ø§Ø²Ú¯Ø±Ø¯Ø§Ù†ÛŒ Ø§ÛŒÙ† Ø¬Ù„Ø³Ù‡ Ù…Ø·Ù…Ø¦Ù† Ù‡Ø³ØªÛŒØ¯ØŸ":"Ø¢ÛŒØ§ Ø§Ø² Ù„ØºÙˆ Ø§ÛŒÙ† Ø¬Ù„Ø³Ù‡ Ù…Ø·Ù…Ø¦Ù† Ù‡Ø³ØªÛŒØ¯ØŸ Ø¬Ù„Ø³Ù‡ Ù„ØºÙˆ Ø´Ø¯Ù‡ Ø¯Ø± Ø¢Ù…Ø§Ø± ØªØ§Ø«ÛŒØ±ÛŒ Ù†Ø¯Ø§Ø±Ø¯ Ø§Ù…Ø§ Ù‚Ø§Ø¨Ù„ Ø¨Ø§Ø²Ú¯Ø±Ø¯Ø§Ù†ÛŒ Ø§Ø³Øª.";ge(l,()=>{e.isCancelled=!e.isCancelled;const f=e.isCancelled?`Ø¬Ù„Ø³Ù‡ ${c} Ù„ØºÙˆ Ø´Ø¯.`:`Ø¬Ù„Ø³Ù‡ Ù„ØºÙˆ Ø´Ø¯Ù‡ (ØªØ§Ø±ÛŒØ®: ${new Date(e.startTime).toLocaleDateString("fa-IR")}) Ø¨Ø§Ø²Ú¯Ø±Ø¯Ø§Ù†ÛŒ Ø´Ø¯.`;Ce(N.info.name,f,{type:"VIEW_SESSIONS"}),se(),qe(),j(e.isCancelled?"âœ…Ø¬Ù„Ø³Ù‡ Ù„ØºÙˆ Ø´Ø¯.":"âœ…Ø¬Ù„Ø³Ù‡ Ø¨Ø§Ø²Ú¯Ø±Ø¯Ø§Ù†ÛŒ Ø´Ø¯.")},{confirmText:o,confirmClass:"btn-warning"})}},{label:"ØªØºÛŒÛŒØ± ÙˆØ¶Ø¹ÛŒØª Ø¬Ø¨Ø±Ø§Ù†ÛŒ",icon:"ðŸ”„",action:()=>{N.markAsMakeup(e.sessionNumber),se();const o=e.isMakeup?`Ø¬Ù„Ø³Ù‡ ${c} Ø¨Ù‡ Ø¹Ù†ÙˆØ§Ù† Ø¬Ø¨Ø±Ø§Ù†ÛŒ Ø¹Ù„Ø§Ù…Øªâ€ŒÚ¯Ø°Ø§Ø±ÛŒ Ø´Ø¯.`:`Ø¬Ù„Ø³Ù‡ ${c} Ø§Ø² Ø­Ø§Ù„Øª Ø¬Ø¨Ø±Ø§Ù†ÛŒ Ø®Ø§Ø±Ø¬ Ø´Ø¯.`;Ce(N.info.name,o,{type:"VIEW_SESSIONS"}),qe()}},{label:"Ø­Ø°Ù Ø¬Ù„Ø³Ù‡",icon:"ðŸ—‘ï¸",className:"danger",action:()=>{const o=e.isCancelled?"Ù„ØºÙˆ Ø´Ø¯Ù‡":c;ge(`Ø¢ÛŒØ§ Ø§Ø² Ø§Ù†ØªÙ‚Ø§Ù„ Ø¬Ù„Ø³Ù‡ ${o} Ø¨Ù‡ Ø³Ø·Ù„ Ø²Ø¨Ø§Ù„Ù‡ Ù…Ø·Ù…Ø¦Ù† Ù‡Ø³ØªÛŒØ¯ØŸ`,()=>{const l={id:`trash_${Date.now()}_${Math.random()}`,timestamp:new Date().toISOString(),type:"session",description:`Ø¬Ù„Ø³Ù‡ ${o} Ø§Ø² Ú©Ù„Ø§Ø³ Â«${N.info.name}Â»`,restoreData:{sessionNumber:e.sessionNumber,classId:N.info.scheduleCode}};lt(l),e.isDeleted=!0,Ce(N.info.name,`Ø¬Ù„Ø³Ù‡ ${o} Ø¨Ù‡ Ø³Ø·Ù„ Ø²Ø¨Ø§Ù„Ù‡ Ù…Ù†ØªÙ‚Ù„ Ø´Ø¯.`,{type:"VIEW_TRASH"}),se(),qe(),j(`âœ… Ø¬Ù„Ø³Ù‡ ${o} Ø¨Ù‡ Ø³Ø·Ù„ Ø²Ø¨Ø§Ù„Ù‡ Ù…Ù†ØªÙ‚Ù„ Ø´Ø¯.`)},{confirmText:"Ø¨Ù„Ù‡",confirmClass:"btn-warning",isDelete:!0})}},{label:"ØªØºÛŒÛŒØ± ØªØ§Ø±ÛŒØ®",icon:"ðŸ“…",action:()=>{const o=document.getElementById("dp-day"),l=document.getElementById("dp-month"),f=document.getElementById("dp-year"),p=qi.toJalaali(e.startTime);o.innerHTML="";for(let y=1;y<=31;y++){const u=document.createElement("option");u.value=y,u.textContent=y.toLocaleString("fa-IR"),y===p.jd&&(u.selected=!0),o.appendChild(u)}const m=["ÙØ±ÙˆØ±Ø¯ÛŒÙ†","Ø§Ø±Ø¯ÛŒØ¨Ù‡Ø´Øª","Ø®Ø±Ø¯Ø§Ø¯","ØªÛŒØ±","Ù…Ø±Ø¯Ø§Ø¯","Ø´Ù‡Ø±ÛŒÙˆØ±","Ù…Ù‡Ø±","Ø¢Ø¨Ø§Ù†","Ø¢Ø°Ø±","Ø¯ÛŒ","Ø¨Ù‡Ù…Ù†","Ø§Ø³ÙÙ†Ø¯"];l.innerHTML="",m.forEach((y,u)=>{const v=document.createElement("option");v.value=u+1,v.textContent=y,u+1===p.jm&&(v.selected=!0),l.appendChild(v)}),f.innerHTML="";const h=p.jy;for(let y=h-5;y<=h+5;y++){const u=document.createElement("option");u.value=y,u.textContent=y.toString().replace(/\d/g,v=>"Û°Û±Û²Û³Û´ÛµÛ¶Û·Û¸Û¹"[v]),y===p.jy&&(u.selected=!0),f.appendChild(u)}ss(y=>{if(!y)return;const u=qi.toGregorian(parseInt(y.jy),parseInt(y.jm),parseInt(y.jd)),v=new Date(u.gy,u.gm-1,u.gd);v.setHours(e.startTime.getHours()),v.setMinutes(e.startTime.getMinutes()),v.setSeconds(e.startTime.getSeconds());const b=e.startTime.toLocaleDateString("fa-IR");e.startTime=v;const C=e.startTime.toLocaleDateString("fa-IR");Ce(N.info.name,`ØªØ§Ø±ÛŒØ® Ø¬Ù„Ø³Ù‡ ${c} Ø§Ø² ${b} Ø¨Ù‡ ${C} ØªØºÛŒÛŒØ± ÛŒØ§ÙØª.`,{type:"VIEW_SESSIONS"}),se(),qe(),j(`âœ… ØªØ§Ø±ÛŒØ® Ø¬Ù„Ø³Ù‡ Ø¨Ù‡ ${C} ØªØºÛŒÛŒØ± ÛŒØ§ÙØª.`)}),Te("date-picker-modal")}}];Bn(r,i)}),t}function qe(){const e=document.getElementById("session-list");if(!N)return;if(e.innerHTML="",N.sessions.length===0){e.innerHTML="<li>Ù‡Ù†ÙˆØ² Ø¬Ù„Ø³Ù‡â€ŒØ§ÛŒ Ø´Ø±ÙˆØ¹ Ù†Ø´Ø¯Ù‡ Ø§Ø³Øª.</li>";return}const s=dt(N);[...ye(N.sessions)].reverse().forEach(c=>{const a=ic(c,s);e.appendChild(a)})}function dn(e){if(St.innerHTML="",e.length>0)e.forEach(s=>{const t=document.createElement("div");t.textContent=s.identity.name,t.addEventListener("click",()=>{We(s),St.style.display="none",$s.value=""}),St.appendChild(t)}),St.style.display="block";else if($s.value.trim()!==""){const s=document.createElement("div");s.className="no-results",s.textContent="Ù¾ÛŒØ¯Ø§ Ù†Ø´Ø¯",St.appendChild(s),St.style.display="block"}else St.style.display="none"}function Gn(e){if(mt.innerHTML="",e.length>0)e.forEach(s=>{const t=document.createElement("div");if(t.className="global-search-result",s.type==="student"){const c=document.createElement("span");c.className="student-name",c.textContent=s.student.identity.name;const a=document.createElement("span");a.className="class-name",a.textContent=`Ú©Ù„Ø§Ø³: ${s.classroom.info.name}`,t.addEventListener("click",()=>{Ge(s.classroom),We(s.student),mt.style.display="none",on.value=""}),a.addEventListener("click",n=>{n.stopPropagation(),Ge(s.classroom),at(null),yn(s.classroom.liveSession),qe(),Se("session-page"),mt.style.display="none",on.value=""}),t.appendChild(c),t.appendChild(a)}else if(s.type==="classroom"){const c=document.createElement("span");c.className="student-name",c.textContent=`[Ú©Ù„Ø§Ø³] ${s.classroom.info.name}`,t.addEventListener("click",()=>{Ge(s.classroom),at(null),yn(s.classroom.liveSession),qe(),Se("session-page"),mt.style.display="none",on.value=""}),t.appendChild(c)}mt.appendChild(t)}),mt.style.display="block";else if(on.value.trim()!==""){const s=document.createElement("div");s.className="no-results",s.textContent="Ù¾ÛŒØ¯Ø§ Ù†Ø´Ø¯",mt.appendChild(s),mt.style.display="block"}else mt.style.display="none"}function In(){const e=document.getElementById("trashed-items-list");if(e.innerHTML="",Ue.length===0){e.innerHTML='<li style="text-align: center; padding: 20px;">Ø³Ø·Ù„ Ø²Ø¨Ø§Ù„Ù‡ Ø®Ø§Ù„ÛŒ Ø§Ø³Øª.</li>';return}Ue.forEach((s,t)=>{const c=document.createElement("li"),a=document.createElement("span");a.textContent=s.description,a.style.flexGrow="1";const n=document.createElement("div");n.className="list-item-buttons";const r=document.createElement("button");r.className="btn-icon",r.innerHTML="ðŸ”„",r.title="Ø¨Ø§Ø²ÛŒØ§Ø¨ÛŒ",r.addEventListener("click",()=>{var p;let o=!1,l=null;const f=s.restoreData;switch(s.type){case"classroom":{const m=ie[f.name];m&&!m.isDeleted?l=`Ú©Ù„Ø§Ø³ÛŒ Ø¨Ø§ Ù†Ø§Ù… Â«${f.name}Â» Ø§Ø² Ù‚Ø¨Ù„ ÙØ¹Ø§Ù„ Ø§Ø³Øª.`:m&&m.isDeleted&&(m.isDeleted=!1,o=!0);break}case"student":{const m=Object.values(ie).find(y=>y.info.scheduleCode===f.classId),h=m==null?void 0:m.students.find(y=>y.identity.studentId===f.studentId);h&&(h.isDeleted=!1,o=!0);break}case"session":{const m=Object.values(ie).find(y=>y.info.scheduleCode===f.classId),h=m==null?void 0:m.sessions.find(y=>y.sessionNumber===f.sessionNumber);h&&(h.isDeleted=!1,o=!0);break}case"category":{const m=Object.values(ie).find(y=>y.info.scheduleCode===f.classId),h=m==null?void 0:m.categories.find(y=>y.id===f.categoryId);h&&(h.isDeleted=!1,o=!0);break}case"score":{const m=Object.values(ie).find(u=>u.info.scheduleCode===f.classId),h=m==null?void 0:m.students.find(u=>u.identity.studentId===f.studentId),y=(p=h==null?void 0:h.logs.scores[f.skill.toLowerCase()])==null?void 0:p.find(u=>u.id===f.scoreId);y&&(y.isDeleted=!1,o=!0);break}case"note":{const m=Object.values(ie).find(u=>u.info.scheduleCode===f.classId),h=m==null?void 0:m.students.find(u=>u.identity.studentId===f.studentId),y=h==null?void 0:h.profile.notes.find(u=>u.id===f.noteId);y&&(y.isDeleted=!1,o=!0);break}}o?(Ue.splice(t,1),se(),In(),s.type==="classroom"&&He(),j("âœ… Ø¢ÛŒØªÙ… Ø¨Ø§ Ù…ÙˆÙÙ‚ÛŒØª Ø¨Ø§Ø²ÛŒØ§Ø¨ÛŒ Ø´Ø¯.")):j(l?`âš ï¸ ${l}`:"âš ï¸ Ø¢ÛŒØªÙ… Ø§ØµÙ„ÛŒ Ø¨Ø±Ø§ÛŒ Ø¨Ø§Ø²ÛŒØ§Ø¨ÛŒ ÛŒØ§ÙØª Ù†Ø´Ø¯.")});const i=document.createElement("button");i.className="btn-icon",i.innerHTML="ðŸ”¥",i.title="Ø­Ø°Ù Ø¯Ø§Ø¦Ù…ÛŒ",i.addEventListener("click",()=>{ge("Ø¢ÛŒØ§ Ø§Ø² Ø­Ø°Ù Ø¯Ø§Ø¦Ù…ÛŒ Ø§ÛŒÙ† Ø¢ÛŒØªÙ… Ù…Ø·Ù…Ø¦Ù† Ù‡Ø³ØªÛŒØ¯ØŸ Ø§ÛŒÙ† Ø¹Ù…Ù„ ØºÛŒØ±Ù‚Ø§Ø¨Ù„ Ø¨Ø§Ø²gØ´Øª Ø§Ø³Øª.",()=>{const o=s.restoreData,l=p=>Object.values(ie).find(m=>m.info.scheduleCode===p);let f;switch(s.type){case"classroom":delete ie[o.name];break;case"student":f=l(o.classId),ps({identity:{studentId:o.studentId}},f);break;case"session":f=l(o.classId),f&&li(f.info.name,o.sessionNumber);break;case"category":f=l(o.classId),f&&di(f.info.name,o.categoryId);break;case"score":f=l(o.classId),f&&ui(f.info.name,o.studentId,o.skill,o.scoreId);break;case"note":f=l(o.classId),f&&fi(f.info.name,o.studentId,o.noteId);break}Ue.splice(t,1),se(),In(),j("âœ… Ø¢ÛŒØªÙ… Ø¨Ø±Ø§ÛŒ Ù‡Ù…ÛŒØ´Ù‡ Ø­Ø°Ù Ø´Ø¯.")},{confirmText:"Ø­Ø°Ù Ø¯Ø§Ø¦Ù…ÛŒ",confirmClass:"btn-warning"})}),n.appendChild(r),n.appendChild(i),c.appendChild(a),c.appendChild(n),e.appendChild(c)})}function ac(){const e=document.getElementById("absentees-summary-container");e&&(e.innerHTML=`
        <div id="absentees-summary-box" class="absentees-summary">
            <div class="absentees-summary-header">
                <h4>Ù„ÛŒØ³Øª ØºØ§ÛŒØ¨ÛŒÙ† Ø¬Ù„Ø³Ù‡ Ø´Ù…Ø§Ø±Ù‡ <span id="absentee-summary-session-number"></span></h4>
                <button id="copy-absentees-btn" class="btn-icon" title="Ú©Ù¾ÛŒ Ù„ÛŒØ³Øª ØºØ§ÛŒØ¨ÛŒÙ†">ðŸ“‹</button>
            </div>
            <div id="absentees-summary-list" class="summary-list"></div>
            <div class="attendance-counters">
                <span>ØªØ¹Ø¯Ø§Ø¯ Ø­Ø§Ø¶Ø±ÛŒÙ†: <strong id="present-count">0</strong></span>
                <span>ØªØ¹Ø¯Ø§Ø¯ ØºØ§ÛŒØ¨ÛŒÙ†: <strong id="absent-count">0</strong></span>
            </div>
        </div>
    `)}function cr(){const e=document.getElementById("absentees-summary-box"),s=document.getElementById("absentees-summary-list"),t=document.getElementById("absentee-summary-session-number");if(!e||!s||!t){console.error("Could not find all absentee summary elements.");return}if(!N||!K){e.classList.remove("visible");return}const c=ye(N.students).filter(f=>{const p=K.studentRecords[f.identity.studentId];return p&&p.attendance==="absent"}),a=ye(N.students),n=c.length,r=a.length-n,i=document.getElementById("present-count"),o=document.getElementById("absent-count");i&&(i.textContent=r.toLocaleString("fa-IR")),o&&(o.textContent=n.toLocaleString("fa-IR"));const l=dt(N);t.textContent=l.get(K.sessionNumber),c.length>0?e.classList.add("visible"):e.classList.remove("visible"),s.innerHTML="",c.forEach(f=>{const m=(y=>N.sessions.reduce((u,v)=>{if(v.isDeleted||v.isCancelled)return u;const b=v.studentRecords[y.identity.studentId];return u+(b&&b.attendance==="absent"?1:0)},0))(f),h=document.createElement("span");h.className="summary-name",h.textContent=`${f.identity.name} (ØºÛŒØ¨Øª: ${m})`,h.addEventListener("click",()=>{h.classList.add("fading-out"),setTimeout(()=>{K.setAttendance(f.identity.studentId,"present"),se(),rt()},200)}),s.appendChild(h)})}function rc(){const e=document.getElementById("copy-absentees-btn");if(!e){console.error("Could not find the copy absentees button to attach listener.");return}e.addEventListener("click",()=>{if(!N||!K)return;const s=ye(N.students).filter(i=>{const o=K.studentRecords[i.identity.studentId];return o&&o.attendance==="absent"});if(s.length===0){j("âš ï¸Ù„ÛŒØ³Øª ØºØ§ÛŒØ¨ÛŒÙ† Ø®Ø§Ù„ÛŒ Ø§Ø³Øª.");return}const t=i=>N.sessions.reduce((o,l)=>{if(l.isDeleted||l.isCancelled)return o;const f=l.studentRecords[i.identity.studentId];return o+(f&&f.attendance==="absent"?1:0)},0),c=ye(N.students),a=s.length,n=c.length-a;let r=`Ú¯Ø²Ø§Ø±Ø´ Ø­Ø¶ÙˆØ± Ùˆ ØºÛŒØ§Ø¨ Ø¬Ù„Ø³Ù‡ Ø´Ù…Ø§Ø±Ù‡ ${Vo()}:
`;r+=`âœ… Ø­Ø§Ø¶Ø±ÛŒÙ†: ${n.toLocaleString("fa-IR")}
`,r+=`âŒ ØºØ§ÛŒØ¨ÛŒÙ†: ${a.toLocaleString("fa-IR")}

`,r+=`Ù„ÛŒØ³Øª Ø§Ø³Ø§Ù…ÛŒ ØºØ§ÛŒØ¨ÛŒÙ†:
`,s.forEach(i=>{const o=t(i);r+=`- ${i.identity.name} (ØªØ¹Ø¯Ø§Ø¯ ØºÛŒØ¨Øªâ€ŒÙ‡Ø§: ${o})
`}),navigator.clipboard.writeText(r).then(()=>{j("âœ…Ù„ÛŒØ³Øª ØºØ§ÛŒØ¨ÛŒÙ† Ø¨Ø§ Ù…ÙˆÙÙ‚ÛŒØª Ú©Ù¾ÛŒ Ø´Ø¯.")}).catch(i=>{console.error("Failed to copy text: ",i),j("âŒØ®Ø·Ø§ Ø¯Ø± Ú©Ù¾ÛŒ Ú©Ø±Ø¯Ù† Ù„ÛŒØ³Øª.")})})}function fs(){const e=document.getElementById("demo-mode-banner");e&&(yt?(e.classList.add("visible"),document.body.classList.add("demo-mode-active")):(e.classList.remove("visible"),document.body.classList.remove("demo-mode-active")))}function ms(e){const{scheduleDays:s,scheduleStartTime:t,scheduleEndTime:c}=e.info,a=s&&s.length>0,n=t&&c;if(!a&&!n)return{type:"unscheduled",sortIndex:3};if(!a||!n)return{type:"incomplete",sortIndex:2};const r=new Date,i=r.getDay(),o=r.getHours()*60+r.getMinutes(),[l,f]=t.split(":").map(Number),[p,m]=c.split(":").map(Number),h=l*60+f,y=p*60+m;if(s.includes(i)&&o>=h&&o<y)return{type:"active",sortIndex:0};for(let u=0;u<=7;u++){const v=(i+u)%7;if(s.includes(v)){if(u===0&&o>=h)continue;const b=new Date(r);return b.setDate(r.getDate()+u),b.setHours(l,f,0,0),{type:"upcoming",sortIndex:1,nextTimestamp:b.getTime()}}}return{type:"upcoming",sortIndex:1,nextTimestamp:9999999999999}}function oc(e,s){const{scheduleDays:t,scheduleStartTime:c,scheduleEndTime:a}=e.info;if(!t||!t.length||!c||!a)return null;const[n,r]=c.split(":").map(Number),[i,o]=a.split(":").map(Number),l=n*60+r,f=i*60+o;for(const p of Object.values(s)){if(p===e||p.isDeleted||p.info.name===e.info.name)continue;const m=p.info;if(!m.scheduleDays||!m.scheduleDays.length||!m.scheduleStartTime||!m.scheduleEndTime||!t.some(_=>m.scheduleDays.includes(_)))continue;const[y,u]=m.scheduleStartTime.split(":").map(Number),[v,b]=m.scheduleEndTime.split(":").map(Number),C=y*60+u,S=v*60+b;if(l<S&&f>C)return p.info.name}return null}function cc(e){if(!e||e.length===0)return"";const s={6:"Ø´Ù†Ø¨Ù‡",0:"Û±Ø´Ù†Ø¨Ù‡",1:"Û²Ø´Ù†Ø¨Ù‡",2:"Û³Ø´Ù†Ø¨Ù‡",3:"Û´Ø´Ù†Ø¨Ù‡",4:"ÛµØ´Ù†Ø¨Ù‡",5:"Ø¬Ù…Ø¹Ù‡"};return[...e].sort((c,a)=>{const n={6:0,0:1,1:2,2:3,3:4,4:5,5:6};return n[c]-n[a]}).map(c=>s[c]).join("ØŒ ")}async function lr(){const e=document.getElementById("restore-points-list");e.innerHTML='<li style="text-align:center; padding:20px;">Ø¯Ø± Ø­Ø§Ù„ Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ...</li>';try{const s=await Ca();if(s.length===0){e.innerHTML='<li style="text-align:center; padding:20px;">Ù‡ÛŒÚ† ÙØ§ÛŒÙ„ Ù¾Ø´ØªÛŒØ¨Ø§Ù†ÛŒ ÛŒØ§ÙØª Ù†Ø´Ø¯.</li>';return}e.innerHTML="",s.forEach(t=>{const c=document.createElement("li");c.className="restore-point-card";const a=new Date(t.timestamp).toLocaleString("fa-IR",{weekday:"long",year:"numeric",month:"numeric",day:"numeric",hour:"2-digit",minute:"2-digit"}),n=(t.file.size/1024).toFixed(1)+" KB";c.innerHTML=`
                <div class="restore-card-header">
                    <span class="restore-date">${a}</span>
                    <span class="restore-size">${n}</span>
                </div>
                <div class="restore-desc">${t.metadata.description||"Ø¨Ø¯ÙˆÙ† ØªÙˆØ¶ÛŒØ­Ø§Øª"}</div>
                <div class="restore-actions">
                    <button class="btn-restore-action">Ø¨Ø§Ø²Ú¯Ø±Ø¯Ø§Ù†ÛŒ</button>
                </div>
            `,c.querySelector(".btn-restore-action").addEventListener("click",async()=>{try{const i=await t.file.text(),f=(await new Ci().loadAsync(i,{base64:!0})).file("backup.json");if(!f)throw new Error("ÙØ§ÛŒÙ„ backup.json ÛŒØ§ÙØª Ù†Ø´Ø¯.");const p=await f.async("string"),m=JSON.parse(p);ds(m)}catch(i){console.error("Restore failed:",i),j("âŒ ÙØ§ÛŒÙ„ Ù¾Ø´ØªÛŒØ¨Ø§Ù† Ù…Ø¹ØªØ¨Ø± Ù†ÛŒØ³Øª.")}}),e.appendChild(c)})}catch(s){console.error("Failed to load snapshots:",s),e.innerHTML='<li style="text-align:center; color:red;">Ø®Ø·Ø§ Ø¯Ø± Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ Ø§Ø·Ù„Ø§Ø¹Ø§Øª.</li>'}}function Zi(e,s){const t=document.createElement("div");t.className="qualitative-button-container";const c=tt,a=c!==-1&&K.winnerHistory[c],n=a?K.winnerHistory[c]:null,r=K.studentRecords[e.identity.studentId];e.qualitativeStats||(e.qualitativeStats={}),e.qualitativeStats[s]||(e.qualitativeStats[s]={effort:0,good:0,excellent:0}),r.performanceRatings||(r.performanceRatings={});const i=a?n.rating:r.performanceRatings[s],o=K.isFinished||r.attendance==="absent"||r.hadIssue||r.wasOutOfClass;return[{key:"effort",label:"ØªÙ„Ø§Ø´",className:"effort-btn"},{key:"good",label:"Ø®ÙˆØ¨",className:"good-btn"},{key:"excellent",label:"Ø¹Ø§Ù„ÛŒ",className:"excellent-btn"}].forEach(f=>{const p=document.createElement("button");p.className=`qualitative-btn ${f.className}`,p.textContent=f.label,p.disabled=o,i===f.key&&p.classList.add("active"),p.addEventListener("click",()=>{const m=f.key;i&&e.qualitativeStats[s][i]>0&&e.qualitativeStats[s][i]--,i!==m&&(e.qualitativeStats[s][m]=(e.qualitativeStats[s][m]||0)+1);const h=i===m?null:m;a?n.rating=h:h?r.performanceRatings[s]=h:delete r.performanceRatings[s],se(),Re()}),t.appendChild(p)}),t}function Ri(e,s,t="custom",c=null){e.innerHTML="",Object.values(Dt).forEach(n=>{const r=document.createElement("option");r.value=n.id,r.textContent=n.label,e.appendChild(r)}),e.value=t;const a=n=>{s.innerHTML="";const r=Dt[n];if(r&&r.levels.length>0)r.levels.forEach(i=>{const o=document.createElement("option");o.value=i,o.textContent=i,s.appendChild(o)}),s.disabled=!1;else{const i=document.createElement("option");i.value="",i.textContent="---",s.appendChild(i),s.disabled=!0}};a(t),c&&(s.value=c),e.onchange=()=>{a(e.value),s.dispatchEvent(new Event("change"))}}function dr(){Sn.value="",Ri(Ii,xi,"custom"),Te("add-class-modal");const e=[{label:"Ø´Ù†Ø¨Ù‡",value:6},{label:"ÛŒÚ©Ø´Ù†Ø¨Ù‡",value:0},{label:"Ø¯ÙˆØ´Ù†Ø¨Ù‡",value:1},{label:"Ø³Ù‡â€ŒØ´Ù†Ø¨Ù‡",value:2},{label:"Ú†Ù‡Ø§Ø±Ø´Ù†Ø¨Ù‡",value:3},{label:"Ù¾Ù†Ø¬â€ŒØ´Ù†Ø¨Ù‡",value:4},{label:"Ø¬Ù…Ø¹Ù‡",value:5}];cs.innerHTML="",e.forEach(s=>{const t=document.createElement("label"),c=document.createElement("input");c.type="checkbox",c.value=s.value,t.appendChild(c),t.appendChild(document.createTextNode(s.label)),cs.appendChild(t)}),ln.addEventListener("click",()=>{ln.classList.toggle("open"),Ka.classList.toggle("open");const s=ln.querySelector(".arrow");s.textContent=ln.classList.contains("open")?"â–¼":"â–¶"}),Sn.focus()}function ur(){Vt.value="",_n.checked=!1,ls.value=1,hn.style.visibility="hidden",Te("category-modal"),Vt.focus()}function Gs(){fe()}function lc(e,s){let t,c;if(e&&s)t=e,c=s,Jt({student:e,categoryName:s}),bt(-1);else{if(Jt(null),Xt(null),!K||tt<0||!K.winnerHistory[tt])return null;const a=K.winnerHistory[tt];t=a.winner,c=a.categoryName}return{winner:t,categoryName:c}}function dc(e,s){const t=document.getElementById("selected-student-result");t.innerHTML="",t.classList.remove("absent");const c=document.querySelector(".current-winner-highlight");if(c&&c.classList.remove("current-winner-highlight"),e){const n=document.querySelector(`.student-stats-table tr[data-student-id="${e.identity.studentId}"]`);n&&n.classList.add("current-winner-highlight")}const a=N.categories.find(n=>n.name===s);if(a){ns(a),Oi(a),js(a),kn(a),Xt(a.name);const n=document.querySelectorAll("#category-selection-container .pill");n.forEach(i=>i.classList.remove("active"));const r=Array.from(n).find(i=>i.textContent===s);r&&r.classList.add("active")}}function uc(e,s,t){const c=document.createElement("div");c.className="winner-name-container";const a=document.createElement("button");a.className="btn-icon",a.innerHTML="Ë…",a.title="Ø¨Ø±Ù†Ø¯Ù‡ Ù‚Ø¨Ù„ÛŒ",a.classList.toggle("is-disabled",!t||tt<=0),a.addEventListener("click",()=>{a.classList.contains("is-disabled")?(a.classList.add("shake-animation"),setTimeout(()=>a.classList.remove("shake-animation"),200)):(bt(tt-1),Re())});const n=K.studentRecords[e.identity.studentId],r=(n==null?void 0:n.attendance)==="absent",i=document.createElement("div");i.className="winner-name",i.innerHTML=`âœ¨ <strong>${e.identity.name}</strong>âœ¨`,i.classList.add("heartbeat-animation"),r?(i.style.textDecoration="line-through",i.style.opacity="0.6",i.style.color="var(--color-secondary)"):n!=null&&n.hadIssue?(i.style.color="var(--color-warning)",i.title="Ø§ÛŒÙ† Ø¯Ø§Ù†Ø´â€ŒØ¢Ù…ÙˆØ² Ø¯Ø± Ø§Ù†ØªØ®Ø§Ø¨ Ù‚Ø¨Ù„ÛŒ Ø¨Ø§ Ù…Ø´Ú©Ù„ Ù…ÙˆØ§Ø¬Ù‡ Ø´Ø¯Ù‡ Ø¨ÙˆØ¯"):n!=null&&n.wasOutOfClass&&(i.style.color="var(--color-strong-warning)",i.title="Ø§ÛŒÙ† Ø¯Ø§Ù†Ø´â€ŒØ¢Ù…ÙˆØ² Ø¯Ø± Ø²Ù…Ø§Ù† Ø§Ù†ØªØ®Ø§Ø¨ Ø®Ø§Ø±Ø¬ Ø§Ø² Ú©Ù„Ø§Ø³ Ø¨ÙˆØ¯");const o=()=>{nn=setTimeout(()=>{mr(e,s),nn=null},1e3)},l=()=>{nn&&(clearTimeout(nn),nn=null)};["mousedown","touchstart"].forEach(m=>i.addEventListener(m,o)),["mouseup","mouseout","touchend","touchcancel","touchmove"].forEach(m=>i.addEventListener(m,l));const f=document.createElement("button");if(f.className="btn-icon",f.innerHTML="Ë„",f.title="Ø¨Ø±Ù†Ø¯Ù‡ Ø¨Ø¹Ø¯ÛŒ",f.classList.toggle("is-disabled",!t||tt>=K.winnerHistory.length-1),f.addEventListener("click",()=>{f.classList.contains("is-disabled")?(f.classList.add("shake-animation"),setTimeout(()=>f.classList.remove("shake-animation"),200)):(bt(tt+1),Re())}),c.appendChild(f),c.appendChild(i),e.onboardingSession===K.sessionNumber){const m=document.createElement("div");m.className="new-student-badge",m.textContent="Ø¯Ø§Ù†Ø´ Ø¢Ù…ÙˆØ² Ø¬Ø¯ÛŒØ¯",c.appendChild(m)}c.appendChild(a);const p=document.getElementById("select-student-btn");return p&&(p.disabled=t&&!f.classList.contains("is-disabled")),{nameContainer:c,winnerNameEl:i}}function fc(e,s,t){const c=document.createElement("div");c.className="status-button-container";const a=document.createElement("button");a.textContent="ØºØ§ÛŒØ¨",a.classList.add("status-button","absent-btn"),(s==null?void 0:s.attendance)==="absent"&&a.classList.add("active");const n=document.createElement("button");n.textContent="Ù…Ø´Ú©Ù„",n.classList.add("status-button","issue-btn"),s!=null&&s.hadIssue&&n.classList.add("active");const r=document.createElement("button");r.textContent="Ø®Ø±ÙˆØ¬",r.classList.add("status-button","exit-btn"),s!=null&&s.wasOutOfClass&&r.classList.add("active");const i=document.createElement("button");i.textContent="Ù¾Ø±ÙˆÙØ§ÛŒÙ„",i.className="status-button profile-btn";const o=()=>{Oe(),setTimeout(()=>{tt!==-1?Re():Re(e,t)},0),se()};return K.isFinished?[a,n,r,i].forEach(l=>l.disabled=!0):(a.addEventListener("click",()=>{const l=a.classList.contains("active");r.classList.contains("active")&&(r.classList.remove("active"),s.wasOutOfClass=!1,e.statusCounters.outOfClassCount=Math.max(0,(e.statusCounters.outOfClassCount||0)-1),e.statusCounters.missedChances=Math.max(0,e.statusCounters.missedChances-1)),l?(a.classList.remove("active"),K.setAttendance(e.identity.studentId,"present"),e.statusCounters.missedChances=Math.max(0,e.statusCounters.missedChances-1)):(n.classList.contains("active")&&(n.classList.remove("active"),s.hadIssue=!1,e.statusCounters.otherIssues=Math.max(0,e.statusCounters.otherIssues-1),e.statusCounters.missedChances=Math.max(0,e.statusCounters.missedChances-1)),a.classList.add("active"),K.setAttendance(e.identity.studentId,"absent"),e.statusCounters.missedChances++),o()}),n.addEventListener("click",()=>{const l=n.classList.contains("active");r.classList.contains("active")&&(r.classList.remove("active"),s.wasOutOfClass=!1,e.statusCounters.outOfClassCount=Math.max(0,(e.statusCounters.outOfClassCount||0)-1),e.statusCounters.missedChances=Math.max(0,e.statusCounters.missedChances-1)),l?(n.classList.remove("active"),s.hadIssue=!1,e.categoryIssues[t]&&(e.categoryIssues[t]=Math.max(0,e.categoryIssues[t]-1)),e.statusCounters.missedChances=Math.max(0,e.statusCounters.missedChances-1)):(a.classList.contains("active")&&(a.classList.remove("active"),K.setAttendance(e.identity.studentId,"present"),e.statusCounters.missedChances=Math.max(0,e.statusCounters.missedChances-1)),n.classList.add("active"),s.hadIssue=!0,e.categoryIssues[t]=(e.categoryIssues[t]||0)+1,e.statusCounters.missedChances++),o()}),r.addEventListener("click",()=>{r.classList.contains("active")?(r.classList.remove("active"),s.wasOutOfClass=!1,e.statusCounters.outOfClassCount=Math.max(0,(e.statusCounters.outOfClassCount||0)-1),e.statusCounters.missedChances=Math.max(0,e.statusCounters.missedChances-1)):(a.classList.contains("active")&&(a.classList.remove("active"),K.setAttendance(e.identity.studentId,"present"),e.statusCounters.missedChances=Math.max(0,e.statusCounters.missedChances-1)),n.classList.contains("active")&&(n.classList.remove("active"),s.hadIssue=!1,e.categoryIssues[t]&&(e.categoryIssues[t]=Math.max(0,e.categoryIssues[t]-1)),e.statusCounters.missedChances=Math.max(0,e.statusCounters.missedChances-1)),r.classList.add("active"),s.wasOutOfClass=!0,e.statusCounters.outOfClassCount=(e.statusCounters.outOfClassCount||0)+1,e.statusCounters.missedChances++),o()}),i.addEventListener("click",()=>{We(e)})),c.appendChild(a),c.appendChild(r),c.appendChild(n),c.appendChild(i),c}function mc(e,s){const t=document.createElement("div");t.className="student-details-container";const c=document.createElement("div");c.className="student-details-scores",c.innerHTML="<h4>Ø¢Ø®Ø±ÛŒÙ† Ù†Ù…Ø±Ø§Øª</h4>";const a=document.createElement("ul");a.className="scores-list";const n=N.categories.filter(h=>h.isGradedCategory&&!h.isDeleted);let r=!1;const i=e.logs.scores||{};n.forEach(h=>{var _;const y=h.name,u=y.toLowerCase(),v=(_=i[u])==null?void 0:_.filter(k=>!k.isDeleted),b=document.createElement("li"),C=document.createElement("span");C.className="skill-name",C.textContent=`${y}:`;const S=document.createElement("span");if(S.className="skill-scores",v&&v.length>0){r=!0;const k=v.slice(-3);k.forEach((x,L)=>{const B=document.createElement("span");B.textContent=x.value+(x.comment?"'":""),x.comment&&(B.dataset.tooltip=x.comment,B.style.position="relative",B.style.cursor="help",B.classList.add("tooltip-container")),S.appendChild(B),L<k.length-1&&S.appendChild(document.createTextNode(","))})}else S.textContent="none";b.appendChild(C),b.appendChild(S),a.appendChild(b)}),r||(a.innerHTML='<div class="no-content-message">Ù‡Ù†ÙˆØ² Ù†Ù…Ø±Ù‡â€ŒØ§ÛŒ Ø«Ø¨Øª Ù†Ø´Ø¯Ù‡ Ø§Ø³Øª.</div>'),c.appendChild(a),t.appendChild(c);const o=document.createElement("div");o.className="student-details-notes";const l=document.createElement("div");l.className="history-section-header";const f=document.createElement("h4");f.textContent="ÛŒØ§Ø¯Ø¯Ø§Ø´Øªâ€ŒÙ‡Ø§";const p=document.createElement("button");p.className="btn-icon",p.innerHTML="ðŸ“",p.title="Ø§ÙØ²ÙˆØ¯Ù† ÛŒØ§Ø¯Ø¯Ø§Ø´Øª Ø¬Ø¯ÛŒØ¯",K.isFinished?p.disabled=!0:p.addEventListener("click",()=>{ve.value="",ve.dispatchEvent(new Event("input",{bubbles:!0})),ut(h=>{h&&(e.addNote(h),se(),Re(),j("âœ… ÛŒØ§Ø¯Ø¯Ø§Ø´Øª Ø¨Ø§ Ù…ÙˆÙÙ‚ÛŒØª Ø«Ø¨Øª Ø´Ø¯."))}),Te("add-note-modal"),ve.focus()}),l.appendChild(f),l.appendChild(p),o.appendChild(l);const m=document.createElement("ul");return m.className="notes-list",e.profile.notes&&e.profile.notes.length>0?[...e.profile.notes].sort((y,u)=>new Date(u.timestamp)-new Date(y.timestamp)).forEach(y=>{const u=document.createElement("li");u.dir=gs(y.content),u.textContent=y.content,m.appendChild(u)}):m.innerHTML='<div class="no-content-message">ÛŒØ§Ø¯Ø¯Ø§Ø´ØªÛŒ ÙˆØ¬ÙˆØ¯ Ù†Ø¯Ø§Ø±Ø¯.</div>',o.appendChild(m),t.appendChild(o),t}function xn(){if(_n&&hn){hn.style.display="flex";const e=_n.checked;hn.style.visibility=e?"visible":"hidden"}}const fr=Object.freeze(Object.defineProperty({__proto__:null,_internalShowPage:us,addClassModal:Zr,addNoteModal:Co,addScoreBtn:Io,addStudentBtn:Xr,appHeader:Os,assessmentModeLabel:co,attendanceListUl:un,attendanceMassActionsContainer:Un,attendancePage:lo,attendancePane:Kt,attendanceSearchInput:Bt,backToSessionsBtn:Kr,backToStudentPageBtn:So,backupDataBtn:po,breadcrumbContainer:Wt,cancelAddClassBtn:Bs,cancelImportBtn:oo,cancelNoteBtn:Eo,categoryListUl:Ns,categoryModal:Ro,categoryModalCancelBtn:zo,categoryModalSaveBtn:qa,categoryModalTitle:ja,categoryWeightLabel:an,classListHeader:fo,classListUl:At,classManagementPage:Ba,classSaveNoteBtn:wo,closeActiveModal:fe,closeAddClassModal:Gs,closeContextMenu:Ot,closeNavBtn:ho,columnMappingPage:ao,columnSelectDropdown:Ms,confirmAddClassBtn:Ts,confirmColumnBtn:ro,confirmModalCancelBtn:zs,confirmModalConfirmBtn:rn,confirmModalMessage:za,contextMenu:$t,csvCancelBtn:no,csvConfirmBtn:to,csvFileInput:io,csvPreviewList:As,csvPreviewPage:eo,customConfirmModal:yo,displayWinner:Re,finishAttendanceBtn:uo,globalStudentSearchInput:on,globalStudentSearchResultsDiv:mt,gradedCategoryPillsContainer:_o,hamburgerMenuBtn:mo,handleUndo:Xa,importCsvBtn:so,massCommentAppendCheckbox:Li,massCommentBtn:Fs,massCommentCancelBtn:Fo,massCommentContent:mn,massCommentModal:$o,massCommentModalTitle:Po,massCommentSaveBtn:Ho,massCommentStudentCountMessage:Ga,modalAddClassLevelSelect:xi,modalAddClassSystemSelect:Ii,modalNewClassNameInput:Sn,modalScheduleContent:Ka,modalScheduleDaysContainer:cs,modalScheduleEndTimeInput:Ja,modalScheduleStartTimeInput:Va,modalScheduleTextInput:Za,modalScheduleToggle:ln,newCategoryModal:Wo,newCategoryModalIsGradedCheckbox:_n,newCategoryModalNameInput:Vt,newCategoryModalWeightGroup:hn,newCategoryModalWeightInput:ls,newNoteContent:ve,newScoreCommentTextarea:Fa,newScoreValueInput:ko,newStudentNameInput:Yr,openAddCategoryBtn:jo,openAddCategoryModal:ur,openAddClassModal:dr,openAddClassModalBtn:Gr,openContextMenu:Bn,openModal:Te,overlay:Oa,pasteArea:Aa,populateSystemLevelSelects:Ri,processMassHomeworkComment:Us,processPasteBtn:Qr,profileScoresListUl:Lo,profileStatsSummaryDiv:xo,quickGradeFormWrapper:jt,quickGradeSubmitBtn:xt,quickNoteTextarea:Xe,quickScoreInput:Ye,renderAttendancePage:rt,renderBreadcrumbs:tr,renderClassList:He,renderClassManagementStats:bs,renderColumnSelector:rr,renderGlobalSearchResults:Gn,renderImportPreview:qs,renderLogModal:er,renderMassCommentControls:Di,renderRestorePointsPage:lr,renderScoresHistory:ir,renderSearchResults:dn,renderSessionDashboard:Tn,renderSessions:qe,renderSettingsCategories:Qt,renderSettingsOther:or,renderSettingsStudentList:Tt,renderStudentNotes:ar,renderStudentStatsList:Oe,renderTrashPage:In,reportCancelBtn:Wa,reportColumnsContainer:Ha,reportConfigModal:Oo,reportPrintBtn:Ua,restoreDataBtn:go,restoreFileInput:Ra,secureConfirmCancelBtn:bo,secureConfirmCode:Pa,secureConfirmConfirmBtn:Hn,secureConfirmInput:Ut,secureConfirmMessage:$a,secureConfirmModal:vo,selectStudentBtn:Qe,selectStudentBtnWrapper:Mt,sessionDashboardPage:Uo,setAutoDirectionOnInput:Mi,settingsClassNameHeader:Na,settingsEduSystemSelect:Wn,settingsLevelSelect:cn,settingsPage:Jr,settingsStudentListUl:Ds,setupDashboardTabs:Ya,setupLongPress:qt,showCategoryModal:Hs,showClassNoteModal:vs,showCustomConfirm:ge,showMassCommentModal:Ni,showMoveStudentModal:Ti,showNotification:j,showPage:Se,showRenameStudentModal:Bi,showRestoreConfirmModal:ds,showSecureConfirm:Qa,showSessionNoteModal:Ai,showSettingsPage:Lt,showStudentProfile:We,showUndoToast:qo,sideNavMenu:Ma,studentSearchInput:$s,studentSearchResultsDiv:St,studentStatsHeader:Rs,switchDashboardTab:Yt,syncWeightGroupVisibility:xn,trashedCategoriesList:No,trashedClassesList:To,trashedNotesList:Ao,trashedScoresList:Mo,trashedSessionsList:Do,trashedStudentsList:Bo,triggerFileDownload:Ws,undoBtn:Vr,undoMessage:Da,undoToast:os,updateCategoryColumnHighlight:Xt,updateDemoModeBanner:fs,updateQuickGradeUIForCategory:kn},Symbol.toStringTag,{value:"Module"}));function hc(){ii(JSON.parse(JSON.stringify({classrooms:ie,trashBin:Ue}))),si(!0)}function pc(){si(!1),ci(),ii(null)}function Vi(){ge("Ø¢ÛŒØ§ Ø§Ø² Ø®Ø±ÙˆØ¬ Ø§Ø² Ø­Ø§Ù„Øª Ù†Ù…Ø§ÛŒØ´ (Demo) Ù…Ø·Ù…Ø¦Ù† Ù‡Ø³ØªÛŒØ¯ØŸ Ø¨Ø§ Ø®Ø±ÙˆØ¬ØŒ ØªÙ…Ø§Ù… ØªØºÛŒÛŒØ±Ø§Øª Ø¢Ø²Ù…Ø§ÛŒØ´ÛŒ Ø´Ù…Ø§ Ø­Ø°Ù Ø´Ø¯Ù‡ Ùˆ Ø¯Ø§Ø¯Ù‡â€ŒÙ‡Ø§ÛŒ Ø§ØµÙ„ÛŒ Ø´Ù…Ø§ Ø¨Ø§Ø²ÛŒØ§Ø¨ÛŒ Ø®ÙˆØ§Ù‡Ù†Ø¯ Ø´Ø¯.",()=>{pc(),Ge(null),at(null),It(null),He(),Se("class-management-page"),fs(),je()},{confirmText:"Ø®Ø±ÙˆØ¬",confirmClass:"btn-success"})}let Zs=0;function zi(){document.querySelector(".app-header h1").addEventListener("click",()=>{Zs++,Zs===10&&(window.dev={state:va,ui:fr,utils:Rr,db:Dr,main:vr,developer:yr},console.log("ðŸ› ï¸ Developer Mode Activated! Access modules via the 'dev' object (e.g., dev.state.currentClassroom)"),j("ðŸ› ï¸ Ø­Ø§Ù„Øª ØªÙˆØ³Ø¹Ù‡â€ŒØ¯Ù‡Ù†Ø¯Ù‡ ÙØ¹Ø§Ù„ Ø´Ø¯."),document.querySelector(".app-header h1").style.color="var(--color-primary)",document.querySelector(".app-header h1").classList.add("dev-mode-tilt"))})}function gc(e,s){document.addEventListener("keydown",t=>{const c=document.activeElement;if(!["INPUT","TEXTAREA","SELECT"].includes(c.tagName)){if(t.key.toLowerCase()==="o"&&t.shiftKey&&Ba.classList.contains("active")&&(t.preventDefault(),Ra.click()),t.key==="Escape"){if($t.classList.contains("visible")){Ot();return}if(vt){fe();return}$i(!1);return}if(K){const n=t.key.toLowerCase();switch(" ascfg".includes(n)&&t.preventDefault(),n){case" ":e.click();break;case"s":document.getElementById("session-page").classList.contains("active")&&history.back();break;case"f":const r=document.querySelector(".action-column .search-icon");r&&r.click();break;case"arrowleft":{const i=document.querySelector('button[title="Ø¨Ø±Ù†Ø¯Ù‡ Ù‚Ø¨Ù„ÛŒ"]');i&&!i.disabled&&(t.preventDefault(),i.click());break}case"arrowright":{const i=document.querySelector('button[title="Ø¨Ø±Ù†Ø¯Ù‡ Ø¨Ø¹Ø¯ÛŒ"]');i&&!i.disabled&&(t.preventDefault(),i.click());break}}}}})}function yc(e){e.addEventListener("click",()=>{const s=new Date().getTime();s-Xs>500?zn(1):zn(Jn+1),ha(s),Jn===5&&(zn(0),ge("Ø¢ÛŒØ§ Ø§Ø² Ø³Ø§Ø®Øª ÛŒÚ© Ú©Ù„Ø§Ø³ ØªØ³ØªÛŒ ØªØµØ§Ø¯ÙÛŒ Ù…Ø·Ù…Ø¦Ù† Ù‡Ø³ØªÛŒØ¯ØŸ",()=>{function t(){const c=`Ú©Ù„Ø§Ø³ ØªØ³ØªÛŒ ${Object.keys(ie).length+1}`,a=new Vs({name:c,type:"online"});["Ø¹Ù„ÛŒ . Ø±Ø¶Ø§ÛŒÛŒ","Ù…Ø±ÛŒÙ… . Ø­Ø³ÛŒÙ†ÛŒ","Ø²Ù‡Ø±Ø§ . Ø§Ø­Ù…Ø¯ÛŒ","Ø±Ø¶Ø§ . Ù…Ø­Ù…Ø¯ÛŒ","ÙØ§Ø·Ù…Ù‡ . Ú©Ø±ÛŒÙ…ÛŒ"].forEach(r=>a.addStudent(new Zn(Gt(r)))),ie[c]=a,se(),He()}t(),j("Ú©Ù„Ø§Ø³ ØªØ³ØªÛŒ Ø¨Ø§ Ù…ÙˆÙÙ‚ÛŒØª Ø³Ø§Ø®ØªÙ‡ Ø´Ø¯ âœ…!")},{confirmText:"Ø¨Ø³Ø§Ø²",confirmClass:"btn-success"}))})}let Is=!1;const vc={"session-dashboard-page":"session-page","column-mapping-page":"settings-page","csv-preview-page":"settings-page","restore-points-page":"class-management-page","session-page":"class-management-page","settings-page":"class-management-page","trash-page":"class-management-page","class-management-page":null};function bc(e){if(e==="class-management-page"){Ge(null),at(null),history.replaceState({pageId:e},"","#class-management-page"),us(e);return}else e==="session-page"&&(at(null),N&&qe());const s=new URLSearchParams;N&&s.set("class",N.info.name),K&&s.set("session",K.sessionNumber);const t=`#${e}${s.toString()?"?"+s.toString():""}`;history.replaceState({pageId:e},"",t),us(e)}function $i(e=!1){if(vt){fe();return}const s=document.querySelector(".page.active");if(!s)return;const t=vc[s.id];t&&(e?bc(t):Se(t))}function Cc(){const e=window.location.hash;if(!e||e==="#")return!1;const[s,t]=e.split("?"),c=s.substring(1),a=new URLSearchParams(t),n=a.get("class"),r=parseInt(a.get("session"),10),i=a.get("student"),o=a.get("tab")||"selector";if(n&&ie[n])Ge(ie[n]),r&&N.getSession(r)&&at(N.getSession(r)),i&&N.students.find(l=>l.identity.studentId===i)&&It(N.students.find(l=>l.identity.studentId===i));else return!1;switch(c){case"session-page":qe(),Se("session-page");break;case"session-dashboard-page":Tn(c==="attendance-page"?"attendance":o);break;case"settings-page":Lt(N);break;default:return!1}return!0}document.addEventListener("DOMContentLoaded",()=>{const{globalStudentSearchInput:e,undoBtn:s,newStudentNameInput:t,addStudentBtn:c,pasteArea:a,processPasteBtn:n,csvPreviewList:r,csvConfirmBtn:i,csvCancelBtn:o,importCsvBtn:l,csvFileInput:f,columnSelectDropdown:p,confirmColumnBtn:m,cancelImportBtn:h,selectStudentBtn:y,finishAttendanceBtn:u,classListHeader:v,studentStatsHeader:b,hamburgerMenuBtn:C,sideNavMenu:S,closeNavBtn:_,overlay:k,backupDataBtn:x,restoreDataBtn:L,restoreFileInput:B,confirmModalCancelBtn:O,confirmModalConfirmBtn:H,secureConfirmCancelBtn:Q,secureConfirmConfirmBtn:I,newNoteContent:z,classSaveNoteBtn:g,cancelNoteBtn:F,studentSearchInput:oe,studentSearchResultsDiv:Z,categoryModalSaveBtn:de,categoryModalCancelBtn:V,massCommentBtn:le,massCommentCancelBtn:R,massCommentSaveBtn:A,massCommentContent:ce,massCommentAppendCheckbox:ee,attendanceSearchInput:X,newCategoryModalNameInput:xe,newCategoryModalIsGradedCheckbox:De,newCategoryModalWeightInput:pe,openAddCategoryBtn:be}=fr,Ne=document.getElementById("trash-nav-btn");document.querySelector(".global-search-container .search-icon"),ci(),fs(),Cc()||(He(),Se("class-management-page"));function Ze(M,G){const U=document.querySelector(M);if(!U)return;const ne=U.querySelector(".search-icon"),re=U.querySelector(".animated-search-input");!ne||!re||(ne.addEventListener("mousedown",me=>{me.preventDefault()}),ne.addEventListener("click",()=>{U.classList.contains("search-active")||(U.classList.add("search-active"),re.focus())}),re.addEventListener("blur",()=>{setTimeout(()=>{U.classList.remove("search-active"),re.value="",G&&G([])},150)}))}X.addEventListener("input",()=>{const M=X.value.toLowerCase().trim(),G=Fn(M);un.querySelectorAll(".attendance-list-item").forEach(ne=>{const re=ne.querySelector(".student-name");if(re){const me=re.textContent,ue=Fe(me.toLowerCase()),Ee=ue.includes(Fe(M)),Ae=ue.includes(Fe(G));Ee||Ae?ne.style.display="flex":ne.style.display="none"}})}),V.addEventListener("click",()=>{fe(),bn(null)}),de.addEventListener("click",()=>{const M=xe.value.trim(),G=De.checked,U=parseInt(pe.value,10)||1;if(!M){gt(xe,3e3),j("âš ï¸ Ù†Ø§Ù… Ø¯Ø³ØªÙ‡â€ŒØ¨Ù†Ø¯ÛŒ Ù†Ù…ÛŒâ€ŒØªÙˆØ§Ù†Ø¯ Ø®Ø§Ù„ÛŒ Ø¨Ø§Ø´Ø¯.");return}typeof Xn=="function"&&Xn(M,G,U),fe(),j(`âœ… Ø¯Ø³ØªÙ‡â€ŒØ¨Ù†Ø¯ÛŒ Ø¬Ø¯ÛŒØ¯ ${M} Ø¨Ø§ Ù…ÙˆÙÙ‚ÛŒØª Ø§Ø¶Ø§ÙÙ‡ Ø´Ø¯.`),Qt(),Oe()}),window.addEventListener("scroll",Ot),document.addEventListener("click",M=>{$t.classList.contains("visible")&&!$t.contains(M.target)&&Ot(),oe.contains(M.target)||(Z.style.display="none");const G=M.target.closest(".log-action-link");if(G&&G.dataset.action)try{const U=JSON.parse(G.dataset.action);ct(U)}catch(U){console.error("Could not parse log action:",U)}}),Mt.addEventListener("click",()=>{(Mt.classList.contains("disabled-wrapper")||Qe.disabled)&&(Qe.classList.add("shake-animation"),setTimeout(()=>{Qe.classList.remove("shake-animation")},200))}),b.addEventListener("click",()=>{const M=new Date().getTime();M-Qs>500?$n(1):$n(Kn+1),pa(M),Kn===5&&($n(0),ge("Ø¢ÛŒØ§ Ø§Ø² ØµÙØ± Ú©Ø±Ø¯Ù† ØªÙ…Ø§Ù… Ø´Ù…Ø§Ø±Ù†Ø¯Ù‡â€ŒÙ‡Ø§ÛŒ Ø¯Ø§Ù†Ø´â€ŒØ¢Ù…ÙˆØ²Ø§Ù† Ù…Ø·Ù…Ø¦Ù† Ù‡Ø³ØªÛŒØ¯ØŸ Ø§ÛŒÙ† Ø¹Ù…Ù„ ØºÛŒØ±Ù‚Ø§Ø¨Ù„ Ø¨Ø§Ø²Ú¯Ø´Øª Ø§Ø³Øª.",()=>{da(),Oe(),j("ØªÙ…Ø§Ù… Ø¢Ù…Ø§Ø±Ù‡Ø§ ØµÙØ± Ø´Ø¯Ù†Ø¯ âœ….")},{confirmText:"Ø¨Ù„Ù‡",confirmClass:"btn-warning"}))}),yc(v),zi(),Q.addEventListener("click",()=>{fe(),vn(null)});const Ve=document.getElementById("date-picker-confirm-btn"),d=document.getElementById("date-picker-cancel-btn"),P=document.getElementById("dp-day"),$=document.getElementById("dp-month"),E=document.getElementById("dp-year");Ve.addEventListener("click",()=>{const M=E.value,G=$.value,U=P.value;M&&G&&U&&typeof es=="function"?(es({jy:M,jm:G,jd:U}),fe()):j("âš ï¸ Ø®Ø·Ø§ Ø¯Ø± Ø§Ù†ØªØ®Ø§Ø¨ ØªØ§Ø±ÛŒØ®."),ss(null)}),d&&d.addEventListener("click",()=>{fe(),ss(null)}),I.addEventListener("click",()=>{typeof Yn=="function"&&Yn(),fe(),vn(null)}),O.addEventListener("click",()=>{fe(ti)}),H.addEventListener("click",()=>{fe(ei)}),Qe.addEventListener("click",()=>{if(Is){Is=!1;return}if(Ye.value.trim()!==""||Xe.value.trim()!==""){j("âš ï¸Ù„Ø·ÙØ§Ù‹ Ø§Ø¨ØªØ¯Ø§ Ø¨Ø§ Ø¯Ú©Ù…Ù‡ Â«Ø«Ø¨ØªÂ»ØŒ ØªØºÛŒÛŒØ±Ø§Øª Ø±Ø§ Ø°Ø®ÛŒØ±Ù‡ Ú©Ù†ÛŒØ¯ Ùˆ ÛŒØ§ Ù†Ù…Ø±Ù‡ Ùˆ ÛŒØ§Ø¯Ø¯Ø§Ø´Øª Ø±Ø§ Ù¾Ø§Ú© Ú©Ù†ÛŒØ¯.",4200),gt(Ye),gt(Xe);return}if(Nt){const M=hr(N,Me);M?(Oe(),Re(M,Me.name),Xt(Me.name),se()):ge("Ø¨Ø±Ø§ÛŒ ØªÙ…Ø§Ù… Ø¯Ø§Ù†Ø´â€ŒØ¢Ù…ÙˆØ²Ø§Ù† Ø¯Ø± Ø§ÛŒÙ† Ø¬Ù„Ø³Ù‡ ÛŒÚ© Ø¨Ø§Ø± ÙØ±ØµØª Ù†Ù…Ø±Ù‡â€ŒÚ¯ÛŒØ±ÛŒ ÙØ±Ø§Ù‡Ù… Ø´Ø¯Ù‡Ø› Ø¢ÛŒØ§ Ù…ÛŒâ€ŒØ®ÙˆØ§Ù‡ÛŒØ¯ Ø¨Ø±Ø§ÛŒ Ø¨Ø§Ø± Ø¯ÙˆÙ… Ø§ÛŒÙ† Ú©Ø§Ø± Ø±Ø§ ØªÚ©Ø±Ø§Ø± Ú©Ù†ÛŒØ¯ØŸ",()=>{const G=Me.id;it[G].scoredThisSession=[],Qe.click()},{confirmText:"Ø¨Ù„Ù‡",cancelText:"Ø®ÛŒØ±",confirmClass:"btn-success"})}else{if(!N||!K||!Me)return;const M=N.selectNextWinner(Me.name,K);if(M){Ls();const G=K.studentRecords[M.identity.studentId];(G==null?void 0:G.attendance)==="absent"&&M.statusCounters.missedChances++,G!=null&&G.hadIssue&&(M.statusCounters.missedChances++,M.categoryIssues[Me.name]=(M.categoryIssues[Me.name]||0)+1),G!=null&&G.wasOutOfClass&&(M.statusCounters.outOfClassCount=(M.statusCounters.outOfClassCount||0)+1,M.statusCounters.missedChances++);const U={winner:M,categoryName:Me.name};K.winnerHistory.push(U),K.winnerHistory.length>10&&K.winnerHistory.shift(),bt(K.winnerHistory.length-1),K.lastUsedCategoryId=Me.id,K.lastSelectedWinnerId=M.identity.studentId,Oe(),setTimeout(()=>Re(),0),se()}else j("âŒØ¯Ø§Ù†Ø´â€ŒØ¢Ù…ÙˆØ² ÙˆØ§Ø¬Ø¯ Ø´Ø±Ø§ÛŒØ·ÛŒ Ø¨Ø±Ø§ÛŒ Ø§Ù†ØªØ®Ø§Ø¨ ÛŒØ§ÙØª Ù†Ø´Ø¯.")}}),document.querySelectorAll('#settings-page input[name="class-type-setting"]').forEach(M=>{M.addEventListener("change",()=>{if(!N)return;const G=M.value,U=N.info.type||"in-person";if(G===U)return;const ne=ue=>ue==="online"?"Ø¢Ù†Ù„Ø§ÛŒÙ†":"Ø­Ø¶ÙˆØ±ÛŒ",re=ne(U),me=ne(G);ge(`Ø¢ÛŒØ§ Ø§Ø² ØªØºÛŒÛŒØ± Ù†ÙˆØ¹ Ú©Ù„Ø§Ø³ Ø§Ø² Â«${re}Â» Ø¨Ù‡ Â«${me}Â» Ù…Ø·Ù…Ø¦Ù† Ù‡Ø³ØªÛŒØ¯ØŸ`,()=>{N.info.type=G,se(),Ce(N.info.name,`Ù†ÙˆØ¹ Ú©Ù„Ø§Ø³ Ø¨Ù‡ Â«${me}Â» ØªØºÛŒÛŒØ± ÛŒØ§ÙØª.`,{type:"VIEW_CLASS_SETTINGS"}),He(),j(`âœ… Ù†ÙˆØ¹ Ú©Ù„Ø§Ø³ Ø¨Ù‡ Â«${me}Â» ØªØºÛŒÛŒØ± ÛŒØ§ÙØª.`)},{confirmText:"Ø¨Ù„Ù‡",confirmClass:"btn-warning",onCancel:()=>{const ue=document.querySelector(`#settings-page input[name="class-type-setting"][value="${U}"]`);ue&&(ue.checked=!0)}})})});const T=document.querySelectorAll('input[name="schedule-day"]'),W=document.getElementById("settings-schedule-start"),q=document.getElementById("settings-schedule-end");T.forEach(M=>{M.addEventListener("change",()=>{if(!N)return;const G=Array.from(T).filter(U=>U.checked).map(U=>parseInt(U.value));N.info.scheduleDays=G,se()})});const D=()=>{N&&(N.info.scheduleStartTime=W.value,N.info.scheduleEndTime=q.value,se())};W.addEventListener("change",D),q.addEventListener("change",D),m.addEventListener("click",()=>{if(!Vn){j("âŒØ®Ø·Ø§ÛŒÛŒ Ø±Ø® Ø¯Ø§Ø¯Ù‡ Ø§Ø³Øª. Ù„Ø·ÙØ§Ù‹ ÙØ§ÛŒÙ„ Ø±Ø§ Ø¯ÙˆØ¨Ø§Ø±Ù‡ Ø§Ù†ØªØ®Ø§Ø¨ Ú©Ù†ÛŒØ¯."),Se("settings-page");return}const M=parseInt(p.value,10),ne=Vn.split(`
`).slice(1).map(re=>{var ue;return(ue=re.split(",")[M])==null?void 0:ue.trim()}).filter(re=>re&&re.length>0);ne.length>0?(sn(ne),qs(),Se("csv-preview-page")):j("Ù‡ÛŒÚ† Ù†Ø§Ù…ÛŒ Ø¯Ø± Ø³ØªÙˆÙ† Ø§Ù†ØªØ®Ø§Ø¨ Ø´Ø¯Ù‡ Ù¾ÛŒØ¯Ø§ Ù†Ø´Ø¯. Ù„Ø·ÙØ§Ù‹ Ø³ØªÙˆÙ† Ø¯ÛŒÚ¯Ø±ÛŒ Ø±Ø§ Ø§Ù…ØªØ­Ø§Ù† Ú©Ù†ÛŒØ¯ ÛŒØ§ ÙØ§ÛŒÙ„ Ø®ÙˆØ¯ Ø±Ø§ Ø¨Ø±Ø±Ø³ÛŒ Ú©Ù†ÛŒØ¯."),Rn(null)}),l.addEventListener("click",()=>{f.click()}),f.addEventListener("change",M=>{const G=M.target.files[0];if(!G)return;const U=new FileReader;U.onload=ne=>{const re=ne.target.result;Rn(re);const ue=re.split(`
`)[0].split(",");rr(ue),Se("column-mapping-page")},U.readAsText(G),M.target.value=null}),h.addEventListener("click",()=>{Rn(null),Se("settings-page")}),i.addEventListener("click",()=>{const M=r.querySelectorAll('input[type="checkbox"]:checked');let G=0,U=[],ne=!1;M.forEach(me=>{const ue=me.dataset.name,Ee=Gt(ue),Ae=Fe(Ee.name),$e=N.students.find(nt=>Fe(nt.identity.name)===Ae&&Ae!=="");if($e)if($e.isDeleted)ps($e,N);else{U.push(Ee.name);return}const Ke=new Zn(Ee);N.addStudent(Ke),N.sessions.length>0&&(ye(N.sessions).filter(nt=>nt.isFinished&&!nt.isCancelled).forEach(nt=>{nt.setAttendance(Ke.identity.studentId,"absent")}),wt(Ke,N),ne=!0),G++}),se(),G>0&&Ce(N.info.name,`${G} Ø¯Ø§Ù†Ø´â€ŒØ¢Ù…ÙˆØ² Ø¬Ø¯ÛŒØ¯ Ø§Ø² Ù„ÛŒØ³Øª ÙˆØ±ÙˆØ¯ÛŒ Ø¨Ù‡ Ú©Ù„Ø§Ø³ Ø§Ø¶Ø§ÙÙ‡ Ø´Ø¯Ù†Ø¯.`,{type:"VIEW_SESSIONS"}),Lt(N);let re=U.length>0?`âš ï¸ Ù…ÙˆØ§Ø±Ø¯ Ø²ÛŒØ± Ø¨Ù‡ Ø¯Ù„ÛŒÙ„ ØªÚ©Ø±Ø§Ø±ÛŒ Ø¨ÙˆØ¯Ù† Ù†Ø§Ø¯ÛŒØ¯Ù‡ Ú¯Ø±ÙØªÙ‡ Ø´Ø¯Ù†Ø¯:
- ${U.join(`
- `)}`:"";if(ne)Le(G,re);else if(U.length>0||G>0){const me=G>0?`âœ… ${G} Ø¯Ø§Ù†Ø´â€ŒØ¢Ù…ÙˆØ² Ø¨Ø§ Ù…ÙˆÙÙ‚ÛŒØª Ø§Ø¶Ø§ÙÙ‡ Ø´Ø¯Ù†Ø¯.
${re}`:re;ge(me,()=>{},{confirmText:"Ù…ØªÙˆØ¬Ù‡ Ø´Ø¯Ù…",confirmClass:"btn-success",onCancel:null})}a.value="",sn([])}),o.addEventListener("click",()=>{sn([]),Se("settings-page")}),a.addEventListener("keydown",M=>{if(M.key==="Enter"){const G=a.value,U=a.selectionStart,ne=G.lastIndexOf(`
`,U-1),re=G.substring(ne+1,U).trim(),me=re.indexOf(".");re&&(me<=0||me>=re.length-1)&&(M.preventDefault(),j("Ù„Ø·ÙØ§ ÛŒÚ© Ù†Ù‚Ø·Ù‡ Ø¨ÛŒÙ† Ù†Ø§Ù… Ùˆ Ù†Ø§Ù… Ø®Ø§Ù†ÙˆØ§Ø¯Ú¯ÛŒ Ù‚Ø±Ø§Ø± Ø¯Ù‡ÛŒØ¯.âš ï¸ Ù…Ø«Ø§Ù„: Ø¹Ù„ÛŒ . Ø§Ø­Ù…Ø¯ÛŒ",5e3))}}),n.addEventListener("click",()=>{const M=a.value.trim();if(!M){gt(a,3e3),j("Ú©Ø§Ø¯Ø± Ù…ØªÙ†ÛŒ Ø®Ø§Ù„ÛŒ Ø§Ø³Øª. Ù„Ø·ÙØ§Ù‹ Ø§Ø³Ø§Ù…ÛŒ Ø±Ø§ ÙˆØ§Ø±Ø¯ Ú©Ù†ÛŒØ¯.");return}const G=M.split(`
`).map(ne=>ne.trim()).filter(ne=>ne.length>0),U=G.find(ne=>{const re=ne.indexOf(".");return re<=0||re>=ne.length-1});if(U){j(`ÙØ±Ù…Øª Ù†Ø§Ù… Â«${U}Â» ØµØ­ÛŒØ­ Ù†ÛŒØ³Øª. Ù„Ø·ÙØ§ Ù†Ø§Ù… Ùˆ Ù†Ø§Ù… Ø®Ø§Ù†ÙˆØ§Ø¯Ú¯ÛŒ Ø±Ø§ Ø¨Ø§ Ù†Ù‚Ø·Ù‡ Ø¬Ø¯Ø§ Ú©Ù†ÛŒØ¯âš ï¸.`,5e3);return}G.length>0?(sn(G),qs(),Se("csv-preview-page")):j("Ù‡ÛŒÚ† Ù†Ø§Ù… Ù…Ø¹ØªØ¨Ø±ÛŒ Ø¨Ø±Ø§ÛŒ ÙˆØ±ÙˆØ¯ Ù¾ÛŒØ¯Ø§ Ù†Ø´Ø¯.")}),t.addEventListener("keyup",M=>{M.key==="Enter"&&c.click()}),c.addEventListener("click",()=>{if(!N)return;const M=t.value.trim();if(!M){gt(t,3e3),j("Ù„Ø·ÙØ§Ù‹ Ù†Ø§Ù… Ø¯Ø§Ù†Ø´â€ŒØ¢Ù…ÙˆØ² Ø±Ø§ ÙˆØ§Ø±Ø¯ Ú©Ù†ÛŒØ¯.");return}const G=M.indexOf(".");if(G<=0||G>=M.length-1){j("Ù„Ø·ÙØ§ ÛŒÚ© Ù†Ù‚Ø·Ù‡ Ø¨ÛŒÙ† Ù†Ø§Ù… Ùˆ Ù†Ø§Ù… Ø®Ø§Ù†ÙˆØ§Ø¯Ú¯ÛŒ Ù‚Ø±Ø§Ø± Ø¯Ù‡ÛŒØ¯.âš ï¸ Ù…Ø«Ø§Ù„: Ø¹Ù„ÛŒ . Ø§Ø­Ù…Ø¯ÛŒ",5e3);return}const U=Gt(t.value),ne=Fe(U.name);if(ye(N.students).some(Ee=>Fe(Ee.identity.name)===ne)){j(`Ø¯Ø§Ù†Ø´â€ŒØ¢Ù…ÙˆØ² Â«${U.name}Â» Ù‚Ø¨Ù„Ø§Ù‹ Ø¯Ø± Ù„ÛŒØ³Øª ÙˆØ¬ÙˆØ¯ Ø¯Ø§Ø±Ø¯.`,4e3);return}const me=Gt(M),ue=new Zn(me);N.addStudent(ue),N.sessions.length>0&&(ye(N.sessions).filter(Ee=>Ee.isFinished&&!Ee.isCancelled).forEach(Ee=>{Ee.setAttendance(ue.identity.studentId,"absent")}),wt(ue,N),Le(1)),se(),Ce(N.info.name,`Ø¯Ø§Ù†Ø´â€ŒØ¢Ù…ÙˆØ² Â«${M}Â» Ø¨Ù‡ Ú©Ù„Ø§Ø³ Ø§Ø¶Ø§ÙÙ‡ Ø´Ø¯.`,{type:"VIEW_STUDENT_PROFILE",studentId:ue.identity.studentId}),Tt(),Oe(),t.value="",t.focus()}),document.getElementById("new-session-btn").addEventListener("click",()=>{if(N){const M=N.sessions.find(U=>!U.isFinished&&!U.isCancelled&&!U.isDeleted);if(M){j(`âš ï¸ Ø¬Ù„Ø³Ù‡ ${M.sessionNumber} Ù‡Ù†ÙˆØ² ØªÙ…Ø§Ù… Ù†Ø´Ø¯Ù‡ Ø§Ø³Øª. Ù„Ø·ÙØ§Ù‹ Ø§Ø¨ØªØ¯Ø§ Ø¨Ø§ Ø¯Ú©Ù…Ù‡ Â«Ù¾Ø§ÛŒØ§Ù† Ø¬Ù„Ø³Ù‡Â» Ø¢Ù† Ø±Ø§ Ø®Ø§ØªÙ…Ù‡ Ø¯Ù‡ÛŒØ¯.`,4500);const U=document.querySelector("#session-list > li:nth-child(1) > div.list-item-buttons > button.btn-success");U&&gt(U);return}const G=()=>{const U=ne=>{const re=N.startNewSession();yn(re),at(re),N.students.forEach(Ee=>{Js.setAttendance(Ee.identity.studentId,"present")}),se();const ue=dt(N).get(re.sessionNumber);Ce(N.info.name,`Ø¬Ù„Ø³Ù‡ ${ue} Ø´Ø±ÙˆØ¹ Ø´Ø¯.`,{type:"VIEW_SESSIONS"}),Tn(ne?"attendance":"selector")};ge("Ø¢ÛŒØ§ ØªÙ…Ø§ÛŒÙ„ Ø¨Ù‡ Ø§Ù†Ø¬Ø§Ù… ÙØ±Ø¢ÛŒÙ†Ø¯ Ø­Ø¶ÙˆØ± Ùˆ ØºÛŒØ§Ø¨ Ø¯Ø§Ø±ÛŒØ¯ØŸ",()=>U(!0),{confirmText:"Ø¨Ù„Ù‡",cancelText:"Ø®ÛŒØ±",confirmClass:"btn-success",onCancel:()=>U(!1)})};N.hasSessionToday()?ge("Ø´Ù…Ø§ Ø§Ù…Ø±ÙˆØ² ÛŒÚ© Ø¬Ù„Ø³Ù‡ Ø¨Ø±Ø§ÛŒ Ø§ÛŒÙ† Ú©Ù„Ø§Ø³ Ø«Ø¨Øª Ú©Ø±Ø¯Ù‡â€ŒØ§ÛŒØ¯. Ø¢ÛŒØ§ Ø§Ø² Ø´Ø±ÙˆØ¹ ÛŒÚ© Ø¬Ù„Ø³Ù‡ Ø¬Ø¯ÛŒØ¯ Ø¯ÛŒÚ¯Ø± Ù…Ø·Ù…Ø¦Ù† Ù‡Ø³ØªÛŒØ¯ØŸ",G,{confirmText:"Ø¨Ù„Ù‡",confirmClass:"btn-warning"}):G()}});const J=document.getElementById("open-add-class-modal-btn");J&&J.addEventListener("click",()=>{dr()}),Bs&&Bs.addEventListener("click",()=>{Gs()}),Ts?Ts.addEventListener("click",()=>{const M=Sn;if(!M){console.error("âŒ DEBUG: Name Input element is missing!");return}const G=M.value.trim();if(!G){gt(M,3e3),j("Ù„Ø·ÙØ§Ù‹ Ù†Ø§Ù… Ú©Ù„Ø§Ø³ Ø±Ø§ ÙˆØ§Ø±Ø¯ Ú©Ù†ÛŒØ¯.");return}if(ie[G]){gt(M,3e3),j("Ú©Ù„Ø§Ø³ÛŒ Ø¨Ø§ Ø§ÛŒÙ† Ù†Ø§Ù… Ù‚Ø¨Ù„Ø§Ù‹ Ø§ÛŒØ¬Ø§Ø¯ Ø´Ø¯Ù‡ Ø§Ø³Øª.");return}try{const U=Sn.value.trim();if(!U){j("âš ï¸ Ù„Ø·ÙØ§Ù‹ Ù†Ø§Ù… Ú©Ù„Ø§Ø³ Ø±Ø§ ÙˆØ§Ø±Ø¯ Ú©Ù†ÛŒØ¯.");return}if(ie[U]){j("âš ï¸ Ú©Ù„Ø§Ø³ÛŒ Ø¨Ø§ Ø§ÛŒÙ† Ù†Ø§Ù… ÙˆØ¬ÙˆØ¯ Ø¯Ø§Ø±Ø¯.");return}const ne=document.querySelector('input[name="modal-class-type"]:checked');if(!ne){console.error("Class type radio not selected");return}const re=ne.value,me=Ii.value,ue=xi.value||null,Ee=Za.value.trim()||null,Ae=Array.from(cs.querySelectorAll("input:checked")).map(ws=>parseInt(ws.value,10)),$e=Va.value||null,Ke=Ja.value||null,nt=new Vs({name:U,type:re,educationalSystem:me,level:ue,scheduleText:Ee,scheduleDays:Ae,scheduleStartTime:$e,scheduleEndTime:Ke});ie[U]=nt,se(),He(),Gs(),j(`âœ… Ú©Ù„Ø§Ø³ Â«${U}Â» Ø§ÛŒØ¬Ø§Ø¯ Ø´Ø¯.`)}catch(U){console.error("CRASH ERROR:",U),j("Ø®Ø·Ø§ÛŒÛŒ Ø±Ø® Ø¯Ø§Ø¯: "+U.message)}}):console.error("âŒ DEBUG: Create Button (ui.confirmAddClassBtn) is NOT found!"),e.addEventListener("input",M=>{const G=M.target.value;if(G.length<2){Gn([]);return}const U=G.toLowerCase(),ne=Fn(U),re=[];for(const me in ie){const ue=ie[me];if(ue.isDeleted)continue;const Ee=Fe(me.toLowerCase()),Ae=Ee.includes(Fe(U)),$e=Ee.includes(Fe(ne));(Ae||$e)&&re.push({type:"classroom",classroom:ue})}for(const me in ie){const ue=ie[me];if(ue.isDeleted)continue;ye(ue.students).filter(Ae=>{const $e=Fe(Ae.identity.name.toLowerCase()),Ke=$e.includes(Fe(U)),nt=$e.includes(Fe(ne));return Ke||nt}).forEach(Ae=>{re.push({type:"student",student:Ae,classroom:ue})})}Gn(re)}),s.addEventListener("click",Xa),u.addEventListener("click",()=>{Yt("selector")}),oe.addEventListener("input",M=>{const G=M.target.value;if(!G){dn([]);return}const U=G.toLowerCase(),ne=Fn(U),me=ye(N.students).filter(ue=>{const Ee=Fe(ue.identity.name.toLowerCase()),Ae=Ee.includes(Fe(U)),$e=Ee.includes(Fe(ne));return Ae||$e});dn(me)}),oe.addEventListener("focus",()=>{oe.value&&dn(oe.value)}),xt.addEventListener("click",()=>{const M=Ye.value,G=Xe.value.trim();let U;if(Qn)U=Qn.student;else{const re=K==null?void 0:K.winnerHistory[tt];U=re==null?void 0:re.winner}if(!U){j("âŒØ®Ø·Ø§: Ø¯Ø§Ù†Ø´â€ŒØ¢Ù…ÙˆØ² Ù…Ø¹ØªØ¨Ø±ÛŒ Ø¨Ø±Ø§ÛŒ Ø«Ø¨Øª Ù†Ù…Ø±Ù‡ ÛŒØ§ÙØª Ù†Ø´Ø¯.");return}const ne=Me;if(!U||!ne){j("âš ï¸Ù„Ø·ÙØ§Ù‹ Ø§Ø¨ØªØ¯Ø§ ÛŒÚ© Ø¯Ø§Ù†Ø´â€ŒØ¢Ù…ÙˆØ² Ùˆ ÛŒÚ© Ø¯Ø³ØªÙ‡â€ŒØ¨Ù†Ø¯ÛŒ Ø±Ø§ Ø§Ù†ØªØ®Ø§Ø¨ Ú©Ù†ÛŒØ¯.");return}if(!M){j("âš ï¸Ù„Ø·ÙØ§Ù‹ Ù…Ù‚Ø¯Ø§Ø± Ù†Ù…Ø±Ù‡ Ø±Ø§ ÙˆØ§Ø±Ø¯ Ú©Ù†ÛŒØ¯.");return}if(M>100||M<0){j("âŒÙ†Ù…Ø±Ù‡ Ù†Ø¨Ø§ÛŒØ¯ Ø§Ø² Û±Û°Û° Ø¨ÛŒØ´ØªØ± Ùˆ Ø§Ø² ØµÙØ± Ú©Ù…ØªØ± Ø¨Ø§Ø´Ø¯");return}U&&(U.addScore(ne.name,parseFloat(M),G),Ce(N.info.name,`Ù†Ù…Ø±Ù‡ ${M} Ø¯Ø± ${ne.name} Ø¨Ø±Ø§ÛŒ Â«${U.identity.name}Â» Ø«Ø¨Øª Ø´Ø¯.`,{type:"VIEW_STUDENT_PROFILE",studentId:U.identity.studentId}),se(),Oe(),j(`âœ…Ù†Ù…Ø±Ù‡ Ø¨Ø±Ø§ÛŒ ${U.identity.name} Ø¯Ø± Ù…Ù‡Ø§Ø±Øª ${ne.name} Ø«Ø¨Øª Ø´Ø¯.`),vi(Me.id,U.identity.studentId),Ye.value="",Xe.value="",Re())}),wn(Ye,"Enter",()=>{En(Ye),xt.click()}),Ei(Ye),wn(Xe,"Enter",()=>{En(Xe),xt.click()}),F.addEventListener("click",()=>{fe()}),g.addEventListener("click",()=>{const M=z.value.trim(),G=ni;if(typeof G=="function"){const U=G(M);if(U===!1)return;fe(()=>{typeof U=="function"&&U()})}else fe()});const te=document.getElementById("move-student-confirm-btn"),Y=document.getElementById("move-student-cancel-btn"),ae=document.getElementById("move-student-class-select");Y.addEventListener("click",()=>{fe()}),te.addEventListener("click",()=>{const M=ae.value,G=ie[M],{studentToMove:U,sourceClassForMove:ne}=va;if(!U||!ne||!G){j("Ø®Ø·Ø§ÛŒÛŒ Ø±Ø® Ø¯Ø§Ø¯. Ù„Ø·ÙØ§Ù‹ Ø¯ÙˆØ¨Ø§Ø±Ù‡ Ø§Ù…ØªØ­Ø§Ù† Ú©Ù†ÛŒØ¯âš ï¸.","error"),fe();return}const re=la(U,ne,G);re.success?(Ce(ne.info.name,`Ø¯Ø§Ù†Ø´â€ŒØ¢Ù…ÙˆØ² Â«${U.identity.name}Â» Ø¨Ù‡ Ú©Ù„Ø§Ø³ Â«${M}Â» Ù…Ù†ØªÙ‚Ù„ Ø´Ø¯.`,{type:"VIEW_SESSIONS"}),Ce(M,`Ø¯Ø§Ù†Ø´â€ŒØ¢Ù…ÙˆØ² Â«${U.identity.name}Â» Ø§Ø² Ú©Ù„Ø§Ø³ Â«${ne.info.name}Â» Ø¨Ù‡ Ø§ÛŒÙ† Ú©Ù„Ø§Ø³ Ù…Ù†ØªÙ‚Ù„ Ø´Ø¯.`,{type:"VIEW_SESSIONS"}),se(),Tt(),Oe(),rt(),j(`Ø¯Ø§Ù†Ø´â€ŒØ¢Ù…ÙˆØ² Â«${U.identity.name}Â» Ø¨Ø§ Ù…ÙˆÙÙ‚ÛŒØª Ø¨Ù‡ Ú©Ù„Ø§Ø³ Â«${M}Â» Ù…Ù†ØªÙ‚Ù„ Ø´Ø¯âœ….`)):j(re.message,"error"),fe()}),C.addEventListener("click",()=>{S.style.width="300px",k.classList.add("modal-visible")}),C.addEventListener("click",()=>{S.style.width="300px",k.classList.add("modal-visible")});const we=document.getElementById("header-settings-btn");we&&we.addEventListener("click",()=>{N&&Lt(N)}),_.addEventListener("click",je),_.addEventListener("click",je),k.addEventListener("click",je),Ne.addEventListener("click",()=>{In(),Se("trash-page"),je()});const he=document.getElementById("restore-points-nav-btn");he&&he.addEventListener("click",()=>{lr(),Se("restore-points-page"),je()}),document.getElementById("demo-mode-btn").addEventListener("click",()=>{yt?Vi():(je(),ge("Ø´Ù…Ø§ Ø¯Ø± Ø­Ø§Ù„ ÙˆØ±ÙˆØ¯ Ø¨Ù‡ Ø­Ø§Ù„Øª Ù†Ù…Ø§ÛŒØ´ (Demo) Ù‡Ø³ØªÛŒØ¯. Ø¯Ø± Ø§ÛŒÙ† Ø­Ø§Ù„ØªØŒ Ù‡ÛŒÚ†â€ŒÚ©Ø¯Ø§Ù… Ø§Ø² ØªØºÛŒÛŒØ±Ø§Øª Ø´Ù…Ø§ Ø°Ø®ÛŒØ±Ù‡ Ù†Ø®ÙˆØ§Ù‡Ø¯ Ø´Ø¯. Ø¢ÛŒØ§ Ø§Ø¯Ø§Ù…Ù‡ Ù…ÛŒâ€ŒØ¯Ù‡ÛŒØ¯ØŸ",()=>{hc(),fs(),je()},{confirmText:"ØªØ§ÛŒÛŒØ¯",confirmClass:"btn-warning",onCancel:je}))});const Ct=document.getElementById("exit-demo-btn");Ct&&Ct.addEventListener("click",()=>{yt&&Vi()}),x.addEventListener("click",()=>{if(yt){j("âš ï¸ Ù¾Ø´ØªÛŒØ¨Ø§Ù†â€ŒÚ¯ÛŒØ±ÛŒ Ø¯Ø± Ø­Ø§Ù„Øª Ù†Ù…Ø§ÛŒØ´ (Demo) ØºÛŒØ±ÙØ¹Ø§Ù„ Ø§Ø³Øª."),je();return}je(),is()}),L.addEventListener("click",()=>{if(yt){j("âš ï¸ Ø¨Ø§Ø²ÛŒØ§Ø¨ÛŒ Ø§Ø·Ù„Ø§Ø¹Ø§Øª Ø¯Ø± Ø­Ø§Ù„Øª Ù†Ù…Ø§ÛŒØ´ (Demo) ØºÛŒØ±ÙØ¹Ø§Ù„ Ø§Ø³Øª."),je();return}B.click(),je()}),B.addEventListener("change",M=>{const G=M.target.files[0];if(!G)return;const U=new FileReader;U.onload=async ne=>{const re=ne.target.result;try{const me=JSON.parse(re);if(me.metadata&&me.data)ds(me);else{const ue=me.classrooms||me,Ee=me.trashBin||[];ge("Ø¢ÛŒØ§ Ø§Ø² Ø¨Ø§Ø²ÛŒØ§Ø¨ÛŒ Ø§Ø·Ù„Ø§Ø¹Ø§Øª Ù…Ø·Ù…Ø¦Ù† Ù‡Ø³ØªÛŒØ¯ØŸ ØªÙ…Ø§Ù… Ø¯Ø§Ø¯Ù‡â€ŒÙ‡Ø§ÛŒ ÙØ¹Ù„ÛŒ Ø´Ù…Ø§ Ø¨Ø§Ø²Ù†ÙˆÛŒØ³ÛŒ Ø®ÙˆØ§Ù‡Ø¯ Ø´Ø¯.",()=>{zt(ue),gi(Ee),_t({lastRestoreTimestamp:new Date().toISOString()}),se(),He(),Se("class-management-page"),j("âœ…Ø§Ø·Ù„Ø§Ø¹Ø§Øª Ø¨Ø§ Ù…ÙˆÙÙ‚ÛŒØª Ø¨Ø§Ø²ÛŒØ§Ø¨ÛŒ Ø´Ø¯.")},{confirmText:"Ø¨Ø§Ø²ÛŒØ§Ø¨ÛŒ Ú©Ù†",confirmClass:"btn-warning"})}}catch{try{const Ae=(await new Ci().loadAsync(re,{base64:!0})).file("backup.json");if(!Ae)throw new Error("ÙØ§ÛŒÙ„ backup.json Ø¯Ø± ÙØ§ÛŒÙ„ Ù¾Ø´ØªÛŒØ¨Ø§Ù† ÛŒØ§ÙØª Ù†Ø´Ø¯.");const $e=await Ae.async("string"),Ke=JSON.parse($e);if(Ke.metadata&&Ke.metadata.version==="2.0-b64")ds(Ke);else throw new Error("ÙØ§ÛŒÙ„ Ù¾Ø´ØªÛŒØ¨Ø§Ù† Ù…Ø¹ØªØ¨Ø± Ù†ÛŒØ³Øª (Ù†Ø³Ø®Ù‡ Ù†Ø§Ù…Ø´Ø®Øµ).")}catch(ue){j("âŒØ®Ø·Ø§ Ø¯Ø± Ø®ÙˆØ§Ù†Ø¯Ù† ÙØ§ÛŒÙ„. Ù„Ø·ÙØ§Ù‹ ÙØ§ÛŒÙ„ Ù¾Ø´ØªÛŒØ¨Ø§Ù† Ù…Ø¹ØªØ¨Ø± Ø§Ù†ØªØ®Ø§Ø¨ Ú©Ù†ÛŒØ¯."),console.error("Restore error (zip/base64):",ue)}}},U.readAsText(G),M.target.value=null}),window.addEventListener("popstate",M=>{if(vt||ai){fe(null,!0),ri(!1);return}Ot(),$i(!0)}),gc(y),Ze(".global-search-container .animated-search-container",Gn),Ze(".action-column-header .animated-search-container",dn),wc(),[ve,Fa,Xe,Aa].forEach(M=>{M&&Mi(M)});function wt(M,G){const U=ye(G.students).filter(ke=>ke.identity.studentId!==M.identity.studentId);if(U.length===0)return;const ne=U.reduce((ke,Pe)=>Pe.statusCounters.totalSelections>ke.statusCounters.totalSelections?Pe:ke,U[0]);if(!ne||ne.statusCounters.totalSelections===0)return;M.categoryCounts=JSON.parse(JSON.stringify(ne.categoryCounts)),M.statusCounters.totalSelections=ne.statusCounters.totalSelections;const re=U.reduce((ke,Pe)=>ke+Pe.statusCounters.totalSelections,0),me=U.reduce((ke,Pe)=>ke+(Pe.statusCounters.missedChances||0),0),ue=re>0?me/re:0;M.statusCounters.missedChances=Math.round(M.statusCounters.totalSelections*ue);const Ee=ye(G.categories),Ae={};Ee.forEach(ke=>{const Pe=U.reduce((Ss,_s)=>Ss+(_s.categoryCounts[ke.name]||0),0),Es=U.reduce((Ss,_s)=>Ss+(_s.categoryIssues[ke.name]||0),0);Ae[ke.name]=Pe>0?Es/Pe:0}),Ee.forEach(ke=>{const Pe=M.categoryCounts[ke.name]||0,Es=Ae[ke.name]||0;M.categoryIssues[ke.name]=Math.round(Pe*Es)});const $e=G.liveSession;$e?M.onboardingSession=$e.sessionNumber:M.onboardingSession=G.sessions.length+1;const Ke=ye(G.sessions).filter(ke=>ke.isFinished&&!ke.isCancelled),nt="ðŸ“ ÛŒØ§Ø¯Ø¯Ø§Ø´Øª Ø®ÙˆØ¯Ú©Ø§Ø± Ø³ÛŒØ³ØªÙ…",gr=`Ø§ÛŒÙ† Ø¯Ø§Ù†Ø´â€ŒØ¢Ù…ÙˆØ²  Ø§Ø² Ø¬Ù„Ø³Ù‡ Ø´Ù…Ø§Ø±Ù‡ ${Ke.length} Ø¨Ù‡ Ú©Ù„Ø§Ø³ Ø§Ø¶Ø§ÙÙ‡ Ø´Ø¯. Ø¢Ù…Ø§Ø± Ù…Ø´Ø§Ø±Ú©Øª Ø§Ùˆ Ø¨Ø± Ø§Ø³Ø§Ø³ ÙØ¹Ø§Ù„â€ŒØªØ±ÛŒÙ† Ø¯Ø§Ù†Ø´â€ŒØ¢Ù…ÙˆØ² Ùˆ Ø¢Ù…Ø§Ø± Â«ÙØ±ØµØª Ø§Ø² Ø¯Ø³Øª Ø±ÙØªÙ‡Â» Ø§Ùˆ Ø¨Ø± Ø§Ø³Ø§Ø³ Ù…ÛŒØ§Ù†Ú¯ÛŒÙ† Ú©Ù„Ø§Ø³ Ø«Ø¨Øª Ú¯Ø±Ø¯ÛŒØ¯:`,Ft=[];M.statusCounters.totalSelections>0&&Ft.push(`Ú©Ù„ Ø§Ù†ØªØ®Ø§Ø¨â€ŒÙ‡Ø§: ${M.statusCounters.totalSelections}`),M.statusCounters.missedChances>0&&Ft.push(`ÙØ±ØµØªâ€ŒÙ‡Ø§ÛŒ Ø§Ø² Ø¯Ø³Øª Ø±ÙØªÙ‡: ${M.statusCounters.missedChances}`);for(const ke in M.categoryCounts){const Pe=M.categoryCounts[ke];Pe>0&&Ft.push(`Ø§Ù†ØªØ®Ø§Ø¨ Ø¯Ø± Â«${ke}Â»: ${Pe}`)}for(const ke in M.categoryIssues){const Pe=M.categoryIssues[ke];Pe>0&&Ft.push(`Ù…Ø´Ú©Ù„ Ø¯Ø± Â«${ke}Â»: ${Pe}`)}if(Ft.length>0){const ke=`${nt}
${gr}

- ${Ft.join(`
- `)}`;M.addNote(ke)}}function Le(M,G=""){const U=M>1?"Ø¯Ø§Ù†Ø´â€ŒØ¢Ù…ÙˆØ²Ø§Ù† Ø¬Ø¯ÛŒØ¯":"Ø¯Ø§Ù†Ø´â€ŒØ¢Ù…ÙˆØ² Ø¬Ø¯ÛŒØ¯";let ne=`âœ… ${M} ${U} Ø¨Ø§ Ù…ÙˆÙÙ‚ÛŒØª Ø§Ø¶Ø§ÙÙ‡ Ø´Ø¯Ù†Ø¯.
`;ne+="ðŸ’¡ Ú†ÙˆÙ† Ø§ÛŒÙ† Ú©Ù„Ø§Ø³ Ø¬Ù„Ø³Ø§Øª Ø¨Ø±Ú¯Ø²Ø§Ø± Ø´Ø¯Ù‡ Ø¯Ø§Ø±Ø¯ØŒ Ø¨Ø±Ø§ÛŒ Ø§ÛŒÙ† Ø§ÙØ±Ø§Ø¯ Ø¢Ù…Ø§Ø± Ù¾Ø§ÛŒÙ‡â€ŒØ§ÛŒ (Ù…ØªÙ†Ø§Ø³Ø¨ Ø¨Ø§ Ú©Ù„Ø§Ø³) Ø«Ø¨Øª Ø´Ø¯ ØªØ§ Ø¯Ø± ÙØ±Ø§ÛŒÙ†Ø¯ Ø§Ù†ØªØ®Ø§Ø¨ Ø§Ø®ØªÙ„Ø§Ù„ÛŒ Ø§ÛŒØ¬Ø§Ø¯ Ù†Ø´ÙˆØ¯.",G&&(ne+=`
${G}`),ge(ne,()=>{},{confirmText:"Ù…ØªÙˆØ¬Ù‡ Ø´Ø¯Ù…",confirmClass:"btn-success",onCancel:null})}const Pt="23.3.3",en="998";{const M=` (Ø³Ø§Ø®Øª ${en})`;document.getElementById("app-version").textContent=`Ù†Ø³Ø®Ù‡ ${Pt}${M}`}function ct(M){if(!M||!M.classroomName)return;const G=ie[M.classroomName];if(!G){j("âš ï¸ Ú©Ù„Ø§Ø³ Ù…Ø±Ø¨ÙˆØ· Ø¨Ù‡ Ø§ÛŒÙ† Ú¯Ø²Ø§Ø±Ø´ ÛŒØ§ÙØª Ù†Ø´Ø¯.");return}Ge(G),fe(),setTimeout(()=>{switch(M.type){case"VIEW_STUDENT_PROFILE":{const U=G.students.find(ne=>ne.identity.studentId===M.studentId);U?We(U):j("âš ï¸ Ø¯Ø§Ù†Ø´â€ŒØ¢Ù…ÙˆØ² Ù…ÙˆØ±Ø¯ Ù†Ø¸Ø± ÛŒØ§ÙØª Ù†Ø´Ø¯.");break}case"VIEW_TRASH":In(),Se("trash-page");break;case"VIEW_SESSIONS":qe(),Se("session-page");break;case"VIEW_CLASS_NOTE":vs(G);break;case"VIEW_CLASS_SETTINGS":Lt(G);break}},300)}le.addEventListener("click",()=>{Ni()}),R.addEventListener("click",()=>{fe()}),A.addEventListener("click",()=>{const M=ce.value.trim(),G=ee.checked;if(!M){Li.style.display==="flex"?ge("Ú©Ø§Ø¯Ø± ÛŒØ§Ø¯Ø¯Ø§Ø´Øª Ø®Ø§Ù„ÛŒ Ø§Ø³Øª. Ø¢ÛŒØ§ Ù…Ø·Ù…Ø¦Ù†ÛŒØ¯ Ú©Ù‡ Ù…ÛŒâ€ŒØ®ÙˆØ§Ù‡ÛŒØ¯ ÛŒØ§Ø¯Ø¯Ø§Ø´Øªâ€ŒÙ‡Ø§ÛŒ Ù‚Ø¨Ù„ÛŒ Ø¯Ø§Ù†Ø´â€ŒØ¢Ù…ÙˆØ²Ø§Ù† Ø§Ù†ØªØ®Ø§Ø¨â€ŒØ´Ø¯Ù‡ Ø±Ø§ Ù¾Ø§Ú© Ú©Ù†ÛŒØ¯ØŸ",()=>{fe(),Us("",!1)},{confirmText:"Ù¾Ø§Ú© Ú©Ø±Ø¯Ù†",confirmClass:"btn-warning"}):j("âš ï¸ Ù„Ø·ÙØ§Ù‹ Ù…ØªÙ† ÛŒØ§Ø¯Ø¯Ø§Ø´Øª Ø±Ø§ ÙˆØ§Ø±Ø¯ Ú©Ù†ÛŒØ¯.");return}fe(()=>{Us(M,G)})});const ft=document.getElementById("screen-saver-overlay");let tn;const Cs=2*60*1e3,Dn=["mousemove","keypress","scroll","click","touchstart"];function Nn(){ft.classList.add("visible")}function Et(){ft.classList.contains("visible")&&ft.classList.remove("visible")}function pt(){Et(),clearTimeout(tn),tn=setTimeout(Nn,Cs)}function An(M){M.preventDefault(),M.stopPropagation(),setTimeout(pt,0)}function Pi(){pt(),Dn.forEach(G=>window.addEventListener(G,pt)),ft.addEventListener("click",An),ft.addEventListener("touchstart",An);const M="23.3.3";{const G=document.getElementById("screen-saver-version");G&&(G.textContent=`v${M}`)}}function pr(){clearTimeout(tn),Et(),Dn.forEach(M=>window.removeEventListener(M,pt)),ft.removeEventListener("click",An),ft.removeEventListener("touchstart",An)}document.getElementById("app-settings-modal");const Fi=document.getElementById("app-settings-nav-btn"),Hi=document.getElementById("close-settings-btn"),Ui=document.getElementById("setting-sound-toggle"),Wi=document.getElementById("setting-vibration-toggle"),ji=document.getElementById("setting-screensaver-toggle");Fi&&Fi.addEventListener("click",()=>{je(),Ui.checked=ze.isSoundEnabled,Wi.checked=ze.isVibrationEnabled,ji.checked=ze.isScreenSaverEnabled,Te("app-settings-modal")}),Hi&&Hi.addEventListener("click",()=>{fe()}),Ui.addEventListener("change",M=>{_t({isSoundEnabled:M.target.checked}),M.target.checked&&Ls()}),Wi.addEventListener("change",M=>{_t({isVibrationEnabled:M.target.checked}),M.target.checked&&navigator.vibrate&&navigator.vibrate(50)}),ze.isScreenSaverEnabled&&Pi(),ji.addEventListener("change",M=>{M.target.checked?(_t({isScreenSaverEnabled:!0}),Pi()):(_t({isScreenSaverEnabled:!1}),pr())}),qt(Qe,()=>{if(Is=!0,!Me){j("âš ï¸ Ø§Ø¨ØªØ¯Ø§ ÛŒÚ© Ø¯Ø³ØªÙ‡â€ŒØ¨Ù†Ø¯ÛŒ Ø§Ù†ØªØ®Ø§Ø¨ Ú©Ù†ÛŒØ¯.");return}if(!Me.isGradedCategory){j("âš ï¸ Ø§ÛŒÙ† Ø¯Ø³ØªÙ‡â€ŒØ¨Ù†Ø¯ÛŒ Ù†Ù…Ø±Ù‡â€ŒØ¯Ø§Ø± Ù†ÛŒØ³Øª.");return}aa(!Nt),bt(-1),Jt(null),Re(),kn(Me),Mt.classList.toggle("assessment-mode-active",Nt),j(Nt?"Ø­Ø§Ù„Øª Ø§Ù†ØªØ®Ø§Ø¨ Ø¨Ø±Ø§ÛŒ Ù†Ù…Ø±Ù‡â€ŒØ¯Ù‡ÛŒ ÙØ¹Ø§Ù„ Ø´Ø¯.":"Ø­Ø§Ù„Øª Ø§Ù†ØªØ®Ø§Ø¨ Ù…Ø¹Ù…ÙˆÙ„ÛŒ ÙØ¹Ø§Ù„ Ø´Ø¯.")}),be.addEventListener("click",()=>{bn((M,G,U)=>{if(M){if(N.categories.some(ne=>ne.name.toLowerCase()===M.toLowerCase())){j("âš ï¸ Ø§ÛŒÙ† Ø¯Ø³ØªÙ‡â€ŒØ¨Ù†Ø¯ÛŒ Ù‚Ø¨Ù„Ø§Ù‹ Ø§Ø¶Ø§ÙÙ‡ Ø´Ø¯Ù‡ Ø§Ø³Øª.");return}N.categories.push(new pn(M,"",G,U)),se(),Qt()}}),ur()}),De&&De.addEventListener("change",xn)});function je(){Ma.style.width="0",Oa.classList.add("modal-closing"),setTimeout(()=>{overlay.classList.remove("modal-visible","modal-closing")},300)}zi();function mr(e,s){if(!K||K.isFinished){j("âš ï¸ Ø§Ù…Ú©Ø§Ù† Ù„ØºÙˆ Ø§Ù†ØªØ®Ø§Ø¨ Ø¯Ø± Ø¬Ù„Ø³Ù‡ Ø®Ø§ØªÙ…Ù‡ ÛŒØ§ÙØªÙ‡ ÙˆØ¬ÙˆØ¯ Ù†Ø¯Ø§Ø±Ø¯.");return}if(Nt){ge(`Ø¢ÛŒØ§ Ø§Ø² Ù„ØºÙˆ ÙˆØ¶Ø¹ÛŒØª Ù†Ù…Ø±Ù‡â€ŒØ¯Ù‡ÛŒ Â«${e.identity.name}Â» Ù…Ø·Ù…Ø¦Ù† Ù‡Ø³ØªÛŒØ¯ØŸ Ø§ÛŒÙ† Ø¯Ø§Ù†Ø´â€ŒØ¢Ù…ÙˆØ² Ø¨Ù‡ Ù„ÛŒØ³Øª Ø§Ù†ØªØ¸Ø§Ø± Ø¨Ø§Ø²Ù…ÛŒâ€ŒÚ¯Ø±Ø¯Ø¯.`,()=>{const a=Me.id,n=it[a];n&&(n.scoredThisSession=n.scoredThisSession.filter(r=>r!==e.identity.studentId)),Jt(null),Oe(),Re(),se(),j(`âœ… Â«${e.identity.name}Â» Ø¨Ù‡ Ù„ÛŒØ³Øª Ø§Ù†ØªØ¸Ø§Ø± Ù†Ù…Ø±Ù‡ Ø¨Ø§Ø²Ú¯Ø´Øª.`)});return}const t=K.winnerHistory;if(!(tt===t.length-1)||t.length===0){j("âš ï¸ ÙÙ‚Ø· Ø¢Ø®Ø±ÛŒÙ† Ø§Ù†ØªØ®Ø§Ø¨ Ù‚Ø§Ø¨Ù„ Ù„ØºÙˆ Ø§Ø³Øª.");return}if(t[t.length-1].winner.identity.studentId!==e.identity.studentId){console.error("Undo mismatch!");return}ge(`Ø¢ÛŒØ§ Ø§Ø² Ø­Ø°Ù Ø§Ù†ØªØ®Ø§Ø¨ Â«${e.identity.name}Â» Ø¨Ø±Ø§ÛŒ Â«${s}Â» Ù…Ø·Ù…Ø¦Ù† Ù‡Ø³ØªÛŒØ¯ØŸ Ø¢Ù…Ø§Ø± Ø§ÛŒÙ† Ø§Ù†ØªØ®Ø§Ø¨ Ø¨Ø§Ø²Ú¯Ø±Ø¯Ø§Ù†ÛŒ Ø®ÙˆØ§Ù‡Ø¯ Ø´Ø¯.`,()=>{const a=K.winnerHistory,n=a.pop();if(!n)return;const r=n.winner,i=n.categoryName,o=r.identity.studentId;r.statusCounters.totalSelections=Math.max(0,r.statusCounters.totalSelections-1),r.categoryCounts[i]&&(r.categoryCounts[i]=Math.max(0,r.categoryCounts[i]-1));const l=K.studentRecords[o];if(l&&l.selections[i]&&(l.selections[i]=Math.max(0,l.selections[i]-1)),n.rating){const p=n.rating;r.qualitativeStats&&r.qualitativeStats[i]&&r.qualitativeStats[i][p]>0&&r.qualitativeStats[i][p]--}let f=null;for(let p=a.length-1;p>=0;p--)if(a[p].categoryName===i){f=a[p].winner.identity.studentId;break}f?K.lastWinnerByCategory[i]=f:delete K.lastWinnerByCategory[i],bt(a.length-1),Oe(),Re(),se(),j(`âœ… Ø§Ù†ØªØ®Ø§Ø¨ Â«${r.identity.name}Â» Ù„ØºÙˆ Ø´Ø¯.`)},{confirmText:"Ø¨Ù„Ù‡",confirmClass:"btn-warning"})}function wc(){const e=document.getElementById("session-dashboard-page"),s=document.getElementById("student-stats-table-container");if(!e)return;let t=0,c=0;e.addEventListener("touchstart",n=>{if(s&&s.contains(n.target)){const r=n.target.closest("td, th");r&&r.parentElement.firstElementChild===r?t=n.changedTouches[0].screenX:t=0}else t=n.changedTouches[0].screenX},{passive:!0}),e.addEventListener("touchend",n=>{t!==0&&(c=n.changedTouches[0].screenX,a())});function a(){const r=t-c;Math.abs(r)>150&&(document.getElementById("selector-tab-btn").classList.contains("active")?(Se("session-dashboard-page",{tab:"attendance"}),Yt("attendance")):(Se("session-dashboard-page",{tab:"selector"}),Yt("selector"))),t=0,c=0}}function Ji(e,s){const t=s.toLowerCase();return(e.logs.scores[t]||[]).filter(a=>!a.isDeleted).length}function Ec(e,s){const t=s.id;it[t]||(it[t]={toBeScored:[],scoredThisSession:[]});const c=it[t],n=ye(e.students).filter(o=>!c.scoredThisSession.includes(o.identity.studentId));if(n.length===0)return c.toBeScored=[],[];const r=n.map(o=>Ji(o,s.name)),i=Math.min(...r);return c.toBeScored=n.filter(o=>Ji(o,s.name)===i).map(o=>o.identity.studentId),c.toBeScored}function hr(e,s){const t=Ec(e,s);if(t.length===0)return null;const c=Math.floor(Math.random()*t.length),a=t[c];return vi(s.id,a),e.students.find(n=>n.identity.studentId===a)}
