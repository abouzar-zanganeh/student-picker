(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const a of document.querySelectorAll('link[rel="modulepreload"]'))s(a);new MutationObserver(a=>{for(const o of a)if(o.type==="childList")for(const i of o.addedNodes)i.tagName==="LINK"&&i.rel==="modulepreload"&&s(i)}).observe(document,{childList:!0,subtree:!0});function n(a){const o={};return a.integrity&&(o.integrity=a.integrity),a.referrerPolicy&&(o.referrerPolicy=a.referrerPolicy),a.crossOrigin==="use-credentials"?o.credentials="include":a.crossOrigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function s(a){if(a.ep)return;a.ep=!0;const o=n(a);fetch(a.href,o)}})();class Qe{constructor(t){this.identity={name:t.name,studentId:t.studentId||`id_${new Date().getTime()}_${Math.random()}`,branchName:t.branchName||null,ageGroup:t.ageGroup||"adult",level:t.level||null,contact:{social:t.socialContact||null,parent:t.parentContact||null}},this.isDeleted=!1,this.statusCounters={totalSelections:0,missedChances:0,earlyLeaves:0,outOfClassCount:0},this.categoryCounts={},this.categoryIssues={},this.logs={parentContacts:[],scores:{},discipline:{},sessionHistory:{}},this.profile={notes:[],tags:[]},this.finalClassActivityScore=null}addScore(t,n,s){if(n>100||n<0){console.log("Ù†Ù…Ø±Ù‡ Ù†Ø¨Ø§ÛŒØ¯ Ø§Ø² Û±Û°Û° Ø¨ÛŒØ´ØªØ± Ùˆ Ø§Ø² ØµÙØ± Ú©Ù…ØªØ± Ø¨Ø§Ø´Ø¯");return}const a=t.toLowerCase();this.logs.scores[a]||(this.logs.scores[a]=[]);const o=new Yn(t,n,s);this.logs.scores[a].push(o)}addNote(t,n=null){const s=new Zn(t,n);this.profile.notes.push(s)}getOverallAverageScore(){let t=0,n=0;for(const a in this.logs.scores)this.logs.scores[a].forEach(o=>{o.isDeleted||(t+=o.value,n++)});if(n===0)return null;const s=t/n;return Math.round(s*100)/100}}class Yn{constructor(t,n,s=""){this.id=`score_${new Date().getTime()}`,this.skill=t,this.value=n,this.timestamp=new Date,this.comment=s,this.isDeleted=!1}}class Zn{constructor(t,n=null){this.id=`note_${new Date().getTime()}`,this.timestamp=new Date,this.content=t,this.isDeleted=!1,this.source=n}}class Lt{constructor(t="complete",n=""){this.status=t,this.comment=n,this.timestamp=new Date}}class on{constructor(t){this.sessionNumber=t,this.startTime=new Date,this.note="",this.isDeleted=!1,this.endTime=null,this.isFinished=!1,this.isMakeup=!1,this.isCancelled=!1,this.studentRecords={},this.lastWinnerByCategory={},this.lastUsedCategoryId=null,this.lastSelectedWinnerId=null,this.winnerHistory=[]}end(){this.isFinished=!0,this.endTime=new Date}markAsMakeup(){this.isMakeup=!this.isMakeup}initializeStudentRecord(t){this.studentRecords[t]||(this.studentRecords[t]={attendance:"present",homework:new Lt,selections:{},hadIssue:!1,wasOutOfClass:!1})}setAttendance(t,n){this.initializeStudentRecord(t),this.studentRecords[t].attendance=n}setHomeworkStatus(t,n){this.initializeStudentRecord(t),this.studentRecords[t].homework.status=n}selectNextWinner(t,n,s){if(!n||n.length===0)return console.log("Ù‡ÛŒÚ† Ø¯Ø§Ù†Ø´â€ŒØ¢Ù…ÙˆØ²ÛŒ Ø¯Ø± Ú©Ù„Ø§Ø³ Ø¨Ø±Ø§ÛŒ Ø§Ù†ØªØ®Ø§Ø¨ ÙˆØ¬ÙˆØ¯ Ù†Ø¯Ø§Ø±Ø¯."),null;const a=this.lastWinnerByCategory[t];let o=n.filter(r=>r.identity.studentId!==a);if(o.length===0&&(o=n),o.length===0)return null;const i=(r,u)=>r.categoryCounts[u]||0,l=Math.min(...o.map(r=>i(r,t))),d=o.filter(r=>i(r,t)===l);let m;if(d.length===1)m=d[0];else if(d.length>1){const r=s.filter(L=>!L.isDeleted&&L.name!==t).map(L=>L.name),u=d.map(L=>{const D=r.reduce((H,B)=>H+i(L,B),0);return{student:L,otherCategoriesTotal:D}}),I=Math.min(...u.map(L=>L.otherCategoriesTotal)),E=u.filter(L=>L.otherCategoriesTotal===I).map(L=>L.student);E.length===1?m=E[0]:m=E[Math.floor(Math.random()*E.length)]}else m=o[Math.floor(Math.random()*o.length)];const g=m.identity.studentId;this.initializeStudentRecord(g);const h=(this.studentRecords[g].selections[t]||0)+1;return this.studentRecords[g].selections[t]=h,m.statusCounters.totalSelections++,m.categoryCounts[t]=(m.categoryCounts[t]||0)+1,this.lastWinnerByCategory[t]=g,m}}class kt{constructor(t){this.info={name:t.name||"NotNamed",scheduleCode:t.scheduleCode||`code_${new Date().getTime()}`,teacherName:t.teacherName||null,type:t.type||"in-person",term:t.term||null,scheduleText:t.scheduleText||null,level:t.level||null,creationDate:t.creationDate?new Date(t.creationDate):new Date},this.students=[],this.sessions=[],this.note="",this.isDeleted=!1,this.categories=[new ge("Vocabulary","Questions about words and meanings."),new ge("Grammar","Questions about sentence structure and rules."),new ge("Listening",void 0,!0),new ge("Speaking",void 0,!0),new ge("Reading",void 0,!0),new ge("Writing",void 0,!0)],this.futurePlans={}}addStudent(t){this.students.push(t)}removeStudent(t){this.students=this.students.filter(n=>n.identity.studentId!==t)}startNewSession(){const t=this.sessions.length+1,n=new on(t);return this.sessions.push(n),n}endSpecificSession(t){const n=this.getSession(t);return n&&!n.isFinished?(n.end(),!0):!1}getSession(t){return this.sessions.find(n=>n.sessionNumber===t)}markAsMakeup(t){const n=this.getSession(t);n&&n.markAsMakeup()}planForSession(t,n){this.futurePlans[t]=n}hasSessionToday(){const t=new Date().toDateString();return this.sessions.some(n=>!n.isDeleted&&n.startTime.toDateString()===t)}selectNextWinner(t,n){return n?n.selectNextWinner(t,this.students,this.categories):null}get liveSession(){for(let t=this.sessions.length-1;t>=0;t--)if(!this.sessions[t].isFinished)return this.sessions[t];return null}endLiveSession(){const t=this.liveSession;return t?(t.end(),!0):!1}calculateFinalStudentScore(t){const n=t.logs.scores,s=["reading","writing"];for(const r of s)if(!n[r]||n[r].length===0)return null;const a=n.listening&&n.listening.length>0,o=n.speaking&&n.speaking.length>0;if(!a&&!o)return null;const i=r=>n[r].reduce((I,E)=>I+E.value,0)/n[r].length;let l;a&&o?l=(i("listening")+i("speaking"))/2:a?l=i("listening"):l=i("speaking");const d=i("reading"),m=i("writing"),h=(l*3+d*2+m*1)/6;return Math.trunc(h*10)/10}assignAllFinalScores(){let t=0,n=[];console.log("Ø´Ø±ÙˆØ¹ Ø¹Ù…Ù„ÛŒØ§Øª Ù…Ø­Ø§Ø³Ø¨Ù‡ Ù†Ù…Ø±Ù‡ Ù†Ù‡Ø§ÛŒÛŒ Ø¨Ø±Ø§ÛŒ ØªÙ…Ø§Ù… Ø¯Ø§Ù†Ø´â€ŒØ¢Ù…ÙˆØ²Ø§Ù†..."),this.students.forEach(a=>{const o=this.calculateFinalStudentScore(a);o!==null?(a.finalClassActivityScore=o,t++):(a.finalClassActivityScore=null,n.push(a.identity.name))});const s=n.length;console.log(`Ø¹Ù…Ù„ÛŒØ§Øª Ù¾Ø§ÛŒØ§Ù† ÛŒØ§ÙØª. ØªØ¹Ø¯Ø§Ø¯ Ù†Ù…Ø±Ø§Øª Ù…ÙˆÙÙ‚: ${t} | ØªØ¹Ø¯Ø§Ø¯ Ù†Ø§Ù…ÙˆÙÙ‚ (Ù†Ù…Ø±Ø§Øª Ù†Ø§Ù‚Øµ): ${s}`),s>0&&(console.log("Ø§Ø³Ø§Ù…ÛŒ Ø¯Ø§Ù†Ø´â€ŒØ¢Ù…ÙˆØ²Ø§Ù†ÛŒ Ú©Ù‡ Ù†Ù…Ø±Ø§ØªØ´Ø§Ù† Ù†Ø§Ù‚Øµ Ø§Ø³Øª:"),n.forEach(a=>console.log(`- ${a}`)))}}class ge{constructor(t,n="",s=!1){this.id=`cat_${new Date().getTime()}_${Math.random()}`,this.name=t,this.description=n,this.isDeleted=!1,this.isGradedCategory=s,this.isDeleted=!1}}let M={},p=null,cn=null,b=null,j=null,rt=null,jt=null,ln=[],wt=null,rn=null,ie=null,It=0,dn=0,St=0,un=0,mn=null,fn=null,Nt=null,Ee=null,ue=-1,Bt=null,Tt=null;function w(){localStorage.setItem("teacherAssistantData_v2",JSON.stringify(M))}function es(){const e=JSON.stringify(M,null,2),n=`SP-${new Date().toLocaleDateString("fa-IR-u-nu-latn").replace(/\//g,"-")}.txt`;return new File([e],n,{type:"text/plain"})}function nn(){const e=localStorage.getItem("teacherAssistantData_v2");if(e){const t=JSON.parse(e);_t(t)}}function _t(e){M={};for(const t in e){const n=e[t],s=new kt(n.info);s.isDeleted=n.isDeleted,s.note=n.note||"",s.students=n.students.map(a=>{const o=new Qe(a.identity);return o.isDeleted=a.isDeleted,o.statusCounters=a.statusCounters,o.logs=a.logs,o.logs.scores||(o.logs.scores={}),o.profile=a.profile,o.finalClassActivityScore=a.finalClassActivityScore,o.categoryCounts=a.categoryCounts||{},o.categoryIssues=a.categoryIssues||{},o}),s.sessions=n.sessions.map(a=>{const o=new on(a.sessionNumber);o.isDeleted=a.isDeleted,o.note=a.note||"",o.startTime=new Date(a.startTime),o.endTime=a.endTime?new Date(a.endTime):null,o.isFinished=a.isFinished,o.isMakeup=a.isMakeup,o.isCancelled=a.isCancelled||!1,o.studentRecords=a.studentRecords;for(const l in o.studentRecords){const d=o.studentRecords[l];d.homework&&!(d.homework instanceof Lt)&&(o.studentRecords[l].homework=new Lt(d.homework.status,d.homework.comment))}o.lastWinnerByCategory=a.lastWinnerByCategory,o.lastUsedCategoryId=a.lastUsedCategoryId,o.lastSelectedWinnerId=a.lastSelectedWinnerId;const i=a.winnerHistory||[];return o.winnerHistory=i.map(l=>({winner:s.students.find(m=>m.identity.studentId===l.winner.identity.studentId),categoryName:l.categoryName})),o}),s.categories=n.categories.map(a=>{const o=new ge(a.name,a.description,a.isGradedCategory);return o.id=a.id,o.isDeleted=a.isDeleted,o}),s.futurePlans=n.futurePlans,M[t]=s}}function ts(e,t){if(M[t])return{success:!1,message:"Ú©Ù„Ø§Ø³ÛŒ Ø¨Ø§ Ø§ÛŒÙ† Ù†Ø§Ù… Ø§Ø² Ù‚Ø¨Ù„ ÙˆØ¬ÙˆØ¯ Ø¯Ø§Ø±Ø¯."};const n=M[e];return n?(n.info.name=t,M[t]=n,delete M[e],p===n&&Q(n),{success:!0}):{success:!1,message:"Ú©Ù„Ø§Ø³ Ù…ÙˆØ±Ø¯ Ù†Ø¸Ø± ÛŒØ§ÙØª Ù†Ø´Ø¯."}}function Q(e){p=e}function dt(e){cn=e}function ce(e){b=e}function V(e){j=e}function xt(e){rt=e}function ns(e){jt=e}function Ke(e){ln=e}function bt(e){wt=e}function ss(e){rn=e}function pn(e){ie=e}function vt(e){It=e}function as(e){dn=e}function Et(e){St=e}function os(e){un=e}function hn(e){mn=e}function gn(e){fn=e}function ut(e){Nt=e}function Cn(e){Ee=e}function Dt(e){Tt=e}function is(){for(const e in M){const t=M[e];t.students.forEach(n=>{n.statusCounters={totalSelections:0,missedChances:0,earlyLeaves:0},n.categoryCounts={},n.categoryIssues={},t.sessions.forEach(s=>{const a=n.identity.studentId;s.studentRecords[a]&&(s.studentRecords[a].attendance="present")})})}w()}function W(e){return Array.isArray(e)?e.filter(t=>!t.isDeleted):[]}function ke(e){const t=new Map;return e&&W(e.sessions).filter(s=>!s.isCancelled).sort((s,a)=>s.sessionNumber-a.sessionNumber).forEach((s,a)=>{t.set(s.sessionNumber,a+1)}),t}function De(e){ue=e}function fe(e){Bt=e}function Ne(e){return typeof e!="string"?"":e.replace(/ÙŠ/g,"ÛŒ").replace(/Ùƒ/g,"Ú©")}function Ge(e){return typeof e!="string"||e.length===0?"ltr":/[\u0590-\u07FF]/.test(e)?"rtl":"ltr"}function yn(e){return!e||!e.trim()?"":e.split(`
`).map(s=>`<div dir="${Ge(s)}">${s||"&nbsp;"}</div>`).join("")}function sn(e){if(typeof e!="string")return"";const t={q:"Ø¶",w:"Øµ",e:"Ø«",r:"Ù‚",t:"Ù",y:"Øº",u:"Ø¹",i:"Ù‡",o:"Ø®",p:"Ø­","[":"Ø¬","]":"Ú†",a:"Ø´",s:"Ø³",d:"ÛŒ",f:"Ø¨",g:"Ù„",h:"Ø§",j:"Øª",k:"Ù†",l:"Ù…",";":"Ú©","'":"Ú¯",z:"Ø¸",x:"Ø·",c:"Ø²",v:"Ø±",b:"Ø°",n:"Ø¯",m:"Ù¾",",":"Ùˆ"};let n="";for(let s=0;s<e.length;s++){const a=e[s].toLowerCase();n+=t[a]||e[s]}return n}const bn=document.getElementById("class-management-page"),cs=document.getElementById("new-class-name"),ls=document.getElementById("add-class-btn"),Mt=document.getElementById("class-list"),mt=document.getElementById("undo-toast"),vn=document.getElementById("undo-message"),rs=document.getElementById("undo-btn"),ds=document.getElementById("settings-page"),En=document.getElementById("settings-class-name-header"),$t=document.getElementById("settings-student-list"),Ht=document.getElementById("category-list"),us=document.getElementById("back-to-sessions-btn"),ms=document.getElementById("new-student-name"),fs=document.getElementById("add-student-btn"),Ln=document.getElementById("paste-area"),ps=document.getElementById("process-paste-btn"),hs=document.getElementById("csv-preview-page"),At=document.getElementById("csv-preview-list"),gs=document.getElementById("csv-confirm-btn"),Cs=document.getElementById("csv-cancel-btn"),ys=document.getElementById("import-csv-btn"),bs=document.getElementById("csv-file-input"),vs=document.getElementById("column-mapping-page"),Ot=document.getElementById("column-select-dropdown"),Es=document.getElementById("confirm-column-btn"),Ls=document.getElementById("cancel-import-btn"),ks=document.getElementById("new-category-name"),ws=document.getElementById("add-category-btn"),Rt=document.querySelector(".app-header"),Ce=document.getElementById("select-student-btn"),je=document.getElementById("select-student-btn-wrapper"),Is=document.getElementById("attendance-page"),Xe=document.getElementById("attendance-list"),Ss=document.getElementById("finish-attendance-btn"),Ns=document.getElementById("back-to-sessions-from-attendance-btn"),Bs=document.getElementById("back-to-attendance-btn"),Ts=document.querySelector("#class-management-page h2"),Pt=document.getElementById("student-stats-header"),xs=document.getElementById("hamburger-menu-btn"),Ds=document.getElementById("side-nav-menu"),Ms=document.getElementById("close-nav-btn"),$s=document.getElementById("overlay"),Hs=document.getElementById("backup-data-btn"),As=document.getElementById("restore-data-btn"),kn=document.getElementById("restore-file-input"),Os=document.getElementById("custom-confirm-modal"),wn=document.getElementById("confirm-modal-message"),Ft=document.getElementById("confirm-modal-cancel-btn"),Pe=document.getElementById("confirm-modal-confirm-btn"),Rs=document.getElementById("secure-confirm-modal"),In=document.getElementById("secure-confirm-message"),Sn=document.getElementById("secure-confirm-code"),Be=document.getElementById("secure-confirm-input"),Ps=document.getElementById("secure-confirm-cancel-btn"),Ye=document.getElementById("secure-confirm-confirm-btn"),Fs=document.getElementById("add-note-modal"),A=document.getElementById("new-note-content"),qs=document.getElementById("save-note-btn"),Ws=document.getElementById("cancel-note-btn"),qt=document.getElementById("student-search-input"),pe=document.getElementById("student-search-results"),Us=document.getElementById("student-profile-page"),Nn=document.getElementById("profile-student-name-header"),Gs=document.getElementById("back-to-student-page-btn"),Te=document.getElementById("graded-category-pills-container"),Wt=document.getElementById("new-score-value"),zt=document.getElementById("new-score-comment"),js=document.getElementById("add-score-btn"),Fe=document.getElementById("profile-stats-summary"),Ze=document.getElementById("profile-scores-list"),et=document.getElementById("global-student-search-input"),de=document.getElementById("global-student-search-results"),_s=document.getElementById("is-graded-checkbox"),tt=document.getElementById("trashed-classes-list"),nt=document.getElementById("trashed-students-list"),st=document.getElementById("trashed-sessions-list"),at=document.getElementById("trashed-categories-list"),ot=document.getElementById("trashed-notes-list"),it=document.getElementById("trashed-score-comments-list"),ft=document.getElementById("quick-grade-form-wrapper"),me=document.getElementById("quick-score-input"),le=document.getElementById("quick-note-textarea"),Me=document.getElementById("quick-grade-submit-btn"),Vt=document.getElementById("category-selection-container"),Bn=document.getElementById("selected-student-result"),Le=document.getElementById("custom-context-menu"),xe=document.getElementById("breadcrumb-container");function ze(e){clearTimeout(jt),rt||xt(JSON.stringify(M)),vn.textContent=e,mt.classList.add("show"),ns(setTimeout(()=>{mt.classList.remove("show"),xt(null)},5e3))}function Tn(){if(rt){const e=p?p.info.name:null,t=JSON.parse(rt);_t(t),e&&M[e]?Q(M[e]):Q(null),p?($e(),Ve(),X()):ne(),mt.classList.remove("show"),clearTimeout(jt),xt(null)}}function k(e,t=3e3){const n=document.getElementById("notification-toast");n&&(n.textContent=e,n.classList.add("show"),clearTimeout(rn),ss(setTimeout(()=>{n.classList.remove("show")},t)))}function F(e,t,n={}){const{confirmText:s="ØªØ§ÛŒÛŒØ¯",cancelText:a="Ù„ØºÙˆ",confirmClass:o="btn-success",onCancel:i=()=>{},isDelete:l=!1}=n,d=l?()=>xn(e,t):t;wn.textContent=e,Pe.textContent=s,Ft.textContent=a,Pe.className="modal-action-btn",Pe.classList.add(o),hn(d),gn(i);const m=Pe.parentElement;Ft.style.display=i===null?"none":"inline-block",m.style.justifyContent=i===null?"center":"space-between",ae("custom-confirm-modal")}function xn(e,t){const n=Math.floor(1e4+Math.random()*9e4).toString();In.textContent=e,Sn.textContent=n,Be.value="",Ye.disabled=!0,ut(t),ae("secure-confirm-modal"),Be.focus();const s=()=>{Be.value===n?Ye.disabled=!1:Ye.disabled=!0};return Be.addEventListener("input",s),()=>{Be.removeEventListener("input",s)}}function ae(e){const t=document.getElementById(e);if(t){if(Ee)return;t.classList.add("modal-visible"),Cn(e),history.pushState(null,"",location.href)}}function he(e){if(!Ee)return;const t=document.getElementById(Ee),n=Ee;Cn(null),history.back(),t&&(t.classList.add("modal-closing"),setTimeout(()=>{t.classList.remove("modal-visible"),t.classList.remove("modal-closing"),n==="custom-confirm-modal"&&(hn(null),gn(null)),n==="secure-confirm-modal"&&ut(null),n==="add-note-modal"&&fe(null),typeof e=="function"&&e()},300))}function Ut(e){const t=URL.createObjectURL(e),n=document.createElement("a");n.href=t,n.download=e.name,document.body.appendChild(n),n.click(),document.body.removeChild(n),URL.revokeObjectURL(t)}async function Jt(){const e=es();if(("ontouchstart"in window||navigator.maxTouchPoints>0)&&navigator.share&&navigator.canShare&&navigator.canShare({files:[e]}))try{await navigator.share({title:"Ù¾Ø´ØªÛŒØ¨Ø§Ù† Ø¯Ø³ØªÛŒØ§Ø± Ù…Ø¹Ù„Ù…",text:"ÙØ§ÛŒÙ„ Ù¾Ø´ØªÛŒØ¨Ø§Ù† Ø¯Ø§Ø¯Ù‡â€ŒÙ‡Ø§ÛŒ Ø¨Ø±Ù†Ø§Ù…Ù‡",files:[e]})}catch(n){n.name!=="AbortError"&&(console.error("Error sharing file:",n),Ut(e),k("âš ï¸Ø§Ø´ØªØ±Ø§Ú©â€ŒÚ¯Ø°Ø§Ø±ÛŒ Ø¨Ø§ Ø®Ø·Ø§ Ù…ÙˆØ§Ø¬Ù‡ Ø´Ø¯. ÙØ§ÛŒÙ„ Ø¯Ø± Ø­Ø§Ù„ Ø¯Ø§Ù†Ù„ÙˆØ¯ Ø§Ø³Øª."))}else Ut(e),k("âœ…Ù¾Ø´ØªÛŒØ¨Ø§Ù†â€ŒÚ¯ÛŒØ±ÛŒ Ø¨Ø§ Ù…ÙˆÙÙ‚ÛŒØª Ø§Ù†Ø¬Ø§Ù… Ø´Ø¯.")}function Kt(e,t){e.preventDefault(),ve(),setTimeout(()=>{const n=Le,s=n.querySelector("ul");s.innerHTML="",t.forEach(g=>{const h=document.createElement("li");g.isSeparator?h.className="separator":(h.innerHTML=`
                    <span class="icon">${g.icon||""}</span>
                    <span class="label">${g.label}</span>
                `,g.className&&h.classList.add(g.className),h.addEventListener("click",()=>{g.action(),ve()})),s.appendChild(h)});const{clientX:a,clientY:o}=e,{innerWidth:i,innerHeight:l}=window;n.style.top=`${o}px`,n.style.left=`${a}px`,n.classList.add("visible");const{offsetWidth:d,offsetHeight:m}=n;a+d>i&&(n.style.left=`${i-d-5}px`),o+m>l&&(n.style.top=`${l-m-5}px`)},50)}function ve(){Le.classList.contains("visible")&&Le.classList.remove("visible")}function Dn(){var t,n;xe.innerHTML="";const e=[];if(e.push({label:"Ú©Ù„Ø§Ø³â€ŒÙ‡Ø§",handler:()=>{Q(null),ce(null),V(null),N("class-management-page")}}),p){if(e.push({label:p.info.name,handler:()=>{ce(null),V(null),N("session-page")}}),((t=document.querySelector(".page.active"))==null?void 0:t.id)==="settings-page")e.push({label:"ØªÙ†Ø¸ÛŒÙ…Ø§Øª"});else if(b){const o=ke(p).get(b.sessionNumber)||` (#${b.sessionNumber})`;e.push({label:`Ø¬Ù„Ø³Ù‡ ${o}`,handler:()=>{V(null),N("student-page")}});const i=(n=document.querySelector(".page.active"))==null?void 0:n.id;j?e.push({label:`Ù¾Ø±ÙˆÙØ§ÛŒÙ„: ${j.identity.name}`}):i==="attendance-page"&&e.push({label:"Ø­Ø¶ÙˆØ± Ùˆ ØºÛŒØ§Ø¨"})}}if(e.length<=1){xe.style.display="none";return}xe.style.display="flex",e.forEach((s,a)=>{const o=document.createElement("a");if(o.textContent=s.label,o.className="breadcrumb-item",a===e.length-1||!s.handler?o.classList.add("active"):o.addEventListener("click",s.handler),xe.appendChild(o),a<e.length-1){const i=document.createElement("span");i.className="breadcrumb-separator",i.textContent="/",xe.appendChild(i)}})}function an(e,t,n){n.innerHTML="";const s=p.sessions.filter(a=>{var o;return!a.isDeleted&&!a.isCancelled&&((o=a.studentRecords[e.identity.studentId])==null?void 0:o.attendance)==="absent"}).map(a=>({number:t.get(a.sessionNumber),isMakeup:a.isMakeup})).filter(a=>a.number!==void 0);s.length>0?(n.appendChild(document.createTextNode("Ø¬Ù„Ø³Ø§Øª ØºØ§ÛŒØ¨: ")),s.forEach((a,o)=>{const i=document.createElement("span");i.textContent=a.number,a.isMakeup&&i.classList.add("makeup-absence"),n.appendChild(i),o<s.length-1&&n.appendChild(document.createTextNode("ØŒ "))})):n.textContent="Ø¬Ù„Ø³Ø§Øª ØºØ§ÛŒØ¨: Ø¨Ø¯ÙˆÙ† ØºÛŒØ¨Øª"}function ct(e,t,n,s={}){const{includePrefix:a=!0}=s;n.innerHTML="";const o=p.sessions.filter(i=>{if(i.isDeleted||i.isCancelled)return!1;const l=i.studentRecords[e.identity.studentId];return l&&l.homework&&(l.homework.status==="incomplete"||l.homework.status==="none")}).map(i=>({number:t.get(i.sessionNumber),status:i.studentRecords[e.identity.studentId].homework.status})).filter(i=>i.number!==void 0);o.length>0?(a&&n.appendChild(document.createTextNode("ØªÚ©Ø§Ù„ÛŒÙ Ù†Ø§Ù‚Øµ: ")),o.forEach((i,l)=>{const d=document.createElement("span");d.textContent=i.number,i.status==="incomplete"&&d.classList.add("incomplete-homework"),n.appendChild(d),l<o.length-1&&n.appendChild(document.createTextNode("ØŒ"))})):a?n.textContent="ØªÚ©Ø§Ù„ÛŒÙ Ù†Ø§Ù‚Øµ: Ù†Ø¯Ø§Ø±Ø¯":n.textContent="Ù†Ø¯Ø§Ø±Ø¯"}function zs(e,t){var L,D,H;const n=document.createElement("li");n.className="attendance-list-item";const s={none:"Ø¨Ø¯ÙˆÙ† ØªÚ©Ù„ÛŒÙ",complete:"ØªÚ©Ù„ÛŒÙ Ú©Ø§Ù…Ù„",incomplete:"ØªÚ©Ù„ÛŒÙ Ù†Ø§Ù‚Øµ"},a=document.createElement("div");a.className="student-info";const o=document.createElement("span");o.className="student-name",o.textContent=e.identity.name,o.addEventListener("click",()=>{V(e),se(),N("student-profile-page")});const i=document.createElement("span");i.className="absence-info";const l=document.createElement("span");l.className="homework-info",an(e,t,i),ct(e,t,l),a.appendChild(o),a.appendChild(i),a.appendChild(l);const d=document.createElement("div");d.className="homework-controls";const m=document.createElement("button"),g=((L=b.studentRecords[e.identity.studentId])==null?void 0:L.homework.status)||"none";m.className=`homework-status-btn ${g}`,m.title=s[g],m.addEventListener("click",()=>{const B=b.studentRecords[e.identity.studentId].homework,O={none:"incomplete",incomplete:"complete",complete:"none"}[B.status];m.title=s[O],b.setHomeworkStatus(e.identity.studentId,O),w(),m.className=`homework-status-btn ${O}`,ct(e,t,l)});const h=document.createElement("button");h.className="btn-icon",h.innerHTML="ğŸ“",h.title="Ø§ÙØ²ÙˆØ¯Ù† ÛŒØ§Ø¯Ø¯Ø§Ø´Øª Ø¨Ø±Ø§ÛŒ ØªÚ©Ù„ÛŒÙ",((D=b.studentRecords[e.identity.studentId])==null?void 0:D.homework.comment)||(h.style.opacity="0.3"),h.addEventListener("click",()=>{const B=b.studentRecords[e.identity.studentId].homework;A.value=B.comment||"",A.dispatchEvent(new Event("input",{bubbles:!0})),fe($=>{B.comment=$;const O=ke(p),oe=O.get(b.sessionNumber),z={type:"fromAttendance",sessionNumber:b.sessionNumber},re=`ÛŒØ§Ø¯Ø¯Ø§Ø´Øª Ø­Ø¶ÙˆØ±-ØºÛŒØ§Ø¨ ${oe}: `,U=e.profile.notes.find(Y=>!Y.isDeleted&&Y.source&&Y.source.type==="fromAttendance"&&Y.source.sessionNumber===z.sessionNumber);U?$?U.content=re+$:U.isDeleted=!0:$&&e.addNote(re+$,z),w(),h.style.opacity=$?"1":"0.3",ct(e,O,l)}),ae("add-note-modal"),A.focus()}),d.appendChild(m),d.appendChild(h);const u=document.createElement("button"),I=((H=b.studentRecords[e.identity.studentId])==null?void 0:H.attendance)||"present",E=B=>{B==="present"?(u.textContent="Ø­Ø§Ø¶Ø±",u.className="attendance-status-btn present active"):(u.textContent="ØºØ§ÛŒØ¨",u.className="attendance-status-btn absent active")};return E(I),u.addEventListener("click",()=>{var O;const $=(((O=b.studentRecords[e.identity.studentId])==null?void 0:O.attendance)||"present")==="present"?"absent":"present";b.setAttendance(e.identity.studentId,$),$==="absent"&&(b.studentRecords[e.identity.studentId].hadIssue=!1),w(),E($),an(e,t,i),An()}),n.appendChild(a),n.appendChild(d),n.appendChild(u),n}function Vs(){return ke(p).get(b.sessionNumber)}function We(){if(!p||!b)return;const e=ke(p);sa(),Xe.innerHTML="";const t=document.createElement("li");t.className="attendance-list-header",t.innerHTML=`
    <span class="header-label-spacer"></span>
    <span class="header-label">ØªÚ©Ù„ÛŒÙ</span>
    <span class="header-label">Ø­Ø¶ÙˆØ±</span>
`,Xe.appendChild(t),W(p.students).forEach(n=>{const s=zs(n,e);Xe.appendChild(s)}),aa(),An()}function te(){const e=document.getElementById("student-stats-table-container");if(!e||(e.innerHTML="",!p))return;W(p.students).length,Pt.textContent="Ø¢Ù…Ø§Ø± Ø¹Ù…Ù„Ú©Ø±Ø¯";const t=["Ù†Ø§Ù…"],n=["Ú©Ù„ Ø§Ù†ØªØ®Ø§Ø¨ Ù‡Ø§","ØºÛŒØ¨Øª","Ø®Ø±ÙˆØ¬","ÙØ±ØµØª Ø§Ø²Ø¯Ø³Øªâ€ŒØ±ÙØªÙ‡","Ù…Ø´Ú©Ù„","Ù…ÛŒØ§Ù†Ú¯ÛŒÙ†","Ù†Ù…Ø±Ù‡ Ú©Ù„Ø§Ø³ÛŒ (Ú©Ø§Ù†ÙˆÙ†)"],s=p.categories.filter(u=>u.isGradedCategory&&!u.isDeleted).map(u=>u.name),a=[...t,...s,...n],o=document.createElement("table");o.className="student-stats-table";const l=o.createTHead().insertRow();a.forEach((u,I)=>{const E=document.createElement("th");I===0?(E.innerHTML=`${u} <span style="opacity: 0.6;">ğŸ”—</span>`,E.title="Ø±Ø¯ÛŒÙâ€ŒÙ‡Ø§ÛŒ Ø§ÛŒÙ† Ø³ØªÙˆÙ† Ù‚Ø§Ø¨Ù„ Ú©Ù„ÛŒÚ© Ù‡Ø³ØªÙ†Ø¯"):E.textContent=u,l.appendChild(E)});const d=o.createTBody(),m=W(p.students),g=u=>{let I=0;return p.sessions.forEach(E=>{if(E.isDeleted||E.isCancelled)return;const L=E.studentRecords[u.identity.studentId];L&&L.attendance==="absent"&&I++}),I};m.forEach(u=>{const I=d.insertRow();if(I.dataset.studentId=u.identity.studentId,b){const $=b.studentRecords[u.identity.studentId];$&&$.attendance==="absent"&&I.classList.add("absent-row-highlight")}const E=I.insertCell(),L=document.createElement("span");L.textContent=u.identity.name,L.className="student-name-link",L.addEventListener("click",()=>{V(u),se(),N("student-profile-page")}),E.appendChild(L),s.forEach($=>{var re;const O=I.insertCell(),oe=$.toLowerCase(),z=((re=u.logs.scores[oe])==null?void 0:re.filter(U=>!U.isDeleted))||[];z.length>0?z.forEach((U,Y)=>{const J=document.createElement("span");J.textContent=U.value,J.style.position="relative",U.comment&&(J.dataset.tooltip=U.comment),O.appendChild(J),Y<z.length-1&&O.appendChild(document.createTextNode(","))}):O.textContent="",O.style.cursor="pointer",O.addEventListener("click",()=>{ye(u,$);const U=document.getElementById("category-selection-container");U&&U.scrollIntoView({behavior:"smooth",block:"center"})})}),I.insertCell().textContent=u.statusCounters.totalSelections||0,I.insertCell().textContent=g(u),I.insertCell().textContent=u.statusCounters.outOfClassCount||0,I.insertCell().textContent=u.statusCounters.missedChances||0;const D=Object.values(u.categoryIssues||{}).reduce(($,O)=>$+O,0);I.insertCell().textContent=D;const H=u.getOverallAverageScore();I.insertCell().textContent=H!==null?H:"-";const B=p.calculateFinalStudentScore(u);I.insertCell().textContent=B!==null?B:"-"}),W(p.students),Pt.setAttribute("data-student-count",m.length),e.appendChild(o);const h=e.querySelector(".student-stats-table"),r=h==null?void 0:h.querySelector("thead th:first-child");r&&r.addEventListener("click",()=>{h.classList.toggle("name-column-expanded")})}function ye(e=null,t=null){const n=document.getElementById("selected-student-result");n.innerHTML="",n.classList.remove("absent");let s,a;if(e&&t)s=e,a=t,Dt({student:e,categoryName:t}),De(-1);else{if(Dt(null),!b||ue<0||!b.winnerHistory[ue])return;const R=b.winnerHistory[ue];s=R.winner,a=R.categoryName}const o=document.querySelector(".current-winner-highlight");if(o&&o.classList.remove("current-winner-highlight"),s){const R=document.querySelector(`.student-stats-table tr[data-student-id="${s.identity.studentId}"]`);R&&R.classList.add("current-winner-highlight")}const i=p.categories.find(R=>R.name===a);if(i){pn(i);const R=document.querySelectorAll("#category-selection-container .pill");R.forEach(G=>G.classList.remove("active"));const P=Array.from(R).find(G=>G.textContent===a);P&&P.classList.add("active"),$n(i)}const l=b.studentRecords[s.identity.studentId],d=(l==null?void 0:l.attendance)==="absent",m=document.createElement("div");m.className="winner-name-container";const g=document.createElement("button");g.className="btn-icon",g.innerHTML="Ë…",g.title="Ø¨Ø±Ù†Ø¯Ù‡ Ù‚Ø¨Ù„ÛŒ";const h=!e;g.classList.toggle("is-disabled",!h||ue<=0),g.addEventListener("click",()=>{g.classList.contains("is-disabled")?(g.classList.add("shake-animation"),setTimeout(()=>g.classList.remove("shake-animation"),200)):(De(ue-1),ye())});const r=document.createElement("div");r.className="winner-name",r.innerHTML=`âœ¨ <strong>${s.identity.name}</strong>âœ¨`,r.classList.add("heartbeat-animation"),d&&(r.style.textDecoration="line-through",r.style.opacity="0.6",r.style.color="var(--color-secondary)"),(l==null?void 0:l.hadIssue)&&!d&&(r.style.color="var(--color-warning)",r.title="Ø§ÛŒÙ† Ø¯Ø§Ù†Ø´â€ŒØ¢Ù…ÙˆØ² Ø¯Ø± Ø§Ù†ØªØ®Ø§Ø¨ Ù‚Ø¨Ù„ÛŒ Ø¨Ø§ Ù…Ø´Ú©Ù„ Ù…ÙˆØ§Ø¬Ù‡ Ø´Ø¯Ù‡ Ø¨ÙˆØ¯"),(l==null?void 0:l.wasOutOfClass)&&!d&&(r.style.color="var(--color-strong-warning)",r.title="Ø§ÛŒÙ† Ø¯Ø§Ù†Ø´â€ŒØ¢Ù…ÙˆØ² Ø¯Ø± Ø²Ù…Ø§Ù† Ø§Ù†ØªØ®Ø§Ø¨ Ø®Ø§Ø±Ø¬ Ø§Ø² Ú©Ù„Ø§Ø³ Ø¨ÙˆØ¯");const E=document.createElement("button");E.className="btn-icon",E.innerHTML="Ë„",E.title="Ø¨Ø±Ù†Ø¯Ù‡ Ø¨Ø¹Ø¯ÛŒ",E.classList.toggle("is-disabled",!h||ue>=b.winnerHistory.length-1),E.addEventListener("click",()=>{E.classList.contains("is-disabled")?(E.classList.add("shake-animation"),setTimeout(()=>E.classList.remove("shake-animation"),200)):(De(ue+1),ye())}),m.appendChild(E),m.appendChild(r),m.appendChild(g),n.appendChild(m),Ce.disabled=h&&!E.classList.contains("is-disabled");const L=document.createElement("div");L.className="status-button-container";const D=document.createElement("button");D.textContent="ØºØ§ÛŒØ¨",D.classList.add("status-button","absent-btn"),d&&D.classList.add("active");const H=document.createElement("button");H.textContent="Ù…Ø´Ú©Ù„",H.classList.add("status-button","issue-btn"),l!=null&&l.hadIssue&&H.classList.add("active");const B=document.createElement("button");B.textContent="Ø®Ø±ÙˆØ¬",B.classList.add("status-button","exit-btn"),l!=null&&l.wasOutOfClass&&B.classList.add("active");const $=document.createElement("button");$.textContent="Ù¾Ø±ÙˆÙØ§ÛŒÙ„",$.className="status-button profile-btn",D.addEventListener("click",()=>{const R=D.classList.contains("active");B.classList.contains("active")&&(B.classList.remove("active"),l.wasOutOfClass=!1,s.statusCounters.outOfClassCount=Math.max(0,(s.statusCounters.outOfClassCount||0)-1),s.statusCounters.missedChances=Math.max(0,s.statusCounters.missedChances-1)),R?(D.classList.remove("active"),b.setAttendance(s.identity.studentId,"present"),s.statusCounters.missedChances=Math.max(0,s.statusCounters.missedChances-1),r.style.textDecoration="",r.style.opacity="",r.style.color=""):(H.classList.contains("active")&&(H.classList.remove("active"),l.hadIssue=!1,s.statusCounters.otherIssues=Math.max(0,s.statusCounters.otherIssues-1),s.statusCounters.missedChances=Math.max(0,s.statusCounters.missedChances-1)),D.classList.add("active"),b.setAttendance(s.identity.studentId,"absent"),s.statusCounters.missedChances++,r.style.textDecoration="line-through",r.style.opacity="0.6",r.style.color="var(--color-secondary)",r.title=""),te(),w()}),H.addEventListener("click",()=>{const R=H.classList.contains("active");if(B.classList.contains("active")&&(B.classList.remove("active"),l.wasOutOfClass=!1,s.statusCounters.outOfClassCount=Math.max(0,(s.statusCounters.outOfClassCount||0)-1),s.statusCounters.missedChances=Math.max(0,s.statusCounters.missedChances-1)),R){H.classList.remove("active"),l.hadIssue=!1;const P=ie.name;s.categoryIssues[P]&&(s.categoryIssues[P]=Math.max(0,s.categoryIssues[P]-1)),s.statusCounters.missedChances=Math.max(0,s.statusCounters.missedChances-1),r.style.color="",r.title=""}else{D.classList.contains("active")&&(D.classList.remove("active"),b.setAttendance(s.identity.studentId,"present"),s.statusCounters.missedChances=Math.max(0,s.statusCounters.missedChances-1)),H.classList.add("active"),l.hadIssue=!0;const P=ie.name;s.categoryIssues[P]=(s.categoryIssues[P]||0)+1,s.statusCounters.missedChances++,r.style.textDecoration="",r.style.opacity="",r.style.color="var(--color-warning)",r.title="Ø§ÛŒÙ† Ø¯Ø§Ù†Ø´â€ŒØ¢Ù…ÙˆØ² Ø¯Ø± Ø§Ù†ØªØ®Ø§Ø¨ Ù‚Ø¨Ù„ÛŒ Ø¨Ø§ Ù…Ø´Ú©Ù„ Ù…ÙˆØ§Ø¬Ù‡ Ø´Ø¯Ù‡ Ø¨ÙˆØ¯"}te(),w()}),B.addEventListener("click",()=>{if(B.classList.contains("active"))B.classList.remove("active"),l.wasOutOfClass=!1,s.statusCounters.outOfClassCount=Math.max(0,(s.statusCounters.outOfClassCount||0)-1),s.statusCounters.missedChances=Math.max(0,s.statusCounters.missedChances-1),r.style.color="",r.title="";else{if(D.classList.contains("active")&&(D.classList.remove("active"),b.setAttendance(s.identity.studentId,"present"),s.statusCounters.missedChances=Math.max(0,s.statusCounters.missedChances-1)),H.classList.contains("active")){H.classList.remove("active"),l.hadIssue=!1;const P=ie.name;s.categoryIssues[P]&&(s.categoryIssues[P]=Math.max(0,s.categoryIssues[P]-1)),s.statusCounters.missedChances=Math.max(0,s.statusCounters.missedChances-1)}B.classList.add("active"),l.wasOutOfClass=!0,s.statusCounters.outOfClassCount=(s.statusCounters.outOfClassCount||0)+1,s.statusCounters.missedChances++,r.style.textDecoration="",r.style.opacity="",r.style.color="var(--color-strong-warning)",r.title="Ø§ÛŒÙ† Ø¯Ø§Ù†Ø´â€ŒØ¢Ù…ÙˆØ² Ø¯Ø± Ø²Ù…Ø§Ù† Ø§Ù†ØªØ®Ø§Ø¨ Ø®Ø§Ø±Ø¬ Ø§Ø² Ú©Ù„Ø§Ø³ Ø¨ÙˆØ¯"}te(),w()}),$.addEventListener("click",()=>{V(s),se(),N("student-profile-page")}),L.appendChild(D),L.appendChild(B),L.appendChild(H),L.appendChild($),n.appendChild(L);const O=document.createElement("div");O.className="student-details-container";const oe=document.createElement("div");oe.className="student-details-scores",oe.innerHTML="<h4>Ø¢Ø®Ø±ÛŒÙ† Ù†Ù…Ø±Ø§Øª</h4>";const z=document.createElement("ul");z.className="scores-list";const re=["Reading","Writing","Speaking","Listening"];let U=!1;const Y=s.logs.scores||{};re.forEach(R=>{const P=document.createElement("li"),G=document.createElement("span");G.className="skill-name",G.textContent=`${R}:`;const be=document.createElement("span");be.className="skill-scores";const ht=R.toLowerCase(),He=Y[ht];He&&He.length>0?(U=!0,be.textContent=He.slice(-3).map(gt=>gt.value).join(",")):be.textContent="none",P.appendChild(G),P.appendChild(be),z.appendChild(P)}),!U&&Object.keys(Y).length===0&&(z.innerHTML='<div class="no-content-message">Ù‡Ù†ÙˆØ² Ù†Ù…Ø±Ù‡â€ŒØ§ÛŒ Ø«Ø¨Øª Ù†Ø´Ø¯Ù‡ Ø§Ø³Øª.</div>'),oe.appendChild(z),O.appendChild(oe);const J=document.createElement("div");J.className="student-details-notes",J.innerHTML="<h4>ÛŒØ§Ø¯Ø¯Ø§Ø´Øªâ€ŒÙ‡Ø§</h4>";const we=document.createElement("ul");we.className="notes-list",s.profile.notes&&s.profile.notes.length>0?[...s.profile.notes].sort((P,G)=>new Date(G.timestamp)-new Date(P.timestamp)).forEach(P=>{const G=document.createElement("li");G.dir=Ge(P.content),G.textContent=P.content,we.appendChild(G)}):we.innerHTML='<div class="no-content-message">ÛŒØ§Ø¯Ø¯Ø§Ø´ØªÛŒ ÙˆØ¬ÙˆØ¯ Ù†Ø¯Ø§Ø±Ø¯.</div>',J.appendChild(we),O.appendChild(J),n.appendChild(O)}function Mn(e){e.addEventListener("input",()=>{const t=e.value,n=Ge(t);e.setAttribute("dir",n)})}function Js(){Vt.innerHTML="",Bn.innerHTML="",ft.classList.add("tooltip-container"),me.disabled=!0,le.disabled=!0,Me.disabled=!0,me.value="",le.value="",je.classList.add("disabled-wrapper"),Ce.disabled=!0}function Ks(){p.categories.filter(t=>!t.isDeleted).forEach(t=>{const n=document.createElement("span");n.className="pill",n.textContent=t.name,n.dataset.categoryId=t.id,t.description&&(n.dataset.tooltip=t.description),n.addEventListener("click",()=>{document.querySelectorAll(".pill").forEach(a=>a.classList.remove("active")),n.classList.add("active"),pn(t),$n(t),je.classList.remove("disabled-wrapper"),Ce.disabled=!1;const s=b.lastWinnerByCategory[t.name];if(s){const a=p.students.find(o=>o.identity.studentId===s);a&&ye(a,t.name)}else{Bn.innerHTML="",Dt(null),De(-1),Ce.disabled=!1;const a=document.querySelector(".current-winner-highlight");a&&a.classList.remove("current-winner-highlight")}}),Vt.appendChild(n)})}function Qs(){if(b.lastUsedCategoryId){const e=Vt.querySelector(`.pill[data-category-id="${b.lastUsedCategoryId}"]`);e&&e.click()}b.winnerHistory&&b.winnerHistory.length>0&&(De(b.winnerHistory.length-1),ye())}function $n(e){e&&(e.isGradedCategory?(me.disabled=!1,le.disabled=!1,Me.disabled=!1,ft.removeAttribute("data-tooltip")):(me.disabled=!0,le.disabled=!0,Me.disabled=!0,ft.setAttribute("data-tooltip","Ø¨Ø±Ø§ÛŒ Ø§ÛŒÙ† Ø¯Ø³ØªÙ‡â€ŒØ¨Ù†Ø¯ÛŒ Ù‚Ø§Ø¨Ù„ÛŒØª Ù†Ù…Ø±Ù‡ Ø¯Ù‡ÛŒ ØªØ¹Ø±ÛŒÙ Ù†Ø´Ø¯Ù‡ Ø§Ø³Øª")))}function Ue(){if(!p||!b){N("class-management-page");return}Js(),Ks(),Qs(),N("student-page"),te()}function se(){if(!j)return;const e=j;Nn.textContent=`Ù¾Ø±ÙˆÙØ§ÛŒÙ„: ${e.identity.name}`;const t=p.sessions.reduce((r,u)=>{const I=u.studentRecords[e.identity.studentId];return r+(I&&I.attendance==="absent"?1:0)},0),n=Object.values(e.categoryIssues||{}).reduce((r,u)=>r+u,0);Fe.innerHTML=`
    <p><strong>Ú©Ù„ Ø§Ù†ØªØ®Ø§Ø¨:</strong> ${e.statusCounters.totalSelections}</p>
    <p><strong>ØºÛŒØ¨Øª:</strong> ${t}</p>
    <p><strong>ÙØ±ØµØª Ø§Ø² Ø¯Ø³Øª Ø±ÙØªÙ‡:</strong> ${e.statusCounters.missedChances||0}</p>
    <p><strong>Ù…Ø´Ú©Ù„:</strong> ${n}</p>`;const s=W(p.categories),a=document.createElement("div");if(a.className="stats-breakdown",s.length>0){s.forEach(u=>{var D;const I=u.name,E=((D=e.categoryCounts)==null?void 0:D[I])||0,L=document.createElement("p");L.className="stats-breakdown-item",L.innerHTML=`<strong>${I}:</strong> ${E}`,a.appendChild(L)});const r=Fe.querySelector("p:first-child");r&&r.after(a)}const o=document.createElement("div");o.className="stats-breakdown",s.length>0&&(s.forEach(r=>{var L;const u=r.name,I=((L=e.categoryIssues)==null?void 0:L[u])||0,E=document.createElement("p");E.className="stats-breakdown-item",E.innerHTML=`<strong>${u}:</strong> ${I}`,o.appendChild(E)}),Fe.appendChild(o));const i=document.createElement("p"),l=document.createElement("strong");l.textContent="ØªÚ©Ø§Ù„ÛŒÙ Ù†Ø§Ù‚Øµ:";const d=document.createElement("span");d.style.marginRight="5px";const m=ke(p);ct(e,m,d,{includePrefix:!1}),i.appendChild(l),i.appendChild(d),Fe.appendChild(i);const g=p.categories.filter(r=>r.isGradedCategory&&!r.isDeleted);Te.innerHTML="",g.forEach(r=>{const u=document.createElement("span");u.className="pill",u.textContent=r.name,u.dataset.skillName=r.name,r.description&&(u.dataset.tooltip=r.description),Te.appendChild(u),u.addEventListener("click",()=>{Te.querySelectorAll(".pill").forEach(I=>I.classList.remove("active")),u.classList.add("active"),Wt.focus()})}),Ze.innerHTML="";const h=[];for(const r in e.logs.scores)e.logs.scores[r].forEach(u=>{u.isDeleted||h.push(u)});h.sort((r,u)=>new Date(u.timestamp)-new Date(r.timestamp)),h.length===0?Ze.innerHTML='<div class="no-content-message">Ù‡Ù†ÙˆØ² Ù†Ù…Ø±Ù‡â€ŒØ§ÛŒ Ø«Ø¨Øª Ù†Ø´Ø¯Ù‡ Ø§Ø³Øª.</div>':h.forEach(r=>{const u=document.createElement("li");u.className="score-history-item";const I=document.createElement("div");I.className="item-content";const E=document.createElement("div");if(E.className="score-info",E.innerHTML=`
        <span class="score-date">${new Date(r.timestamp).toLocaleDateString("fa-IR")}</span>
        <span class="score-value">Ù†Ù…Ø±Ù‡: <strong>${r.value}</strong></span>
        <span class="score-skill-badge">${r.skill}</span>
    `,I.appendChild(E),r.comment){const D=`ØªÙˆØ¶ÛŒØ­Ø§Øª: ${r.comment}`,H=Ge(D);Ge(r.comment);const B=document.createElement("p");B.className="score-comment",B.dir=H,B.innerHTML=`<strong>ØªÙˆØ¶ÛŒØ­Ø§Øª:</strong> <div>${yn(r.comment)}</div>`,B.addEventListener("click",()=>{A.value=r.comment,A.dispatchEvent(new Event("input",{bubbles:!0})),fe($=>{r.comment=$,w(),se()}),ae("add-note-modal"),A.focus()}),I.appendChild(B)}const L=document.createElement("button");L.className="btn-icon delete-item-btn",L.innerHTML="ğŸ—‘ï¸",L.title="Ø­Ø°Ù Ø§ÛŒÙ† Ù†Ù…Ø±Ù‡",L.addEventListener("click",()=>{F(`Ø¢ÛŒØ§ Ø§Ø² Ø­Ø°Ù Ù†Ù…Ø±Ù‡ ${r.value} Ø¨Ø±Ø§ÛŒ Ù…Ù‡Ø§Ø±Øª ${r.skill} Ù…Ø·Ù…Ø¦Ù† Ù‡Ø³ØªÛŒØ¯ØŸ`,()=>{r.isDeleted=!0,w(),se(),k("âœ…Ù†Ù…Ø±Ù‡ Ø¨Ù‡ Ø³Ø·Ù„ Ø²Ø¨Ø§Ù„Ù‡ Ù…Ù†ØªÙ‚Ù„ Ø´Ø¯.")},{confirmText:"ØªØ§ÛŒÛŒØ¯ Ø­Ø°Ù",confirmClass:"btn-warning"})}),u.appendChild(I),u.appendChild(L),Ze.appendChild(u)}),Wt.value="",zt.value="",Te.querySelector(".pill.active")&&Te.querySelector(".pill.active").classList.remove("active"),_e()}function _e(){const e=document.getElementById("profile-notes-list");if(e.innerHTML="",!j||!j.profile.notes||j.profile.notes.length===0){e.innerHTML='<div class="no-content-message">Ù‡Ù†ÙˆØ² ÛŒØ§Ø¯Ø¯Ø§Ø´ØªÛŒ Ø«Ø¨Øª Ù†Ø´Ø¯Ù‡ Ø§Ø³Øª.</div>';return}[...j.profile.notes].filter(n=>!n.isDeleted).sort((n,s)=>new Date(s.timestamp)-new Date(n.timestamp)).forEach(n=>{const s=document.createElement("li");s.className="note-history-item";const a=document.createElement("div");a.className="item-content";const o=document.createElement("div");o.className="note-info";const i=document.createElement("span");i.className="note-date",i.textContent=new Date(n.timestamp).toLocaleDateString("fa-IR");const l=document.createElement("button");l.className="btn-icon delete-item-btn",l.innerHTML="ğŸ—‘ï¸",l.title="Ø­Ø°Ù Ø§ÛŒÙ† ÛŒØ§Ø¯Ø¯Ø§Ø´Øª",l.addEventListener("click",()=>{F("Ø¢ÛŒØ§ Ø§Ø² Ø­Ø°Ù Ø§ÛŒÙ† ÛŒØ§Ø¯Ø¯Ø§Ø´Øª Ù…Ø·Ù…Ø¦Ù† Ù‡Ø³ØªÛŒØ¯ØŸ",()=>{n.isDeleted=!0,w(),_e(),k("âœ…ÛŒØ§Ø¯Ø¯Ø§Ø´Øª Ø¨Ù‡ Ø³Ø·Ù„ Ø²Ø¨Ø§Ù„Ù‡ Ù…Ù†ØªÙ‚Ù„ Ø´Ø¯.")},{confirmText:"ØªØ§ÛŒÛŒØ¯ Ø­Ø°Ù",confirmClass:"btn-warning"})}),o.appendChild(i),o.appendChild(l);const d=document.createElement("p");d.className="note-content",d.innerHTML=yn(n.content),d.addEventListener("click",()=>{A.value=n.content,A.dispatchEvent(new Event("input",{bubbles:!0})),fe(m=>{n.content=m,w(),_e()}),ae("add-note-modal"),A.focus()}),a.appendChild(o),a.appendChild(d),s.appendChild(a),e.appendChild(s)})}function Hn(e){Ot.innerHTML="",e.forEach((t,n)=>{const s=document.createElement("option");s.value=n,s.textContent=t.trim(),Ot.appendChild(s)})}function Gt(){At.innerHTML="",ln.forEach(e=>{const t=document.createElement("li");t.className="preview-item";const n=document.createElement("input");n.type="checkbox",n.checked=!0,n.dataset.name=e;const s=document.createElement("label");s.textContent=e,t.appendChild(n),t.appendChild(s),At.appendChild(t)})}function Xs(e){const t=document.createElement("div");t.className="list-item-buttons";const n=document.createElement("button");return n.className="btn-icon",n.innerHTML="ğŸ“",n.title="Ø§ÙØ²ÙˆØ¯Ù†/ÙˆÛŒØ±Ø§ÛŒØ´ ÛŒØ§Ø¯Ø¯Ø§Ø´Øª Ú©Ù„Ø§Ø³",n.style.borderBottom="solid",e.note||(n.style.opacity="0.5",n.style.borderBottom="none"),n.addEventListener("click",s=>{s.stopPropagation(),A.value=e.note||"",fe(a=>{e.note=a,w(),ne()}),ae("add-note-modal"),A.focus()}),t.appendChild(n),t}function Ys(e){const t=document.createElement("div");t.style.flexGrow="1",t.style.display="flex",t.style.flexDirection="column",t.style.alignItems="flex-start";const n=document.createElement("span");n.textContent=e.info.name,n.classList.add("class-name-display"),t.appendChild(n);const s=W(e.students).length,a=W(e.sessions).filter(d=>d.isFinished).length,o=document.createElement("div");o.classList.add("class-stats-row");const i=document.createElement("span");i.textContent=`${s} Ù†ÙØ±`,i.classList.add("student-count-badge"),o.appendChild(i);const l=document.createElement("span");return l.textContent=`${a} Ø¬Ù„Ø³Ù‡`,l.classList.add("session-count-badge"),o.appendChild(l),t.appendChild(o),t.addEventListener("click",()=>{Q(e),ce(null),dt(p.liveSession),X(),N("session-page")}),t}function Zs(e){const t=document.createElement("li"),n=Ys(e);t.appendChild(n);const s=document.createElement("div");if(s.className="list-item-badges",e.liveSession&&!e.liveSession.isCancelled&&!e.liveSession.isDeleted){const i=document.createElement("span");i.className="warning-badge",i.textContent="Ø¬Ù„Ø³Ù‡ Ø¨Ø§Ø²",s.appendChild(i),t.classList.add("has-unfinished-session")}const a=document.createElement("span");a.className=`type-badge ${e.info.type}`,a.textContent=e.info.type==="online"?"Ø¢Ù†Ù„Ø§ÛŒÙ†":"Ø­Ø¶ÙˆØ±ÛŒ",a.title="Ù†ÙˆØ¹ Ú©Ù„Ø§Ø³",s.appendChild(a),t.appendChild(s);const o=Xs(e);return t.appendChild(o),t.addEventListener("contextmenu",i=>{Kt(i,[{label:"ØªÙ†Ø¸ÛŒÙ…Ø§Øª Ú©Ù„Ø§Ø³",icon:"âš™ï¸",action:()=>{Q(e),En.textContent=`ØªÙ†Ø¸ÛŒÙ…Ø§Øª Ú©Ù„Ø§Ø³: ${p.info.name}`,$e(),Ve(),N("settings-page")}},{label:"ØªØºÛŒÛŒØ± Ù†Ø§Ù…",icon:"âœï¸",action:()=>{const d=e.info.name,m=document.getElementById("add-note-modal-title");m.textContent="ØªØºÛŒÛŒØ± Ù†Ø§Ù… Ú©Ù„Ø§Ø³",A.value=d,A.rows=1,fe(g=>{const h=g.trim();if(h&&h!==d){const r=ts(d,h);r.success?(w(),ne(),k(`âœ…Ù†Ø§Ù… Ú©Ù„Ø§Ø³ Ø¨Ù‡ Â«${h}Â» ØªØºÛŒÛŒØ± ÛŒØ§ÙØª.`)):k(r.message)}m.textContent="Ø«Ø¨Øª ÛŒØ§Ø¯Ø¯Ø§Ø´Øª Ø¬Ø¯ÛŒØ¯",A.rows=4}),ae("add-note-modal"),A.focus(),A.select()}},{label:"Ø­Ø°Ù Ú©Ù„Ø§Ø³",icon:"ğŸ—‘ï¸",className:"danger",action:()=>{F(`Ø¢ÛŒØ§ Ø§Ø² Ø­Ø°Ù Ú©Ù„Ø§Ø³ Â«${e.info.name}Â» Ù…Ø·Ù…Ø¦Ù† Ù‡Ø³ØªÛŒØ¯ØŸ Ø§ÛŒÙ† Ø¹Ù…Ù„ ØªÙ…Ø§Ù… Ø¬Ù„Ø³Ø§Øª Ùˆ Ø¢Ù…Ø§Ø± Ù…Ø±Ø¨ÙˆØ· Ø¨Ù‡ Ø¢Ù† Ø±Ø§ Ù†ÛŒØ² Ø­Ø°Ù Ù…ÛŒâ€ŒÚ©Ù†Ø¯.`,()=>{ze(`Ú©Ù„Ø§Ø³ Â«${e.info.name}Â» Ø­Ø°Ù Ø´Ø¯.`),e.isDeleted=!0,w(),ne()},{confirmText:"ØªØ§ÛŒÛŒØ¯ Ø­Ø°Ù",confirmClass:"btn-warning",isDelete:!0})}}])}),t}function ne(){Mt.innerHTML="",Object.values(M).sort((t,n)=>new Date(t.info.creationDate)-new Date(n.info.creationDate)).forEach(t=>{if(t.isDeleted)return;const n=Zs(t);Mt.appendChild(n)})}function $e(){$t.innerHTML="",p&&W(p.students).forEach(e=>{const t=document.createElement("li"),n=document.createElement("span");n.textContent=e.identity.name,n.style.flexGrow="1";const s=document.createElement("button");s.className="btn-icon",s.innerHTML="ğŸ—‘ï¸",s.style.color="var(--color-warning)",s.addEventListener("click",a=>{a.stopPropagation(),F(`Ø¢ÛŒØ§ Ø§Ø² Ø­Ø°Ù Ø¯Ø§Ù†Ø´â€ŒØ¢Ù…ÙˆØ² Â«${e.identity.name}Â» Ù…Ø·Ù…Ø¦Ù† Ù‡Ø³ØªÛŒØ¯ØŸ`,()=>{ze(`Ø¯Ø§Ù†Ø´â€ŒØ¢Ù…ÙˆØ² Â«${e.identity.name}Â» Ø­Ø°Ù Ø´Ø¯.`),e.isDeleted=!0,w(),$e()},{confirmText:"ØªØ§ÛŒÛŒØ¯ Ø­Ø°Ù",confirmClass:"btn-warning"})}),t.appendChild(n),t.appendChild(s),$t.appendChild(t)})}function Ve(){if(Ht.innerHTML="",!p)return;p.categories.filter(t=>!t.isDeleted).forEach(t=>{const n=document.createElement("li"),s=document.createElement("div");s.className="name-and-badge-container";const a=document.createElement("span");if(a.textContent=t.name,s.appendChild(a),t.isGradedCategory){const i=document.createElement("span");i.className="category-badge",i.textContent="Ù‚Ø§Ø¨Ù„ Ù†Ù…Ø±Ù‡â€ŒØ¯Ù‡ÛŒ",s.appendChild(i)}const o=document.createElement("button");o.className="btn-icon",o.innerHTML="ğŸ—‘ï¸",o.style.color="var(--color-warning)",o.addEventListener("click",()=>{ze(`Ø¯Ø³ØªÙ‡â€ŒØ¨Ù†Ø¯ÛŒ Â«${t.name}Â» Ø­Ø°Ù Ø´Ø¯.`),t.isDeleted=!0,w(),Ve()}),n.appendChild(s),n.appendChild(o),Ht.appendChild(n)})}function pt(e){document.querySelectorAll(".page").forEach(n=>{n.classList.remove("active")});const t=document.getElementById(e);t&&t.classList.add("active"),e==="class-management-page"?(ne(),Rt.style.display="flex"):Rt.style.display="none",Dn()}function N(e){const t={pageId:e,currentClassName:p?p.info.name:null,selectedSessionNumber:b?b.sessionNumber:null,selectedStudentId:j?j.identity.studentId:null},n=history.state;(!n||n.pageId!==t.pageId||n.currentClassName!==t.currentClassName||n.selectedSessionNumber!==t.selectedSessionNumber||n.selectedStudentId!==t.selectedStudentId)&&history.pushState(t,"",`#${e}`),pt(e)}function ea(e,t){const n=document.createElement("div");n.className="list-item-buttons";const s=document.createElement("button");if(s.className="btn-icon",s.innerHTML="ğŸ“",s.title="Ø§ÙØ²ÙˆØ¯Ù†/ÙˆÛŒØ±Ø§ÛŒØ´ ÛŒØ§Ø¯Ø¯Ø§Ø´Øª Ø¬Ù„Ø³Ù‡",s.style.borderBottom="solid",e.note||(s.style.opacity="0.5",s.style.borderBottom="none"),s.addEventListener("click",a=>{a.stopPropagation(),A.value=e.note||"",fe(o=>{e.note=o,w(),X()}),ae("add-note-modal"),A.focus()}),n.appendChild(s),!e.isFinished&&!e.isCancelled){const a=document.createElement("button");a.className="btn-icon",a.innerHTML="âœ…",a.title="Ø®Ø§ØªÙ…Ù‡ Ø¬Ù„Ø³Ù‡",a.addEventListener("click",o=>{o.stopPropagation(),F(`Ø¬Ù„Ø³Ù‡ Ø´Ù…Ø§Ø±Ù‡ ${t} Ø®Ø§ØªÙ…Ù‡ Ù¾ÛŒØ¯Ø§ Ø®ÙˆØ§Ù‡Ø¯ Ú©Ø±Ø¯!`,()=>{p.endSpecificSession(e.sessionNumber),w(),X(),F("Ø¬Ù„Ø³Ù‡ Ø¨Ø§ Ù…ÙˆÙÙ‚ÛŒØª Ø®Ø§ØªÙ…Ù‡ ÛŒØ§ÙØª. Ø¢ÛŒØ§ Ù…Ø§ÛŒÙ„ Ø¨Ù‡ Ø§ÛŒØ¬Ø§Ø¯ ÙØ§ÛŒÙ„ Ù¾Ø´ØªÛŒØ¨Ø§Ù† Ù‡Ø³ØªÛŒØ¯ØŸ",()=>{Jt(),k("âœ…ÙØ§ÛŒÙ„ Ù¾Ø´ØªÛŒØ¨Ø§Ù† Ø¨Ø§ Ù…ÙˆÙÙ‚ÛŒØª Ø§ÛŒØ¬Ø§Ø¯ Ø´Ø¯.")},{confirmText:"Ø¨Ù„Ù‡",cancelText:"Ø®ÛŒØ±",confirmClass:"btn-success"})})}),n.appendChild(a)}return n}function ta(e,t){const n=document.createElement("div");n.style.display="flex",n.style.flexDirection="column",n.style.alignItems="flex-start",n.style.flexGrow="1";const s=new Date(e.startTime).toLocaleDateString("fa-IR"),a=document.createElement("span"),o=document.createElement("div");o.style.display="flex",o.style.gap="5px",o.style.marginTop="5px";const i=new Date(e.startTime).toLocaleDateString("fa-IR",{weekday:"long"}),l=document.createElement("span");if(l.className="type-badge day-badge",l.textContent=i,o.appendChild(l),e.isCancelled){a.textContent=`âœ…Ø¬Ù„Ø³Ù‡ Ù„ØºÙˆ Ø´Ø¯Ù‡ - ØªØ§Ø±ÛŒØ®: ${s}`,n.style.cursor="default";const d=document.createElement("span");d.className="type-badge cancelled-badge",d.textContent="Ù„ØºÙˆ Ø´Ø¯Ù‡",o.appendChild(d)}else a.textContent=`Ø¬Ù„Ø³Ù‡ ${t} - ØªØ§Ø±ÛŒØ®: ${s}`,n.style.cursor="pointer",n.addEventListener("click",()=>{ce(e),Ue()});if(n.appendChild(a),e.isFinished){const d=document.createElement("span");d.className="type-badge",d.textContent="Ø®Ø§ØªÙ…Ù‡ ÛŒØ§ÙØªÙ‡",d.style.backgroundColor="var(--color-secondary)",o.appendChild(d)}if(e.isMakeup){const d=document.createElement("span");d.className="type-badge",d.textContent="Ø¬Ø¨Ø±Ø§Ù†ÛŒ",d.style.backgroundColor="var(--color-warning)",d.style.color="var(--color-text-dark)",o.appendChild(d)}return n.appendChild(o),n}function na(e,t){const n=document.createElement("li"),s=t.get(e.sessionNumber),a=ta(e,s);n.appendChild(a);const o=ea(e,s);return n.appendChild(o),n.addEventListener("contextmenu",i=>{const l=[{label:e.isCancelled?"Ø¨Ø§Ø²Ú¯Ø±Ø¯Ø§Ù†ÛŒ Ø¬Ù„Ø³Ù‡":"Ù„ØºÙˆ Ø¬Ù„Ø³Ù‡",icon:"âŒ",action:()=>{const d=e.isCancelled?"Ø¨Ø§Ø²Ú¯Ø±Ø¯Ø§Ù†ÛŒ Ø¬Ù„Ø³Ù‡":"Ù„ØºÙˆ Ø¬Ù„Ø³Ù‡",m=e.isCancelled?"Ø¢ÛŒØ§ Ø§Ø² Ø¨Ø§Ø²Ú¯Ø±Ø¯Ø§Ù†ÛŒ Ø§ÛŒÙ† Ø¬Ù„Ø³Ù‡ Ù…Ø·Ù…Ø¦Ù† Ù‡Ø³ØªÛŒØ¯ØŸ":"Ø¢ÛŒØ§ Ø§Ø² Ù„ØºÙˆ Ø§ÛŒÙ† Ø¬Ù„Ø³Ù‡ Ù…Ø·Ù…Ø¦Ù† Ù‡Ø³ØªÛŒØ¯ØŸ Ø¬Ù„Ø³Ù‡ Ù„ØºÙˆ Ø´Ø¯Ù‡ Ø¯Ø± Ø¢Ù…Ø§Ø± ØªØ§Ø«ÛŒØ±ÛŒ Ù†Ø¯Ø§Ø±Ø¯ Ø§Ù…Ø§ Ù‚Ø§Ø¨Ù„ Ø¨Ø§Ø²Ú¯Ø±Ø¯Ø§Ù†ÛŒ Ø§Ø³Øª.";F(m,()=>{e.isCancelled=!e.isCancelled,w(),X(),k(e.isCancelled?"âœ…Ø¬Ù„Ø³Ù‡ Ù„ØºÙˆ Ø´Ø¯.":"âœ…Ø¬Ù„Ø³Ù‡ Ø¨Ø§Ø²Ú¯Ø±Ø¯Ø§Ù†ÛŒ Ø´Ø¯.")},{confirmText:d,confirmClass:"btn-warning"})}},{label:"ØªØºÛŒÛŒØ± ÙˆØ¶Ø¹ÛŒØª Ø¬Ø¨Ø±Ø§Ù†ÛŒ",icon:"ğŸ”„",action:()=>{p.markAsMakeup(e.sessionNumber),w(),X()}},{label:"Ø­Ø°Ù Ø¬Ù„Ø³Ù‡",icon:"ğŸ—‘ï¸",className:"danger",action:()=>{const d=e.isCancelled?"Ù„ØºÙˆ Ø´Ø¯Ù‡":s;F(`Ø¢ÛŒØ§ Ø§Ø² Ø­Ø°Ù Ø¬Ù„Ø³Ù‡ ${d} Ù…Ø·Ù…Ø¦Ù† Ù‡Ø³ØªÛŒØ¯ØŸ Ø§ÛŒÙ† Ø¹Ù…Ù„ Ø¢Ù…Ø§Ø± Ø«Ø¨Øª Ø´Ø¯Ù‡ Ø¯Ø± Ø§ÛŒÙ† Ø¬Ù„Ø³Ù‡ Ø±Ø§ Ù†ÛŒØ² Ø­Ø°Ù Ù…ÛŒâ€ŒÚ©Ù†Ø¯.`,()=>{ze(`Ø¬Ù„Ø³Ù‡ ${d} Ø­Ø°Ù Ø´Ø¯.`),e.isDeleted=!0,w(),X()},{confirmText:"ØªØ§ÛŒÛŒØ¯ Ø­Ø°Ù",confirmClass:"btn-warning",isDelete:!0})}}];Kt(i,l)}),n}function X(){const e=document.getElementById("session-list");if(!p)return;if(e.innerHTML="",p.sessions.length===0){e.innerHTML="<li>Ù‡Ù†ÙˆØ² Ø¬Ù„Ø³Ù‡â€ŒØ§ÛŒ Ø´Ø±ÙˆØ¹ Ù†Ø´Ø¯Ù‡ Ø§Ø³Øª.</li>";return}const t=ke(p);[...W(p.sessions)].reverse().forEach(s=>{const a=na(s,t);e.appendChild(a)})}function qe(e){if(pe.innerHTML="",e.length>0)e.forEach(t=>{const n=document.createElement("div");n.textContent=t.identity.name,n.addEventListener("click",()=>{V(t),se(),N("student-profile-page"),pe.style.display="none",qt.value=""}),pe.appendChild(n)}),pe.style.display="block";else if(qt.value.trim()!==""){const t=document.createElement("div");t.className="no-results",t.textContent="Ù¾ÛŒØ¯Ø§ Ù†Ø´Ø¯",pe.appendChild(t),pe.style.display="block"}else pe.style.display="none"}function lt(e){if(de.innerHTML="",e.length>0)e.forEach(t=>{const n=document.createElement("div");n.className="global-search-result";const s=document.createElement("span");s.className="student-name",s.textContent=t.student.identity.name;const a=document.createElement("span");a.className="class-name",a.textContent=`Ú©Ù„Ø§Ø³: ${t.classroom.info.name}`,n.addEventListener("click",()=>{Q(t.classroom),V(t.student),se(),N("student-profile-page"),de.style.display="none",et.value=""}),a.addEventListener("click",o=>{o.stopPropagation(),Q(t.classroom),ce(null),dt(t.classroom.liveSession),X(),N("session-page"),de.style.display="none",et.value=""}),n.appendChild(s),n.appendChild(a),de.appendChild(n)}),de.style.display="block";else if(et.value.trim()!==""){const t=document.createElement("div");t.className="no-results",t.textContent="Ù¾ÛŒØ¯Ø§ Ù†Ø´Ø¯",de.appendChild(t),de.style.display="block"}else de.style.display="none"}function _(){tt.innerHTML="",nt.innerHTML="",st.innerHTML="",at.innerHTML="",ot.innerHTML="",it.innerHTML="";const e=Object.values(M).filter(i=>i.isDeleted);e.length===0?tt.innerHTML="<li>Ù‡ÛŒÚ† Ú©Ù„Ø§Ø³ÛŒ Ø¯Ø± Ø³Ø·Ù„ Ø²Ø¨Ø§Ù„Ù‡ Ù†ÛŒØ³Øª.</li>":e.forEach(i=>{const l=document.createElement("li");l.innerHTML=`<span>${i.info.name}</span>`;const d=document.createElement("div");d.className="list-item-buttons";const m=document.createElement("button");m.className="btn-icon",m.innerHTML="ğŸ”„",m.title="Ø¨Ø§Ø²ÛŒØ§Ø¨ÛŒ",m.addEventListener("click",()=>{i.isDeleted=!1,w(),_(),ne(),k(`âœ…Ú©Ù„Ø§Ø³ Â«${i.info.name}Â» Ø¨Ø§Ø²ÛŒØ§Ø¨ÛŒ Ø´Ø¯.`)});const g=document.createElement("button");g.className="btn-icon",g.innerHTML="ğŸ”¥",g.title="Ø­Ø°Ù Ø¯Ø§Ø¦Ù…ÛŒ",g.addEventListener("click",()=>{F(`Ø¢ÛŒØ§ Ø§Ø² Ø­Ø°Ù Ø¯Ø§Ø¦Ù…ÛŒ Ú©Ù„Ø§Ø³ Â«${i.info.name}Â» Ù…Ø·Ù…Ø¦Ù† Ù‡Ø³ØªÛŒØ¯ØŸ Ø§ÛŒÙ† Ø¹Ù…Ù„ ØºÛŒØ±Ù‚Ø§Ø¨Ù„ Ø¨Ø§Ø²Ú¯Ø´Øª Ø§Ø³Øª.`,()=>{delete M[i.info.name],w(),_(),k(`âœ…Ú©Ù„Ø§Ø³ Â«${i.info.name}Â» Ø¨Ø±Ø§ÛŒ Ù‡Ù…ÛŒØ´Ù‡ Ø­Ø°Ù Ø´Ø¯.`)},{confirmText:"Ø­Ø°Ù Ø¯Ø§Ø¦Ù…ÛŒ",confirmClass:"btn-warning"})}),d.appendChild(m),d.appendChild(g),l.appendChild(d),tt.appendChild(l)});const t=[];Object.values(M).forEach(i=>{i.isDeleted||i.students.forEach(l=>{l.isDeleted&&t.push({student:l,classroom:i})})}),t.length===0?nt.innerHTML="<li>Ù‡ÛŒÚ† Ø¯Ø§Ù†Ø´â€ŒØ¢Ù…ÙˆØ²ÛŒ Ø¯Ø± Ø³Ø·Ù„ Ø²Ø¨Ø§Ù„Ù‡ Ù†ÛŒØ³Øª.</li>":t.forEach(({student:i,classroom:l})=>{const d=document.createElement("li");d.innerHTML=`<span>${i.identity.name} <small>(Ø§Ø² Ú©Ù„Ø§Ø³: ${l.info.name})</small></span>`;const m=document.createElement("div");m.className="list-item-buttons";const g=document.createElement("button");g.className="btn-icon",g.innerHTML="ğŸ”„",g.title="Ø¨Ø§Ø²ÛŒØ§Ø¨ÛŒ",g.addEventListener("click",()=>{i.isDeleted=!1,w(),_(),k(`Ø¯Ø§Ù†Ø´â€ŒØ¢Ù…ÙˆØ² Â«${i.identity.name}Â» Ø¨Ø§Ø²ÛŒØ§Ø¨ÛŒ Ø´Ø¯.`)});const h=document.createElement("button");h.className="btn-icon",h.innerHTML="ğŸ”¥",h.title="Ø­Ø°Ù Ø¯Ø§Ø¦Ù…ÛŒ",h.addEventListener("click",()=>{F(`Ø¢ÛŒØ§ Ø§Ø² Ø­Ø°Ù Ø¯Ø§Ø¦Ù…ÛŒ Ø¯Ø§Ù†Ø´â€ŒØ¢Ù…ÙˆØ² Â«${i.identity.name}Â» Ù…Ø·Ù…Ø¦Ù† Ù‡Ø³ØªÛŒØ¯ØŸ Ø§ÛŒÙ† Ø¹Ù…Ù„ ØºÛŒØ±Ù‚Ø§Ø¨Ù„ Ø¨Ø§Ø²Ú¯Ø´Øª Ø§Ø³Øª.`,()=>{const r=l.students.findIndex(u=>u.identity.studentId===i.identity.studentId);r>-1&&l.students.splice(r,1),w(),_(),k(`Ø¯Ø§Ù†Ø´â€ŒØ¢Ù…ÙˆØ² Â«${i.identity.name}Â» Ø¨Ø±Ø§ÛŒ Ù‡Ù…ÛŒØ´Ù‡ Ø­Ø°Ù Ø´Ø¯.`)},{confirmText:"Ø­Ø°Ù Ø¯Ø§Ø¦Ù…ÛŒ",confirmClass:"btn-warning"})}),m.appendChild(g),m.appendChild(h),d.appendChild(m),nt.appendChild(d)});const n=[];Object.values(M).forEach(i=>{i.isDeleted||i.sessions.forEach(l=>{l.isDeleted&&n.push({session:l,classroom:i})})}),n.length===0?st.innerHTML="<li>Ù‡ÛŒÚ† Ø¬Ù„Ø³Ù‡â€ŒØ§ÛŒ Ø¯Ø± Ø³Ø·Ù„ Ø²Ø¨Ø§Ù„Ù‡ Ù†ÛŒØ³Øª.</li>":n.forEach(({session:i,classroom:l})=>{const d=document.createElement("li");d.innerHTML=`<span>Ø¬Ù„Ø³Ù‡ ${i.sessionNumber} <small>(Ø§Ø² Ú©Ù„Ø§Ø³: ${l.info.name})</small></span>`;const m=document.createElement("div");m.className="list-item-buttons";const g=document.createElement("button");g.className="btn-icon",g.innerHTML="ğŸ”„",g.title="Ø¨Ø§Ø²ÛŒØ§Ø¨ÛŒ",g.addEventListener("click",()=>{i.isDeleted=!1,w(),_(),k(`Ø¬Ù„Ø³Ù‡ ${i.sessionNumber} Ø¨Ø§Ø²ÛŒØ§Ø¨ÛŒ Ø´Ø¯.`)});const h=document.createElement("button");h.className="btn-icon",h.innerHTML="ğŸ”¥",h.title="Ø­Ø°Ù Ø¯Ø§Ø¦Ù…ÛŒ",h.addEventListener("click",()=>{F(`Ø¢ÛŒØ§ Ø§Ø² Ø­Ø°Ù Ø¯Ø§Ø¦Ù…ÛŒ Ø¬Ù„Ø³Ù‡ ${i.sessionNumber} Ù…Ø·Ù…Ø¦Ù† Ù‡Ø³ØªÛŒØ¯ØŸ`,()=>{const r=l.sessions.findIndex(u=>u.sessionNumber===i.sessionNumber);r>-1&&l.sessions.splice(r,1),w(),_(),k(`Ø¬Ù„Ø³Ù‡ ${i.sessionNumber} Ø¨Ø±Ø§ÛŒ Ù‡Ù…ÛŒØ´Ù‡ Ø­Ø°Ù Ø´Ø¯.`)},{confirmText:"Ø­Ø°Ù Ø¯Ø§Ø¦Ù…ÛŒ",confirmClass:"btn-warning"})}),m.appendChild(g),m.appendChild(h),d.appendChild(m),st.appendChild(d)});const s=[];Object.values(M).forEach(i=>{i.isDeleted||i.categories.forEach(l=>{l.isDeleted&&s.push({category:l,classroom:i})})}),s.length===0?at.innerHTML="<li>Ù‡ÛŒÚ† Ø¯Ø³ØªÙ‡â€ŒØ¨Ù†Ø¯ÛŒ Ø¯Ø± Ø³Ø·Ù„ Ø²Ø¨Ø§Ù„Ù‡ Ù†ÛŒØ³Øª.</li>":s.forEach(({category:i,classroom:l})=>{const d=document.createElement("li");d.innerHTML=`<span>${i.name} <small>(Ø§Ø² Ú©Ù„Ø§Ø³: ${l.info.name})</small></span>`;const m=document.createElement("div");m.className="list-item-buttons";const g=document.createElement("button");g.className="btn-icon",g.innerHTML="ğŸ”„",g.title="Ø¨Ø§Ø²ÛŒØ§Ø¨ÛŒ",g.addEventListener("click",()=>{i.isDeleted=!1,w(),_(),k(`Ø¯Ø³ØªÙ‡â€ŒØ¨Ù†Ø¯ÛŒ Â«${i.name}Â» Ø¨Ø§Ø²ÛŒØ§Ø¨ÛŒ Ø´Ø¯.`)});const h=document.createElement("button");h.className="btn-icon",h.innerHTML="ğŸ”¥",h.title="Ø­Ø°Ù Ø¯Ø§Ø¦Ù…ÛŒ",h.addEventListener("click",()=>{F(`Ø¢ÛŒØ§ Ø§Ø² Ø­Ø°Ù Ø¯Ø§Ø¦Ù…ÛŒ Ø¯Ø³ØªÙ‡â€ŒØ¨Ù†Ø¯ÛŒ Â«${i.name}Â» Ù…Ø·Ù…Ø¦Ù† Ù‡Ø³ØªÛŒØ¯ØŸ`,()=>{const r=l.categories.findIndex(u=>u.id===i.id);r>-1&&l.categories.splice(r,1),w(),_(),k(`Ø¯Ø³ØªÙ‡â€ŒØ¨Ù†Ø¯ÛŒ Â«${i.name}Â» Ø¨Ø±Ø§ÛŒ Ù‡Ù…ÛŒØ´Ù‡ Ø­Ø°Ù Ø´Ø¯.`)},{confirmText:"Ø­Ø°Ù Ø¯Ø§Ø¦Ù…ÛŒ",confirmClass:"btn-warning"})}),m.appendChild(g),m.appendChild(h),d.appendChild(m),at.appendChild(d)});const a=[];Object.values(M).forEach(i=>{i.isDeleted||i.students.forEach(l=>{l.isDeleted||l.profile.notes.forEach(d=>{d.isDeleted&&a.push({note:d,student:l,classroom:i})})})}),a.length===0?ot.innerHTML="<li>Ù‡ÛŒÚ† ÛŒØ§Ø¯Ø¯Ø§Ø´ØªÛŒ Ø¯Ø± Ø³Ø·Ù„ Ø²Ø¨Ø§Ù„Ù‡ Ù†ÛŒØ³Øª.</li>":a.forEach(({note:i,student:l,classroom:d})=>{const m=document.createElement("li"),g=i.content.length>50?i.content.substring(0,50)+"...":i.content;m.innerHTML=`<span>"${g}" <small>(Ø¨Ø±Ø§ÛŒ: ${l.identity.name}ØŒ Ú©Ù„Ø§Ø³: ${d.info.name})</small></span>`;const h=document.createElement("div");h.className="list-item-buttons";const r=document.createElement("button");r.className="btn-icon",r.innerHTML="ğŸ”„",r.title="Ø¨Ø§Ø²ÛŒØ§Ø¨ÛŒ",r.addEventListener("click",()=>{i.isDeleted=!1,w(),_(),k("ÛŒØ§Ø¯Ø¯Ø§Ø´Øª Ø¨Ø§Ø²ÛŒØ§Ø¨ÛŒ Ø´Ø¯.")});const u=document.createElement("button");u.className="btn-icon",u.innerHTML="ğŸ”¥",u.title="Ø­Ø°Ù Ø¯Ø§Ø¦Ù…ÛŒ",u.addEventListener("click",()=>{F("Ø¢ÛŒØ§ Ø§Ø² Ø­Ø°Ù Ø¯Ø§Ø¦Ù…ÛŒ Ø§ÛŒÙ† ÛŒØ§Ø¯Ø¯Ø§Ø´Øª Ù…Ø·Ù…Ø¦Ù† Ù‡Ø³ØªÛŒØ¯ØŸ Ø§ÛŒÙ† Ø¹Ù…Ù„ ØºÛŒØ±Ù‚Ø§Ø¨Ù„ Ø¨Ø§Ø²Ú¯Ø´Øª Ø§Ø³Øª.",()=>{const I=l.profile.notes.findIndex(E=>E.id===i.id);I>-1&&l.profile.notes.splice(I,1),w(),_(),k("ÛŒØ§Ø¯Ø¯Ø§Ø´Øª Ø¨Ø±Ø§ÛŒ Ù‡Ù…ÛŒØ´Ù‡ Ø­Ø°Ù Ø´Ø¯.")},{confirmText:"Ø­Ø°Ù Ø¯Ø§Ø¦Ù…ÛŒ",confirmClass:"btn-warning"})}),h.appendChild(r),h.appendChild(u),m.appendChild(h),ot.appendChild(m)});const o=[];Object.values(M).forEach(i=>{i.isDeleted||i.students.forEach(l=>{if(!l.isDeleted)for(const d in l.logs.scores)l.logs.scores[d].forEach(m=>{m.isDeleted&&m.comment&&o.push({score:m,student:l,classroom:i})})})}),o.length===0?it.innerHTML="<li>Ù‡ÛŒÚ† ØªÙˆØ¶ÛŒØ­ Ù†Ù…Ø±Ù‡â€ŒØ§ÛŒ Ø¯Ø± Ø³Ø·Ù„ Ø²Ø¨Ø§Ù„Ù‡ Ù†ÛŒØ³Øª.</li>":o.forEach(({score:i,student:l,classroom:d})=>{const m=document.createElement("li"),g=i.comment.length>50?i.comment.substring(0,50)+"...":i.comment;m.innerHTML=`<span>"${g}" <small>(Ø¨Ø±Ø§ÛŒ Ù†Ù…Ø±Ù‡ ${i.value} Ø¯Ø± Ù…Ù‡Ø§Ø±Øª ${i.skill} / Ø¯Ø§Ù†Ø´â€ŒØ¢Ù…ÙˆØ²: ${l.identity.name})</small></span>`;const h=document.createElement("div");h.className="list-item-buttons";const r=document.createElement("button");r.className="btn-icon",r.innerHTML="ğŸ”„",r.title="Ø¨Ø§Ø²ÛŒØ§Ø¨ÛŒ",r.addEventListener("click",()=>{i.isDeleted=!1,w(),_(),k("ØªÙˆØ¶ÛŒØ­ Ù†Ù…Ø±Ù‡ Ø¨Ø§Ø²ÛŒØ§Ø¨ÛŒ Ø´Ø¯.")});const u=document.createElement("button");u.className="btn-icon",u.innerHTML="ğŸ”¥",u.title="Ø­Ø°Ù Ø¯Ø§Ø¦Ù…ÛŒ",u.addEventListener("click",()=>{F("Ø¢ÛŒØ§ Ø§Ø² Ø­Ø°Ù Ø¯Ø§Ø¦Ù…ÛŒ Ø§ÛŒÙ† ØªÙˆØ¶ÛŒØ­ Ù…Ø·Ù…Ø¦Ù† Ù‡Ø³ØªÛŒØ¯ØŸ Ø§ÛŒÙ† Ø¹Ù…Ù„ ØºÛŒØ±Ù‚Ø§Ø¨Ù„ Ø¨Ø§Ø²Ú¯Ø´Øª Ø§Ø³Øª.",()=>{const I=i.skill.toLowerCase(),E=l.logs.scores[I];if(E){const L=E.findIndex(D=>D.id===i.id);L>-1&&E.splice(L,1)}w(),_(),k("ØªÙˆØ¶ÛŒØ­ Ù†Ù…Ø±Ù‡ Ø¨Ø±Ø§ÛŒ Ù‡Ù…ÛŒØ´Ù‡ Ø­Ø°Ù Ø´Ø¯.")},{confirmText:"Ø­Ø°Ù Ø¯Ø§Ø¦Ù…ÛŒ",confirmClass:"btn-warning"})}),h.appendChild(r),h.appendChild(u),m.appendChild(h),it.appendChild(m)})}function sa(){const e=document.getElementById("absentees-summary-container");e&&(e.innerHTML=`
        <div id="absentees-summary-box" class="absentees-summary">
            <div class="absentees-summary-header">
                <h4>Ù„ÛŒØ³Øª ØºØ§ÛŒØ¨ÛŒÙ† Ø¬Ù„Ø³Ù‡ Ø´Ù…Ø§Ø±Ù‡ <span id="absentee-summary-session-number"></span></h4>
                <button id="copy-absentees-btn" class="btn-icon" title="Ú©Ù¾ÛŒ Ù„ÛŒØ³Øª ØºØ§ÛŒØ¨ÛŒÙ†">ğŸ“‹</button>
            </div>
            <div id="absentees-summary-list" class="summary-list"></div>
        </div>
    `)}function An(){const e=document.getElementById("absentees-summary-box"),t=document.getElementById("absentees-summary-list"),n=document.getElementById("absentee-summary-session-number");if(!e||!t||!n){console.error("Could not find all absentee summary elements.");return}if(!p||!b){e.classList.remove("visible");return}const s=W(p.students).filter(o=>{const i=b.studentRecords[o.identity.studentId];return i&&i.attendance==="absent"}),a=ke(p);n.textContent=a.get(b.sessionNumber),s.length>0?e.classList.add("visible"):e.classList.remove("visible"),t.innerHTML="",s.forEach(o=>{const l=(m=>p.sessions.reduce((g,h)=>{if(h.isDeleted||h.isCancelled)return g;const r=h.studentRecords[m.identity.studentId];return g+(r&&r.attendance==="absent"?1:0)},0))(o),d=document.createElement("span");d.className="summary-name",d.textContent=`${o.identity.name} (ØºÛŒØ¨Øª: ${l})`,d.addEventListener("click",()=>{d.classList.add("fading-out"),setTimeout(()=>{b.setAttendance(o.identity.studentId,"present"),w(),We()},200)}),t.appendChild(d)})}function aa(){const e=document.getElementById("copy-absentees-btn");if(!e){console.error("Could not find the copy absentees button to attach listener.");return}e.addEventListener("click",()=>{if(!p||!b)return;const t=W(p.students).filter(a=>{const o=b.studentRecords[a.identity.studentId];return o&&o.attendance==="absent"});if(t.length===0){k("âš ï¸Ù„ÛŒØ³Øª ØºØ§ÛŒØ¨ÛŒÙ† Ø®Ø§Ù„ÛŒ Ø§Ø³Øª.");return}const n=a=>p.sessions.reduce((o,i)=>{if(i.isDeleted||i.isCancelled)return o;const l=i.studentRecords[a.identity.studentId];return o+(l&&l.attendance==="absent"?1:0)},0);let s=`Ù„ÛŒØ³Øª ØºØ§ÛŒØ¨ÛŒÙ† Ø¬Ù„Ø³Ù‡ Ø´Ù…Ø§Ø±Ù‡ ${Vs()}:

`;t.forEach(a=>{const o=n(a);s+=`- ${a.identity.name} (ØªØ¹Ø¯Ø§Ø¯ ØºÛŒØ¨Øªâ€ŒÙ‡Ø§: ${o})
`}),navigator.clipboard.writeText(s).then(()=>{k("âœ…Ù„ÛŒØ³Øª ØºØ§ÛŒØ¨ÛŒÙ† Ø¨Ø§ Ù…ÙˆÙÙ‚ÛŒØª Ú©Ù¾ÛŒ Ø´Ø¯.")}).catch(a=>{console.error("Failed to copy text: ",a),k("âŒØ®Ø·Ø§ Ø¯Ø± Ú©Ù¾ÛŒ Ú©Ø±Ø¯Ù† Ù„ÛŒØ³Øª.")})})}const oa=Object.freeze(Object.defineProperty({__proto__:null,_internalShowPage:pt,addCategoryBtn:ws,addClassBtn:ls,addNoteModal:Fs,addScoreBtn:js,addStudentBtn:fs,appHeader:Rt,attendanceListUl:Xe,attendancePage:Is,backToAttendanceBtn:Bs,backToSessionsBtn:us,backToSessionsFromAttendanceBtn:Ns,backToStudentPageBtn:Gs,backupDataBtn:Hs,breadcrumbContainer:xe,cancelImportBtn:Ls,cancelNoteBtn:Ws,categoryListUl:Ht,classListHeader:Ts,classListUl:Mt,classManagementPage:bn,closeActiveModal:he,closeContextMenu:ve,closeNavBtn:Ms,columnMappingPage:vs,columnSelectDropdown:Ot,confirmColumnBtn:Es,confirmModalCancelBtn:Ft,confirmModalConfirmBtn:Pe,confirmModalMessage:wn,contextMenu:Le,csvCancelBtn:Cs,csvConfirmBtn:gs,csvFileInput:bs,csvPreviewList:At,csvPreviewPage:hs,customConfirmModal:Os,displayWinner:ye,finishAttendanceBtn:Ss,globalStudentSearchInput:et,globalStudentSearchResultsDiv:de,gradedCategoryPillsContainer:Te,hamburgerMenuBtn:xs,handleUndo:Tn,importCsvBtn:ys,initiateBackupProcess:Jt,isGradedCheckbox:_s,newCategoryNameInput:ks,newClassNameInput:cs,newNoteContent:A,newScoreCommentTextarea:zt,newScoreValueInput:Wt,newStudentNameInput:ms,openContextMenu:Kt,openModal:ae,overlay:$s,pasteArea:Ln,processPasteBtn:ps,profileScoresListUl:Ze,profileStatsSummaryDiv:Fe,profileStudentNameHeader:Nn,quickGradeFormWrapper:ft,quickGradeSubmitBtn:Me,quickNoteTextarea:le,quickScoreInput:me,renderAttendancePage:We,renderBreadcrumbs:Dn,renderClassList:ne,renderColumnSelector:Hn,renderGlobalSearchResults:lt,renderImportPreview:Gt,renderSearchResults:qe,renderSessions:X,renderSettingsCategories:Ve,renderSettingsStudentList:$e,renderStudentNotes:_e,renderStudentPage:Ue,renderStudentProfilePage:se,renderStudentStatsList:te,renderTrashPage:_,restoreDataBtn:As,restoreFileInput:kn,saveNoteBtn:qs,secureConfirmCancelBtn:Ps,secureConfirmCode:Sn,secureConfirmConfirmBtn:Ye,secureConfirmInput:Be,secureConfirmMessage:In,secureConfirmModal:Rs,selectStudentBtn:Ce,selectStudentBtnWrapper:je,setAutoDirectionOnInput:Mn,settingsClassNameHeader:En,settingsPage:ds,settingsStudentListUl:$t,showCustomConfirm:F,showNotification:k,showPage:N,showSecureConfirm:xn,showUndoToast:ze,sideNavMenu:Ds,studentProfilePage:Us,studentSearchInput:qt,studentSearchResultsDiv:pe,studentStatsHeader:Pt,trashedCategoriesList:at,trashedClassesList:tt,trashedNotesList:ot,trashedScoreCommentsList:it,trashedSessionsList:st,trashedStudentsList:nt,triggerFileDownload:Ut,undoBtn:rs,undoMessage:vn,undoToast:mt},Symbol.toStringTag,{value:"Module"}));document.addEventListener("DOMContentLoaded",()=>{const{globalStudentSearchInput:e,newClassNameInput:t,addClassBtn:n,undoBtn:s,backToSessionsBtn:a,newStudentNameInput:o,addStudentBtn:i,pasteArea:l,processPasteBtn:d,csvPreviewList:m,csvConfirmBtn:g,csvCancelBtn:h,importCsvBtn:r,csvFileInput:u,columnSelectDropdown:I,confirmColumnBtn:E,cancelImportBtn:L,newCategoryNameInput:D,addCategoryBtn:H,selectStudentBtn:B,attendancePage:$,finishAttendanceBtn:O,backToSessionsFromAttendanceBtn:oe,backToAttendanceBtn:z,classListHeader:re,studentStatsHeader:U,hamburgerMenuBtn:Y,sideNavMenu:J,closeNavBtn:we,overlay:R,backupDataBtn:P,restoreDataBtn:G,restoreFileInput:be,confirmModalCancelBtn:ht,confirmModalConfirmBtn:He,secureConfirmCancelBtn:gt,secureConfirmConfirmBtn:On,newNoteContent:Je,saveNoteBtn:Rn,cancelNoteBtn:Pn,studentSearchInput:Ae,studentSearchResultsDiv:Fn,studentProfilePage:qn,profileStudentNameHeader:Wn,backToStudentPageBtn:Un,gradedCategoryPillsContainer:Gn,newScoreValueInput:jn,newScoreCommentTextarea:_n,addScoreBtn:zn,isGradedCheckbox:Qt}=oa,Vn=document.getElementById("trash-nav-btn");document.querySelector(".global-search-container .search-icon"),nn(),ne();function Xt(c,C){const f=document.querySelector(c);if(!f)return;const y=f.querySelector(".search-icon"),v=f.querySelector(".animated-search-input");!y||!v||(y.addEventListener("mousedown",T=>{T.preventDefault()}),y.addEventListener("click",()=>{f.classList.contains("search-active")||(f.classList.add("search-active"),v.focus())}),v.addEventListener("blur",()=>{setTimeout(()=>{f.classList.remove("search-active"),v.value="",C&&C([])},150)}))}window.addEventListener("scroll",ve),document.addEventListener("click",c=>{Le.classList.contains("visible")&&!Le.contains(c.target)&&ve()}),je.addEventListener("click",()=>{(je.classList.contains("disabled-wrapper")||Ce.disabled)&&(Ce.classList.add("shake-animation"),setTimeout(()=>{Ce.classList.remove("shake-animation")},200))}),U.addEventListener("click",()=>{const c=new Date().getTime();c-un>500?Et(1):Et(St+1),os(c),St===5&&(Et(0),F("Ø¢ÛŒØ§ Ø§Ø² ØµÙØ± Ú©Ø±Ø¯Ù† ØªÙ…Ø§Ù… Ø´Ù…Ø§Ø±Ù†Ø¯Ù‡â€ŒÙ‡Ø§ÛŒ Ø¯Ø§Ù†Ø´â€ŒØ¢Ù…ÙˆØ²Ø§Ù† Ù…Ø·Ù…Ø¦Ù† Ù‡Ø³ØªÛŒØ¯ØŸ Ø§ÛŒÙ† Ø¹Ù…Ù„ ØºÛŒØ±Ù‚Ø§Ø¨Ù„ Ø¨Ø§Ø²Ú¯Ø´Øª Ø§Ø³Øª.",()=>{is(),te(),k("ØªÙ…Ø§Ù… Ø¢Ù…Ø§Ø±Ù‡Ø§ ØµÙØ± Ø´Ø¯Ù†Ø¯ âœ….")},{confirmText:"Ø¨Ù„Ù‡",confirmClass:"btn-warning"}))}),re.addEventListener("click",()=>{const c=new Date().getTime();c-dn>500?vt(1):vt(It+1),as(c),It===5&&(vt(0),F("Ø¢ÛŒØ§ Ø§Ø² Ø³Ø§Ø®Øª ÛŒÚ© Ú©Ù„Ø§Ø³ ØªØ³ØªÛŒ ØªØµØ§Ø¯ÙÛŒ Ù…Ø·Ù…Ø¦Ù† Ù‡Ø³ØªÛŒØ¯ØŸ",()=>{function C(){const f=`Ú©Ù„Ø§Ø³ ØªØ³ØªÛŒ ${Object.keys(M).length+1}`,y=new kt({name:f,type:"online"});["Ø¹Ù„ÛŒ Ø±Ø¶Ø§ÛŒÛŒ","Ù…Ø±ÛŒÙ… Ø­Ø³ÛŒÙ†ÛŒ","Ø²Ù‡Ø±Ø§ Ø§Ø­Ù…Ø¯ÛŒ","Ø±Ø¶Ø§ Ù…Ø­Ù…Ø¯ÛŒ","ÙØ§Ø·Ù…Ù‡ Ú©Ø±ÛŒÙ…ÛŒ"].forEach(T=>y.addStudent(new Qe({name:T}))),M[f]=y,w(),ne()}C(),k("Ú©Ù„Ø§Ø³ ØªØ³ØªÛŒ Ø¨Ø§ Ù…ÙˆÙÙ‚ÛŒØª Ø³Ø§Ø®ØªÙ‡ Ø´Ø¯ âœ…!")},{confirmText:"Ø¨Ø³Ø§Ø²",confirmClass:"btn-success"}))}),gt.addEventListener("click",()=>{he(),ut(null)}),On.addEventListener("click",()=>{typeof Nt=="function"&&Nt(),he(),ut(null)}),ht.addEventListener("click",()=>{he(fn)}),He.addEventListener("click",()=>{he(mn)}),z.addEventListener("click",()=>{p&&b&&(We(),N("attendance-page"))}),B.addEventListener("click",()=>{if(me.value.trim()!==""||le.value.trim()!==""){k("âš ï¸Ù„Ø·ÙØ§Ù‹ Ø§Ø¨ØªØ¯Ø§ Ø¨Ø§ Ø¯Ú©Ù…Ù‡ Â«Ø«Ø¨ØªÂ»ØŒ ØªØºÛŒÛŒØ±Ø§Øª Ø±Ø§ Ø°Ø®ÛŒØ±Ù‡ Ú©Ù†ÛŒØ¯.");return}if(!p||!b||!ie)return;const c=p.selectNextWinner(ie.name,b);if(c){const C=b.studentRecords[c.identity.studentId];if(C&&C.attendance==="absent"&&c.statusCounters.missedChances++,C&&C.hadIssue){c.statusCounters.missedChances++;const y=ie.name;c.categoryIssues[y]=(c.categoryIssues[y]||0)+1}const f={winner:c,categoryName:ie.name};b.winnerHistory.push(f),b.winnerHistory.length>10&&b.winnerHistory.shift(),De(b.winnerHistory.length-1),b.lastUsedCategoryId=ie.id,b.lastSelectedWinnerId=c.identity.studentId,te(),ye(),w()}else k("âŒØ¯Ø§Ù†Ø´â€ŒØ¢Ù…ÙˆØ² ÙˆØ§Ø¬Ø¯ Ø´Ø±Ø§ÛŒØ·ÛŒ Ø¨Ø±Ø§ÛŒ Ø§Ù†ØªØ®Ø§Ø¨ ÛŒØ§ÙØª Ù†Ø´Ø¯.")}),H.addEventListener("click",()=>{if(!p)return;const c=D.value.trim(),C=Qt.checked;if(!c){alert("Ù„Ø·ÙØ§Ù‹ Ù†Ø§Ù… Ø¯Ø³ØªÙ‡â€ŒØ¨Ù†Ø¯ÛŒ Ø±Ø§ ÙˆØ§Ø±Ø¯ Ú©Ù†ÛŒØ¯.");return}if(p.categories.some(v=>!v.isDeleted&&v.name.toLowerCase()===c.toLowerCase())){alert("Ø§ÛŒÙ† Ø¯Ø³ØªÙ‡â€ŒØ¨Ù†Ø¯ÛŒ Ø§Ø² Ù‚Ø¨Ù„ ÙˆØ¬ÙˆØ¯ Ø¯Ø§Ø±Ø¯.");return}const y=new ge(c,"",C);p.categories.push(y),w(),Ve(),D.value="",Qt.checked=!1}),D.addEventListener("keyup",c=>{c.key==="Enter"&&H.click()}),E.addEventListener("click",()=>{if(!wt){alert("Ø®Ø·Ø§ÛŒÛŒ Ø±Ø® Ø¯Ø§Ø¯Ù‡ Ø§Ø³Øª. Ù„Ø·ÙØ§Ù‹ ÙØ§ÛŒÙ„ Ø±Ø§ Ø¯ÙˆØ¨Ø§Ø±Ù‡ Ø§Ù†ØªØ®Ø§Ø¨ Ú©Ù†ÛŒØ¯."),N("settings-page");return}const c=parseInt(I.value,10),y=wt.split(`
`).slice(1).map(v=>{var S;return(S=v.split(",")[c])==null?void 0:S.trim()}).filter(v=>v&&v.length>0);y.length>0?(Ke(y),Gt(),N("csv-preview-page")):alert("Ù‡ÛŒÚ† Ù†Ø§Ù…ÛŒ Ø¯Ø± Ø³ØªÙˆÙ† Ø§Ù†ØªØ®Ø§Ø¨ Ø´Ø¯Ù‡ Ù¾ÛŒØ¯Ø§ Ù†Ø´Ø¯. Ù„Ø·ÙØ§Ù‹ Ø³ØªÙˆÙ† Ø¯ÛŒÚ¯Ø±ÛŒ Ø±Ø§ Ø§Ù…ØªØ­Ø§Ù† Ú©Ù†ÛŒØ¯ ÛŒØ§ ÙØ§ÛŒÙ„ Ø®ÙˆØ¯ Ø±Ø§ Ø¨Ø±Ø±Ø³ÛŒ Ú©Ù†ÛŒØ¯."),bt(null)}),r.addEventListener("click",()=>{u.click()}),u.addEventListener("change",c=>{const C=c.target.files[0];if(!C)return;const f=new FileReader;f.onload=y=>{const v=y.target.result;bt(v);const S=v.split(`
`)[0].split(",");Hn(S),N("column-mapping-page")},f.readAsText(C),c.target.value=null}),L.addEventListener("click",()=>{bt(null),N("settings-page")}),g.addEventListener("click",()=>{const c=m.querySelectorAll('input[type="checkbox"]:checked');let C=!1;c.forEach(f=>{const y=f.dataset.name;if(p.students.some(T=>T.identity.name.toLowerCase()===y.toLowerCase()))console.log(`Ø¯Ø§Ù†Ø´â€ŒØ¢Ù…ÙˆØ² Â«${y}Â» Ø¨Ù‡ Ø¯Ù„ÛŒÙ„ ØªÚ©Ø±Ø§Ø±ÛŒ Ø¨ÙˆØ¯Ù† Ø§Ø¶Ø§ÙÙ‡ Ù†Ø´Ø¯.`);else{const T=new Qe({name:y});p.addStudent(T),p.sessions.length>0&&(Zt(T,p),C=!0)}}),w(),$e(),C&&en(c.length),N("settings-page"),l.value="",Ke([])}),h.addEventListener("click",()=>{Ke([]),N("settings-page")}),d.addEventListener("click",()=>{const c=l.value.trim();if(!c){alert("Ú©Ø§Ø¯Ø± Ù…ØªÙ†ÛŒ Ø®Ø§Ù„ÛŒ Ø§Ø³Øª. Ù„Ø·ÙØ§Ù‹ Ø§Ø³Ø§Ù…ÛŒ Ø±Ø§ ÙˆØ§Ø±Ø¯ Ú©Ù†ÛŒØ¯.");return}const C=c.split(`
`).map(f=>f.trim()).filter(f=>f.length>0);C.length>0?(Ke(C),Gt(),N("csv-preview-page")):alert("Ù‡ÛŒÚ† Ù†Ø§Ù… Ù…Ø¹ØªØ¨Ø±ÛŒ Ø¨Ø±Ø§ÛŒ ÙˆØ±ÙˆØ¯ Ù¾ÛŒØ¯Ø§ Ù†Ø´Ø¯.")}),o.addEventListener("keyup",c=>{c.key==="Enter"&&i.click()}),i.addEventListener("click",()=>{if(!p)return;const c=o.value.trim();if(!c){alert("Ù„Ø·ÙØ§Ù‹ Ù†Ø§Ù… Ø¯Ø§Ù†Ø´â€ŒØ¢Ù…ÙˆØ² Ø±Ø§ ÙˆØ§Ø±Ø¯ Ú©Ù†ÛŒØ¯.");return}if(p.students.some(y=>y.identity.name.toLowerCase()===c.toLowerCase())){alert("âŒØ¯Ø§Ù†Ø´â€ŒØ¢Ù…ÙˆØ²ÛŒ Ø¨Ø§ Ø§ÛŒÙ† Ù†Ø§Ù… Ø§Ø² Ù‚Ø¨Ù„ Ø¯Ø± Ø§ÛŒÙ† Ú©Ù„Ø§Ø³ ÙˆØ¬ÙˆØ¯ Ø¯Ø§Ø±Ø¯.");return}const f=new Qe({name:c});p.addStudent(f),p.sessions.length>0&&(Zt(f,p),en(1)),w(),$e(),o.value="",o.focus()}),a.addEventListener("click",()=>{X(),N("session-page")}),document.getElementById("new-session-btn").addEventListener("click",()=>{if(p){const c=p.sessions.find(f=>!f.isFinished&&!f.isCancelled&&!f.isDeleted);if(c){k(`âš ï¸ Ø¬Ù„Ø³Ù‡ ${c.sessionNumber} Ù‡Ù†ÙˆØ² ØªÙ…Ø§Ù… Ù†Ø´Ø¯Ù‡ Ø§Ø³Øª. Ù„Ø·ÙØ§Ù‹ Ø§Ø¨ØªØ¯Ø§ Ø¨Ø§ Ø¯Ú©Ù…Ù‡ âœ… Ø¢Ù† Ø±Ø§ Ø®Ø§ØªÙ…Ù‡ Ø¯Ù‡ÛŒØ¯.`);return}const C=()=>{const f=y=>{const v=p.startNewSession();dt(v),ce(v),p.students.forEach(T=>{cn.setAttendance(T.identity.studentId,"present")}),y?(We(),N("attendance-page")):Ue(),w()};F("Ø¢ÛŒØ§ ØªÙ…Ø§ÛŒÙ„ Ø¨Ù‡ Ø§Ù†Ø¬Ø§Ù… ÙØ±Ø¢ÛŒÙ†Ø¯ Ø­Ø¶ÙˆØ± Ùˆ ØºÛŒØ§Ø¨ Ø¯Ø§Ø±ÛŒØ¯ØŸ",()=>f(!0),{confirmText:"Ø¨Ù„Ù‡",cancelText:"Ø®ÛŒØ±",confirmClass:"btn-success",onCancel:()=>f(!1)})};p.hasSessionToday()?F("Ø´Ù…Ø§ Ø§Ù…Ø±ÙˆØ² ÛŒÚ© Ø¬Ù„Ø³Ù‡ Ø¨Ø±Ø§ÛŒ Ø§ÛŒÙ† Ú©Ù„Ø§Ø³ Ø«Ø¨Øª Ú©Ø±Ø¯Ù‡â€ŒØ§ÛŒØ¯. Ø¢ÛŒØ§ Ø§Ø² Ø´Ø±ÙˆØ¹ ÛŒÚ© Ø¬Ù„Ø³Ù‡ Ø¬Ø¯ÛŒØ¯ Ø¯ÛŒÚ¯Ø± Ù…Ø·Ù…Ø¦Ù† Ù‡Ø³ØªÛŒØ¯ØŸ",C,{confirmText:"Ø¨Ù„Ù‡",confirmClass:"btn-warning"}):C()}}),n.addEventListener("click",()=>{const c=t.value.trim(),C=document.querySelector('input[name="class-type"]:checked');if(!c&&!C){k("âš ï¸Ù„Ø·ÙØ§Ù‹ Ù†Ø§Ù… Ùˆ Ù†ÙˆØ¹ Ú©Ù„Ø§Ø³ Ø±Ø§ Ù…Ø´Ø®Øµ Ú©Ù†ÛŒØ¯.");return}if(!c){k("âš ï¸Ù„Ø·ÙØ§Ù‹ Ù†Ø§Ù… Ú©Ù„Ø§Ø³ Ø±Ø§ ÙˆØ§Ø±Ø¯ Ú©Ù†ÛŒØ¯.");return}if(!C){k("âš ï¸Ù„Ø·ÙØ§Ù‹ Ù†ÙˆØ¹ Ú©Ù„Ø§Ø³ Ø±Ø§ Ø§Ù†ØªØ®Ø§Ø¨ Ú©Ù†ÛŒØ¯.");return}if(M[c]){k("âš ï¸Ú©Ù„Ø§Ø³ÛŒ Ø¨Ø§ Ø§ÛŒÙ† Ù†Ø§Ù… Ø§Ø² Ù‚Ø¨Ù„ ÙˆØ¬ÙˆØ¯ Ø¯Ø§Ø±Ø¯.");return}const f=C.value,y=new kt({name:c,type:f});M[c]=y,w(),ne(),t.value="",C.checked=!1}),e.addEventListener("input",c=>{const C=c.target.value;if(C.length<2){lt([]);return}const f=C.toLowerCase(),y=sn(f),v=[];for(const T in M){const S=M[T];if(S.isDeleted)continue;W(S.students).filter(q=>{const K=Ne(q.identity.name.toLowerCase()),Ie=K.includes(Ne(f)),tn=K.includes(Ne(y));return Ie||tn}).forEach(q=>{v.push({student:q,classroom:S})})}lt(v)}),t.addEventListener("keyup",c=>{c.key==="Enter"&&n.click()}),s.addEventListener("click",Tn),document.querySelectorAll(".back-to-classes-btn").forEach(c=>{c.addEventListener("click",()=>{Q(null),ce(null),dt(null),N("class-management-page")})}),O.addEventListener("click",()=>{Ue()}),oe.addEventListener("click",()=>{X(),N("session-page")}),Un.addEventListener("click",()=>{V(null),N("student-page")}),Ae.addEventListener("input",c=>{const C=c.target.value;if(!C){qe([]);return}const f=C.toLowerCase(),y=sn(f),T=W(p.students).filter(S=>{const Z=Ne(S.identity.name.toLowerCase()),q=Z.includes(Ne(f)),K=Z.includes(Ne(y));return q||K});qe(T)}),Ae.addEventListener("focus",()=>{Ae.value&&qe(Ae.value)}),document.addEventListener("click",c=>{Ae.contains(c.target)||(Fn.style.display="none")}),Me.addEventListener("click",()=>{const c=me.value,C=le.value.trim();let f;if(Tt)f=Tt.student;else{const v=b==null?void 0:b.winnerHistory[ue];f=v==null?void 0:v.winner}if(!f){k("âŒØ®Ø·Ø§: Ø¯Ø§Ù†Ø´â€ŒØ¢Ù…ÙˆØ² Ù…Ø¹ØªØ¨Ø±ÛŒ Ø¨Ø±Ø§ÛŒ Ø«Ø¨Øª Ù†Ù…Ø±Ù‡ ÛŒØ§ÙØª Ù†Ø´Ø¯.");return}const y=ie;if(!f||!y){k("âš ï¸Ù„Ø·ÙØ§Ù‹ Ø§Ø¨ØªØ¯Ø§ ÛŒÚ© Ø¯Ø§Ù†Ø´â€ŒØ¢Ù…ÙˆØ² Ùˆ ÛŒÚ© Ø¯Ø³ØªÙ‡â€ŒØ¨Ù†Ø¯ÛŒ Ø±Ø§ Ø§Ù†ØªØ®Ø§Ø¨ Ú©Ù†ÛŒØ¯.");return}if(!c){k("âš ï¸Ù„Ø·ÙØ§Ù‹ Ù…Ù‚Ø¯Ø§Ø± Ù†Ù…Ø±Ù‡ Ø±Ø§ ÙˆØ§Ø±Ø¯ Ú©Ù†ÛŒØ¯.");return}if(c>100||c<0){k("âŒÙ†Ù…Ø±Ù‡ Ù†Ø¨Ø§ÛŒØ¯ Ø§Ø² Û±Û°Û° Ø¨ÛŒØ´ØªØ± Ùˆ Ø§Ø² ØµÙØ± Ú©Ù…ØªØ± Ø¨Ø§Ø´Ø¯");return}f&&(f.addScore(y.name,parseFloat(c),C),w(),te(),k(`âœ…Ù†Ù…Ø±Ù‡ Ø¨Ø±Ø§ÛŒ ${f.identity.name} Ø¯Ø± Ù…Ù‡Ø§Ø±Øª ${y.name} Ø«Ø¨Øª Ø´Ø¯.`),me.value="",le.value="",ye(f,y.name))});const Yt=c=>{c.key==="Enter"&&c.ctrlKey&&(c.preventDefault(),Me.click())};me.addEventListener("keydown",Yt),le.addEventListener("keydown",Yt),zn.addEventListener("click",()=>{const c=Gn.querySelector(".pill.active");if(!c){k("âš ï¸Ù„Ø·ÙØ§Ù‹ ÛŒÚ© Ù…Ù‡Ø§Ø±Øª Ø±Ø§ Ø¨Ø±Ø§ÛŒ Ù†Ù…Ø±Ù‡â€ŒØ¯Ù‡ÛŒ Ø§Ù†ØªØ®Ø§Ø¨ Ú©Ù†ÛŒØ¯.");return}const C=c.dataset.skillName,f=jn.value,y=_n.value.trim();if(!f){k("Ù„Ø·ÙØ§Ù‹ Ù…Ù‚Ø¯Ø§Ø± Ù†Ù…Ø±Ù‡ Ø±Ø§ ÙˆØ§Ø±Ø¯ Ú©Ù†ÛŒØ¯.");return}j.addScore(C,parseFloat(f),y),w(),se(),k(`âœ…Ù†Ù…Ø±Ù‡ Ø¨Ø±Ø§ÛŒ Ù…Ù‡Ø§Ø±Øª ${C} Ø¨Ø§ Ù…ÙˆÙÙ‚ÛŒØª Ø«Ø¨Øª Ø´Ø¯.`)}),document.getElementById("add-note-btn").addEventListener("click",()=>{j&&(Je.value="",Je.dispatchEvent(new Event("input",{bubbles:!0})),fe(c=>{c&&(j.addNote(c),w(),_e())}),ae("add-note-modal"),Je.focus())}),Pn.addEventListener("click",()=>{he()}),Rn.addEventListener("click",()=>{const c=Je.value.trim();typeof Bt=="function"&&(Bt(c),he(),k("âœ…ÛŒØ§Ø¯Ø¯Ø§Ø´Øª Ø¨Ø§ Ù…ÙˆÙÙ‚ÛŒØª Ø°Ø®ÛŒØ±Ù‡ Ø´Ø¯."))}),Y.addEventListener("click",()=>{J.style.width="250px",R.classList.add("modal-visible")}),we.addEventListener("click",Oe),R.addEventListener("click",Oe),Vn.addEventListener("click",()=>{_(),N("trash-page"),Oe()}),P.addEventListener("click",()=>{Oe(),Jt()}),G.addEventListener("click",()=>{be.click(),Oe()}),be.addEventListener("change",c=>{const C=c.target.files[0];if(!C)return;const f=new FileReader;f.onload=y=>{try{const v=JSON.parse(y.target.result);F("Ø¢ÛŒØ§ Ø§Ø² Ø¨Ø§Ø²ÛŒØ§Ø¨ÛŒ Ø§Ø·Ù„Ø§Ø¹Ø§Øª Ù…Ø·Ù…Ø¦Ù† Ù‡Ø³ØªÛŒØ¯ØŸ ØªÙ…Ø§Ù… Ø¯Ø§Ø¯Ù‡â€ŒÙ‡Ø§ÛŒ ÙØ¹Ù„ÛŒ Ø´Ù…Ø§ Ø¨Ø§Ø²Ù†ÙˆÛŒØ³ÛŒ Ø®ÙˆØ§Ù‡Ø¯ Ø´Ø¯.",()=>{_t(v),w(),ne(),N("class-management-page"),k("âœ…Ø§Ø·Ù„Ø§Ø¹Ø§Øª Ø¨Ø§ Ù…ÙˆÙÙ‚ÛŒØª Ø¨Ø§Ø²ÛŒØ§Ø¨ÛŒ Ø´Ø¯.")},{confirmText:"Ø¨Ø§Ø²ÛŒØ§Ø¨ÛŒ Ú©Ù†",confirmClass:"btn-warning"})}catch{k("âŒØ®Ø·Ø§ Ø¯Ø± Ø®ÙˆØ§Ù†Ø¯Ù† ÙØ§ÛŒÙ„. Ù„Ø·ÙØ§Ù‹ ÙØ§ÛŒÙ„ Ù¾Ø´ØªÛŒØ¨Ø§Ù† Ù…Ø¹ØªØ¨Ø± Ø§Ù†ØªØ®Ø§Ø¨ Ú©Ù†ÛŒØ¯.")}},f.readAsText(C),c.target.value=null}),window.addEventListener("popstate",c=>{if(Ee&&history.pushState(null,"",location.href),ve(),c.state){const{pageId:C,currentClassName:f,selectedSessionNumber:y,selectedStudentId:v}=c.state;f&&(Q(M[f]),y&&ce(p.getSession(y)),v&&V(p.students.find(T=>T.identity.studentId===v))),C==="student-page"?Ue():pt(C)}else Q(null),ce(null),V(null),pt("class-management-page")}),document.addEventListener("keydown",c=>{var y;const C=document.activeElement;if(!["INPUT","TEXTAREA","SELECT"].includes(C.tagName)){if(c.key.toLowerCase()==="o"&&c.shiftKey&&bn.classList.contains("active")&&(c.preventDefault(),kn.click()),c.key==="Escape"){if(Le.classList.contains("visible")){ve();return}if(Ee){he();return}switch((y=document.querySelector(".page.active"))==null?void 0:y.id){case"csv-preview-page":case"column-mapping-page":N("settings-page");break;case"student-profile-page":V(null),N(b?"student-page":"session-page");break;case"attendance-page":N("student-page");break;case"student-page":ce(null),X(),N("session-page");break;case"settings-page":case"session-page":Q(null),N("class-management-page");break}return}if(b){const v=c.key.toLowerCase();switch(" ascfg".includes(v)&&c.preventDefault(),v){case" ":B.click();break;case"a":$.classList.contains("active")?history.back():(We(),N("attendance-page"));break;case"s":document.getElementById("session-page").classList.contains("active")?history.back():a.click();break;case"c":document.querySelector(".back-to-classes-btn").click();break;case"f":const T=document.querySelector(".action-column .search-icon");T&&T.click();break;case"g":if(qn.classList.contains("active"))history.back();else{const S=b.lastSelectedWinnerId;if(S){const Z=p.students.find(q=>q.identity.studentId===S);Z&&(V(Z),se(),N("student-profile-page"))}else k("âš ï¸Ø§Ø¨ØªØ¯Ø§ ÛŒÚ© Ù†ÙØ± Ø±Ø§ Ø§Ù†ØªØ®Ø§Ø¨ Ú©Ù†ÛŒØ¯ ØªØ§ Ù¾Ø±ÙˆÙØ§ÛŒÙ„ Ø§Ùˆ Ù†Ù…Ø§ÛŒØ´ Ø¯Ø§Ø¯Ù‡ Ø´ÙˆØ¯.")}break;case"arrowleft":{const S=document.querySelector('button[title="Ø¨Ø±Ù†Ø¯Ù‡ Ù‚Ø¨Ù„ÛŒ"]');S&&!S.disabled&&(c.preventDefault(),S.click());break}case"arrowright":{const S=document.querySelector('button[title="Ø¨Ø±Ù†Ø¯Ù‡ Ø¨Ø¹Ø¯ÛŒ"]');S&&!S.disabled&&(c.preventDefault(),S.click());break}}}}});function Oe(){J.style.width="0",R.classList.add("modal-closing"),setTimeout(()=>{R.classList.remove("modal-visible","modal-closing")},300)}Xt(".global-search-container .animated-search-container",lt),Xt(".action-column-header .animated-search-container",qe),[A,zt,le,Ln].forEach(c=>{c&&Mn(c)}),Wn.addEventListener("click",()=>{const c=j,C=p;if(!c||!C)return;const f=document.getElementById("add-note-modal-title");f.textContent="ØªØºÛŒÛŒØ± Ù†Ø§Ù… Ø¯Ø§Ù†Ø´â€ŒØ¢Ù…ÙˆØ²",A.value=c.identity.name,A.rows=1,fe(y=>{const v=y.trim();!v||v===c.identity.name||(C.students.some(S=>!S.isDeleted&&S.identity.name.toLowerCase()===v.toLowerCase())?k("Ø¯Ø§Ù†Ø´â€ŒØ¢Ù…ÙˆØ²ÛŒ Ø¨Ø§ Ø§ÛŒÙ† Ù†Ø§Ù… Ø§Ø² Ù‚Ø¨Ù„ Ø¯Ø± Ø§ÛŒÙ† Ú©Ù„Ø§Ø³ ÙˆØ¬ÙˆØ¯ Ø¯Ø§Ø±Ø¯."):(c.identity.name=v,w(),se(),te(),k(`âœ…Ù†Ø§Ù… Ø¯Ø§Ù†Ø´â€ŒØ¢Ù…ÙˆØ² Ø¨Ù‡ Â«${v}Â» ØªØºÛŒÛŒØ± ÛŒØ§ÙØª.`))),f.textContent="Ø«Ø¨Øª ÛŒØ§Ø¯Ø¯Ø§Ø´Øª Ø¬Ø¯ÛŒØ¯",A.rows=4}),ae("add-note-modal"),A.focus(),A.select()});function Zt(c,C){const f=W(C.students).filter(x=>x.identity.studentId!==c.identity.studentId);if(f.length===0)return;let y=0;const v=W(C.categories);v.forEach(x=>{const ee=Math.max(0,...f.map(Re=>Re.categoryCounts[x.name]||0));c.categoryCounts[x.name]=ee,y+=ee}),c.statusCounters.totalSelections=y;const T=f.reduce((x,ee)=>x+ee.statusCounters.totalSelections,0),S=f.reduce((x,ee)=>x+(ee.statusCounters.missedChances||0),0),Z=T>0?S/T:0,q={};v.forEach(x=>{const ee=f.reduce((Ct,yt)=>Ct+(yt.categoryCounts[x.name]||0),0),Re=f.reduce((Ct,yt)=>Ct+(yt.categoryIssues[x.name]||0),0);q[x.name]=ee>0?Re/ee:0}),c.statusCounters.missedChances=Math.round(c.statusCounters.totalSelections*Z),v.forEach(x=>{const ee=c.categoryCounts[x.name]||0,Re=q[x.name]||0;c.categoryIssues[x.name]=Math.round(ee*Re)});const K=W(C.sessions).filter(x=>!x.isCancelled&&x.isFinished);K.forEach(x=>{x.setAttendance(c.identity.studentId,"absent")});const Ie="ğŸ“ ÛŒØ§Ø¯Ø¯Ø§Ø´Øª Ø®ÙˆØ¯Ú©Ø§Ø± Ø³ÛŒØ³ØªÙ…",Xn=`Ø§ÛŒÙ† Ø¯Ø§Ù†Ø´â€ŒØ¢Ù…ÙˆØ² Ù¾Ø³ Ø§Ø² Ø¬Ù„Ø³Ù‡ Ø´Ù…Ø§Ø±Ù‡ ${K.length} Ø¨Ù‡ Ú©Ù„Ø§Ø³ Ø§Ø¶Ø§ÙÙ‡ Ø´Ø¯. Ø¢Ù…Ø§Ø± Ù¾Ø§ÛŒÙ‡â€ŒØ§ÛŒ Ø²ÛŒØ± Ø¨Ø±Ø§ÛŒ Ø­ÙØ¸ ØªØ¹Ø§Ø¯Ù„ Ø§Ù„Ú¯ÙˆØ±ÛŒØªÙ… Ø§Ù†ØªØ®Ø§Ø¨ Ø¨Ø±Ø§ÛŒ Ø§Ùˆ Ø«Ø¨Øª Ú¯Ø±Ø¯ÛŒØ¯:`,Se=[];c.statusCounters.totalSelections>0&&Se.push(`Ú©Ù„ Ø§Ù†ØªØ®Ø§Ø¨â€ŒÙ‡Ø§: ${c.statusCounters.totalSelections}`),c.statusCounters.missedChances>0&&Se.push(`ÙØ±ØµØªâ€ŒÙ‡Ø§ÛŒ Ø§Ø² Ø¯Ø³Øª Ø±ÙØªÙ‡: ${c.statusCounters.missedChances}`);for(const x in c.categoryCounts)c.categoryCounts[x]>0&&Se.push(`Ø§Ù†ØªØ®Ø§Ø¨ Ø¯Ø± Â«${x}Â»: ${c.categoryCounts[x]}`);for(const x in c.categoryIssues)c.categoryIssues[x]>0&&Se.push(`Ù…Ø´Ú©Ù„ Ø¯Ø± Â«${x}Â»: ${c.categoryIssues[x]}`);if(Se.length>0){const x=`${Ie}
${Xn}

- ${Se.join(`
- `)}`;c.addNote(x)}}function en(c){const f=`Ú†ÙˆÙ† Ø§ÛŒÙ† Ú©Ù„Ø§Ø³ Ø¬Ù„Ø³Ø§Øª Ø¨Ø±Ú¯Ø²Ø§Ø± Ø´Ø¯Ù‡ Ø¯Ø§Ø±Ø¯ØŒ Ø¨Ø±Ø§ÛŒ ${c>1?"Ø¯Ø§Ù†Ø´â€ŒØ¢Ù…ÙˆØ²Ø§Ù† Ø¬Ø¯ÛŒØ¯":"Ø¯Ø§Ù†Ø´â€ŒØ¢Ù…ÙˆØ² Ø¬Ø¯ÛŒØ¯"} Ø¢Ù…Ø§Ø± Ù¾Ø§ÛŒÙ‡â€ŒØ§ÛŒ (Ù…ØªÙ†Ø§Ø³Ø¨ Ø¨Ø§ Ø³Ø§ÛŒØ± Ø¯Ø§Ù†Ø´â€ŒØ¢Ù…ÙˆØ²Ø§Ù†) Ø«Ø¨Øª Ø´Ø¯ ØªØ§ Ø¯Ø± ÙØ±Ø§ÛŒÙ†Ø¯ Ø§Ù†ØªØ®Ø§Ø¨ Ø§Ø®ØªÙ„Ø§Ù„ÛŒ Ø§ÛŒØ¬Ø§Ø¯ Ù†Ø´ÙˆØ¯.`;F(f,()=>{},{confirmText:"Ù…ØªÙˆØ¬Ù‡ Ø´Ø¯Ù…",confirmClass:"btn-success",onCancel:null})}const Jn="3.17.21";document.getElementById("app-version").textContent=`Ù†Ø³Ø®Ù‡ ${Jn}`;function Kn(){console.log("Starting universal backfill for writing scores...");let c=0;for(const C in M){const f=M[C];if(f.isDeleted)continue;let y=0;W(f.students).forEach(T=>{const S=T.logs.scores;if(!(S&&S.writing&&S.writing.length>0)){let q=-1;for(const K in S)K!=="writing"&&S[K].forEach(Ie=>{Ie.value>q&&(q=Ie.value)});if(q>-1){const K=`Automatically assigned based on the highest score (${q}) from other skills.`;T.addScore("Writing",q,K),y++}}}),y>0&&(console.log(`Updated ${y} student(s) in class: ${f.info.name}.`),c+=y)}c>0?(w(),console.log(`Update complete. A total of ${c} student(s) were updated across all classes. Data saved.`),document.getElementById("student-page").classList.contains("active")&&te()):console.log("No students needed updating in any class.")}window.backfillWritingScoresForAll=Kn;function Qn(){console.log("Starting backfill for 'outOfClassCount' and 'wasOutOfClass' properties...");let c=0,C=0;const f=localStorage.getItem("teacherAssistantData_v2");if(!f){console.log("No data found in localStorage. Nothing to do.");return}const y=JSON.parse(f);for(const v in y){const T=y[v];T.students&&T.students.forEach(S=>{S.statusCounters&&typeof S.statusCounters.outOfClassCount>"u"&&(S.statusCounters.outOfClassCount=0,c++)}),T.sessions&&T.sessions.forEach(S=>{if(S.studentRecords)for(const Z in S.studentRecords){const q=S.studentRecords[Z];typeof q.wasOutOfClass>"u"&&(q.wasOutOfClass=!1,C++)}})}localStorage.setItem("teacherAssistantData_v2",JSON.stringify(y)),console.log(`Backfill complete. Updated ${c} students and ${C} session records. Data saved.`),nn(),p&&te()}window.backfillExitCounters=Qn});
