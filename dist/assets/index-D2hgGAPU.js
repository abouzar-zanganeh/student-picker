(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const a of document.querySelectorAll('link[rel="modulepreload"]'))s(a);new MutationObserver(a=>{for(const o of a)if(o.type==="childList")for(const i of o.addedNodes)i.tagName==="LINK"&&i.rel==="modulepreload"&&s(i)}).observe(document,{childList:!0,subtree:!0});function n(a){const o={};return a.integrity&&(o.integrity=a.integrity),a.referrerPolicy&&(o.referrerPolicy=a.referrerPolicy),a.crossOrigin==="use-credentials"?o.credentials="include":a.crossOrigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function s(a){if(a.ep)return;a.ep=!0;const o=n(a);fetch(a.href,o)}})();class vt{constructor(t){this.identity={name:t.name,studentId:t.studentId||`id_${new Date().getTime()}_${Math.random()}`,branchName:t.branchName||null,ageGroup:t.ageGroup||"adult",level:t.level||null,contact:{social:t.socialContact||null,parent:t.parentContact||null}},this.isDeleted=!1,this.statusCounters={totalSelections:0,missedChances:0,earlyLeaves:0,outOfClassCount:0},this.categoryCounts={},this.categoryIssues={},this.logs={parentContacts:[],scores:{},discipline:{},sessionHistory:{}},this.profile={notes:[],tags:[]},this.finalClassActivityScore=null,this.onboardingSession=null}addScore(t,n,s){if(n>100||n<0){console.log("Ù†Ù…Ø±Ù‡ Ù†Ø¨Ø§ÛŒØ¯ Ø§Ø² Û±Û°Û° Ø¨ÛŒØ´ØªØ± Ùˆ Ø§Ø² ØµÙØ± Ú©Ù…ØªØ± Ø¨Ø§Ø´Ø¯");return}const a=t.toLowerCase();this.logs.scores[a]||(this.logs.scores[a]=[]);const o=new po(t,n,s);this.logs.scores[a].push(o)}addNote(t,n=null){const s=new go(t,n);this.profile.notes.push(s)}getOverallAverageScore(){let t=0,n=0;for(const a in this.logs.scores)this.logs.scores[a].forEach(o=>{o.isDeleted||(t+=o.value,n++)});if(n===0)return null;const s=t/n;return Math.round(s*100)/100}}class po{constructor(t,n,s=""){this.id=`score_${new Date().getTime()}`,this.skill=t,this.value=n,this.timestamp=new Date,this.comment=s,this.isDeleted=!1}}class go{constructor(t,n=null){this.id=`note_${new Date().getTime()}`,this.timestamp=new Date,this.content=t,this.isDeleted=!1,this.source=n}}class Xt{constructor(t="complete",n=""){this.status=t,this.comment=n,this.timestamp=new Date}}class Xn{constructor(t){this.sessionNumber=t,this.startTime=new Date,this.note="",this.isDeleted=!1,this.endTime=null,this.isFinished=!1,this.isMakeup=!1,this.isCancelled=!1,this.studentRecords={},this.lastWinnerByCategory={},this.lastUsedCategoryId=null,this.lastSelectedWinnerId=null,this.winnerHistory=[]}end(){this.isFinished=!0,this.endTime=new Date}markAsMakeup(){this.isMakeup=!this.isMakeup}initializeStudentRecord(t){this.studentRecords[t]||(this.studentRecords[t]={attendance:"present",homework:new Xt,selections:{},hadIssue:!1,wasOutOfClass:!1})}setAttendance(t,n){this.initializeStudentRecord(t),this.studentRecords[t].attendance=n}setHomeworkStatus(t,n){this.initializeStudentRecord(t),this.studentRecords[t].homework.status=n}selectNextWinner(t,n,s){if(!n||n.length===0)return console.log("Ù‡ÛŒÚ† Ø¯Ø§Ù†Ø´â€ŒØ¢Ù…ÙˆØ²ÛŒ Ø¯Ø± Ú©Ù„Ø§Ø³ Ø¨Ø±Ø§ÛŒ Ø§Ù†ØªØ®Ø§Ø¨ ÙˆØ¬ÙˆØ¯ Ù†Ø¯Ø§Ø±Ø¯."),null;const a=this.lastWinnerByCategory[t];let o=n.filter(u=>u.identity.studentId!==a&&!u.isDeleted);if(o.length===0&&(o=n),o.length===0)return null;const i=(u,y)=>u.categoryCounts[y]||0,r=Math.min(...o.map(u=>i(u,t))),c=o.filter(u=>i(u,t)===r);let f;if(c.length===1)f=c[0];else if(c.length>1){const u=s.filter(N=>!N.isDeleted&&N.name!==t).map(N=>N.name),y=c.map(N=>{const _=u.reduce((G,j)=>G+i(N,j),0);return{student:N,otherCategoriesTotal:_}}),b=Math.min(...y.map(N=>N.otherCategoriesTotal)),L=y.filter(N=>N.otherCategoriesTotal===b).map(N=>N.student);L.length===1?f=L[0]:f=L[Math.floor(Math.random()*L.length)]}else f=o[Math.floor(Math.random()*o.length)];const p=f.identity.studentId;this.initializeStudentRecord(p);const w=(this.studentRecords[p].selections[t]||0)+1;return this.studentRecords[p].selections[t]=w,f.statusCounters.totalSelections++,f.categoryCounts[t]=(f.categoryCounts[t]||0)+1,this.lastWinnerByCategory[t]=p,f}}class Zt{constructor(t){this.info={name:t.name||"NotNamed",scheduleCode:t.scheduleCode||`code_${new Date().getTime()}`,teacherName:t.teacherName||null,type:t.type||"in-person",term:t.term||null,scheduleText:t.scheduleText||null,level:t.level||null,creationDate:t.creationDate?new Date(t.creationDate):new Date},this.students=[],this.sessions=[],this.note="",this.isDeleted=!1,this.categories=[new Se("Vocabulary","Questions about words and meanings."),new Se("Grammar","Questions about sentence structure and rules."),new Se("Listening",void 0,!0),new Se("Speaking",void 0,!0),new Se("Reading",void 0,!0),new Se("Writing",void 0,!0)],this.futurePlans={}}addStudent(t){this.students.push(t)}removeStudent(t){this.students=this.students.filter(n=>n.identity.studentId!==t)}startNewSession(){const t=this.sessions.length+1,n=new Xn(t);return this.sessions.push(n),n}endSpecificSession(t){const n=this.getSession(t);return n&&!n.isFinished?(n.end(),!0):!1}getSession(t){return this.sessions.find(n=>n.sessionNumber===t)}markAsMakeup(t){const n=this.getSession(t);n&&n.markAsMakeup()}planForSession(t,n){this.futurePlans[t]=n}hasSessionToday(){const t=new Date().toDateString();return this.sessions.some(n=>!n.isDeleted&&n.startTime.toDateString()===t)}selectNextWinner(t,n){return n?n.selectNextWinner(t,this.students,this.categories):null}get liveSession(){for(let t=this.sessions.length-1;t>=0;t--)if(!this.sessions[t].isFinished)return this.sessions[t];return null}endLiveSession(){const t=this.liveSession;return t?(t.end(),!0):!1}calculateFinalStudentScore(t){const n=t.logs.scores,s=["reading","writing"];for(const u of s)if(!n[u]||n[u].length===0)return null;const a=n.listening&&n.listening.length>0,o=n.speaking&&n.speaking.length>0;if(!a&&!o)return null;const i=u=>n[u].reduce((b,L)=>b+L.value,0)/n[u].length;let r;a&&o?r=(i("listening")+i("speaking"))/2:a?r=i("listening"):r=i("speaking");const c=i("reading"),f=i("writing"),w=(r*3+c*2+f*1)/6;return Math.trunc(w*10)/10}assignAllFinalScores(){let t=0,n=[];console.log("Ø´Ø±ÙˆØ¹ Ø¹Ù…Ù„ÛŒØ§Øª Ù…Ø­Ø§Ø³Ø¨Ù‡ Ù†Ù…Ø±Ù‡ Ù†Ù‡Ø§ÛŒÛŒ Ø¨Ø±Ø§ÛŒ ØªÙ…Ø§Ù… Ø¯Ø§Ù†Ø´â€ŒØ¢Ù…ÙˆØ²Ø§Ù†..."),this.students.forEach(a=>{const o=this.calculateFinalStudentScore(a);o!==null?(a.finalClassActivityScore=o,t++):(a.finalClassActivityScore=null,n.push(a.identity.name))});const s=n.length;console.log(`Ø¹Ù…Ù„ÛŒØ§Øª Ù¾Ø§ÛŒØ§Ù† ÛŒØ§ÙØª. ØªØ¹Ø¯Ø§Ø¯ Ù†Ù…Ø±Ø§Øª Ù…ÙˆÙÙ‚: ${t} | ØªØ¹Ø¯Ø§Ø¯ Ù†Ø§Ù…ÙˆÙÙ‚ (Ù†Ù…Ø±Ø§Øª Ù†Ø§Ù‚Øµ): ${s}`),s>0&&(console.log("Ø§Ø³Ø§Ù…ÛŒ Ø¯Ø§Ù†Ø´â€ŒØ¢Ù…ÙˆØ²Ø§Ù†ÛŒ Ú©Ù‡ Ù†Ù…Ø±Ø§ØªØ´Ø§Ù† Ù†Ø§Ù‚Øµ Ø§Ø³Øª:"),n.forEach(a=>console.log(`- ${a}`)))}}class Se{constructor(t,n="",s=!1){this.id=`cat_${new Date().getTime()}_${Math.random()}`,this.name=t,this.description=n,this.isDeleted=!1,this.isGradedCategory=s,this.isDeleted=!1}}let S={},d=null,yn=null,v=null,D=null,rt=null,Vt=null,Cn=[],Tt=null,vn=null,le=null,Dt=0,En=0,Mt=0,bn=0,In=null,Sn=null,$t=null,Te=null,he=-1,Ot=null,Ht=null,Rt=null,Zn=null,es=null,Ce=!1,M=[],ge=[],Re=[],ue={isScreenSaverEnabled:!0,lastRestoreTimestamp:null};function k(){if(Ce)return;const e={classrooms:S,trashBin:M,userSettings:ue};localStorage.setItem("teacherAssistantData_v2",JSON.stringify(e))}function ts(e=[]){const t={};if(e.length>0)e.forEach(i=>{S[i]&&(t[i]=S[i])});else for(const i in S)S[i].isDeleted||(t[i]=S[i]);const n={metadata:{version:"2.0",createdAt:new Date().toISOString()},data:{classrooms:t,trashBin:M}},s=JSON.stringify(n,null,2),o=`SP-Backup-${new Date().toLocaleDateString("fa-IR-u-nu-latn").replace(/\//g,"-")}.txt`;return new File([s],o,{type:"text/plain"})}function At(){const e=localStorage.getItem("teacherAssistantData_v2");if(!e)return;const t=JSON.parse(e);t.classrooms?(Ae(t.classrooms),M=t.trashBin||[],ue={...ue,...t.userSettings}):(Ae(t),ho())}function ho(){const e=[];Object.values(S).forEach(t=>{t.isDeleted?e.push({id:`trash_${Date.now()}_${Math.random()}`,timestamp:t.info.creationDate,type:"classroom",description:`Ú©Ù„Ø§Ø³ Â«${t.info.name}Â»`,restoreData:{name:t.info.name}}):t.students.forEach(n=>{n.isDeleted&&e.push({id:`trash_${Date.now()}_${Math.random()}`,timestamp:n.identity.studentId.split("_")[1],type:"student",description:`Ø¯Ø§Ù†Ø´â€ŒØ¢Ù…ÙˆØ² Â«${n.identity.name}Â»`,restoreData:{studentId:n.identity.studentId,classroomName:t.info.name}})})}),M.length===0&&e.length>0&&(M=e,console.log(`Migrated ${e.length} previously deleted item(s) to the new trash bin.`),k())}function Ae(e){S={};for(const t in e){const n=e[t];let s;n.info?s=n.info:s={...n,name:t};const a=new Zt(s);a.isDeleted=n.isDeleted,a.note=n.note||"",a.students=(n.students||[]).map(o=>{const i=new vt(o.identity);return i.isDeleted=o.isDeleted,i.statusCounters=o.statusCounters,i.logs=o.logs,i.logs.scores||(i.logs.scores={}),i.profile=o.profile,i.finalClassActivityScore=o.finalClassActivityScore,i.categoryCounts=o.categoryCounts||{},i.categoryIssues=o.categoryIssues||{},i.onboardingSession=o.onboardingSession||null,i}),a.sessions=(n.sessions||[]).map(o=>{const i=new Xn(o.sessionNumber);i.isDeleted=o.isDeleted,i.note=o.note||"",i.startTime=new Date(o.startTime),i.endTime=o.endTime?new Date(o.endTime):null,i.isFinished=o.isFinished,i.isMakeup=o.isMakeup,i.isCancelled=o.isCancelled||!1,i.studentRecords=o.studentRecords;for(const c in i.studentRecords){const f=i.studentRecords[c];f.homework&&!(f.homework instanceof Xt)&&(i.studentRecords[c].homework=new Xt(f.homework.status,f.homework.comment))}i.lastWinnerByCategory=o.lastWinnerByCategory,i.lastUsedCategoryId=o.lastUsedCategoryId,i.lastSelectedWinnerId=o.lastSelectedWinnerId;const r=o.winnerHistory||[];return i.winnerHistory=r.filter(c=>c&&c.winner).map(c=>({winner:a.students.find(p=>p.identity.studentId===c.winner.identity.studentId),categoryName:c.categoryName})).filter(c=>c.winner),i}),a.categories=(n.categories||[]).map(o=>{const i=new Se(o.name,o.description,o.isGradedCategory);return i.id=o.id,i.isDeleted=o.isDeleted,i}),a.futurePlans=n.futurePlans,S[t]=a}}function ns(e,t){if(t){const n=e.data.classrooms;for(let s in n){let a=s;const o=n[s];for(;S[a];)a=`${a} (Restored)`;a!==s&&(o.info.name=a),S[a]=o}if(e.data.trashBin){const s=[...M,...e.data.trashBin],a=[...new Map(s.map(o=>[o.id,o])).values()];Ft(a)}Ae(S)}else Ae(e.data.classrooms),Ft(e.data.trashBin||[]);nt({lastRestoreTimestamp:new Date().toISOString()}),k()}function ss(e,t){if(S[t])return{success:!1,message:"Ú©Ù„Ø§Ø³ÛŒ Ø¨Ø§ Ø§ÛŒÙ† Ù†Ø§Ù… Ø§Ø² Ù‚Ø¨Ù„ ÙˆØ¬ÙˆØ¯ Ø¯Ø§Ø±Ø¯."};const n=S[e];return n?(n.info.name=t,S[t]=n,delete S[e],d===n&&X(n),{success:!0}):{success:!1,message:"Ú©Ù„Ø§Ø³ Ù…ÙˆØ±Ø¯ Ù†Ø¸Ø± ÛŒØ§ÙØª Ù†Ø´Ø¯."}}function os(e,t,n){const s=n.trim();if(!s)return{success:!1,message:"Ù†Ø§Ù… Ø¯Ø³ØªÙ‡â€ŒØ¨Ù†Ø¯ÛŒ Ù†Ù…ÛŒâ€ŒØªÙˆØ§Ù†Ø¯ Ø®Ø§Ù„ÛŒ Ø¨Ø§Ø´Ø¯."};if(e.categories.some(c=>c.id!==t.id&&!c.isDeleted&&c.name.toLowerCase()===s.toLowerCase()))return{success:!1,message:"Ø¯Ø³ØªÙ‡â€ŒØ¨Ù†Ø¯ÛŒ Ø¯ÛŒÚ¯Ø±ÛŒ Ø¨Ø§ Ø§ÛŒÙ† Ù†Ø§Ù… ÙˆØ¬ÙˆØ¯ Ø¯Ø§Ø±Ø¯."};const o=t.name,i=o.toLowerCase(),r=s.toLowerCase();return t.name=s,e.students.forEach(c=>{c.categoryCounts&&c.categoryCounts[o]!==void 0&&(c.categoryCounts[s]=c.categoryCounts[o],delete c.categoryCounts[o]),c.categoryIssues&&c.categoryIssues[o]!==void 0&&(c.categoryIssues[s]=c.categoryIssues[o],delete c.categoryIssues[o]),c.logs.scores&&c.logs.scores[i]&&(c.logs.scores[i].forEach(f=>f.skill=s),i!==r&&(c.logs.scores[r]=c.logs.scores[i],delete c.logs.scores[i]))}),e.sessions.forEach(c=>{c.lastWinnerByCategory&&c.lastWinnerByCategory[o]&&(c.lastWinnerByCategory[s]=c.lastWinnerByCategory[o],delete c.lastWinnerByCategory[o]),c.winnerHistory&&c.winnerHistory.forEach(f=>{f.categoryName===o&&(f.categoryName=s)})}),{success:!0}}function as(e,t,n){if(q(n.students).some(i=>i.identity.name.toLowerCase()===e.identity.name.toLowerCase()))return{success:!1,message:`Ø¯Ø§Ù†Ø´â€ŒØ¢Ù…ÙˆØ²ÛŒ Ø¨Ø§ Ù†Ø§Ù… Â«${e.identity.name}Â» Ø§Ø² Ù‚Ø¨Ù„ Ø¯Ø± Ú©Ù„Ø§Ø³ Â«${n.info.name}Â» ÙˆØ¬ÙˆØ¯ Ø¯Ø§Ø±Ø¯.`};const a=JSON.parse(JSON.stringify(e));n.addStudent(a);const o=t.students.find(i=>i.identity.studentId===e.identity.studentId);return o&&dt(o,t),{success:!0}}function is(){for(const e in S){const t=S[e];t.students.forEach(n=>{n.statusCounters={totalSelections:0,missedChances:0,earlyLeaves:0},n.categoryCounts={},n.categoryIssues={},t.sessions.forEach(s=>{const a=n.identity.studentId;s.studentRecords[a]&&(s.studentRecords[a].attendance="present")})})}k()}function q(e){return Array.isArray(e)?e.filter(t=>!t.isDeleted):[]}function fe(e){const t=new Map;return e&&q(e.sessions).filter(s=>!s.isCancelled).sort((s,a)=>s.sessionNumber-a.sessionNumber).forEach((s,a)=>{t.set(s.sessionNumber,a+1)}),t}function Oe(e){he=e}function ve(e){Ot=e}function dt(e,t){if(!e||!t)return;const n=e.identity.studentId,s=t.students.findIndex(a=>a.identity.studentId===n);s>-1&&t.students.splice(s,1),t.sessions.forEach(a=>{a.studentRecords[n]&&delete a.studentRecords[n];for(const o in a.lastWinnerByCategory)a.lastWinnerByCategory[o]===n&&delete a.lastWinnerByCategory[o];a.lastSelectedWinnerId===n&&(a.lastSelectedWinnerId=null),a.winnerHistory=a.winnerHistory.filter(o=>o.winner&&o.winner.identity.studentId!==n)})}function cs(e,t){const n=S[e];if(!n)return;const s=n.sessions.findIndex(a=>a.sessionNumber===t);s>-1&&(n.students.forEach(a=>{a.profile.notes&&a.profile.notes.length>0&&(a.profile.notes=a.profile.notes.filter(o=>!o.source||o.source.type!=="fromAttendance"||o.source.sessionNumber!==t)),a.onboardingSession===t&&(a.onboardingSession=null)}),n.sessions.splice(s,1))}function ls(e,t){const n=S[e];if(!n)return;const s=n.categories.findIndex(r=>r.id===t);if(s===-1)return;const o=n.categories[s].name,i=o.toLowerCase();n.students.forEach(r=>{r.categoryCounts&&delete r.categoryCounts[o],r.categoryIssues&&delete r.categoryIssues[o],r.logs.scores&&delete r.logs.scores[i]}),n.sessions.forEach(r=>{r.lastWinnerByCategory[o]&&delete r.lastWinnerByCategory[o],r.winnerHistory=r.winnerHistory.filter(c=>c.categoryName!==o)}),n.categories.splice(s,1)}function rs(e,t,n,s){const a=S[e];if(!a)return;const o=a.students.find(c=>c.identity.studentId===t);if(!o||!o.logs.scores[n.toLowerCase()])return;const i=o.logs.scores[n.toLowerCase()],r=i.findIndex(c=>c.id===s);r>-1&&i.splice(r,1)}function ds(e,t,n){const s=S[e];if(!s)return;const a=s.students.find(i=>i.identity.studentId===t);if(!a||!a.profile.notes)return;const o=a.profile.notes.findIndex(i=>i.id===n);o>-1&&a.profile.notes.splice(o,1)}function us(){JSON.parse(JSON.stringify({classrooms:S,trashBin:M})),Ce=!0}function ms(){Ce=!1,At()}function X(e){d=e}function ut(e){yn=e}function ie(e){v=e}function de(e){D=e}function Wt(e){rt=e}function fs(e){Vt=e}function Ze(e){Cn=e}function Et(e){Tt=e}function ps(e){vn=e}function _t(e){le=e}function bt(e){Dt=e}function gs(e){En=e}function It(e){Mt=e}function hs(e){bn=e}function Ln(e){In=e}function wn(e){Sn=e}function mt(e){$t=e}function kn(e){Te=e}function Pt(e){Rt=e}function ys(e){Zn=e}function Cs(e){es=e}function Ft(e){M=e}function Gt(e){Ht=e}function qt(e){Re=e}function nt(e){ue={...ue,...e},k()}function en(e){ge=e}const yo=Object.freeze(Object.defineProperty({__proto__:null,get activeModal(){return Te},get cancelCallback(){return Sn},get classrooms(){return S},get confirmCallback(){return In},get currentClassroom(){return d},get easterEggClickCount(){return Dt},get easterEggLastClickTime(){return En},enterDemoMode:us,exitDemoMode:ms,getActiveItems:q,getSessionDisplayMap:fe,get importedFileContent(){return Tt},get isDemoMode(){return Ce},get liveSession(){return yn},loadData:At,get manualSelection(){return Rt},moveStudent:as,get namesToImport(){return Cn},get notificationTimeout(){return vn},permanentlyDeleteCategory:ls,permanentlyDeleteNote:ds,permanentlyDeleteScore:rs,permanentlyDeleteSession:cs,permanentlyDeleteStudent:dt,prepareBackupData:ts,get previousState(){return rt},processRestore:ns,rehydrateData:Ae,renameCategory:os,renameClassroom:ss,resetAllStudentCounters:is,get resetEasterEggClickCount(){return Mt},get resetEasterEggLastClickTime(){return bn},get saveCategoryCallback(){return Ht},saveData:k,get saveNoteCallback(){return Ot},get secureConfirmCallback(){return $t},get selectedCategory(){return le},get selectedClassIds(){return ge},get selectedSession(){return v},get selectedStudentForProfile(){return D},get selectedStudentsForMassComment(){return Re},setActiveModal:kn,setCancelCallback:wn,setConfirmCallback:Ln,setCurrentClassroom:X,setEasterEggClickCount:bt,setEasterEggLastClickTime:gs,setImportedFileContent:Et,setLiveSession:ut,setManualSelection:Pt,setNamesToImport:Ze,setNotificationTimeout:ps,setPreviousState:Wt,setResetEasterEggClickCount:It,setResetEasterEggLastClickTime:hs,setSaveCategoryCallback:Gt,setSaveNoteCallback:ve,setSecureConfirmCallback:mt,setSelectedCategory:_t,setSelectedClassIds:en,setSelectedSession:ie,setSelectedStudentForProfile:de,setSelectedStudentsForMassComment:qt,setSourceClassForMove:Cs,setStudentToMove:ys,setTrashBin:Ft,setUndoTimeout:fs,setUserSettings:nt,setWinnerHistoryIndex:Oe,get sourceClassForMove(){return es},get studentToMove(){return Zn},get trashBin(){return M},get undoTimeout(){return Vt},get userSettings(){return ue},get winnerHistoryIndex(){return he}},Symbol.toStringTag,{value:"Module"}));function be(e){return typeof e!="string"?"":e.replace(/ÙŠ/g,"ÛŒ").replace(/Ùƒ/g,"Ú©").replace(/[\s\u200c]/g,"")}function Nn(e){return typeof e!="string"||e.length===0?"ltr":/[\u0590-\u07FF]/.test(e)?"rtl":"ltr"}function vs(e){return!e||!e.trim()?"":e.split(`
`).map(s=>`<div dir="${Nn(s)}">${s||"&nbsp;"}</div>`).join("")}function Yt(e){if(typeof e!="string")return"";const t={q:"Ø¶",w:"Øµ",e:"Ø«",r:"Ù‚",t:"Ù",y:"Øº",u:"Ø¹",i:"Ù‡",o:"Ø®",p:"Ø­","[":"Ø¬","]":"Ú†",a:"Ø´",s:"Ø³",d:"ÛŒ",f:"Ø¨",g:"Ù„",h:"Ø§",j:"Øª",k:"Ù†",l:"Ù…",";":"Ú©","'":"Ú¯",z:"Ø¸",x:"Ø·",c:"Ø²",v:"Ø±",b:"Ø°",n:"Ø¯",m:"Ù¾",",":"Ùˆ"};let n="";for(let s=0;s<e.length;s++){const a=e[s].toLowerCase();n+=t[a]||e[s]}return n}const Es="teacherAssistantLogs_v2",Co=100;function Bn(){try{const e=localStorage.getItem(Es);return e?JSON.parse(e):{}}catch(e){return console.error("Error reading logs from localStorage:",e),{}}}function bs(e){try{localStorage.setItem(Es,JSON.stringify(e))}catch(t){console.error("Error saving logs to localStorage:",t)}}function A(e,t,n=null){if(!e)return;const s=Bn();s[e]||(s[e]=[]);const a={timestamp:new Date().toISOString(),message:t,action:n,classroomName:e};s[e].unshift(a),s[e].length>Co&&s[e].pop(),bs(s)}function vo(e){return Bn()[e]||[]}function Eo(e,t){const n=Bn();n[e]&&!n[t]&&(n[t]=n[e],delete n[e],bs(n))}const Is=document.getElementById("class-management-page"),bo=document.getElementById("new-class-name"),Io=document.getElementById("add-class-btn"),Ge=document.getElementById("class-list"),Ut=document.getElementById("undo-toast"),Ss=document.getElementById("undo-message"),So=document.getElementById("undo-btn"),Lo=document.getElementById("settings-page"),xn=document.getElementById("settings-class-name-header"),tn=document.getElementById("settings-student-list"),nn=document.getElementById("category-list"),wo=document.getElementById("back-to-sessions-btn"),ko=document.getElementById("new-student-name"),No=document.getElementById("add-student-btn"),Ls=document.getElementById("paste-area"),Bo=document.getElementById("process-paste-btn"),xo=document.getElementById("csv-preview-page"),sn=document.getElementById("csv-preview-list"),To=document.getElementById("csv-confirm-btn"),Do=document.getElementById("csv-cancel-btn"),Mo=document.getElementById("import-csv-btn"),$o=document.getElementById("csv-file-input"),Oo=document.getElementById("column-mapping-page"),on=document.getElementById("column-select-dropdown"),Ho=document.getElementById("confirm-column-btn"),Ro=document.getElementById("cancel-import-btn"),Ao=document.getElementById("new-category-name"),Wo=document.getElementById("add-category-btn"),an=document.querySelector(".app-header"),we=document.getElementById("select-student-btn"),ze=document.getElementById("select-student-btn-wrapper"),_o=document.getElementById("attendance-page"),st=document.getElementById("attendance-list"),Po=document.getElementById("finish-attendance-btn"),Fo=document.querySelector("#class-management-page h2"),cn=document.getElementById("student-stats-header"),qo=document.getElementById("hamburger-menu-btn"),Uo=document.getElementById("side-nav-menu"),Vo=document.getElementById("close-nav-btn"),Go=document.getElementById("overlay"),jo=document.getElementById("backup-data-btn"),zo=document.getElementById("restore-data-btn"),ws=document.getElementById("restore-file-input"),Jo=document.getElementById("custom-confirm-modal"),ks=document.getElementById("confirm-modal-message"),ln=document.getElementById("confirm-modal-cancel-btn"),et=document.getElementById("confirm-modal-confirm-btn"),Ko=document.getElementById("secure-confirm-modal"),Ns=document.getElementById("secure-confirm-message"),Bs=document.getElementById("secure-confirm-code"),Ue=document.getElementById("secure-confirm-input"),Qo=document.getElementById("secure-confirm-cancel-btn"),St=document.getElementById("secure-confirm-confirm-btn"),Yo=document.getElementById("add-note-modal"),H=document.getElementById("new-note-content"),Xo=document.getElementById("class-save-note-btn"),Zo=document.getElementById("cancel-note-btn"),rn=document.getElementById("student-search-input"),xe=document.getElementById("student-search-results"),ea=document.getElementById("back-to-student-page-btn"),ta=document.getElementById("graded-category-pills-container"),na=document.getElementById("new-score-value"),xs=document.getElementById("new-score-comment"),sa=document.getElementById("add-score-btn"),oa=document.getElementById("profile-stats-summary"),aa=document.getElementById("profile-scores-list"),Lt=document.getElementById("global-student-search-input"),Ie=document.getElementById("global-student-search-results"),ia=document.getElementById("is-graded-checkbox"),ca=document.getElementById("trashed-classes-list"),la=document.getElementById("trashed-students-list"),ra=document.getElementById("trashed-sessions-list"),da=document.getElementById("trashed-categories-list"),ua=document.getElementById("trashed-notes-list"),ma=document.getElementById("trashed-scores-list"),ot=document.getElementById("quick-grade-form-wrapper"),Le=document.getElementById("quick-score-input"),ye=document.getElementById("quick-note-textarea"),Je=document.getElementById("quick-grade-submit-btn"),at=document.getElementById("category-selection-container"),dn=document.getElementById("selected-student-result"),He=document.getElementById("custom-context-menu"),Ve=document.getElementById("breadcrumb-container");let je=null;const fa=document.getElementById("category-modal"),Ts=document.getElementById("category-modal-title"),it=document.getElementById("new-category-modal-name"),Tn=document.getElementById("new-category-modal-is-graded"),pa=document.getElementById("category-modal-cancel-btn"),Ds=document.getElementById("category-modal-save-btn"),ga=document.getElementById("mass-comment-modal"),ha=document.getElementById("mass-comment-modal-title"),Ms=document.getElementById("mass-comment-student-count-message"),ct=document.getElementById("mass-comment-content"),Dn=document.getElementById("mass-comment-append-checkbox"),ya=document.getElementById("mass-comment-cancel-btn"),Ca=document.getElementById("mass-comment-save-btn"),un=document.getElementById("mass-comment-btn"),wt=document.getElementById("attendance-mass-actions-container"),Me=document.createElement("input"),va=document.getElementById("session-dashboard-page");function Mn(e="selector"){if(!d||!v){T("class-management-page");return}La(),Nt(),oe(),We(),T("session-dashboard-page"),$s(),$n(e),wa()}function $n(e){const t=document.getElementById("selector-tab-btn"),n=document.getElementById("attendance-tab-btn"),s=document.getElementById("selector-pane"),a=document.getElementById("attendance-pane"),o=e==="selector";t.classList.toggle("active",o),n.classList.toggle("active",!o),s.classList.toggle("active",o),a.classList.toggle("active",!o)}function $s(){const e=document.getElementById("selector-tab-btn"),t=document.getElementById("attendance-tab-btn"),n=document.getElementById("selector-pane"),s=document.getElementById("attendance-pane");e.addEventListener("click",()=>{e.classList.add("active"),t.classList.remove("active"),n.classList.add("active"),s.classList.remove("active")}),t.addEventListener("click",()=>{t.classList.add("active"),e.classList.remove("active"),s.classList.add("active"),n.classList.remove("active")})}function Ea(e){clearTimeout(Vt),rt||Wt(JSON.stringify(S)),Ss.textContent=e,Ut.classList.add("show"),fs(setTimeout(()=>{Ut.classList.remove("show"),Wt(null)},5e3))}function Os(){if(rt){const e=d?d.info.name:null,t=JSON.parse(rt);Ae(t),e&&S[e]?X(S[e]):X(null),d?(ke(),Ke(),te()):ae(),Ut.classList.remove("show"),clearTimeout(Vt),Wt(null)}}function C(e,t=3e3){const n=document.getElementById("notification-toast");n&&(n.textContent=e,n.classList.add("show"),clearTimeout(vn),ps(setTimeout(()=>{n.classList.remove("show")},t)))}function Hs(e){const t=document.getElementById("restore-confirm-modal"),n=document.getElementById("restore-modal-message"),s=document.getElementById("restore-append-checkbox"),a=document.getElementById("restore-confirm-cancel-btn"),o=document.getElementById("restore-confirm-confirm-btn"),i=document.getElementById("restore-modal-warning");i.style.display="none";const r=e.metadata.createdAt;if(ue.lastRestoreTimestamp&&r<ue.lastRestoreTimestamp){const u=new Date(r).toLocaleDateString("fa-IR"),y=new Date(ue.lastRestoreTimestamp).toLocaleDateString("fa-IR");i.textContent=`âš ï¸ Ù‡Ø´Ø¯Ø§Ø±: Ø§ÛŒÙ† ÙØ§ÛŒÙ„ Ù¾Ø´ØªÛŒØ¨Ø§Ù† (${u}) Ù‚Ø¯ÛŒÙ…ÛŒâ€ŒØªØ± Ø§Ø² Ø¢Ø®Ø±ÛŒÙ† Ø¨Ø§Ø²ÛŒØ§Ø¨ÛŒ Ø´Ù…Ø§ (${y}) Ø§Ø³Øª.`,i.style.display="block"}const c=Object.keys(e.data.classrooms).length,f="Ú©Ù„Ø§Ø³";n.textContent=`ÙØ§ÛŒÙ„ Ù¾Ø´ØªÛŒØ¨Ø§Ù† Ø´Ù…Ø§ Ø­Ø§ÙˆÛŒ ${c} ${f} Ø§Ø³Øª. Ù„Ø·ÙØ§Ù‹ Ù†Ø­ÙˆÙ‡ Ø¨Ø§Ø²ÛŒØ§Ø¨ÛŒ Ø±Ø§ Ù…Ø´Ø®Øµ Ú©Ù†ÛŒØ¯.`,s.checked=!0;const p=()=>{const u=s.checked;ns(e,u),t.removeEventListener("click",p),F(),ae(),T("class-management-page"),C("âœ… Ø§Ø·Ù„Ø§Ø¹Ø§Øª Ø¨Ø§ Ù…ÙˆÙÙ‚ÛŒØª Ø¨Ø§Ø²ÛŒØ§Ø¨ÛŒ Ø´Ø¯.")},w=()=>{F()};o.onclick=p,a.onclick=w,Z("restore-confirm-modal")}function z(e,t,n={}){const{confirmText:s="ØªØ§ÛŒÛŒØ¯",cancelText:a="Ù„ØºÙˆ",confirmClass:o="btn-success",onCancel:i=()=>{},isDelete:r=!1}=n,c=r?()=>Rs(e,t):t;ks.textContent=e,et.textContent=s,ln.textContent=a,et.className="modal-action-btn",et.classList.add(o),Ln(c),wn(i);const f=et.parentElement;ln.style.display=i===null?"none":"inline-block",f.style.justifyContent=i===null?"center":"space-between",Z("custom-confirm-modal")}function Rs(e,t){const n=Math.floor(1e4+Math.random()*9e4).toString();Ns.textContent=e,Bs.textContent=n,Ue.value="",St.disabled=!0,mt(t),Z("secure-confirm-modal"),Ue.focus();const s=()=>{Ue.value===n?St.disabled=!1:St.disabled=!0};return Ue.addEventListener("input",s),()=>{Ue.removeEventListener("input",s)}}function mn(e,t={}){const{title:n="Ø§ÛŒØ¬Ø§Ø¯ Ø¯Ø³ØªÙ‡â€ŒØ¨Ù†Ø¯ÛŒ Ø¬Ø¯ÛŒØ¯",initialName:s="",initialIsGraded:a=!1,saveButtonText:o="Ø°Ø®ÛŒØ±Ù‡"}=t;Ts.textContent=n,it.value=s,Tn.checked=a,Ds.textContent=o,Gt((i,r)=>{if(!i){C("âš ï¸ Ù„Ø·ÙØ§Ù‹ Ù†Ø§Ù… Ø¯Ø³ØªÙ‡â€ŒØ¨Ù†Ø¯ÛŒ Ø±Ø§ ÙˆØ§Ø±Ø¯ Ú©Ù†ÛŒØ¯.");return}e(i,r),F()}),Z("category-modal"),it.focus(),s&&it.select()}function As(e,t){const n=Object.values(S).filter(i=>!i.isDeleted&&i.info.name!==t.info.name),s=document.getElementById("move-student-modal-title"),a=document.getElementById("move-student-class-select"),o=document.getElementById("move-student-confirm-btn");s.textContent=`Ø§Ù†ØªÙ‚Ø§Ù„ Ø¯Ø§Ù†Ø´â€ŒØ¢Ù…ÙˆØ²: ${e.identity.name}`,a.innerHTML="",n.length===0?(a.innerHTML='<option value="">Ú©Ù„Ø§Ø³ Ø¯ÛŒÚ¯Ø±ÛŒ Ø¨Ø±Ø§ÛŒ Ø§Ù†ØªÙ‚Ø§Ù„ ÙˆØ¬ÙˆØ¯ Ù†Ø¯Ø§Ø±Ø¯</option>',o.disabled=!0):(n.forEach(i=>{const r=document.createElement("option");r.value=i.info.name,r.textContent=i.info.name,a.appendChild(r)}),o.disabled=!1),ys(e),Cs(t),Z("move-student-modal")}function On(e,t){if(!e||!t)return;const n=e.identity.name,s=document.getElementById("add-note-modal-title");s.textContent="ØªØºÛŒÛŒØ± Ù†Ø§Ù… Ø¯Ø§Ù†Ø´â€ŒØ¢Ù…ÙˆØ²",H.value=n,H.rows=1,H.dispatchEvent(new Event("input",{bubbles:!0})),ve(a=>{const o=a.trim();o&&o!==n&&(q(t.students).some(r=>r.identity.studentId!==e.identity.studentId&&r.identity.name.toLowerCase()===o.toLowerCase())?C("Ø¯Ø§Ù†Ø´â€ŒØ¢Ù…ÙˆØ²ÛŒ Ø¨Ø§ Ø§ÛŒÙ† Ù†Ø§Ù… Ø§Ø² Ù‚Ø¨Ù„ Ø¯Ø± Ø§ÛŒÙ† Ú©Ù„Ø§Ø³ ÙˆØ¬ÙˆØ¯ Ø¯Ø§Ø±Ø¯."):(e.identity.name=o,A(t.info.name,`Ù†Ø§Ù… Ø¯Ø§Ù†Ø´â€ŒØ¢Ù…ÙˆØ² Â«${n}Â» Ø¨Ù‡ Â«${o}Â» ØªØºÛŒÛŒØ± ÛŒØ§ÙØª.`,{type:"VIEW_STUDENT_PROFILE",studentId:e.identity.studentId}),k(),ke(),oe(),D&&D.identity.studentId===e.identity.studentId&&ne(e),C(`âœ…Ù†Ø§Ù… Ø¯Ø§Ù†Ø´â€ŒØ¢Ù…ÙˆØ² Ø¨Ù‡ Â«${o}Â» ØªØºÛŒÛŒØ± ÛŒØ§ÙØª.`))),s.textContent="Ø«Ø¨Øª ÛŒØ§Ø¯Ø¯Ø§Ø´Øª Ø¬Ø¯ÛŒØ¯",H.rows=4}),Z("add-note-modal"),H.focus(),H.select()}function Z(e){const t=document.getElementById(e);if(t){if(Te)return;document.body.classList.add("modal-active"),t.classList.add("modal-visible"),kn(e),history.pushState(null,"",location.href)}}function F(e,t=!1){if(!Te)return;const n=document.getElementById(Te),s=Te;kn(null),t||history.back(),n&&(n.classList.add("modal-closing"),setTimeout(()=>{n.classList.remove("modal-visible"),n.classList.remove("modal-closing"),document.body.classList.remove("modal-active"),s==="custom-confirm-modal"&&(Ln(null),wn(null)),s==="secure-confirm-modal"&&mt(null),s==="category-modal"&&Gt(null),s==="mass-comment-modal"&&(ct.value=""),s==="add-note-modal"&&ve(null),typeof e=="function"&&e()},300))}function Hn(){var t;if(((t=document.querySelector(".page.active"))==null?void 0:t.id)!=="attendance-page"){wt.style.display="none";return}const e=Re.length;e<1?wt.style.display="none":wt.style.display="block",un.disabled=e<1,un.textContent=`ğŸ“ Ø«Ø¨Øª ÛŒØ§Ø¯Ø¯Ø§Ø´Øª Ú¯Ø±ÙˆÙ‡ÛŒ (${e} Ù†ÙØ±)`}function Ws(){const e=Re,t=e.length;let n=!1;t>0&&(n=e.some(a=>{var o;return(o=v.studentRecords[a])==null?void 0:o.homework.comment})),Ms.textContent=`ÛŒØ§Ø¯Ø¯Ø§Ø´Øª Ø¨Ø±Ø§ÛŒ ${t} Ø¯Ø§Ù†Ø´â€ŒØ¢Ù…ÙˆØ² Ø«Ø¨Øª Ø®ÙˆØ§Ù‡Ø¯ Ø´Ø¯.`,ct.value="",ct.dispatchEvent(new Event("input",{bubbles:!0})),Dn.checked=!0;const s=document.querySelector("#mass-comment-modal .modal-options");s.style.display=n?"flex":"none",Z("mass-comment-modal"),ct.focus()}function fn(e,t){if(!d||!v)return;let n=0;const s=Re,a=v;s.forEach(o=>{const i=a.studentRecords[o];if(i&&i.homework){const r=i.homework.comment||"";let c=e;t&&r.length>0?c=r+`
---
`+e:c=e,i.homework.comment=c.trim();const f=d.students.find(p=>p.identity.studentId===o);f&&ba(f,a,c.trim()),n++}}),qt([]),k(),We(),A(d.info.name,`${n} Ø¯Ø§Ù†Ø´â€ŒØ¢Ù…ÙˆØ² Ø¨Ù‡ ØµÙˆØ±Øª Ú¯Ø±ÙˆÙ‡ÛŒ ÛŒØ§Ø¯Ø¯Ø§Ø´Øª ØªÚ©Ù„ÛŒÙ Ú¯Ø±ÙØªÙ†Ø¯.`,{type:"VIEW_SESSIONS"}),C(`âœ… ÛŒØ§Ø¯Ø¯Ø§Ø´Øª Ø¨Ø±Ø§ÛŒ ${n} Ø¯Ø§Ù†Ø´â€ŒØ¢Ù…ÙˆØ² Ø«Ø¨Øª Ø´Ø¯.`)}function ba(e,t,n){const a=fe(d).get(t.sessionNumber),o={type:"fromAttendance",sessionNumber:t.sessionNumber},i=`ÛŒØ§Ø¯Ø¯Ø§Ø´Øª Ù…Ø±Ø¨ÙˆØ· Ø¨Ù‡ Ø¬Ù„Ø³Ù‡ ${a}: `,r=e.profile.notes.find(c=>!c.isDeleted&&c.source&&c.source.type==="fromAttendance"&&c.source.sessionNumber===o.sessionNumber);r?n?(r.content=i+n,r.isDeleted=!1):r.isDeleted=!0:n&&e.addNote(i+n,o)}function Rn(e){H.value=e.note||"",ve(t=>{e.note=t,k(),A(e.info.name,"ÛŒØ§Ø¯Ø¯Ø§Ø´Øª Ú©Ù„Ø§Ø³ Ø°Ø®ÛŒØ±Ù‡ Ø´Ø¯.",{type:"VIEW_CLASS_NOTE"}),ae(),C("âœ… ÛŒØ§Ø¯Ø¯Ø§Ø´Øª Ú©Ù„Ø§Ø³ Ø°Ø®ÛŒØ±Ù‡ Ø´Ø¯.")}),Z("add-note-modal"),H.focus()}function An(e){X(e),xn.textContent=`ØªÙ†Ø¸ÛŒÙ…Ø§Øª Ú©Ù„Ø§Ø³: ${e.info.name}`,ke(),Ke(),T("settings-page")}function _s(e){const t=document.getElementById("log-modal-title"),n=document.getElementById("log-list");t.textContent=`Ú¯Ø²Ø§Ø±Ø´ ÙØ¹Ø§Ù„ÛŒØªâ€ŒÙ‡Ø§ÛŒ Ú©Ù„Ø§Ø³: ${e}`,n.innerHTML="";const s=vo(e);s.length===0?n.innerHTML='<li class="no-content-message">Ù‡Ù†ÙˆØ² ÙØ¹Ø§Ù„ÛŒØªÛŒ Ø¨Ø±Ø§ÛŒ Ø§ÛŒÙ† Ú©Ù„Ø§Ø³ Ø«Ø¨Øª Ù†Ø´Ø¯Ù‡ Ø§Ø³Øª.</li>':s.forEach(a=>{const o=document.createElement("li");o.className="log-entry";const i=new Date(a.timestamp),r=`${i.toLocaleDateString("fa-IR")} - ${i.toLocaleTimeString("fa-IR",{hour:"2-digit",minute:"2-digit"})}`,c=document.createElement("span");c.className="log-timestamp",c.textContent=r;const f=document.createElement("span");f.className="log-message",f.textContent=a.message,a.action&&(f.classList.add("log-action-link"),f.dataset.action=JSON.stringify({...a.action,classroomName:a.classroomName})),o.appendChild(c),o.appendChild(f),n.appendChild(o)}),Z("log-modal")}document.getElementById("log-modal-close-btn").addEventListener("click",()=>{F()});function pn(e){const t=URL.createObjectURL(e),n=document.createElement("a");n.href=t,n.download=e.name,document.body.appendChild(n),n.click(),document.body.removeChild(n),URL.revokeObjectURL(t)}async function ft(e=[]){const t=ts(e);if(("ontouchstart"in window||navigator.maxTouchPoints>0)&&navigator.share&&navigator.canShare&&navigator.canShare({files:[t]}))try{await navigator.share({title:"Ù¾Ø´ØªÛŒØ¨Ø§Ù† Ø¯Ø³ØªÛŒØ§Ø± Ù…Ø¹Ù„Ù…",text:"ÙØ§ÛŒÙ„ Ù¾Ø´ØªÛŒØ¨Ø§Ù† Ø¯Ø§Ø¯Ù‡â€ŒÙ‡Ø§ÛŒ Ø¨Ø±Ù†Ø§Ù…Ù‡",files:[t]})}catch(s){s.name!=="AbortError"&&(console.error("Error sharing file:",s),pn(t),C("âš ï¸Ø§Ø´ØªØ±Ø§Ú©â€ŒÚ¯Ø°Ø§Ø±ÛŒ Ø¨Ø§ Ø®Ø·Ø§ Ù…ÙˆØ§Ø¬Ù‡ Ø´Ø¯. ÙØ§ÛŒÙ„ Ø¯Ø± Ø­Ø§Ù„ Ø¯Ø§Ù†Ù„ÙˆØ¯ Ø§Ø³Øª."))}else pn(t),C("âœ…Ù¾Ø´ØªÛŒØ¨Ø§Ù†â€ŒÚ¯ÛŒØ±ÛŒ Ø¨Ø§ Ù…ÙˆÙÙ‚ÛŒØª Ø§Ù†Ø¬Ø§Ù… Ø´Ø¯.")}function gt(e,t){e.preventDefault(),$e(),je=e.target.closest("li"),je&&je.classList.add("context-menu-target"),setTimeout(()=>{const n=He,s=n.querySelector("ul");s.innerHTML="",t.forEach(f=>{const p=document.createElement("li");f.isSeparator?p.className="separator":(p.innerHTML=`
                    <span class="icon">${f.icon||""}</span>
                    <span class="label">${f.label}</span>
                `,f.className&&p.classList.add(f.className),p.addEventListener("click",()=>{f.action(),$e()})),s.appendChild(p)}),n.classList.add("visible");const{offsetWidth:a,offsetHeight:o}=n,{innerHeight:i}=window,r=document.body.getBoundingClientRect();n.style.top=`${(i-o)/2}px`;const c=r.left+r.width/2;n.style.left=`${c-a/2}px`},50)}function $e(){He.classList.contains("visible")&&He.classList.remove("visible"),je&&(je.classList.remove("context-menu-target"),je=null)}function Ps(){var t,n;Ve.innerHTML="";const e=[];if(e.push({label:"Ú©Ù„Ø§Ø³â€ŒÙ‡Ø§",handler:()=>{X(null),ie(null),de(null),T("class-management-page")}}),d){if(e.push({label:d.info.name,handler:()=>{ie(null),de(null),te(),T("session-page")}}),((t=document.querySelector(".page.active"))==null?void 0:t.id)==="settings-page")e.push({label:"ØªÙ†Ø¸ÛŒÙ…Ø§Øª"});else if(v){const o=fe(d).get(v.sessionNumber)||` (#${v.sessionNumber})`;e.push({label:`Ø¬Ù„Ø³Ù‡ ${o}`,handler:()=>{de(null),T("student-page")}});const i=(n=document.querySelector(".page.active"))==null?void 0:n.id;D?e.push({label:`Ù¾Ø±ÙˆÙØ§ÛŒÙ„: ${D.identity.name}`}):i==="attendance-page"&&e.push({label:"Ø­Ø¶ÙˆØ± Ùˆ ØºÛŒØ§Ø¨"})}}if(e.length<=1){Ve.style.display="none";return}Ve.style.display="flex",e.forEach((s,a)=>{const o=document.createElement("a");if(o.textContent=s.label,o.className="breadcrumb-item",a===e.length-1||!s.handler?o.classList.add("active"):o.addEventListener("click",s.handler),Ve.appendChild(o),a<e.length-1){const i=document.createElement("span");i.className="breadcrumb-separator",i.textContent="/",Ve.appendChild(i)}})}function Yn(e,t,n){n.innerHTML="";const s=d.sessions.filter(a=>{var o;return!a.isDeleted&&!a.isCancelled&&((o=a.studentRecords[e.identity.studentId])==null?void 0:o.attendance)==="absent"}).map(a=>({number:t.get(a.sessionNumber),isMakeup:a.isMakeup})).filter(a=>a.number!==void 0);s.length>0?(n.appendChild(document.createTextNode("Ø¬Ù„Ø³Ø§Øª ØºØ§ÛŒØ¨: ")),s.forEach((a,o)=>{const i=document.createElement("span");i.textContent=a.number,a.isMakeup&&i.classList.add("makeup-absence"),n.appendChild(i),o<s.length-1&&n.appendChild(document.createTextNode("ØŒ "))})):n.textContent="Ø¬Ù„Ø³Ø§Øª ØºØ§ÛŒØ¨: Ø¨Ø¯ÙˆÙ† ØºÛŒØ¨Øª"}function kt(e,t,n,s={}){const{includePrefix:a=!0}=s;n.innerHTML="";const o=d.sessions.filter(i=>{if(i.isDeleted||i.isCancelled)return!1;const r=i.studentRecords[e.identity.studentId];return r&&r.homework&&(r.homework.status==="incomplete"||r.homework.status==="none")}).map(i=>({number:t.get(i.sessionNumber),status:i.studentRecords[e.identity.studentId].homework.status})).filter(i=>i.number!==void 0);o.length>0?(a&&n.appendChild(document.createTextNode("ØªÚ©Ø§Ù„ÛŒÙ Ù†Ø§Ù‚Øµ: ")),o.forEach((i,r)=>{const c=document.createElement("span");c.textContent=i.number,i.status==="incomplete"&&c.classList.add("incomplete-homework"),n.appendChild(c),r<o.length-1&&n.appendChild(document.createTextNode("ØŒ"))})):a?n.textContent="ØªÚ©Ø§Ù„ÛŒÙ Ù†Ø§Ù‚Øµ: Ù†Ø¯Ø§Ø±Ø¯":n.textContent="Ù†Ø¯Ø§Ø±Ø¯"}function Ia(e,t){var _,G,j;const n=document.createElement("li");n.className="attendance-list-item";const s=document.createElement("input");s.type="checkbox",s.className="mass-comment-checkbox",s.checked=Re.includes(e.identity.studentId),s.addEventListener("change",()=>{const P=e.identity.studentId,$=Re;if(s.checked)$.includes(P)||$.push(P);else{const J=$.indexOf(P);J>-1&&$.splice(J,1)}Hn()}),n.appendChild(s);const a={none:"Ø¨Ø¯ÙˆÙ† ØªÚ©Ù„ÛŒÙ",complete:"ØªÚ©Ù„ÛŒÙ Ú©Ø§Ù…Ù„",incomplete:"ØªÚ©Ù„ÛŒÙ Ù†Ø§Ù‚Øµ"},o=document.createElement("div");o.className="student-info";const i=document.createElement("span");i.className="student-name",i.textContent=e.identity.name,i.addEventListener("click",()=>{ne(e)});const r=document.createElement("span");r.className="absence-info";const c=document.createElement("span");c.className="homework-info",Yn(e,t,r),kt(e,t,c),o.appendChild(i),o.appendChild(r),o.appendChild(c);const f=document.createElement("div");f.className="homework-controls";const p=document.createElement("button"),w=((_=v.studentRecords[e.identity.studentId])==null?void 0:_.homework.status)||"none";p.className=`homework-status-btn ${w}`,p.title=a[w],p.addEventListener("click",()=>{const P=v.studentRecords[e.identity.studentId].homework,J={none:"incomplete",incomplete:"complete",complete:"none"}[P.status];p.title=a[J],v.setHomeworkStatus(e.identity.studentId,J),k(),p.className=`homework-status-btn ${J}`,kt(e,t,c)});const u=document.createElement("button");u.className="btn-icon",u.innerHTML="ğŸ“",u.title="Ø§ÙØ²ÙˆØ¯Ù† ÛŒØ§Ø¯Ø¯Ø§Ø´Øª Ø¨Ø±Ø§ÛŒ ØªÚ©Ù„ÛŒÙ",((G=v.studentRecords[e.identity.studentId])==null?void 0:G.homework.comment)||(u.style.opacity="0.3"),u.addEventListener("click",()=>{const P=v.studentRecords[e.identity.studentId].homework;H.value=P.comment||"",H.dispatchEvent(new Event("input",{bubbles:!0})),ve($=>{P.comment=$;const J=fe(d),ce=J.get(v.sessionNumber),Ee={type:"fromAttendance",sessionNumber:v.sessionNumber},Q=`ÛŒØ§Ø¯Ø¯Ø§Ø´Øª Ù…Ø±Ø¨ÙˆØ· Ø¨Ù‡ Ø¬Ù„Ø³Ù‡ ${ce}: `,pe=e.profile.notes.find(K=>!K.isDeleted&&K.source&&K.source.type==="fromAttendance"&&K.source.sessionNumber===Ee.sessionNumber);pe?$?pe.content=Q+$:pe.isDeleted=!0:$&&e.addNote(Q+$,Ee),k(),A(d.info.name,`ÛŒØ§Ø¯Ø¯Ø§Ø´Øª ØªÚ©Ù„ÛŒÙ Ø¬Ù„Ø³Ù‡ ${ce} Ø¨Ø±Ø§ÛŒ Ø¯Ø§Ù†Ø´â€ŒØ¢Ù…ÙˆØ² Â«${e.identity.name}Â» Ø°Ø®ÛŒØ±Ù‡ Ø´Ø¯.`,{type:"VIEW_STUDENT_PROFILE",studentId:e.identity.studentId}),C("âœ…ÛŒØ§Ø¯Ø¯Ø§Ø´Øª ØªÚ©Ù„ÛŒÙ Ø°Ø®ÛŒØ±Ù‡ Ø´Ø¯."),u.style.opacity=$?"1":"0.3",kt(e,J,c)}),Z("add-note-modal"),H.focus()}),f.appendChild(p),f.appendChild(u);const b=document.createElement("button"),L=((j=v.studentRecords[e.identity.studentId])==null?void 0:j.attendance)||"present",N=P=>{P==="present"?(b.textContent="Ø­Ø§Ø¶Ø±",b.className="attendance-status-btn present active"):(b.textContent="ØºØ§ÛŒØ¨",b.className="attendance-status-btn absent active")};return N(L),b.addEventListener("click",()=>{var J;const $=(((J=v.studentRecords[e.identity.studentId])==null?void 0:J.attendance)||"present")==="present"?"absent":"present";v.setAttendance(e.identity.studentId,$),$==="absent"&&(v.studentRecords[e.identity.studentId].hadIssue=!1),k(),N($),Yn(e,t,r),js()}),n.appendChild(o),n.appendChild(f),n.appendChild(b),n}function Sa(){return fe(d).get(v.sessionNumber)}function We(){if(!d||!v)return;q(d.students).forEach(a=>{v.initializeStudentRecord(a.identity.studentId)}),qt([]);const e=fe(d);Oa(),st.innerHTML="";const t=document.createElement("li");t.className="attendance-list-header",Me.id="attendance-search-input",Me.type="text",Me.className="inline-search-input",Me.placeholder="Ø¬Ø³ØªØ¬Ùˆ...",Me.value="";const n=document.createElement("div");n.className="student-search-container",n.appendChild(Me);const s=document.createElement("div");s.className="header-labels-container",s.innerHTML=`
    <span class="header-label">ØªÚ©Ù„ÛŒÙ</span>
    <span class="header-label">Ø­Ø¶ÙˆØ±</span>
`,t.appendChild(n),t.appendChild(s),st.appendChild(t),q(d.students).forEach(a=>{const o=Ia(a,e);st.appendChild(o)}),qt([]),Hn(),Ha(),js()}function oe(){const e=document.getElementById("student-stats-table-container");if(!e||(e.innerHTML="",!d))return;q(d.students).length,cn.textContent="Ø¢Ù…Ø§Ø± Ø¹Ù…Ù„Ú©Ø±Ø¯";const t=["Ù†Ø§Ù…"],n=["Ú©Ù„ Ø§Ù†ØªØ®Ø§Ø¨ Ù‡Ø§","ØºÛŒØ¨Øª","Ø®Ø±ÙˆØ¬","ÙØ±ØµØª Ø§Ø²Ø¯Ø³Øªâ€ŒØ±ÙØªÙ‡","Ù…Ø´Ú©Ù„","Ù…ÛŒØ§Ù†Ú¯ÛŒÙ†","Ù†Ù…Ø±Ù‡ Ú©Ù„Ø§Ø³ÛŒ (Ú©Ø§Ù†ÙˆÙ†)"],s=d.categories.filter(y=>y.isGradedCategory&&!y.isDeleted).map(y=>y.name),a=[...t,...s,...n],o=document.createElement("table");o.className="student-stats-table";const r=o.createTHead().insertRow();a.forEach((y,b)=>{const L=document.createElement("th");b===0?(L.innerHTML=`${y} <span style="opacity: 0.6;">ğŸ”—</span>`,L.title="Ø±Ø¯ÛŒÙâ€ŒÙ‡Ø§ÛŒ Ø§ÛŒÙ† Ø³ØªÙˆÙ† Ù‚Ø§Ø¨Ù„ Ú©Ù„ÛŒÚ© Ù‡Ø³ØªÙ†Ø¯"):L.textContent=y,r.appendChild(L)});const c=o.createTBody(),f=q(d.students),p=y=>{let b=0;return d.sessions.forEach(L=>{if(L.isDeleted||L.isCancelled)return;const N=L.studentRecords[y.identity.studentId];N&&N.attendance==="absent"&&b++}),b};f.forEach(y=>{const b=c.insertRow();if(b.dataset.studentId=y.identity.studentId,v){const P=v.studentRecords[y.identity.studentId];P&&P.attendance==="absent"&&b.classList.add("absent-row-highlight")}const L=b.insertCell(),N=document.createElement("span");N.textContent=y.identity.name,N.className="student-name-link",N.addEventListener("click",()=>{ne(y)}),L.appendChild(N),s.forEach(P=>{var Ee;const $=b.insertCell(),J=P.toLowerCase(),ce=((Ee=y.logs.scores[J])==null?void 0:Ee.filter(Q=>!Q.isDeleted))||[];ce.length>0?ce.forEach((Q,pe)=>{const K=document.createElement("span");K.textContent=Q.value,K.style.position="relative",Q.comment&&(K.dataset.tooltip=Q.comment),$.appendChild(K),pe<ce.length-1&&$.appendChild(document.createTextNode(","))}):$.textContent="",$.style.cursor="pointer",$.addEventListener("click",()=>{me(y,P);const Q=document.getElementById("category-selection-container");Q&&Q.scrollIntoView({behavior:"smooth",block:"center"})})}),b.insertCell().textContent=y.statusCounters.totalSelections||0,b.insertCell().textContent=p(y),b.insertCell().textContent=y.statusCounters.outOfClassCount||0,b.insertCell().textContent=y.statusCounters.missedChances||0;const _=Object.values(y.categoryIssues||{}).reduce((P,$)=>P+$,0);b.insertCell().textContent=_;const G=y.getOverallAverageScore();b.insertCell().textContent=G!==null?G:"-";const j=d.calculateFinalStudentScore(y);b.insertCell().textContent=j!==null?j:"-"}),q(d.students),cn.setAttribute("data-student-count",f.length),e.appendChild(o);const w=e.querySelector(".student-stats-table"),u=w==null?void 0:w.querySelector("thead th:first-child");u&&u.addEventListener("click",()=>{w.classList.toggle("name-column-expanded")})}function me(e=null,t=null){const n=document.getElementById("selected-student-result");n.innerHTML="",n.classList.remove("absent");let s,a;if(e&&t)s=e,a=t,Pt({student:e,categoryName:t}),Oe(-1);else{if(Pt(null),!v||he<0||!v.winnerHistory[he])return;const R=v.winnerHistory[he];s=R.winner,a=R.categoryName}const o=document.querySelector(".current-winner-highlight");if(o&&o.classList.remove("current-winner-highlight"),s){const R=document.querySelector(`.student-stats-table tr[data-student-id="${s.identity.studentId}"]`);R&&R.classList.add("current-winner-highlight")}const i=d.categories.find(R=>R.name===a);if(i){_t(i);const R=document.querySelectorAll("#category-selection-container .pill");R.forEach(se=>se.classList.remove("active"));const V=Array.from(R).find(se=>se.textContent===a);V&&V.classList.add("active"),gn(i)}const r=v.studentRecords[s.identity.studentId],c=(r==null?void 0:r.attendance)==="absent",f=document.createElement("div");f.className="winner-name-container";const p=document.createElement("button");p.className="btn-icon",p.innerHTML="Ë…",p.title="Ø¨Ø±Ù†Ø¯Ù‡ Ù‚Ø¨Ù„ÛŒ";const w=!e;p.classList.toggle("is-disabled",!w||he<=0),p.addEventListener("click",()=>{p.classList.contains("is-disabled")?(p.classList.add("shake-animation"),setTimeout(()=>p.classList.remove("shake-animation"),200)):(Oe(he-1),me())});const u=document.createElement("div");u.className="winner-name",u.innerHTML=`âœ¨ <strong>${s.identity.name}</strong>âœ¨`,u.classList.add("heartbeat-animation"),c&&(u.style.textDecoration="line-through",u.style.opacity="0.6",u.style.color="var(--color-secondary)"),(r==null?void 0:r.hadIssue)&&!c&&(u.style.color="var(--color-warning)",u.title="Ø§ÛŒÙ† Ø¯Ø§Ù†Ø´â€ŒØ¢Ù…ÙˆØ² Ø¯Ø± Ø§Ù†ØªØ®Ø§Ø¨ Ù‚Ø¨Ù„ÛŒ Ø¨Ø§ Ù…Ø´Ú©Ù„ Ù…ÙˆØ§Ø¬Ù‡ Ø´Ø¯Ù‡ Ø¨ÙˆØ¯"),(r==null?void 0:r.wasOutOfClass)&&!c&&(u.style.color="var(--color-strong-warning)",u.title="Ø§ÛŒÙ† Ø¯Ø§Ù†Ø´â€ŒØ¢Ù…ÙˆØ² Ø¯Ø± Ø²Ù…Ø§Ù† Ø§Ù†ØªØ®Ø§Ø¨ Ø®Ø§Ø±Ø¬ Ø§Ø² Ú©Ù„Ø§Ø³ Ø¨ÙˆØ¯");const L=document.createElement("button");if(L.className="btn-icon",L.innerHTML="Ë„",L.title="Ø¨Ø±Ù†Ø¯Ù‡ Ø¨Ø¹Ø¯ÛŒ",L.classList.toggle("is-disabled",!w||he>=v.winnerHistory.length-1),L.addEventListener("click",()=>{L.classList.contains("is-disabled")?(L.classList.add("shake-animation"),setTimeout(()=>L.classList.remove("shake-animation"),200)):(Oe(he+1),me())}),f.appendChild(L),f.appendChild(u),s.onboardingSession===v.sessionNumber){const R=document.createElement("div");R.className="new-student-badge",R.textContent="Ø¯Ø§Ù†Ø´ Ø¢Ù…ÙˆØ² Ø¬Ø¯ÛŒØ¯",f.appendChild(R)}f.appendChild(p),n.appendChild(f),we.disabled=w&&!L.classList.contains("is-disabled");const N=document.createElement("div");N.className="status-button-container";const _=document.createElement("button");_.textContent="ØºØ§ÛŒØ¨",_.classList.add("status-button","absent-btn"),c&&_.classList.add("active");const G=document.createElement("button");G.textContent="Ù…Ø´Ú©Ù„",G.classList.add("status-button","issue-btn"),r!=null&&r.hadIssue&&G.classList.add("active");const j=document.createElement("button");j.textContent="Ø®Ø±ÙˆØ¬",j.classList.add("status-button","exit-btn"),r!=null&&r.wasOutOfClass&&j.classList.add("active");const P=document.createElement("button");P.textContent="Ù¾Ø±ÙˆÙØ§ÛŒÙ„",P.className="status-button profile-btn",_.addEventListener("click",()=>{const R=_.classList.contains("active");j.classList.contains("active")&&(j.classList.remove("active"),r.wasOutOfClass=!1,s.statusCounters.outOfClassCount=Math.max(0,(s.statusCounters.outOfClassCount||0)-1),s.statusCounters.missedChances=Math.max(0,s.statusCounters.missedChances-1)),R?(_.classList.remove("active"),v.setAttendance(s.identity.studentId,"present"),s.statusCounters.missedChances=Math.max(0,s.statusCounters.missedChances-1),u.style.textDecoration="",u.style.opacity="",u.style.color=""):(G.classList.contains("active")&&(G.classList.remove("active"),r.hadIssue=!1,s.statusCounters.otherIssues=Math.max(0,s.statusCounters.otherIssues-1),s.statusCounters.missedChances=Math.max(0,s.statusCounters.missedChances-1)),_.classList.add("active"),v.setAttendance(s.identity.studentId,"absent"),s.statusCounters.missedChances++,u.style.textDecoration="line-through",u.style.opacity="0.6",u.style.color="var(--color-secondary)",u.title=""),oe(),k()}),G.addEventListener("click",()=>{const R=G.classList.contains("active");if(j.classList.contains("active")&&(j.classList.remove("active"),r.wasOutOfClass=!1,s.statusCounters.outOfClassCount=Math.max(0,(s.statusCounters.outOfClassCount||0)-1),s.statusCounters.missedChances=Math.max(0,s.statusCounters.missedChances-1)),R){G.classList.remove("active"),r.hadIssue=!1;const V=le.name;s.categoryIssues[V]&&(s.categoryIssues[V]=Math.max(0,s.categoryIssues[V]-1)),s.statusCounters.missedChances=Math.max(0,s.statusCounters.missedChances-1),u.style.color="",u.title=""}else{_.classList.contains("active")&&(_.classList.remove("active"),v.setAttendance(s.identity.studentId,"present"),s.statusCounters.missedChances=Math.max(0,s.statusCounters.missedChances-1)),G.classList.add("active"),r.hadIssue=!0;const V=le.name;s.categoryIssues[V]=(s.categoryIssues[V]||0)+1,s.statusCounters.missedChances++,u.style.textDecoration="",u.style.opacity="",u.style.color="var(--color-warning)",u.title="Ø§ÛŒÙ† Ø¯Ø§Ù†Ø´â€ŒØ¢Ù…ÙˆØ² Ø¯Ø± Ø§Ù†ØªØ®Ø§Ø¨ Ù‚Ø¨Ù„ÛŒ Ø¨Ø§ Ù…Ø´Ú©Ù„ Ù…ÙˆØ§Ø¬Ù‡ Ø´Ø¯Ù‡ Ø¨ÙˆØ¯"}oe(),k()}),j.addEventListener("click",()=>{if(j.classList.contains("active"))j.classList.remove("active"),r.wasOutOfClass=!1,s.statusCounters.outOfClassCount=Math.max(0,(s.statusCounters.outOfClassCount||0)-1),s.statusCounters.missedChances=Math.max(0,s.statusCounters.missedChances-1),u.style.color="",u.title="";else{if(_.classList.contains("active")&&(_.classList.remove("active"),v.setAttendance(s.identity.studentId,"present"),s.statusCounters.missedChances=Math.max(0,s.statusCounters.missedChances-1)),G.classList.contains("active")){G.classList.remove("active"),r.hadIssue=!1;const V=le.name;s.categoryIssues[V]&&(s.categoryIssues[V]=Math.max(0,s.categoryIssues[V]-1)),s.statusCounters.missedChances=Math.max(0,s.statusCounters.missedChances-1)}j.classList.add("active"),r.wasOutOfClass=!0,s.statusCounters.outOfClassCount=(s.statusCounters.outOfClassCount||0)+1,s.statusCounters.missedChances++,u.style.textDecoration="",u.style.opacity="",u.style.color="var(--color-strong-warning)",u.title="Ø§ÛŒÙ† Ø¯Ø§Ù†Ø´â€ŒØ¢Ù…ÙˆØ² Ø¯Ø± Ø²Ù…Ø§Ù† Ø§Ù†ØªØ®Ø§Ø¨ Ø®Ø§Ø±Ø¬ Ø§Ø² Ú©Ù„Ø§Ø³ Ø¨ÙˆØ¯"}oe(),k()}),P.addEventListener("click",()=>{ne(s)}),N.appendChild(_),N.appendChild(j),N.appendChild(G),N.appendChild(P),n.appendChild(N);const $=document.createElement("div");$.className="student-details-container";const J=document.createElement("div");J.className="student-details-scores",J.innerHTML="<h4>Ø¢Ø®Ø±ÛŒÙ† Ù†Ù…Ø±Ø§Øª</h4>";const ce=document.createElement("ul");ce.className="scores-list";const Ee=["Reading","Writing","Speaking","Listening"];let Q=!1;const pe=s.logs.scores||{};Ee.forEach(R=>{var Be;const V=document.createElement("li"),se=document.createElement("span");se.className="skill-name",se.textContent=`${R}:`;const Fe=document.createElement("span");Fe.className="skill-scores";const jt=R.toLowerCase(),Qe=(Be=pe[jt])==null?void 0:Be.filter(Ye=>!Ye.isDeleted);Qe&&Qe.length>0?(Q=!0,Fe.textContent=Qe.slice(-3).map(Ye=>Ye.value).join(",")):Fe.textContent="none",V.appendChild(se),V.appendChild(Fe),ce.appendChild(V)}),!Q&&Object.keys(pe).length===0&&(ce.innerHTML='<div class="no-content-message">Ù‡Ù†ÙˆØ² Ù†Ù…Ø±Ù‡â€ŒØ§ÛŒ Ø«Ø¨Øª Ù†Ø´Ø¯Ù‡ Ø§Ø³Øª.</div>'),J.appendChild(ce),$.appendChild(J);const K=document.createElement("div");K.className="student-details-notes";const _e=document.createElement("div");_e.className="history-section-header";const ht=document.createElement("h4");ht.textContent="ÛŒØ§Ø¯Ø¯Ø§Ø´Øªâ€ŒÙ‡Ø§";const Ne=document.createElement("button");Ne.className="btn-icon",Ne.innerHTML="ğŸ“",Ne.title="Ø§ÙØ²ÙˆØ¯Ù† ÛŒØ§Ø¯Ø¯Ø§Ø´Øª Ø¬Ø¯ÛŒØ¯",Ne.addEventListener("click",()=>{H.value="",H.dispatchEvent(new Event("input",{bubbles:!0})),ve(R=>{R&&(s.addNote(R),k(),me(),C("âœ… ÛŒØ§Ø¯Ø¯Ø§Ø´Øª Ø¨Ø§ Ù…ÙˆÙÙ‚ÛŒØª Ø«Ø¨Øª Ø´Ø¯."))}),Z("add-note-modal"),H.focus()}),_e.appendChild(ht),_e.appendChild(Ne),K.appendChild(_e);const Pe=document.createElement("ul");Pe.className="notes-list",s.profile.notes&&s.profile.notes.length>0?[...s.profile.notes].sort((V,se)=>new Date(se.timestamp)-new Date(V.timestamp)).forEach(V=>{const se=document.createElement("li");se.dir=Nn(V.content),se.textContent=V.content,Pe.appendChild(se)}):Pe.innerHTML='<div class="no-content-message">ÛŒØ§Ø¯Ø¯Ø§Ø´ØªÛŒ ÙˆØ¬ÙˆØ¯ Ù†Ø¯Ø§Ø±Ø¯.</div>',K.appendChild(Pe),$.appendChild(K),n.appendChild($)}function Fs(e){e.addEventListener("input",()=>{const t=e.value,n=Nn(t);e.setAttribute("dir",n)})}function La(){at.innerHTML="",dn.innerHTML="",ot.classList.add("tooltip-container"),Le.disabled=!0,ye.disabled=!0,Je.disabled=!0,Le.value="",ye.value="",ze.classList.add("disabled-wrapper"),we.disabled=!0}function Nt(){at.innerHTML="",d.categories.filter(n=>!n.isDeleted).forEach(n=>{const s=document.createElement("span");s.className="pill",s.textContent=n.name,s.dataset.categoryId=n.id,n.description&&(s.dataset.tooltip=n.description),s.addEventListener("click",()=>{document.querySelectorAll("#category-selection-container .pill").forEach(o=>o.classList.remove("active")),s.classList.add("active"),_t(n),gn(n),ze.classList.remove("disabled-wrapper"),we.disabled=!1;const a=v.lastWinnerByCategory[n.name];if(a){const o=d.students.find(i=>i.identity.studentId===a);o&&me(o,n.name)}else{dn.innerHTML="",Pt(null),Oe(-1),we.disabled=!1;const o=document.querySelector(".current-winner-highlight");o&&o.classList.remove("current-winner-highlight")}}),s.addEventListener("contextmenu",a=>{gt(a,[{label:"ØªØºÛŒÛŒØ± Ù†Ø§Ù…",icon:"âœï¸",action:()=>{mn((i,r)=>{const c=os(d,n,i);c.success?(n.isGradedCategory=r,k(),A(d.info.name,`Ù†Ø§Ù… Ø¯Ø³ØªÙ‡â€ŒØ¨Ù†Ø¯ÛŒ Â«${n.name}Â» Ø¨Ù‡ Â«${i}Â» ØªØºÛŒÛŒØ± ÛŒØ§ÙØª.`),Nt(),oe(),C(`âœ… Ù†Ø§Ù… Ø¯Ø³ØªÙ‡â€ŒØ¨Ù†Ø¯ÛŒ Ø¨Ù‡ Â«${i}Â» ØªØºÛŒÛŒØ± ÛŒØ§ÙØª.`)):C(`âš ï¸ ${c.message}`)},{title:"ÙˆÛŒØ±Ø§ÛŒØ´ Ø¯Ø³ØªÙ‡â€ŒØ¨Ù†Ø¯ÛŒ",initialName:n.name,initialIsGraded:n.isGradedCategory,saveButtonText:"Ø°Ø®ÛŒØ±Ù‡ ØªØºÛŒÛŒØ±Ø§Øª"})}},{label:"Ø­Ø°Ù Ø¯Ø³ØªÙ‡â€ŒØ¨Ù†Ø¯ÛŒ",icon:"ğŸ—‘ï¸",className:"danger",action:()=>{z(`Ø¢ÛŒØ§ Ø§Ø² Ø§Ù†ØªÙ‚Ø§Ù„ Ø¯Ø³ØªÙ‡â€ŒØ¨Ù†Ø¯ÛŒ Â«${n.name}Â» Ø¨Ù‡ Ø³Ø·Ù„ Ø²Ø¨Ø§Ù„Ù‡ Ù…Ø·Ù…Ø¦Ù† Ù‡Ø³ØªÛŒØ¯ØŸ`,()=>{const i={id:`trash_${Date.now()}_${Math.random()}`,timestamp:new Date().toISOString(),type:"category",description:`Ø¯Ø³ØªÙ‡â€ŒØ¨Ù†Ø¯ÛŒ Â«${n.name}Â» Ø§Ø² Ú©Ù„Ø§Ø³ Â«${d.info.name}Â»`,restoreData:{categoryId:n.id,classId:d.info.scheduleCode}};M.unshift(i),M.length>50&&M.pop();const r=n.name.toLowerCase();if(d.students.forEach(c=>{c.logs.scores&&c.logs.scores[r]&&c.logs.scores[r].forEach(f=>{f.isDeleted=!0})}),le&&le.id===n.id){_t(null),dn.innerHTML="",gn(null),ze.classList.add("disabled-wrapper"),we.disabled=!0;const c=document.querySelector(".current-winner-highlight");c&&c.classList.remove("current-winner-highlight")}n.isDeleted=!0,A(d.info.name,`Ø¯Ø³ØªÙ‡â€ŒØ¨Ù†Ø¯ÛŒ Â«${n.name}Â» Ø¨Ù‡ Ø³Ø·Ù„ Ø²Ø¨Ø§Ù„Ù‡ Ù…Ù†ØªÙ‚Ù„ Ø´Ø¯.`,{type:"VIEW_TRASH"}),k(),Nt(),oe(),C(`âœ… Ø¯Ø³ØªÙ‡â€ŒØ¨Ù†Ø¯ÛŒ Â«${n.name}Â» Ø¨Ù‡ Ø³Ø·Ù„ Ø²Ø¨Ø§Ù„Ù‡ Ù…Ù†ØªÙ‚Ù„ Ø´Ø¯.`)},{confirmText:"Ø¨Ù„Ù‡",confirmClass:"btn-warning"})}}])}),at.appendChild(s)});const t=document.createElement("span");t.className="pill add-category-pill",t.textContent="+",t.title="Ø§ÙØ²ÙˆØ¯Ù† Ø¯Ø³ØªÙ‡â€ŒØ¨Ù†Ø¯ÛŒ Ø¬Ø¯ÛŒØ¯",t.addEventListener("click",()=>{mn((n,s)=>{if(d.categories.find(i=>i.name.toLowerCase()===n.toLowerCase()&&!i.isDeleted)){C("âš ï¸ Ø§ÛŒÙ† Ø¯Ø³ØªÙ‡â€ŒØ¨Ù†Ø¯ÛŒ Ø§Ø² Ù‚Ø¨Ù„ ÙˆØ¬ÙˆØ¯ Ø¯Ø§Ø±Ø¯.");return}const o=new Se(n,"",s);d.categories.push(o),k(),A(d.info.name,`Ø¯Ø³ØªÙ‡â€ŒØ¨Ù†Ø¯ÛŒ Ø¬Ø¯ÛŒØ¯ Â«${n}Â» Ø§Ø¶Ø§ÙÙ‡ Ø´Ø¯.`,{type:"VIEW_CLASS_SETTINGS"}),Nt(),C(`âœ… Ø¯Ø³ØªÙ‡â€ŒØ¨Ù†Ø¯ÛŒ Â«${n}Â» Ø§Ø¶Ø§ÙÙ‡ Ø´Ø¯.`)})}),at.appendChild(t)}function wa(){if(v.lastUsedCategoryId){if(v.isFinished)return;const e=at.querySelector(`.pill[data-category-id="${v.lastUsedCategoryId}"]`);e&&e.click()}v.winnerHistory&&v.winnerHistory.length>0&&(Oe(v.winnerHistory.length-1),me())}function gn(e){e&&e.isGradedCategory?(Le.disabled=!1,ye.disabled=!1,Je.disabled=!1,ot.removeAttribute("title")):(Le.disabled=!0,ye.disabled=!0,Je.disabled=!0,e?ot.setAttribute("title","Ø¨Ø±Ø§ÛŒ Ø§ÛŒÙ† Ø¯Ø³ØªÙ‡â€ŒØ¨Ù†Ø¯ÛŒ Ù‚Ø§Ø¨Ù„ÛŒØª Ù†Ù…Ø±Ù‡ Ø¯Ù‡ÛŒ ØªØ¹Ø±ÛŒÙ Ù†Ø´Ø¯Ù‡ Ø§Ø³Øª"):ot.setAttribute("title","Ø§Ø¨ØªØ¯Ø§ ÛŒÚ© Ø¯Ø³ØªÙ‡â€ŒØ¨Ù†Ø¯ÛŒ Ø±Ø§ Ø§Ù†ØªØ®Ø§Ø¨ Ú©Ù†ÛŒØ¯"))}function ne(e){de(e);const t=document.getElementById("student-profile-modal"),n=document.getElementById("modal-profile-student-name"),s=document.getElementById("modal-profile-content-container"),a=document.getElementById("modal-profile-close-btn");!t||!n||!s||!a||(n.textContent=`Ù¾Ø±ÙˆÙØ§ÛŒÙ„: ${e.identity.name}`,n.style.cursor="pointer",n.onclick=()=>{const o=D,i=d;F(()=>{On(o,i)})},s.innerHTML="",ka(s),Wn(s),a.onclick=()=>F(),Z("student-profile-modal"))}function ka(e){if(!D||!d)return;const t=document.createElement("div");t.className="scoring-section",t.innerHTML=`
        <h3>Ø«Ø¨Øª Ù†Ù…Ø±Ù‡ Ø¬Ø¯ÛŒØ¯</h3>
        <div id="modal-graded-pills" class="category-pills"></div>
        <div class="input-group centered-input-group" style="margin-top: 15px;">
            <input type="number" id="modal-new-score-value" placeholder="Ù†Ù…Ø±Ù‡ (Ù…Ø«Ù„Ø§: 85)">
        </div>
        <textarea id="modal-new-score-comment" placeholder="ØªÙˆØ¶ÛŒØ­Ø§Øª Ø§ÛŒÙ† Ù†Ù…Ø±Ù‡ (Ø§Ø®ØªÛŒØ§Ø±ÛŒ)..." style="margin-top: 10px;"></textarea>
        <button id="modal-add-score-btn" class="btn-success" style="width: 100%; margin-top: 10px;">Ø«Ø¨Øª Ù†Ù…Ø±Ù‡</button>
    `;const n=t.querySelector("#modal-graded-pills");q(d.categories).filter(o=>o.isGradedCategory).forEach(o=>{const i=document.createElement("span");i.className="pill",i.textContent=o.name,i.dataset.skillName=o.name,i.addEventListener("click",()=>{n.querySelectorAll(".pill").forEach(r=>r.classList.remove("active")),i.classList.add("active")}),n.appendChild(i)}),t.querySelector("#modal-add-score-btn").addEventListener("click",()=>{const o=n.querySelector(".pill.active");if(!o){C("âš ï¸Ù„Ø·ÙØ§Ù‹ ÛŒÚ© Ù…Ù‡Ø§Ø±Øª Ø±Ø§ Ø¨Ø±Ø§ÛŒ Ù†Ù…Ø±Ù‡â€ŒØ¯Ù‡ÛŒ Ø§Ù†ØªØ®Ø§Ø¨ Ú©Ù†ÛŒØ¯.");return}const i=o.dataset.skillName,r=t.querySelector("#modal-new-score-value"),c=t.querySelector("#modal-new-score-comment"),f=r.value,p=c.value.trim();if(!f){C("Ù„Ø·ÙØ§Ù‹ Ù…Ù‚Ø¯Ø§Ø± Ù†Ù…Ø±Ù‡ Ø±Ø§ ÙˆØ§Ø±Ø¯ Ú©Ù†ÛŒØ¯.");return}D.addScore(i,parseFloat(f),p),k(),A(d.info.name,`Ù†Ù…Ø±Ù‡ ${f} Ø¯Ø± ${i} Ø¨Ø±Ø§ÛŒ Â«${D.identity.name}Â» Ø«Ø¨Øª Ø´Ø¯.`,{type:"VIEW_STUDENT_PROFILE",studentId:D.identity.studentId}),oe(),me(),r.value="",c.value="";const w=document.getElementById("modal-profile-content-container"),u=w.querySelector(".history-section");u&&u.remove(),Wn(w),C(`âœ… Ù†Ù…Ø±Ù‡ Ø¨Ø±Ø§ÛŒ Ù…Ù‡Ø§Ø±Øª ${i} Ø¨Ø§ Ù…ÙˆÙÙ‚ÛŒØª Ø«Ø¨Øª Ø´Ø¯.`)}),e.appendChild(t)}function Wn(e){if(!D)return;const t=document.createElement("div");t.className="history-section";const n=document.createElement("div");n.className="history-section-header";const s=document.createElement("h3");s.textContent="Ø³ÙˆØ§Ø¨Ù‚ Ø¯Ø§Ù†Ø´â€ŒØ¢Ù…ÙˆØ²";const a=document.createElement("button");a.className="btn-icon",a.title="Ø§ÙØ²ÙˆØ¯Ù† ÛŒØ§Ø¯Ø¯Ø§Ø´Øª Ø¬Ø¯ÛŒØ¯",a.innerHTML="ğŸ“",a.addEventListener("click",()=>{H.value="",H.dispatchEvent(new Event("input",{bubbles:!0})),ve(o=>{if(o){D.addNote(o),k(),A(d.info.name,`ÛŒØ§Ø¯Ø¯Ø§Ø´Øª Ø¬Ø¯ÛŒØ¯ÛŒ Ø¨Ø±Ø§ÛŒ Ø¯Ø§Ù†Ø´â€ŒØ¢Ù…ÙˆØ² Â«${D.identity.name}Â» Ø«Ø¨Øª Ø´Ø¯.`,{type:"VIEW_STUDENT_PROFILE",studentId:D.identity.studentId}),me();const i=document.getElementById("modal-profile-content-container");if(i){const r=i.querySelector(".history-section");r&&r.remove(),Wn(i)}C("âœ… ÛŒØ§Ø¯Ø¯Ø§Ø´Øª Ø¨Ø§ Ù…ÙˆÙÙ‚ÛŒØª Ø«Ø¨Øª Ø´Ø¯.")}}),F(()=>{Z("add-note-modal"),H.focus()})}),n.appendChild(s),n.appendChild(a),t.appendChild(n),Na(t),qs(t),Us(t),e.appendChild(t)}function Na(e){if(!D)return;const t=D,n=d.sessions.reduce((u,y)=>{const b=y.studentRecords[t.identity.studentId];return u+(b&&b.attendance==="absent"?1:0)},0),s=Object.values(t.categoryIssues||{}).reduce((u,y)=>u+y,0),a=document.createElement("div");a.className="stats-summary-box",a.innerHTML=`
        <p><strong>Ú©Ù„ Ø§Ù†ØªØ®Ø§Ø¨:</strong> ${t.statusCounters.totalSelections}</p>
        <p><strong>ØºÛŒØ¨Øª:</strong> ${n}</p>
        <p><strong>ÙØ±ØµØª Ø§Ø² Ø¯Ø³Øª Ø±ÙØªÙ‡:</strong> ${t.statusCounters.missedChances||0}</p>
        <p><strong>Ù…Ø´Ú©Ù„:</strong> ${s}</p>
    `,e.appendChild(a);const o=q(d.categories),i=document.createElement("div");if(i.className="stats-breakdown",o.length>0){o.forEach(y=>{var _;const b=y.name,L=((_=t.categoryCounts)==null?void 0:_[b])||0,N=document.createElement("p");N.className="stats-breakdown-item",N.innerHTML=`<strong>${b}:</strong> ${L}`,i.appendChild(N)});const u=a.querySelector("p:first-child");u&&u.after(i)}const r=document.createElement("div");r.className="stats-breakdown",o.length>0&&(o.forEach(u=>{var N;const y=u.name,b=((N=t.categoryIssues)==null?void 0:N[y])||0,L=document.createElement("p");L.className="stats-breakdown-item",L.innerHTML=`<strong>${y}:</strong> ${b}`,r.appendChild(L)}),a.appendChild(r));const c=document.createElement("p"),f=document.createElement("strong");f.textContent="ØªÚ©Ø§Ù„ÛŒÙ Ù†Ø§Ù‚Øµ:";const p=document.createElement("span");p.style.marginRight="5px";const w=fe(d);kt(t,w,p,{includePrefix:!1}),c.appendChild(f),c.appendChild(p),a.appendChild(c)}function qs(e){if(!D)return;const t=D,n=document.createElement("h4");n.textContent="ØªØ§Ø±ÛŒØ®Ú†Ù‡ Ù†Ù…Ø±Ø§Øª:",n.style.marginTop="20px";const s=document.createElement("ul");s.className="list-container";const a=Object.values(t.logs.scores||{}).flat().filter(o=>!o.isDeleted).sort((o,i)=>new Date(i.timestamp)-new Date(o.timestamp));a.length===0?s.innerHTML='<div class="no-content-message">Ù‡Ù†ÙˆØ² Ù†Ù…Ø±Ù‡â€ŒØ§ÛŒ Ø«Ø¨Øª Ù†Ø´Ø¯Ù‡ Ø§Ø³Øª.</div>':a.forEach(o=>{const i=document.createElement("li");i.className="score-history-item";const r=document.createElement("div");r.className="item-content";const c=document.createElement("div");c.className="score-info";const f=document.createElement("span");f.className="score-skill-badge",f.textContent=o.skill;const p=document.createElement("span");p.className="score-value",p.textContent=`Ù†Ù…Ø±Ù‡: ${o.value}`;const w=document.createElement("span");if(w.className="score-date",w.textContent=new Date(o.timestamp).toLocaleDateString("fa-IR"),c.appendChild(f),c.appendChild(p),c.appendChild(w),r.appendChild(c),o.comment){const y=document.createElement("p");y.className="score-comment",y.innerHTML=vs(o.comment),r.appendChild(y)}const u=document.createElement("button");u.className="btn-icon delete-item-btn",u.innerHTML="ğŸ—‘ï¸",u.title="Ø­Ø°Ù Ø§ÛŒÙ† Ù†Ù…Ø±Ù‡",u.addEventListener("click",()=>{F(()=>{z(`Ø¢ÛŒØ§ Ø§Ø² Ø§Ù†ØªÙ‚Ø§Ù„ Ù†Ù…Ø±Ù‡ ${o.value} Ø¯Ø± Ù…Ù‡Ø§Ø±Øª Â«${o.skill}Â» Ø¨Ù‡ Ø³Ø·Ù„ Ø²Ø¨Ø§Ù„Ù‡ Ù…Ø·Ù…Ø¦Ù† Ù‡Ø³ØªÛŒØ¯ØŸ`,()=>{const y={id:`trash_${Date.now()}_${Math.random()}`,timestamp:new Date().toISOString(),type:"score",description:`Ù†Ù…Ø±Ù‡ ${o.value} (${o.skill}) Ø¨Ø±Ø§ÛŒ Â«${t.identity.name}Â»`,restoreData:{scoreId:o.id,skill:o.skill,studentId:t.identity.studentId,classId:d.info.scheduleCode}};M.unshift(y),M.length>50&&M.pop(),o.isDeleted=!0,k(),A(d.info.name,`Ù†Ù…Ø±Ù‡ ${o.value} (${o.skill}) Ø¯Ø§Ù†Ø´â€ŒØ¢Ù…ÙˆØ² Â«${t.identity.name}Â» Ø¨Ù‡ Ø³Ø·Ù„ Ø²Ø¨Ø§Ù„Ù‡ Ù…Ù†ØªÙ‚Ù„ Ø´Ø¯.`,{type:"VIEW_TRASH"}),ne(t),C("âœ… Ù†Ù…Ø±Ù‡ Ø¨Ù‡ Ø³Ø·Ù„ Ø²Ø¨Ø§Ù„Ù‡ Ù…Ù†ØªÙ‚Ù„ Ø´Ø¯.")},{confirmText:"ØªØ§ÛŒÛŒØ¯ Ø§Ù†ØªÙ‚Ø§Ù„",confirmClass:"btn-warning",onCancel:()=>{ne(t)}})})}),i.appendChild(r),i.appendChild(u),s.appendChild(i)}),e.appendChild(n),e.appendChild(s)}function Us(e){if(!D)return;const t=document.createElement("h4");t.textContent="ØªØ§Ø±ÛŒØ®Ú†Ù‡ ÛŒØ§Ø¯Ø¯Ø§Ø´Øªâ€ŒÙ‡Ø§:",t.style.marginTop="20px";const n=document.createElement("ul");n.className="list-container",!D.profile.notes||D.profile.notes.length===0?n.innerHTML='<div class="no-content-message">Ù‡Ù†ÙˆØ² ÛŒØ§Ø¯Ø¯Ø§Ø´ØªÛŒ Ø«Ø¨Øª Ù†Ø´Ø¯Ù‡ Ø§Ø³Øª.</div>':[...D.profile.notes].filter(a=>!a.isDeleted).sort((a,o)=>new Date(o.timestamp)-new Date(a.timestamp)).forEach(a=>{const o=document.createElement("li");o.className="note-history-item";const i=document.createElement("div");i.className="item-content";const r=document.createElement("div");r.className="note-info";const c=document.createElement("span");c.className="note-date",c.textContent=new Date(a.timestamp).toLocaleDateString("fa-IR");const f=document.createElement("button");f.className="btn-icon delete-item-btn",f.innerHTML="ğŸ—‘ï¸",f.title="Ø­Ø°Ù Ø§ÛŒÙ† ÛŒØ§Ø¯Ø¯Ø§Ø´Øª",f.addEventListener("click",()=>{F(()=>{z("Ø¢ÛŒØ§ Ø§Ø² Ø§Ù†ØªÙ‚Ø§Ù„ Ø§ÛŒÙ† ÛŒØ§Ø¯Ø¯Ø§Ø´Øª Ø¨Ù‡ Ø³Ø·Ù„ Ø²Ø¨Ø§Ù„Ù‡ Ù…Ø·Ù…Ø¦Ù† Ù‡Ø³ØªÛŒØ¯ØŸ",()=>{const w={id:`trash_${Date.now()}_${Math.random()}`,timestamp:new Date().toISOString(),type:"note",description:`ÛŒØ§Ø¯Ø¯Ø§Ø´Øª Ø¨Ø±Ø§ÛŒ Ø¯Ø§Ù†Ø´â€ŒØ¢Ù…ÙˆØ² Â«${D.identity.name}Â»`,restoreData:{noteId:a.id,studentId:D.identity.studentId,classId:d.info.scheduleCode}};M.unshift(w),M.length>50&&M.pop(),a.isDeleted=!0,A(d.info.name,`ÛŒØ§Ø¯Ø¯Ø§Ø´Øª Ø¯Ø§Ù†Ø´â€ŒØ¢Ù…ÙˆØ² Â«${D.identity.name}Â» Ø¨Ù‡ Ø³Ø·Ù„ Ø²Ø¨Ø§Ù„Ù‡ Ù…Ù†ØªÙ‚Ù„ Ø´Ø¯.`,{type:"VIEW_TRASH"}),k(),ne(D),C("âœ… ÛŒØ§Ø¯Ø¯Ø§Ø´Øª Ø¨Ù‡ Ø³Ø·Ù„ Ø²Ø¨Ø§Ù„Ù‡ Ù…Ù†ØªÙ‚Ù„ Ø´Ø¯.")},{confirmText:"ØªØ§ÛŒÛŒØ¯ Ø§Ù†ØªÙ‚Ø§Ù„",confirmClass:"btn-warning",onCancel:()=>{ne(D)}})})}),r.appendChild(c),r.appendChild(f);const p=document.createElement("p");p.className="note-content",p.innerHTML=vs(a.content),p.addEventListener("click",()=>{H.value=a.content,H.dispatchEvent(new Event("input",{bubbles:!0})),ve(w=>{a.content=w,k(),A(d.info.name,`ÛŒØ§Ø¯Ø¯Ø§Ø´Øª Ø¯Ø§Ù†Ø´â€ŒØ¢Ù…ÙˆØ² Â«${D.identity.name}Â» Ø¨Ù‡â€ŒØ±ÙˆØ²Ø±Ø³Ø§Ù†ÛŒ Ø´Ø¯.`,{type:"VIEW_STUDENT_PROFILE",studentId:D.identity.studentId}),ne(D),C("âœ…ÛŒØ§Ø¯Ø¯Ø§Ø´Øª Ø¨Ø§ Ù…ÙˆÙÙ‚ÛŒØª ÙˆÛŒØ±Ø§ÛŒØ´ Ø´Ø¯.")}),Z("add-note-modal"),H.focus()}),i.appendChild(r),i.appendChild(p),o.appendChild(i),n.appendChild(o)}),e.appendChild(t),e.appendChild(n)}function Vs(e){on.innerHTML="",e.forEach((t,n)=>{const s=document.createElement("option");s.value=n,s.textContent=t.trim(),on.appendChild(s)})}function hn(){sn.innerHTML="",Cn.forEach(e=>{const t=document.createElement("li");t.className="preview-item";const n=document.createElement("input");n.type="checkbox",n.checked=!0,n.dataset.name=e;const s=document.createElement("label");s.textContent=e,t.appendChild(n),t.appendChild(s),sn.appendChild(t)})}function Ba(e){const t=document.createElement("div");t.className="list-item-buttons";const n=document.createElement("button");return n.className="btn-icon",n.innerHTML="ğŸ“",n.title="Ø§ÙØ²ÙˆØ¯Ù†/ÙˆÛŒØ±Ø§ÛŒØ´ ÛŒØ§Ø¯Ø¯Ø§Ø´Øª Ú©Ù„Ø§Ø³",n.style.borderBottom="solid",e.note||(n.style.opacity="0.5",n.style.borderBottom="none"),n.addEventListener("click",s=>{s.stopPropagation(),Rn(e)}),t.appendChild(n),t}function xa(e){const t=document.createElement("div");t.style.flexGrow="1",t.style.display="flex",t.style.flexDirection="column",t.style.alignItems="flex-start";const n=document.createElement("span");n.textContent=e.info.name,n.classList.add("class-name-display"),t.appendChild(n);const s=q(e.students).length,a=q(e.sessions).filter(c=>c.isFinished).length,o=document.createElement("div");o.classList.add("class-stats-row");const i=document.createElement("span");i.textContent=`${s} Ù†ÙØ±`,i.classList.add("student-count-badge"),o.appendChild(i);const r=document.createElement("span");return r.textContent=`${a} Ø¬Ù„Ø³Ù‡`,r.classList.add("session-count-badge"),o.appendChild(r),t.appendChild(o),t.addEventListener("click",()=>{X(e),ie(null),ut(d.liveSession),te(),T("session-page")}),t}function Ta(e){const t=document.createElement("li"),n=document.createElement("input");n.type="checkbox",n.className="mass-selection-checkbox",n.checked=ge.includes(e.info.name),n.addEventListener("click",r=>{r.stopPropagation()}),n.addEventListener("change",()=>{const r=e.info.name;if(n.checked)ge.includes(r)||ge.push(r);else{const c=ge.indexOf(r);c>-1&&ge.splice(c,1)}}),t.appendChild(n);const s=xa(e);t.appendChild(s);const a=document.createElement("div");if(a.className="list-item-badges",e.liveSession&&!e.liveSession.isCancelled&&!e.liveSession.isDeleted){const r=document.createElement("span");r.className="warning-badge",r.textContent="Ø¬Ù„Ø³Ù‡ Ø¨Ø§Ø²",a.appendChild(r),t.classList.add("has-unfinished-session")}const o=document.createElement("span");o.className=`type-badge ${e.info.type}`,o.textContent=e.info.type==="online"?"Ø¢Ù†Ù„Ø§ÛŒÙ†":"Ø­Ø¶ÙˆØ±ÛŒ",o.title="Ù†ÙˆØ¹ Ú©Ù„Ø§Ø³",a.appendChild(o),t.appendChild(a);const i=Ba(e);return t.appendChild(i),t.addEventListener("contextmenu",r=>{const c={label:"Ù¾Ø´ØªÛŒØ¨Ø§Ù†â€ŒÚ¯ÛŒØ±ÛŒ Ø§Ø² Ø§ÛŒÙ† Ú©Ù„Ø§Ø³",icon:"ğŸ“¤",action:()=>{ft([e.info.name])}},f=ge.length;f>1&&ge.includes(e.info.name)&&(c.label=`Ù¾Ø´ØªÛŒØ¨Ø§Ù†â€ŒÚ¯ÛŒØ±ÛŒ Ø§Ø² ${f} Ú©Ù„Ø§Ø³`,c.action=()=>{ft(ge),en([]),ae()});const p=[{label:Ge.classList.contains("selection-mode-active")?"Ù„ØºÙˆ Ø§Ù†ØªØ®Ø§Ø¨":"Ø§Ù†ØªØ®Ø§Ø¨ Ú†Ù†Ø¯ Ú©Ù„Ø§Ø³",icon:"âœ”ï¸",action:()=>{const w=Ge.classList.contains("selection-mode-active");Ge.classList.toggle("selection-mode-active"),w&&(en([]),ae())}},c,{label:"ØªÙ†Ø¸ÛŒÙ…Ø§Øª Ú©Ù„Ø§Ø³",icon:"âš™ï¸",action:()=>{An(e)}},{label:"Ú¯Ø²Ø§Ø±Ø´ ÙØ¹Ø§Ù„ÛŒØªâ€ŒÙ‡Ø§",icon:"ğŸ“‹",action:()=>{_s(e.info.name)}},{label:"ØªØºÛŒÛŒØ± Ù†Ø§Ù…",icon:"âœï¸",action:()=>{const w=e.info.name,u=document.getElementById("add-note-modal-title");u.textContent="ØªØºÛŒÛŒØ± Ù†Ø§Ù… Ú©Ù„Ø§Ø³",H.value=w,H.rows=1,ve(y=>{const b=y.trim();if(b&&b!==w){const L=ss(w,b);L.success?(Eo(w,b),A(b,`Ù†Ø§Ù… Ú©Ù„Ø§Ø³ Ø§Ø² Â«${w}Â» Ø¨Ù‡ Â«${b}Â» ØªØºÛŒÛŒØ± ÛŒØ§ÙØª.`,{type:"VIEW_SESSIONS"}),k(),ae(),C(`âœ…Ù†Ø§Ù… Ú©Ù„Ø§Ø³ Ø¨Ù‡ Â«${b}Â» ØªØºÛŒÛŒØ± ÛŒØ§ÙØª.`)):C(L.message)}u.textContent="Ø«Ø¨Øª ÛŒØ§Ø¯Ø¯Ø§Ø´Øª Ø¬Ø¯ÛŒØ¯",H.rows=4}),Z("add-note-modal"),H.focus(),H.select()}},{label:"Ø­Ø°Ù Ú©Ù„Ø§Ø³",icon:"ğŸ—‘ï¸",className:"danger",action:()=>{z(`Ø¢ÛŒØ§ Ø§Ø² Ø§Ù†ØªÙ‚Ø§Ù„ Ú©Ù„Ø§Ø³ Â«${e.info.name}Â» Ø¨Ù‡ Ø³Ø·Ù„ Ø²Ø¨Ø§Ù„Ù‡ Ù…Ø·Ù…Ø¦Ù† Ù‡Ø³ØªÛŒØ¯ØŸ`,()=>{const w={id:`trash_${Date.now()}_${Math.random()}`,timestamp:new Date().toISOString(),type:"classroom",description:`Ú©Ù„Ø§Ø³ Â«${e.info.name}Â»`,restoreData:{name:e.info.name}};M.unshift(w),M.length>50&&M.pop(),e.isDeleted=!0,k(),ae(),C(`âœ… Ú©Ù„Ø§Ø³ Â«${e.info.name}Â» Ø¨Ù‡ Ø³Ø·Ù„ Ø²Ø¨Ø§Ù„Ù‡ Ù…Ù†ØªÙ‚Ù„ Ø´Ø¯.`)},{confirmText:"Ø¨Ù„Ù‡",confirmClass:"btn-warning",isDelete:!0})}}];gt(r,p)}),t}function Gs(){const e=document.getElementById("class-management-stats");if(!e)return;const t=Object.values(S).filter(a=>!a.isDeleted),n=t.length,s=t.reduce((a,o)=>a+q(o.students).length,0);e.innerHTML=`
        <span>Ú©Ù„ Ú©Ù„Ø§Ø³â€ŒÙ‡Ø§: <strong>${n}</strong></span>
        <span>|</span>
        <span>Ú©Ù„ Ø¯Ø§Ù†Ø´â€ŒØ¢Ù…ÙˆØ²Ø§Ù†: <strong>${s}</strong></span>
    `}function ae(){Gs(),Ge.innerHTML="",Object.values(S).sort((t,n)=>new Date(t.info.creationDate)-new Date(n.info.creationDate)).forEach(t=>{if(t.isDeleted)return;const n=Ta(t);Ge.appendChild(n)})}function ke(){tn.innerHTML="",d&&q(d.students).forEach(e=>{const t=document.createElement("li"),n=document.createElement("span");n.textContent=e.identity.name,n.style.flexGrow="1",n.className="student-name-link",n.addEventListener("click",()=>{ne(e)}),t.appendChild(n),t.addEventListener("contextmenu",s=>{gt(s,[{label:"ØªØºÛŒÛŒØ± Ù†Ø§Ù…",icon:"âœï¸",action:()=>{On(e,d)}},{label:"Ø§Ù†ØªÙ‚Ø§Ù„ Ø¯Ø§Ù†Ø´â€ŒØ¢Ù…ÙˆØ²",icon:"â¡ï¸",action:()=>{As(e,d)}},{label:"Ø­Ø°Ù Ø¯Ø§Ù†Ø´â€ŒØ¢Ù…ÙˆØ²",icon:"ğŸ—‘ï¸",className:"danger",action:()=>{z(`Ø¢ÛŒØ§ Ø§Ø² Ø§Ù†ØªÙ‚Ø§Ù„ Ø¯Ø§Ù†Ø´â€ŒØ¢Ù…ÙˆØ² Â«${e.identity.name}Â» Ø¨Ù‡ Ø³Ø·Ù„ Ø²Ø¨Ø§Ù„Ù‡ Ù…Ø·Ù…Ø¦Ù† Ù‡Ø³ØªÛŒØ¯ØŸ`,()=>{const o={id:`trash_${Date.now()}_${Math.random()}`,timestamp:new Date().toISOString(),type:"student",description:`Ø¯Ø§Ù†Ø´â€ŒØ¢Ù…ÙˆØ² Â«${e.identity.name}Â» Ø§Ø² Ú©Ù„Ø§Ø³ Â«${d.info.name}Â»`,restoreData:{studentId:e.identity.studentId,classId:d.info.scheduleCode}};M.unshift(o),M.length>50&&M.pop(),e.isDeleted=!0,A(d.info.name,`Ø¯Ø§Ù†Ø´â€ŒØ¢Ù…ÙˆØ² Â«${e.identity.name}Â» Ø¨Ù‡ Ø³Ø·Ù„ Ø²Ø¨Ø§Ù„Ù‡ Ù…Ù†ØªÙ‚Ù„ Ø´Ø¯.`,{type:"VIEW_TRASH"}),k(),ke(),C(`âœ… Ø¯Ø§Ù†Ø´â€ŒØ¢Ù…ÙˆØ² Â«${e.identity.name}Â» Ø¨Ù‡ Ø³Ø·Ù„ Ø²Ø¨Ø§Ù„Ù‡ Ù…Ù†ØªÙ‚Ù„ Ø´Ø¯.`)},{confirmText:"Ø¨Ù„Ù‡",confirmClass:"btn-warning",isDelete:!0})}}])}),tn.appendChild(t)})}function Ke(){if(nn.innerHTML="",!d)return;d.categories.filter(t=>!t.isDeleted).forEach(t=>{const n=document.createElement("li"),s=document.createElement("div");s.className="name-and-badge-container";const a=document.createElement("span");if(a.textContent=t.name,s.appendChild(a),t.isGradedCategory){const i=document.createElement("span");i.className="category-badge",i.textContent="Ù‚Ø§Ø¨Ù„ Ù†Ù…Ø±Ù‡â€ŒØ¯Ù‡ÛŒ",s.appendChild(i)}const o=document.createElement("button");o.className="btn-icon",o.innerHTML="ğŸ—‘ï¸",o.style.color="var(--color-warning)",o.addEventListener("click",()=>{z(`Ø¢ÛŒØ§ Ø§Ø² Ø§Ù†ØªÙ‚Ø§Ù„ Ø¯Ø³ØªÙ‡â€ŒØ¨Ù†Ø¯ÛŒ Â«${t.name}Â» Ø¨Ù‡ Ø³Ø·Ù„ Ø²Ø¨Ø§Ù„Ù‡ Ù…Ø·Ù…Ø¦Ù† Ù‡Ø³ØªÛŒØ¯ØŸ`,()=>{const i={id:`trash_${Date.now()}_${Math.random()}`,timestamp:new Date().toISOString(),type:"category",description:`Ø¯Ø³ØªÙ‡â€ŒØ¨Ù†Ø¯ÛŒ Â«${t.name}Â» Ø§Ø² Ú©Ù„Ø§Ø³ Â«${d.info.name}Â»`,restoreData:{categoryId:t.id,classId:d.info.scheduleCode}};M.unshift(i),M.length>50&&M.pop(),t.isDeleted=!0,A(d.info.name,`Ø¯Ø³ØªÙ‡â€ŒØ¨Ù†Ø¯ÛŒ Â«${t.name}Â» Ø¨Ù‡ Ø³Ø·Ù„ Ø²Ø¨Ø§Ù„Ù‡ Ù…Ù†ØªÙ‚Ù„ Ø´Ø¯.`,{type:"VIEW_TRASH"}),k(),Ke(),C(`âœ… Ø¯Ø³ØªÙ‡â€ŒØ¨Ù†Ø¯ÛŒ Â«${t.name}Â» Ø¨Ù‡ Ø³Ø·Ù„ Ø²Ø¨Ø§Ù„Ù‡ Ù…Ù†ØªÙ‚Ù„ Ø´Ø¯.`)},{confirmText:"Ø¨Ù„Ù‡",confirmClass:"btn-warning"})}),n.appendChild(s),n.appendChild(o),nn.appendChild(n)})}function lt(e){document.querySelectorAll(".page").forEach(n=>{n.classList.remove("active")});const t=document.getElementById(e);t&&t.classList.add("active"),e==="class-management-page"?(X(null),ie(null),de(null),ae(),an.style.display="flex"):an.style.display="none",Ps()}function T(e){const t={pageId:e,currentClassName:d?d.info.name:null,selectedSessionNumber:v?v.sessionNumber:null,selectedStudentId:D?D.identity.studentId:null};let n=`#${e}`;const s=new URLSearchParams;d&&s.set("class",d.info.name),v&&s.set("session",v.sessionNumber),D&&s.set("student",D.identity.studentId);const a=s.toString();a&&(n+=`?${a}`),window.location.hash!==n&&history.pushState(t,"",n),lt(e)}function Da(e,t){const n=document.createElement("div");n.className="list-item-buttons";const s=document.createElement("button");if(s.className="btn-icon",s.innerHTML="ğŸ“",s.title="Ø§ÙØ²ÙˆØ¯Ù†/ÙˆÛŒØ±Ø§ÛŒØ´ ÛŒØ§Ø¯Ø¯Ø§Ø´Øª Ø¬Ù„Ø³Ù‡",s.style.borderBottom="solid",e.note||(s.style.opacity="0.5",s.style.borderBottom="none"),s.addEventListener("click",a=>{a.stopPropagation(),H.value=e.note||"",ve(o=>{e.note=o,k(),A(d.info.name,`ÛŒØ§Ø¯Ø¯Ø§Ø´Øª Ø¬Ù„Ø³Ù‡ ${t} Ø°Ø®ÛŒØ±Ù‡ Ø´Ø¯.`,{type:"VIEW_SESSIONS"}),te(),C("âœ…ÛŒØ§Ø¯Ø¯Ø§Ø´Øª Ø¬Ù„Ø³Ù‡ Ø°Ø®ÛŒØ±Ù‡ Ø´Ø¯.")}),Z("add-note-modal"),H.focus()}),n.appendChild(s),!e.isFinished&&!e.isCancelled){const a=document.createElement("button");a.className="btn-icon",a.innerHTML="âœ…",a.title="Ø®Ø§ØªÙ…Ù‡ Ø¬Ù„Ø³Ù‡",a.addEventListener("click",o=>{o.stopPropagation(),z(`Ø¬Ù„Ø³Ù‡ Ø´Ù…Ø§Ø±Ù‡ ${t} Ø®Ø§ØªÙ…Ù‡ Ù¾ÛŒØ¯Ø§ Ø®ÙˆØ§Ù‡Ø¯ Ú©Ø±Ø¯!`,()=>{d.endSpecificSession(e.sessionNumber),k(),A(d.info.name,`Ø¬Ù„Ø³Ù‡ ${t} Ø®Ø§ØªÙ…Ù‡ ÛŒØ§ÙØª.`,{type:"VIEW_SESSIONS"}),te(),z("Ø¬Ù„Ø³Ù‡ Ø¨Ø§ Ù…ÙˆÙÙ‚ÛŒØª Ø®Ø§ØªÙ…Ù‡ ÛŒØ§ÙØª. Ø¢ÛŒØ§ Ù…Ø§ÛŒÙ„ Ø¨Ù‡ Ø§ÛŒØ¬Ø§Ø¯ ÙØ§ÛŒÙ„ Ù¾Ø´ØªÛŒØ¨Ø§Ù† Ù‡Ø³ØªÛŒØ¯ØŸ",()=>{if(Ce){C("âš ï¸ Ù¾Ø´ØªÛŒØ¨Ø§Ù†â€ŒÚ¯ÛŒØ±ÛŒ Ø¯Ø± Ø­Ø§Ù„Øª Ù†Ù…Ø§ÛŒØ´ (Demo) ØºÛŒØ±ÙØ¹Ø§Ù„ Ø§Ø³Øª.");return}ft(),C("âœ…ÙØ§ÛŒÙ„ Ù¾Ø´ØªÛŒØ¨Ø§Ù† Ø¨Ø§ Ù…ÙˆÙÙ‚ÛŒØª Ø§ÛŒØ¬Ø§Ø¯ Ø´Ø¯.")},{confirmText:"Ø¨Ù„Ù‡",cancelText:"Ø®ÛŒØ±",confirmClass:"btn-success"})})}),n.appendChild(a)}return n}function Ma(e,t){const n=document.createElement("div");n.style.display="flex",n.style.flexDirection="column",n.style.alignItems="flex-start",n.style.flexGrow="1";const s=new Date(e.startTime).toLocaleDateString("fa-IR"),a=document.createElement("span"),o=document.createElement("div");o.style.display="flex",o.style.gap="5px",o.style.marginTop="5px";const i=new Date(e.startTime).toLocaleDateString("fa-IR",{weekday:"long"}),r=document.createElement("span");if(r.className="type-badge day-badge",r.textContent=i,o.appendChild(r),e.isCancelled){a.textContent=`âœ…Ø¬Ù„Ø³Ù‡ Ù„ØºÙˆ Ø´Ø¯Ù‡ - ØªØ§Ø±ÛŒØ®: ${s}`,n.style.cursor="default";const c=document.createElement("span");c.className="type-badge cancelled-badge",c.textContent="Ù„ØºÙˆ Ø´Ø¯Ù‡",o.appendChild(c)}else a.textContent=`Ø¬Ù„Ø³Ù‡ ${t} - ØªØ§Ø±ÛŒØ®: ${s}`,n.style.cursor="pointer",n.addEventListener("click",()=>{ie(e),Mn()});if(n.appendChild(a),e.isFinished){const c=document.createElement("span");c.className="type-badge",c.textContent="Ø®Ø§ØªÙ…Ù‡ ÛŒØ§ÙØªÙ‡",c.style.backgroundColor="var(--color-secondary)",o.appendChild(c)}if(e.isMakeup){const c=document.createElement("span");c.className="type-badge",c.textContent="Ø¬Ø¨Ø±Ø§Ù†ÛŒ",c.style.backgroundColor="var(--color-warning)",c.style.color="var(--color-text-dark)",o.appendChild(c)}return n.appendChild(o),n}function $a(e,t){const n=document.createElement("li"),s=t.get(e.sessionNumber),a=Ma(e,s);n.appendChild(a);const o=Da(e,s);return n.appendChild(o),n.addEventListener("contextmenu",i=>{const r=[{label:e.isCancelled?"Ø¨Ø§Ø²Ú¯Ø±Ø¯Ø§Ù†ÛŒ Ø¬Ù„Ø³Ù‡":"Ù„ØºÙˆ Ø¬Ù„Ø³Ù‡",icon:"âŒ",action:()=>{const c=e.isCancelled?"Ø¨Ø§Ø²Ú¯Ø±Ø¯Ø§Ù†ÛŒ Ø¬Ù„Ø³Ù‡":"Ù„ØºÙˆ Ø¬Ù„Ø³Ù‡",f=e.isCancelled?"Ø¢ÛŒØ§ Ø§Ø² Ø¨Ø§Ø²Ú¯Ø±Ø¯Ø§Ù†ÛŒ Ø§ÛŒÙ† Ø¬Ù„Ø³Ù‡ Ù…Ø·Ù…Ø¦Ù† Ù‡Ø³ØªÛŒØ¯ØŸ":"Ø¢ÛŒØ§ Ø§Ø² Ù„ØºÙˆ Ø§ÛŒÙ† Ø¬Ù„Ø³Ù‡ Ù…Ø·Ù…Ø¦Ù† Ù‡Ø³ØªÛŒØ¯ØŸ Ø¬Ù„Ø³Ù‡ Ù„ØºÙˆ Ø´Ø¯Ù‡ Ø¯Ø± Ø¢Ù…Ø§Ø± ØªØ§Ø«ÛŒØ±ÛŒ Ù†Ø¯Ø§Ø±Ø¯ Ø§Ù…Ø§ Ù‚Ø§Ø¨Ù„ Ø¨Ø§Ø²Ú¯Ø±Ø¯Ø§Ù†ÛŒ Ø§Ø³Øª.";z(f,()=>{e.isCancelled=!e.isCancelled;const p=e.isCancelled?`Ø¬Ù„Ø³Ù‡ ${s} Ù„ØºÙˆ Ø´Ø¯.`:`Ø¬Ù„Ø³Ù‡ Ù„ØºÙˆ Ø´Ø¯Ù‡ (ØªØ§Ø±ÛŒØ®: ${new Date(e.startTime).toLocaleDateString("fa-IR")}) Ø¨Ø§Ø²Ú¯Ø±Ø¯Ø§Ù†ÛŒ Ø´Ø¯.`;A(d.info.name,p,{type:"VIEW_SESSIONS"}),k(),te(),C(e.isCancelled?"âœ…Ø¬Ù„Ø³Ù‡ Ù„ØºÙˆ Ø´Ø¯.":"âœ…Ø¬Ù„Ø³Ù‡ Ø¨Ø§Ø²Ú¯Ø±Ø¯Ø§Ù†ÛŒ Ø´Ø¯.")},{confirmText:c,confirmClass:"btn-warning"})}},{label:"ØªØºÛŒÛŒØ± ÙˆØ¶Ø¹ÛŒØª Ø¬Ø¨Ø±Ø§Ù†ÛŒ",icon:"ğŸ”„",action:()=>{d.markAsMakeup(e.sessionNumber),k();const c=e.isMakeup?`Ø¬Ù„Ø³Ù‡ ${s} Ø¨Ù‡ Ø¹Ù†ÙˆØ§Ù† Ø¬Ø¨Ø±Ø§Ù†ÛŒ Ø¹Ù„Ø§Ù…Øªâ€ŒÚ¯Ø°Ø§Ø±ÛŒ Ø´Ø¯.`:`Ø¬Ù„Ø³Ù‡ ${s} Ø§Ø² Ø­Ø§Ù„Øª Ø¬Ø¨Ø±Ø§Ù†ÛŒ Ø®Ø§Ø±Ø¬ Ø´Ø¯.`;A(d.info.name,c,{type:"VIEW_SESSIONS"}),te()}},{label:"Ø­Ø°Ù Ø¬Ù„Ø³Ù‡",icon:"ğŸ—‘ï¸",className:"danger",action:()=>{const c=e.isCancelled?"Ù„ØºÙˆ Ø´Ø¯Ù‡":s;z(`Ø¢ÛŒØ§ Ø§Ø² Ø§Ù†ØªÙ‚Ø§Ù„ Ø¬Ù„Ø³Ù‡ ${c} Ø¨Ù‡ Ø³Ø·Ù„ Ø²Ø¨Ø§Ù„Ù‡ Ù…Ø·Ù…Ø¦Ù† Ù‡Ø³ØªÛŒØ¯ØŸ`,()=>{const f={id:`trash_${Date.now()}_${Math.random()}`,timestamp:new Date().toISOString(),type:"session",description:`Ø¬Ù„Ø³Ù‡ ${c} Ø§Ø² Ú©Ù„Ø§Ø³ Â«${d.info.name}Â»`,restoreData:{sessionNumber:e.sessionNumber,classId:d.info.scheduleCode}};M.unshift(f),M.length>50&&M.pop(),e.isDeleted=!0,A(d.info.name,`Ø¬Ù„Ø³Ù‡ ${c} Ø¨Ù‡ Ø³Ø·Ù„ Ø²Ø¨Ø§Ù„Ù‡ Ù…Ù†ØªÙ‚Ù„ Ø´Ø¯.`,{type:"VIEW_TRASH"}),k(),te(),C(`âœ… Ø¬Ù„Ø³Ù‡ ${c} Ø¨Ù‡ Ø³Ø·Ù„ Ø²Ø¨Ø§Ù„Ù‡ Ù…Ù†ØªÙ‚Ù„ Ø´Ø¯.`)},{confirmText:"Ø¨Ù„Ù‡",confirmClass:"btn-warning",isDelete:!0})}}];gt(i,r)}),n}function te(){const e=document.getElementById("session-list");if(!d)return;if(e.innerHTML="",d.sessions.length===0){e.innerHTML="<li>Ù‡Ù†ÙˆØ² Ø¬Ù„Ø³Ù‡â€ŒØ§ÛŒ Ø´Ø±ÙˆØ¹ Ù†Ø´Ø¯Ù‡ Ø§Ø³Øª.</li>";return}const t=fe(d);[...q(d.sessions)].reverse().forEach(s=>{const a=$a(s,t);e.appendChild(a)})}function tt(e){if(xe.innerHTML="",e.length>0)e.forEach(t=>{const n=document.createElement("div");n.textContent=t.identity.name,n.addEventListener("click",()=>{ne(t),xe.style.display="none",rn.value=""}),xe.appendChild(n)}),xe.style.display="block";else if(rn.value.trim()!==""){const t=document.createElement("div");t.className="no-results",t.textContent="Ù¾ÛŒØ¯Ø§ Ù†Ø´Ø¯",xe.appendChild(t),xe.style.display="block"}else xe.style.display="none"}function Bt(e){if(Ie.innerHTML="",e.length>0)e.forEach(t=>{const n=document.createElement("div");n.className="global-search-result";const s=document.createElement("span");s.className="student-name",s.textContent=t.student.identity.name;const a=document.createElement("span");a.className="class-name",a.textContent=`Ú©Ù„Ø§Ø³: ${t.classroom.info.name}`,n.addEventListener("click",()=>{X(t.classroom),ne(t.student),Ie.style.display="none",Lt.value=""}),a.addEventListener("click",o=>{o.stopPropagation(),X(t.classroom),ie(null),ut(t.classroom.liveSession),te(),T("session-page"),Ie.style.display="none",Lt.value=""}),n.appendChild(s),n.appendChild(a),Ie.appendChild(n)}),Ie.style.display="block";else if(Lt.value.trim()!==""){const t=document.createElement("div");t.className="no-results",t.textContent="Ù¾ÛŒØ¯Ø§ Ù†Ø´Ø¯",Ie.appendChild(t),Ie.style.display="block"}else Ie.style.display="none"}function pt(){const e=document.getElementById("trashed-items-list");if(e.innerHTML="",M.length===0){e.innerHTML='<li style="text-align: center; padding: 20px;">Ø³Ø·Ù„ Ø²Ø¨Ø§Ù„Ù‡ Ø®Ø§Ù„ÛŒ Ø§Ø³Øª.</li>';return}M.forEach((t,n)=>{const s=document.createElement("li"),a=document.createElement("span");a.textContent=t.description,a.style.flexGrow="1";const o=document.createElement("div");o.className="list-item-buttons";const i=document.createElement("button");i.className="btn-icon",i.innerHTML="ğŸ”„",i.title="Ø¨Ø§Ø²ÛŒØ§Ø¨ÛŒ",i.addEventListener("click",()=>{var w;let c=!1,f=null;const p=t.restoreData;switch(t.type){case"classroom":{const u=S[p.name];u&&!u.isDeleted?f=`Ú©Ù„Ø§Ø³ÛŒ Ø¨Ø§ Ù†Ø§Ù… Â«${p.name}Â» Ø§Ø² Ù‚Ø¨Ù„ ÙØ¹Ø§Ù„ Ø§Ø³Øª.`:u&&u.isDeleted&&(u.isDeleted=!1,c=!0);break}case"student":{const u=Object.values(S).find(b=>b.info.scheduleCode===p.classId),y=u==null?void 0:u.students.find(b=>b.identity.studentId===p.studentId);y&&(y.isDeleted=!1,c=!0);break}case"session":{const u=Object.values(S).find(b=>b.info.scheduleCode===p.classId),y=u==null?void 0:u.sessions.find(b=>b.sessionNumber===p.sessionNumber);y&&(y.isDeleted=!1,c=!0);break}case"category":{const u=Object.values(S).find(b=>b.info.scheduleCode===p.classId),y=u==null?void 0:u.categories.find(b=>b.id===p.categoryId);y&&(y.isDeleted=!1,c=!0);break}case"score":{const u=Object.values(S).find(L=>L.info.scheduleCode===p.classId),y=u==null?void 0:u.students.find(L=>L.identity.studentId===p.studentId),b=(w=y==null?void 0:y.logs.scores[p.skill.toLowerCase()])==null?void 0:w.find(L=>L.id===p.scoreId);b&&(b.isDeleted=!1,c=!0);break}case"note":{const u=Object.values(S).find(L=>L.info.scheduleCode===p.classId),y=u==null?void 0:u.students.find(L=>L.identity.studentId===p.studentId),b=y==null?void 0:y.profile.notes.find(L=>L.id===p.noteId);b&&(b.isDeleted=!1,c=!0);break}}c?(M.splice(n,1),k(),pt(),t.type==="classroom"&&ae(),C("âœ… Ø¢ÛŒØªÙ… Ø¨Ø§ Ù…ÙˆÙÙ‚ÛŒØª Ø¨Ø§Ø²ÛŒØ§Ø¨ÛŒ Ø´Ø¯.")):C(f?`âš ï¸ ${f}`:"âš ï¸ Ø¢ÛŒØªÙ… Ø§ØµÙ„ÛŒ Ø¨Ø±Ø§ÛŒ Ø¨Ø§Ø²ÛŒØ§Ø¨ÛŒ ÛŒØ§ÙØª Ù†Ø´Ø¯.")});const r=document.createElement("button");r.className="btn-icon",r.innerHTML="ğŸ”¥",r.title="Ø­Ø°Ù Ø¯Ø§Ø¦Ù…ÛŒ",r.addEventListener("click",()=>{z("Ø¢ÛŒØ§ Ø§Ø² Ø­Ø°Ù Ø¯Ø§Ø¦Ù…ÛŒ Ø§ÛŒÙ† Ø¢ÛŒØªÙ… Ù…Ø·Ù…Ø¦Ù† Ù‡Ø³ØªÛŒØ¯ØŸ Ø§ÛŒÙ† Ø¹Ù…Ù„ ØºÛŒØ±Ù‚Ø§Ø¨Ù„ Ø¨Ø§Ø²gØ´Øª Ø§Ø³Øª.",()=>{const c=t.restoreData,f=w=>Object.values(S).find(u=>u.info.scheduleCode===w);let p;switch(t.type){case"classroom":delete S[c.name];break;case"student":p=f(c.classId),dt({identity:{studentId:c.studentId}},p);break;case"session":p=f(c.classId),p&&cs(p.info.name,c.sessionNumber);break;case"category":p=f(c.classId),p&&ls(p.info.name,c.categoryId);break;case"score":p=f(c.classId),p&&rs(p.info.name,c.studentId,c.skill,c.scoreId);break;case"note":p=f(c.classId),p&&ds(p.info.name,c.studentId,c.noteId);break}M.splice(n,1),k(),pt(),C("âœ… Ø¢ÛŒØªÙ… Ø¨Ø±Ø§ÛŒ Ù‡Ù…ÛŒØ´Ù‡ Ø­Ø°Ù Ø´Ø¯.")},{confirmText:"Ø­Ø°Ù Ø¯Ø§Ø¦Ù…ÛŒ",confirmClass:"btn-warning"})}),o.appendChild(i),o.appendChild(r),s.appendChild(a),s.appendChild(o),e.appendChild(s)})}function Oa(){const e=document.getElementById("absentees-summary-container");e&&(e.innerHTML=`
        <div id="absentees-summary-box" class="absentees-summary">
            <div class="absentees-summary-header">
                <h4>Ù„ÛŒØ³Øª ØºØ§ÛŒØ¨ÛŒÙ† Ø¬Ù„Ø³Ù‡ Ø´Ù…Ø§Ø±Ù‡ <span id="absentee-summary-session-number"></span></h4>
                <button id="copy-absentees-btn" class="btn-icon" title="Ú©Ù¾ÛŒ Ù„ÛŒØ³Øª ØºØ§ÛŒØ¨ÛŒÙ†">ğŸ“‹</button>
            </div>
            <div id="absentees-summary-list" class="summary-list"></div>
        </div>
    `)}function js(){const e=document.getElementById("absentees-summary-box"),t=document.getElementById("absentees-summary-list"),n=document.getElementById("absentee-summary-session-number");if(!e||!t||!n){console.error("Could not find all absentee summary elements.");return}if(!d||!v){e.classList.remove("visible");return}const s=q(d.students).filter(o=>{const i=v.studentRecords[o.identity.studentId];return i&&i.attendance==="absent"}),a=fe(d);n.textContent=a.get(v.sessionNumber),s.length>0?e.classList.add("visible"):e.classList.remove("visible"),t.innerHTML="",s.forEach(o=>{const r=(f=>d.sessions.reduce((p,w)=>{if(w.isDeleted||w.isCancelled)return p;const u=w.studentRecords[f.identity.studentId];return p+(u&&u.attendance==="absent"?1:0)},0))(o),c=document.createElement("span");c.className="summary-name",c.textContent=`${o.identity.name} (ØºÛŒØ¨Øª: ${r})`,c.addEventListener("click",()=>{c.classList.add("fading-out"),setTimeout(()=>{v.setAttendance(o.identity.studentId,"present"),k(),We()},200)}),t.appendChild(c)})}function Ha(){const e=document.getElementById("copy-absentees-btn");if(!e){console.error("Could not find the copy absentees button to attach listener.");return}e.addEventListener("click",()=>{if(!d||!v)return;const t=q(d.students).filter(a=>{const o=v.studentRecords[a.identity.studentId];return o&&o.attendance==="absent"});if(t.length===0){C("âš ï¸Ù„ÛŒØ³Øª ØºØ§ÛŒØ¨ÛŒÙ† Ø®Ø§Ù„ÛŒ Ø§Ø³Øª.");return}const n=a=>d.sessions.reduce((o,i)=>{if(i.isDeleted||i.isCancelled)return o;const r=i.studentRecords[a.identity.studentId];return o+(r&&r.attendance==="absent"?1:0)},0);let s=`Ù„ÛŒØ³Øª ØºØ§ÛŒØ¨ÛŒÙ† Ø¬Ù„Ø³Ù‡ Ø´Ù…Ø§Ø±Ù‡ ${Sa()}:

`;t.forEach(a=>{const o=n(a);s+=`- ${a.identity.name} (ØªØ¹Ø¯Ø§Ø¯ ØºÛŒØ¨Øªâ€ŒÙ‡Ø§: ${o})
`}),navigator.clipboard.writeText(s).then(()=>{C("âœ…Ù„ÛŒØ³Øª ØºØ§ÛŒØ¨ÛŒÙ† Ø¨Ø§ Ù…ÙˆÙÙ‚ÛŒØª Ú©Ù¾ÛŒ Ø´Ø¯.")}).catch(a=>{console.error("Failed to copy text: ",a),C("âŒØ®Ø·Ø§ Ø¯Ø± Ú©Ù¾ÛŒ Ú©Ø±Ø¯Ù† Ù„ÛŒØ³Øª.")})})}function xt(){const e=document.getElementById("demo-mode-banner");e&&(Ce?(e.classList.add("visible"),document.body.classList.add("demo-mode-active")):(e.classList.remove("visible"),document.body.classList.remove("demo-mode-active")))}const Ra=Object.freeze(Object.defineProperty({__proto__:null,_internalShowPage:lt,addCategoryBtn:Wo,addClassBtn:Io,addNoteModal:Yo,addScoreBtn:sa,addStudentBtn:No,appHeader:an,attendanceListUl:st,attendanceMassActionsContainer:wt,attendancePage:_o,attendanceSearchInput:Me,backToSessionsBtn:wo,backToStudentPageBtn:ea,backupDataBtn:jo,breadcrumbContainer:Ve,cancelImportBtn:Ro,cancelNoteBtn:Zo,categoryListUl:nn,categoryModal:fa,categoryModalCancelBtn:pa,categoryModalSaveBtn:Ds,categoryModalTitle:Ts,classListHeader:Fo,classListUl:Ge,classManagementPage:Is,classSaveNoteBtn:Xo,closeActiveModal:F,closeContextMenu:$e,closeNavBtn:Vo,columnMappingPage:Oo,columnSelectDropdown:on,confirmColumnBtn:Ho,confirmModalCancelBtn:ln,confirmModalConfirmBtn:et,confirmModalMessage:ks,contextMenu:He,csvCancelBtn:Do,csvConfirmBtn:To,csvFileInput:$o,csvPreviewList:sn,csvPreviewPage:xo,customConfirmModal:Jo,displayWinner:me,finishAttendanceBtn:Po,globalStudentSearchInput:Lt,globalStudentSearchResultsDiv:Ie,gradedCategoryPillsContainer:ta,hamburgerMenuBtn:qo,handleUndo:Os,importCsvBtn:Mo,initiateBackupProcess:ft,isGradedCheckbox:ia,massCommentAppendCheckbox:Dn,massCommentBtn:un,massCommentCancelBtn:ya,massCommentContent:ct,massCommentModal:ga,massCommentModalTitle:ha,massCommentSaveBtn:Ca,massCommentStudentCountMessage:Ms,newCategoryModalIsGradedCheckbox:Tn,newCategoryModalNameInput:it,newCategoryNameInput:Ao,newClassNameInput:bo,newNoteContent:H,newScoreCommentTextarea:xs,newScoreValueInput:na,newStudentNameInput:ko,openContextMenu:gt,openModal:Z,overlay:Go,pasteArea:Ls,processMassHomeworkComment:fn,processPasteBtn:Bo,profileScoresListUl:aa,profileStatsSummaryDiv:oa,quickGradeFormWrapper:ot,quickGradeSubmitBtn:Je,quickNoteTextarea:ye,quickScoreInput:Le,renderAttendancePage:We,renderBreadcrumbs:Ps,renderClassList:ae,renderClassManagementStats:Gs,renderColumnSelector:Vs,renderGlobalSearchResults:Bt,renderImportPreview:hn,renderLogModal:_s,renderMassCommentControls:Hn,renderScoresHistory:qs,renderSearchResults:tt,renderSessionDashboard:Mn,renderSessions:te,renderSettingsCategories:Ke,renderSettingsStudentList:ke,renderStudentNotes:Us,renderStudentStatsList:oe,renderTrashPage:pt,restoreDataBtn:zo,restoreFileInput:ws,secureConfirmCancelBtn:Qo,secureConfirmCode:Bs,secureConfirmConfirmBtn:St,secureConfirmInput:Ue,secureConfirmMessage:Ns,secureConfirmModal:Ko,selectStudentBtn:we,selectStudentBtnWrapper:ze,sessionDashboardPage:va,setAutoDirectionOnInput:Fs,settingsClassNameHeader:xn,settingsPage:Lo,settingsStudentListUl:tn,setupDashboardTabs:$s,showCategoryModal:mn,showClassNoteModal:Rn,showCustomConfirm:z,showMassCommentModal:Ws,showMoveStudentModal:As,showNotification:C,showPage:T,showRenameStudentModal:On,showRestoreConfirmModal:Hs,showSecureConfirm:Rs,showSettingsPage:An,showStudentProfile:ne,showUndoToast:Ea,sideNavMenu:Uo,studentSearchInput:rn,studentSearchResultsDiv:xe,studentStatsHeader:cn,switchDashboardTab:$n,trashedCategoriesList:da,trashedClassesList:ca,trashedNotesList:ua,trashedScoresList:ma,trashedSessionsList:ra,trashedStudentsList:la,triggerFileDownload:pn,undoBtn:So,undoMessage:Ss,undoToast:Ut,updateDemoModeBanner:xt},Symbol.toStringTag,{value:"Module"}));function Aa(){const e=window.location.hash;if(!e||e==="#")return!1;const[t,n]=e.split("?"),s=t.substring(1),a=new URLSearchParams(n),o=a.get("class"),i=parseInt(a.get("session"),10),r=a.get("student");if(o&&S[o])X(S[o]),i&&d.getSession(i)&&ie(d.getSession(i)),r&&d.students.find(c=>c.identity.studentId===r)&&de(d.students.find(c=>c.identity.studentId===r));else return!1;switch(s){case"session-page":te(),T("session-page");break;case"student-page":(void 0)();break;case"attendance-page":We(),T("attendance-page");break;case"settings-page":xn.textContent=`ØªÙ†Ø¸ÛŒÙ…Ø§Øª Ú©Ù„Ø§Ø³: ${d.info.name}`,ke(),Ke(),T("settings-page");break;case"student-profile-page":ne(D),T("session-page");break;default:return!1}return!0}document.addEventListener("DOMContentLoaded",()=>{const{globalStudentSearchInput:e,newClassNameInput:t,addClassBtn:n,undoBtn:s,backToSessionsBtn:a,newStudentNameInput:o,addStudentBtn:i,pasteArea:r,processPasteBtn:c,csvPreviewList:f,csvConfirmBtn:p,csvCancelBtn:w,importCsvBtn:u,csvFileInput:y,columnSelectDropdown:b,confirmColumnBtn:L,cancelImportBtn:N,newCategoryNameInput:_,addCategoryBtn:G,selectStudentBtn:j,attendancePage:P,finishAttendanceBtn:$,classListHeader:J,studentStatsHeader:ce,hamburgerMenuBtn:Ee,sideNavMenu:Q,closeNavBtn:pe,overlay:K,backupDataBtn:_e,restoreDataBtn:ht,restoreFileInput:Ne,confirmModalCancelBtn:Pe,confirmModalConfirmBtn:R,secureConfirmCancelBtn:V,secureConfirmConfirmBtn:se,newNoteContent:Fe,classSaveNoteBtn:jt,cancelNoteBtn:Qe,studentSearchInput:Be,studentSearchResultsDiv:Ye,isGradedCheckbox:_n,categoryModalSaveBtn:zs,categoryModalCancelBtn:Js,massCommentBtn:Ks,massCommentCancelBtn:Qs,massCommentSaveBtn:Ys,massCommentContent:Xs,massCommentAppendCheckbox:Zs,attendanceSearchInput:Pn}=Ra,eo=document.getElementById("trash-nav-btn");document.querySelector(".global-search-container .search-icon"),At(),xt(),Aa()||(ae(),T("class-management-page"));function Fn(l,g){const m=document.querySelector(l);if(!m)return;const h=m.querySelector(".search-icon"),E=m.querySelector(".animated-search-input");!h||!E||(h.addEventListener("mousedown",B=>{B.preventDefault()}),h.addEventListener("click",()=>{m.classList.contains("search-active")||(m.classList.add("search-active"),E.focus())}),E.addEventListener("blur",()=>{setTimeout(()=>{m.classList.remove("search-active"),E.value="",g&&g([])},150)}))}Pn.addEventListener("input",()=>{const l=Pn.value.toLowerCase().trim(),g=Yt(l);st.querySelectorAll(".attendance-list-item").forEach(h=>{const E=h.querySelector(".student-name");if(E){const B=E.textContent,I=be(B.toLowerCase()),x=I.includes(be(l)),O=I.includes(be(g));x||O?h.style.display="flex":h.style.display="none"}})}),Js.addEventListener("click",()=>{F(),Gt(null)}),zs.addEventListener("click",()=>{const l=it.value.trim(),g=Tn.checked;typeof Ht=="function"&&Ht(l,g)}),window.addEventListener("scroll",$e),document.addEventListener("click",l=>{He.classList.contains("visible")&&!He.contains(l.target)&&$e(),Be.contains(l.target)||(Ye.style.display="none");const g=l.target.closest(".log-action-link");if(g&&g.dataset.action)try{const m=JSON.parse(g.dataset.action);lo(m)}catch(m){console.error("Could not parse log action:",m)}}),ze.addEventListener("click",()=>{(ze.classList.contains("disabled-wrapper")||we.disabled)&&(we.classList.add("shake-animation"),setTimeout(()=>{we.classList.remove("shake-animation")},200))}),ce.addEventListener("click",()=>{const l=new Date().getTime();l-bn>500?It(1):It(Mt+1),hs(l),Mt===5&&(It(0),z("Ø¢ÛŒØ§ Ø§Ø² ØµÙØ± Ú©Ø±Ø¯Ù† ØªÙ…Ø§Ù… Ø´Ù…Ø§Ø±Ù†Ø¯Ù‡â€ŒÙ‡Ø§ÛŒ Ø¯Ø§Ù†Ø´â€ŒØ¢Ù…ÙˆØ²Ø§Ù† Ù…Ø·Ù…Ø¦Ù† Ù‡Ø³ØªÛŒØ¯ØŸ Ø§ÛŒÙ† Ø¹Ù…Ù„ ØºÛŒØ±Ù‚Ø§Ø¨Ù„ Ø¨Ø§Ø²Ú¯Ø´Øª Ø§Ø³Øª.",()=>{is(),oe(),C("ØªÙ…Ø§Ù… Ø¢Ù…Ø§Ø±Ù‡Ø§ ØµÙØ± Ø´Ø¯Ù†Ø¯ âœ….")},{confirmText:"Ø¨Ù„Ù‡",confirmClass:"btn-warning"}))}),J.addEventListener("click",()=>{const l=new Date().getTime();l-En>500?bt(1):bt(Dt+1),gs(l),Dt===5&&(bt(0),z("Ø¢ÛŒØ§ Ø§Ø² Ø³Ø§Ø®Øª ÛŒÚ© Ú©Ù„Ø§Ø³ ØªØ³ØªÛŒ ØªØµØ§Ø¯ÙÛŒ Ù…Ø·Ù…Ø¦Ù† Ù‡Ø³ØªÛŒØ¯ØŸ",()=>{function g(){const m=`Ú©Ù„Ø§Ø³ ØªØ³ØªÛŒ ${Object.keys(S).length+1}`,h=new Zt({name:m,type:"online"});["Ø¹Ù„ÛŒ Ø±Ø¶Ø§ÛŒÛŒ","Ù…Ø±ÛŒÙ… Ø­Ø³ÛŒÙ†ÛŒ","Ø²Ù‡Ø±Ø§ Ø§Ø­Ù…Ø¯ÛŒ","Ø±Ø¶Ø§ Ù…Ø­Ù…Ø¯ÛŒ","ÙØ§Ø·Ù…Ù‡ Ú©Ø±ÛŒÙ…ÛŒ"].forEach(B=>h.addStudent(new vt({name:B}))),S[m]=h,k(),ae()}g(),C("Ú©Ù„Ø§Ø³ ØªØ³ØªÛŒ Ø¨Ø§ Ù…ÙˆÙÙ‚ÛŒØª Ø³Ø§Ø®ØªÙ‡ Ø´Ø¯ âœ…!")},{confirmText:"Ø¨Ø³Ø§Ø²",confirmClass:"btn-success"}))}),V.addEventListener("click",()=>{F(),mt(null)}),se.addEventListener("click",()=>{typeof $t=="function"&&$t(),F(),mt(null)}),Pe.addEventListener("click",()=>{F(Sn)}),R.addEventListener("click",()=>{F(In)}),j.addEventListener("click",()=>{if(Le.value.trim()!==""||ye.value.trim()!==""){C("âš ï¸Ù„Ø·ÙØ§Ù‹ Ø§Ø¨ØªØ¯Ø§ Ø¨Ø§ Ø¯Ú©Ù…Ù‡ Â«Ø«Ø¨ØªÂ»ØŒ ØªØºÛŒÛŒØ±Ø§Øª Ø±Ø§ Ø°Ø®ÛŒØ±Ù‡ Ú©Ù†ÛŒØ¯ Ùˆ ÛŒØ§ Ù†Ù…Ø±Ù‡ Ùˆ ÛŒØ§Ø¯Ø¯Ø§Ø´Øª Ø±Ø§ Ù¾Ø§Ú© Ú©Ù†ÛŒØ¯.");return}if(!d||!v||!le)return;const l=d.selectNextWinner(le.name,v);if(l){const g=v.studentRecords[l.identity.studentId];if(g&&g.attendance==="absent"&&l.statusCounters.missedChances++,g&&g.hadIssue){l.statusCounters.missedChances++;const h=le.name;l.categoryIssues[h]=(l.categoryIssues[h]||0)+1}const m={winner:l,categoryName:le.name};v.winnerHistory.push(m),v.winnerHistory.length>10&&v.winnerHistory.shift(),Oe(v.winnerHistory.length-1),v.lastUsedCategoryId=le.id,v.lastSelectedWinnerId=l.identity.studentId,oe(),me(),k()}else C("âŒØ¯Ø§Ù†Ø´â€ŒØ¢Ù…ÙˆØ² ÙˆØ§Ø¬Ø¯ Ø´Ø±Ø§ÛŒØ·ÛŒ Ø¨Ø±Ø§ÛŒ Ø§Ù†ØªØ®Ø§Ø¨ ÛŒØ§ÙØª Ù†Ø´Ø¯.")}),G.addEventListener("click",()=>{if(!d)return;const l=_.value.trim(),g=_n.checked;if(!l){alert("âš ï¸Ù„Ø·ÙØ§Ù‹ Ù†Ø§Ù… Ø¯Ø³ØªÙ‡â€ŒØ¨Ù†Ø¯ÛŒ Ø±Ø§ ÙˆØ§Ø±Ø¯ Ú©Ù†ÛŒØ¯.");return}const m=d.categories.find(E=>E.name.toLowerCase()===l.toLowerCase());if(m)if(m.isDeleted){const E=d.categories.findIndex(B=>B===m);E>-1&&d.categories.splice(E,1)}else{alert("âš ï¸Ø§ÛŒÙ† Ø¯Ø³ØªÙ‡â€ŒØ¨Ù†Ø¯ÛŒ Ø§Ø² Ù‚Ø¨Ù„ ÙˆØ¬ÙˆØ¯ Ø¯Ø§Ø±Ø¯.");return}const h=new Se(l,"",g);d.categories.push(h),k(),A(d.info.name,`Ø¯Ø³ØªÙ‡â€ŒØ¨Ù†Ø¯ÛŒ Ø¬Ø¯ÛŒØ¯ Â«${l}Â» Ø§Ø¶Ø§ÙÙ‡ Ø´Ø¯.`,{type:"VIEW_CLASS_SETTINGS"}),Ke(),_.value="",_n.checked=!1}),_.addEventListener("keyup",l=>{l.key==="Enter"&&G.click()}),L.addEventListener("click",()=>{if(!Tt){alert("âŒØ®Ø·Ø§ÛŒÛŒ Ø±Ø® Ø¯Ø§Ø¯Ù‡ Ø§Ø³Øª. Ù„Ø·ÙØ§Ù‹ ÙØ§ÛŒÙ„ Ø±Ø§ Ø¯ÙˆØ¨Ø§Ø±Ù‡ Ø§Ù†ØªØ®Ø§Ø¨ Ú©Ù†ÛŒØ¯."),T("settings-page");return}const l=parseInt(b.value,10),h=Tt.split(`
`).slice(1).map(E=>{var I;return(I=E.split(",")[l])==null?void 0:I.trim()}).filter(E=>E&&E.length>0);h.length>0?(Ze(h),hn(),T("csv-preview-page")):alert("Ù‡ÛŒÚ† Ù†Ø§Ù…ÛŒ Ø¯Ø± Ø³ØªÙˆÙ† Ø§Ù†ØªØ®Ø§Ø¨ Ø´Ø¯Ù‡ Ù¾ÛŒØ¯Ø§ Ù†Ø´Ø¯. Ù„Ø·ÙØ§Ù‹ Ø³ØªÙˆÙ† Ø¯ÛŒÚ¯Ø±ÛŒ Ø±Ø§ Ø§Ù…ØªØ­Ø§Ù† Ú©Ù†ÛŒØ¯ ÛŒØ§ ÙØ§ÛŒÙ„ Ø®ÙˆØ¯ Ø±Ø§ Ø¨Ø±Ø±Ø³ÛŒ Ú©Ù†ÛŒØ¯."),Et(null)}),u.addEventListener("click",()=>{y.click()}),y.addEventListener("change",l=>{const g=l.target.files[0];if(!g)return;const m=new FileReader;m.onload=h=>{const E=h.target.result;Et(E);const I=E.split(`
`)[0].split(",");Vs(I),T("column-mapping-page")},m.readAsText(g),l.target.value=null}),N.addEventListener("click",()=>{Et(null),T("settings-page")}),p.addEventListener("click",()=>{const l=f.querySelectorAll('input[type="checkbox"]:checked');let g=!1;l.forEach(m=>{const h=m.dataset.name,E=d.students.find(I=>I.identity.name.toLowerCase()===h.toLowerCase());if(E)if(E.isDeleted)dt(E,d);else{console.log(`Ø¯Ø§Ù†Ø´â€ŒØ¢Ù…ÙˆØ² Â«${h}Â» Ø¨Ù‡ Ø¯Ù„ÛŒÙ„ ØªÚ©Ø±Ø§Ø±ÛŒ Ø¨ÙˆØ¯Ù† Ø§Ø¶Ø§ÙÙ‡ Ù†Ø´Ø¯.`);return}const B=new vt({name:h});d.addStudent(B),d.sessions.length>0&&(q(d.sessions).filter(I=>I.isFinished&&!I.isCancelled).forEach(I=>{I.setAttendance(B.identity.studentId,"absent")}),Gn(B,d),g=!0)}),k(),A(d.info.name,`${l.length} Ø¯Ø§Ù†Ø´â€ŒØ¢Ù…ÙˆØ² Ø¬Ø¯ÛŒØ¯ Ø§Ø² Ù„ÛŒØ³Øª ÙˆØ±ÙˆØ¯ÛŒ Ø¨Ù‡ Ú©Ù„Ø§Ø³ Ø§Ø¶Ø§ÙÙ‡ Ø´Ø¯Ù†Ø¯.`,{type:"VIEW_SESSIONS"}),ke(),g&&jn(l.length),T("settings-page"),r.value="",Ze([])}),w.addEventListener("click",()=>{Ze([]),T("settings-page")}),c.addEventListener("click",()=>{const l=r.value.trim();if(!l){alert("Ú©Ø§Ø¯Ø± Ù…ØªÙ†ÛŒ Ø®Ø§Ù„ÛŒ Ø§Ø³Øª. Ù„Ø·ÙØ§Ù‹ Ø§Ø³Ø§Ù…ÛŒ Ø±Ø§ ÙˆØ§Ø±Ø¯ Ú©Ù†ÛŒØ¯.");return}const g=l.split(`
`).map(m=>m.trim()).filter(m=>m.length>0);g.length>0?(Ze(g),hn(),T("csv-preview-page")):alert("Ù‡ÛŒÚ† Ù†Ø§Ù… Ù…Ø¹ØªØ¨Ø±ÛŒ Ø¨Ø±Ø§ÛŒ ÙˆØ±ÙˆØ¯ Ù¾ÛŒØ¯Ø§ Ù†Ø´Ø¯.")}),o.addEventListener("keyup",l=>{l.key==="Enter"&&i.click()}),i.addEventListener("click",()=>{if(!d)return;const l=o.value.trim();if(!l){alert("Ù„Ø·ÙØ§Ù‹ Ù†Ø§Ù… Ø¯Ø§Ù†Ø´â€ŒØ¢Ù…ÙˆØ² Ø±Ø§ ÙˆØ§Ø±Ø¯ Ú©Ù†ÛŒØ¯.");return}const g=d.students.find(h=>h.identity.name.toLowerCase()===l.toLowerCase());if(g)if(g.isDeleted)dt(g,d);else{alert("âŒØ¯Ø§Ù†Ø´â€ŒØ¢Ù…ÙˆØ²ÛŒ Ø¨Ø§ Ø§ÛŒÙ† Ù†Ø§Ù… Ø§Ø² Ù‚Ø¨Ù„ Ø¯Ø± Ø§ÛŒÙ† Ú©Ù„Ø§Ø³ ÙˆØ¬ÙˆØ¯ Ø¯Ø§Ø±Ø¯.");return}const m=new vt({name:l});d.addStudent(m),d.sessions.length>0&&(q(d.sessions).filter(h=>h.isFinished&&!h.isCancelled).forEach(h=>{h.setAttendance(m.identity.studentId,"absent")}),Gn(m,d),jn(1)),k(),A(d.info.name,`Ø¯Ø§Ù†Ø´â€ŒØ¢Ù…ÙˆØ² Â«${l}Â» Ø¨Ù‡ Ú©Ù„Ø§Ø³ Ø§Ø¶Ø§ÙÙ‡ Ø´Ø¯.`,{type:"VIEW_STUDENT_PROFILE",studentId:m.identity.studentId}),ke(),oe(),o.value="",o.focus()}),a.addEventListener("click",()=>{te(),T("session-page")}),document.getElementById("new-session-btn").addEventListener("click",()=>{if(d){const l=d.sessions.find(m=>!m.isFinished&&!m.isCancelled&&!m.isDeleted);if(l){C(`âš ï¸ Ø¬Ù„Ø³Ù‡ ${l.sessionNumber} Ù‡Ù†ÙˆØ² ØªÙ…Ø§Ù… Ù†Ø´Ø¯Ù‡ Ø§Ø³Øª. Ù„Ø·ÙØ§Ù‹ Ø§Ø¨ØªØ¯Ø§ Ø¨Ø§ Ø¯Ú©Ù…Ù‡ âœ… Ø¢Ù† Ø±Ø§ Ø®Ø§ØªÙ…Ù‡ Ø¯Ù‡ÛŒØ¯.`);return}const g=()=>{const m=h=>{const E=d.startNewSession();ut(E),ie(E),d.students.forEach(x=>{yn.setAttendance(x.identity.studentId,"present")}),k();const I=fe(d).get(E.sessionNumber);A(d.info.name,`Ø¬Ù„Ø³Ù‡ ${I} Ø´Ø±ÙˆØ¹ Ø´Ø¯.`,{type:"VIEW_SESSIONS"}),Mn(h?"attendance":"selector")};z("Ø¢ÛŒØ§ ØªÙ…Ø§ÛŒÙ„ Ø¨Ù‡ Ø§Ù†Ø¬Ø§Ù… ÙØ±Ø¢ÛŒÙ†Ø¯ Ø­Ø¶ÙˆØ± Ùˆ ØºÛŒØ§Ø¨ Ø¯Ø§Ø±ÛŒØ¯ØŸ",()=>m(!0),{confirmText:"Ø¨Ù„Ù‡",cancelText:"Ø®ÛŒØ±",confirmClass:"btn-success",onCancel:()=>m(!1)})};d.hasSessionToday()?z("Ø´Ù…Ø§ Ø§Ù…Ø±ÙˆØ² ÛŒÚ© Ø¬Ù„Ø³Ù‡ Ø¨Ø±Ø§ÛŒ Ø§ÛŒÙ† Ú©Ù„Ø§Ø³ Ø«Ø¨Øª Ú©Ø±Ø¯Ù‡â€ŒØ§ÛŒØ¯. Ø¢ÛŒØ§ Ø§Ø² Ø´Ø±ÙˆØ¹ ÛŒÚ© Ø¬Ù„Ø³Ù‡ Ø¬Ø¯ÛŒØ¯ Ø¯ÛŒÚ¯Ø± Ù…Ø·Ù…Ø¦Ù† Ù‡Ø³ØªÛŒØ¯ØŸ",g,{confirmText:"Ø¨Ù„Ù‡",confirmClass:"btn-warning"}):g()}}),n.addEventListener("click",()=>{const l=t.value.trim(),g=document.querySelector('input[name="class-type"]:checked');if(!l&&!g){C("âš ï¸Ù„Ø·ÙØ§Ù‹ Ù†Ø§Ù… Ùˆ Ù†ÙˆØ¹ Ú©Ù„Ø§Ø³ Ø±Ø§ Ù…Ø´Ø®Øµ Ú©Ù†ÛŒØ¯.");return}if(!l){C("âš ï¸Ù„Ø·ÙØ§Ù‹ Ù†Ø§Ù… Ú©Ù„Ø§Ø³ Ø±Ø§ ÙˆØ§Ø±Ø¯ Ú©Ù†ÛŒØ¯.");return}if(!g){C("âš ï¸Ù„Ø·ÙØ§Ù‹ Ù†ÙˆØ¹ Ú©Ù„Ø§Ø³ Ø±Ø§ Ø§Ù†ØªØ®Ø§Ø¨ Ú©Ù†ÛŒØ¯.");return}if(S[l]){S[l].isDeleted?C("âš ï¸ Ú©Ù„Ø§Ø³ÛŒ Ø¨Ø§ Ø§ÛŒÙ† Ù†Ø§Ù… Ø¯Ø± Ø³Ø·Ù„ Ø²Ø¨Ø§Ù„Ù‡ Ø§Ø³Øª. Ø§Ø¨ØªØ¯Ø§ Ø¢Ù† Ø±Ø§ Ø¨Ø§Ø²ÛŒØ§Ø¨ÛŒ Ú©Ù†ÛŒØ¯ Ùˆ ÛŒØ§ Ø¢Ù† Ø±Ø§ Ù¾Ø§Ú© Ú©Ù†ÛŒØ¯."):C("âš ï¸Ú©Ù„Ø§Ø³ÛŒ Ø¨Ø§ Ø§ÛŒÙ† Ù†Ø§Ù… Ø§Ø² Ù‚Ø¨Ù„ ÙˆØ¬ÙˆØ¯ Ø¯Ø§Ø±Ø¯.");return}const m=g.value,h=new Zt({name:l,type:m});S[l]=h,k(),A(l,`Ú©Ù„Ø§Ø³ Â«${l}Â» Ø§ÛŒØ¬Ø§Ø¯ Ø´Ø¯.`,{type:"VIEW_SESSIONS"}),ae(),C(`âœ… Ú©Ù„Ø§Ø³ Â«${l}Â» Ø¨Ø§ Ù…ÙˆÙÙ‚ÛŒØª Ø§ÛŒØ¬Ø§Ø¯ Ø´Ø¯.`),t.value="",g.checked=!1}),e.addEventListener("input",l=>{const g=l.target.value;if(g.length<2){Bt([]);return}const m=g.toLowerCase(),h=Yt(m),E=[];for(const B in S){const I=S[B];if(I.isDeleted)continue;q(I.students).filter(O=>{const U=be(O.identity.name.toLowerCase()),ee=U.includes(be(m)),Xe=U.includes(be(h));return ee||Xe}).forEach(O=>{E.push({student:O,classroom:I})})}Bt(E)}),t.addEventListener("keyup",l=>{l.key==="Enter"&&n.click()}),s.addEventListener("click",Os),document.querySelectorAll(".back-to-classes-btn").forEach(l=>{l.addEventListener("click",()=>{X(null),ie(null),ut(null),T("class-management-page")})}),$.addEventListener("click",()=>{$n("selector")}),Be.addEventListener("input",l=>{const g=l.target.value;if(!g){tt([]);return}const m=g.toLowerCase(),h=Yt(m),B=q(d.students).filter(I=>{const x=be(I.identity.name.toLowerCase()),O=x.includes(be(m)),U=x.includes(be(h));return O||U});tt(B)}),Be.addEventListener("focus",()=>{Be.value&&tt(Be.value)}),Je.addEventListener("click",()=>{const l=Le.value,g=ye.value.trim();let m;if(Rt)m=Rt.student;else{const E=v==null?void 0:v.winnerHistory[he];m=E==null?void 0:E.winner}if(!m){C("âŒØ®Ø·Ø§: Ø¯Ø§Ù†Ø´â€ŒØ¢Ù…ÙˆØ² Ù…Ø¹ØªØ¨Ø±ÛŒ Ø¨Ø±Ø§ÛŒ Ø«Ø¨Øª Ù†Ù…Ø±Ù‡ ÛŒØ§ÙØª Ù†Ø´Ø¯.");return}const h=le;if(!m||!h){C("âš ï¸Ù„Ø·ÙØ§Ù‹ Ø§Ø¨ØªØ¯Ø§ ÛŒÚ© Ø¯Ø§Ù†Ø´â€ŒØ¢Ù…ÙˆØ² Ùˆ ÛŒÚ© Ø¯Ø³ØªÙ‡â€ŒØ¨Ù†Ø¯ÛŒ Ø±Ø§ Ø§Ù†ØªØ®Ø§Ø¨ Ú©Ù†ÛŒØ¯.");return}if(!l){C("âš ï¸Ù„Ø·ÙØ§Ù‹ Ù…Ù‚Ø¯Ø§Ø± Ù†Ù…Ø±Ù‡ Ø±Ø§ ÙˆØ§Ø±Ø¯ Ú©Ù†ÛŒØ¯.");return}if(l>100||l<0){C("âŒÙ†Ù…Ø±Ù‡ Ù†Ø¨Ø§ÛŒØ¯ Ø§Ø² Û±Û°Û° Ø¨ÛŒØ´ØªØ± Ùˆ Ø§Ø² ØµÙØ± Ú©Ù…ØªØ± Ø¨Ø§Ø´Ø¯");return}m&&(m.addScore(h.name,parseFloat(l),g),A(d.info.name,`Ù†Ù…Ø±Ù‡ ${l} Ø¯Ø± ${h.name} Ø¨Ø±Ø§ÛŒ Â«${m.identity.name}Â» Ø«Ø¨Øª Ø´Ø¯.`,{type:"VIEW_STUDENT_PROFILE",studentId:m.identity.studentId}),k(),oe(),C(`âœ…Ù†Ù…Ø±Ù‡ Ø¨Ø±Ø§ÛŒ ${m.identity.name} Ø¯Ø± Ù…Ù‡Ø§Ø±Øª ${h.name} Ø«Ø¨Øª Ø´Ø¯.`),Le.value="",ye.value="",me(m,h.name))});const qn=l=>{l.key==="Enter"&&l.ctrlKey&&(l.preventDefault(),Je.click())};Le.addEventListener("keydown",qn),ye.addEventListener("keydown",qn),Qe.addEventListener("click",()=>{F()}),jt.addEventListener("click",()=>{const l=Fe.value.trim();typeof Ot=="function"&&(Ot(l),We(),F())});const to=document.getElementById("move-student-confirm-btn"),no=document.getElementById("move-student-cancel-btn"),so=document.getElementById("move-student-class-select");no.addEventListener("click",()=>{F()}),to.addEventListener("click",()=>{const l=so.value,g=S[l],{studentToMove:m,sourceClassForMove:h}=yo;if(!m||!h||!g){C("Ø®Ø·Ø§ÛŒÛŒ Ø±Ø® Ø¯Ø§Ø¯. Ù„Ø·ÙØ§Ù‹ Ø¯ÙˆØ¨Ø§Ø±Ù‡ Ø§Ù…ØªØ­Ø§Ù† Ú©Ù†ÛŒØ¯âš ï¸.","error"),F();return}const E=as(m,h,g);E.success?(A(h.info.name,`Ø¯Ø§Ù†Ø´â€ŒØ¢Ù…ÙˆØ² Â«${m.identity.name}Â» Ø¨Ù‡ Ú©Ù„Ø§Ø³ Â«${l}Â» Ù…Ù†ØªÙ‚Ù„ Ø´Ø¯.`,{type:"VIEW_SESSIONS"}),A(l,`Ø¯Ø§Ù†Ø´â€ŒØ¢Ù…ÙˆØ² Â«${m.identity.name}Â» Ø§Ø² Ú©Ù„Ø§Ø³ Â«${h.info.name}Â» Ø¨Ù‡ Ø§ÛŒÙ† Ú©Ù„Ø§Ø³ Ù…Ù†ØªÙ‚Ù„ Ø´Ø¯.`,{type:"VIEW_SESSIONS"}),k(),ke(),C(`Ø¯Ø§Ù†Ø´â€ŒØ¢Ù…ÙˆØ² Â«${m.identity.name}Â» Ø¨Ø§ Ù…ÙˆÙÙ‚ÛŒØª Ø¨Ù‡ Ú©Ù„Ø§Ø³ Â«${l}Â» Ù…Ù†ØªÙ‚Ù„ Ø´Ø¯âœ….`)):C(E.message,"error"),F()}),Ee.addEventListener("click",()=>{Q.style.width="300px",K.classList.add("modal-visible")}),pe.addEventListener("click",re),K.addEventListener("click",re),eo.addEventListener("click",()=>{pt(),T("trash-page"),re()}),document.getElementById("demo-mode-btn").addEventListener("click",()=>{Ce?Vn():(re(),z("Ø´Ù…Ø§ Ø¯Ø± Ø­Ø§Ù„ ÙˆØ±ÙˆØ¯ Ø¨Ù‡ Ø­Ø§Ù„Øª Ù†Ù…Ø§ÛŒØ´ (Demo) Ù‡Ø³ØªÛŒØ¯. Ø¯Ø± Ø§ÛŒÙ† Ø­Ø§Ù„ØªØŒ Ù‡ÛŒÚ†â€ŒÚ©Ø¯Ø§Ù… Ø§Ø² ØªØºÛŒÛŒØ±Ø§Øª Ø´Ù…Ø§ Ø°Ø®ÛŒØ±Ù‡ Ù†Ø®ÙˆØ§Ù‡Ø¯ Ø´Ø¯. Ø¢ÛŒØ§ Ø§Ø¯Ø§Ù…Ù‡ Ù…ÛŒâ€ŒØ¯Ù‡ÛŒØ¯ØŸ",()=>{us(),xt(),re()},{confirmText:"ØªØ§ÛŒÛŒØ¯",confirmClass:"btn-warning",onCancel:re}))});const Un=document.getElementById("exit-demo-btn");Un&&Un.addEventListener("click",()=>{Ce&&Vn()}),_e.addEventListener("click",()=>{if(Ce){C("âš ï¸ Ù¾Ø´ØªÛŒØ¨Ø§Ù†â€ŒÚ¯ÛŒØ±ÛŒ Ø¯Ø± Ø­Ø§Ù„Øª Ù†Ù…Ø§ÛŒØ´ (Demo) ØºÛŒØ±ÙØ¹Ø§Ù„ Ø§Ø³Øª."),re();return}re(),ft()}),ht.addEventListener("click",()=>{if(Ce){C("âš ï¸ Ø¨Ø§Ø²ÛŒØ§Ø¨ÛŒ Ø§Ø·Ù„Ø§Ø¹Ø§Øª Ø¯Ø± Ø­Ø§Ù„Øª Ù†Ù…Ø§ÛŒØ´ (Demo) ØºÛŒØ±ÙØ¹Ø§Ù„ Ø§Ø³Øª."),re();return}Ne.click(),re()}),Ne.addEventListener("change",l=>{const g=l.target.files[0];if(!g)return;const m=new FileReader;m.onload=h=>{try{const E=JSON.parse(h.target.result);if(E.metadata&&E.data)Hs(E);else{const B=E.classrooms||E,I=E.trashBin||[];z("Ø¢ÛŒØ§ Ø§Ø² Ø¨Ø§Ø²ÛŒØ§Ø¨ÛŒ Ø§Ø·Ù„Ø§Ø¹Ø§Øª Ù…Ø·Ù…Ø¦Ù† Ù‡Ø³ØªÛŒØ¯ØŸ ØªÙ…Ø§Ù… Ø¯Ø§Ø¯Ù‡â€ŒÙ‡Ø§ÛŒ ÙØ¹Ù„ÛŒ Ø´Ù…Ø§ Ø¨Ø§Ø²Ù†ÙˆÛŒØ³ÛŒ Ø®ÙˆØ§Ù‡Ø¯ Ø´Ø¯.",()=>{Ae(B),Ft(I),nt({lastRestoreTimestamp:new Date().toISOString()}),k(),ae(),T("class-management-page"),C("âœ…Ø§Ø·Ù„Ø§Ø¹Ø§Øª Ø¨Ø§ Ù…ÙˆÙÙ‚ÛŒØª Ø¨Ø§Ø²ÛŒØ§Ø¨ÛŒ Ø´Ø¯.")},{confirmText:"Ø¨Ø§Ø²ÛŒØ§Ø¨ÛŒ Ú©Ù†",confirmClass:"btn-warning"})}}catch(E){C("âŒØ®Ø·Ø§ Ø¯Ø± Ø®ÙˆØ§Ù†Ø¯Ù† ÙØ§ÛŒÙ„. Ù„Ø·ÙØ§Ù‹ ÙØ§ÛŒÙ„ Ù¾Ø´ØªÛŒØ¨Ø§Ù† Ù…Ø¹ØªØ¨Ø± Ø§Ù†ØªØ®Ø§Ø¨ Ú©Ù†ÛŒØ¯."),console.error("Restore error:",E)}},m.readAsText(g),l.target.value=null}),window.addEventListener("popstate",l=>{if(Te){F(null,!0);return}if($e(),l.state){const{pageId:g,currentClassName:m,selectedSessionNumber:h,selectedStudentId:E}=l.state;m&&(X(S[m]),h&&ie(d.getSession(h)),E&&de(d.students.find(B=>B.identity.studentId===E))),g==="session-page"?(te(),lt(g)):g==="student-profile-page"?(te(),T("session-page"),ne(D)):lt(g)}else X(null),ie(null),de(null),lt("class-management-page")}),document.addEventListener("keydown",l=>{var h;const g=document.activeElement;if(!["INPUT","TEXTAREA","SELECT"].includes(g.tagName)){if(l.key.toLowerCase()==="o"&&l.shiftKey&&Is.classList.contains("active")&&(l.preventDefault(),ws.click()),l.key==="Escape"){if(He.classList.contains("visible")){$e();return}if(Te){F();return}switch((h=document.querySelector(".page.active"))==null?void 0:h.id){case"csv-preview-page":case"column-mapping-page":T("settings-page");break;case"student-profile-page":de(null),T(v?"student-page":"session-page");break;case"attendance-page":T("student-page");break;case"student-page":ie(null),te(),T("session-page");break;case"settings-page":case"session-page":X(null),T("class-management-page");break}return}if(v){const E=l.key.toLowerCase();switch(" ascfg".includes(E)&&l.preventDefault(),E){case" ":j.click();break;case"a":P.classList.contains("active")?history.back():(We(),T("attendance-page"));break;case"s":document.getElementById("session-page").classList.contains("active")?history.back():a.click();break;case"c":document.querySelector(".back-to-classes-btn").click();break;case"f":const B=document.querySelector(".action-column .search-icon");B&&B.click();break;case"g":if(studentProfilePage.classList.contains("active"))history.back();else{const I=v.lastSelectedWinnerId;if(I){const x=d.students.find(O=>O.identity.studentId===I);x&&(de(x),(void 0)(),T("student-profile-page"))}else C("âš ï¸Ø§Ø¨ØªØ¯Ø§ ÛŒÚ© Ù†ÙØ± Ø±Ø§ Ø§Ù†ØªØ®Ø§Ø¨ Ú©Ù†ÛŒØ¯ ØªØ§ Ù¾Ø±ÙˆÙØ§ÛŒÙ„ Ø§Ùˆ Ù†Ù…Ø§ÛŒØ´ Ø¯Ø§Ø¯Ù‡ Ø´ÙˆØ¯.")}break;case"arrowleft":{const I=document.querySelector('button[title="Ø¨Ø±Ù†Ø¯Ù‡ Ù‚Ø¨Ù„ÛŒ"]');I&&!I.disabled&&(l.preventDefault(),I.click());break}case"arrowright":{const I=document.querySelector('button[title="Ø¨Ø±Ù†Ø¯Ù‡ Ø¨Ø¹Ø¯ÛŒ"]');I&&!I.disabled&&(l.preventDefault(),I.click());break}}}}});function re(){Q.style.width="0",K.classList.add("modal-closing"),setTimeout(()=>{K.classList.remove("modal-visible","modal-closing")},300)}function Vn(){z("Ø¢ÛŒØ§ Ø§Ø² Ø®Ø±ÙˆØ¬ Ø§Ø² Ø­Ø§Ù„Øª Ù†Ù…Ø§ÛŒØ´ (Demo) Ù…Ø·Ù…Ø¦Ù† Ù‡Ø³ØªÛŒØ¯ØŸ Ø¨Ø§ Ø®Ø±ÙˆØ¬ØŒ ØªÙ…Ø§Ù… ØªØºÛŒÛŒØ±Ø§Øª Ø¢Ø²Ù…Ø§ÛŒØ´ÛŒ Ø´Ù…Ø§ Ø­Ø°Ù Ø´Ø¯Ù‡ Ùˆ Ø¯Ø§Ø¯Ù‡â€ŒÙ‡Ø§ÛŒ Ø§ØµÙ„ÛŒ Ø´Ù…Ø§ Ø¨Ø§Ø²ÛŒØ§Ø¨ÛŒ Ø®ÙˆØ§Ù‡Ù†Ø¯ Ø´Ø¯.",()=>{ms(),X(null),ie(null),de(null),ae(),T("class-management-page"),xt(),re()},{confirmText:"Ø®Ø±ÙˆØ¬",confirmClass:"btn-success"})}Fn(".global-search-container .animated-search-container",Bt),Fn(".action-column-header .animated-search-container",tt),[H,xs,ye,Ls].forEach(l=>{l&&Fs(l)});function Gn(l,g){const m=q(g.students).filter(W=>W.identity.studentId!==l.identity.studentId);if(m.length===0)return;const h=m.reduce((W,Y)=>Y.statusCounters.totalSelections>W.statusCounters.totalSelections?Y:W,m[0]);if(!h||h.statusCounters.totalSelections===0)return;l.categoryCounts=JSON.parse(JSON.stringify(h.categoryCounts)),l.statusCounters.totalSelections=h.statusCounters.totalSelections;const E=m.reduce((W,Y)=>W+Y.statusCounters.totalSelections,0),B=m.reduce((W,Y)=>W+(Y.statusCounters.missedChances||0),0),I=E>0?B/E:0;l.statusCounters.missedChances=Math.round(l.statusCounters.totalSelections*I);const x=q(g.categories),O={};x.forEach(W=>{const Y=m.reduce((Kt,Qt)=>Kt+(Qt.categoryCounts[W.name]||0),0),Jt=m.reduce((Kt,Qt)=>Kt+(Qt.categoryIssues[W.name]||0),0);O[W.name]=Y>0?Jt/Y:0}),x.forEach(W=>{const Y=l.categoryCounts[W.name]||0,Jt=O[W.name]||0;l.categoryIssues[W.name]=Math.round(Y*Jt)});const U=g.liveSession;U?l.onboardingSession=U.sessionNumber:l.onboardingSession=g.sessions.length+1;const ee=q(g.sessions).filter(W=>W.isFinished&&!W.isCancelled),Xe="ğŸ“ ÛŒØ§Ø¯Ø¯Ø§Ø´Øª Ø®ÙˆØ¯Ú©Ø§Ø± Ø³ÛŒØ³ØªÙ…",fo=`Ø§ÛŒÙ† Ø¯Ø§Ù†Ø´â€ŒØ¢Ù…ÙˆØ²  Ø§Ø² Ø¬Ù„Ø³Ù‡ Ø´Ù…Ø§Ø±Ù‡ ${ee.length} Ø¨Ù‡ Ú©Ù„Ø§Ø³ Ø§Ø¶Ø§ÙÙ‡ Ø´Ø¯. Ø¢Ù…Ø§Ø± Ù…Ø´Ø§Ø±Ú©Øª Ø§Ùˆ Ø¨Ø± Ø§Ø³Ø§Ø³ ÙØ¹Ø§Ù„â€ŒØªØ±ÛŒÙ† Ø¯Ø§Ù†Ø´â€ŒØ¢Ù…ÙˆØ² Ùˆ Ø¢Ù…Ø§Ø± Â«ÙØ±ØµØª Ø§Ø² Ø¯Ø³Øª Ø±ÙØªÙ‡Â» Ø§Ùˆ Ø¨Ø± Ø§Ø³Ø§Ø³ Ù…ÛŒØ§Ù†Ú¯ÛŒÙ† Ú©Ù„Ø§Ø³ Ø«Ø¨Øª Ú¯Ø±Ø¯ÛŒØ¯:`,qe=[];l.statusCounters.totalSelections>0&&qe.push(`Ú©Ù„ Ø§Ù†ØªØ®Ø§Ø¨â€ŒÙ‡Ø§: ${l.statusCounters.totalSelections}`),l.statusCounters.missedChances>0&&qe.push(`ÙØ±ØµØªâ€ŒÙ‡Ø§ÛŒ Ø§Ø² Ø¯Ø³Øª Ø±ÙØªÙ‡: ${l.statusCounters.missedChances}`);for(const W in l.categoryCounts){const Y=l.categoryCounts[W];Y>0&&qe.push(`Ø§Ù†ØªØ®Ø§Ø¨ Ø¯Ø± Â«${W}Â»: ${Y}`)}for(const W in l.categoryIssues){const Y=l.categoryIssues[W];Y>0&&qe.push(`Ù…Ø´Ú©Ù„ Ø¯Ø± Â«${W}Â»: ${Y}`)}if(qe.length>0){const W=`${Xe}
${fo}

- ${qe.join(`
- `)}`;l.addNote(W)}}function jn(l){const m=`Ú†ÙˆÙ† Ø§ÛŒÙ† Ú©Ù„Ø§Ø³ Ø¬Ù„Ø³Ø§Øª Ø¨Ø±Ú¯Ø²Ø§Ø± Ø´Ø¯Ù‡ Ø¯Ø§Ø±Ø¯ØŒ Ø¨Ø±Ø§ÛŒ ${l>1?"Ø¯Ø§Ù†Ø´â€ŒØ¢Ù…ÙˆØ²Ø§Ù† Ø¬Ø¯ÛŒØ¯":"Ø¯Ø§Ù†Ø´â€ŒØ¢Ù…ÙˆØ² Ø¬Ø¯ÛŒØ¯"} Ø¢Ù…Ø§Ø± Ù¾Ø§ÛŒÙ‡â€ŒØ§ÛŒ (Ù…ØªÙ†Ø§Ø³Ø¨ Ø¨Ø§ Ø³Ø§ÛŒØ± Ø¯Ø§Ù†Ø´â€ŒØ¢Ù…ÙˆØ²Ø§Ù†) Ø«Ø¨Øª Ø´Ø¯ ØªØ§ Ø¯Ø± ÙØ±Ø§ÛŒÙ†Ø¯ Ø§Ù†ØªØ®Ø§Ø¨ Ø§Ø®ØªÙ„Ø§Ù„ÛŒ Ø§ÛŒØ¬Ø§Ø¯ Ù†Ø´ÙˆØ¯.`;z(m,()=>{},{confirmText:"Ù…ØªÙˆØ¬Ù‡ Ø´Ø¯Ù…",confirmClass:"btn-success",onCancel:null})}const oo="9.0.0";document.getElementById("app-version").textContent=`Ù†Ø³Ø®Ù‡ ${oo}`;function ao(){console.log("Starting universal backfill for writing scores...");let l=0;for(const g in S){const m=S[g];if(m.isDeleted)continue;let h=0;q(m.students).forEach(B=>{const I=B.logs.scores;if(!(I&&I.writing&&I.writing.length>0)){let O=-1;for(const U in I)U!=="writing"&&I[U].forEach(ee=>{ee.value>O&&(O=ee.value)});if(O>-1){const U=`Automatically assigned based on the highest score (${O}) from other skills.`;B.addScore("Writing",O,U),h++}}}),h>0&&(console.log(`Updated ${h} student(s) in class: ${m.info.name}.`),l+=h)}l>0?(k(),console.log(`Update complete. A total of ${l} student(s) were updated across all classes. Data saved.`),document.getElementById("student-page").classList.contains("active")&&oe()):console.log("No students needed updating in any class.")}window.backfillWritingScoresForAll=ao;function io(){console.log("Starting backfill for 'outOfClassCount' and 'wasOutOfClass' properties...");let l=0,g=0;const m=localStorage.getItem("teacherAssistantData_v2");if(!m){console.log("No data found in localStorage. Nothing to do.");return}const h=JSON.parse(m);for(const E in h){const B=h[E];B.students&&B.students.forEach(I=>{I.statusCounters&&typeof I.statusCounters.outOfClassCount>"u"&&(I.statusCounters.outOfClassCount=0,l++)}),B.sessions&&B.sessions.forEach(I=>{if(I.studentRecords)for(const x in I.studentRecords){const O=I.studentRecords[x];typeof O.wasOutOfClass>"u"&&(O.wasOutOfClass=!1,g++)}})}localStorage.setItem("teacherAssistantData_v2",JSON.stringify(h)),console.log(`Backfill complete. Updated ${l} students and ${g} session records. Data saved.`),At(),d&&oe()}window.backfillExitCounters=io;function co(){console.log("ğŸ§¹ Starting orphaned data cleanup...");let l=0;for(const g in S){const m=S[g];if(m.isDeleted)continue;let h=!1;const E=new Set(m.students.filter(x=>!x.isDeleted).map(x=>x.identity.studentId)),B=new Map(m.students.map(x=>[x.identity.studentId,x.identity.name])),I=[];m.sessions.forEach(x=>{if(x.isDeleted)return;const O=[];for(const U in x.studentRecords)if(!E.has(U)){const ee=B.get(U)||"Unknown/Deleted";O.push(`  - Removed student record for: ${ee} (ID: ${U})`),delete x.studentRecords[U],l++,h=!0}for(const U in x.lastWinnerByCategory){const ee=x.lastWinnerByCategory[U];if(!E.has(ee)){const Xe=B.get(ee)||"Unknown/Deleted";O.push(`  - Removed '${U}' last winner: ${Xe} (ID: ${ee})`),delete x.lastWinnerByCategory[U],l++,h=!0}}if(x.lastSelectedWinnerId&&!E.has(x.lastSelectedWinnerId)){const U=x.lastSelectedWinnerId,ee=B.get(U)||"Unknown/Deleted";O.push(`  - Cleared 'lastSelectedWinnerId': ${ee} (ID: ${U})`),x.lastSelectedWinnerId=null,l++,h=!0}if(O.length>0){const ee=fe(m).get(x.sessionNumber)||`(#${x.sessionNumber})`;I.push({sessionDisplayNumber:ee,logs:O})}}),h&&(console.group(`â¡ï¸ Class: ${g}`),I.forEach(x=>{console.groupCollapsed(`  Session ${x.sessionDisplayNumber}`),x.logs.forEach(O=>console.warn(O)),console.groupEnd()}),console.groupEnd())}l>0?(k(),console.log(`âœ… Cleanup complete! Found and removed ${l} orphaned references. Data saved.`)):console.log("âœ… No orphaned data found. Your data is clean!")}window.cleanupOrphanedData=co;function lo(l){if(!l||!l.classroomName)return;const g=S[l.classroomName];if(!g){C("âš ï¸ Ú©Ù„Ø§Ø³ Ù…Ø±Ø¨ÙˆØ· Ø¨Ù‡ Ø§ÛŒÙ† Ú¯Ø²Ø§Ø±Ø´ ÛŒØ§ÙØª Ù†Ø´Ø¯.");return}X(g),F(),setTimeout(()=>{switch(l.type){case"VIEW_STUDENT_PROFILE":{const m=g.students.find(h=>h.identity.studentId===l.studentId);m?ne(m):C("âš ï¸ Ø¯Ø§Ù†Ø´â€ŒØ¢Ù…ÙˆØ² Ù…ÙˆØ±Ø¯ Ù†Ø¸Ø± ÛŒØ§ÙØª Ù†Ø´Ø¯.");break}case"VIEW_TRASH":pt(),T("trash-page");break;case"VIEW_SESSIONS":te(),T("session-page");break;case"VIEW_CLASS_NOTE":Rn(g);break;case"VIEW_CLASS_SETTINGS":An(g);break}},300)}Ks.addEventListener("click",()=>{Ws()}),Qs.addEventListener("click",()=>{F()}),Ys.addEventListener("click",()=>{const l=Xs.value.trim(),g=Zs.checked;if(!l){Dn.style.display==="flex"?z("Ú©Ø§Ø¯Ø± ÛŒØ§Ø¯Ø¯Ø§Ø´Øª Ø®Ø§Ù„ÛŒ Ø§Ø³Øª. Ø¢ÛŒØ§ Ù…Ø·Ù…Ø¦Ù†ÛŒØ¯ Ú©Ù‡ Ù…ÛŒâ€ŒØ®ÙˆØ§Ù‡ÛŒØ¯ ÛŒØ§Ø¯Ø¯Ø§Ø´Øªâ€ŒÙ‡Ø§ÛŒ Ù‚Ø¨Ù„ÛŒ Ø¯Ø§Ù†Ø´â€ŒØ¢Ù…ÙˆØ²Ø§Ù† Ø§Ù†ØªØ®Ø§Ø¨â€ŒØ´Ø¯Ù‡ Ø±Ø§ Ù¾Ø§Ú© Ú©Ù†ÛŒØ¯ØŸ",()=>{F(),fn("",!1)},{confirmText:"Ù¾Ø§Ú© Ú©Ø±Ø¯Ù†",confirmClass:"btn-warning"}):C("âš ï¸ Ù„Ø·ÙØ§Ù‹ Ù…ØªÙ† ÛŒØ§Ø¯Ø¯Ø§Ø´Øª Ø±Ø§ ÙˆØ§Ø±Ø¯ Ú©Ù†ÛŒØ¯.");return}F(()=>{fn(l,g)})});const De=document.getElementById("screen-saver-overlay"),zn=document.getElementById("screen-saver-toggle");let zt;const ro=2*60*1e3,Jn=["mousemove","keypress","scroll","click","touchstart"];function uo(){De.classList.add("visible")}function Kn(){De.classList.contains("visible")&&De.classList.remove("visible")}function yt(){Kn(),clearTimeout(zt),zt=setTimeout(uo,ro)}function Ct(l){l.preventDefault(),l.stopPropagation(),setTimeout(yt,0)}function Qn(){yt(),Jn.forEach(g=>window.addEventListener(g,yt)),De.addEventListener("click",Ct),De.addEventListener("touchstart",Ct);const l="9.0.0";{const g=document.getElementById("screen-saver-version");g&&(g.textContent=`v${l}`)}}function mo(){clearTimeout(zt),Kn(),Jn.forEach(l=>window.removeEventListener(l,yt)),De.removeEventListener("click",Ct),De.removeEventListener("touchstart",Ct)}zn.checked=ue.isScreenSaverEnabled,ue.isScreenSaverEnabled&&Qn(),zn.addEventListener("change",l=>{l.target.checked?(nt({isScreenSaverEnabled:!0}),Qn()):(re(),l.preventDefault(),z(`Ù†Ú©ØªÙ‡:
Ù…Ø­Ø§ÙØ¸ ØµÙØ­Ù‡ Ø¯Ø± ØªÙ„ÙÙ† Ù‡Ø§ÛŒ Ù‡Ù…Ø±Ø§Ù‡ Ø¬Ø¯ÛŒØ¯ Ú©Ù…Ú© Ù…ÛŒ Ú©Ù†Ø¯ Ú©Ù‡ Ø¯Ø³ØªÚ¯Ø§Ù‡ Ø¨Ø§Ø·Ø±ÛŒ Ú©Ù…ØªØ±ÛŒ Ù…ØµØ±Ù Ú©Ù†Ø¯ Ùˆ Ø¨Ù‡ Ø¯Ù„ÛŒÙ„ Ø«Ø§Ø¨Øª Ù…Ø§Ù†Ø¯Ù† ØµÙØ­Ù‡ Ù†Ù…Ø§ÛŒØ´ Ø¯Ø± Ú¯ÙˆØ´ÛŒ Ù‡Ø§ÛŒ Ù‚Ø¯ÛŒÙ…ÛŒ ØªØ±ØŒ ØµÙØ­Ù‡ Ù†Ù…Ø§ÛŒØ´ Ø¯Ú†Ø§Ø± Ù…Ø§Ù†Ø¯Ú¯ÛŒ Ø±Ø¯ Ù¾ÛŒÚ©Ø³Ù„ Ù†Ú¯Ø±Ø¯Ø¯. Ø¢ÛŒØ§ Ù…Ø·Ù…Ø¦Ù† Ù‡Ø³ØªÛŒØ¯ Ú©Ù‡ Ù…ÛŒ Ø®ÙˆØ§Ù‡ÛŒØ¯ Ø§ÛŒÙ† ÙˆÛŒÚ˜Ú¯ÛŒ Ø±Ø§ ØºÛŒØ± ÙØ¹Ø§Ù„ Ú©Ù†ÛŒØ¯ØŸ`,()=>{l.target.checked=!1,nt({isScreenSaverEnabled:!1}),mo(),C("ØªÙˆØµÛŒÙ‡ Ù…ÛŒ Ø´ÙˆØ¯ Ø²Ù…Ø§Ù† Ø®Ø§Ù…ÙˆØ´ Ø´Ø¯Ù† ØµÙØ­Ù‡ Ù†Ù…Ø§ÛŒØ´ Ú¯ÙˆØ´ÛŒ Ø®ÙˆØ¯ Ø±Ø§ Ø¨Ù‡ Ø­Ø¯Ø§Ù‚Ù„ Ø¯Ùˆ Ø¯Ù‚ÛŒÙ‚Ù‡ ØªØºÛŒÛŒØ± Ø¯Ù‡ÛŒØ¯ ØªØ§ Ø¯Ø± Ø§Ø³ØªÙØ§Ø¯Ù‡ Ù‡Ø§ÛŒ Ø·ÙˆÙ„Ø§Ù†ÛŒ Ù…Ø¯Øª ØµÙØ­Ù‡ Ù†Ù…Ø§ÛŒØ´ Ú¯ÙˆØ´ÛŒ Ø§ØµØ·Ø­Ù„Ø§Ú© Ú©Ù…ØªØ±ÛŒ Ø±Ø§ ØªØ¬Ø±Ø¨Ù‡ Ú©Ù†Ø¯",7e3)},{confirmText:"Ø¨Ù„Ù‡ØŒ ØºÛŒØ±ÙØ¹Ø§Ù„ Ú©Ù†",cancelText:"Ù„ØºÙˆ",onCancel:()=>{l.target.checked=!0}}))})});
